<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no"/><title>RPG Game UI</title><script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script><style>body,html{margin:0;padding:0;background-color:transparent;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}#app{width:100%;min-height:600px}</style><script type="module">/*! For license information please see index.js.LICENSE.txt */
import{default as e}from'https://testingcf.jsdelivr.net/npm/dexie/+esm';import{v4 as t}from'https://testingcf.jsdelivr.net/npm/uuid/+esm';import{default as a}from'https://testingcf.jsdelivr.net/npm/yaml/+esm';import{default as s}from'https://testingcf.jsdelivr.net/npm/dompurify/+esm';var n={36(e,t,a){a.d(t,{e:()=>s});class s{static STORY_TAGS=['thinking','content','summary','exits','npcs','objects','options','pic'];static parseStory(e){const t={content:'',rawText:e,unknownTags:[]};t.thinking=this.extractTag(e,'thinking'),t.content=this.extractTag(e,'content')||this.extractFallbackContent(e),t.summary=this.extractTag(e,'summary'),t.pic=this.extractPicTag(e);const a=this.extractTag(e,'exits');a&&(t.exits=this.parseSimpleList(a));const s=this.extractTag(e,'npcs');s&&(t.npcs=this.parseNpcList(s));const n=this.extractTag(e,'objects');n&&(t.objects=this.parseObjectList(n));const r=this.extractTag(e,'options');return r&&(t.options=this.parseOptionList(r)),t.unknownTags=this.extractUnknownTags(e),t}static extractTag(e,t){const a=new RegExp(`<${t}>([\\s\\S]*?)</${t}>`,'i'),s=e.match(a);return s?s[1].trim():void 0}static extractPicTag(e){const t=e.match(/<pic\s*=\s*'([^']+)'[^>]*>/i);if(t&&t[1].trim())return t[1].trim();const a=e.match(/<pic\s*=\s*"([^"]+)"[^>]*>/i);if(a&&a[1].trim())return a[1].trim();const s=e.match(/<pic\s*=\s*'([^']+)'\s*\/>/i);if(s&&s[1].trim())return s[1].trim();const n=e.match(/<pic\s*=\s*"([^"]+)"\s*\/>/i);if(n&&n[1].trim())return n[1].trim();const r=e.match(/<pic>([\s\S]*?)<\/pic>/i);if(r&&r[1].trim())return r[1].trim();const l=e.match(/<pic[^>]*['"]([^'"]+)['"]/i);return l&&l[1].trim()?l[1].trim():void 0}static extractAllTags(e,t){const a=new RegExp(`<${t}>([\\s\\S]*?)</${t}>`,'gi'),s=[];let n;for(;null!==(n=a.exec(e));)s.push(n[1].trim());return s}static stripAllTags(e){let t=e;return t=t.replace(/<[^>]+>[\s\S]*?<\/[^>]+>/g,''),t=t.replace(/<[^>]+\/>/g,''),t.trim()}static extractFallbackContent(e){let t=e;for(const e of this.STORY_TAGS){const a=new RegExp(`<${e}>[\\s\\S]*?</${e}>`,'gi');t=t.replace(a,'')}return t.trim()}static parseSimpleList(e){return e.split('\n').map(e=>e.trim()).filter(e=>e).map(e=>e.replace(/^(\d+\.\s*|-\s*)/,'').trim()).filter(e=>e)}static parseNpcList(e){return e.split('\n').map(e=>e.trim()).filter(e=>e).map((e,t)=>{const a=e.replace(/^(\d+\.\s*|-\s*)/,'').trim(),s=a.match(/^([^(（]+?)\s*[（(]([^)）]+)[)）]\s*-\s*(.+)$/);if(s)return{index:t+1,name:s[1].trim(),levelInfo:s[2].trim(),description:s[3].trim(),raw:e};const n=a.indexOf(' - ');if(n>0){const s=a.substring(0,n).trim(),r=a.substring(n+3).trim(),l=s.match(/^([^(（]+?)\s*[（(]([^)）]+)[)）]$/);return l?{index:t+1,name:l[1].trim(),levelInfo:l[2].trim(),description:r,raw:e}:{index:t+1,name:s,description:r,raw:e}}return{index:t+1,name:a,description:'',raw:e}})}static parseObjectList(e){return e.split('\n').map(e=>e.trim()).filter(e=>e).map((e,t)=>{const a=e.replace(/^(\d+\.\s*|-\s*)/,'').trim(),s=a.match(/^([^(（]+?)\s*[（(]([^)）]+)[)）]\s*-\s*(.+)$/);if(s){const a=s[2].trim(),n=s[3].trim();return{index:t+1,name:s[1].trim(),description:a?`${a}, ${n}`:n,raw:e}}const n=a.indexOf(' - ');if(n>0){const s=a.substring(0,n).trim(),r=a.substring(n+3).trim(),l=s.match(/^([^(（]+?)\s*[（(]([^)）]+)[)）]$/);if(l){const a=l[2].trim();return{index:t+1,name:l[1].trim(),description:a?`${a}, ${r}`:r,raw:e}}return{index:t+1,name:s,description:r,raw:e}}const r=a.match(/^([^(（]+?)\s*[（(]([^)）]+)[)）]$/);return r?{index:t+1,name:r[1].trim(),description:r[2].trim(),raw:e}:{index:t+1,name:a,description:'',raw:e}})}static parseOptionList(e){return e.split('\n').map(e=>e.trim()).filter(e=>e).map((e,t)=>{const a=e.replace(/^(\d+\.\s*|-\s*)/,'').trim(),s=a.match(/^\[([^\]]+)\]\s*(.+?)\s*\(([^)]*DC\s*(\d+)[^)]*)\)/i);if(s)return{index:t+1,text:s[2].trim(),isSkillCheck:!0,skillName:s[1].trim(),dc:parseInt(s[4],10),raw:e};let n=a;return n.startsWith('"')&&n.endsWith('"')&&(n=n.slice(1,-1)),n.startsWith('"')&&n.endsWith('"')&&(n=n.slice(1,-1)),{index:t+1,text:n,isSkillCheck:!1,raw:e}})}static extractUnknownTags(e){const t=[],a=/<(\w+)>([\s\S]*?)<\/\1>/g;let s;for(;null!==(s=a.exec(e));){const e=s[1].toLowerCase();this.STORY_TAGS.includes(e)||t.push({name:e,content:s[2].trim()})}return t}static hasAnyTags(e){for(const t of this.STORY_TAGS)if(void 0!==this.extractTag(e,t))return!0;return!1}static getVisibleContent(e){return e.content}}},173(e,t,a){a.d(t,{q:()=>s,serviceLocator:()=>n});class s{static instance;services=new Map;constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}register(e,t){this.services.has(e)&&console.warn(`[ServiceLocator] Service "${e}" is being overwritten.`),this.services.set(e,t),console.log(`[ServiceLocator] Registered service: ${e}`)}get(e){const t=this.services.get(e);if(!t)throw new Error(`[ServiceLocator] Service "${e}" not found. Make sure it is registered before use.`);return t}unregister(e){this.services.delete(e)}clear(){this.services.clear()}}const n=s.getInstance()},188(e,t,a){a.d(t,{DiceRoller:()=>s});class s{static roll(e){if('number'==typeof e)return e;if(!e)return 0;if(/^-?\d+$/.test(e))return parseInt(e,10);const t=e.match(/(\d+)d(\d+)(?:\s*([+-])\s*(\d+))?/);if(t){const e=parseInt(t[1],10),a=parseInt(t[2],10),s=t[3],n=t[4]?parseInt(t[4],10):0;let r=0;for(let t=0;t<e;t++)r+=Math.floor(Math.random()*a)+1;return'-'===s?r-=n:r+=n,r}return parseInt(e,10)||0}static evaluate(e,t,a,s='hp'){if('number'==typeof e)return e;if(!e)return 0;let n=e.toLowerCase();const r=(e,a)=>{const s=t.stats[a];if(!s)return 0;switch(e){case'max':return s.max;case'cur':return s.current;case'missing':return s.max-s.current;default:return 0}};n=n.replace(/(\d+(?:\.\d+)?)%_(max|cur|missing)(?!_)/gi,(_,e,t)=>{const a=r(t.toLowerCase(),s),n=parseFloat(e)/100;return String(Math.floor(n*a))}),n=n.replace(/(0\.\d+)_(max|cur|missing)(?!_)/gi,(_,e,t)=>{const a=r(t.toLowerCase(),s),n=parseFloat(e);return String(Math.floor(n*a))});const l={_self_max_hp:t.stats.hp.max,_self_cur_hp:t.stats.hp.current,_self_missing_hp:t.stats.hp.max-t.stats.hp.current,_self_max_mp:t.stats.mp.max,_self_cur_mp:t.stats.mp.current,_self_level:t.level,_target_max_hp:a?.stats.hp.max||0,_target_cur_hp:a?.stats.hp.current||0,_target_missing_hp:(a?.stats.hp.max||0)-(a?.stats.hp.current||0)};for(const[e,a]of Object.entries(t.attributes))l[`_self_${e.toLowerCase()}`]=Number(a)||0,l[`_${e.toLowerCase()}`]=Number(a)||0,l[`${e.toLowerCase()}`]=Number(a)||0;if(a)for(const[e,t]of Object.entries(a.attributes))l[`_target_${e.toLowerCase()}`]=Number(t)||0;const o=Object.keys(l).sort((e,t)=>t.length-e.length);for(const e of o){const t=l[e],a=new RegExp(`\\b${e}\\b`,'g');n=n.replace(a,String(t))}n=n.replace(/(\d+(\.\d+)?)%/g,'($1/100)'),n=n.replace(/(\d+)d(\d+)/g,e=>String(this.roll(e)));try{if(/[^0-9+\-*/().\s]/.test(n))return console.warn(`[DiceRoller] Invalid characters in expression: ${n} (Original: ${e})`),0;const t=new Function(`return (${n})`)();return Math.floor(Number(t))}catch(e){return console.error(`[DiceRoller] Error evaluating: ${n}`,e),0}}}},502(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,s]of t)a[e]=s;return a}},725(t,a,s){s.d(a,{L:()=>n,storyDB:()=>l});var n,r=s(36);!function(e){e.PRE_STORY_AI='pre_story_ai',e.POST_TOOL_AI='post_tool_ai',e.GENERIC='generic'}(n||(n={}));const l=new class extends e{story;snapshots;save_slots;messageUpdateQueues=new Map;constructor(){super('TavernGameStoryDB'),this.version(3).stores({story:'++id, timestamp, role',snapshots:'++id, timestamp',save_slots:'slotId, timestamp'}),this.version(4).stores({story:'++id, timestamp, role',snapshots:'++id, timestamp',save_slots:'slotId, timestamp'}),this.version(5).stores({story:'++id, timestamp, role',snapshots:'++id, timestamp, type',save_slots:'slotId, timestamp'}),this.version(6).stores({story:'++id, timestamp, role',snapshots:'++id, timestamp, type',save_slots:'slotId, timestamp'}).upgrade(e=>e.table('save_slots').toCollection().modify(e=>{e.storyRecords||(e.storyRecords=[])})),this.version(7).stores({story:'++id, timestamp, role',snapshots:'++id, version, timestamp, baseVersion',save_slots:'slotId, timestamp'}).upgrade(async e=>{const t=await e.table('snapshots').toArray();for(let a=0;a<t.length;a++){const s=t[a];s.version||(s.version=a+1),s.storyRecords||(s.storyRecords=[]),await e.table('snapshots').put(s)}}),this.version(8).stores({story:'++id, timestamp, role',snapshots:'++id, version, timestamp, baseVersion',save_slots:'slotId, timestamp'}).upgrade(e=>e.table('save_slots').toCollection().modify(e=>{e.snapshots||(e.snapshots=[])}))}async addRecord(e){return await this.story.add(e)}async addRecordWithSnapshot(e,t,a,s=n.GENERIC){const r=await this.saveSnapshot(t,a,s);return{storyId:await this.story.add({...e,snapshotId:r}),snapshotId:r}}async deleteRecordAndGetRestorePoint(e){if(!await this.story.get(e))return;const t=await this.story.where('id').below(e).reverse().first();return await this.deleteRecordsFromId(e),t?.snapshotId}async getSnapshotById(e){return await this.snapshots.get(e)}async updateRecord(e,t){const a=(this.messageUpdateQueues.get(e)||Promise.resolve()).then(async()=>{await this.story.update(e,t)});return this.messageUpdateQueues.set(e,a),await a,this.messageUpdateQueues.get(e)===a&&this.messageUpdateQueues.delete(e),e}async deleteRecordsFromId(e){await this.story.where('id').aboveOrEqual(e).delete()}async getSnapshotBefore(e){return await this.snapshots.where('timestamp').below(e).reverse().first()}async getRecentContext(e=5){return(await this.story.orderBy('id').reverse().limit(e).toArray()).reverse()}async getLatestSummary(){const e=await this.story.orderBy('id').reverse().filter(e=>'assistant'===e.role).limit(10).toArray();for(const t of e){const e=r.e.extractTag(t.content,'summary');if(e)return e}}static extractSummary(e){if('assistant'===e.role)return r.e.extractTag(e.content,'summary')}static extractContent(e){return'assistant'===e.role&&r.e.extractTag(e.content,'content')||e.content}static extractThinking(e){if('assistant'===e.role)return r.e.extractTag(e.content,'thinking')}static parseAssistantRecord(e){return'assistant'!==e.role?null:r.e.parseStory(e.content)}async saveSnapshot(e,t,a=n.GENERIC,s){const r=await this.getLatestSnapshot(),l=r?r.version+1:1,o=await this.story.toArray(),i=await this.snapshots.add({version:l,baseVersion:s,timestamp:Date.now(),gameState:JSON.parse(JSON.stringify(e)),storyRecords:JSON.parse(JSON.stringify(o)),description:t,type:a});return await this.cleanupRedundantSnapshots(),i}async updateCurrentSnapshot(e,t){const a=await this.getLatestSnapshot();if(!a||!a.id)return;const s=await this.story.toArray(),n={storyRecords:JSON.parse(JSON.stringify(s)),timestamp:Date.now()};e&&(n.gameState=JSON.parse(JSON.stringify(e))),t&&(n.description=t),await this.snapshots.update(a.id,n)}async getSnapshotByVersion(e){return await this.snapshots.where('version').equals(e).first()}async getSnapshotByType(e,t){const a=this.snapshots.where('type').equals(e);if(t){return(await a.toArray()).filter(e=>e.timestamp<t).sort((e,t)=>t.timestamp-e.timestamp)[0]}return await a.reverse().first()}async getLastAssistantMessage(){return await this.story.where('role').equals('assistant').reverse().first()}hasOptimizedContent(e){return/<optimized>[\s\S]*?<\/optimized>/i.test(e.content)}extractOptimizedContent(e){const t=e.content.match(/<optimized>([\s\S]*?)<\/optimized>/i);return t?t[1].trim():null}async applyOptimization(e){const t=await this.story.get(e);if(!t)return;const a=this.extractOptimizedContent(t);if(!a)return;const s=t.content.replace(/<content>[\s\S]*?<\/content>/i,`<content>${a}</content>`).replace(/<optimized>[\s\S]*?<\/optimized>/i,'');await this.updateRecord(e,{content:s})}async cleanupRedundantSnapshots(){try{const e=await this.snapshots.orderBy('version').reverse().toArray(),t=60;if(e.length<=t)return;const a=e.slice(t);if(a.length>0){const e=a.map(e=>e.id).filter(e=>void 0!==e);await this.snapshots.bulkDelete(e),console.log(`[StoryDB] Cleaned up ${e.length} old snapshots (kept latest ${t} versions)`)}}catch(e){console.error('[StoryDB] Failed to cleanup redundant snapshots:',e)}}async getLatestSnapshot(){return await this.snapshots.orderBy('id').reverse().first()}async getPreviousSnapshot(e=1){return(await this.snapshots.orderBy('id').reverse().limit(e+1).toArray())[e]}async deleteSnapshotsAfter(e){await this.snapshots.where('timestamp').aboveOrEqual(e).delete()}async clearAll(){await this.story.clear(),await this.snapshots.clear()}async clearActiveSession(){await this.story.clear(),await this.snapshots.clear()}async saveToSlot(e,t,a,s=0){const n=JSON.parse(JSON.stringify(t)),r=await this.story.toArray(),l=await this.snapshots.toArray();return await this.save_slots.put({slotId:e,timestamp:Date.now(),label:a,gameState:n,storyRecords:r,snapshots:l,playtime:s})}async getSaveSlot(e){return await this.save_slots.get(e)}async getAllSlots(){return await this.save_slots.orderBy('slotId').toArray()}async deleteSlot(e){await this.save_slots.delete(e)}async renameSlot(e,t){await this.save_slots.update(e,{label:t})}async applyRegexPermanent(e,t,a,n,r){let l=null;try{const{serviceLocator:e}=await Promise.resolve().then(s.bind(s,173));l=e.get('RegexService')}catch{}const o=[...await this.story.toArray()].sort((e,t)=>t.timestamp-e.timestamp),i=new RegExp(e,a);let c=0,d=0;const u=l?l.processMacros(t):t;for(let e=0;e<o.length;e++){const t=o[e];if(e<n)continue;if(-1!==r&&e>r)continue;const a=t.content.match(i);if(a&&a.length>0){const e=t.content.replace(i,(...e)=>{let t=u;for(let a=1;a<e.length-2;a++)t=t.replace(new RegExp(`\\$${a}`,'g'),e[a]||'');return t});e!==t.content&&t.id&&(await this.updateRecord(t.id,{content:e}),c+=a.length,d++)}}if(d>0){const e=await this.snapshots.toArray();for(const t of e){if(!t.id||!t.storyRecords)continue;let e=!1;const a=t.storyRecords.map(t=>{const a=o.findIndex(e=>e.id===t.id);if(-1===a)return t;if(a<n)return t;if(-1!==r&&a>r)return t;const s=t.content.match(i);if(s&&s.length>0){const a=t.content.replace(i,(...e)=>{let t=u;for(let a=1;a<e.length-2;a++)t=t.replace(new RegExp(`\\$${a}`,'g'),e[a]||'');return t});if(a!==t.content)return e=!0,{...t,content:a}}return t});e&&await this.snapshots.update(t.id,{storyRecords:a})}}return{totalMatches:c,modifiedCount:d}}}}},r={};function l(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return n[e](a,a.exports,l),a.exports}function o(e){const t=Object.create(null);for(const a of e.split(','))t[a]=1;return e=>e in t}l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const i={},c=[],d=()=>{},u=()=>!1,p=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),m=e=>e.startsWith('onUpdate:'),g=Object.assign,h=(e,t)=>{const a=e.indexOf(t);a>-1&&e.splice(a,1)},f=Object.prototype.hasOwnProperty,v=(e,t)=>f.call(e,t),y=Array.isArray,b=e=>'[object Map]'===M(e),x=e=>'[object Set]'===M(e),w=e=>'[object Date]'===M(e),k=e=>'function'==typeof e,S=e=>'string'==typeof e,C=e=>'symbol'==typeof e,I=e=>null!==e&&'object'==typeof e,T=e=>(I(e)||k(e))&&k(e.then)&&k(e.catch),A=Object.prototype.toString,M=e=>A.call(e),E=e=>'[object Object]'===M(e),D=e=>S(e)&&'NaN'!==e&&'-'!==e[0]&&''+parseInt(e,10)===e,P=o(',key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted'),N=e=>{const t=Object.create(null);return a=>t[a]||(t[a]=e(a))},R=/-\w/g,j=N(e=>e.replace(R,e=>e.slice(1).toUpperCase())),L=/\B([A-Z])/g,B=N(e=>e.replace(L,'-$1').toLowerCase()),O=N(e=>e.charAt(0).toUpperCase()+e.slice(1)),q=N(e=>e?`on${O(e)}`:''),U=(e,t)=>!Object.is(e,t),V=(e,...t)=>{for(let a=0;a<e.length;a++)e[a](...t)},F=(e,t,a,s=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:s,value:a})},H=e=>{const t=parseFloat(e);return isNaN(t)?e:t},G=e=>{const t=S(e)?Number(e):NaN;return isNaN(t)?e:t};let W;const Q=()=>W||(W='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self?self:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:{});function X(e){if(y(e)){const t={};for(let a=0;a<e.length;a++){const s=e[a],n=S(s)?Z(s):X(s);if(n)for(const e in n)t[e]=n[e]}return t}if(S(e)||I(e))return e}const Y=/;(?![^(]*\))/g,K=/:([^]+)/,J=/\/\*[^]*?\*\//g;function Z(e){const t={};return e.replace(J,'').split(Y).forEach(e=>{if(e){const a=e.split(K);a.length>1&&(t[a[0].trim()]=a[1].trim())}}),t}function ee(e){let t='';if(S(e))t=e;else if(y(e))for(let a=0;a<e.length;a++){const s=ee(e[a]);s&&(t+=s+' ')}else if(I(e))for(const a in e)e[a]&&(t+=a+' ');return t.trim()}const te='itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly',ae=o(te);function se(e){return!!e||''===e}function ne(e,t){if(e===t)return!0;let a=w(e),s=w(t);if(a||s)return!(!a||!s)&&e.getTime()===t.getTime();if(a=C(e),s=C(t),a||s)return e===t;if(a=y(e),s=y(t),a||s)return!(!a||!s)&&function(e,t){if(e.length!==t.length)return!1;let a=!0;for(let s=0;a&&s<e.length;s++)a=ne(e[s],t[s]);return a}(e,t);if(a=I(e),s=I(t),a||s){if(!a||!s)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const a in e){const s=e.hasOwnProperty(a),n=t.hasOwnProperty(a);if(s&&!n||!s&&n||!ne(e[a],t[a]))return!1}}return String(e)===String(t)}function re(e,t){return e.findIndex(e=>ne(e,t))}const le=e=>!(!e||!0!==e.__v_isRef),oe=e=>S(e)?e:null==e?'':y(e)||I(e)&&(e.toString===A||!k(e.toString))?le(e)?oe(e.value):JSON.stringify(e,ie,2):String(e),ie=(e,t)=>le(t)?ie(e,t.value):b(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,a],s)=>(e[ce(t,s)+' =>']=a,e),{})}:x(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>ce(e))}:C(t)?ce(t):!I(t)||y(t)||E(t)?t:String(t),ce=(e,t='')=>{var a;return C(e)?`Symbol(${null!=(a=e.description)?a:t})`:e};let de,ue;class pe{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=de,!e&&de&&(this.index=(de.scopes||(de.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,t;if(this._isPaused=!0,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,t;if(this._isPaused=!1,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=de;try{return de=this,e()}finally{de=t}}else 0}on(){1===++this._on&&(this.prevScope=de,de=this)}off(){this._on>0&&0===--this._on&&(de=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){let t,a;for(this._active=!1,t=0,a=this.effects.length;t<a;t++)this.effects[t].stop();for(this.effects.length=0,t=0,a=this.cleanups.length;t<a;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,a=this.scopes.length;t<a;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}const me=new WeakSet;class ge{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,de&&de.active&&de.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,me.has(this)&&(me.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||ye(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,$e(this),we(this);const e=ue,t=Te;ue=this,Te=!0;try{return this.fn()}finally{0,ke(this),ue=e,Te=t,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)Ce(e);this.deps=this.depsTail=void 0,$e(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?me.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Se(this)&&this.run()}get dirty(){return Se(this)}}let he,fe,ve=0;function ye(e,t=!1){if(e.flags|=8,t)return e.next=fe,void(fe=e);e.next=he,he=e}function be(){ve++}function xe(){if(--ve>0)return;if(fe){let e=fe;for(fe=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;for(;he;){let t=he;for(he=void 0;t;){const a=t.next;if(t.next=void 0,t.flags&=-9,1&t.flags)try{t.trigger()}catch(t){e||(e=t)}t=a}}if(e)throw e}function we(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function ke(e){let t,a=e.depsTail,s=a;for(;s;){const e=s.prevDep;-1===s.version?(s===a&&(a=e),Ce(s),Ie(s)):t=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=e}e.deps=t,e.depsTail=a}function Se(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(_e(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function _e(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===De)return;if(e.globalVersion=De,!e.isSSR&&128&e.flags&&(!e.deps&&!e._dirty||!Se(e)))return;e.flags|=2;const t=e.dep,a=ue,s=Te;ue=e,Te=!0;try{we(e);const a=e.fn(e._value);(0===t.version||U(a,e._value))&&(e.flags|=128,e._value=a,t.version++)}catch(e){throw t.version++,e}finally{ue=a,Te=s,ke(e),e.flags&=-3}}function Ce(e,t=!1){const{dep:a,prevSub:s,nextSub:n}=e;if(s&&(s.nextSub=n,e.prevSub=void 0),n&&(n.prevSub=s,e.nextSub=void 0),a.subs===e&&(a.subs=s,!s&&a.computed)){a.computed.flags&=-5;for(let e=a.computed.deps;e;e=e.nextDep)Ce(e,!0)}t||--a.sc||!a.map||a.map.delete(a.key)}function Ie(e){const{prevDep:t,nextDep:a}=e;t&&(t.nextDep=a,e.prevDep=void 0),a&&(a.prevDep=t,e.nextDep=void 0)}let Te=!0;const Ae=[];function Me(){Ae.push(Te),Te=!1}function Ee(){const e=Ae.pop();Te=void 0===e||e}function $e(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const e=ue;ue=void 0;try{t()}finally{ue=e}}}let De=0;class Pe{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ne{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!ue||!Te||ue===this.computed)return;let t=this.activeLink;if(void 0===t||t.sub!==ue)t=this.activeLink=new Pe(ue,this),ue.deps?(t.prevDep=ue.depsTail,ue.depsTail.nextDep=t,ue.depsTail=t):ue.deps=ue.depsTail=t,Re(t);else if(-1===t.version&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=ue.depsTail,t.nextDep=void 0,ue.depsTail.nextDep=t,ue.depsTail=t,ue.deps===t&&(ue.deps=e)}return t}trigger(e){this.version++,De++,this.notify(e)}notify(e){be();try{0;for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{xe()}}}function Re(e){if(e.dep.sc++,4&e.sub.flags){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let e=t.deps;e;e=e.nextDep)Re(e)}const a=e.dep.subs;a!==e&&(e.prevSub=a,a&&(a.nextSub=e)),e.dep.subs=e}}const je=new WeakMap,Le=Symbol(''),Be=Symbol(''),Oe=Symbol('');function qe(e,t,a){if(Te&&ue){let t=je.get(e);t||je.set(e,t=new Map);let s=t.get(a);s||(t.set(a,s=new Ne),s.map=t,s.key=a),s.track()}}function Ue(e,t,a,s,n,r){const l=je.get(e);if(!l)return void De++;const o=e=>{e&&e.trigger()};if(be(),'clear'===t)l.forEach(o);else{const n=y(e),r=n&&D(a);if(n&&'length'===a){const e=Number(s);l.forEach((t,a)=>{('length'===a||a===Oe||!C(a)&&a>=e)&&o(t)})}else switch((void 0!==a||l.has(void 0))&&o(l.get(a)),r&&o(l.get(Oe)),t){case'add':n?r&&o(l.get('length')):(o(l.get(Le)),b(e)&&o(l.get(Be)));break;case'delete':n||(o(l.get(Le)),b(e)&&o(l.get(Be)));break;case'set':b(e)&&o(l.get(Le))}}xe()}function Ve(e){const t=Tt(e);return t===e?t:(qe(t,0,Oe),Ct(e)?t:t.map(At))}function Fe(e){return qe(e=Tt(e),0,Oe),e}function He(e,t){return _t(e)?St(e)?Mt(At(t)):Mt(t):At(t)}const Ge={__proto__:null,[Symbol.iterator](){return ze(this,Symbol.iterator,e=>He(this,e))},concat(...e){return Ve(this).concat(...e.map(e=>y(e)?Ve(e):e))},entries(){return ze(this,'entries',e=>(e[1]=He(this,e[1]),e))},every(e,t){return Qe(this,'every',e,t,void 0,arguments)},filter(e,t){return Qe(this,'filter',e,t,e=>e.map(e=>He(this,e)),arguments)},find(e,t){return Qe(this,'find',e,t,e=>He(this,e),arguments)},findIndex(e,t){return Qe(this,'findIndex',e,t,void 0,arguments)},findLast(e,t){return Qe(this,'findLast',e,t,e=>He(this,e),arguments)},findLastIndex(e,t){return Qe(this,'findLastIndex',e,t,void 0,arguments)},forEach(e,t){return Qe(this,'forEach',e,t,void 0,arguments)},includes(...e){return Ye(this,'includes',e)},indexOf(...e){return Ye(this,'indexOf',e)},join(e){return Ve(this).join(e)},lastIndexOf(...e){return Ye(this,'lastIndexOf',e)},map(e,t){return Qe(this,'map',e,t,void 0,arguments)},pop(){return Ke(this,'pop')},push(...e){return Ke(this,'push',e)},reduce(e,...t){return Xe(this,'reduce',e,t)},reduceRight(e,...t){return Xe(this,'reduceRight',e,t)},shift(){return Ke(this,'shift')},some(e,t){return Qe(this,'some',e,t,void 0,arguments)},splice(...e){return Ke(this,'splice',e)},toReversed(){return Ve(this).toReversed()},toSorted(e){return Ve(this).toSorted(e)},toSpliced(...e){return Ve(this).toSpliced(...e)},unshift(...e){return Ke(this,'unshift',e)},values(){return ze(this,'values',e=>He(this,e))}};function ze(e,t,a){const s=Fe(e),n=s[t]();return s===e||Ct(e)||(n._next=n.next,n.next=()=>{const e=n._next();return e.done||(e.value=a(e.value)),e}),n}const We=Array.prototype;function Qe(e,t,a,s,n,r){const l=Fe(e),o=l!==e&&!Ct(e),i=l[t];if(i!==We[t]){const t=i.apply(e,r);return o?At(t):t}let c=a;l!==e&&(o?c=function(t,s){return a.call(this,He(e,t),s,e)}:a.length>2&&(c=function(t,s){return a.call(this,t,s,e)}));const d=i.call(l,c,s);return o&&n?n(d):d}function Xe(e,t,a,s){const n=Fe(e);let r=a;return n!==e&&(Ct(e)?a.length>3&&(r=function(t,s,n){return a.call(this,t,s,n,e)}):r=function(t,s,n){return a.call(this,t,He(e,s),n,e)}),n[t](r,...s)}function Ye(e,t,a){const s=Tt(e);qe(s,0,Oe);const n=s[t](...a);return-1!==n&&!1!==n||!It(a[0])?n:(a[0]=Tt(a[0]),s[t](...a))}function Ke(e,t,a=[]){Me(),be();const s=Tt(e)[t].apply(e,a);return xe(),Ee(),s}const Je=o('__proto__,__v_isRef,__isVue'),Ze=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>'arguments'!==e&&'caller'!==e).map(e=>Symbol[e]).filter(C));function et(e){C(e)||(e=String(e));const t=Tt(this);return qe(t,0,e),t.hasOwnProperty(e)}class tt{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,a){if('__v_skip'===t)return e.__v_skip;const s=this._isReadonly,n=this._isShallow;if('__v_isReactive'===t)return!s;if('__v_isReadonly'===t)return s;if('__v_isShallow'===t)return n;if('__v_raw'===t)return a===(s?n?yt:vt:n?ft:ht).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(a)?e:void 0;const r=y(e);if(!s){let e;if(r&&(e=Ge[t]))return e;if('hasOwnProperty'===t)return et}const l=Reflect.get(e,t,Et(e)?e:a);if(C(t)?Ze.has(t):Je(t))return l;if(s||qe(e,0,t),n)return l;if(Et(l)){const e=r&&D(t)?l:l.value;return s&&I(e)?wt(e):e}return I(l)?s?wt(l):xt(l):l}}class at extends tt{constructor(e=!1){super(!1,e)}set(e,t,a,s){let n=e[t];const r=y(e)&&D(t);if(!this._isShallow){const e=_t(n);if(Ct(a)||_t(a)||(n=Tt(n),a=Tt(a)),!r&&Et(n)&&!Et(a))return e||(n.value=a),!0}const l=r?Number(t)<e.length:v(e,t),o=Reflect.set(e,t,a,Et(e)?e:s);return e===Tt(s)&&(l?U(a,n)&&Ue(e,'set',t,a):Ue(e,'add',t,a)),o}deleteProperty(e,t){const a=v(e,t),s=(e[t],Reflect.deleteProperty(e,t));return s&&a&&Ue(e,'delete',t,void 0),s}has(e,t){const a=Reflect.has(e,t);return C(t)&&Ze.has(t)||qe(e,0,t),a}ownKeys(e){return qe(e,0,y(e)?'length':Le),Reflect.ownKeys(e)}}class st extends tt{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const nt=new at,rt=new st,lt=new at(!0),ot=e=>e,it=e=>Reflect.getPrototypeOf(e);function ct(e){return function(...t){return'delete'!==e&&('clear'===e?void 0:this)}}function dt(e,t){const a={get(a){const s=this.__v_raw,n=Tt(s),r=Tt(a);e||(U(a,r)&&qe(n,0,a),qe(n,0,r));const{has:l}=it(n),o=t?ot:e?Mt:At;return l.call(n,a)?o(s.get(a)):l.call(n,r)?o(s.get(r)):void(s!==n&&s.get(a))},get size(){const t=this.__v_raw;return!e&&qe(Tt(t),0,Le),t.size},has(t){const a=this.__v_raw,s=Tt(a),n=Tt(t);return e||(U(t,n)&&qe(s,0,t),qe(s,0,n)),t===n?a.has(t):a.has(t)||a.has(n)},forEach(a,s){const n=this,r=n.__v_raw,l=Tt(r),o=t?ot:e?Mt:At;return!e&&qe(l,0,Le),r.forEach((e,t)=>a.call(s,o(e),o(t),n))}};g(a,e?{add:ct('add'),set:ct('set'),delete:ct('delete'),clear:ct('clear')}:{add(e){t||Ct(e)||_t(e)||(e=Tt(e));const a=Tt(this);return it(a).has.call(a,e)||(a.add(e),Ue(a,'add',e,e)),this},set(e,a){t||Ct(a)||_t(a)||(a=Tt(a));const s=Tt(this),{has:n,get:r}=it(s);let l=n.call(s,e);l||(e=Tt(e),l=n.call(s,e));const o=r.call(s,e);return s.set(e,a),l?U(a,o)&&Ue(s,'set',e,a):Ue(s,'add',e,a),this},delete(e){const t=Tt(this),{has:a,get:s}=it(t);let n=a.call(t,e);n||(e=Tt(e),n=a.call(t,e));s&&s.call(t,e);const r=t.delete(e);return n&&Ue(t,'delete',e,void 0),r},clear(){const e=Tt(this),t=0!==e.size,a=e.clear();return t&&Ue(e,'clear',void 0,void 0),a}});return['keys','values','entries',Symbol.iterator].forEach(s=>{a[s]=function(e,t,a){return function(...s){const n=this.__v_raw,r=Tt(n),l=b(r),o='entries'===e||e===Symbol.iterator&&l,i='keys'===e&&l,c=n[e](...s),d=a?ot:t?Mt:At;return!t&&qe(r,0,i?Be:Le),{next(){const{value:e,done:t}=c.next();return t?{value:e,done:t}:{value:o?[d(e[0]),d(e[1])]:d(e),done:t}},[Symbol.iterator](){return this}}}}(s,e,t)}),a}function ut(e,t){const a=dt(e,t);return(t,s,n)=>'__v_isReactive'===s?!e:'__v_isReadonly'===s?e:'__v_raw'===s?t:Reflect.get(v(a,s)&&s in t?a:t,s,n)}const pt={get:ut(!1,!1)},mt={get:ut(!1,!0)},gt={get:ut(!0,!1)};const ht=new WeakMap,ft=new WeakMap,vt=new WeakMap,yt=new WeakMap;function bt(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case'Object':case'Array':return 1;case'Map':case'Set':case'WeakMap':case'WeakSet':return 2;default:return 0}}((e=>M(e).slice(8,-1))(e))}function xt(e){return _t(e)?e:kt(e,!1,nt,pt,ht)}function wt(e){return kt(e,!0,rt,gt,vt)}function kt(e,t,a,s,n){if(!I(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const r=bt(e);if(0===r)return e;const l=n.get(e);if(l)return l;const o=new Proxy(e,2===r?s:a);return n.set(e,o),o}function St(e){return _t(e)?St(e.__v_raw):!(!e||!e.__v_isReactive)}function _t(e){return!(!e||!e.__v_isReadonly)}function Ct(e){return!(!e||!e.__v_isShallow)}function It(e){return!!e&&!!e.__v_raw}function Tt(e){const t=e&&e.__v_raw;return t?Tt(t):e}const At=e=>I(e)?xt(e):e,Mt=e=>I(e)?wt(e):e;function Et(e){return!!e&&!0===e.__v_isRef}function $t(e){return Dt(e,!1)}function Dt(e,t){return Et(e)?e:new Pt(e,t)}class Pt{constructor(e,t){this.dep=new Ne,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Tt(e),this._value=t?e:At(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,a=this.__v_isShallow||Ct(e)||_t(e);e=a?e:Tt(e),U(e,t)&&(this._rawValue=e,this._value=a?e:At(e),this.dep.trigger())}}function Nt(e){return Et(e)?e.value:e}const Rt={get:(e,t,a)=>'__v_raw'===t?e:Nt(Reflect.get(e,t,a)),set:(e,t,a,s)=>{const n=e[t];return Et(n)&&!Et(a)?(n.value=a,!0):Reflect.set(e,t,a,s)}};function jt(e){return St(e)?e:new Proxy(e,Rt)}class Lt{constructor(e,t,a){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Ne(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=De-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=a}notify(){if(this.flags|=16,!(8&this.flags||ue===this))return ye(this,!0),!0}get value(){const e=this.dep.track();return _e(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}const Bt={},Ot=new WeakMap;let qt;function Ut(e,t,a=i){const{immediate:s,deep:n,once:r,scheduler:l,augmentJob:o,call:c}=a,u=e=>n?e:Ct(e)||!1===n||0===n?Vt(e,1):Vt(e);let p,m,g,f,v=!1,b=!1;if(Et(e)?(m=()=>e.value,v=Ct(e)):St(e)?(m=()=>u(e),v=!0):y(e)?(b=!0,v=e.some(e=>St(e)||Ct(e)),m=()=>e.map(e=>Et(e)?e.value:St(e)?u(e):k(e)?c?c(e,2):e():void 0)):m=k(e)?t?c?()=>c(e,2):e:()=>{if(g){Me();try{g()}finally{Ee()}}const t=qt;qt=p;try{return c?c(e,3,[f]):e(f)}finally{qt=t}}:d,t&&n){const e=m,t=!0===n?1/0:n;m=()=>Vt(e(),t)}const x=de,w=()=>{p.stop(),x&&x.active&&h(x.effects,p)};if(r&&t){const e=t;t=(...t)=>{e(...t),w()}}let S=b?new Array(e.length).fill(Bt):Bt;const C=e=>{if(1&p.flags&&(p.dirty||e))if(t){const e=p.run();if(n||v||(b?e.some((e,t)=>U(e,S[t])):U(e,S))){g&&g();const a=qt;qt=p;try{const a=[e,S===Bt?void 0:b&&S[0]===Bt?[]:S,f];S=e,c?c(t,3,a):t(...a)}finally{qt=a}}}else p.run()};return o&&o(C),p=new ge(m),p.scheduler=l?()=>l(C,!1):C,f=e=>function(e,t=!1,a=qt){if(a){let t=Ot.get(a);t||Ot.set(a,t=[]),t.push(e)}}(e,!1,p),g=p.onStop=()=>{const e=Ot.get(p);if(e){if(c)c(e,4);else for(const t of e)t();Ot.delete(p)}},t?s?C(!0):S=p.run():l?l(C.bind(null,!0),!0):p.run(),w.pause=p.pause.bind(p),w.resume=p.resume.bind(p),w.stop=w,w}function Vt(e,t=1/0,a){if(t<=0||!I(e)||e.__v_skip)return e;if(((a=a||new Map).get(e)||0)>=t)return e;if(a.set(e,t),t--,Et(e))Vt(e.value,t,a);else if(y(e))for(let s=0;s<e.length;s++)Vt(e[s],t,a);else if(x(e)||b(e))e.forEach(e=>{Vt(e,t,a)});else if(E(e)){for(const s in e)Vt(e[s],t,a);for(const s of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,s)&&Vt(e[s],t,a)}return e}function Ft(e,t,a,s){try{return s?e(...s):e()}catch(e){Gt(e,t,a)}}function Ht(e,t,a,s){if(k(e)){const n=Ft(e,t,a,s);return n&&T(n)&&n.catch(e=>{Gt(e,t,a)}),n}if(y(e)){const n=[];for(let r=0;r<e.length;r++)n.push(Ht(e[r],t,a,s));return n}}function Gt(e,t,a,s=!0){t&&t.vnode;const{errorHandler:n,throwUnhandledErrorInProduction:r}=t&&t.appContext.config||i;if(t){let s=t.parent;const r=t.proxy,l=`https://vuejs.org/error-reference/#runtime-${a}`;for(;s;){const t=s.ec;if(t)for(let a=0;a<t.length;a++)if(!1===t[a](e,r,l))return;s=s.parent}if(n)return Me(),Ft(n,null,10,[e,r,l]),void Ee()}!function(e,t,a,s=!0,n=!1){if(n)throw e;console.error(e)}(e,0,0,s,r)}const zt=[];let Wt=-1;const Qt=[];let Xt=null,Yt=0;const Kt=Promise.resolve();let Jt=null;function Zt(e){const t=Jt||Kt;return e?t.then(this?e.bind(this):e):t}function ea(e){if(!(1&e.flags)){const t=ra(e),a=zt[zt.length-1];!a||!(2&e.flags)&&t>=ra(a)?zt.push(e):zt.splice(function(e){let t=Wt+1,a=zt.length;for(;t<a;){const s=t+a>>>1,n=zt[s],r=ra(n);r<e||r===e&&2&n.flags?t=s+1:a=s}return t}(t),0,e),e.flags|=1,ta()}}function ta(){Jt||(Jt=Kt.then(la))}function aa(e){y(e)?Qt.push(...e):Xt&&-1===e.id?Xt.splice(Yt+1,0,e):1&e.flags||(Qt.push(e),e.flags|=1),ta()}function sa(e,t,a=Wt+1){for(0;a<zt.length;a++){const t=zt[a];if(t&&2&t.flags){if(e&&t.id!==e.uid)continue;0,zt.splice(a,1),a--,4&t.flags&&(t.flags&=-2),t(),4&t.flags||(t.flags&=-2)}}}function na(e){if(Qt.length){const e=[...new Set(Qt)].sort((e,t)=>ra(e)-ra(t));if(Qt.length=0,Xt)return void Xt.push(...e);for(Xt=e,Yt=0;Yt<Xt.length;Yt++){const e=Xt[Yt];0,4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}Xt=null,Yt=0}}const ra=e=>null==e.id?2&e.flags?-1:1/0:e.id;function la(e){try{for(Wt=0;Wt<zt.length;Wt++){const e=zt[Wt];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),Ft(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;Wt<zt.length;Wt++){const e=zt[Wt];e&&(e.flags&=-2)}Wt=-1,zt.length=0,na(),Jt=null,(zt.length||Qt.length)&&la(e)}}let oa,ia=[],ca=!1;function da(e,...t){oa?oa.emit(e,...t):ca||ia.push({event:e,args:t})}function ua(e,t){var a,s;if(oa=e,oa)oa.enabled=!0,ia.forEach(({event:e,args:t})=>oa.emit(e,...t)),ia=[];else if('undefined'!=typeof window&&window.HTMLElement&&!(null==(s=null==(a=window.navigator)?void 0:a.userAgent)?void 0:s.includes('jsdom'))){(t.__VUE_DEVTOOLS_HOOK_REPLAY__=t.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(e=>{ua(e,t)}),setTimeout(()=>{oa||(t.__VUE_DEVTOOLS_HOOK_REPLAY__=null,ca=!0,ia=[])},3e3)}else ca=!0,ia=[]}const pa=ha('component:added'),ma=ha('component:updated'),ga=ha('component:removed');function ha(e){return t=>{da(e,t.appContext.app,t.uid,t.parent?t.parent.uid:void 0,t)}}let fa=null,va=null;function ya(e){const t=fa;return fa=e,va=e&&e.type.__scopeId||null,t}function ba(e,t=fa,a){if(!t)return e;if(e._n)return e;const s=(...a)=>{s._d&&wn(-1);const n=ya(t);let r;try{r=e(...a)}finally{ya(n),s._d&&wn(1)}return ma(t),r};return s._n=!0,s._c=!0,s._d=!0,s}function xa(e,t){if(null===fa)return e;const a=rr(fa),s=e.dirs||(e.dirs=[]);for(let e=0;e<t.length;e++){let[n,r,l,o=i]=t[e];n&&(k(n)&&(n={mounted:n,updated:n}),n.deep&&Vt(r),s.push({dir:n,instance:a,value:r,oldValue:void 0,arg:l,modifiers:o}))}return e}function wa(e,t,a,s){const n=e.dirs,r=t&&t.dirs;for(let l=0;l<n.length;l++){const o=n[l];r&&(o.oldValue=r[l].value);let i=o.dir[s];i&&(Me(),Ht(i,a,8,[e.el,o,e,t]),Ee())}}function ka(e,t,a=!1){const s=Gn();if(s||Es){let n=Es?Es._context.provides:s?null==s.parent||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(n&&e in n)return n[e];if(arguments.length>1)return a&&k(t)?t.call(s&&s.proxy):t}else 0}const Sa=Symbol.for('v-scx');function _a(e,t,a){return Ca(e,t,a)}function Ca(e,t,a=i){const{immediate:s,deep:n,flush:r,once:l}=a;const o=g({},a);const c=t&&s||!t&&'post'!==r;let u;if(Zn)if('sync'===r){const e=ka(Sa);u=e.__watcherHandles||(e.__watcherHandles=[])}else if(!c){const e=()=>{};return e.stop=d,e.resume=d,e.pause=d,e}const p=Hn;o.call=(e,t,a)=>Ht(e,p,t,a);let m=!1;'post'===r?o.scheduler=e=>{en(e,p&&p.suspense)}:'sync'!==r&&(m=!0,o.scheduler=(e,t)=>{t?e():ea(e)}),o.augmentJob=e=>{t&&(e.flags|=4),m&&(e.flags|=2,p&&(e.id=p.uid,e.i=p))};const h=Ut(e,t,o);return Zn&&(u?u.push(h):c&&h()),h}const Ia=Symbol('_vte'),Ta=e=>e.__isTeleport,Aa=e=>e&&(e.disabled||''===e.disabled),Ma=e=>e&&(e.defer||''===e.defer),Ea=e=>'undefined'!=typeof SVGElement&&e instanceof SVGElement,$a=e=>'function'==typeof MathMLElement&&e instanceof MathMLElement,Da=(e,t)=>{const a=e&&e.to;if(S(a)){if(t){return t(a)}return null}return a},Pa={name:'Teleport',__isTeleport:!0,process(e,t,a,s,n,r,l,o,i,c){const{mc:d,pc:u,pbc:p,o:{insert:m,querySelector:g,createText:h,createComment:f}}=c,v=Aa(t.props);let{shapeFlag:y,children:b,dynamicChildren:x}=t;if(null==e){const e=t.el=h(''),c=t.anchor=h('');m(e,a,s),m(c,a,s);const u=(e,t)=>{16&y&&d(b,e,t,n,r,l,o,i)},p=()=>{const e=t.target=Da(t.props,g),a=La(e,t,h,m);e&&('svg'!==l&&Ea(e)?l='svg':'mathml'!==l&&$a(e)&&(l='mathml'),n&&n.isCE&&(n.ce._teleportTargets||(n.ce._teleportTargets=new Set)).add(e),v||(u(e,a),ja(t,!1)))};v&&(u(a,c),ja(t,!0)),Ma(t.props)?(t.el.__isMounted=!1,en(()=>{p(),delete t.el.__isMounted},r)):p()}else{if(Ma(t.props)&&!1===e.el.__isMounted)return void en(()=>{Pa.process(e,t,a,s,n,r,l,o,i,c)},r);t.el=e.el,t.targetStart=e.targetStart;const d=t.anchor=e.anchor,m=t.target=e.target,h=t.targetAnchor=e.targetAnchor,f=Aa(e.props),y=f?a:m,b=f?d:h;if('svg'===l||Ea(m)?l='svg':('mathml'===l||$a(m))&&(l='mathml'),x?(p(e.dynamicChildren,x,y,n,r,l,o),rn(e,t,!0)):i||u(e,t,y,b,n,r,l,o,!1),v)f?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):Na(t,a,d,c,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const e=t.target=Da(t.props,g);e&&Na(t,e,null,c,0)}else f&&Na(t,m,h,c,1);ja(t,v)}},remove(e,t,a,{um:s,o:{remove:n}},r){const{shapeFlag:l,children:o,anchor:i,targetStart:c,targetAnchor:d,target:u,props:p}=e;if(u&&(n(c),n(d)),r&&n(i),16&l){const e=r||!Aa(p);for(let n=0;n<o.length;n++){const r=o[n];s(r,t,a,e,!!r.dynamicChildren)}}},move:Na,hydrate:function(e,t,a,s,n,r,{o:{nextSibling:l,parentNode:o,querySelector:i,insert:c,createText:d}},u){function p(e,t,i,c){t.anchor=u(l(e),t,o(e),a,s,n,r),t.targetStart=i,t.targetAnchor=c}const m=t.target=Da(t.props,i),g=Aa(t.props);if(m){const o=m._lpa||m.firstChild;if(16&t.shapeFlag)if(g)p(e,t,o,o&&l(o));else{t.anchor=l(e);let i=o;for(;i;){if(i&&8===i.nodeType)if('teleport start anchor'===i.data)t.targetStart=i;else if('teleport anchor'===i.data){t.targetAnchor=i,m._lpa=t.targetAnchor&&l(t.targetAnchor);break}i=l(i)}t.targetAnchor||La(m,t,d,c),u(o&&l(o),t,m,a,s,n,r)}ja(t,g)}else g&&16&t.shapeFlag&&p(e,t,e,l(e));return t.anchor&&l(t.anchor)}};function Na(e,t,a,{o:{insert:s},m:n},r=2){0===r&&s(e.targetAnchor,t,a);const{el:l,anchor:o,shapeFlag:i,children:c,props:d}=e,u=2===r;if(u&&s(l,t,a),(!u||Aa(d))&&16&i)for(let e=0;e<c.length;e++)n(c[e],t,a,2);u&&s(o,t,a)}const Ra=Pa;function ja(e,t){const a=e.ctx;if(a&&a.ut){let s,n;for(t?(s=e.el,n=e.anchor):(s=e.targetStart,n=e.targetAnchor);s&&s!==n;)1===s.nodeType&&s.setAttribute('data-v-owner',a.uid),s=s.nextSibling;a.ut()}}function La(e,t,a,s){const n=t.targetStart=a(''),r=t.targetAnchor=a('');return n[Ia]=r,e&&(s(n,e),s(r,e)),r}const Ba=Symbol('_leaveCb'),Oa=Symbol('_enterCb');function qa(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return us(()=>{e.isMounted=!0}),ms(()=>{e.isUnmounting=!0}),e}const Ua=[Function,Array],Va={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ua,onEnter:Ua,onAfterEnter:Ua,onEnterCancelled:Ua,onBeforeLeave:Ua,onLeave:Ua,onAfterLeave:Ua,onLeaveCancelled:Ua,onBeforeAppear:Ua,onAppear:Ua,onAfterAppear:Ua,onAppearCancelled:Ua},Fa=e=>{const t=e.subTree;return t.component?Fa(t.component):t},Ha={name:'BaseTransition',props:Va,setup(e,{slots:t}){const a=Gn(),s=qa();return()=>{const n=t.default&&Ja(t.default(),!0);if(!n||!n.length)return;const r=Ga(n),l=Tt(e),{mode:o}=l;if(s.isLeaving)return Xa(r);const i=Ya(r);if(!i)return Xa(r);let c=Qa(i,l,s,a,e=>c=e);i.type!==gn&&Ka(i,c);let d=a.subTree&&Ya(a.subTree);if(d&&d.type!==gn&&!In(d,i)&&Fa(a).type!==gn){let e=Qa(d,l,s,a);if(Ka(d,e),'out-in'===o&&i.type!==gn)return s.isLeaving=!0,e.afterLeave=()=>{s.isLeaving=!1,8&a.job.flags||a.update(),delete e.afterLeave,d=void 0},Xa(r);'in-out'===o&&i.type!==gn?e.delayLeave=(e,t,a)=>{Wa(s,d)[String(d.key)]=d,e[Ba]=()=>{t(),e[Ba]=void 0,delete c.delayedLeave,d=void 0},c.delayedLeave=()=>{a(),delete c.delayedLeave,d=void 0}}:d=void 0}else d&&(d=void 0);return r}}};function Ga(e){let t=e[0];if(e.length>1){let a=!1;for(const s of e)if(s.type!==gn){0,t=s,a=!0;break}}return t}const za=Ha;function Wa(e,t){const{leavingVNodes:a}=e;let s=a.get(t.type);return s||(s=Object.create(null),a.set(t.type,s)),s}function Qa(e,t,a,s,n){const{appear:r,mode:l,persisted:o=!1,onBeforeEnter:i,onEnter:c,onAfterEnter:d,onEnterCancelled:u,onBeforeLeave:p,onLeave:m,onAfterLeave:g,onLeaveCancelled:h,onBeforeAppear:f,onAppear:v,onAfterAppear:b,onAppearCancelled:x}=t,w=String(e.key),k=Wa(a,e),S=(e,t)=>{e&&Ht(e,s,9,t)},C=(e,t)=>{const a=t[1];S(e,t),y(e)?e.every(e=>e.length<=1)&&a():e.length<=1&&a()},I={mode:l,persisted:o,beforeEnter(t){let s=i;if(!a.isMounted){if(!r)return;s=f||i}t[Ba]&&t[Ba](!0);const n=k[w];n&&In(e,n)&&n.el[Ba]&&n.el[Ba](),S(s,[t])},enter(e){let t=c,s=d,n=u;if(!a.isMounted){if(!r)return;t=v||c,s=b||d,n=x||u}let l=!1;const o=e[Oa]=t=>{l||(l=!0,S(t?n:s,[e]),I.delayedLeave&&I.delayedLeave(),e[Oa]=void 0)};t?C(t,[e,o]):o()},leave(t,s){const n=String(e.key);if(t[Oa]&&t[Oa](!0),a.isUnmounting)return s();S(p,[t]);let r=!1;const l=t[Ba]=a=>{r||(r=!0,s(),S(a?h:g,[t]),t[Ba]=void 0,k[n]===e&&delete k[n])};k[n]=e,m?C(m,[t,l]):l()},clone(e){const r=Qa(e,t,a,s,n);return n&&n(r),r}};return I}function Xa(e){if(rs(e))return(e=Dn(e)).children=null,e}function Ya(e){if(!rs(e))return Ta(e.type)&&e.children?Ga(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:a}=e;if(a){if(16&t)return a[0];if(32&t&&k(a.default))return a.default()}}function Ka(e,t){6&e.shapeFlag&&e.component?(e.transition=t,Ka(e.component.subTree,t)):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Ja(e,t=!1,a){let s=[],n=0;for(let r=0;r<e.length;r++){let l=e[r];const o=null==a?l.key:String(a)+String(null!=l.key?l.key:r);l.type===pn?(128&l.patchFlag&&n++,s=s.concat(Ja(l.children,t,o))):(t||l.type!==gn)&&s.push(null!=o?Dn(l,{key:o}):l)}if(n>1)for(let e=0;e<s.length;e++)s[e].patchFlag=-2;return s}function Za(e,t){return k(e)?(()=>g({name:e.name},t,{setup:e}))():e}function es(e){e.ids=[e.ids[0]+e.ids[2]+++'-',0,0]}const ts=new WeakMap;function as(e,t,a,s,n=!1){if(y(e))return void e.forEach((e,r)=>as(e,t&&(y(t)?t[r]:t),a,s,n));if(ns(s)&&!n)return void(512&s.shapeFlag&&s.type.__asyncResolved&&s.component.subTree.component&&as(e,t,a,s.component.subTree));const r=4&s.shapeFlag?rr(s.component):s.el,l=n?null:r,{i:o,r:c}=e;const d=t&&t.r,p=o.refs===i?o.refs={}:o.refs,m=o.setupState,g=Tt(m),f=m===i?u:e=>v(g,e);if(null!=d&&d!==c)if(ss(t),S(d))p[d]=null,f(d)&&(m[d]=null);else if(Et(d)){d.value=null;const e=t;e.k&&(p[e.k]=null)}if(k(c))Ft(c,o,12,[l,p]);else{const t=S(c),s=Et(c);if(t||s){const o=()=>{if(e.f){const a=t?f(c)?m[c]:p[c]:c.value;if(n)y(a)&&h(a,r);else if(y(a))a.includes(r)||a.push(r);else if(t)p[c]=[r],f(c)&&(m[c]=p[c]);else{const t=[r];c.value=t,e.k&&(p[e.k]=t)}}else t?(p[c]=l,f(c)&&(m[c]=l)):s&&(c.value=l,e.k&&(p[e.k]=l))};if(l){const t=()=>{o(),ts.delete(e)};t.id=-1,ts.set(e,t),en(t,a)}else ss(e),o()}else 0}}function ss(e){const t=ts.get(e);t&&(t.flags|=8,ts.delete(e))}Q().requestIdleCallback,Q().cancelIdleCallback;const ns=e=>!!e.type.__asyncLoader;const rs=e=>e.type.__isKeepAlive;RegExp,RegExp;function ls(e,t){return y(e)?e.some(e=>ls(e,t)):S(e)?e.split(',').includes(t):'[object RegExp]'===M(e)&&(e.lastIndex=0,e.test(t))}function os(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function is(e){return 128&e.shapeFlag?e.ssContent:e}function cs(e,t,a=Hn,s=!1){if(a){const n=a[e]||(a[e]=[]),r=t.__weh||(t.__weh=(...s)=>{Me();const n=Qn(a),r=Ht(t,a,e,s);return n(),Ee(),r});return s?n.unshift(r):n.push(r),r}}const ds=e=>(t,a=Hn)=>{Zn&&'sp'!==e||cs(e,(...e)=>t(...e),a)},us=(ds('bm'),ds('m')),ps=(ds('bu'),ds('u')),ms=ds('bum'),gs=ds('um');ds('sp'),ds('rtg'),ds('rtc');const hs='components';function fs(e,t){return ys(hs,e,!0,t)||e}const vs=Symbol.for('v-ndc');function ys(e,t,a=!0,s=!1){const n=fa||Hn;if(n){const a=n.type;if(e===hs){const e=lr(a,!1);if(e&&(e===t||e===j(t)||e===O(j(t))))return a}const r=bs(n[e]||a[e],t)||bs(n.appContext[e],t);return!r&&s?a:r}}function bs(e,t){return e&&(e[t]||e[j(t)]||e[O(j(t))])}function xs(e,t,a,s){let n;const r=a&&a[s],l=y(e);if(l||S(e)){let a=!1,s=!1;l&&St(e)&&(a=!Ct(e),s=_t(e),e=Fe(e)),n=new Array(e.length);for(let l=0,o=e.length;l<o;l++)n[l]=t(a?s?Mt(At(e[l])):At(e[l]):e[l],l,void 0,r&&r[l])}else if('number'==typeof e){0,n=new Array(e);for(let a=0;a<e;a++)n[a]=t(a+1,a,void 0,r&&r[a])}else if(I(e))if(e[Symbol.iterator])n=Array.from(e,(e,a)=>t(e,a,void 0,r&&r[a]));else{const a=Object.keys(e);n=new Array(a.length);for(let s=0,l=a.length;s<l;s++){const l=a[s];n[s]=t(e[l],l,s,r&&r[s])}}else n=[];return a&&(a[s]=n),n}function ws(e,t,a={},s,n){if(fa.ce||fa.parent&&ns(fa.parent)&&fa.parent.ce){const e=Object.keys(a).length>0;return'default'!==t&&(a.name=t),yn(),_n(pn,null,[En('slot',a,s&&s())],e?-2:64)}let r=e[t];r&&r._c&&(r._d=!1),yn();const l=r&&ks(r(a)),o=a.key||l&&l.key,i=_n(pn,{key:(o&&!C(o)?o:`_${t}`)+(!l&&s?'_fb':'')},l||(s?s():[]),l&&1===e._?64:-2);return!n&&i.scopeId&&(i.slotScopeIds=[i.scopeId+'-s']),r&&r._c&&(r._d=!0),i}function ks(e){return e.some(e=>!Cn(e)||e.type!==gn&&!(e.type===pn&&!ks(e.children)))?e:null}const Ss=e=>e?Yn(e)?rr(e):Ss(e.parent):null,_s=g(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ss(e.parent),$root:e=>Ss(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>e.type,$forceUpdate:e=>e.f||(e.f=()=>{ea(e.update)}),$nextTick:e=>e.n||(e.n=Zt.bind(e.proxy)),$watch:e=>d}),Cs=(e,t)=>e!==i&&!e.__isScriptSetup&&v(e,t),Is={get({_:e},t){if('__v_skip'===t)return!0;const{ctx:a,setupState:s,data:n,props:r,accessCache:l,type:o,appContext:c}=e;if('$'!==t[0]){const e=l[t];if(void 0!==e)switch(e){case 1:return s[t];case 2:return n[t];case 4:return a[t];case 3:return r[t]}else{if(Cs(s,t))return l[t]=1,s[t];if(v(r,t))return l[t]=3,r[t];if(a!==i&&v(a,t))return l[t]=4,a[t];l[t]=0}}const d=_s[t];let u,p;return d?('$attrs'===t&&qe(e.attrs,0,''),d(e)):(u=o.__cssModules)&&(u=u[t])?u:a!==i&&v(a,t)?(l[t]=4,a[t]):(p=c.config.globalProperties,v(p,t)?p[t]:void 0)},set({_:e},t,a){const{data:s,setupState:n,ctx:r}=e;return Cs(n,t)?(n[t]=a,!0):!v(e.props,t)&&(('$'!==t[0]||!(t.slice(1)in e))&&(r[t]=a,!0))},has({_:{data:e,setupState:t,accessCache:a,ctx:s,appContext:n,props:r,type:l}},o){let i;return!!(a[o]||Cs(t,o)||v(r,o)||v(s,o)||v(_s,o)||v(n.config.globalProperties,o)||(i=l.__cssModules)&&i[o])},defineProperty(e,t,a){return null!=a.get?e._.accessCache[t]=0:v(a,'value')&&this.set(e,t,a.value,null),Reflect.defineProperty(e,t,a)}};function Ts(){return{app:null,config:{isNativeTag:u,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let As=0;function Ms(e,t){return function(a,s=null){k(a)||(a=g({},a)),null==s||I(s)||(s=null);const n=Ts(),r=new WeakSet,l=[];let o=!1;const i=n.app={_uid:As++,_component:a,_props:s,_container:null,_context:n,_instance:null,version:cr,get config(){return n.config},set config(e){0},use:(e,...t)=>(r.has(e)||(e&&k(e.install)?(r.add(e),e.install(i,...t)):k(e)&&(r.add(e),e(i,...t))),i),mixin:e=>i,component:(e,t)=>t?(n.components[e]=t,i):n.components[e],directive:(e,t)=>t?(n.directives[e]=t,i):n.directives[e],mount(r,l,c){if(!o){0;const d=i._ceVNode||En(a,s);return d.appContext=n,!0===c?c='svg':!1===c&&(c=void 0),l&&t?t(d,r):e(d,r,c),o=!0,i._container=r,r.__vue_app__=i,i._instance=d.component,function(e,t){da('app:init',e,t,{Fragment:pn,Text:mn,Comment:gn,Static:hn})}(i,cr),rr(d.component)}},onUnmount(e){l.push(e)},unmount(){o&&(Ht(l,i._instance,16),e(null,i._container),i._instance=null,function(e){da('app:unmount',e)}(i),delete i._container.__vue_app__)},provide:(e,t)=>(n.provides[e]=t,i),runWithContext(e){const t=Es;Es=i;try{return e()}finally{Es=t}}};return i}}let Es=null;const $s=(e,t)=>'modelValue'===t||'model-value'===t?e.modelModifiers:e[`${t}Modifiers`]||e[`${j(t)}Modifiers`]||e[`${B(t)}Modifiers`];function Ds(e,t,...a){if(e.isUnmounted)return;const s=e.vnode.props||i;let n=a;const r=t.startsWith('update:'),l=r&&$s(s,t.slice(7));let o;l&&(l.trim&&(n=a.map(e=>S(e)?e.trim():e)),l.number&&(n=a.map(H))),function(e,t,a){da('component:emit',e.appContext.app,e,t,a)}(e,t,n);let c=s[o=q(t)]||s[o=q(j(t))];!c&&r&&(c=s[o=q(B(t))]),c&&Ht(c,e,6,n);const d=s[o+'Once'];if(d){if(e.emitted){if(e.emitted[o])return}else e.emitted={};e.emitted[o]=!0,Ht(d,e,6,n)}}function Ps(e,t,a=!1){const s=t.emitsCache,n=s.get(e);if(void 0!==n)return n;const r=e.emits;let l={};return r?(y(r)?r.forEach(e=>l[e]=null):g(l,r),I(e)&&s.set(e,l),l):(I(e)&&s.set(e,null),null)}function Ns(e,t){return!(!e||!p(t))&&(t=t.slice(2).replace(/Once$/,''),v(e,t[0].toLowerCase()+t.slice(1))||v(e,B(t))||v(e,t))}function Rs(e){const{type:t,vnode:a,proxy:s,withProxy:n,propsOptions:[r],slots:l,attrs:o,emit:i,render:c,renderCache:d,props:u,data:p,setupState:g,ctx:h,inheritAttrs:f}=e,v=ya(e);let y,b;try{if(4&a.shapeFlag){const e=n||s,t=e;y=jn(c.call(t,e,d,u,g,p,h)),b=o}else{const e=t;0,y=jn(e.length>1?e(u,{attrs:o,slots:l,emit:i}):e(u,null)),b=t.props?o:js(o)}}catch(t){fn.length=0,Gt(t,e,1),y=En(gn)}let x=y;if(b&&!1!==f){const e=Object.keys(b),{shapeFlag:t}=x;e.length&&7&t&&(r&&e.some(m)&&(b=Ls(b,r)),x=Dn(x,b,!1,!0))}return a.dirs&&(x=Dn(x,null,!1,!0),x.dirs=x.dirs?x.dirs.concat(a.dirs):a.dirs),a.transition&&Ka(x,a.transition),y=x,ya(v),y}const js=e=>{let t;for(const a in e)('class'===a||'style'===a||p(a))&&((t||(t={}))[a]=e[a]);return t},Ls=(e,t)=>{const a={};for(const s in e)m(s)&&s.slice(9)in t||(a[s]=e[s]);return a};function Bs(e,t,a){const s=Object.keys(t);if(s.length!==Object.keys(e).length)return!0;for(let n=0;n<s.length;n++){const r=s[n];if(t[r]!==e[r]&&!Ns(a,r))return!0}return!1}function Os({vnode:e,parent:t},a){for(;t;){const s=t.subTree;if(s.suspense&&s.suspense.activeBranch===e&&(s.el=e.el),s!==e)break;(e=t.vnode).el=a,t=t.parent}}const qs={},Us=()=>Object.create(qs),Vs=e=>Object.getPrototypeOf(e)===qs;function Fs(e,t,a,s=!1){const n={},r=Us();e.propsDefaults=Object.create(null),Hs(e,t,n,r);for(const t in e.propsOptions[0])t in n||(n[t]=void 0);a?e.props=s?n:kt(n,!1,lt,mt,ft):e.type.props?e.props=n:e.props=r,e.attrs=r}function Hs(e,t,a,s){const[n,r]=e.propsOptions;let l,o=!1;if(t)for(let i in t){if(P(i))continue;const c=t[i];let d;n&&v(n,d=j(i))?r&&r.includes(d)?(l||(l={}))[d]=c:a[d]=c:Ns(e.emitsOptions,i)||i in s&&c===s[i]||(s[i]=c,o=!0)}if(r){const t=Tt(a),s=l||i;for(let l=0;l<r.length;l++){const o=r[l];a[o]=Gs(n,t,o,s[o],e,!v(s,o))}}return o}function Gs(e,t,a,s,n,r){const l=e[a];if(null!=l){const e=v(l,'default');if(e&&void 0===s){const e=l.default;if(l.type!==Function&&!l.skipFactory&&k(e)){const{propsDefaults:r}=n;if(a in r)s=r[a];else{const l=Qn(n);s=r[a]=e.call(null,t),l()}}else s=e;n.ce&&n.ce._setProp(a,s)}l[0]&&(r&&!e?s=!1:!l[1]||''!==s&&s!==B(a)||(s=!0))}return s}function zs(e,t,a=!1){const s=t.propsCache,n=s.get(e);if(n)return n;const r=e.props,l={},o=[];if(!r)return I(e)&&s.set(e,c),c;if(y(r))for(let e=0;e<r.length;e++){0;const t=j(r[e]);Ws(t)&&(l[t]=i)}else if(r){0;for(const e in r){const t=j(e);if(Ws(t)){const a=r[e],s=l[t]=y(a)||k(a)?{type:a}:g({},a),n=s.type;let i=!1,c=!0;if(y(n))for(let e=0;e<n.length;++e){const t=n[e],a=k(t)&&t.name;if('Boolean'===a){i=!0;break}'String'===a&&(c=!1)}else i=k(n)&&'Boolean'===n.name;s[0]=i,s[1]=c,(i||v(s,'default'))&&o.push(t)}}}const d=[l,o];return I(e)&&s.set(e,d),d}function Ws(e){return'$'!==e[0]&&!P(e)}const Qs=e=>'_'===e||'_ctx'===e||'$stable'===e,Xs=e=>y(e)?e.map(jn):[jn(e)],Ys=(e,t,a)=>{if(t._n)return t;const s=ba((...e)=>Xs(t(...e)),a);return s._c=!1,s},Ks=(e,t,a)=>{const s=e._ctx;for(const a in e){if(Qs(a))continue;const n=e[a];if(k(n))t[a]=Ys(0,n,s);else if(null!=n){0;const e=Xs(n);t[a]=()=>e}}},Js=(e,t)=>{const a=Xs(t);e.slots.default=()=>a},Zs=(e,t,a)=>{for(const s in t)!a&&Qs(s)||(e[s]=t[s])};const en=un;function tn(e,t){const a=Q();a.__VUE__=!0,ua(a.__VUE_DEVTOOLS_GLOBAL_HOOK__,a);const{insert:s,remove:n,patchProp:r,createElement:l,createText:o,createComment:u,setText:p,setElementText:m,parentNode:g,nextSibling:h,setScopeId:f=d,insertStaticContent:y}=e,b=(e,t,a,s=null,n=null,r=null,l=void 0,o=null,i=!!t.dynamicChildren)=>{if(e===t)return;e&&!In(e,t)&&(s=te(e),Y(e,n,r,!0),e=null),-2===t.patchFlag&&(i=!1,t.dynamicChildren=null);const{type:c,ref:d,shapeFlag:u}=t;switch(c){case mn:x(e,t,a,s);break;case gn:w(e,t,a,s);break;case hn:null==e&&k(t,a,s,l);break;case pn:N(e,t,a,s,n,r,l,o,i);break;default:1&u?C(e,t,a,s,n,r,l,o,i):6&u?R(e,t,a,s,n,r,l,o,i):(64&u||128&u)&&c.process(e,t,a,s,n,r,l,o,i,ne)}null!=d&&n?as(d,e&&e.ref,r,t||e,!t):null==d&&e&&null!=e.ref&&as(e.ref,null,r,e,!0)},x=(e,t,a,n)=>{if(null==e)s(t.el=o(t.children),a,n);else{const a=t.el=e.el;t.children!==e.children&&p(a,t.children)}},w=(e,t,a,n)=>{null==e?s(t.el=u(t.children||''),a,n):t.el=e.el},k=(e,t,a,s)=>{[e.el,e.anchor]=y(e.children,t,a,s,e.el,e.anchor)},S=({el:e,anchor:t})=>{let a;for(;e&&e!==t;)a=h(e),n(e),e=a;n(t)},C=(e,t,a,s,n,r,l,o,i)=>{if('svg'===t.type?l='svg':'math'===t.type&&(l='mathml'),null==e)I(t,a,s,n,r,l,o,i);else{const a=e.el&&e.el._isVueCE?e.el:null;try{a&&a._beginPatch(),M(e,t,n,r,l,o,i)}finally{a&&a._endPatch()}}},I=(e,t,a,n,o,i,c,d)=>{let u,p;const{props:g,shapeFlag:h,transition:f,dirs:v}=e;if(u=e.el=l(e.type,i,g&&g.is,g),8&h?m(u,e.children):16&h&&A(e.children,u,null,n,o,an(e,i),c,d),v&&wa(e,null,n,'created'),T(u,e,e.scopeId,c,n),g){for(const e in g)'value'===e||P(e)||r(u,e,null,g[e],i,n);'value'in g&&r(u,'value',null,g.value,i),(p=g.onVnodeBeforeMount)&&qn(p,n,e)}F(u,'__vnode',e,!0),F(u,'__vueParentComponent',n,!0),v&&wa(e,null,n,'beforeMount');const y=nn(o,f);y&&f.beforeEnter(u),s(u,t,a),((p=g&&g.onVnodeMounted)||y||v)&&en(()=>{p&&qn(p,n,e),y&&f.enter(u),v&&wa(e,null,n,'mounted')},o)},T=(e,t,a,s,n)=>{if(a&&f(e,a),s)for(let t=0;t<s.length;t++)f(e,s[t]);if(n){let a=n.subTree;if(t===a||dn(a.type)&&(a.ssContent===t||a.ssFallback===t)){const t=n.vnode;T(e,t,t.scopeId,t.slotScopeIds,n.parent)}}},A=(e,t,a,s,n,r,l,o,i=0)=>{for(let c=i;c<e.length;c++){const i=e[c]=o?Ln(e[c]):jn(e[c]);b(null,i,t,a,s,n,r,l,o)}},M=(e,t,a,s,n,l,o)=>{const c=t.el=e.el;c.__vnode=t;let{patchFlag:d,dynamicChildren:u,dirs:p}=t;d|=16&e.patchFlag;const g=e.props||i,h=t.props||i;let f;if(a&&sn(a,!1),(f=h.onVnodeBeforeUpdate)&&qn(f,a,t,e),p&&wa(t,e,a,'beforeUpdate'),a&&sn(a,!0),(g.innerHTML&&null==h.innerHTML||g.textContent&&null==h.textContent)&&m(c,''),u?E(e.dynamicChildren,u,c,a,s,an(t,n),l):o||H(e,t,c,null,a,s,an(t,n),l,!1),d>0){if(16&d)D(c,g,h,a,n);else if(2&d&&g.class!==h.class&&r(c,'class',null,h.class,n),4&d&&r(c,'style',g.style,h.style,n),8&d){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const s=e[t],l=g[s],o=h[s];o===l&&'value'!==s||r(c,s,l,o,n,a)}}1&d&&e.children!==t.children&&m(c,t.children)}else o||null!=u||D(c,g,h,a,n);((f=h.onVnodeUpdated)||p)&&en(()=>{f&&qn(f,a,t,e),p&&wa(t,e,a,'updated')},s)},E=(e,t,a,s,n,r,l)=>{for(let o=0;o<t.length;o++){const i=e[o],c=t[o],d=i.el&&(i.type===pn||!In(i,c)||198&i.shapeFlag)?g(i.el):a;b(i,c,d,null,s,n,r,l,!0)}},D=(e,t,a,s,n)=>{if(t!==a){if(t!==i)for(const l in t)P(l)||l in a||r(e,l,t[l],null,n,s);for(const l in a){if(P(l))continue;const o=a[l],i=t[l];o!==i&&'value'!==l&&r(e,l,i,o,n,s)}'value'in a&&r(e,'value',t.value,a.value,n)}},N=(e,t,a,n,r,l,i,c,d)=>{const u=t.el=e?e.el:o(''),p=t.anchor=e?e.anchor:o('');let{patchFlag:m,dynamicChildren:g,slotScopeIds:h}=t;h&&(c=c?c.concat(h):h),null==e?(s(u,a,n),s(p,a,n),A(t.children||[],a,p,r,l,i,c,d)):m>0&&64&m&&g&&e.dynamicChildren&&e.dynamicChildren.length===g.length?(E(e.dynamicChildren,g,a,r,l,i,c),(null!=t.key||r&&t===r.subTree)&&rn(e,t,!0)):H(e,t,a,p,r,l,i,c,d)},R=(e,t,a,s,n,r,l,o,i)=>{t.slotScopeIds=o,null==e?512&t.shapeFlag?n.ctx.activate(t,a,s,l,i):L(t,a,s,n,r,l,i):O(e,t,i)},L=(e,t,a,s,n,r,l)=>{const o=e.component=Fn(e,s,n);if(rs(e)&&(o.ctx.renderer=ne),er(o,!1,l),o.asyncDep){if(n&&n.registerDep(o,q,l),!e.el){const s=o.subTree=En(gn);w(null,s,t,a),e.placeholder=s.el}}else q(o,e,t,a,n,r,l)},O=(e,t,a)=>{const s=t.component=e.component;if(function(e,t,a){const{props:s,children:n,component:r}=e,{props:l,children:o,patchFlag:i}=t,c=r.emitsOptions;if(t.dirs||t.transition)return!0;if(!(a&&i>=0))return!(!n&&!o||o&&o.$stable)||s!==l&&(s?!l||Bs(s,l,c):!!l);if(1024&i)return!0;if(16&i)return s?Bs(s,l,c):!!l;if(8&i){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const a=e[t];if(l[a]!==s[a]&&!Ns(c,a))return!0}}return!1}(e,t,a)){if(s.asyncDep&&!s.asyncResolved)return void U(s,t,a);s.next=t,s.update()}else t.el=e.el,s.vnode=t},q=(e,t,a,s,n,r,l)=>{const o=()=>{if(e.isMounted){let{next:t,bu:a,u:s,parent:i,vnode:c}=e;{const a=ln(e);if(a)return t&&(t.el=c.el,U(e,t,l)),void a.asyncDep.then(()=>{e.isUnmounted||o()})}let d,u=t;0,sn(e,!1),t?(t.el=c.el,U(e,t,l)):t=c,a&&V(a),(d=t.props&&t.props.onVnodeBeforeUpdate)&&qn(d,i,t,c),sn(e,!0);const p=Rs(e);0;const m=e.subTree;e.subTree=p,b(m,p,g(m.el),te(m),e,n,r),t.el=p.el,null===u&&Os(e,p.el),s&&en(s,n),(d=t.props&&t.props.onVnodeUpdated)&&en(()=>qn(d,i,t,c),n),ma(e)}else{let l;const{el:o,props:i}=t,{bm:c,m:d,parent:u,root:p,type:m}=e,g=ns(t);if(sn(e,!1),c&&V(c),!g&&(l=i&&i.onVnodeBeforeMount)&&qn(l,u,t),sn(e,!0),o&&le){const t=()=>{e.subTree=Rs(e),le(o,e.subTree,e,n,null)};g&&m.__asyncHydrate?m.__asyncHydrate(o,e,t):t()}else{p.ce&&!1!==p.ce._def.shadowRoot&&p.ce._injectChildStyle(m);const l=e.subTree=Rs(e);0,b(null,l,a,s,e,n,r),t.el=l.el}if(d&&en(d,n),!g&&(l=i&&i.onVnodeMounted)){const e=t;en(()=>qn(l,u,e),n)}(256&t.shapeFlag||u&&ns(u.vnode)&&256&u.vnode.shapeFlag)&&e.a&&en(e.a,n),e.isMounted=!0,pa(e),t=a=s=null}};e.scope.on();const i=e.effect=new ge(o);e.scope.off();const c=e.update=i.run.bind(i),d=e.job=i.runIfDirty.bind(i);d.i=e,d.id=e.uid,i.scheduler=()=>ea(d),sn(e,!0),c()},U=(e,t,a)=>{t.component=e;const s=e.vnode.props;e.vnode=t,e.next=null,function(e,t,a,s){const{props:n,attrs:r,vnode:{patchFlag:l}}=e,o=Tt(n),[i]=e.propsOptions;let c=!1;if(!(s||l>0)||16&l){let s;Hs(e,t,n,r)&&(c=!0);for(const r in o)t&&(v(t,r)||(s=B(r))!==r&&v(t,s))||(i?!a||void 0===a[r]&&void 0===a[s]||(n[r]=Gs(i,o,r,void 0,e,!0)):delete n[r]);if(r!==o)for(const e in r)t&&v(t,e)||(delete r[e],c=!0)}else if(8&l){const a=e.vnode.dynamicProps;for(let s=0;s<a.length;s++){let l=a[s];if(Ns(e.emitsOptions,l))continue;const d=t[l];if(i)if(v(r,l))d!==r[l]&&(r[l]=d,c=!0);else{const t=j(l);n[t]=Gs(i,o,t,d,e,!1)}else d!==r[l]&&(r[l]=d,c=!0)}}c&&Ue(e.attrs,'set','')}(e,t.props,s,a),((e,t,a)=>{const{vnode:s,slots:n}=e;let r=!0,l=i;if(32&s.shapeFlag){const e=t._;e?a&&1===e?r=!1:Zs(n,t,a):(r=!t.$stable,Ks(t,n)),l=t}else t&&(Js(e,t),l={default:1});if(r)for(const e in n)Qs(e)||null!=l[e]||delete n[e]})(e,t.children,a),Me(),sa(e),Ee()},H=(e,t,a,s,n,r,l,o,i=!1)=>{const c=e&&e.children,d=e?e.shapeFlag:0,u=t.children,{patchFlag:p,shapeFlag:g}=t;if(p>0){if(128&p)return void W(c,u,a,s,n,r,l,o,i);if(256&p)return void G(c,u,a,s,n,r,l,o,i)}8&g?(16&d&&ee(c,n,r),u!==c&&m(a,u)):16&d?16&g?W(c,u,a,s,n,r,l,o,i):ee(c,n,r,!0):(8&d&&m(a,''),16&g&&A(u,a,s,n,r,l,o,i))},G=(e,t,a,s,n,r,l,o,i)=>{t=t||c;const d=(e=e||c).length,u=t.length,p=Math.min(d,u);let m;for(m=0;m<p;m++){const s=t[m]=i?Ln(t[m]):jn(t[m]);b(e[m],s,a,null,n,r,l,o,i)}d>u?ee(e,n,r,!0,!1,p):A(t,a,s,n,r,l,o,i,p)},W=(e,t,a,s,n,r,l,o,i)=>{let d=0;const u=t.length;let p=e.length-1,m=u-1;for(;d<=p&&d<=m;){const s=e[d],c=t[d]=i?Ln(t[d]):jn(t[d]);if(!In(s,c))break;b(s,c,a,null,n,r,l,o,i),d++}for(;d<=p&&d<=m;){const s=e[p],c=t[m]=i?Ln(t[m]):jn(t[m]);if(!In(s,c))break;b(s,c,a,null,n,r,l,o,i),p--,m--}if(d>p){if(d<=m){const e=m+1,c=e<u?t[e].el:s;for(;d<=m;)b(null,t[d]=i?Ln(t[d]):jn(t[d]),a,c,n,r,l,o,i),d++}}else if(d>m)for(;d<=p;)Y(e[d],n,r,!0),d++;else{const g=d,h=d,f=new Map;for(d=h;d<=m;d++){const e=t[d]=i?Ln(t[d]):jn(t[d]);null!=e.key&&f.set(e.key,d)}let v,y=0;const x=m-h+1;let w=!1,k=0;const S=new Array(x);for(d=0;d<x;d++)S[d]=0;for(d=g;d<=p;d++){const s=e[d];if(y>=x){Y(s,n,r,!0);continue}let c;if(null!=s.key)c=f.get(s.key);else for(v=h;v<=m;v++)if(0===S[v-h]&&In(s,t[v])){c=v;break}void 0===c?Y(s,n,r,!0):(S[c-h]=d+1,c>=k?k=c:w=!0,b(s,t[c],a,null,n,r,l,o,i),y++)}const C=w?function(e){const t=e.slice(),a=[0];let s,n,r,l,o;const i=e.length;for(s=0;s<i;s++){const i=e[s];if(0!==i){if(n=a[a.length-1],e[n]<i){t[s]=n,a.push(s);continue}for(r=0,l=a.length-1;r<l;)o=r+l>>1,e[a[o]]<i?r=o+1:l=o;i<e[a[r]]&&(r>0&&(t[s]=a[r-1]),a[r]=s)}}r=a.length,l=a[r-1];for(;r-- >0;)a[r]=l,l=t[l];return a}(S):c;for(v=C.length-1,d=x-1;d>=0;d--){const e=h+d,c=t[e],p=t[e+1],m=e+1<u?p.el||cn(p):s;0===S[d]?b(null,c,a,m,n,r,l,o,i):w&&(v<0||d!==C[v]?X(c,a,m,2):v--)}}},X=(e,t,a,r,l=null)=>{const{el:o,type:i,transition:c,children:d,shapeFlag:u}=e;if(6&u)return void X(e.component.subTree,t,a,r);if(128&u)return void e.suspense.move(t,a,r);if(64&u)return void i.move(e,t,a,ne);if(i===pn){s(o,t,a);for(let e=0;e<d.length;e++)X(d[e],t,a,r);return void s(e.anchor,t,a)}if(i===hn)return void(({el:e,anchor:t},a,n)=>{let r;for(;e&&e!==t;)r=h(e),s(e,a,n),e=r;s(t,a,n)})(e,t,a);if(2!==r&&1&u&&c)if(0===r)c.beforeEnter(o),s(o,t,a),en(()=>c.enter(o),l);else{const{leave:r,delayLeave:l,afterLeave:i}=c,d=()=>{e.ctx.isUnmounted?n(o):s(o,t,a)},u=()=>{o._isLeaving&&o[Ba](!0),r(o,()=>{d(),i&&i()})};l?l(o,d,u):u()}else s(o,t,a)},Y=(e,t,a,s=!1,n=!1)=>{const{type:r,props:l,ref:o,children:i,dynamicChildren:c,shapeFlag:d,patchFlag:u,dirs:p,cacheIndex:m}=e;if(-2===u&&(n=!1),null!=o&&(Me(),as(o,null,a,e,!0),Ee()),null!=m&&(t.renderCache[m]=void 0),256&d)return void t.ctx.deactivate(e);const g=1&d&&p,h=!ns(e);let f;if(h&&(f=l&&l.onVnodeBeforeUnmount)&&qn(f,t,e),6&d)Z(e.component,a,s);else{if(128&d)return void e.suspense.unmount(a,s);g&&wa(e,null,t,'beforeUnmount'),64&d?e.type.remove(e,t,a,ne,s):c&&!c.hasOnce&&(r!==pn||u>0&&64&u)?ee(c,t,a,!1,!0):(r===pn&&384&u||!n&&16&d)&&ee(i,t,a),s&&K(e)}(h&&(f=l&&l.onVnodeUnmounted)||g)&&en(()=>{f&&qn(f,t,e),g&&wa(e,null,t,'unmounted')},a)},K=e=>{const{type:t,el:a,anchor:s,transition:r}=e;if(t===pn)return void J(a,s);if(t===hn)return void S(e);const l=()=>{n(a),r&&!r.persisted&&r.afterLeave&&r.afterLeave()};if(1&e.shapeFlag&&r&&!r.persisted){const{leave:t,delayLeave:s}=r,n=()=>t(a,l);s?s(e.el,l,n):n()}else l()},J=(e,t)=>{let a;for(;e!==t;)a=h(e),n(e),e=a;n(t)},Z=(e,t,a)=>{const{bum:s,scope:n,job:r,subTree:l,um:o,m:i,a:c}=e;var d;on(i),on(c),s&&V(s),n.stop(),r&&(r.flags|=8,Y(l,e,t,a)),o&&en(o,t),en(()=>{e.isUnmounted=!0},t),d=e,oa&&'function'==typeof oa.cleanupBuffer&&!oa.cleanupBuffer(d)&&ga(d)},ee=(e,t,a,s=!1,n=!1,r=0)=>{for(let l=r;l<e.length;l++)Y(e[l],t,a,s,n)},te=e=>{if(6&e.shapeFlag)return te(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const t=h(e.anchor||e.el),a=t&&t[Ia];return a?h(a):t};let ae=!1;const se=(e,t,a)=>{let s;null==e?t._vnode&&(Y(t._vnode,null,null,!0),s=t._vnode.component):b(t._vnode||null,e,t,null,null,null,a),t._vnode=e,ae||(ae=!0,sa(s),na(),ae=!1)},ne={p:b,um:Y,m:X,r:K,mt:L,mc:A,pc:H,pbc:E,n:te,o:e};let re,le;return t&&([re,le]=t(ne)),{render:se,hydrate:re,createApp:Ms(se,re)}}function an({type:e,props:t},a){return'svg'===a&&'foreignObject'===e||'mathml'===a&&'annotation-xml'===e&&t&&t.encoding&&t.encoding.includes('html')?void 0:a}function sn({effect:e,job:t},a){a?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function nn(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function rn(e,t,a=!1){const s=e.children,n=t.children;if(y(s)&&y(n))for(let t=0;t<s.length;t++){const r=s[t];let l=n[t];1&l.shapeFlag&&!l.dynamicChildren&&((l.patchFlag<=0||32===l.patchFlag)&&(l=n[t]=Ln(n[t]),l.el=r.el),a||-2===l.patchFlag||rn(r,l)),l.type===mn&&(-1!==l.patchFlag?l.el=r.el:l.__elIndex=t+(e.type===pn?1:0)),l.type!==gn||l.el||(l.el=r.el)}}function ln(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:ln(t)}function on(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}function cn(e){if(e.placeholder)return e.placeholder;const t=e.component;return t?cn(t.subTree):null}const dn=e=>e.__isSuspense;function un(e,t){t&&t.pendingBranch?y(e)?t.effects.push(...e):t.effects.push(e):aa(e)}const pn=Symbol.for('v-fgt'),mn=Symbol.for('v-txt'),gn=Symbol.for('v-cmt'),hn=Symbol.for('v-stc'),fn=[];let vn=null;function yn(e=!1){fn.push(vn=e?null:[])}function bn(){fn.pop(),vn=fn[fn.length-1]||null}let xn=1;function wn(e,t=!1){xn+=e,e<0&&vn&&t&&(vn.hasOnce=!0)}function kn(e){return e.dynamicChildren=xn>0?vn||c:null,bn(),xn>0&&vn&&vn.push(e),e}function Sn(e,t,a,s,n,r){return kn(Mn(e,t,a,s,n,r,!0))}function _n(e,t,a,s,n){return kn(En(e,t,a,s,n,!0))}function Cn(e){return!!e&&!0===e.__v_isVNode}function In(e,t){return e.type===t.type&&e.key===t.key}const Tn=({key:e})=>null!=e?e:null,An=({ref:e,ref_key:t,ref_for:a})=>('number'==typeof e&&(e=''+e),null!=e?S(e)||Et(e)||k(e)?{i:fa,r:e,k:t,f:!!a}:e:null);function Mn(e,t=null,a=null,s=0,n=null,r=(e===pn?0:1),l=!1,o=!1){const i={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Tn(t),ref:t&&An(t),scopeId:va,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:fa};return o?(Bn(i,a),128&r&&e.normalize(i)):a&&(i.shapeFlag|=S(a)?8:16),xn>0&&!l&&vn&&(i.patchFlag>0||6&r)&&32!==i.patchFlag&&vn.push(i),i}const En=$n;function $n(e,t=null,a=null,s=0,n=null,r=!1){if(e&&e!==vs||(e=gn),Cn(e)){const s=Dn(e,t,!0);return a&&Bn(s,a),xn>0&&!r&&vn&&(6&s.shapeFlag?vn[vn.indexOf(e)]=s:vn.push(s)),s.patchFlag=-2,s}if(or(e)&&(e=e.__vccOpts),t){t=function(e){return e?It(e)||Vs(e)?g({},e):e:null}(t);let{class:e,style:a}=t;e&&!S(e)&&(t.class=ee(e)),I(a)&&(It(a)&&!y(a)&&(a=g({},a)),t.style=X(a))}return Mn(e,t,a,s,n,S(e)?1:dn(e)?128:Ta(e)?64:I(e)?4:k(e)?2:0,r,!0)}function Dn(e,t,a=!1,s=!1){const{props:n,ref:r,patchFlag:l,children:o,transition:i}=e,c=t?On(n||{},t):n,d={__v_isVNode:!0,__v_skip:!0,type:e.type,props:c,key:c&&Tn(c),ref:t&&t.ref?a&&r?y(r)?r.concat(An(t)):[r,An(t)]:An(t):r,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:o,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==pn?-1===l?16:16|l:l,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:i,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Dn(e.ssContent),ssFallback:e.ssFallback&&Dn(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return i&&s&&Ka(d,i.clone(d)),d}function Pn(e=' ',t=0){return En(mn,null,e,t)}function Nn(e,t){const a=En(hn,null,e);return a.staticCount=t,a}function Rn(e='',t=!1){return t?(yn(),_n(gn,null,e)):En(gn,null,e)}function jn(e){return null==e||'boolean'==typeof e?En(gn):y(e)?En(pn,null,e.slice()):Cn(e)?Ln(e):En(mn,null,String(e))}function Ln(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:Dn(e)}function Bn(e,t){let a=0;const{shapeFlag:s}=e;if(null==t)t=null;else if(y(t))a=16;else if('object'==typeof t){if(65&s){const a=t.default;return void(a&&(a._c&&(a._d=!1),Bn(e,a()),a._c&&(a._d=!0)))}{a=32;const s=t._;s||Vs(t)?3===s&&fa&&(1===fa.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=fa}}else k(t)?(t={default:t,_ctx:fa},a=32):(t=String(t),64&s?(a=16,t=[Pn(t)]):a=8);e.children=t,e.shapeFlag|=a}function On(...e){const t={};for(let a=0;a<e.length;a++){const s=e[a];for(const e in s)if('class'===e)t.class!==s.class&&(t.class=ee([t.class,s.class]));else if('style'===e)t.style=X([t.style,s.style]);else if(p(e)){const a=t[e],n=s[e];!n||a===n||y(a)&&a.includes(n)||(t[e]=a?[].concat(a,n):n)}else''!==e&&(t[e]=s[e])}return t}function qn(e,t,a,s=null){Ht(e,t,7,[a,s])}const Un=Ts();let Vn=0;function Fn(e,t,a){const s=e.type,n=(t?t.appContext:e.appContext)||Un,r={uid:Vn++,vnode:e,type:s,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new pe(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),ids:t?t.ids:['',0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:zs(s,n),emitsOptions:Ps(s,n),emit:null,emitted:null,propsDefaults:i,inheritAttrs:s.inheritAttrs,ctx:i,data:i,props:i,attrs:i,slots:i,refs:i,setupState:i,setupContext:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=Ds.bind(null,r),e.ce&&e.ce(r),r}let Hn=null;const Gn=()=>Hn||fa;let zn,Wn;{const e=Q(),t=(t,a)=>{let s;return(s=e[t])||(s=e[t]=[]),s.push(a),e=>{s.length>1?s.forEach(t=>t(e)):s[0](e)}};zn=t('__VUE_INSTANCE_SETTERS__',e=>Hn=e),Wn=t('__VUE_SSR_SETTERS__',e=>Zn=e)}const Qn=e=>{const t=Hn;return zn(e),e.scope.on(),()=>{e.scope.off(),zn(t)}},Xn=()=>{Hn&&Hn.scope.off(),zn(null)};function Yn(e){return 4&e.vnode.shapeFlag}let Kn,Jn,Zn=!1;function er(e,t=!1,a=!1){t&&Wn(t);const{props:s,children:n}=e.vnode,r=Yn(e);Fs(e,s,r,t),((e,t,a)=>{const s=e.slots=Us();if(32&e.vnode.shapeFlag){const e=t._;e?(Zs(s,t,a),a&&F(s,'_',e,!0)):Ks(t,s)}else t&&Js(e,t)})(e,n,a||t);const l=r?function(e,t){const a=e.type;0;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Is),!1;const{setup:s}=a;if(s){Me();const a=e.setupContext=s.length>1?nr(e):null,n=Qn(e),r=Ft(s,e,0,[e.props,a]),l=T(r);if(Ee(),n(),!l&&!e.sp||ns(e)||es(e),l){if(r.then(Xn,Xn),t)return r.then(a=>{tr(e,a,t)}).catch(t=>{Gt(t,e,0)});e.asyncDep=r}else tr(e,r,t)}else ar(e,t)}(e,t):void 0;return t&&Wn(!1),l}function tr(e,t,a){k(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:I(t)&&(e.devtoolsRawSetupState=t,e.setupState=jt(t)),ar(e,a)}function ar(e,t,a){const s=e.type;if(!e.render){if(!t&&Kn&&!s.render){const t=s.template||!1;if(t){0;const{isCustomElement:a,compilerOptions:n}=e.appContext.config,{delimiters:r,compilerOptions:l}=s,o=g(g({isCustomElement:a,delimiters:r},n),l);s.render=Kn(t,o)}}e.render=s.render||d,Jn&&Jn(e)}}const sr={get:(e,t)=>(qe(e,0,''),e[t])};function nr(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,sr),slots:e.slots,emit:e.emit,expose:t}}function rr(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(jt((t=e.exposed,!v(t,'__v_skip')&&Object.isExtensible(t)&&F(t,'__v_skip',!0),t)),{get:(t,a)=>a in t?t[a]:a in _s?_s[a](e):void 0,has:(e,t)=>t in e||t in _s})):e.proxy;var t}function lr(e,t=!0){return k(e)?e.displayName||e.name:e.name||t&&e.__name}function or(e){return k(e)&&'__vccOpts'in e}const ir=(e,t)=>{const a=function(e,t,a=!1){let s,n;return k(e)?s=e:(s=e.get,n=e.set),new Lt(s,n,a)}(e,0,Zn);return a};const cr='3.5.26';let dr;const ur='undefined'!=typeof window&&window.trustedTypes;if(ur)try{dr=ur.createPolicy('vue',{createHTML:e=>e})}catch(e){}const pr=dr?e=>dr.createHTML(e):e=>e,mr='undefined'!=typeof document?document:null,gr=mr&&mr.createElement('template'),hr={insert:(e,t,a)=>{t.insertBefore(e,a||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,a,s)=>{const n='svg'===t?mr.createElementNS('http://www.w3.org/2000/svg',e):'mathml'===t?mr.createElementNS('http://www.w3.org/1998/Math/MathML',e):a?mr.createElement(e,{is:a}):mr.createElement(e);return'select'===e&&s&&null!=s.multiple&&n.setAttribute('multiple',s.multiple),n},createText:e=>mr.createTextNode(e),createComment:e=>mr.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>mr.querySelector(e),setScopeId(e,t){e.setAttribute(t,'')},insertStaticContent(e,t,a,s,n,r){const l=a?a.previousSibling:t.lastChild;if(n&&(n===r||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),a),n!==r&&(n=n.nextSibling););else{gr.innerHTML=pr('svg'===s?`<svg>${e}</svg>`:'mathml'===s?`<math>${e}</math>`:e);const n=gr.content;if('svg'===s||'mathml'===s){const e=n.firstChild;for(;e.firstChild;)n.appendChild(e.firstChild);n.removeChild(e)}t.insertBefore(n,a)}return[l?l.nextSibling:t.firstChild,a?a.previousSibling:t.lastChild]}},fr='transition',vr='animation',yr=Symbol('_vtc'),br={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},xr=g({},Va,br),wr=(e=>(e.displayName='Transition',e.props=xr,e))((e,{slots:t})=>function(e,t,a){try{wn(-1);const s=arguments.length;return 2===s?I(t)&&!y(t)?Cn(t)?En(e,null,[t]):En(e,t):En(e,null,t):(s>3?a=Array.prototype.slice.call(arguments,2):3===s&&Cn(a)&&(a=[a]),En(e,t,a))}finally{wn(1)}}(za,_r(e),t)),kr=(e,t=[])=>{y(e)?e.forEach(e=>e(...t)):e&&e(...t)},Sr=e=>!!e&&(y(e)?e.some(e=>e.length>1):e.length>1);function _r(e){const t={};for(const a in e)a in br||(t[a]=e[a]);if(!1===e.css)return t;const{name:a='v',type:s,duration:n,enterFromClass:r=`${a}-enter-from`,enterActiveClass:l=`${a}-enter-active`,enterToClass:o=`${a}-enter-to`,appearFromClass:i=r,appearActiveClass:c=l,appearToClass:d=o,leaveFromClass:u=`${a}-leave-from`,leaveActiveClass:p=`${a}-leave-active`,leaveToClass:m=`${a}-leave-to`}=e,h=function(e){if(null==e)return null;if(I(e))return[Cr(e.enter),Cr(e.leave)];{const t=Cr(e);return[t,t]}}(n),f=h&&h[0],v=h&&h[1],{onBeforeEnter:y,onEnter:b,onEnterCancelled:x,onLeave:w,onLeaveCancelled:k,onBeforeAppear:S=y,onAppear:C=b,onAppearCancelled:T=x}=t,A=(e,t,a,s)=>{e._enterCancelled=s,Tr(e,t?d:o),Tr(e,t?c:l),a&&a()},M=(e,t)=>{e._isLeaving=!1,Tr(e,u),Tr(e,m),Tr(e,p),t&&t()},E=e=>(t,a)=>{const n=e?C:b,l=()=>A(t,e,a);kr(n,[t,l]),Ar(()=>{Tr(t,e?i:r),Ir(t,e?d:o),Sr(n)||Er(t,s,f,l)})};return g(t,{onBeforeEnter(e){kr(y,[e]),Ir(e,r),Ir(e,l)},onBeforeAppear(e){kr(S,[e]),Ir(e,i),Ir(e,c)},onEnter:E(!1),onAppear:E(!0),onLeave(e,t){e._isLeaving=!0;const a=()=>M(e,t);Ir(e,u),e._enterCancelled?(Ir(e,p),Nr(e)):(Nr(e),Ir(e,p)),Ar(()=>{e._isLeaving&&(Tr(e,u),Ir(e,m),Sr(w)||Er(e,s,v,a))}),kr(w,[e,a])},onEnterCancelled(e){A(e,!1,void 0,!0),kr(x,[e])},onAppearCancelled(e){A(e,!0,void 0,!0),kr(T,[e])},onLeaveCancelled(e){M(e),kr(k,[e])}})}function Cr(e){return G(e)}function Ir(e,t){t.split(/\s+/).forEach(t=>t&&e.classList.add(t)),(e[yr]||(e[yr]=new Set)).add(t)}function Tr(e,t){t.split(/\s+/).forEach(t=>t&&e.classList.remove(t));const a=e[yr];a&&(a.delete(t),a.size||(e[yr]=void 0))}function Ar(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Mr=0;function Er(e,t,a,s){const n=e._endId=++Mr,r=()=>{n===e._endId&&s()};if(null!=a)return setTimeout(r,a);const{type:l,timeout:o,propCount:i}=$r(e,t);if(!l)return s();const c=l+'end';let d=0;const u=()=>{e.removeEventListener(c,p),r()},p=t=>{t.target===e&&++d>=i&&u()};setTimeout(()=>{d<i&&u()},o+1),e.addEventListener(c,p)}function $r(e,t){const a=window.getComputedStyle(e),s=e=>(a[e]||'').split(', '),n=s(`${fr}Delay`),r=s(`${fr}Duration`),l=Dr(n,r),o=s(`${vr}Delay`),i=s(`${vr}Duration`),c=Dr(o,i);let d=null,u=0,p=0;t===fr?l>0&&(d=fr,u=l,p=r.length):t===vr?c>0&&(d=vr,u=c,p=i.length):(u=Math.max(l,c),d=u>0?l>c?fr:vr:null,p=d?d===fr?r.length:i.length:0);return{type:d,timeout:u,propCount:p,hasTransform:d===fr&&/\b(?:transform|all)(?:,|$)/.test(s(`${fr}Property`).toString())}}function Dr(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((t,a)=>Pr(t)+Pr(e[a])))}function Pr(e){return'auto'===e?0:1e3*Number(e.slice(0,-1).replace(',','.'))}function Nr(e){return(e?e.ownerDocument:document).body.offsetHeight}const Rr=Symbol('_vod'),jr=Symbol('_vsh'),Lr={name:'show',beforeMount(e,{value:t},{transition:a}){e[Rr]='none'===e.style.display?'':e.style.display,a&&t?a.beforeEnter(e):Br(e,t)},mounted(e,{value:t},{transition:a}){a&&t&&a.enter(e)},updated(e,{value:t,oldValue:a},{transition:s}){!t!=!a&&(s?t?(s.beforeEnter(e),Br(e,!0),s.enter(e)):s.leave(e,()=>{Br(e,!1)}):Br(e,t))},beforeUnmount(e,{value:t}){Br(e,t)}};function Br(e,t){e.style.display=t?e[Rr]:'none',e[jr]=!t}const Or=Symbol('');const qr=/(?:^|;)\s*display\s*:/;const Ur=/\s*!important$/;function Vr(e,t,a){if(y(a))a.forEach(a=>Vr(e,t,a));else if(null==a&&(a=''),t.startsWith('--'))e.setProperty(t,a);else{const s=function(e,t){const a=Hr[t];if(a)return a;let s=j(t);if('filter'!==s&&s in e)return Hr[t]=s;s=O(s);for(let a=0;a<Fr.length;a++){const n=Fr[a]+s;if(n in e)return Hr[t]=n}return t}(e,t);Ur.test(a)?e.setProperty(B(s),a.replace(Ur,''),'important'):e[s]=a}}const Fr=['Webkit','Moz','ms'],Hr={};const Gr='http://www.w3.org/1999/xlink';function zr(e,t,a,s,n,r=ae(t)){s&&t.startsWith('xlink:')?null==a?e.removeAttributeNS(Gr,t.slice(6,t.length)):e.setAttributeNS(Gr,t,a):null==a||r&&!se(a)?e.removeAttribute(t):e.setAttribute(t,r?'':C(a)?String(a):a)}function Wr(e,t,a,s,n){if('innerHTML'===t||'textContent'===t)return void(null!=a&&(e[t]='innerHTML'===t?pr(a):a));const r=e.tagName;if('value'===t&&'PROGRESS'!==r&&!r.includes('-')){const s='OPTION'===r?e.getAttribute('value')||'':e.value,n=null==a?'checkbox'===e.type?'on':'':String(a);return s===n&&'_value'in e||(e.value=n),null==a&&e.removeAttribute(t),void(e._value=a)}let l=!1;if(''===a||null==a){const s=typeof e[t];'boolean'===s?a=se(a):null==a&&'string'===s?(a='',l=!0):'number'===s&&(a=0,l=!0)}try{e[t]=a}catch(e){0}l&&e.removeAttribute(n||t)}function Qr(e,t,a,s){e.addEventListener(t,a,s)}const Xr=Symbol('_vei');function Yr(e,t,a,s,n=null){const r=e[Xr]||(e[Xr]={}),l=r[t];if(s&&l)l.value=s;else{const[a,o]=function(e){let t;if(Kr.test(e)){let a;for(t={};a=e.match(Kr);)e=e.slice(0,e.length-a[0].length),t[a[0].toLowerCase()]=!0}const a=':'===e[2]?e.slice(3):B(e.slice(2));return[a,t]}(t);if(s){const l=r[t]=function(e,t){const a=e=>{if(e._vts){if(e._vts<=a.attached)return}else e._vts=Date.now();Ht(function(e,t){if(y(t)){const a=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{a.call(e),e._stopped=!0},t.map(e=>t=>!t._stopped&&e&&e(t))}return t}(e,a.value),t,5,[e])};return a.value=e,a.attached=el(),a}(s,n);Qr(e,a,l,o)}else l&&(!function(e,t,a,s){e.removeEventListener(t,a,s)}(e,a,l,o),r[t]=void 0)}}const Kr=/(?:Once|Passive|Capture)$/;let Jr=0;const Zr=Promise.resolve(),el=()=>Jr||(Zr.then(()=>Jr=0),Jr=Date.now());const tl=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123;'undefined'!=typeof HTMLElement&&HTMLElement;const al=new WeakMap,sl=new WeakMap,nl=Symbol('_moveCb'),rl=Symbol('_enterCb'),ll=(e=>(delete e.props.mode,e))({name:'TransitionGroup',props:g({},xr,{tag:String,moveClass:String}),setup(e,{slots:t}){const a=Gn(),s=qa();let n,r;return ps(()=>{if(!n.length)return;const t=e.moveClass||`${e.name||'v'}-move`;if(!function(e,t,a){const s=e.cloneNode(),n=e[yr];n&&n.forEach(e=>{e.split(/\s+/).forEach(e=>e&&s.classList.remove(e))});a.split(/\s+/).forEach(e=>e&&s.classList.add(e)),s.style.display='none';const r=1===t.nodeType?t:t.parentNode;r.appendChild(s);const{hasTransform:l}=$r(s);return r.removeChild(s),l}(n[0].el,a.vnode.el,t))return void(n=[]);n.forEach(il),n.forEach(cl);const s=n.filter(dl);Nr(a.vnode.el),s.forEach(e=>{const a=e.el,s=a.style;Ir(a,t),s.transform=s.webkitTransform=s.transitionDuration='';const n=a[nl]=e=>{e&&e.target!==a||e&&!e.propertyName.endsWith('transform')||(a.removeEventListener('transitionend',n),a[nl]=null,Tr(a,t))};a.addEventListener('transitionend',n)}),n=[]}),()=>{const l=Tt(e),o=_r(l);let i=l.tag||pn;if(n=[],r)for(let e=0;e<r.length;e++){const t=r[e];t.el&&t.el instanceof Element&&(n.push(t),Ka(t,Qa(t,o,s,a)),al.set(t,{left:t.el.offsetLeft,top:t.el.offsetTop}))}r=t.default?Ja(t.default()):[];for(let e=0;e<r.length;e++){const t=r[e];null!=t.key&&Ka(t,Qa(t,o,s,a))}return En(i,null,r)}}}),ol=ll;function il(e){const t=e.el;t[nl]&&t[nl](),t[rl]&&t[rl]()}function cl(e){sl.set(e,{left:e.el.offsetLeft,top:e.el.offsetTop})}function dl(e){const t=al.get(e),a=sl.get(e),s=t.left-a.left,n=t.top-a.top;if(s||n){const t=e.el.style;return t.transform=t.webkitTransform=`translate(${s}px,${n}px)`,t.transitionDuration='0s',e}}const ul=e=>{const t=e.props['onUpdate:modelValue']||!1;return y(t)?e=>V(t,e):t};function pl(e){e.target.composing=!0}function ml(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event('input')))}const gl=Symbol('_assign');function hl(e,t,a){return t&&(e=e.trim()),a&&(e=H(e)),e}const fl={created(e,{modifiers:{lazy:t,trim:a,number:s}},n){e[gl]=ul(n);const r=s||n.props&&'number'===n.props.type;Qr(e,t?'change':'input',t=>{t.target.composing||e[gl](hl(e.value,a,r))}),(a||r)&&Qr(e,'change',()=>{e.value=hl(e.value,a,r)}),t||(Qr(e,'compositionstart',pl),Qr(e,'compositionend',ml),Qr(e,'change',ml))},mounted(e,{value:t}){e.value=null==t?'':t},beforeUpdate(e,{value:t,oldValue:a,modifiers:{lazy:s,trim:n,number:r}},l){if(e[gl]=ul(l),e.composing)return;const o=null==t?'':t;if((!r&&'number'!==e.type||/^0\d/.test(e.value)?e.value:H(e.value))!==o){if(document.activeElement===e&&'range'!==e.type){if(s&&t===a)return;if(n&&e.value.trim()===o)return}e.value=o}}},vl={deep:!0,created(e,_,t){e[gl]=ul(t),Qr(e,'change',()=>{const t=e._modelValue,a=wl(e),s=e.checked,n=e[gl];if(y(t)){const e=re(t,a),r=-1!==e;if(s&&!r)n(t.concat(a));else if(!s&&r){const a=[...t];a.splice(e,1),n(a)}}else if(x(t)){const e=new Set(t);s?e.add(a):e.delete(a),n(e)}else n(kl(e,s))})},mounted:yl,beforeUpdate(e,t,a){e[gl]=ul(a),yl(e,t,a)}};function yl(e,{value:t,oldValue:a},s){let n;if(e._modelValue=t,y(t))n=re(t,s.props.value)>-1;else if(x(t))n=t.has(s.props.value);else{if(t===a)return;n=ne(t,kl(e,!0))}e.checked!==n&&(e.checked=n)}const bl={deep:!0,created(e,{value:t,modifiers:{number:a}},s){const n=x(t);Qr(e,'change',()=>{const t=Array.prototype.filter.call(e.options,e=>e.selected).map(e=>a?H(wl(e)):wl(e));e[gl](e.multiple?n?new Set(t):t:t[0]),e._assigning=!0,Zt(()=>{e._assigning=!1})}),e[gl]=ul(s)},mounted(e,{value:t}){xl(e,t)},beforeUpdate(e,t,a){e[gl]=ul(a)},updated(e,{value:t}){e._assigning||xl(e,t)}};function xl(e,t){const a=e.multiple,s=y(t);if(!a||s||x(t)){for(let n=0,r=e.options.length;n<r;n++){const r=e.options[n],l=wl(r);if(a)if(s){const e=typeof l;r.selected='string'===e||'number'===e?t.some(e=>String(e)===String(l)):re(t,l)>-1}else r.selected=t.has(l);else if(ne(wl(r),t))return void(e.selectedIndex!==n&&(e.selectedIndex=n))}a||-1===e.selectedIndex||(e.selectedIndex=-1)}}function wl(e){return'_value'in e?e._value:e.value}function kl(e,t){const a=t?'_trueValue':'_falseValue';return a in e?e[a]:t}const Sl=['ctrl','shift','alt','meta'],_l={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>'button'in e&&0!==e.button,middle:e=>'button'in e&&1!==e.button,right:e=>'button'in e&&2!==e.button,exact:(e,t)=>Sl.some(a=>e[`${a}Key`]&&!t.includes(a))},Cl=(e,t)=>{const a=e._withMods||(e._withMods={}),s=t.join('.');return a[s]||(a[s]=(a,...s)=>{for(let e=0;e<t.length;e++){const s=_l[t[e]];if(s&&s(a,t))return}return e(a,...s)})},Il={esc:'escape',space:' ',up:'arrow-up',left:'arrow-left',right:'arrow-right',down:'arrow-down',delete:'backspace'},Tl=(e,t)=>{const a=e._withKeys||(e._withKeys={}),s=t.join('.');return a[s]||(a[s]=a=>{if(!('key'in a))return;const s=B(a.key);return t.some(e=>e===s||Il[e]===s)?e(a):void 0})},Al=g({patchProp:(e,t,a,s,n,r)=>{const l='svg'===n;'class'===t?function(e,t,a){const s=e[yr];s&&(t=(t?[t,...s]:[...s]).join(' ')),null==t?e.removeAttribute('class'):a?e.setAttribute('class',t):e.className=t}(e,s,l):'style'===t?function(e,t,a){const s=e.style,n=S(a);let r=!1;if(a&&!n){if(t)if(S(t))for(const e of t.split(';')){const t=e.slice(0,e.indexOf(':')).trim();null==a[t]&&Vr(s,t,'')}else for(const e in t)null==a[e]&&Vr(s,e,'');for(const e in a)'display'===e&&(r=!0),Vr(s,e,a[e])}else if(n){if(t!==a){const e=s[Or];e&&(a+=';'+e),s.cssText=a,r=qr.test(a)}}else t&&e.removeAttribute('style');Rr in e&&(e[Rr]=r?s.display:'',e[jr]&&(s.display='none'))}(e,a,s):p(t)?m(t)||Yr(e,t,0,s,r):('.'===t[0]?(t=t.slice(1),1):'^'===t[0]?(t=t.slice(1),0):function(e,t,a,s){if(s)return'innerHTML'===t||'textContent'===t||!!(t in e&&tl(t)&&k(a));if('spellcheck'===t||'draggable'===t||'translate'===t||'autocorrect'===t)return!1;if('sandbox'===t&&'IFRAME'===e.tagName)return!1;if('form'===t)return!1;if('list'===t&&'INPUT'===e.tagName)return!1;if('type'===t&&'TEXTAREA'===e.tagName)return!1;if('width'===t||'height'===t){const t=e.tagName;if('IMG'===t||'VIDEO'===t||'CANVAS'===t||'SOURCE'===t)return!1}if(tl(t)&&S(a))return!1;return t in e}(e,t,s,l))?(Wr(e,t,s),e.tagName.includes('-')||'value'!==t&&'checked'!==t&&'selected'!==t||zr(e,t,s,l,0,'value'!==t)):!e._isVueCE||!/[A-Z]/.test(t)&&S(s)?('true-value'===t?e._trueValue=s:'false-value'===t&&(e._falseValue=s),zr(e,t,s,l)):Wr(e,j(t),s,0,t)}},hr);let Ml;function El(){return Ml||(Ml=tn(Al))}const $l=(...e)=>{const t=El().createApp(...e);const{mount:a}=t;return t.mount=e=>{const s=Pl(e);if(!s)return;const n=t._component;k(n)||n.render||n.template||(n.template=s.innerHTML),1===s.nodeType&&(s.textContent='');const r=a(s,!1,Dl(s));return s instanceof Element&&(s.removeAttribute('v-cloak'),s.setAttribute('data-v-app','')),r},t};function Dl(e){return e instanceof SVGElement?'svg':'function'==typeof MathMLElement&&e instanceof MathMLElement?'mathml':void 0}function Pl(e){if(S(e)){return document.querySelector(e)}return e}const Nl=new class{listeners={};on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(a=>{try{a(t)}catch(t){console.error(`[EventBus] Error in listener for event "${e}":`,t)}})}async emitAsync(e,t){if(!this.listeners[e])return;const a=this.listeners[e].map(async a=>{try{await a(t)}catch(t){console.error(`[EventBus] Error in async listener for event "${e}":`,t)}});await Promise.all(a)}};var Rl,jl,Ll=l(173);class Bl{serviceName;eventBus=Nl;serviceLocator=Ll.serviceLocator;constructor(e){this.serviceName=e}register(){this.serviceLocator.register(this.serviceName,this)}destroy(){}}!function(e){e.TOOL_AI='tool_ai',e.STORY_POLISH='story_polish',e.ADVENTURE_SUMMARY='adventure_summary',e.ENEMY_GENERATE='enemy_generate',e.IMAGE_GENERATE='image_generate'}(Rl||(Rl={})),function(e){e.PENDING='pending',e.RUNNING='running',e.COMPLETED='completed',e.CANCELLED='cancelled',e.ERROR='error'}(jl||(jl={}));const Ol={[Rl.TOOL_AI]:'变量更新中',[Rl.STORY_POLISH]:'正文优化中',[Rl.ADVENTURE_SUMMARY]:'笔记总结中',[Rl.ENEMY_GENERATE]:'敌人生成中',[Rl.IMAGE_GENERATE]:'图片生成中'};class ql extends Bl{logger;_eventBus;_tasks=xt(new Map);taskIdCounter=0;AUTO_CLEANUP_DELAY=2e3;constructor(){super('BackgroundTaskService')}init(){const e=Ll.q.getInstance();this.logger=e.get('LoggerService');try{this._eventBus=e.get('EventBus')}catch{this.logger?.log('EventBus not registered')}this.logger?.log('BackgroundTaskService initialized')}get activeTasks(){return Array.from(this._tasks.values()).filter(e=>e.status===jl.RUNNING||e.status===jl.PENDING)}get allTasks(){return Array.from(this._tasks.values())}get hasActiveTasks(){return this.activeTasks.length>0}createTask(e,t){const a=`task_${++this.taskIdCounter}_${Date.now()}`,s=new AbortController,n={id:a,type:e,label:t||Ol[e],status:jl.PENDING,startTime:Date.now(),abortController:s};return this._tasks.set(a,n),this.logger?.log(`Task created: ${a} (${n.label})`),this.emitUpdate(),{taskId:a,abortController:s}}startTask(e){const t=this._tasks.get(e);t&&t.status===jl.PENDING&&(t.status=jl.RUNNING,this.logger?.log(`Task started: ${e}`),this.emitUpdate())}updateProgress(e,t){const a=this._tasks.get(e);a&&(a.progress=Math.max(0,Math.min(100,t)),this.emitUpdate())}completeTask(e){const t=this._tasks.get(e);t&&(t.status=jl.COMPLETED,t.endTime=Date.now(),t.progress=100,this.logger?.log(`Task completed: ${e} (${t.endTime-t.startTime}ms)`),this.emitUpdate(),setTimeout(()=>{this.removeTask(e)},this.AUTO_CLEANUP_DELAY))}cancelTask(e){const t=this._tasks.get(e);!t||t.status!==jl.RUNNING&&t.status!==jl.PENDING||(t.abortController?.abort(),t.onCancel?.(),t.status=jl.CANCELLED,t.endTime=Date.now(),this.logger?.log(`Task cancelled: ${e}`),this.removeTask(e))}setTaskError(e,t){const a=this._tasks.get(e);a&&(a.status=jl.ERROR,a.error=t,a.endTime=Date.now(),this.logger?.log(`Task error: ${e} - ${t}`),this.emitUpdate(),setTimeout(()=>{this.removeTask(e)},2*this.AUTO_CLEANUP_DELAY))}setOnCancel(e,t){const a=this._tasks.get(e);a&&(a.onCancel=t)}removeTask(e){this._tasks.has(e)&&(this._tasks.delete(e),this.logger?.log(`Task removed: ${e}`),this.emitUpdate())}clearInactiveTasks(){for(const[e,t]of this._tasks)t.status!==jl.COMPLETED&&t.status!==jl.CANCELLED&&t.status!==jl.ERROR||this._tasks.delete(e);this.emitUpdate()}cancelAllTasks(){for(const e of this._tasks.values())e.status!==jl.RUNNING&&e.status!==jl.PENDING||this.cancelTask(e.id)}emitUpdate(){this._eventBus?.emit('background_task:updated',{tasks:this.activeTasks,count:this.activeTasks.length})}}const Ul=$t([]);function Vl(){return(()=>{try{Ll.q.getInstance().get('EventBus').on('background_task:updated',e=>{Ul.value=e.tasks}),(()=>{try{const e=Ll.q.getInstance().get('BackgroundTaskService');Ul.value=e.activeTasks}catch{}})()}catch{}})(),{tasks:ir(()=>Ul.value),hasActiveTasks:ir(()=>Ul.value.length>0),taskCount:ir(()=>Ul.value.length),cancelTask:e=>{try{Ll.q.getInstance().get('BackgroundTaskService').cancelTask(e)}catch{console.error('BackgroundTaskService not available')}}}}class Fl{static getAttribute(e,t){const a=e.attributes[t]??e.attributes[t.toUpperCase()]??e.attributes[t.toLowerCase()]??0,s=e.statModifiers?.[t.toLowerCase()]||0;return Math.max(1,a+s)}static hasEffectTag(e,t){return e.statusEffects.some(e=>e.tags?.includes(t))}static getEffectsByTag(e,t){return e.statusEffects.filter(e=>e.tags?.includes(t))}static canAct(e){return!e.isDead&&(!e.isStunned&&!e.statusEffects.some(e=>e.preventsAction))}static canUseSkills(e){return!!this.canAct(e)&&(!e.isSilenced&&!e.statusEffects.some(e=>e.preventsSkills))}static getForcedTarget(e){if(e.isTaunted&&e.tauntSourceId)return e.tauntSourceId;for(const t of e.statusEffects)if(t.forcedTarget)return t.forcedTarget;return null}static getTotalShieldValue(e){return e.shields.filter(e=>'value'===e.type).reduce((e,t)=>e+t.value,0)}static getShieldCharges(e){return e.shields.filter(e=>'count'===e.type).reduce((e,t)=>e+t.value,0)}static hasShieldType(e,t){return e.shields.some(e=>e.type===t&&e.value>0)}static getResourcePercent(e,t){const a=e.stats[t];return!a||a.max<=0?0:a.current/a.max*100}static checkThreshold(e,t,a,s){const n=this.getResourcePercent(e,t);switch(a){case'<':return n<s;case'<=':return n<=s;case'>':return n>s;case'>=':return n>=s;case'==':return n===s;case'!=':return n!==s;default:return!1}}static getEffectsByTrigger(e,t){const a=[];e.equipment&&Object.entries(e.equipment).forEach(([e,s])=>{s.effects&&s.effects.forEach(e=>{e.trigger===t&&a.push({effect:e,source:s.name,sourceType:'equipment'})})});return[...Object.values(e.skills||{}),...Object.values(e.passiveSkills||{})].forEach(e=>{'passive'===e.type&&e.effects&&e.effects.forEach(s=>{s.trigger===t&&a.push({effect:s,source:e.name,sourceType:'passive'})})}),a}static getLifestealPercent(e){let t=e.statModifiers?.lifesteal||0;if(e.statusEffects)for(const a of e.statusEffects)a.modifiers?.lifesteal&&(t+=a.modifiers.lifesteal);return t}}const Hl=[{id:'physical',label:'物理',icon:'⚔️',children:[{id:'slashing',label:'斩击',icon:'🗡️'},{id:'bludgeoning',label:'钝击',icon:'🔨'},{id:'piercing',label:'穿刺',icon:'🔱'}]},{id:'magic',label:'魔法',icon:'🔮',children:[{id:'elemental',label:'元素',icon:'🌀',children:[{id:'fire',label:'火焰',icon:'🔥'},{id:'ice',label:'冰霜',icon:'❄️'},{id:'lightning',label:'雷电',icon:'⚡'},{id:'water',label:'水',icon:'💧'},{id:'earth',label:'土',icon:'🪨'},{id:'wind',label:'风',icon:'🌬️'},{id:'nature',label:'自然',icon:'🌿'}]},{id:'special',label:'特殊',icon:'✨',children:[{id:'light',label:'光明',icon:'✨'},{id:'dark',label:'暗影',icon:'🌑'},{id:'poison',label:'毒素',icon:'🧪'},{id:'psychic',label:'心灵',icon:'🧠'},{id:'force',label:'力场',icon:'💫'},{id:'sonic',label:'音波',icon:'🔊'},{id:'void',label:'虚空',icon:'🕳️'},{id:'arcane',label:'奥术',icon:'🔮'},{id:'time',label:'时间',icon:'⏰'},{id:'space',label:'空间',icon:'🌌'},{id:'gravity',label:'重力',icon:'🪐'},{id:'blood',label:'血液',icon:'🩸'},{id:'curse',label:'诅咒',icon:'💀'},{id:'holy',label:'神圣',icon:'✝️'},{id:'chaos',label:'混沌',icon:'🌪️'},{id:'order',label:'秩序',icon:'⚖️'},{id:'life',label:'生命',icon:'💚'},{id:'death',label:'死亡',icon:'☠️'},{id:'dream',label:'梦境',icon:'💭'},{id:'reality',label:'现实',icon:'🔮'},{id:'emotion',label:'情感',icon:'💗'},{id:'concept',label:'概念',icon:'💡'}]}]},{id:'true',label:'真实',icon:'💎'}],Gl={slash:'slashing',cut:'slashing',blunt:'bludgeoning',crush:'bludgeoning',pierce:'piercing',stab:'piercing',flame:'fire',burn:'fire',burning:'fire',inferno:'fire',cold:'ice',frost:'ice',freeze:'ice',frozen:'ice',thunder:'lightning',electric:'lightning',shock:'lightning',aqua:'water',ground:'earth',rock:'earth',stone:'earth',air:'wind',gust:'wind',plant:'nature',wood:'nature',radiant:'light',sacred:'light',divine:'light',shadow:'dark',necrotic:'dark',acid:'poison',toxic:'poison',venom:'poison',mental:'psychic',mind:'psychic',temporal:'time',chrono:'time',spatial:'space',dimension:'space',vitality:'life',mortality:'death',necro:'death',lawful:'order',chaotic:'chaos',entropy:'chaos',blood_magic:'blood',hemomancy:'blood',cursed:'curse',hex:'curse',blessed:'holy',consecrated:'holy',melee:'melee',ranged:'ranged',heal:'heal',healing:'heal',buff:'buff',debuff:'debuff',dot:'dot',hot:'hot',stun:'stun',silence:'silence',blind:'blind',slow:'slow',root:'root',charm:'charm',fear:'fear',taunt:'taunt',bleed:'bleed',cleanse:'cleanse',purify:'cleanse',dispel:'dispel',revive:'revive',summon:'summon',dodge:'dodge',block:'block',parry:'block',defensive:'defensive',support:'support',aoe:'aoe',area:'aoe',passive:'passive',active:'active'},zl={physical:{name:'物理',icon:'⚔️',category:'damage'},slashing:{name:'斩击',icon:'🗡️',category:'damage'},bludgeoning:{name:'钝击',icon:'🔨',category:'damage'},piercing:{name:'穿刺',icon:'🔱',category:'damage'},magic:{name:'魔法',icon:'🔮',category:'damage'},elemental:{name:'元素',icon:'🌀',category:'damage'},fire:{name:'火焰',icon:'🔥',category:'damage'},ice:{name:'冰霜',icon:'❄️',category:'damage'},lightning:{name:'雷电',icon:'⚡',category:'damage'},water:{name:'水',icon:'💧',category:'damage'},earth:{name:'土',icon:'🪨',category:'damage'},wind:{name:'风',icon:'🌬️',category:'damage'},nature:{name:'自然',icon:'🌿',category:'damage'},special:{name:'特殊',icon:'✨',category:'damage'},light:{name:'光明',icon:'✨',category:'damage'},dark:{name:'暗影',icon:'🌑',category:'damage'},poison:{name:'毒素',icon:'🧪',category:'damage'},psychic:{name:'心灵',icon:'🧠',category:'damage'},force:{name:'力场',icon:'💫',category:'damage'},sonic:{name:'音波',icon:'🔊',category:'damage'},void:{name:'虚空',icon:'🕳️',category:'damage'},arcane:{name:'奥术',icon:'🔮',category:'damage'},time:{name:'时间',icon:'⏰',category:'damage'},space:{name:'空间',icon:'🌌',category:'damage'},gravity:{name:'重力',icon:'🪐',category:'damage'},blood:{name:'血液',icon:'🩸',category:'damage'},curse:{name:'诅咒',icon:'💀',category:'damage'},holy:{name:'神圣',icon:'✝️',category:'damage'},chaos:{name:'混沌',icon:'🌪️',category:'damage'},order:{name:'秩序',icon:'⚖️',category:'damage'},life:{name:'生命',icon:'💚',category:'damage'},death:{name:'死亡',icon:'☠️',category:'damage'},dream:{name:'梦境',icon:'💭',category:'damage'},reality:{name:'现实',icon:'🔮',category:'damage'},emotion:{name:'情感',icon:'💗',category:'damage'},concept:{name:'概念',icon:'💡',category:'damage'},true:{name:'真实',icon:'💎',category:'damage'},heal:{name:'治疗',icon:'💚',category:'effect'},buff:{name:'增益',icon:'⬆️',category:'effect'},debuff:{name:'减益',icon:'⬇️',category:'effect'},dot:{name:'持续伤害',icon:'🩸',category:'effect'},hot:{name:'持续治疗',icon:'💖',category:'effect'},stun:{name:'眩晕',icon:'💫',category:'effect'},silence:{name:'沉默',icon:'🔇',category:'effect'},blind:{name:'致盲',icon:'👁️',category:'effect'},slow:{name:'减速',icon:'🐌',category:'effect'},root:{name:'定身',icon:'🌳',category:'effect'},charm:{name:'魅惑',icon:'💕',category:'effect'},fear:{name:'恐惧',icon:'😱',category:'effect'},taunt:{name:'嘲讽',icon:'😤',category:'effect'},bleed:{name:'流血',icon:'🩸',category:'effect'},cleanse:{name:'净化',icon:'✨',category:'effect'},dispel:{name:'驱散',icon:'💨',category:'effect'},revive:{name:'复活',icon:'💖',category:'effect'},summon:{name:'召唤',icon:'👻',category:'effect'},dodge:{name:'闪避',icon:'🏃',category:'effect'},block:{name:'格挡',icon:'🛡️',category:'effect'},melee:{name:'近战',icon:'⚔️',category:'skill'},ranged:{name:'远程',icon:'🏹',category:'skill'},defensive:{name:'防御',icon:'🛡️',category:'skill'},support:{name:'辅助',icon:'💫',category:'skill'},aoe:{name:'范围',icon:'💥',category:'skill'},passive:{name:'被动',icon:'📖',category:'skill'},active:{name:'主动',icon:'⚡',category:'skill'},mythical:{name:'神话',icon:'🔴',category:'other'},legendary:{name:'传说',icon:'🟡',category:'other'},epic:{name:'史诗',icon:'🟣',category:'other'},rare:{name:'稀有',icon:'🔵',category:'other'},uncommon:{name:'优秀',icon:'🟢',category:'other'},common:{name:'普通',icon:'⚪',category:'other'},talent:{name:'天赋',icon:'✨',category:'other'},power:{name:'权能',icon:'👑',category:'other'},cursed:{name:'诅咒',icon:'💀',category:'other'},forbidden:{name:'禁忌',icon:'⛔',category:'other'},racial:{name:'种族',icon:'🧬',category:'other'},dragon:{name:'龙族',icon:'🐉',category:'other'},demon:{name:'魔族',icon:'😈',category:'other'},undead:{name:'不死',icon:'💀',category:'other'},beast:{name:'野兽',icon:'🐺',category:'other'},humanoid:{name:'类人',icon:'🧍',category:'other'},construct:{name:'构装',icon:'🤖',category:'other'},slime:{name:'史莱姆',icon:'🫧',category:'other'},tech:{name:'科技',icon:'⚙️',category:'other'},absorption:{name:'吸收',icon:'🌀',category:'other'},adaptation:{name:'适应',icon:'🔄',category:'other'},drain:{name:'汲取',icon:'🧛',category:'other'},hp:{name:'HP',icon:'❤️',category:'other'},mp:{name:'MP',icon:'💙',category:'other'},sp:{name:'SP',icon:'💚',category:'other'}};function Wl(e){const t=e.toLowerCase();return Gl[t]?Gl[t]:t}function Ql(e){const t=e.map(Wl);return[...new Set(t)]}function Xl(e){const t=Wl(e),a=zl[t];return a?{name:a.name,icon:a.icon}:{name:e,icon:'📌'}}const Yl=[];!function e(t){t.forEach(t=>{Yl.push(t.id),t.children&&e(t.children)})}(Hl);class Kl{static isSubType(e,t){const a=Wl(e),s=Wl(t);if(a===s)return!0;const n=e=>{for(const t of e){if(t.id===s)return this.containsChild(t,a);if(t.children&&n(t.children))return!0}return!1};return n(Hl)}static containsChild(e,t){if(e.id===t)return!0;if(!e.children)return!1;for(const a of e.children)if(this.containsChild(a,t))return!0;return!1}static getParentTypes(e){const t=Wl(e),a=[],s=(e,n)=>{for(const r of e){const e=[...n,r.id];if(r.id===t)return a.push(...e),!0;if(r.children&&s(r.children,e))return!0}return!1};return s(Hl,[]),a.reverse()}static getTypeInfo(e){return Xl(e)}}const Jl={physical:'#8B4513',slashing:'#A0522D',bludgeoning:'#CD853F',piercing:'#D2691E',fire:'#FF4500',flame:'#FF6347',burn:'#DC143C',ice:'#4169E1',cold:'#1E90FF',frost:'#87CEEB',water:'#4169E1',freeze:'#1E90FF',lightning:'#FFD700',thunder:'#FFA500',electric:'#9370DB',dark:'#2F4F4F',shadow:'#696969',necrotic:'#483D8B',light:'#FFD700',holy:'#F0E68C',radiant:'#FFFFE0',nature:'#228B22',poison:'#9ACD32',earth:'#8B7355',wind:'#20B2AA',air:'#20B2AA',magic:'#8A2BE2',psychic:'#9370DB',arcane:'#8A2BE2',void:'#4B0082',force:'#6A5ACD',time:'#20B2AA',space:'#48D1CC',gravity:'#5F9EA0',life:'#32CD32',death:'#8B0000',blood:'#8B0000',curse:'#800080',order:'#4682B4',chaos:'#DC143C',dream:'#DDA0DD',reality:'#708090',emotion:'#FF69B4',concept:'#9370DB',heal:'#90EE90',support:'#90EE90',buff:'#FFD700',debuff:'#FFA07A',damage:'#FF4500',drain:'#FF69B4',lifesteal:'#FF69B4',shield:'#87CEEB',dot:'#CD5C5C',hot:'#98FB98',stun:'#FFD700',slow:'#778899',silence:'#696969',root:'#8B7355',bleed:'#8B0000',cleanse:'#87CEEB',dispel:'#B0C4DE',melee:'#A9A9A9',ranged:'#778899',aoe:'#BC8F8F',passive:'#D3D3D3',active:'#B0C4DE',defensive:'#87CEEB',offensive:'#FF4500',exploration:'#20B2AA',mythical:'#FF4500',legendary:'#FFD700',epic:'#800080',rare:'#4169E1',uncommon:'#228B22',common:'#A9A9A9',cursed:'#696969',power:'#FF4500',talent:'#FFD700',forbidden:'#8B0000',racial:'#228B22',dragon:'#FF4500',demon:'#800080',undead:'#696969',beast:'#CD853F',humanoid:'#778899',construct:'#8B7355',slime:'#48D1CC',adaptation:'#20B2AA',tech:'#778899',absorption:'#8A2BE2',blunt:'#CD853F',dodge:'#87CEEB',slash:'#A0522D',purify:'#FFD700',single:'#A9A9A9',self:'#48D1CC',true:'#FFFFFF'};function Zl(e){const t=Wl(e);return Jl[t]||'#808080'}var eo;!function(e){e.IMMUNE='immune',e.VERY_HIGH='very_high',e.HIGH='high',e.MODERATE='moderate',e.NORMAL='normal',e.WEAK='weak',e.VERY_WEAK='very_weak',e.VULNERABLE='vulnerable'}(eo||(eo={}));const to={[eo.IMMUNE]:0,[eo.VERY_HIGH]:.25,[eo.HIGH]:.5,[eo.MODERATE]:.75,[eo.NORMAL]:1,[eo.WEAK]:1.25,[eo.VERY_WEAK]:1.5,[eo.VULNERABLE]:1.75};var ao;!function(e){e.HUMAN='human',e.ELF='elf',e.DWARF='dwarf',e.ORC='orc',e.UNDEAD='undead',e.DEMON='demon',e.ANGEL='angel',e.DRAGON='dragon',e.BEAST='beast',e.ELEMENTAL='elemental',e.CONSTRUCT='construct',e.PLANT='plant',e.SLIME='slime',e.SPIRIT='spirit',e.ABERRATION='aberration'}(ao||(ao={}));const so={[ao.HUMAN]:{damageTypes:{}},[ao.ELF]:{damageTypes:{psychic:eo.MODERATE},effectTags:{charm:eo.HIGH,sleep:eo.MODERATE}},[ao.DWARF]:{damageTypes:{poison:eo.HIGH},effectTags:{poison:eo.HIGH}},[ao.ORC]:{damageTypes:{bludgeoning:eo.MODERATE},effectTags:{fear:eo.HIGH}},[ao.UNDEAD]:{damageTypes:{poison:eo.IMMUNE,psychic:eo.HIGH,dark:eo.HIGH,light:eo.VULNERABLE},effectTags:{poison:eo.IMMUNE,bleed:eo.IMMUNE,charm:eo.IMMUNE,sleep:eo.IMMUNE,fear:eo.IMMUNE}},[ao.DEMON]:{damageTypes:{fire:eo.HIGH,poison:eo.MODERATE,light:eo.WEAK},effectTags:{fear:eo.IMMUNE}},[ao.ANGEL]:{damageTypes:{light:eo.IMMUNE,dark:eo.WEAK},effectTags:{charm:eo.IMMUNE,fear:eo.IMMUNE}},[ao.DRAGON]:{damageTypes:{fire:eo.VERY_HIGH},effectTags:{fear:eo.HIGH,stun:eo.MODERATE}},[ao.BEAST]:{damageTypes:{},effectTags:{charm:eo.HIGH}},[ao.ELEMENTAL]:{damageTypes:{poison:eo.IMMUNE,psychic:eo.HIGH},effectTags:{poison:eo.IMMUNE,bleed:eo.IMMUNE,sleep:eo.IMMUNE}},[ao.CONSTRUCT]:{damageTypes:{poison:eo.IMMUNE,psychic:eo.IMMUNE},effectTags:{poison:eo.IMMUNE,bleed:eo.IMMUNE,sleep:eo.IMMUNE,charm:eo.IMMUNE,fear:eo.IMMUNE,stun:eo.MODERATE}},[ao.PLANT]:{damageTypes:{fire:eo.VULNERABLE,ice:eo.WEAK,poison:eo.HIGH},effectTags:{poison:eo.HIGH,charm:eo.IMMUNE,fear:eo.IMMUNE}},[ao.SLIME]:{damageTypes:{physical:eo.HIGH,slashing:eo.VERY_HIGH,piercing:eo.VERY_HIGH,bludgeoning:eo.MODERATE,poison:eo.IMMUNE},effectTags:{poison:eo.IMMUNE,bleed:eo.IMMUNE,stun:eo.IMMUNE}},[ao.SPIRIT]:{damageTypes:{physical:eo.VERY_HIGH,force:eo.WEAK},effectTags:{poison:eo.IMMUNE,bleed:eo.IMMUNE}},[ao.ABERRATION]:{damageTypes:{psychic:eo.HIGH},effectTags:{confuse:eo.IMMUNE,fear:eo.HIGH}}};class no{static getDamageResistance(e,t,a=[]){if(e.damageTypes[t])return e.damageTypes[t];for(const t of a)if(e.damageTypes[t])return e.damageTypes[t];return eo.NORMAL}static getEffectResistance(e,t){return e.effectTags?.[t]||eo.NORMAL}static getDamageModifier(e){return to[e]}static mergeConfigs(...e){const t={damageTypes:{},effectTags:{}},a=[eo.IMMUNE,eo.VERY_HIGH,eo.HIGH,eo.MODERATE,eo.NORMAL,eo.WEAK,eo.VERY_WEAK,eo.VULNERABLE],s=(e,t)=>a.indexOf(e)<=a.indexOf(t)?e:t;return e.forEach(e=>{e.damageTypes&&Object.entries(e.damageTypes).forEach(([e,a])=>{t.damageTypes[e]?t.damageTypes[e]=s(t.damageTypes[e],a):t.damageTypes[e]=a}),e.effectTags&&Object.entries(e.effectTags).forEach(([e,a])=>{t.effectTags[e]?t.effectTags[e]=s(t.effectTags[e],a):t.effectTags[e]=a})}),t}static getFromRace(e){return so[e]||{}}static getEffectChance(e,t){switch(t){case eo.IMMUNE:return 0;case eo.VERY_HIGH:return.25*e;case eo.HIGH:return.5*e;case eo.MODERATE:return.75*e;case eo.NORMAL:return e;case eo.WEAK:return Math.min(100,1.25*e);case eo.VERY_WEAK:return Math.min(100,1.5*e);case eo.VULNERABLE:return Math.min(100,1.75*e);default:return e}}}var ro,lo=l(188);class oo{static getAttribute(e,t){return Fl.getAttribute(e,t)}static getHitStatValue(e,t){const a=t.hitStat||'auto';if('auto'===a){const t=['STR','DEX','INT','WIS'];return Math.max(...t.map(t=>this.getAttribute(e,t)))}return Array.isArray(a)?Math.max(...a.map(t=>this.getAttribute(e,t))):this.getAttribute(e,String(a))}static checkHit(e,t,a){const s=2*this.getHitStatValue(e,a)+e.level,n=this.getAttribute(e,'hitRate')||0,r=this.getAttribute(t,'DEX'),l=this.getAttribute(t,'AC')||10,o=this.getAttribute(t,'dodgeRate')||0;let i=50+2*(s-(l+Math.floor((r-10)/2)+t.level+o))+n;i=Math.max(5,Math.min(95,i));const c=lo.DiceRoller.roll('1d100'),d=c<=i,u=!d,p=!d&&c<=i+20,m=this.getAttribute(t,'blockRate')||0,g=d&&!p&&m>0&&lo.DiceRoller.roll('1d100')<=m,h=this.getAttribute(e,'CRIT_RATE')||5,f=this.getAttribute(e,'critRate')||0,v=Math.min(100,h+f);return{isHit:d||p,isCrit:d&&!p&&!g&&lo.DiceRoller.roll('1d100')<=v,isGlance:p,isDodge:u&&!p,isBlock:g,roll:c,hitChance:i,critChance:v,glanceThreshold:20}}static calculateDamage(e,t,a,s){let n=lo.DiceRoller.evaluate(a.value||0,e,t);if(s.isBlock){n*=(100-(this.getAttribute(t,'blockReduction')||50))/100}if(s.isGlance)n*=.3;else if(s.isCrit){n*=((this.getAttribute(e,'CRIT_DMG')||150)+(this.getAttribute(e,'critDamage')||0))/100}let r=0;r+=this.getAttribute(e,'damage')||0;const l=a.tags?Ql(a.tags):[];l.length>0&&l.forEach(t=>{r+=this.getAttribute(e,`${t}_dmg`)||0;Kl.getParentTypes(t).forEach(t=>{r+=this.getAttribute(e,`${t}_dmg`)||0})}),n*=1+r/100;n*=1+(this.getAttribute(t,'damageTaken')||0)/100;const o=n;let i=0;const c=l.length>0?l[0]:void 0,d=l.some(e=>Kl.isSubType(e,'magic'));i=l.includes('true')?0:d?this.getAttribute(t,'INT')+(this.getAttribute(t,'magic_resist')||0):(this.getAttribute(t,'AC')||0)+this.getAttribute(t,'CON');const u=this.getAttribute(e,'penetration')||0;i=Math.max(0,i-u);let p=1,m=eo.NORMAL;if(c&&t.resistances){const e=Kl.getParentTypes(c);m=no.getDamageResistance(t.resistances,c,e),p=no.getDamageModifier(m)}let g=this.getAttribute(t,'all_res')||0;if(c){g+=this.getAttribute(t,`${c}_res`)||0;Kl.getParentTypes(c).forEach(e=>{g+=this.getAttribute(t,`${e}_res`)||0})}p*=1-Math.min(90,g)/100;let h=n*(100/(100+i))*p;return h=Math.max(1,Math.floor(h)),{total:h,rawDamage:Math.floor(o),isCrit:s.isCrit,isGlance:s.isGlance,damageType:c,resistanceLevel:m,breakdown:{base:Math.floor(o),scaling:r,variance:0,mitigation:i,resistance:Math.floor(100*(1-p)),shieldAbsorbed:0}}}static calculateMultiHit(e,t,a,s){const n=a.hitCount??1,r=a.hitDamageRatio??[1],l={hits:[],totalDamage:0,hitsLanded:0,critCount:0};for(let o=0;o<n;o++){const n=this.checkHit(e,t,a),i=r[o]??r[r.length-1]??1,c={...s,value:'number'==typeof s.value?s.value*i:s.value};let d;n.isHit?(d=this.calculateDamage(e,t,c,n),'string'==typeof s.value&&(d.total=Math.floor(d.total*i),d.rawDamage=Math.floor(d.rawDamage*i)),l.totalDamage+=d.total,l.hitsLanded++,n.isCrit&&l.critCount++):d={total:0,rawDamage:0,isCrit:!1,isGlance:!1,breakdown:{base:0,scaling:0,variance:0,mitigation:0,resistance:0,shieldAbsorbed:0}},l.hits.push({hitResult:n,damageResult:d})}return l}static calculateExpReward(e,t){const a=10*e.level,s=e.level-t;let n=1;return s>0?n=1+.1*s:s<0&&(n=Math.max(.1,1+.15*s)),Math.floor(a*n)}static calculateGoldDrop(e){return 5*e.level+lo.DiceRoller.roll('1d10')}}!function(e){e[e.INSTANT=-3e3]='INSTANT',e[e.LIGHT=0]='LIGHT',e[e.MEDIUM=2e3]='MEDIUM',e[e.HEAVY=4e3]='HEAVY'}(ro||(ro={}));const io=1e4,co=1e4,uo=100,po=10,mo=500;class go{units=new Map;eventLog=[];gameTime=0;constructor(){}addUnit(e,t,a,s,n){const r=Math.max(po,Math.min(mo,a)),l={id:e,name:t,currentPosition:n?.initialPosition??io*(1-r/mo*.5),baseSpeed:r,speedModifier:0,isPlayer:s,isSummon:n?.isSummon,summonerId:n?.summonerId,isDead:!1,extraTurns:0};this.units.set(e,l)}removeUnit(e){this.units.delete(e)}markDead(e){const t=this.units.get(e);t&&(t.isDead=!0)}reviveUnit(e,t=50){const a=this.units.get(e);a&&(a.isDead=!1,a.currentPosition=io*t/100)}getEffectiveSpeed(e){const t=e.baseSpeed+e.speedModifier;return Math.max(po,Math.min(mo,t))}advanceTime(e){this.gameTime+=e,this.units.forEach(t=>{if(t.isDead)return;const a=this.getEffectiveSpeed(t)/uo*e;t.currentPosition=Math.max(0,t.currentPosition-a)})}advanceToNextAction(){const e=Array.from(this.units.values()).filter(e=>!e.isDead);if(0===e.length)return null;let t=null,a=1/0;for(const s of e){if(s.currentPosition<=0){s.currentPosition<a&&(a=s.currentPosition,t=s.id);continue}const e=this.getEffectiveSpeed(s),n=s.currentPosition/e*uo;n<a&&(a=n,t=s.id)}if(!t)return null;const s=this.units.get(t);if(!s)return null;if(s.currentPosition>0){const e=this.getEffectiveSpeed(s),t=s.currentPosition/e*uo;this.advanceTime(t)}return s.id}afterAction(e,t=ro.LIGHT){const a=this.units.get(e);if(!a)return;if(a.extraTurns>0)return a.extraTurns--,a.currentPosition=0,a.isExtraTurn=!0,void this.logEvent('extra_turn',e,`${a.name} 消耗额外回合，立即再次行动！(剩余: ${a.extraTurns})`);const s=co+t;a.currentPosition=Math.max(0,s),a.isExtraTurn=!1,this.logEvent('action',e,`${a.name} 行动完毕，延迟 ${s}`)}advanceUnit(e,t){const a=this.units.get(e);if(!a||a.isDead)return;const s=io*t/100;a.currentPosition=Math.max(0,a.currentPosition-s),this.logEvent('advance',e,`${a.name} 行动条前进 ${t}%`)}delayUnit(e,t){const a=this.units.get(e);if(!a||a.isDead)return;const s=io*t/100;a.currentPosition+=s,this.logEvent('delay',e,`${a.name} 行动条后退 ${t}%`)}grantExtraTurn(e,t=1){const a=this.units.get(e);if(!a||a.isDead)return;const s=t+1;a.extraTurns+=s,this.logEvent('extra_turn',e,`${a.name} 获得 ${s} 个额外回合！(总计: ${a.extraTurns})`)}updateSpeedModifier(e,t){const a=this.units.get(e);a&&(a.speedModifier=t)}getActionOrder(e=10){const t=new Map;this.units.forEach((e,a)=>{e.isDead||t.set(a,{...e})});const a=[],s=this.units;for(let n=0;n<e&&t.size>0;n++){let e=null,n=1/0;for(const[a,s]of t){const t=this.getEffectiveSpeed(s),r=s.currentPosition<=0?0:s.currentPosition/t*uo;r<n&&(n=r,e=a)}if(!e)break;const r=t.get(e);if(!r)break;if(n>0)for(const e of t.values()){const t=this.getEffectiveSpeed(e)/uo*n;e.currentPosition=Math.max(0,e.currentPosition-t)}const l=s.get(r.id);l&&a.push({...l,currentPosition:r.currentPosition,isExtraTurn:r.extraTurns>0,extraTurns:r.extraTurns}),r.extraTurns>0?(r.extraTurns--,r.currentPosition=0):r.currentPosition=co}return a}getAllUnits(){return Array.from(this.units.values()).filter(e=>!e.isDead).sort((e,t)=>e.currentPosition-t.currentPosition)}getUnit(e){return this.units.get(e)}getEventLog(){return[...this.eventLog]}clearEventLog(){this.eventLog=[]}logEvent(e,a,s){const n=this.units.get(a);this.eventLog.push({id:t(),type:e,unitId:a,unitName:n?.name||'Unknown',timestamp:this.gameTime,description:s})}exportState(){return{units:Array.from(this.units.values()),gameTime:this.gameTime}}importState(e){this.units.clear(),e.units.forEach(e=>{this.units.set(e.id,{...e})}),this.gameTime=e.gameTime}reset(){this.units.clear(),this.eventLog=[],this.gameTime=0}}const ho=['STR','DEX','CON','INT','WIS','CHA','CRIT_RATE','SPD','CRIT_DMG','AC'],fo={STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,SPD:100,CRIT_RATE:5,CRIT_DMG:150,AC:10};function vo(e){const t={...fo,...e.attributes||{}};return{id:e.id,name:e.name,race:e.race||'人类',class:e.class||'冒险者',level:e.level||1,avatar:e.avatar,gender:e.gender||'未知',allyType:e.allyType||'companion',affinity:e.affinity??50,recruitedAt:e.recruitedAt||(new Date).toISOString(),relationship:e.relationship||'队友',personality:e.personality,background:e.background,stats:e.stats||{hp:{current:50,max:50},mp:{current:30,max:30},sp:{current:40,max:40}},attributes:t,equipment:e.equipment||{},skills:e.skills||{},statusEffects:e.statusEffects||[],shields:e.shields||[],statModifiers:e.statModifiers||{},aiType:e.aiType||'follow',aiPriority:e.aiPriority||[],isActive:e.isActive??!0,isAvailable:e.isAvailable??!0,isStarred:e.isStarred??!1,private:e.private}}vo({id:'ally_001',name:'艾丽娅',race:'精灵',class:'战士',level:5,avatar:'🧝',gender:'女',allyType:'companion',affinity:85,relationship:'冒险伙伴',personality:'勇敢、正义',background:'来自精灵王国的流亡战士，因故离开故土加入了你的队伍。',appearance:{hair_color:'银白色',hair_length:'及腰长发',hair_style:'披肩',eye_color:'翠绿色',height:'168cm',body_build:'纤细匀称',skin_tone:'白皙',racial_traits:'尖耳'},stats:{hp:{current:80,max:80},mp:{current:20,max:20},sp:{current:60,max:60}},attributes:{STR:14,DEX:12,CON:13,INT:10,WIS:11,CHA:10,SPD:100},private:{Body_Type:'少女',Breast_Size:'B',Virginity_Status:'处女',Sexual_Orientation:'异性恋'}}),vo({id:'ally_002',name:'梅林',race:'人类',class:'法师',level:3,avatar:'🧙',gender:'男',allyType:'mercenary',affinity:60,relationship:'雇佣关系',personality:'睿智、孤傲',background:'流浪的法师，为金币而战。',appearance:{hair_color:'深棕色',hair_length:'及肩',eye_color:'灰蓝色',height:'180cm',body_build:'清瘦',skin_tone:'小麦色',face_features:'络腮胡，深邃眼窝'},stats:{hp:{current:40,max:40},mp:{current:80,max:80},sp:{current:30,max:30}},attributes:{STR:8,DEX:10,CON:9,INT:16,WIS:14,CHA:12,SPD:90},private:{Body_Type:'青壮',Penis_Length:'15cm',Virginity_Status:'非童贞'}});function yo(e){const t=function(e){switch(e){case'enemy':default:return'single_enemy';case'ally':return'single_ally';case'enemies':return'all_enemies';case'allies':return'all_allies';case'single_enemy':case'single_ally':case'all_enemies':case'all_allies':case'self':case'random_enemy':case'random_ally':return e}}(e);switch(t){case'single_enemy':default:return{mode:'single',side:'enemy'};case'single_ally':return{mode:'single',side:'ally'};case'all_enemies':return{mode:'all',side:'enemy'};case'all_allies':return{mode:'all',side:'ally'};case'self':return{mode:'self',side:'ally'};case'random_enemy':return{mode:'random',side:'enemy'};case'random_ally':return{mode:'random',side:'ally'}}}const bo={expCurve:e=>Math.floor(80*Math.pow(e,1.35)),attributePointsPerLevel:3,statGrowth:{hp:10,mp:5,sp:5},fullRestoreOnLevelUp:!0},xo={expPerLevel:15,bossExpMultiplier:3,goldPerLevel:{base:8,randomBonus:12},bossGoldMultiplier:4,levelConfig:bo,autoLootEnabled:!1,showLootHints:!0};const wo={str:'力量',dex:'敏捷',con:'体质',int:'智力',wis:'感知',cha:'魅力',ac:'护甲',spd:'速度',hp:'HP',mp:'MP',sp:'SP',hp_max:'HP上限',mp_max:'MP上限',sp_max:'SP上限',crit_rate:'暴击率',crit_dmg:'暴击伤害',critrate:'暴击率',critdamage:'暴击伤害',hitrate:'命中率',dodgerate:'闪避率',dodge:'闪避率',damage:'伤害',defense:'防御',attack:'攻击',lifesteal:'吸血',magic_dmg:'魔法伤害加成',physical_dmg:'物理伤害加成',fire_dmg:'火焰伤害加成',ice_dmg:'冰霜伤害加成',lightning_dmg:'雷电伤害加成',dark_dmg:'暗影伤害加成',light_dmg:'光明伤害加成',nature_dmg:'自然伤害加成',poison_dmg:'毒素伤害加成',true_dmg:'真实伤害加成',all_res:'全属性抗性',physical_res:'物理抗性',magic_res:'魔法抗性',fire_res:'火焰抗性',ice_res:'冰霜抗性',lightning_res:'雷电抗性',dark_res:'暗影抗性',light_res:'光明抗性',nature_res:'自然抗性',poison_res:'毒素抗性',heal_bonus:'治疗加成',heal_received:'受疗加成'},ko={str:'💪',dex:'🍃',con:'🛡',int:'🧠',wis:'💡',cha:'🫦',ac:'🛡️',spd:'💨',hp:'❤️',mp:'💙',sp:'💚',hp_max:'❤️',mp_max:'💙',sp_max:'💚',crit_rate:'💥',critRate:'💥',crit_dmg:'🎯',critDamage:'🥊',hitrate:'🎯',dodgerate:'🏃',dodge:'🏃',damage:'⚔️',defense:'🛡️',attack:'⚔️',lifesteal:'🧛',reflect:'↩️',magic_dmg:'🔮',physical_dmg:'⚔️',fire_dmg:'🔥',ice_dmg:'❄️',lightning_dmg:'⚡',dark_dmg:'🌑',light_dmg:'✨',nature_dmg:'🌿',poison_dmg:'🧪',true_dmg:'💎',all_res:'🛡️',physical_res:'🛡️',magic_res:'🔮',fire_res:'🔥',ice_res:'❄️',lightning_res:'⚡',dark_res:'🌑',light_res:'✨',nature_res:'🌿',poison_res:'🧪',heal_bonus:'💚',heal_received:'💖'},So={immediate:'立即',passive:'被动',on_hit:'命中时',on_damage:'造成伤害后',on_hurt:'受到伤害时',on_kill:'击杀时',on_death:'死亡时',turn_start:'回合开始时',turn_end:'回合结束时',battle_start:'战斗开始时',battle_end:'战斗结束时'},_o={damage:'造成',heal:'恢复',buff:'获得',debuff:'施加',shield:'获得',cleanse:'净化',dispel:'驱散',advance:'行动提前',delay:'行动推迟',summon:'召唤',revive:'复活',extra_turn:'获得'},Co={self:'自身',target:'目标',enemy:'敌方',ally:'友方',all_enemies:'所有敌人',all_allies:'所有友军',random_enemy:'随机敌人',random_ally:'随机友军'};class Io{static translateAttribute(e){const t=e.toLowerCase();return wo[t]||e.toUpperCase()}static needsPercentage(e){const t=e.toLowerCase();return t.endsWith('_dmg')||t.endsWith('_res')||'crit_rate'===t||'crit_dmg'===t||'critrate'===t||'critdamage'===t||'dodge'===t||'dodgerate'===t||'hitrate'===t||'lifesteal'===t||'heal_bonus'===t||'heal_received'===t}static getAttributeIcon(e){const t=e.toLowerCase();return ko[t]||'📊'}static translateModifiers(e){if(!e||0===Object.keys(e).length)return{text:'',shortText:'',icons:[]};const t=[],a=[],s=[];for(const[n,r]of Object.entries(e))if(void 0!==r&&0!==r){const e=this.translateAttribute(n),l=this.getAttributeIcon(n),o=r>0?'+':'';t.push(`${e}${o}${r}`),a.push(`${l}${o}${r}`),s.includes(l)||s.push(l)}return{text:t.join('，'),shortText:a.join(' '),icons:s}}static translateTag(e){return Xl(e)}static translateValue(e){if(null==e)return'0';if('number'==typeof e)return String(e);let t=e;const a={max:'最大值',cur:'当前值',missing:'已损值'};t=t.replace(/(\d+(?:\.\d+)?)%_(max|cur|missing)(?!_)/gi,(_,e,t)=>`${e}%${a[t.toLowerCase()]||t}`),t=t.replace(/(0\.\d+)_(max|cur|missing)(?!_)/gi,(_,e,t)=>{const s=a[t.toLowerCase()]||t;return`${Math.round(100*parseFloat(e))}%${s}`});return t=t.replace(/\b(str|dex|con|int|wis|cha|spd|ac)\b/gi,e=>this.translateAttribute(e)),t}static getDamageTypeText(e){if(!e||0===e.length)return{text:'',icons:[]};const t=Ql(e),a=[],s=[];for(const e of t){const t=Xl(e);s.includes(t.name)||(s.push(t.name),a.push(t.icon))}return{text:s.join('/'),icons:a}}static translateEffect(e){const t=[],a=[];let s=[];const n=Co[e.target]||e.target,r=_o[e.action]||e.action,l=this.translateValue(e.value),o=this.getDamageTypeText(e.tags);switch(t.push(...o.icons),e.action){case'damage':if(t.length=0,o.text){a.push(`对${n}${r} ${l} 点${o.text}伤害`);const e=o.icons[0]||'⚔️';s.push(`${e}${l}`),t.push(e)}else a.push(`对${n}${r} ${l} 点伤害`),s.push(`⚔️${l}`),t.push('⚔️');break;case'heal':{t.length=0;const o=e.tags?.includes('revive');if(o)a.push(`复活${n}（${l} HP）`),s.push(`💖复活${l}`),t.push('💖');else{const o=[],i=[];e.tags?.includes('hp')&&(o.push('HP'),i.push('❤️')),e.tags?.includes('mp')&&(o.push('MP'),i.push('💙')),e.tags?.includes('sp')&&(o.push('SP'),i.push('💚')),0===o.length&&(o.push('HP'),i.push('❤️'));const c=o.join('/');a.push(`${n}${r} ${l} 点${c}`),s.push(`${i[0]}${l}`),t.push(...i)}break}case'buff':{t.length=0;const o=this.translateModifiers(e.modifiers),i=e.persistent?'永久':'',c=e.persistent?'⭐':'⬆️';if(e.statusName)o.text?(a.push(`${n}${i}${r}「${e.statusName}」（${o.text}）`),s.push(`${c}${e.statusName}：${o.shortText}`)):(a.push(`${n}${i}${r}「${e.statusName}」效果`),s.push(`${c}${e.statusName}`)),t.push(c),t.push(...o.icons);else if(o.text)a.push(`${n}${i}${o.text}`),s.push(o.shortText),t.push(...o.icons),e.persistent&&t.push('⭐');else if(e.tags&&e.tags.length>0){const r=this.translateTag(e.tags[0]);a.push(`${n}${i}${r.name} +${l}`),s.push(`${r.icon}+${l}`),t.push(r.icon),e.persistent&&t.push('⭐')}else a.push(`${n}${i}${r}增益效果`),s.push(`${c}增益`),t.push(c);break}case'debuff':{t.length=0;const l=this.translateModifiers(e.modifiers);if(e.statusName)l.text?(a.push(`对${n}${r}「${e.statusName}」（${l.text}）`),s.push(`⬇️${e.statusName}：${l.shortText}`)):(a.push(`对${n}${r}「${e.statusName}」`),s.push(`⬇️${e.statusName}`)),t.push('⬇️'),t.push(...l.icons);else if(l.text)a.push(`${n}${l.text}`),s.push(l.shortText),t.push(...l.icons);else if(e.tags&&e.tags.length>0){const r=this.translateTag(e.tags[0]);a.push(`${n}${r.name}`),s.push(`${r.icon}`),t.push(r.icon)}else a.push(`对${n}${r}减益效果`),s.push('⬇️减益'),t.push('⬇️');break}case'shield':{t.length=0;const o='hits'===e.shieldMode,i=void 0!==e.shieldValue?e.shieldValue:l;o?(a.push(`${n}${r} ${i} 次护盾`),s.push(`🛡️×${i}`)):(a.push(`${n}${r} ${i} 点护盾`),s.push(`🛡️${i}`)),t.push('🛡️');break}case'summon':t.length=0,a.push(`召唤${e.summonCount||1}个「${e.summonId||'召唤物'}」`),s.push('👻召唤'),t.push('👻');break;case'cleanse':t.length=0,a.push(`${n}净化减益效果`),s.push('✨净化'),t.push('✨');break;case'dispel':t.length=0,a.push(`驱散${n}的增益效果`),s.push('💨驱散'),t.push('💨');break;case'revive':{t.length=0;const r=e.reviveHpPercent||20;a.push(`复活${n}（${r}% HP）`),s.push('💖复活'),t.push('💖');break}case'advance':t.length=0,a.push(`${n}行动条前进${e.advancePercent??30}%`),s.push(`⏩${e.advancePercent??30}%`),t.push('⏩');break;case'delay':t.length=0,a.push(`${n}行动条后退${e.delayPercent??30}%`),s.push(`⏪${e.delayPercent??30}%`),t.push('⏪');break;default:{const l=e.action;t.length=0,'extra_turn'===l?(a.push(`${n}获得额外回合`),s.push('⚡额外回合'),t.push('⚡')):(a.push(`${r}效果`),s.push('📌效果'),t.push('📌'))}}let i,c,d,u=a.join('');return void 0!==e.duration&&0!==e.duration&&(-1===e.duration?(i='永久',u+='（永久）'):(i=`${e.duration}回合`,u+=`（持续${e.duration}回合）`)),'immediate'!==e.trigger&&(c=So[e.trigger]||e.trigger),void 0!==e.chance&&e.chance<100&&(d=`${e.chance}%概率`,u+=`（${e.chance}%概率）`,s=s.map(t=>`${t}(${e.chance}%)`)),{text:u,short:s.join(' '),trigger:c,chance:d,duration:i,icons:[...new Set(t)]}}static translateSkill(e){const t=(e.effects||[]).map(e=>this.translateEffect(e)),a=t.length>0?t[0].text:'无效果';let s,n,r;if(e.cost){const t=[];e.cost.mp&&t.push(`${e.cost.mp} MP`),e.cost.sp&&t.push(`${e.cost.sp} SP`),e.cost.hp&&t.push(`${e.cost.hp} HP`),t.length>0&&(s=`消耗 ${t.join('、')}`)}e.cooldown&&e.cooldown>0&&(n=`冷却 ${e.cooldown} 回合`);const{mode:l,side:o}=yo(e.target);if('all'===l)r='enemy'===o?'全体敌人':'全体友军';else if('random'===l){r=`随机${e.targetCount||1}个${'enemy'===o?'敌人':'目标'}`}let i;if(e.hitCount&&e.hitCount>1&&(i=`${e.hitCount}连击`,e.hitDamageRatio)){i+=`（${e.hitDamageRatio.map(e=>`${Math.round(100*e)}%`).join('/')}）`}const c=[];for(const e of t)e.short&&!c.includes(e.short)&&c.push(e.short);return{name:e.name,mainEffect:a,cost:s,cooldown:n,targetType:r,hitInfo:i,effects:t,shortTags:c}}static translateItem(e){const t=(e.effects||[]).map(e=>this.translateEffect(e));let a='';a=0===t.length?'无特殊效果':1===t.length?t[0].text:t.map(e=>e.text).join('；');const s=[];for(const e of t)e.short&&!s.includes(e.short)&&s.push(e.short);return{name:e.name,effectSummary:a,effects:t,shortTags:s}}static translateStatusEffect(e){const t=[];t.push(`「${e.name}」`),e.stacks>1&&t.push(`×${e.stacks}`),-1===e.duration?t.push('（永久）'):e.duration>0&&t.push(`（${e.duration}回合）`);const a=[],s=e.name.match(/[+-]\d+/);if(e.modifiers&&!s)for(const[t,s]of Object.entries(e.modifiers))if(void 0!==s&&0!==s){const e=this.translateAttribute(t),n=s>0?'+':'';a.push(`${e}${n}${s}`)}if(e.damagePerAction){const t=e.damageType?this.translateTag(e.damageType).name:'';a.push(`每回合${e.damagePerAction}点${t}伤害`)}return e.healPerAction&&a.push(`每回合恢复${e.healPerAction}HP`),e.preventsAction&&a.push('无法行动'),e.preventsSkills&&a.push('无法使用技能'),a.length>0&&t.push(`：${a.join('，')}`),t.join('')}static getItemEffectTags(e){const t=this.translateItem(e),a=[];for(const e of t.effects)e.icons.length>0&&e.short&&a.push({icon:e.icons[0],text:e.short.replace(e.icons[0],'').trim()});return a}static getSkillEffectTags(e){const t=this.translateSkill(e),a=[];for(const e of t.effects)e.icons.length>0&&e.short&&a.push({icon:e.icons[0],text:e.short.replace(e.icons[0],'').trim()});return t.cost&&a.push({icon:'💎',text:t.cost.replace('消耗 ','')}),t.cooldown&&a.push({icon:'⏱️',text:t.cooldown.replace('冷却 ','')}),a}static getEffectPreview(e){const t=e.action,a=this.translateValue(e.value),s=e.target||'enemy',n=e.tags||[],r=new Set(['magic_dmg','physical_dmg','fire_dmg','ice_dmg','lightning_dmg','dark_dmg','light_dmg','nature_dmg','poison_dmg','true_dmg','all_res','physical_res','magic_res','fire_res','ice_res','lightning_res','dark_res','light_res','nature_res','poison_res','crit_rate','crit_dmg','dodge','dodgerate','hitrate','lifesteal','heal_bonus','heal_received']),l=e=>e.some(e=>r.has(e.toLowerCase())),o=()=>{if(0===n.length)return'';return n.map(e=>this.translateAttribute(e)).join('/')},i={self:'自身',ally:'友方',enemy:'敌方',all_enemies:'全体敌人',all_allies:'全体友方'};let c='';switch(t){case'damage':c=`伤害${a}`;break;case'heal':{const e=o();c=e&&!e.includes('光明')?`${e}恢复+${a}`:`生命恢复+${a}`;break}case'buff':if(e.modifiers&&Object.keys(e.modifiers).length>0){const t=[];for(const[a,s]of Object.entries(e.modifiers))if(void 0!==s&&0!==s){const e=this.translateAttribute(a),n=s>0?'+':'',r=l([a])?'%':'';t.push(`${e}${n}${s}${r}`)}c=t.length>0?t.join('，'):'增益效果',void 0!==e.duration&&e.duration>0?c+=` ${e.duration}回合`:-1===e.duration&&(c+=' 永久')}else{const t=o(),s=String(a).startsWith('-')?'':'+',r=l(n)?'%':'';c=t?`${t}${s}${a}${r}`:`增益${s}${a}${r}`,void 0!==e.duration&&e.duration>0?c+=` ${e.duration}回合`:-1===e.duration&&(c+=' 永久')}break;case'debuff':if(e.statusName){const t=e.duration,s='number'==typeof a?a:parseInt(String(a));let n='';if(s&&s>1&&(n=`×${s}`),t&&t>0&&(n+=n?` ${t}回合`:`${t}回合`),e.modifiers&&Object.keys(e.modifiers).length>0){const t=[];for(const[a,s]of Object.entries(e.modifiers))if(void 0!==s&&0!==s){const e=this.translateAttribute(a),n=s>0?'+':'',r=l([a])?'%':'';t.push(`${e}${n}${s}${r}`)}c=`${e.statusName}（${t.join('，')}）${n}`}else c=`${e.statusName}${n}`}else if(e.modifiers&&Object.keys(e.modifiers).length>0){const t=[];for(const[a,s]of Object.entries(e.modifiers))if(void 0!==s&&0!==s){const e=this.translateAttribute(a),n=s>0?'+':'',r=l([a])?'%':'';t.push(`${e}${n}${s}${r}`)}c=t.length>0?t.join('，'):'减益效果'}else{const e=o(),t=String(a).startsWith('-')?'':'-',s=l(n)?'%':'';c=e?`${e}${t}${a}${s}`:`减益${t}${a}${s}`}break;case'shield':c=`护盾${a}`;break;case'dot':c=`持续伤害${a}`;break;case'hot':c=`持续治疗${a}`;break;case'stun':c='眩晕';break;case'slow':c='减速';break;case'dispel':{const e=o();c=e?`驱散${e}`:'驱散';break}case'cleanse':c='净化';break;case'special':c=`特殊: ${a}`;break;case'modify_attribute':{const e=o(),t=String(a).startsWith('-')?'':'+',s=l(n)?'%':'';c=e?`永久${e}${t}${a}${s}`:`永久属性${t}${a}${s}`;break}case'extra_turn':c='额外回合';break;case'advance':c=`行动提前${e.advancePercent??30}%`;break;case'delay':c=`行动推迟${e.delayPercent??30}%`;break;case'revive':c='复活';break;case'summon':c='召唤';break;default:c=t}const d=[c],u=[],p={immediate:'',passive:'',on_hit:'命中时',on_damage:'造成伤害后',on_hurt:'受伤时',on_kill:'击杀时',on_death:'死亡时',turn_start:'回合开始时',turn_end:'回合结束时',battle_start:'战斗开始时',battle_end:'战斗结束时'}[e.trigger||'immediate'];return p&&u.push(p),'enemy'!==s&&'target'!==s&&u.push(i[s]||''),void 0!==e.chance&&e.chance<100&&u.push(`${e.chance}%概率`),u.length>0&&d.push(`(${u.join(',')})`),d.join('')}static getSkillDescription(e){if(!e.effects||0===e.effects.length)return'使用此技能';const t=e.effects[0],a=t.action,s=t.value;switch(a){case'damage':return`对目标造成 ${s} 点伤害`;case'heal':return`恢复 ${s} 点生命值`;case'buff':return'给予目标增益效果';case'debuff':return'对目标施加减益效果';case'shield':return`获得 ${s} 点护盾值`;default:return'使用此技能'}}}Io.translateEffect.bind(Io),Io.translateSkill.bind(Io),Io.translateItem.bind(Io),Io.getItemEffectTags.bind(Io),Io.getSkillEffectTags.bind(Io);const To=Io.getEffectPreview.bind(Io),Ao=Io.getSkillDescription.bind(Io),Mo=(Io.translateAttribute.bind(Io),{stun:{preventsAction:!0,description:'眩晕'},freeze:{preventsAction:!0,description:'冰冻'},sleep:{preventsAction:!0,description:'睡眠'},charm:{preventsAction:!0,description:'魅惑'},fear:{preventsAction:!0,description:'恐惧'},paralyze:{preventsAction:!0,description:'麻痹'},petrify:{preventsAction:!0,description:'石化'},silence:{preventsSkills:!0,description:'沉默'},taunt:{forcedTargetSource:!0,description:'嘲讽'}});class Eo extends Bl{shieldService;constructor(){super('EffectService')}async init(){this.shieldService=Ll.serviceLocator.get('ShieldService')}applyEffect(e,t,a,s){if(!s?.ignoreChance&&void 0!==a.chance&&a.chance<100){if(100*Math.random()>a.chance)return{success:!1,effectType:a.action,message:'效果未触发'}}if(a.condition&&!this.evaluateCondition(t,a.condition))return{success:!1,effectType:a.action,message:'条件不满足'};switch(a.action){case'heal':return this.applyHeal(e,t,a);case'buff':return this.applyStatus(e,t,a,!0);case'debuff':return this.applyStatus(e,t,a,!1);case'shield':return this.applyShield(e,t,a);case'cleanse':return this.applyCleanse(t,a);case'dispel':return this.applyDispel(t,a);case'revive':return this.applyRevive(t,a);case'advance':return this.applyAdvance(t,a);case'delay':return this.applyDelay(t,a);default:return{success:!1,effectType:a.action,message:'未知效果类型'}}}getEffectiveMax(e,t){const a=`${t}_max`;return(e.stats[t]?.max||0)+(e.statModifiers?.[a]||0)}applyHeal(e,t,a){if(t.isDead)return{success:!1,effectType:'heal',message:'目标已死亡'};const s=t.statusEffects?.some(e=>e.tags?.includes('heal_block')),n=a.tags||['hp'];let r=0;const l=[];for(const o of['hp','mp','sp']){if(!n.includes(o))continue;const i=t.stats[o];if(!i)continue;if('hp'===o&&s)continue;let c=lo.DiceRoller.evaluate(a.value||0,e,t,o);if('hp'===o){const a=Fl.getAttribute(e,'heal_bonus')||0;c=Math.floor(c*(1+a/100));const s=Fl.getAttribute(t,'heal_received')||0;c=Math.floor(c*(1+s/100))}const d=this.getEffectiveMax(t,o),u=i.current;i.current=Math.min(d,i.current+c);const p=i.current-u;r+=p,p>0&&l.push(`${o.toUpperCase()}+${p}`)}return this.eventBus.emit('effect:heal',{source:e,target:t,amount:r,resources:l}),{success:!0,effectType:'heal',value:r,message:l.length>0?l.join(', '):void 0}}applyStatus(e,a,s,n){const r=s.tags||[];let l=s.statusName;!l&&s.modifiers&&(l=this.generateStatusNameFromModifiers(s.modifiers)),l||(l='Unknown Status');const o={id:t(),name:l,description:s.description,duration:s.duration??3,initialDuration:s.duration??3,sourceId:e.id,sourceName:e.name,tags:r,stacks:s.stacks??1,maxStacks:s.maxStacks??1,isBuff:n,isDispellable:n,isPurgeable:!n};for(const t of r){const a=Mo[t];a&&(a.preventsAction&&(o.preventsAction=!0),a.preventsSkills&&(o.preventsSkills=!0),a.forcedTargetSource&&e.id&&(o.forcedTarget=e.id))}void 0!==s.dot&&0!==s.dot&&(o.damagePerAction=s.dot,o.damageType=r.find(e=>!['dot','debuff'].includes(e))||'true'),void 0!==s.hot&&0!==s.hot&&(o.healPerAction=s.hot),s.modifiers&&(o.modifiers={...s.modifiers});const i=a.statusEffects.find(e=>e.name===o.name);if(i){i.duration=Math.max(i.duration,o.duration);const e=i.maxStacks??1;i.stacks<e&&(i.stacks+=o.stacks,i.stacks=Math.min(i.stacks,e)),void 0!==o.damagePerAction&&(i.damagePerAction=o.damagePerAction),void 0!==o.healPerAction&&(i.healPerAction=o.healPerAction)}else a.statusEffects.push(o);return this.updateControlFlags(a),this.recalculateStats(a),this.eventBus.emit('effect:status_applied',{source:e,target:a,status:i||o,isBuff:n}),{success:!0,effectType:n?'buff':'debuff'}}applyShield(e,t,a){const s=lo.DiceRoller.evaluate(a.shieldValue??a.value??0,e,t),n='hits'===a.shieldMode?'count':'value';return this.shieldService.addShield(t,{name:a.statusName||'护盾',value:s,type:n,priority:a.shieldPriority,duration:a.duration,sourceId:e.id,sourceName:e.name}),{success:!0,effectType:'shield',value:s}}applyCleanse(e,t){const a=t.count??1;let s=0;for(let t=e.statusEffects.length-1;t>=0&&s<a;t--){const a=e.statusEffects[t];a.isBuff||!1===a.isPurgeable||(e.statusEffects.splice(t,1),s++,this.eventBus.emit('effect:status_removed',{target:e,status:a,reason:'cleanse'}))}return this.updateControlFlags(e),this.recalculateStats(e),{success:s>0,effectType:'cleanse',value:s}}applyDispel(e,t){const a=t.count??1;let s=0;for(let t=e.statusEffects.length-1;t>=0&&s<a;t--){const a=e.statusEffects[t];a.isBuff&&!1!==a.isDispellable&&(e.statusEffects.splice(t,1),s++,this.eventBus.emit('effect:status_removed',{target:e,status:a,reason:'dispel'}))}return this.recalculateStats(e),{success:s>0,effectType:'dispel',value:s}}applyRevive(e,t){if(!e.isDead)return{success:!1,effectType:'revive',message:'目标未死亡'};const a=t.reviveHpPercent??20;return e.isDead=!1,e.stats.hp.current=Math.floor(e.stats.hp.max*(a/100)),this.eventBus.emit('effect:revive',{target:e,hpPercent:a}),{success:!0,effectType:'revive',value:e.stats.hp.current}}applyAdvance(e,t){const a=t.advancePercent??30;return this.eventBus.emit('effect:advance',{target:e,percent:a}),{success:!0,effectType:'advance',value:a}}applyDelay(e,t){const a=t.delayPercent??30;return this.eventBus.emit('effect:delay',{target:e,percent:a}),{success:!0,effectType:'delay',value:a}}tickStatusEffects(e,t='turn_start'){const a={unitId:e.id,unitName:e.name,effects:[],totalDamage:0,totalHeal:0,expiredStatuses:[]};for(let s=e.statusEffects.length-1;s>=0;s--){const n=e.statusEffects[s];if(void 0!==n.damagePerAction&&0!==n.damagePerAction){const t=lo.DiceRoller.evaluate(n.damagePerAction,e,e)*n.stacks;e.stats.hp.current-=t,a.totalDamage+=t,a.effects.push({statusName:n.name,type:'dot',value:t,stacks:n.stacks})}if(void 0!==n.healPerAction&&0!==n.healPerAction){const t=lo.DiceRoller.evaluate(n.healPerAction,e,e)*n.stacks,s=e.stats.hp.current,r=this.getEffectiveMax(e,'hp');e.stats.hp.current=Math.min(r,e.stats.hp.current+t);const l=e.stats.hp.current-s;a.totalHeal+=l,a.effects.push({statusName:n.name,type:'hot',value:l,stacks:n.stacks})}if(n.duration>0){(n.isBuff&&'turn_start'===t||!n.isBuff&&'turn_end'===t)&&(n.duration--,n.duration<=0&&(a.expiredStatuses.push(n.name),e.statusEffects.splice(s,1),this.eventBus.emit('effect:status_expired',{unit:e,status:n})))}}return this.updateControlFlags(e),this.recalculateStats(e),a}updateControlFlags(e){e.isStunned=e.statusEffects.some(e=>!!e.preventsAction||(e.tags?.some(e=>Mo[e]?.preventsAction)??!1)),e.isSilenced=e.statusEffects.some(e=>!!e.preventsSkills||(e.tags?.some(e=>Mo[e]?.preventsSkills)??!1)),e.isTaunted=!1,e.tauntSourceId=void 0;for(const t of e.statusEffects){if(t.forcedTarget){e.isTaunted=!0,e.tauntSourceId=t.forcedTarget;break}if(t.tags?.some(e=>Mo[e]?.forcedTargetSource)){e.isTaunted=!0,e.tauntSourceId=t.sourceId;break}}}recalculateStats(e){e.statModifiers={},e.statusEffects.forEach(t=>{if(t.modifiers)for(const[a,s]of Object.entries(t.modifiers))void 0!==s&&(e.statModifiers[a]=(e.statModifiers[a]||0)+s*t.stacks)}),this.eventBus.emit('effect:stats_recalculated',{unit:e})}removeStatus(e,t){const a=e.statusEffects.findIndex(e=>e.id===t);if(a>-1){const t=e.statusEffects.splice(a,1)[0];return this.updateControlFlags(e),this.recalculateStats(e),this.eventBus.emit('effect:status_removed',{unit:e,status:t,reason:'manual'}),!0}return!1}removeAllStatuses(e,t,a){let s=0;return e.statusEffects=e.statusEffects.filter(n=>!(!t||n.isBuff)||(!(!a||!n.isBuff)||(s++,this.eventBus.emit('effect:status_removed',{unit:e,status:n,reason:'clear'}),!1))),this.updateControlFlags(e),this.recalculateStats(e),s}generateStatusNameFromModifiers(e){const t=[];for(const[a,s]of Object.entries(e))if(void 0!==s&&0!==s){const e=this.translateAttributeName(a),n=s>0?'+':'',r=Io.needsPercentage(a)?'%':'';t.push(`${e}${n}${s}${r}`)}return t.length>0?t.join('，'):''}translateAttributeName(e){return Io.translateAttribute(e)}evaluateCondition(e,t){try{const a=Fl.getResourcePercent(e,'hp')/100,s=Fl.getResourcePercent(e,'mp')/100,n=Fl.getResourcePercent(e,'sp')/100,r=t.replace(/target\.hp_pct/g,a.toString()).replace(/target\.mp_pct/g,s.toString()).replace(/target\.sp_pct/g,n.toString()).replace(/target\.is_dead/g,e.isDead.toString());if(r.includes('<')){const[e,t]=r.split('<').map(e=>parseFloat(e.trim()));return e<t}if(r.includes('>')){const[e,t]=r.split('>').map(e=>parseFloat(e.trim()));return e>t}if(r.includes('==')){const[e,t]=r.split('==').map(e=>e.trim());return e===t}return!0}catch{return console.warn(`Failed to evaluate condition: ${t}`),!0}}}const $o={base:8,bonus:0};function Do(e){return Object.entries(e).map(([e,t])=>({...t,id:e}))}var Po;!function(e){e.TRAVEL='travel',e.EQUIP='equip',e.USE_ITEM='use_item',e.BUY='buy',e.SELL='sell',e.DROP='drop',e.BATTLE_RESULT='battle_result',e.CUSTOM='custom'}(Po||(Po={}));class No extends Bl{saveService;constructor(){super('OfflineActionService')}init(){this.saveService=Ll.serviceLocator.get('SaveService'),this.migrateFromLocalStorage(),console.log('OfflineActionService initialized (using GameState storage)')}getActions(){const e=this.saveService?.getGameState();return e?.world?.pendingOfflineActions||[]}setActions(e){const t=this.saveService?.getGameState();t&&(t.world||(t.world={time:'08:00',quests:{}}),t.world.pendingOfflineActions=e)}recordAction(e,t){const a={type:e,timestamp:Date.now(),details:t},s=this.getActions();s.push(a),this.setActions(s)}getCompressedSummary(e=!0){const t=this.getActions();if(0===t.length)return[];const a=[],s=t.filter(e=>e.type===Po.TRAVEL);if(s.length>0){const e=s[0],t=s[s.length-1];1===s.length?a.push(`从「${e.details.from}」移动到了「${e.details.to}」`):a.push(`经过长途跋涉，从「${e.details.from}」最终抵达了「${t.details.to}」`)}const n=t.filter(e=>e.type===Po.EQUIP),r=new Map;if(n.forEach(e=>{const{slot:t,itemName:a,prevItemName:s,isUnequip:n}=e.details;if(r.has(t)){r.get(t).final=n?null:a}else n?r.set(t,{initial:a,final:null}):r.set(t,{initial:s||null,final:a})}),r.size>0){const e=[];r.forEach((t,a)=>{t.initial!==t.final&&(t.initial&&t.final?e.push(`${a}更换: ${t.initial} → ${t.final}`):t.final?e.push(`${a}装备了: ${t.final}`):t.initial&&e.push(`${a}卸下了: ${t.initial}`))}),e.length>0&&a.push(`调整了装备: ${e.join(', ')}`)}const l=t.filter(e=>e.type===Po.USE_ITEM),o=new Map;if(l.forEach(e=>{const{itemName:t,count:a}=e.details,s=o.get(t)||0;o.set(t,s+a)}),o.size>0){const e=[];o.forEach((t,a)=>{e.push(`${a} x${t}`)}),a.push(`使用了物品: ${e.join(', ')}`)}t.filter(e=>e.type===Po.BATTLE_RESULT).forEach(e=>{const t=e.details,s=t.enemyNames.join('、');if('win'===t.result){let e=`战斗胜利！击败了${s}`;e+=`，获得 ${t.expGained} 经验、${this.formatCurrency(t.goldGained)}`,t.levelUp&&(e+=`。等级提升！Lv.${t.levelUp.previousLevel} → Lv.${t.levelUp.newLevel}`);const n=t.statistics;e+=`（输出${n.totalDamageDealt}，承伤${n.totalDamageTaken}，暴击${n.criticalHits}次）`,a.push(e)}else'lose'===t.result?a.push(`战斗失败，被${s}击败。`):'flee'===t.result&&a.push(`成功逃离了与${s}的战斗。`)});return t.filter(e=>![Po.TRAVEL,Po.EQUIP,Po.USE_ITEM,Po.BATTLE_RESULT].includes(e.type)).forEach(e=>{e.type===Po.DROP?a.push(`丢弃了 ${e.details.itemName} x${e.details.count}`):e.type===Po.CUSTOM&&a.push(e.details.message)}),e&&this.clearActions(),a}migrateFromLocalStorage(){try{const e=localStorage.getItem('offline_actions');if(e){const t=JSON.parse(e);if(t.length>0){const e=[...this.getActions(),...t];this.setActions(e),console.log(`Migrated ${t.length} offline actions from localStorage to GameState`)}localStorage.removeItem('offline_actions')}}catch(e){console.warn('Failed to migrate offline actions from localStorage',e)}}clearActions(){this.setActions([])}getActionCount(){return this.getActions().length}getPreviewSummary(){return this.getCompressedSummary(!1)}formatCurrency(e){const t=Math.floor(e/1e4),a=Math.floor(e%1e4/100),s=e%100,n=[];return t>0&&n.push(`${t}金`),a>0&&n.push(`${a}银`),(s>0||0===n.length)&&n.push(`${s}铜`),n.join(' ')}}function Ro(e){const t={hp_max:0,mp_max:0,sp_max:0,str:0,dex:0,con:0,int:0,wis:0,cha:0,spd:0,ac:0,crit_rate:0,crit_dmg:0};if(!e)return t;for(const a of Object.values(e))if(a&&a.effects)for(const e of a.effects){if('passive'!==e.trigger||'buff'!==e.action)continue;if('self'!==e.target)continue;if(e.modifiers&&'object'==typeof e.modifiers){for(const[a,s]of Object.entries(e.modifiers))if(void 0!==s&&'number'==typeof s){const e=a.toLowerCase();t[e]=(t[e]||0)+s}continue}const a='number'==typeof e.value?e.value:parseInt(e.value,10)||0,s=e.tags||[];for(const e of s){const s=e.toLowerCase();s in t?t[s]+=a:t[s]=(t[s]||0)+a}}return t}const jo=new Set(['dual_blades','broadsword','gauntlet','bow','katana','spear']),Lo=new Set(['sword','dagger','shield','staff','hammer','gun','axe','whip','grimoire','horn']),Bo={weapon_main:{types:['weapon'],subtypes:[...jo,...Lo]},weapon_off:{types:['weapon'],subtypes:[...Lo]},head:{types:['armor'],subtypes:['hat','helmet','crown','hood','circlet']},outer:{types:['armor'],subtypes:['cloak','cape','coat','robe']},upper:{types:['armor'],subtypes:['top_male','top_female','shirt','vest','breastplate','chainmail']},lower:{types:['armor'],subtypes:['pant_long','pant_short','skirt','leggings','greaves']},underwear:{types:['armor'],subtypes:['lingerie_top','bra','undershirt']},underpants:{types:['armor'],subtypes:['underpants_male','underpants_female','shorts','panties']},socks:{types:['armor'],subtypes:['sock_short','sock_long','stocking']},shoes:{types:['armor'],subtypes:['boot_heavy','boot_light','shoe_light','sandal']},hands:{types:['armor'],subtypes:['glove']},accessory_1:{types:['accessory']},accessory_2:{types:['accessory']},accessory_3:{types:['accessory']}};class Oo extends Bl{logger;saveService;effectService;offlineActionService;iconService;EQUIPMENT_SLOTS={weapon_main:{emoji:'🗡️',name:'主手',keywords:['weapon','刀','剑','斧','锤','枪','矛','棍','杖','武器']},weapon_off:{emoji:'🛡️',name:'副手',keywords:['shield','盾']},head:{emoji:'👑',name:'头部',keywords:['head','头部','头盔','帽子']},outer:{emoji:'🧥',name:'外套',keywords:['outer','外套','披风','斗篷','大衣','外衣']},upper:{emoji:'👕',name:'上装',keywords:['upper','armor','胸甲','护甲','上衣','上装','上身','套装']},lower:{emoji:'👖',name:'下装',keywords:['lower','腿甲','裤子','下装','下身']},hands:{emoji:'🧤',name:'手部',keywords:['hands','手部','手甲','手套','护腕']},shoes:{emoji:'🥾',name:'鞋子',keywords:['shoes','鞋子','靴子']},underwear:{emoji:'🎽',name:'内衣',keywords:['underwear','内衣','胸衣']},underpants:{emoji:'🩲',name:'内裤',keywords:['underpants','内裤']},socks:{emoji:'🧦',name:'袜子',keywords:['socks','袜子']},accessory:{emoji:'✨',name:'饰品',keywords:['accessory','配饰','饰品','戒指','项链','耳环','插件']},accessory_1:{emoji:'✨',name:'饰品 1',keywords:[]},accessory_2:{emoji:'✨',name:'饰品 2',keywords:[]},accessory_3:{emoji:'✨',name:'饰品 3',keywords:[]}};constructor(){super('InventoryService')}init(){this.logger=Ll.serviceLocator.get('LoggerService'),this.saveService=Ll.serviceLocator.get('SaveService'),this.effectService=Ll.serviceLocator.get('EffectService');try{this.offlineActionService=Ll.serviceLocator.get('OfflineActionService')}catch(e){this.logger?.warn('OfflineActionService not found')}try{this.iconService=Ll.serviceLocator.get('IconService')}catch(e){this.logger?.warn('IconService not found')}this.logger?.log('InventoryService initialized')}addCurrency(e){const t=this.saveService?.getGameState();t&&(t.inventory.wallet||(t.inventory.wallet={ledger:0,rates:[]}),t.inventory.wallet.ledger+=e,this.logger?.log(`Added currency: ${e}, Total: ${t.inventory.wallet.ledger}`),this.saveService?.saveData('Currency Add'),this.eventBus.emit('inventory:updated',t.inventory))}getMaxCapacity(){const e=this.saveService?.getGameState();if(!e)return $o.base;const t=e.inventory.capacity||$o,a=this.getEquipmentCapacityBonus();return t.base+t.bonus+a}isOverweight(){return this.getUsedSlots()>this.getMaxCapacity()}getOverweightPenalties(){const e=this.saveService?.getGameState();if(!e||!this.isOverweight())return null;const t=e.player.attributes?.DEX||10;return{dex:-Math.floor(.5*t),dodgeRate:-50}}updateOverweightStatus(){const e=this.saveService?.getGameState();if(!e)return;e.player.statModifiers||(e.player.statModifiers={});const t=1===e.player.statModifiers._overweight,a=this.isOverweight();if(a&&!t){const t=this.getOverweightPenalties();t&&(e.player.statModifiers.dex=(e.player.statModifiers.dex||0)+t.dex,e.player.statModifiers.dodgeRate=(e.player.statModifiers.dodgeRate||0)+t.dodgeRate,e.player.statModifiers._overweight=1,this.logger?.warn(`Overweight! Applied penalties: DEX ${t.dex}, DodgeRate ${t.dodgeRate}%`),this.eventBus.emit('inventory:overweight',{isOverweight:!0,penalties:t}))}else if(!a&&t){const t=e.player.attributes?.DEX||10,a=-Math.floor(.5*t);e.player.statModifiers.dex=(e.player.statModifiers.dex||0)-a,e.player.statModifiers.dodgeRate=(e.player.statModifiers.dodgeRate||0)+50,0===e.player.statModifiers.dex&&delete e.player.statModifiers.dex,0===e.player.statModifiers.dodgeRate&&delete e.player.statModifiers.dodgeRate,delete e.player.statModifiers._overweight,this.logger?.log('Overweight status cleared, penalties removed'),this.eventBus.emit('inventory:overweight',{isOverweight:!1,penalties:null})}}getUsedSlots(){const e=this.saveService?.getGameState();return e?(t=e.inventory.items,Object.keys(t).length):0;var t}hasCapacity(e){const t=this.saveService?.getGameState();if(!t)return!1;if(e){if(Do(t.inventory.items).find(t=>t.name===e))return!0}return this.getUsedSlots()<this.getMaxCapacity()}getEquipmentCapacityBonus(){const e=this.saveService?.getGameState();if(!e)return 0;let t=0;const a=e.player.equipment;for(const e in a){const s=a[e];s&&'number'==typeof s.capacityBonus&&(t+=s.capacityBonus)}return t}addItem(e){const t=this.saveService?.getGameState();if(!t)return!1;const a=t.inventory,s=Do(a.items).find(t=>t.name===e.name);if(s)s.count+=e.count,this.logger?.log(`Added ${e.count} x ${e.name} (Stacked)`);else{!this.hasCapacity()&&this.logger?.warn(`Inventory will exceed capacity after adding ${e.name} (${this.getUsedSlots()+1}/${this.getMaxCapacity()})`),this.ensureIconVariant(e);const t=this.generateNextItemId(a.items),{id:_,...s}=e;a.items[t]=s,this.logger?.log(`Added ${e.count} x ${e.name} (New, id=${t})`)}return this.saveService?.saveData('Inventory Add'),this.eventBus.emit('inventory:updated',a),this.updateOverweightStatus(),!0}ensureIconVariant(e){if(void 0!==e.iconVariant)return;let t=!1;if(this.iconService){const a=e.subtype||e.type;if(a){const e=this.iconService.mapTypeToCategoryAndSubtype(a);t='material'===e.category||'item'===e.category}}else t='material'===e.type||'misc'===e.type||'consumable'===e.type||'quest'===e.type;t&&(e.iconVariant=Math.floor(16*Math.random()))}fixIconVariant(e){const t=this.saveService?.getGameState();if(!t)return;const a=t.inventory.items[e];return a?void 0!==a.iconVariant?a.iconVariant:(this.ensureIconVariant(a),void 0!==a.iconVariant?(this.saveService?.saveData('Fix IconVariant'),a.iconVariant):void 0):void 0}removeItem(e,t=1,a=!1){const s=this.saveService?.getGameState();if(!s)return;const n=s.inventory.items[e];n?(n.count>t?n.count-=t:delete s.inventory.items[e],this.eventBus.emit('inventory:updated',s.inventory),this.updateOverweightStatus(),a||this.offlineActionService?.recordAction(Po.DROP,{itemName:n.name,count:t})):this.logger?.warn(`Cannot remove item ${e}: not found`)}async useItem(e,t='player',a=1){const s=this.saveService?.getGameState();if(!s)return;const n=s.inventory.items[e];if(!n)return void this.logger?.warn(`Cannot use item ${e}: not found`);if(n.count<a)return void this.logger?.warn(`Not enough items to use: ${n.name} (Has ${n.count}, Need ${a})`);const r=this.getTargetById(t);if(r){if(n.effects&&n.effects.length>0){for(let e=0;e<a;e++)for(const e of n.effects)try{this.effectService?.applyEffect(r,r,e)}catch(e){this.logger?.error(`Failed to execute effect for ${n.name}`,e)}this.logger?.log(`${r.name} used ${a} x ${n.name}`)}else this.logger?.log(`${r.name} used ${a} x ${n.name} (No effects)`);this.removeItem(e,a,!0),this.saveService?.saveData('Item Used'),this.offlineActionService?.recordAction(Po.USE_ITEM,{itemName:n.name,count:a,target:r.name})}else this.logger?.warn(`Cannot find target: ${t}`)}getTargetById(e){const t=this.saveService?.getGameState();if(!t)return null;if(t.combat){const a=t.combat;if('player'===e){const e=t.player;return{id:'player',name:e.base?.name||'玩家',type:'player',isPlayer:!0,level:e.base?.level||1,base:e.base||{},stats:e.stats,attributes:e.attributes||{},equipment:e.equipment||{},skills:{},statusEffects:e.statusEffects||[],shields:e.shields||[],isDead:e.stats?.hp?.current<=0,statModifiers:{},isStunned:!1,hasActed:!1}}if(a.allies){const t=a.allies.find(t=>t.id===e);if(t)return t}if(a.enemies){const t=a.enemies.find(t=>t.id===e);if(t)return t}if(a.summons){const t=a.summons.find(t=>t.id===e);if(t)return t}}if('player'===e){const e=t.player;return{id:'player',name:e.base?.name||'玩家',type:'player',isPlayer:!0,level:e.base?.level||1,base:e.base||{},stats:e.stats,attributes:e.attributes||{},equipment:e.equipment||{},skills:{},statusEffects:e.statusEffects||[],shields:e.shields||[],isDead:e.stats?.hp?.current<=0,statModifiers:{},isStunned:!1,hasActed:!1}}if(t.allies){const a=t.allies[e];if(a)return{id:a.id,name:a.name,type:'ally',isPlayer:!1,isAlly:!0,allyType:a.allyType,level:a.level||1,base:{name:a.name,race:a.race,class:a.class,level:a.level,avatar:a.avatar,gender:a.gender},stats:a.stats,attributes:a.attributes||{},equipment:a.equipment||{},skills:a.skills||{},statusEffects:a.statusEffects||[],shields:a.shields||[],isDead:a.stats?.hp?.current<=0,statModifiers:a.statModifiers||{},isStunned:!1,hasActed:!1}}return null}isValidEquipmentSlot(e){return['weapon_main','weapon_off','head','outer','upper','lower','underwear','underpants','socks','shoes','hands','accessory_1','accessory_2','accessory_3'].includes(e)}isTwoHandedWeapon(e){return!!e.subtype&&jo.has(e.subtype)}isOneHandedWeapon(e){return!!e.subtype&&Lo.has(e.subtype)}isWeapon(e){return'weapon'===e.type||this.isTwoHandedWeapon(e)||this.isOneHandedWeapon(e)}equipItem(e,t){const a=this.saveService?.getGameState();if(!a)return!1;const s=a.inventory.items[e];if(!s)return!1;const n=s.req?.level??s.level??0,r=t.base?.level??t.level??1;if(n>r)return this.logger?.warn(`Level requirement not met for ${s.name} (Req: ${n}, Act: ${r})`),this.eventBus.emit('equipment:level_insufficient',{itemName:s.name,requiredLevel:n,currentLevel:r}),!1;if(this.isWeapon(s))return this.equipWeapon(e,s,a);let l=null;if(s.slotTarget&&this.isValidEquipmentSlot(s.slotTarget)?(l=s.slotTarget,this.logger?.log(`Using slotTarget for ${s.name}: ${l}`)):l=this.getSlotFromItemType(s.type,a.player.equipment),!l)return this.logger?.warn(`No suitable slot found for item type: ${s.type}`),!1;const o=a.player.equipment[l],i=o?.name;o&&o.name&&this.unequipItem(l,!0);const c=Ro(a.player.equipment);this.removeItem(e,1,!0),a.player.equipment[l]={...s,count:1};const d=Ro(a.player.equipment),u=d.hp_max-c.hp_max,p=d.mp_max-c.mp_max,m=d.sp_max-c.sp_max;return 0!==u&&(a.player.stats.hp.current+=u,a.player.stats.hp.max+=u),0!==p&&(a.player.stats.mp.current+=p,a.player.stats.mp.max+=p),0!==m&&(a.player.stats.sp.current+=m,a.player.stats.sp.max+=m),this.logger?.log(`Equipped ${s.name} to ${l}`),this.saveService?.saveData('Equip Item'),this.eventBus.emit('equipment:updated',{slot:l,item:a.player.equipment[l]}),this.offlineActionService?.recordAction(Po.EQUIP,{slot:this.EQUIPMENT_SLOTS[l]?.name||l,itemName:s.name,prevItemName:i,isUnequip:!1}),this.updateOverweightStatus(),!0}equipWeapon(e,t,a){const s=a.player.equipment,n=s.weapon_main,r=s.weapon_off,l=n&&n.name,o=r&&r.name,i=(l&&this.isTwoHandedWeapon(n),l&&this.isOneHandedWeapon(n)),c=o&&this.isOneHandedWeapon(r),d=this.isTwoHandedWeapon(t),u=(this.isOneHandedWeapon(t),Ro(a.player.equipment));let p;const m=[];l?i?d?(m.push(n.name),this.unequipItem('weapon_main',!0),o&&(m.push(r.name),this.unequipItem('weapon_off',!0)),p='weapon_main'):(o&&(m.push(r.name),this.unequipItem('weapon_off',!0)),p='weapon_off'):(m.push(n.name),this.unequipItem('weapon_main',!0),p='weapon_main'):o&&c?(d&&(m.push(r.name),this.unequipItem('weapon_off',!0)),p='weapon_main'):p='weapon_main',this.removeItem(e,1,!0),a.player.equipment[p]={...t,count:1};const g=Ro(a.player.equipment),h=g.hp_max-u.hp_max,f=g.mp_max-u.mp_max,v=g.sp_max-u.sp_max;0!==h&&(a.player.stats.hp.current+=h,a.player.stats.hp.max+=h),0!==f&&(a.player.stats.mp.current+=f,a.player.stats.mp.max+=f),0!==v&&(a.player.stats.sp.current+=v,a.player.stats.sp.max+=v);const y='weapon_main'===p?'主手':'副手';return m.length>0?this.logger?.log(`Equipped ${t.name} to ${y} (unequipped: ${m.join(', ')})`):this.logger?.log(`Equipped ${t.name} to ${y}`),this.saveService?.saveData('Equip Weapon'),this.eventBus.emit('equipment:updated',{slot:p,item:a.player.equipment[p]}),this.offlineActionService?.recordAction(Po.EQUIP,{slot:this.EQUIPMENT_SLOTS[p]?.name||p,itemName:t.name,prevItemName:m.length>0?m[0]:void 0,isUnequip:!1}),this.updateOverweightStatus(),!0}unequipItem(e,t=!1){const a=this.saveService?.getGameState();if(!a)return;const s=a.player.equipment[e];if(!s||!s.name)return;const n=Ro(a.player.equipment);this.addItem(s),delete a.player.equipment[e];const r=Ro(a.player.equipment),l=r.hp_max-n.hp_max,o=r.mp_max-n.mp_max,i=r.sp_max-n.sp_max;0!==l&&(a.player.stats.hp.current=Math.max(1,a.player.stats.hp.current+l),a.player.stats.hp.max+=l),0!==o&&(a.player.stats.mp.current=Math.max(0,a.player.stats.mp.current+o),a.player.stats.mp.max+=o),0!==i&&(a.player.stats.sp.current=Math.max(0,a.player.stats.sp.current+i),a.player.stats.sp.max+=i),t||(this.logger?.log(`Unequipped ${s.name} from ${e}`),this.saveService?.saveData('Unequip Item'),this.eventBus.emit('equipment:updated',{slot:e,item:null}),this.offlineActionService?.recordAction(Po.EQUIP,{slot:this.EQUIPMENT_SLOTS[e]?.name||e,itemName:s.name,isUnequip:!0}))}getSlotFromItemType(e,t){if(!e)return null;if(e.includes('饰品')||e.includes('戒指')||e.includes('项链')||'accessory'===e){const e=['accessory_1','accessory_2','accessory_3','accessory_4'];for(const a of e)if(!t[a]||!t[a]?.name)return a;return'accessory_1'}for(const[t,a]of Object.entries(this.EQUIPMENT_SLOTS))if('weapon_main'!==t&&'weapon_off'!==t&&'accessory'!==t&&a.keywords.some(t=>e.includes(t)))return t;return null}generateNextItemId(e){let t=0;for(const a of Object.keys(e)){const e=a.match(/^item_(\d+)$/);if(e){const a=parseInt(e[1],10);a>t&&(t=a)}}return`item_${(t+1).toString().padStart(2,'0')}`}compactItemIds(){const e=this.saveService?.getGameState();if(!e)return!1;const t=e.inventory.items,a=Object.keys(t);if(0===a.length)return!1;const s=a.filter(e=>/^item_\d+$/.test(e)),n=a.filter(e=>!/^item_\d+$/.test(e)),r=s.sort((e,t)=>parseInt(e.replace('item_',''),10)-parseInt(t.replace('item_',''),10)),l=[...r,...n.sort()];let o=n.length>0;if(!o)for(let e=0;e<r.length;e++){const t=`item_${(e+1).toString().padStart(2,'0')}`;if(r[e]!==t){o=!0;break}}if(!o)return!1;const i={};for(let e=0;e<l.length;e++){const a=l[e];i[`item_${(e+1).toString().padStart(2,'0')}`]=t[a]}e.inventory.items=i;const c=n.length;return c>0?this.logger?.log(`Compacted inventory: ${a.length} items, converted ${c} non-standard IDs`):this.logger?.log(`Compacted inventory IDs: ${a.length} items reorganized`),this.saveService?.saveData('Inventory Compact'),this.eventBus.emit('inventory:updated',e.inventory),!0}validateEquipmentForSlot(e,t,a=1){const s=Bo[t];if(!s)return{valid:!1,reason:`未知的装备槽位: ${t}`};const n=e.req?.level??e.level??0;if(n>a)return{valid:!1,reason:`等级不足: 需要 ${n} 级，当前 ${a} 级`};const r=e.type;if(!s.types.includes(r)){const a=this.findSuggestedSlot(e);return{valid:!1,reason:`物品类型 "${r}" 不能装备到 "${this.EQUIPMENT_SLOTS[t]?.name||t}"`,suggestedSlot:a}}if(s.subtypes&&e.subtype){if('weapon_off'===t&&this.isTwoHandedWeapon(e))return{valid:!1,reason:`双手武器 "${e.name}" 不能装备到副手，只能装备到主手`,suggestedSlot:'weapon_main'};if(!s.subtypes.includes(e.subtype)){const a=this.findSuggestedSlot(e);return{valid:!1,reason:`物品子类型 "${e.subtype}" 不适合装备到 "${this.EQUIPMENT_SLOTS[t]?.name||t}"`,suggestedSlot:a}}}return'weapon_main'!==t&&'weapon_off'!==t||'weapon'===r||this.isWeapon(e)?{valid:!0}:{valid:!1,reason:'非武器物品不能装备到武器槽位'}}findSuggestedSlot(e){const t=e.type,a=e.subtype;if('weapon'===t||this.isWeapon(e))return this.isTwoHandedWeapon(e),'weapon_main';if('accessory'===t)return'accessory_1';if(a)for(const[e,t]of Object.entries(Bo))if(t.subtypes?.includes(a))return e}validateEquipmentChanges(e,t=1){const a=[];for(const s of e){const e=this.validateEquipmentForSlot(s.item,s.slot,t);a.push({slot:s.slot,result:e})}const s=e.find(e=>'weapon_main'===e.slot),n=e.find(e=>'weapon_off'===e.slot);if(s&&this.isTwoHandedWeapon(s.item)&&n){const e=a.find(e=>'weapon_off'===e.slot);e&&(e.result={valid:!1,reason:`主手装备双手武器 "${s.item.name}" 时，副手必须为空`})}return a}}class qo extends Bl{damageService;effectService;saveService;inventoryService;shieldService;summonService;settlementService;offlineActionService;timeline=new go;combatantCache=new Map;pendingCounterAttacks=[];speedMultiplier=1;isAutoBattle=!1;diceAnimationResolver=null;battleStats=this.createEmptyBattleStats();pendingPermanentEffects=[];constructor(){super('BattleService')}async init(){this.saveService=Ll.serviceLocator.get('SaveService'),this.damageService=Ll.serviceLocator.get('DamageService'),this.effectService=Ll.serviceLocator.get('EffectService'),this.inventoryService=Ll.serviceLocator.get('InventoryService');try{this.shieldService=Ll.serviceLocator.get('ShieldService')}catch{console.warn('[BattleService] ShieldService not registered')}try{this.summonService=Ll.serviceLocator.get('SummonService')}catch{console.warn('[BattleService] SummonService not registered')}try{this.settlementService=Ll.serviceLocator.get('BattleSettlementService')}catch{console.warn('[BattleService] BattleSettlementService not registered')}try{this.offlineActionService=Ll.serviceLocator.get('OfflineActionService')}catch{console.warn('[BattleService] OfflineActionService not registered')}}createEmptyBattleStats(){return{totalDamageDealt:0,totalDamageTaken:0,totalHealing:0,turnCount:0,killCount:0,criticalHits:0}}getState(){const e=this.saveService.getGameState();if(!e)throw new Error('Game state not initialized');return e}getBattleState(){return this.getState().combat}getTimeline(){return this.timeline}getActionPreview(e=10){return this.timeline.getActionOrder(e)}setSpeedMultiplier(e){this.speedMultiplier=e;const t=this.getState();t.player.battleSettings||(t.player.battleSettings={autoBattle:!1,speedMultiplier:1}),t.player.battleSettings.speedMultiplier=e,this.saveService.saveData()}getSpeedMultiplier(){return this.speedMultiplier}setAutoBattle(e){this.isAutoBattle=e;const t=this.getState();t.player.battleSettings||(t.player.battleSettings={autoBattle:!1,speedMultiplier:1}),t.player.battleSettings.autoBattle=e,this.saveService.saveData(),this.eventBus.emit('battle:auto_toggle',{enabled:e});const a=this.getBattleState();if(e&&a){const e=this.getCombatantById(a.currentActorId||'');e&&(e.isPlayer||e.isAlly)&&setTimeout(()=>{this.executeAllyOrAutoAction(e)},100)}}getAutoBattle(){return this.isAutoBattle}startBattle(e,t){const a=this.getState();this.timeline.reset(),this.combatantCache.clear(),this.pendingCounterAttacks=[],this.pendingPermanentEffects=[],this.battleStats=this.createEmptyBattleStats();const s=a.player.battleSettings||{autoBattle:!1,speedMultiplier:1};this.speedMultiplier=s.speedMultiplier,this.isAutoBattle=s.autoBattle;const n=e.map(e=>this.initializeCombatant(e)),r=this.getActiveAllies().map(e=>this.initializeCombatant(e));a.combat={isInCombat:!0,actionCount:0,turnCount:0,enemies:n,allies:r,summons:[],currentActorId:null,currentTurnIndex:0,timeline:[],logs:[],isDebugBattle:t?.isDebugBattle||!1};const l=this.getPlayer(),o=Fl.getAttribute(l,'SPD')||10,i=10*o;this.timeline.addUnit(l.id,l.name,i,!0),this.combatantCache.set(l.id,l),console.log(`[Battle] 玩家 ${l.name} 加入战斗, SPD=${o} (timeline: ${i})`),r.forEach(e=>{const t=Fl.getAttribute(e,'SPD')||10,a=10*t;this.timeline.addUnit(e.id,e.name,a,!0),this.combatantCache.set(e.id,e),console.log(`[Battle] 队友 ${e.name} 加入战斗, SPD=${t} (timeline: ${a})`)}),n.forEach(e=>{const t=Fl.getAttribute(e,'SPD')||10,a=10*t;this.timeline.addUnit(e.id,e.name,a,!1),this.combatantCache.set(e.id,e),console.log(`[Battle] 敌人 ${e.name} 加入战斗, SPD=${t} (timeline: ${a})`)}),this.log('战斗开始！'),this.eventBus.emit('combat:start',{enemies:n,allies:r}),this.triggerBattleStartEffects(),this.syncTimelineState(),this.emitStateUpdate(),this.advanceToNextActor()}addEnemies(e){const t=this.getState().combat;if(!t||!t.isInCombat)return console.warn('[BattleService] Cannot add enemies: not in combat'),0;let a=0;const s=new Set(t.enemies.map(e=>e.id)),n=new Set(t.enemies.map(e=>e.name.toLowerCase()));for(const r of e){const e=s.has(r.id),l=n.has(r.name.toLowerCase());if(e){this.log(`${r.name} 已在战斗中（ID匹配），跳过追加`);continue}if(l){this.log(`${r.name} 已在战斗中（名称匹配），跳过追加`);continue}const o=this.initializeCombatant(r);t.enemies.push(o);const i=Fl.getAttribute(o,'SPD')||10,c=10*i;this.timeline.addUnit(o.id,o.name,c,!1),this.combatantCache.set(o.id,o),s.add(o.id),n.add(o.name.toLowerCase()),this.log(`${o.name} 加入战斗！(SPD=${i})`),a++}return a>0&&(this.eventBus.emit('combat:enemies_added',{count:a,enemies:e}),this.syncTimelineState(),this.emitStateUpdate()),a}isEnemyInCombat(e,t){const a=this.getBattleState();return!(!a||!a.isInCombat)&&(!(!e||!a.enemies.some(t=>t.id===e&&!t.isDead))||!(!t||!a.enemies.some(e=>e.name.toLowerCase()===t.toLowerCase()&&!e.isDead)))}getActiveAllies(){const e=this.getState();return e.allies?Object.values(e.allies).filter(e=>e.isActive&&e.isAvailable).map(e=>{return{id:(t=e).id,name:t.name,type:'ally',isPlayer:!1,isAlly:!0,allyType:t.allyType,level:t.level,base:{name:t.name,race:t.race,class:t.class,level:t.level,avatar:t.avatar,gender:t.gender},stats:{...t.stats},attributes:{...t.attributes},equipment:t.equipment||{},skills:t.skills||{},statusEffects:t.statusEffects||[],shields:t.shields||[],statModifiers:t.statModifiers||{},aiType:t.aiType||'follow',isDead:t.stats.hp.current<=0,isStunned:!1,hasActed:!1};var t}):[]}initializeCombatant(e){const a=e.level||1,s=25+4*a,n=20+2*a,r=25+3*a,l=8+Math.floor(a/4),o=e.stats||{};o.hp||(o.hp={current:s,max:s}),o.mp||(o.mp={current:n,max:n}),o.sp||(o.sp={current:r,max:r});let i={hp_max:0,mp_max:0,sp_max:0,str:0,dex:0,con:0,int:0,wis:0,cha:0,spd:0,ac:0,crit_rate:0,crit_dmg:0};e.isAlly&&e.equipment&&(i=Ro(e.equipment)),o.hp.max+=i.hp_max,o.mp.max+=i.mp_max,o.sp.max+=i.sp_max,o.hp.current=Math.min(o.hp.current??o.hp.max,o.hp.max),o.mp.current=Math.min(o.mp.current??o.mp.max,o.mp.max),o.sp.current=Math.min(o.sp.current??o.sp.max,o.sp.max);const c=e.attributes||{};void 0===c.STR&&(c.STR=c.str??l),void 0===c.DEX&&(c.DEX=c.dex??l),void 0===c.CON&&(c.CON=c.con??l),void 0===c.INT&&(c.INT=c.int??l),void 0===c.WIS&&(c.WIS=c.wis??l),void 0===c.CHA&&(c.CHA=c.cha??l),void 0===c.SPD&&(c.SPD=c.spd??8+Math.floor(a/3));let d=e.resistances;if(e.race){const t=no.getFromRace(e.race);(t.damageTypes||t.effectTags)&&(d=d?no.mergeConfigs(t,d):{damageTypes:t.damageTypes||{},effectTags:t.effectTags})}const u=this.getWeaponDamages(e),p=Math.floor((c.STR-10)/2),m=[];if(0===u.length){let t;if(e.isPlayer||e.isAlly)t=p>=0?`1d6+${p}`:`1d6${p}`;else{const s=e.tier||1;t=`1d6+${a+(3===s?5:2===s?2:0)}`,console.log(`[Battle] ${e.name} (Lv${a}, Tier${s}) 普攻伤害: ${t}`)}m.push({trigger:'immediate',action:'damage',target:'target',value:t,tags:['physical','unarmed']})}else u.forEach(e=>{const t=e.damage||(p>=0?`1d6+${p}`:`1d6${p}`);m.push({trigger:'immediate',action:'damage',target:'target',value:t,tags:['physical','weapon_main'===e.slot?'main_hand':'off_hand']})});const g={name:'普通攻击',type:'active',tier:1,tags:['physical','melee','basic'],cooldown:0,currentCooldown:0,target:'single_enemy',effects:m};let h;e.skills&&'object'==typeof e.skills&&Object.keys(e.skills).length>0?(h=Array.isArray(e.skills)?e.skills.reduce((e,t,a)=>(e[t.id||`skill_${(a+1).toString().padStart(2,'0')}`]=t,e),{}):{...e.skills},h.basic_attack||(h.basic_attack=g)):h={basic_attack:g};const f={...e.statModifiers||{}};return e.isAlly&&(i.str&&(f.str=(f.str||0)+i.str),i.dex&&(f.dex=(f.dex||0)+i.dex),i.con&&(f.con=(f.con||0)+i.con),i.int&&(f.int=(f.int||0)+i.int),i.wis&&(f.wis=(f.wis||0)+i.wis),i.cha&&(f.cha=(f.cha||0)+i.cha),i.spd&&(f.spd=(f.spd||0)+i.spd),i.ac&&(f.ac=(f.ac||0)+i.ac),i.crit_rate&&(f.crit_rate=(f.crit_rate||0)+i.crit_rate),i.crit_dmg&&(f.crit_dmg=(f.crit_dmg||0)+i.crit_dmg)),{...e,id:e.id||t(),level:a,stats:o,attributes:c,resistances:d,skills:h,isDead:!1,isStunned:!1,isSilenced:!1,isTaunted:!1,hasActed:!1,statModifiers:f,statusEffects:e.statusEffects||[],shields:e.shields||[],counterEffects:e.counterEffects||[],counterTriggersThisTurn:0}}triggerBattleStartEffects(){this.getAllCombatants().forEach(e=>{Object.values(e.passiveSkills||{}).forEach(t=>{t.effects?.forEach(t=>{'battle_start'!==t.trigger&&'passive'!==t.trigger||this.applyEffectWithTarget(e,t)})}),Object.values(e.skills||{}).forEach(t=>{'passive'===t.type&&t.effects?.forEach(t=>{'battle_start'!==t.trigger&&'passive'!==t.trigger||this.applyEffectWithTarget(e,t)})}),e.equipment&&Object.values(e.equipment).forEach(t=>{t.effects?.forEach(t=>{'battle_start'===t.trigger&&this.applyEffectWithTarget(e,t)})})})}triggerBattleEndEffects(){[this.getPlayer(),...this.getActiveAllies()].filter(e=>!e.isDead).forEach(e=>{Object.values(e.passiveSkills||{}).forEach(t=>{t.effects?.forEach(t=>{'battle_end'===t.trigger&&this.applyEffectWithTarget(e,t)})}),e.equipment&&Object.values(e.equipment).forEach(t=>{t.effects?.forEach(t=>{'battle_end'===t.trigger&&this.applyEffectWithTarget(e,t)})})})}advanceToNextActor(){const e=this.getState();if(!e.combat)return;const t=this.checkBattleEnd();if(t)return void this.endBattle(t);const a=this.timeline.advanceToNextAction();if(!a)return void this.log('没有可行动的单位！');const s=this.getCombatantById(a);s?(e.combat.currentActorId=a,e.combat.actionCount++,this.battleStats.turnCount++,this.syncTimelineState(),this.onUnitTurnStart(s)):this.log(`找不到单位: ${a}`)}onUnitTurnStart(e){const t=this.timeline.getUnit(e.id),a=t?.isExtraTurn||!1;if(this.log(`--- ${e.name} 的${a?'额外':''}回合 ---`),e.isInExtraTurn=a,e.counterTriggersThisTurn=0,!Fl.canAct(e))return this.log(`${e.name} 无法行动！`),void this.onUnitSkipTurn(e);Object.values(e.skills).forEach(e=>{e.currentCooldown&&e.currentCooldown>0&&e.currentCooldown--}),this.tickStatusEffects(e,'turn_start'),this.triggerTurnStartEffects(e);const s=this.checkBattleEnd();if(s)return void this.endBattle(s);if(this.shieldService&&this.shieldService.tickShields(e),e.stats.hp.current<=0)return this.handleUnitDeath(e),void this.advanceToNextActor();e.isPlayer||e.isAlly||this.generateEnemyIntent(e),this.eventBus.emit('combat:unit_turn_start',{unit:e,isExtraTurn:a}),this.emitStateUpdate();const n=!0===e.isSummon,r=!e.isPlayer&&!e.isAlly,l=e.isPlayer||e.isAlly;if(n){const t=this.lastActionWasPlayer?2800:800;this.lastActionWasPlayer=!1,setTimeout(()=>{this.executeSummonAction(e)},t)}else if(r){const t=this.lastActionWasPlayer?2800:800;this.lastActionWasPlayer=!1,setTimeout(()=>{this.executeEnemyAction(e)},t)}else if(l&&this.isAutoBattle){const t=this.lastActionWasPlayer?2800:800;this.lastActionWasPlayer=!1,setTimeout(()=>{this.executeAllyOrAutoAction(e)},t)}}lastActionWasPlayer=!1;tickStatusEffects(e,t){if('turn_start'===t){const t=this.effectService.tickStatusEffects(e);t.totalDamage>0&&t.effects.filter(e=>'dot'===e.type).forEach(t=>{this.log(`  [${t.statusName}] 对 ${e.name} 造成 ${t.value} 点伤害`)}),t.totalHeal>0&&t.effects.filter(e=>'hot'===e.type).forEach(t=>{this.log(`  [${t.statusName}] 恢复 ${e.name} ${t.value} 点生命`)}),t.expiredStatuses.forEach(t=>{this.log(`${e.name} 的 [${t}] 效果消失了`)})}this.updateControlFlags(e)}updateControlFlags(e){e.isStunned=e.statusEffects.some(e=>!!e.preventsAction||(e.tags?.some(e=>Mo[e]?.preventsAction)??!1)),e.isSilenced=e.statusEffects.some(e=>!!e.preventsSkills||(e.tags?.some(e=>Mo[e]?.preventsSkills)??!1)),e.isTaunted=!1,e.tauntSourceId=void 0;for(const t of e.statusEffects){if(t.forcedTarget){e.isTaunted=!0,e.tauntSourceId=t.forcedTarget;break}if(t.tags?.some(e=>Mo[e]?.forcedTargetSource)){e.isTaunted=!0,e.tauntSourceId=t.sourceId;break}}}onUnitSkipTurn(e){this.log(`${e.name} 跳过了回合`),this.tickStatusEffects(e,'turn_end'),e.stats.hp.current<=0&&this.handleUnitDeath(e),this.timeline.afterAction(e.id,ro.LIGHT),this.eventBus.emit('combat:unit_skip_turn',{unit:e}),this.syncTimelineState(),this.emitStateUpdate(),this.advanceToNextActor()}endUnitTurn(e,t=ro.LIGHT){if(this.tickStatusEffects(e,'turn_end'),this.summonService&&e.isSummon){const t=Array.from(this.summonService.getAllActiveSummons()).find(t=>t.combatantRef===e.id)?.id;if(t){this.summonService.tickSummon(t,this.timeline)||(this.log(`${e.name} 消失了`),this.handleUnitDeath(e))}}this.processCounterAttacks(),this.timeline.afterAction(e.id,t),e.hasActed=!0,e.isInExtraTurn=!1,this.eventBus.emit('combat:unit_turn_end',{unit:e}),this.syncTimelineState(),this.emitStateUpdate();const a=this.checkBattleEnd();a?this.endBattle(a):this.advanceToNextActor()}processCounterAttacks(){for(;this.pendingCounterAttacks.length>0;){const e=this.pendingCounterAttacks.shift();if(!e.attacker.isDead&&!e.target.isDead)if(this.log(`${e.attacker.name} 发动反击！`),e.effect.skillKey){const t=e.attacker.skills[e.effect.skillKey];t&&this.executeSkillInternal(e.attacker,t,[e.target],!0)}else e.effect.effects&&e.effect.effects.forEach(t=>{this.applyEffectToTarget(e.attacker,e.target,t)})}}resolveDiceAnimation(e){this.diceAnimationResolver&&(this.diceAnimationResolver(e),this.diceAnimationResolver=null)}executeSkill(e,t,a){return this.executeSkillAsync(e,t,a,!1),{success:!0,effectsApplied:[]}}async executeSkillAsync(e,t,a,s=!1){return this.executeSkillInternal(e,t,a,s)}waitForDiceAnimationDelay(){return new Promise(e=>{const t=this.speedMultiplier>=2?50:2500;setTimeout(e,t)})}executeSkillInternal(e,t,a,s=!1){const n={success:!0,effectsApplied:[],counterAttacks:[]};if(e.isSilenced&&'active'===t.type&&!t.tags?.includes('basic'))return this.log(`${e.name} 被沉默，无法使用 [${t.name}]！`),{success:!1,message:'被沉默'};if(t.currentCooldown&&t.currentCooldown>0)return this.log(`[${t.name}] 还在冷却中！`),{success:!1,message:'冷却中'};if(t.cost){if(t.cost.mp&&e.stats.mp.current<t.cost.mp)return{success:!1,message:'MP不足'};if(t.cost.sp&&e.stats.sp.current<t.cost.sp)return{success:!1,message:'SP不足'};if(t.cost.hp&&e.stats.hp.current<=t.cost.hp)return{success:!1,message:'HP不足'}}this.log(`${e.name} 使用了 [${t.name}]！`);const r=a[0];let l=null;r&&t.effects?.some(e=>'damage'===e.action)&&(l=oo.checkHit(e,r,t));const o=this.hitResultToD20Visual(l);if(t.cost){const a=this.getState(),s=e.isPlayer?a.player.stats:e.stats;t.cost.mp&&(s.mp.current-=t.cost.mp),t.cost.sp&&(s.sp.current-=t.cost.sp),t.cost.hp&&(s.hp.current-=t.cost.hp)}if(t.currentCooldown=t.cooldown?t.cooldown+1:0,e.isPlayer&&!s)return this.eventBus.emit('combat:roll_dice',{source:e,skill:t,targets:a,diceResult:o,hitResult:l}),this.scheduleDelayedDamage(e,t,a,s,l),{success:!0,effectsApplied:[]};const i=t.hitCount||1,c=t.hitDamageRatio||Array(i).fill(1/i);t.effects&&t.effects.forEach(r=>{const l=this.resolveTargets(e,a,r.target);if(console.log(`[executeSkillInternal] ${e.name} 执行效果: action=${r.action}, validTargets=${l.map(e=>e.name).join(',')}`),'damage'===r.action&&i>1)for(let a=0;a<i;a++){const o=c[a]||1/i;l.forEach(l=>{if(l.isDead)return;const i={...r,damageRatio:o},c=this.damageService.resolveDamage(e,l,i,t);c.hit.isHit?(n.damage=(n.damage||0)+c.damage.total,this.log(`  > 第${a+1}击对 ${l.name} 造成 ${c.damage.total} 点伤害`+(c.hit.isCrit?' (暴击!)':'')),e.isPlayer?(this.battleStats.totalDamageDealt+=c.damage.total,c.hit.isCrit&&this.battleStats.criticalHits++):l.isPlayer&&(this.battleStats.totalDamageTaken+=c.damage.total),this.eventBus.emit('combat:damage',{targetId:l.id,damage:c.damage.total,isCrit:c.hit.isCrit}),s||this.checkCounterAttack(l,e,r),l.stats.hp.current<=0&&this.handleUnitDeath(l,e,t)):this.log(`  > ${l.name} 闪避了攻击！`)})}else l.forEach(a=>{if(!(a.isDead&&'revive'!==r.action||(this.applyEffectToTarget(e,a,r,t),'damage'!==r.action||s))){this.checkCounterAttack(a,e,r);const s=t.tags?.includes('basic');this.triggerEquipmentOnHitEffects(e,a,s)}})});const d=this.getSkillDelayTier(t);return e.isPlayer&&!s&&(this.lastActionWasPlayer=!0),s||this.endUnitTurn(e,d),n}hitResultToD20Visual(e){if(!e)return lo.DiceRoller.roll('1d20');if(e.isCrit)return 20;if(e.isDodge)return 1;if(e.isGlance)return Math.floor(4*Math.random())+2;if(e.isBlock)return Math.floor(4*Math.random())+6;const t=Math.min(1,e.roll/e.hitChance);return Math.floor(19-9*t)}async scheduleDelayedDamage(e,t,a,s,n){await this.waitForDiceAnimationDelay();const r=e.isPlayer?this.getPlayer():e,l=a.map(e=>e.isPlayer?this.getPlayer():this.getCombatantById(e.id)||e),o=t.hitCount||1,i=t.hitDamageRatio||Array(o).fill(1/o);t.effects&&t.effects.forEach(e=>{const a=this.resolveTargets(r,l,e.target);if('damage'===e.action&&o>1)for(let l=0;l<o;l++){const c=i[l]||1/o;a.forEach((a,o)=>{if(a.isDead)return;const i={...e,damageRatio:c},d=0===l&&0===o&&n?this.damageService.resolveDamageWithHitResult(r,a,i,t,n):this.damageService.resolveDamage(r,a,i,t);d.hit.isHit?(this.log(`  > 第${l+1}击对 ${a.name} 造成 ${d.damage.total} 点伤害`+(d.hit.isCrit?' (暴击!)':'')),r.isPlayer?(this.battleStats.totalDamageDealt+=d.damage.total,d.hit.isCrit&&this.battleStats.criticalHits++):a.isPlayer&&(this.battleStats.totalDamageTaken+=d.damage.total),this.eventBus.emit('combat:damage',{targetId:a.id,damage:d.damage.total,isCrit:d.hit.isCrit}),s||this.checkCounterAttack(a,r,e),a.stats.hp.current<=0&&this.handleUnitDeath(a,r,t)):this.log(`  > ${a.name} 闪避了攻击！`)})}else a.forEach((a,l)=>{if(!a.isDead||'revive'===e.action){if('damage'===e.action&&0===l&&n){const l=this.damageService.resolveDamageWithHitResult(r,a,e,t,n);if(l.hit.isHit){if(this.log(`  > 对 ${a.name} 造成 ${l.damage.total} 点伤害`+(l.hit.isCrit?' (暴击!)':'')),r.isPlayer?(this.battleStats.totalDamageDealt+=l.damage.total,l.hit.isCrit&&this.battleStats.criticalHits++):a.isPlayer&&(this.battleStats.totalDamageTaken+=l.damage.total),this.eventBus.emit('combat:damage',{targetId:a.id,damage:l.damage.total,isCrit:l.hit.isCrit}),!s){this.checkCounterAttack(a,r,e);const s=t.tags?.includes('basic');this.triggerEquipmentOnHitEffects(r,a,s)}a.stats.hp.current<=0&&this.handleUnitDeath(a,r,t)}else this.log(`  > ${a.name} 闪避了攻击！`);return}if(this.applyEffectToTarget(r,a,e,t),'damage'===e.action&&!s){this.checkCounterAttack(a,r,e);const s=t.tags?.includes('basic');this.triggerEquipmentOnHitEffects(r,a,s)}}})});const c=this.getSkillDelayTier(t);this.lastActionWasPlayer=!1,this.emitStateUpdate(),s||this.endUnitTurn(r,c)}getSkillDelayTier(e){return'actionDelay'in e&&void 0!==e.actionDelay?e.actionDelay:e.tags?.includes('instant')?ro.INSTANT:e.tags?.includes('heavy')||e.tags?.includes('ultimate')?ro.HEAVY:e.tags?.includes('medium')?ro.MEDIUM:ro.LIGHT}checkCounterAttack(e,t,a){e.counterEffects&&0!==e.counterEffects.length&&(e.isDead||e.counterEffects.forEach(a=>{if('on_hit'!==a.triggerOn&&'on_damage'!==a.triggerOn)return;if(a.maxTriggersPerTurn&&(e.counterTriggersThisTurn||0)>=a.maxTriggersPerTurn)return;const s=a.chance||100;100*Math.random()>s||(this.pendingCounterAttacks.push({attacker:e,target:t,effect:a}),e.counterTriggersThisTurn=(e.counterTriggersThisTurn||0)+1)}))}applyEffectToTarget(e,t,a,s,n){if(!n?.ignoreChance&&void 0!==a.chance&&a.chance<100){if(100*Math.random()>a.chance)return}'buff'===a.action&&a.persistent&&(this.pendingPermanentEffects||(this.pendingPermanentEffects=[]),this.pendingPermanentEffects.push({source:t,effect:a,victimName:n?.victimName||'未知来源'}),this.log(`  ⭐ [${a.statusName||'永久增益'}] 将在战斗胜利后永久生效`));const r={ignoreChance:!0};switch(a.action){case'damage':{const n=this.damageService.resolveDamage(e,t,a,s||null);n.hit.isHit?(this.log(`  > 对 ${t.name} 造成 ${n.damage.total} 点伤害`+(n.hit.isCrit?' (暴击!)':'')),e.isPlayer?(this.battleStats.totalDamageDealt+=n.damage.total,n.hit.isCrit&&this.battleStats.criticalHits++):t.isPlayer&&(this.battleStats.totalDamageTaken+=n.damage.total),this.eventBus.emit('combat:damage',{targetId:t.id,damage:n.damage.total,isCrit:n.hit.isCrit}),t.isDead||this.triggerOnHurtEffects(t,e,n.damage.total),t.stats.hp.current<=0&&this.handleUnitDeath(t,e,s)):this.log(`  > ${t.name} 闪避了攻击！`);break}case'heal':{const s=this.effectService.applyEffect(e,t,a,r).value??0;this.log(`  > 恢复 ${t.name} ${s} 点生命`),(e.isPlayer||t.isPlayer)&&(this.battleStats.totalHealing+=s);break}case'buff':case'debuff':this.effectService.applyEffect(e,t,a,r),this.log(`  > ${t.name} 获得了 [${a.statusName||'未命名状态'}] 状态`);break;case'shield':{const s=a.shieldValue??a.value;if(this.shieldService&&void 0!==s){const n='hits'===a.shieldMode?'count':'value';this.shieldService.addShield(t,{name:a.statusName||'护盾',value:'number'==typeof s?s:lo.DiceRoller.roll(s),type:n,duration:a.duration,sourceId:e.id,priority:a.shieldPriority}),this.log(`  > ${t.name} 获得了护盾`)}break}case'revive':if(t.isDead){t.isDead=!1;const e=a.reviveHpPercent||20;t.stats.hp.current=Math.floor(t.stats.hp.max*e/100),this.timeline.reviveUnit(t.id,50),this.log(`  > ${t.name} 复活了！(${t.stats.hp.current} HP)`),this.triggerOnReviveEffects(t)}break;case'advance':{const e=a.advancePercent||30;this.timeline.advanceUnit(t.id,e),this.log(`  > ${t.name} 行动条前进 ${e}%`);break}case'delay':{const e=a.delayPercent||30;this.timeline.delayUnit(t.id,e),this.log(`  > ${t.name} 行动条后退 ${e}%`);break}case'summon':if(this.summonService){let t;if(a.summonTemplate?t=this.summonService.createSimpleSummon(e,a.summonTemplate,this.timeline):a.summonId&&(t=this.summonService.createSummon(e,a.summonId,this.timeline)),t?.success&&t.combatant){const a=this.getBattleState();a&&(a.summons.push(t.combatant),this.combatantCache.set(t.combatant.id,t.combatant)),this.log(`  > ${e.name} 召唤了 ${t.combatant.name}！`)}}break;case'dispel':this.log(`  > 驱散了 ${t.name} 的增益效果 (暂未实现)`);break;case'cleanse':{const s=this.effectService.applyEffect(e,t,a,r).value??0;s>0?this.log(`  > 净化了 ${t.name} 的 ${s} 个减益效果`):this.log(`  > ${t.name} 没有可净化的减益效果`);break}default:'extra_turn'===a.action?(this.timeline.grantExtraTurn(t.id),this.log(`  > ${t.name} 获得额外回合！`)):this.effectService.applyEffect(e,t,a,r)}}triggerOnReviveEffects(e){}triggerTurnStartEffects(e){const t=this.timeline.getUnit(e.id),a=t?.isExtraTurn||!1;[...Object.values(e.skills||{}),...Object.values(e.passiveSkills||{})].forEach(t=>{'passive'===t.type&&t.effects?.forEach(s=>{if('turn_start'===s.trigger){if(a&&'extra_turn'===s.action)return;let n;n='target'===s.target||'enemy'===s.target?this.getEnemiesOf(e).filter(e=>!e.isDead):'ally'===s.target?this.getAlliesOf(e).filter(e=>!e.isDead):this.resolveTargets(e,[],s.target),n.forEach(a=>{a.isDead&&'revive'!==s.action||this.applyEffectToTarget(e,a,s,t)})}})}),e.equipment&&Object.values(e.equipment).forEach(t=>{t.effects?.forEach(t=>{if('turn_start'===t.trigger){this.resolveTargets(e,[],t.target).forEach(a=>{a.isDead&&'revive'!==t.action||this.applyEffectToTarget(e,a,t)})}})})}triggerOnHurtEffects(e,t,a){[...Object.values(e.skills||{}),...Object.values(e.passiveSkills||{})].forEach(s=>{'passive'===s.type&&s.effects?.forEach(n=>{if('on_hurt'!==n.trigger)return;this.resolveTargets(e,[t],n.target).forEach(t=>{this.applyEffectToTarget(e,t,n,s,{victimName:`受伤(${a}点)`})})})}),e.equipment&&Object.values(e.equipment).forEach(s=>{s.effects?.forEach(n=>{if('on_hurt'!==n.trigger)return;this.log(`  [${s.name}] 受伤触发效果！`);this.resolveTargets(e,[t],n.target).forEach(t=>{this.applyEffectToTarget(e,t,n,void 0,{victimName:`受伤(${a}点)`})})})})}triggerEquipmentOnHitEffects(e,t,a){e.equipment&&!t.isDead&&Object.entries(e.equipment).forEach(([s,n])=>{if(!n.effects)return;const r='weapon_main'===s||'weapon_off'===s;n.effects.forEach(s=>{if('on_hit'!==s.trigger)return;if(r&&!a)return;const l=s.chance??100;if(100*Math.random()>l)this.log(`  [${n.name}] 的命中效果未触发 (概率: ${l}%)`);else if(this.log(`  [${n.name}] 触发命中效果！`),'damage'===s.action){const a=this.damageService.resolveDamage(e,t,s,null);a.hit.isHit&&(this.log(`    > 对 ${t.name} 造成 ${a.damage.total} 点额外伤害`),e.isPlayer&&(this.battleStats.totalDamageDealt+=a.damage.total),this.eventBus.emit('combat:damage',{targetId:t.id,damage:a.damage.total,isCrit:a.hit.isCrit,isOnHit:!0}),t.stats.hp.current<=0&&this.handleUnitDeath(t,e))}else this.applyEffectToTarget(e,t,s,void 0,{ignoreChance:!0})})})}applyEffectWithTarget(e,t){this.resolveTargets(e,[],t.target).forEach(a=>{this.applyEffectToTarget(e,a,t)})}resolveTargets(e,t,a){switch(a){case'self':return[e];case'target':case'enemy':case'ally':return t;case'all_enemies':return this.getEnemiesOf(e);case'all_allies':return this.getAlliesOf(e);case'random_enemy':{const t=this.getEnemiesOf(e).filter(e=>!e.isDead);return t.length>0?[t[Math.floor(Math.random()*t.length)]]:[]}case'random_ally':{const t=this.getAlliesOf(e).filter(e=>!e.isDead);return t.length>0?[t[Math.floor(Math.random()*t.length)]]:[]}case'player':return[this.getPlayer()];default:return t.length>0?t:[e]}}defend(e){this.log(`${e.name} 摆出防御姿态！`);const t={id:`defend_${Date.now()}`,name:'防御姿态',duration:2,stacks:1,tags:['buff','defense'],sourceId:e.id,isBuff:!0,modifiers:{ac:4,defense:2}};if(e.isPlayer){const e=this.getState();e.player.statusEffects||(e.player.statusEffects=[]),e.player.statusEffects.push(t)}else e.statusEffects.push(t);this.eventBus.emit('combat:defend',{unit:e}),this.emitStateUpdate(),this.endUnitTurn(e,ro.LIGHT)}attemptFlee(e){const t=this.getState();if(!t.combat)return!1;const a=Math.floor((e.attributes.DEX-10)/2),s=lo.DiceRoller.roll('1d20')+a,n=t.combat.enemies.filter(e=>!e.isDead),r=Math.max(...n.map(e=>e.level||1)),l=10+n.length+Math.floor(r/2);return this.log(`${e.name} 试图逃跑！ (1d20+${a} = ${s} vs DC ${l})`),s>=l?(this.log(`${e.name} 成功逃离了战斗！`),this.eventBus.emit('combat:flee_success',{unit:e}),t.combat=void 0,this.eventBus.emit('combat:end',{result:'flee'}),this.emitStateUpdate(),!0):(this.log(`${e.name} 逃跑失败了！`),this.eventBus.emit('combat:flee_fail',{unit:e}),this.emitStateUpdate(),this.endUnitTurn(e,ro.LIGHT),!1)}async useItemInCombat(e,t){t.id?(this.log(`${e.name} 使用了 [${t.name}]！`),await this.inventoryService.useItem(t.id,e.id,1),this.emitStateUpdate(),this.endUnitTurn(e,ro.LIGHT)):console.warn('[BattleService] Cannot use item without id')}async useItemFromInventory(e,t){const a=this.getBattleState();if(!a||!a.currentActorId)return!1;const s=this.getCombatantById(a.currentActorId);return!!s&&(!(!s.isPlayer&&!s.isAlly)&&(e.id?(this.log(`${s.name} 使用了 [${e.name}]！`),await this.inventoryService.useItem(e.id,t,1),this.emitStateUpdate(),this.endUnitTurn(s,ro.LIGHT),!0):(console.warn('[BattleService] Cannot use item without id'),!1)))}getUsableItems(){const e=this.getState();return Object.values(e.inventory.items).filter(e=>{if('consumable'!==e.type||e.count<=0)return!1;const t=e.effects?.some(e=>'heal'===e.action||'buff'===e.action||'cleanse'===e.action||e.tags?.includes('combat')),a=e.tags?.includes('combat')||e.tags?.includes('consumable');return t||a})}generateAutoBattleIntent(e){if(!this.getBattleState())return null;const t=Object.values(e.skills).filter(t=>{if('active'!==t.type)return!1;if(t.currentCooldown&&t.currentCooldown>0)return!1;if(t.cost){if(t.cost.mp&&e.stats.mp.current<t.cost.mp)return!1;if(t.cost.sp&&e.stats.sp.current<t.cost.sp)return!1;if(t.cost.hp&&e.stats.hp.current<=t.cost.hp)return!1}return!0});if(0===t.length)return null;const a=this.getEnemiesOf(e).filter(e=>!e.isDead),s=this.getAlliesOf(e).filter(e=>!e.isDead),n=s.find(e=>e.stats.hp.current/e.stats.hp.max<.3);if(e.stats.hp.current/e.stats.hp.max<.3||n){const a=t.find(e=>e.effects?.some(e=>'heal'===e.action));if(a){const{mode:t}=yo(a.target);if('self'===t)return{skill:a,targets:[e]};if('all'===t)return{skill:a,targets:s};return{skill:a,targets:[[...s].sort((e,t)=>e.stats.hp.current/e.stats.hp.max-t.stats.hp.current/t.stats.hp.max)[0]]}}}const r=t.find(e=>e.effects?.some(e=>'damage'===e.action)||e.tags?.includes('basic')||e.tags?.includes('physical'));if(r&&a.length>0){const e=[...a].sort((e,t)=>e.stats.hp.current/e.stats.hp.max-t.stats.hp.current/t.stats.hp.max)[0],{mode:t}=yo(r.target);return'all'===t?{skill:r,targets:a}:{skill:r,targets:[e]}}const l=t[0];if(l){return{skill:l,targets:a.length>0?[a[0]]:[e]}}return null}executeSummonAction(e){if(!this.getBattleState())return;const t=Object.values(e.skills).filter(t=>{if(t.currentCooldown&&t.currentCooldown>0)return!1;if(t.cost){if(t.cost.mp&&e.stats.mp.current<t.cost.mp)return!1;if(t.cost.sp&&e.stats.sp.current<t.cost.sp)return!1;if(t.cost.hp&&e.stats.hp.current<=t.cost.hp)return!1}return!0});if(0===t.length)return this.log(`${e.name} 没有可用的行动！`),void this.endUnitTurn(e,ro.LIGHT);const a=this.getEnemiesOf(e).filter(e=>!e.isDead),s=this.getAlliesOf(e).filter(e=>!e.isDead);let n,r=[];if('support'===(e.aiType||'aggressive')){const e=s.find(e=>e.stats.hp.current/e.stats.hp.max<.5);if(e){const a=t.find(e=>e.effects?.some(e=>'heal'===e.action));a&&(n=a,r=[e])}}if(!n&&a.length>0){const e=t.find(e=>e.effects?.some(e=>'damage'===e.action)||e.tags?.includes('physical')||e.tags?.includes('magic'));if(e){n=e;const{mode:t}=yo(e.target);if('all'===t)r=a;else{r=[[...a].sort((e,t)=>e.stats.hp.current/e.stats.hp.max-t.stats.hp.current/t.stats.hp.max)[0]]}}}n||(n=t[0],r=a.length>0?[a[0]]:[e]),n&&r.length>0?(this.log(`[召唤物] ${e.name} 使用 [${n.name}] 对 ${r.map(e=>e.name).join(', ')}！`),this.executeSkill(e,n,r)):(this.log(`${e.name} 无法行动！`),this.endUnitTurn(e,ro.LIGHT))}executeAllyOrAutoAction(e){const t=this.generateAutoBattleIntent(e);if(!t)return this.log(`${e.name} 没有可用的行动，防御！`),void this.defend(e);const{skill:a,targets:s}=t;this.log(`[自动] ${e.name} 使用 [${a.name}] 对 ${s.map(e=>e.name).join(', ')}！`),this.executeSkill(e,a,s)}generateEnemyIntent(e){console.log(`[generateEnemyIntent] ${e.name} 的技能对象:`,e.skills),console.log('[generateEnemyIntent] 技能键列表:',Object.keys(e.skills||{}));const t=Object.values(e.skills).filter(t=>{if('active'!==t.type)return!1;if(t.currentCooldown&&t.currentCooldown>0)return!1;if(t.cost){if(t.cost.mp&&e.stats.mp.current<t.cost.mp)return!1;if(t.cost.sp&&e.stats.sp.current<t.cost.sp)return!1;if(t.cost.hp&&e.stats.hp.current<=t.cost.hp)return!1}return!0});console.log('[generateEnemyIntent] 可用技能数量:',t.length),t.forEach((e,t)=>{console.log(`[generateEnemyIntent] 可用技能${t}:`,e.name,'effects:',e.effects?.length||0)});const a=Fl.getForcedTarget(e);let s;if(a)s=a;else{const t=this.getEnemiesOf(e).filter(e=>!e.isDead);if(t.length>0){s=t[Math.floor(Math.random()*t.length)].id}else s='player'}if(t.length>0){const a=t.filter(e=>!e.tags?.includes('basic')),n=a.length>0?a[Math.floor(Math.random()*a.length)]:t[Math.floor(Math.random()*t.length)],r=Object.keys(e.skills).find(t=>e.skills[t]===n);console.log('[generateEnemyIntent] 选中技能:',n.name,'skillKey:',r,'effects:',n.effects?.length||0),e.nextAction={type:'attack',skillKey:r,targets:[s],description:`准备使用 ${n.name}`}}else e.nextAction={type:'wait',description:'正在休息'}}executeEnemyAction(e){const t=e.nextAction;if(!t||'wait'===t.type)return this.log(`${e.name} 发呆了。`),void this.endUnitTurn(e,ro.LIGHT);console.log(`[executeEnemyAction] ${e.name} 的技能列表:`,Object.keys(e.skills||{})),console.log('[executeEnemyAction] intent.skillKey:',t.skillKey),console.log('[executeEnemyAction] enemy.skills:',e.skills);const a=t=>{if('active'!==t.type)return!1;if(t.currentCooldown&&t.currentCooldown>0)return!1;if(t.cost){if(t.cost.mp&&e.stats.mp.current<t.cost.mp)return!1;if(t.cost.sp&&e.stats.sp.current<t.cost.sp)return!1;if(t.cost.hp&&e.stats.hp.current<=t.cost.hp)return!1}return!0};let s=t.skillKey?e.skills[t.skillKey]:void 0;if(s?(console.log('[executeEnemyAction] 找到技能:',s.name,'类型:',s.type,'效果数量:',s.effects?.length||0),s.effects&&s.effects.forEach((e,t)=>{console.log(`[executeEnemyAction] 效果${t}:`,e.action,e.target,e.value)})):console.log('[executeEnemyAction] 未找到技能，skillKey:',t.skillKey),s&&!a(s)&&(console.log('[executeEnemyAction] 技能不可用:',s.name),s=void 0),s||(s=Object.values(e.skills).find(e=>a(e))),!s)return this.log(`${e.name} 没有可用技能！`),void this.endUnitTurn(e,ro.LIGHT);let n=[];const{mode:r}=yo(s.target);if('self'===r||s.effects?.some(e=>'summon'===e.action))n=[e],this.log(`${e.name} 使用 [${s.name}]！`);else{if(t.targets&&t.targets.length>0&&(n=t.targets.map(e=>this.getCombatantById(e)).filter(e=>e&&!e.isDead)),0===n.length){const e=this.getPlayer();e.isDead||(n=[e])}if(0===n.length)return this.log(`${e.name} 找不到目标！`),void this.endUnitTurn(e,ro.LIGHT);this.log(`${e.name} 准备攻击 ${n.map(e=>e.name).join(', ')}！`)}this.executeSkill(e,s,n)}handleUnitDeath(e,t,a){if(!e.isDead&&(e.isDead=!0,this.timeline.markDead(e.id),this.log(`${e.name} 倒下了！`),this.eventBus.emit('combat:death',{unit:e,killer:t}),t?.isPlayer&&!e.isPlayer&&this.battleStats.killCount++,t&&this.triggerOnKillEffects(t,e,a),this.summonService&&e.isSummon)){const t=this.summonService.getAllActiveSummons().find(t=>t.combatantRef===e.id);t&&this.summonService.destroySummon(t.id,this.timeline)}}triggerOnKillEffects(e,t,a){const s=new Set;if(a&&'active'===a.type){const n=Object.keys(e.skills||{}).find(t=>e.skills[t]===a);a.effects?.forEach(a=>{if('on_kill'===a.trigger){const r=`${n||'unknown'}_${a.action}_${a.target}_${a.value}`;s.has(r)||(s.add(r),this.applyOnKillEffect(e,t,a))}})}Object.entries(e.passiveSkills||{}).forEach(([a,n])=>{n.effects?.forEach(n=>{if('on_kill'===n.trigger){const r=`${a}_${n.action}_${n.target}_${n.value}`;s.has(r)||(s.add(r),this.applyOnKillEffect(e,t,n))}})}),Object.entries(e.skills||{}).forEach(([a,n])=>{'passive'===n.type&&n.effects?.forEach(n=>{if('on_kill'===n.trigger){const r=`${a}_${n.action}_${n.target}_${n.value}`;s.has(r)||(s.add(r),this.applyOnKillEffect(e,t,n))}})})}applyOnKillEffect(e,t,a){this.resolveTargets(e,[t],a.target).forEach(s=>{this.applyEffectToTarget(e,s,a,void 0,{victimName:t.name})})}checkBattleEnd(){if(this.getPlayer().stats.hp.current<=0)return'lose';return(this.getState().combat?.enemies||[]).every(e=>e.isDead)?'win':null}endBattle(e){const t=this.getState(),a=t.combat,s=a?.enemies?[...a.enemies]:[];let n;if(this.log('战斗结束！结果: '+('win'===e?'胜利':'lose'===e?'失败':'逃跑')),a?.allies&&a.allies.forEach(e=>{Object.values(e.skills||{}).forEach(e=>{e.currentCooldown=0}),e.statusEffects=[]}),a?.allies&&t.allies&&a.allies.forEach(e=>{const a=t.allies[e.id];a&&function(e,t){t.stats.hp.current=e.stats.hp.current,t.stats.mp.current=e.stats.mp?.current??t.stats.mp.current,t.stats.sp.current=e.stats.sp?.current??t.stats.sp.current,t.statusEffects=e.statusEffects,t.shields=e.shields,t.statModifiers=e.statModifiers}(e,a)}),'win'===e&&this.settlementService&&a&&(n=this.settlementService.settle(a.enemies,this.battleStats),this.log(`获得 ${n.exp} 经验值，${this.formatCurrency(n.gold)}`),n.levelUp&&this.log(`🎉 升级！当前等级: ${n.newLevel}`),this.triggerBattleEndEffects(),this.applyPendingPermanentEffects()),this.offlineActionService&&a){const t={result:e,enemyNames:s.map(e=>e.name),expGained:n?.exp||0,goldGained:n?.gold||0,levelUp:n?.levelUp?{previousLevel:n.previousLevel,newLevel:n.newLevel}:void 0,statistics:this.battleStats};this.offlineActionService.recordAction(Po.BATTLE_RESULT,t)}this.summonService&&this.summonService.reset(),t.player.shields&&(t.player.shields=[]),t.player.statusEffects&&(t.player.statusEffects=[]),Object.values(t.skills).forEach(e=>{e.currentCooldown=0}),t.combat=void 0,this.eventBus.emit('combat:end',{result:e,settlement:n,enemies:s}),this.emitStateUpdate()}applyPendingPermanentEffects(){if(0===this.pendingPermanentEffects.length)return;const e=this.getState(),t=[];for(const a of this.pendingPermanentEffects){const{source:s,effect:n,victimName:r}=a;let l,o='';if(s.isPlayer)l=e.player.attributes,o=e.player.base.name;else if(s.isAlly){const t=e.allies?.[s.id];t&&(l=t.attributes,o=t.name)}if(l&&n.modifiers)for(const[e,a]of Object.entries(n.modifiers)){if(void 0===a||0===a)continue;const s=e.toUpperCase();if(['STR','DEX','CON','INT','WIS','CHA','SPD'].includes(s)){const n=l[s]||0;l[s]=n+a,t.push(`${o}:${e}+${a}(来自${r})`),this.log(`  ⭐ ${o} 永久获得 ${s} +${a}（吞噬自 ${r}）`)}}}t.length>0&&this.log(`🌟 战斗永久加成：${t.join(', ')}`),this.pendingPermanentEffects=[],this.saveService.saveData()}getBattleStats(){return{...this.battleStats}}getPlayer(){const e=this.getState(),t=e.player;t.statusEffects||(t.statusEffects=[]),t.shields||(t.shields=[]),t.statModifiers||(t.statModifiers={}),(!t.attributes.SPD||t.attributes.SPD<5)&&(t.attributes.SPD=10,console.log('[Battle] 玩家SPD属性缺失或过低，已设置为默认值10'));const a=Ro(t.equipment),s={...t.statModifiers};a.hp_max&&(s.hp_max=(s.hp_max||0)+a.hp_max),a.mp_max&&(s.mp_max=(s.mp_max||0)+a.mp_max),a.sp_max&&(s.sp_max=(s.sp_max||0)+a.sp_max),a.str&&(s.str=(s.str||0)+a.str),a.dex&&(s.dex=(s.dex||0)+a.dex),a.con&&(s.con=(s.con||0)+a.con),a.int&&(s.int=(s.int||0)+a.int),a.wis&&(s.wis=(s.wis||0)+a.wis),a.cha&&(s.cha=(s.cha||0)+a.cha),a.spd&&(s.spd=(s.spd||0)+a.spd),a.ac&&(s.ac=(s.ac||0)+a.ac),a.crit_rate&&(s.crit_rate=(s.crit_rate||0)+a.crit_rate),a.crit_dmg&&(s.crit_dmg=(s.crit_dmg||0)+a.crit_dmg);return{id:'player',name:t.base.name,isPlayer:!0,avatar:t.base.avatar,base:t.base,level:t.base.level,stats:t.stats,attributes:t.attributes,skills:e.skills,statusEffects:t.statusEffects,shields:t.shields,statModifiers:s,nextAction:void 0,hasActed:!1,isDead:t.stats.hp.current<=0,isStunned:t.statusEffects?.some(e=>e.tags?.includes('stun'))||!1,isSilenced:t.statusEffects?.some(e=>e.tags?.includes('silence'))||!1,counterEffects:[],counterTriggersThisTurn:0}}getAllCombatants(){const e=this.getState();if(!e.combat)return[];const t=e.combat,a=[this.getPlayer()];return a.push(...t.enemies),t.summons&&a.push(...t.summons),a}getCombatantById(e){if('player'===e)return this.getPlayer();if(this.combatantCache.has(e))return this.combatantCache.get(e);const t=this.getBattleState();if(!t)return;let a=t.enemies.find(t=>t.id===e);return!a&&t.allies&&(a=t.allies.find(t=>t.id===e)),!a&&t.summons&&(a=t.summons.find(t=>t.id===e)),a}getEnemiesOf(e){const t=this.getBattleState();if(!t)return[];if(this.isPlayerSide(e)){const e=[...t.enemies.filter(e=>!e.isDead)];return t.summons&&e.push(...t.summons.filter(e=>!this.isPlayerSide(e)&&!e.isDead)),e}const a=[],s=this.getPlayer();return s.isDead||a.push(s),t.allies&&a.push(...t.allies.filter(e=>!e.isDead)),t.summons&&a.push(...t.summons.filter(e=>this.isPlayerSide(e)&&!e.isDead)),a}getAlliesOf(e){const t=this.getBattleState();if(!t)return[];if(this.isPlayerSide(e)){const e=[this.getPlayer()];return t.allies&&e.push(...t.allies.filter(e=>!e.isDead)),t.summons&&e.push(...t.summons.filter(e=>this.isPlayerSide(e)&&!e.isDead)),e}const a=[...t.enemies.filter(e=>!e.isDead)];return t.summons&&a.push(...t.summons.filter(e=>!this.isPlayerSide(e)&&!e.isDead)),a}getWeaponDamages(e){const t=[],a=e.equipment?.weapon_main;a&&'weapon'===a.type&&t.push({slot:'weapon_main',name:a.name,damage:this.formatWeaponDamage(a.baseDamage)});const s=e.equipment?.weapon_off;return s&&'weapon'===s.type&&'shield'!==s.subtype&&t.push({slot:'weapon_off',name:s.name,damage:this.formatWeaponDamage(s.baseDamage)}),t}formatWeaponDamage(e){if(null!=e)return'number'==typeof e?e>=0?`1d6+${e}`:`1d6${e}`:e}isPlayerSide(e){if(e.isPlayer||e.isAlly)return!0;if(e.isSummon&&e.summonerId){if('player'===e.summonerId)return!0;const t=this.getBattleState();return!(!t?.allies||!t.allies.some(t=>t.id===e.summonerId))}return!1}log(e){const t=this.getState();t.combat&&(t.combat.logs=[...t.combat.logs,e]),console.log(`[Battle] ${e}`)}syncTimelineState(){const e=this.getState();e.combat&&(e.combat.timeline=this.timeline.exportState())}emitStateUpdate(){this.eventBus.emit('combat:state_update',{combat:this.getState().combat,player:this.getState().player,timeline:this.timeline.exportState(),actionPreview:this.getActionPreview()})}formatCurrency(e){const t=Math.floor(e/1e4),a=Math.floor(e%1e4/100),s=e%100,n=[];return t>0&&n.push(`${t}金`),a>0&&n.push(`${a}银`),(s>0||0===n.length)&&n.push(`${s}铜`),n.join(' ')}}class Uo extends Bl{saveService;inventoryService;promptInjector;config={...xo};constructor(){super('BattleSettlementService')}async init(){this.saveService=Ll.serviceLocator.get('SaveService'),this.inventoryService=Ll.serviceLocator.get('InventoryService');try{this.promptInjector=Ll.serviceLocator.get('PromptInjector')}catch{console.warn('[BattleSettlementService] PromptInjector not available')}console.log('[BattleSettlementService] Initialized')}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}settle(e,t){const a=this.saveService.getGameState();if(!a)throw new Error('No game state available');const s=e.filter(e=>e.isDead),n=this.calculateExp(s),r=this.calculateGold(s);this.applyExp(a,n),this.applyGold(a,r);const l=this.processLevelUp(a),o=this.generateLootContext(s);this.saveService.saveData('Battle Settlement');const i={exp:n,gold:r,...l,lootContext:o,statistics:t||{totalDamageDealt:0,totalDamageTaken:0,totalHealing:0,turnCount:0,killCount:0,criticalHits:0}};return this.eventBus.emit('settlement:complete',{result:i}),console.log(`[BattleSettlementService] Settlement complete: +${n} EXP, +${r} Gold`,l),i}calculateExp(e){const t=this.saveService.getGameState(),a=t?.player.base.level||1;return e.reduce((e,t)=>{const s=t.level||1,n=oo.calculateExpReward({...t,level:s},a),r=this.config.expPerLevel/10,l=t.isBoss?this.config.bossExpMultiplier:1;return e+Math.floor(n*r*l)},0)}applyExp(e,t){e.player.base.exp||(e.player.base.exp={current:0,max:this.config.levelConfig.expCurve(e.player.base.level)}),'object'==typeof e.player.base.exp?e.player.base.exp.current+=t:e.player.base.exp={current:t,max:this.config.levelConfig.expCurve(e.player.base.level)}}calculateGold(e){return e.reduce((e,t)=>{const a=t.level||1,s=a*this.config.goldPerLevel.base,n=Math.floor(Math.random()*a*this.config.goldPerLevel.randomBonus),r=t.isBoss?this.config.bossGoldMultiplier:1;return e+Math.floor((s+n)*r)},0)}applyGold(e,t){e.inventory.wallet||(e.inventory.wallet={ledger:0,rates:[]}),e.inventory.wallet.ledger+=t}processLevelUp(e){const t=e.player,a=t.base.level;let s=0;let n='object'==typeof t.base.exp?t.base.exp.current:t.base.exp||0,r=0;for(;;){const e=this.config.levelConfig.expCurve(t.base.level);if(!(n>=e))break;n-=e,t.base.level+=1,r+=1;s+=this.config.levelConfig.attributePointsPerLevel,t.stats.hp.max+=this.config.levelConfig.statGrowth.hp,t.stats.mp.max+=this.config.levelConfig.statGrowth.mp,t.stats.sp&&(t.stats.sp.max+=this.config.levelConfig.statGrowth.sp),console.log(`[BattleSettlementService] Level up! ${t.base.level-1} → ${t.base.level}`)}return'object'==typeof t.base.exp&&(t.base.exp.current=n,t.base.exp.max=this.config.levelConfig.expCurve(t.base.level)),s>0&&(t.base.points=(t.base.points||0)+s),r>0&&this.config.levelConfig.fullRestoreOnLevelUp&&(t.stats.hp.current=t.stats.hp.max,t.stats.mp.current=t.stats.mp.max,t.stats.sp&&(t.stats.sp.current=t.stats.sp.max),this.eventBus.emit('player:level_up',{previousLevel:a,newLevel:t.base.level,pointsGained:s})),r>0?{levelUp:!0,previousLevel:a,newLevel:t.base.level,attributePointsGained:s}:{levelUp:!1}}generateLootContext(e){if(0===e.length)return null;const t=e.map(e=>e.name),a=e.map(e=>e.level||1),s=e.some(e=>e.isBoss),n=e.map(e=>({name:e.name,level:e.level||1,loot:e.loot}));if(!n.some(e=>e.loot&&e.loot.length>0))return null;const r=this.generateLocationHint(e),l=[];if(s){const t=e.find(e=>e.isBoss)?.name||'Boss';l.push(`${t} 可能掉落稀有装备或特殊物品`)}const o=this.buildAIContext(e);return{enabled:!0,enemyNames:t,enemyLevels:a,locationHint:r,specialDropHints:l.length>0?l:void 0,contextForAI:o,deadEnemies:n}}generateLocationHint(e){const t=e.length;if(e.some(e=>e.isBoss)){const t=e.find(e=>e.isBoss)?.name;return`${t} 倒下了，他身上似乎有些值得一看的东西...`}return 1===t?`${e[0].name} 的尸体上可能有些值钱的东西。`:`战场上散落着 ${t} 具尸体，可以搜刮一番。`}buildAIContext(e){const t=['[搜刮信息]',`倒下的敌人: ${e.map(e=>`${e.name}(Lv.${e.level||1})`).join(', ')}`,'','玩家正在搜刮尸体，请描述搜刮过程和发现的物品。','','物品生成规则:','- 物品应符合敌人身份和战斗场景','- 普通敌人: 少量金币、杂物、低级消耗品','- 精英敌人: 可能有装备、中级物品','- Boss: 稀有装备、特殊物品、剧情道具','','请在回复中详细描述:','1. 搜刮的过程和发现','2. 具体获得的物品（名称、数量、简短描述）'];return e.forEach(e=>{e.description&&t.push(`  - ${e.name}: ${e.description}`)}),t.join('\n')}async requestLoot(e){if(!this.promptInjector)return void console.warn('[BattleSettlementService] PromptInjector not available, cannot inject loot context');const t=e.contextForAI;await this.promptInjector.quickInject(t,['玩家开始搜刮战场']),this.eventBus.emit('loot:request',{context:e})}getExpToNextLevel(e){const t=this.saveService.getGameState(),a=e??t?.player.base.level??1;return this.config.levelConfig.expCurve(a)}getExpProgress(){const e=this.saveService.getGameState();if(!e)return 0;const t=e.player.base.exp,a='object'==typeof t?t.current:t||0,s=this.getExpToNextLevel(e.player.base.level);return Math.min(100,a/s*100)}}var Vo;!function(e){e.CHAT='chat',e.GIFT='gift',e.INVITE='invite',e.FLIRT='flirt',e.SPAR='spar',e.MOVE='move',e.TRAVEL='travel',e.INTERACT='interact',e.CUSTOM='custom'}(Vo||(Vo={}));const Fo={[Vo.CHAT]:{icon:'💬',name:'交谈',requiresMessage:!0,promptTemplate:'【{{playerName}}】对【{{targetName}}】说："{{message}}"'},[Vo.GIFT]:{icon:'🎁',name:'送礼',requiresMessage:!1,promptTemplate:'【{{playerName}}】试图送给【{{targetName}}】「{{itemName}}」×{{quantity}}（{{quality}}，价值{{totalValue}}铜币）',requiresHiddenContext:!0},[Vo.INVITE]:{icon:'🤝',name:'邀请入队',requiresMessage:!1,promptTemplate:'【{{playerName}}】邀请【{{targetName}}】加入队伍'},[Vo.FLIRT]:{icon:'💕',name:'调情',requiresMessage:!0,promptTemplate:'【{{playerName}}】对【{{targetName}}】调情："{{message}}"'},[Vo.SPAR]:{icon:'🤺',name:'切磋',requiresMessage:!1,promptTemplate:'【{{playerName}}】邀请【{{targetName}}】切磋比武'},[Vo.MOVE]:{icon:'🚶',name:'移动',requiresMessage:!1,promptTemplate:'[前往: {{targetName}}]'},[Vo.TRAVEL]:{icon:'🚪',name:'前往',requiresMessage:!1,promptTemplate:'[前往: {{targetName}}{{direction}}]',requiresHiddenContext:!0},[Vo.INTERACT]:{icon:'👆',name:'交互',requiresMessage:!1,promptTemplate:'[查看: {{targetName}}]',requiresHiddenContext:!0},[Vo.CUSTOM]:{icon:'📝',name:'自定义',requiresMessage:!0,promptTemplate:'{{message}}'}},Ho=xt({commands:[],playerName:'玩家'}),Go=ir(()=>Ho.commands.length),zo=ir(()=>Ho.commands.length>0),Wo=ir(()=>[...Ho.commands]);class Qo{state=Ho;constructor(){}setPlayerName(e){this.state.playerName=e}addCommand(e){const t=`cmd_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={...e,id:t,createdAt:Date.now()};return this.state.commands.push(a),console.log('[CommandQueueService] 添加指令:',a),t}removeCommand(e){const t=this.state.commands.findIndex(t=>t.id===e);if(t>=0){const e=this.state.commands.splice(t,1)[0];return console.log('[CommandQueueService] 撤销指令:',e),!0}return!1}clearAll(){this.state.commands=[],console.log('[CommandQueueService] 清空所有指令')}getCommands(){return[...this.state.commands]}getCount(){return this.state.commands.length}generatePromptPrefix(){if(0===this.state.commands.length)return'';const e=[];for(const t of this.state.commands){const a=Fo[t.type];let s=t.promptTemplate||a.promptTemplate;if(s=s.replace(/\{\{playerName\}\}/g,this.state.playerName).replace(/\{\{targetName\}\}/g,t.targetName).replace(/\{\{message\}\}/g,t.message||''),t.type===Vo.TRAVEL&&t.exitInfo){const e=t.exitInfo.direction?` (${t.exitInfo.direction})`:'';s=s.replace(/\{\{direction\}\}/g,e)}else s=s.replace(/\{\{direction\}\}/g,'');t.type===Vo.GIFT&&t.giftInfo&&(s=s.replace(/\{\{itemName\}\}/g,t.giftInfo.itemName).replace(/\{\{quantity\}\}/g,String(t.giftInfo.quantity)).replace(/\{\{quality\}\}/g,this.translateQuality(t.giftInfo.quality)).replace(/\{\{totalValue\}\}/g,String(t.giftInfo.totalValue))),e.push(s)}return this.state.commands=[],e.join('\n')}generateHiddenContext(){const e=[];for(const t of this.state.commands){if(Fo[t.type].requiresHiddenContext)if(t.type===Vo.TRAVEL&&t.exitInfo){const a=this.buildExitHiddenContext(t.exitInfo);a&&e.push(a)}else if(t.type===Vo.INTERACT&&t.objectInfo){const a=this.buildObjectHiddenContext(t.objectInfo);a&&e.push(a)}else if(t.type===Vo.GIFT&&t.giftInfo){const a=this.buildGiftHiddenContext(t.giftInfo);a&&e.push(a)}}return 0===e.length?'':`[场景上下文]\n${e.join('\n')}`}buildExitHiddenContext(e){const t=[`出口「${e.name}」`];return e.direction&&t.push(`方向: ${e.direction}`),e.locked?(t.push('状态: 🔒已锁定'),e.condition&&t.push(`解锁条件: ${e.condition}`)):t.push('状态: 可通行'),t.join(' | ')}buildObjectHiddenContext(e){const t=[`物品「${e.name}」`];return e.brief&&t.push(`描述: ${e.brief}`),!1===e.interactable&&t.push('注意: 该物品仅可观察，不可交互'),t.join(' | ')}buildGiftHiddenContext(e){const t=[`[礼物信息] 物品「${e.itemName}」`];return t.push(`品质: ${this.translateQuality(e.quality)}`),t.push(`数量: ${e.quantity}`),t.push(`单价: ${e.unitValue}铜币`),t.push(`总价: ${e.totalValue}铜币`),e.inventoryCount===e.quantity?t.push(`玩家持有: ${e.inventoryCount}（全部）`):t.push(`玩家持有: ${e.inventoryCount}`),e.desc&&t.push(`描述: ${e.desc}`),t.join(' | ')}translateQuality(e){return{Common:'普通',Uncommon:'优良',Rare:'稀有',Epic:'史诗',Legendary:'传说'}[e]||e}addTravelCommand(e){return this.addCommand({type:Vo.TRAVEL,targetName:e.name,isSceneNpc:!1,exitInfo:e})}addInteractCommand(e){return this.addCommand({type:Vo.INTERACT,targetName:e.name,isSceneNpc:!1,objectInfo:e})}addGiftCommand(e,t,a,s){return this.addCommand({type:Vo.GIFT,targetName:e,targetId:t,isSceneNpc:a,giftInfo:s})}getReservedGiftCount(e){return this.state.commands.filter(t=>t.type===Vo.GIFT&&t.giftInfo?.itemId===e).reduce((e,t)=>e+(t.giftInfo?.quantity||0),0)}static getCommandMeta(e){return Fo[e]}getDisplayText(e){const t=Fo[e.type];if(e.type===Vo.TRAVEL&&e.exitInfo){const a=e.exitInfo.locked?' 🔒':'',s=e.exitInfo.direction?` (${e.exitInfo.direction})`:'';return`${t.icon} ${t.name}: ${e.targetName}${s}${a}`}return e.type===Vo.INTERACT&&e.objectInfo?.brief?`${t.icon} ${t.name}: ${e.targetName} - ${e.objectInfo.brief.substring(0,20)}${e.objectInfo.brief.length>20?'...':''}`:e.type===Vo.GIFT&&e.giftInfo?`${t.icon} ${t.name}: ${e.targetName} - 「${e.giftInfo.itemName}」×${e.giftInfo.quantity}`:e.message?`${t.icon} ${t.name}: ${e.targetName} - "${e.message.substring(0,20)}${e.message.length>20?'...':''}"`:`${t.icon} ${t.name}: ${e.targetName}`}}const Xo=()=>({commands:Wo,count:Go,hasCommands:zo});class Yo extends Bl{shieldService;constructor(){super('DamageService')}async init(){this.shieldService=Ll.serviceLocator.get('ShieldService')}resolveDamage(e,t,a,s){const n=oo.checkHit(e,t,s);return this.resolveDamageWithHitResult(e,t,a,s,n)}resolveDamageWithHitResult(e,t,a,s,n){if(!n.isHit)return this.eventBus.emit('combat:miss',{source:e,target:t,skill:s}),n.isDodge&&this.checkAndTriggerCounter(t,e,'on_dodge'),{hit:n,damage:this.createEmptyDamageResult(),actualDamage:0,overkill:0,targetDied:!1};const r=oo.calculateDamage(e,t,a,n),{actualDamage:l,overkill:o,shieldAbsorb:i,targetDied:c}=this.applyDamageToTarget(t,r.total,r.damageType);r.breakdown.shieldAbsorbed=i?.absorbedDamage||0,this.eventBus.emit('combat:damage',{source:e,target:t,damage:r,actualDamage:l,shieldAbsorb:i});const d=this.processLifesteal(e,t,l,s);return c||this.checkAndTriggerCounter(t,e,'on_hurt'),c&&this.eventBus.emit('combat:kill',{source:e,target:t,damage:r}),{hit:n,damage:r,shieldAbsorb:i,actualDamage:l,overkill:o,targetDied:c,lifesteal:d.length>0?d:void 0}}resolveMultiHitDamage(e,t,a,s){const n=a.hitCount??1,r=a.hitDamageRatio??[1],l={hits:[],totalDamage:0,totalShieldAbsorbed:0,hitsLanded:0,critCount:0,targetDied:!1};for(let o=0;o<n;o++){if(t.isDead){l.targetDied=!0,l.deathOnHit=l.deathOnHit??o;break}const n=oo.checkHit(e,t,a),i=r[o]??r[r.length-1]??1;if(n.isHit){const a=oo.calculateDamage(e,t,s,n),r=Math.floor(a.total*i),{actualDamage:c,overkill:d,shieldAbsorb:u,targetDied:p}=this.applyDamageToTarget(t,r,a.damageType),m={...a,total:r,rawDamage:Math.floor(a.rawDamage*i),breakdown:{...a.breakdown,shieldAbsorbed:u?.absorbedDamage||0}};l.hits.push({hit:n,damage:m,shieldAbsorb:u,actualDamage:c,overkill:d,targetDied:p}),l.totalDamage+=c,l.totalShieldAbsorbed+=u?.absorbedDamage||0,l.hitsLanded++,n.isCrit&&l.critCount++,p&&(l.targetDied=!0,l.deathOnHit=o+1)}else l.hits.push({hit:n,damage:this.createEmptyDamageResult(),actualDamage:0,overkill:0,targetDied:!1})}return this.eventBus.emit('combat:multi_hit_complete',{source:e,target:t,skill:a,result:l}),l}applyDamageToTarget(e,t,a){if(t<=0)return{actualDamage:0,overkill:0,targetDied:!1};let s,n=t;e.shields&&e.shields.length>0&&(s=this.shieldService.absorbDamage(e,t,a),n=s.remainingDamage);const r=e.stats.hp.current;e.stats.hp.current=Math.max(0,e.stats.hp.current-n);const l=r-e.stats.hp.current;let o=!1;e.stats.hp.current<=0&&(e.isDead=!0,o=!0);return{actualDamage:l,overkill:Math.max(0,n-r),shieldAbsorb:s,targetDied:o}}checkAndTriggerCounter(e,t,a){if(!e.counterEffects||0===e.counterEffects.length)return;const s=e.counterTriggersThisTurn??0;for(const n of e.counterEffects)if(n.triggerOn===a&&!(-1!==n.maxTriggersPerTurn&&s>=n.maxTriggersPerTurn||100*Math.random()>n.chance)){e.counterTriggersThisTurn=s+1,this.eventBus.emit('combat:counter',{defender:e,attacker:t,counterEffect:n,triggerType:a});break}}createEmptyDamageResult(){return{total:0,rawDamage:0,isCrit:!1,isGlance:!1,breakdown:{base:0,scaling:0,variance:0,mitigation:0,resistance:0,shieldAbsorbed:0}}}applyDirectDamage(e,t,a,s){const{actualDamage:n,targetDied:r,shieldAbsorb:l}=this.applyDamageToTarget(e,t,a);return this.eventBus.emit('combat:direct_damage',{source:s,target:e,amount:t,actualDamage:n,damageType:a,shieldAbsorb:l}),r&&this.eventBus.emit('combat:death',{target:e,source:s}),{actualDamage:n,targetDied:r}}getEffectiveMax(e,t){const a=`${t}_max`;return(e.stats[t]?.max||0)+(e.statModifiers?.[a]||0)}applyHealing(e,t,a){if(e.isDead)return{actualHeal:0,overheal:t};const s=e.stats.hp.current,n=this.getEffectiveMax(e,'hp');e.stats.hp.current=Math.min(n,e.stats.hp.current+t);const r=e.stats.hp.current-s,l=t-r;return this.eventBus.emit('combat:heal',{source:a,target:e,amount:t,actualHeal:r,overheal:l}),{actualHeal:r,overheal:l}}reviveTarget(e,t=20){if(!e.isDead)return!1;e.isDead=!1;const a=this.getEffectiveMax(e,'hp');return e.stats.hp.current=Math.floor(a*(t/100)),this.eventBus.emit('combat:revive',{target:e,hpPercent:t}),!0}processLifesteal(e,t,a,s){const n=[];if(a<=0||e.isDead)return n;const r=Fl.getLifestealPercent(e);if(r>0){const s=Math.floor(a*(r/100));if(s>0){const{actualHeal:l}=this.applyHealing(e,s,e);l>0&&(n.push({amount:l,source:'modifier',sourceName:'吸血'}),this.eventBus.emit('combat:lifesteal',{source:e,target:t,damage:a,healAmount:l,percent:r}))}}if(s&&s.effects)for(const r of s.effects)if(r.lifesteal&&r.lifesteal>0){if(void 0!==r.chance&&r.chance<100){if(100*Math.random()>r.chance)continue}const l=Math.floor(a*(r.lifesteal/100));if(l>0){const{actualHeal:o}=this.applyHealing(e,l,e);o>0&&(n.push({amount:o,source:'on_damage_effect',sourceName:s.name}),this.eventBus.emit('combat:lifesteal',{source:e,target:t,damage:a,healAmount:o,percent:r.lifesteal}))}}const l=Fl.getEffectsByTrigger(e,'on_damage');s&&'active'===s.type&&s.effects&&s.effects.forEach(e=>{'on_damage'===e.trigger&&l.push({effect:e,source:s.name,sourceType:'skill'})});for(const{effect:s,source:r}of l){if(void 0!==s.chance&&s.chance<100){if(100*Math.random()>s.chance)continue}if('heal'===s.action){let l=0;if(void 0!==s.value){const n=String(s.value);if(n.includes('damage')){const e=n.match(/^([\d.]+)\s*\*\s*damage$/i);if(e){const t=parseFloat(e[1]);l=Math.floor(a*t)}}else l=lo.DiceRoller.evaluate(s.value,e,t)}if(l>0){let o=e;'target'===s.target?o=t:'self'===s.target&&(o=e);const{actualHeal:i}=this.applyHealing(o,l,e);i>0&&(n.push({amount:i,source:'on_damage_effect',sourceName:r}),this.eventBus.emit('combat:on_damage_heal',{source:e,target:o,damage:a,healAmount:i,effectSource:r}))}}}return n}}const Ko='https://testingcf.jsdelivr.net/gh/Platium-T/alg@main/png图标',Jo=`${Ko}/材料.webp`,Zo=`${Ko}/武器.webp`,ei=`${Ko}/综合物品.webp`,ti=`${Ko}/防具.webp`,ai=`${Ko}/饰品.webp`,si={rows:{sword:0,broadsword:1,dagger:2,shield:3,staff:4,hammer:5,bow:6,gun:7,axe:8,gauntlet:9,dual_blades:10,whip:11,katana:12,spear:13,grimoire:14,horn:15},cols:{rusty:0,basic:1,steel:2,standard:3,fire:4,ice:5,lightning:6,poison:7,void:8,dark:9,light:10,twisted:11,divine:12,earth:13,wind:14,crystal:15},defaultCol:3},ni={rows:{hat:0,helmet:1,cloak:2,glove:3,top_male:4,top_female:5,lingerie_top:6,underpants_male:7,underpants_female:8,sock_short:9,sock_long:10,shoe_light:11,boot_heavy:12,pant_long:13,pant_short:14,coat:15},rowOffsets:{helmet:1,cloak:2,glove:3,top_male:2,top_female:6,lingerie_top:3,shoe_light:-1.5,boot_heavy:-5,pant_long:-3.5,pant_short:-8,coat:-7},cols:{common:0,linen:1,wool:2,tattered:3,leather:4,adventurer:5,padded:6,denim:7,silk:8,noble:9,lace:10,gold_trim:11,plate:12,mythical:13,rune:14,dragon:15},defaultCol:5},ri={rows:{ring:0,necklace:1,earring:2,bracelet:3,headband:4,belt:5,choker:6,body_chain:7,collar_slave:8,handcuffs:9,blindfold:10,gag:11,shibari:12,whip:13,dildo:14,anal_plug:15},rowOffsets:{ring:1,necklace:2,earring:1.5,bracelet:1,headband:2},cols:si.cols,defaultCol:3},li={ore:0,ingot:1,gem:2,crystal:3,herb:4,mushroom:5,flower:6,potion:7,monster_bone:8,monster_organ:9,leather:10,fabric:11,wood:12,paper:13,powder:14,rune:15},oi={food_meat:0,food_fruit:1,food_bread:2,food_meal:3,drink:4,key:5,chest:6,bag:7,tool:8,camping:9,book:10,letter:11,currency:12,card:13,light:14,artifact_curse:15};class ii extends Bl{static CELL_SIZE=64;static GRID_SIZE=16;static SHEET_SIZE=1024;loadedSheets=new Set;constructor(){super('IconService')}init(){console.log('[IconService] Initialized'),this.preloadSheets()}preloadSheets(){[Zo,ti,ai,Jo,ei].forEach(e=>{if(!this.loadedSheets.has(e)){const t=new Image;t.src=e,t.onload=()=>this.loadedSheets.add(e)}})}getIconStyle(e,t,a,s,n=64){const r=this.getIconPosition(e,t,a,s),l=ii.CELL_SIZE,o=n/l;let i=0;'armor'===e&&t&&ni.rowOffsets?.[t]?i=ni.rowOffsets[t]:'accessory'===e&&t&&ri.rowOffsets?.[t]&&(i=ri.rowOffsets[t]);const c=r.col*l,d=r.row*l+i,u=l-n,p={backgroundImage:`url('${r.sheet}')`,backgroundPosition:`-${c}px -${d}px`,backgroundSize:`${ii.SHEET_SIZE}px ${ii.SHEET_SIZE}px`,width:`${l}px`,height:`${l}px`,transform:1!==o?`scale(${o})`:'none',transformOrigin:'top left'};return 1!==o&&(p.marginRight=`-${u}px`,p.marginBottom=`-${u}px`),p}getIconPosition(e,t,a,s){let n,r=0,l=0,o=!0;switch(e){case'weapon':n=Zo,t&&void 0!==si.rows[t]?r=si.rows[t]:t?o=!1:r=0,l=a?si.cols[a]??si.defaultCol:si.defaultCol;break;case'armor':n=ti,t&&void 0!==ni.rows[t]?r=ni.rows[t]:t?o=!1:r=15,l=a?ni.cols[a]??ni.defaultCol:ni.defaultCol;break;case'accessory':n=ai,t&&void 0!==ri.rows[t]?r=ri.rows[t]:t?o=!1:r=0,l=a?ri.cols[a]??ri.defaultCol:ri.defaultCol;break;case'material':n=Jo,t&&void 0!==li[t]?r=li[t]:t?o=!1:r=0,l=s??Math.floor(16*Math.random());break;default:n=ei,t&&void 0!==oi[t]?r=oi[t]:t?o=!1:r=8,l=s??Math.floor(16*Math.random())}return o||(console.warn(`[IconService] Unknown subtype "${t}" for category "${e}", using fallback icon`),n=ei,r=1,l=s??Math.floor(13*Math.random())),{sheet:n,row:r,col:l}}ensureIconVariant(e){return void 0===e.iconVariant&&(e.iconVariant=Math.floor(16*Math.random())),e.iconVariant}getSheetUrl(e){switch(e){case'weapon':return Zo;case'armor':return ti;case'accessory':return ai;case'material':return Jo;default:return ei}}mapTypeToCategoryAndSubtype(e){return void 0!==si.rows[e]?{category:'weapon',subtype:e}:void 0!==ni.rows[e]?{category:'armor',subtype:e}:void 0!==ri.rows[e]?{category:'accessory',subtype:e}:void 0!==li[e]?{category:'material',subtype:e}:void 0!==oi[e]?{category:'item',subtype:e}:e.includes('剑')?{category:'weapon',subtype:'sword'}:e.includes('刀')||e.includes('大剑')?{category:'weapon',subtype:'broadsword'}:e.includes('匕首')?{category:'weapon',subtype:'dagger'}:e.includes('盾')?{category:'weapon',subtype:'shield'}:e.includes('杖')||e.includes('法杖')?{category:'weapon',subtype:'staff'}:e.includes('锤')?{category:'weapon',subtype:'hammer'}:e.includes('弓')?{category:'weapon',subtype:'bow'}:e.includes('枪')&&!e.includes('长枪')?{category:'weapon',subtype:'gun'}:e.includes('斧')?{category:'weapon',subtype:'axe'}:e.includes('拳套')?{category:'weapon',subtype:'gauntlet'}:e.includes('双刃')?{category:'weapon',subtype:'dual_blades'}:e.includes('鞭')?{category:'weapon',subtype:'whip'}:e.includes('太刀')||e.includes('武士刀')?{category:'weapon',subtype:'katana'}:e.includes('长枪')||e.includes('矛')?{category:'weapon',subtype:'spear'}:e.includes('魔导书')?{category:'weapon',subtype:'grimoire'}:e.includes('号角')?{category:'weapon',subtype:'horn'}:'weapon'===e||'武器'===e?{category:'weapon'}:e.includes('帽')?{category:'armor',subtype:'hat'}:e.includes('头盔')?{category:'armor',subtype:'helmet'}:e.includes('斗篷')||e.includes('披风')?{category:'armor',subtype:'cloak'}:e.includes('手套')?{category:'armor',subtype:'glove'}:e.includes('上衣')||e.includes('衣服')?{category:'armor',subtype:'coat'}:e.includes('内裤')||e.includes('内衣')?{category:'armor',subtype:'underpants_female'}:e.includes('靴')?{category:'armor',subtype:'boot_heavy'}:e.includes('鞋')?{category:'armor',subtype:'shoe_light'}:e.includes('长裤')?{category:'armor',subtype:'pant_long'}:e.includes('短裤')?{category:'armor',subtype:'pant_short'}:e.includes('裤')?{category:'armor',subtype:'pant_long'}:e.includes('袜')?{category:'armor',subtype:'sock_long'}:'armor'===e||'防具'===e?{category:'armor'}:e.includes('戒指')?{category:'accessory',subtype:'ring'}:e.includes('项链')?{category:'accessory',subtype:'necklace'}:e.includes('耳环')?{category:'accessory',subtype:'earring'}:e.includes('手镯')?{category:'accessory',subtype:'bracelet'}:e.includes('腰带')?{category:'accessory',subtype:'belt'}:'accessory'===e||'饰品'===e?{category:'accessory'}:e.includes('矿')||e.includes('石')?{category:'material',subtype:'ore'}:e.includes('锭')?{category:'material',subtype:'ingot'}:e.includes('宝石')?{category:'material',subtype:'gem'}:e.includes('水晶')?{category:'material',subtype:'crystal'}:e.includes('草')||e.includes('药草')?{category:'material',subtype:'herb'}:e.includes('蘑菇')?{category:'material',subtype:'mushroom'}:e.includes('花')?{category:'material',subtype:'flower'}:e.includes('药水')||e.includes('药剂')?{category:'material',subtype:'potion'}:e.includes('骨')?{category:'material',subtype:'monster_bone'}:e.includes('皮')||e.includes('皮革')?{category:'material',subtype:'leather'}:e.includes('布')?{category:'material',subtype:'fabric'}:e.includes('木')?{category:'material',subtype:'wood'}:'material'===e||'材料'===e?{category:'material'}:e.includes('肉')?{category:'item',subtype:'food_meat'}:e.includes('水果')||e.includes('蔬菜')?{category:'item',subtype:'food_fruit'}:e.includes('面包')||e.includes('奶酪')?{category:'item',subtype:'food_bread'}:e.includes('菜肴')||e.includes('料理')?{category:'item',subtype:'food_meal'}:e.includes('饮料')||e.includes('酒')?{category:'item',subtype:'drink'}:e.includes('钥匙')?{category:'item',subtype:'key'}:e.includes('宝箱')?{category:'item',subtype:'chest'}:e.includes('背包')||e.includes('袋')?{category:'item',subtype:'bag'}:e.includes('工具')?{category:'item',subtype:'tool'}:e.includes('帐篷')||e.includes('露营')?{category:'item',subtype:'camping'}:e.includes('书')?{category:'item',subtype:'book'}:e.includes('信')||e.includes('卷轴')?{category:'item',subtype:'letter'}:e.includes('金币')||e.includes('货币')?{category:'item',subtype:'currency'}:e.includes('卡')||e.includes('筹码')?{category:'item',subtype:'card'}:e.includes('灯')||e.includes('蜡烛')?{category:'item',subtype:'light'}:'consumable'===e||'消耗品'===e?{category:'item',subtype:'potion'}:'key'===e||'关键物品'===e?{category:'item',subtype:'key'}:{category:'item'}}mapAttributeToEnglish(e){return{生锈:'rusty',基础:'basic',钢铁:'steel',标准:'standard',火:'fire',火焰:'fire',冰:'ice',冰霜:'ice',雷:'lightning',雷电:'lightning',毒:'poison',虚空:'void',暗:'dark',黑暗:'dark',光:'light',神圣:'divine',扭曲:'twisted',土:'earth',大地:'earth',风:'wind',水晶:'crystal',普通:'common',亚麻:'linen',羊毛:'wool',破旧:'tattered',皮革:'leather',冒险者:'adventurer',软垫:'padded',牛仔:'denim',丝绸:'silk',贵族:'noble',蕾丝:'lace',镀金:'gold_trim',板甲:'plate',神话:'mythical',符文:'rune',龙鳞:'dragon'}[e]}}class ci{eventBus;isGenerating=!1;constructor(){this.eventBus=Ll.serviceLocator.get('EventBus')}async isAvailable(){try{return'undefined'==typeof SillyTavern?(console.warn('[ImageGenService] SillyTavern not available'),!1):'function'==typeof SillyTavern.executeSlashCommandsWithOptions||(console.warn('[ImageGenService] executeSlashCommandsWithOptions not available'),!1)}catch(e){return console.error('[ImageGenService] Error checking availability:',e),!1}}async generate(e){if(this.isGenerating)return{success:!1,error:'正在生成中，请稍候...'};if(!await this.isAvailable())return{success:!1,error:'图像生成功能不可用，请检查 SillyTavern 配置'};this.isGenerating=!0,this.eventBus.emit('imagegen:start',e);try{const t=this.buildCommand(e);console.log('[ImageGenService] Executing command:',t);const a=await SillyTavern.executeSlashCommandsWithOptions(t);if(a.isError)throw new Error(a.errorMessage||'生成失败');if(a.isAborted||a.isQuietlyAborted)return{success:!1,error:'生成被取消'};const s=a.pipe;return s?(this.eventBus.emit('imagegen:complete',{imageUrl:s,config:e}),{success:!0,imageUrl:s}):{success:!1,error:'未获取到生成的图片'}}catch(t){const a=t instanceof Error?t.message:'未知错误';return console.error('[ImageGenService] Generation failed:',t),this.eventBus.emit('imagegen:error',{error:a,config:e}),{success:!1,error:a}}finally{this.isGenerating=!1}}buildCommand(e){const t=['/sd'];if(e.quiet&&t.push('quiet=true'),e.negativePrompt&&t.push(`negative="${e.negativePrompt}"`),e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),'free'===e.mode&&e.prompt){let a=e.prompt;e.includeCharPrefix&&(a=`{{charPrefix}}, ${a}`),t.push(a)}else t.push(e.mode);return t.join(' ')}async generateFacePortrait(e){const t='portrait, face close-up, detailed face, looking at viewer, solo, masterpiece, best quality',a=e?.additionalPrompt?`${t}, ${e.additionalPrompt}`:t;return this.generate({mode:'free',prompt:a,quiet:!0,negativePrompt:e?.negativePrompt,includeCharPrefix:!0})}async generateFullBody(e){const t='full body, standing, solo, masterpiece, best quality, detailed',a=e?.additionalPrompt?`${t}, ${e.additionalPrompt}`:t;return this.generate({mode:'free',prompt:a,quiet:!0,negativePrompt:e?.negativePrompt,includeCharPrefix:!0})}async generateBackground(e){return e?this.generate({mode:'free',prompt:`background, scenery, environment, ${e}`,quiet:!0}):this.generate({mode:'background',quiet:!0})}async generateCustom(e,t){return this.generate({mode:'free',prompt:e,quiet:t?.quiet??!0,negativePrompt:t?.negativePrompt,width:t?.width,height:t?.height})}static APPEARANCE_TRANSLATIONS={黑发:'black hair',金发:'blonde hair',银发:'silver hair',白发:'white hair',红发:'red hair',蓝发:'blue hair',绿发:'green hair',紫发:'purple hair',粉发:'pink hair',棕发:'brown hair',灰发:'grey hair',橙发:'orange hair',浅蓝发:'light blue hair',深蓝发:'dark blue hair',挑染:'streaked hair',多色发:'multicolored hair',长发:'long hair',短发:'short hair',中长发:'medium hair',马尾:'ponytail',双马尾:'twintails',侧马尾:'side ponytail',高马尾:'high ponytail',低马尾:'low ponytail',卷发:'curly hair',直发:'straight hair',波浪发:'wavy hair',披肩发:'shoulder-length hair',及腰长发:'waist-length hair',盘发:'hair bun',丸子头:'hair bun',双丸子头:'double bun',辫子:'braid',麻花辫:'braid',双麻花辫:'twin braids',刘海:'bangs',齐刘海:'blunt bangs',斜刘海:'side bangs',呆毛:'ahoge',波波头:'bob cut',姬发式:'hime cut',凌乱发:'messy hair',遮眼发:'hair over eyes',蓝眼:'blue eyes',红眼:'red eyes',绿眼:'green eyes',紫眼:'purple eyes',金眼:'golden eyes',棕眼:'brown eyes',黑眼:'black eyes',灰眼:'grey eyes',粉眼:'pink eyes',异色瞳:'heterochromia',竖瞳:'slit pupils',发光眼:'glowing eyes',爱心眼:'heart-shaped pupils',星星眼:'star-shaped pupils',眼影:'eyeshadow',长睫毛:'long eyelashes',垂眼:'tareme',吊眼:'tsurime',白皙:'pale skin',小麦色:'tan',黑皮:'dark skin',褐色皮肤:'brown skin',苍白:'pale skin',苗条:'slender',丰满:'curvy',高挑:'tall',娇小:'petite',肌肉:'muscular',纤细:'slim',胖:'plump',巨乳:'large breasts',贫乳:'flat chest',微乳:'small breasts',爆乳:'huge breasts',腹肌:'abs',尖耳:'pointy ears',兽耳:'animal ears',猫耳:'cat ears',狐耳:'fox ears',兔耳:'rabbit ears',犬耳:'dog ears',狼耳:'wolf ears',翅膀:'wings',恶魔翼:'demon wings',天使翼:'angel wings',尾巴:'tail',猫尾:'cat tail',狐尾:'fox tail',角:'horns',恶魔角:'demon horns',羊角:'sheep horns',獠牙:'fangs',眼镜:'glasses',墨镜:'sunglasses',眼罩:'eyepatch',疤痕:'scar',雀斑:'freckles',痣:'mole',泪痣:'mole under eye',纹身:'tattoo',淫纹:'womb tattoo',绷带:'bandages',微笑:'smile',大笑:'laughing',冷酷:'cold expression',温柔:'gentle expression',严肃:'serious',开朗:'cheerful',脸红:'blush',害羞:'shy',生气:'angry',哭泣:'crying',惊讶:'surprised',闭眼:'closed eyes',张嘴:'open mouth',吐舌:'tongue out',困惑:'confused',无表情:'expressionless',铠甲:'armor',长袍:'robe',斗篷:'cloak',制服:'uniform',礼服:'dress',晚礼服:'evening dress',和服:'kimono',浴衣:'yukata',战斗服:'battle outfit',女仆装:'maid',泳装:'swimsuit',比基尼:'bikini',校服:'school uniform',水手服:'sailor dress',运动服:'sportswear',西装:'suit',衬衫:'shirt',T恤:'t-shirt',毛衣:'sweater',短裙:'skirt',百褶裙:'pleated skirt',迷你裙:'miniskirt',牛仔裤:'jeans',短裤:'shorts',丝袜:'stockings',黑丝:'black pantyhose',白丝:'white pantyhose',过膝袜:'thighhighs',连裤袜:'pantyhose',网袜:'fishnet pantyhose',巫女服:'miko',旗袍:'china dress',护士服:'nurse',兔女郎:'playboy bunny',婚纱:'wedding dress',睡衣:'pajamas',内衣:'lingerie',发带:'hair ribbon',发卡:'hair ornament',耳环:'earrings',项链:'necklace',手套:'gloves',围巾:'scarf',帽子:'hat',贝雷帽:'beret',蝴蝶结:'ribbon',领带:'necktie',铃铛:'bell',锁链:'chain',皇冠:'crown',面具:'mask',人类:'human',精灵:'elf',暗夜精灵:'dark elf',矮人:'dwarf',兽人:'orc',半精灵:'half-elf',龙人:'dragonborn',猫娘:'catgirl',狐娘:'foxgirl',吸血鬼:'vampire',天使:'angel',恶魔:'demon',魔族:'demon',魅魔:'succubus',人马:'centaur',人鱼:'mermaid',史莱姆:'slime',机器人:'robot',仿生人:'android',僵尸:'zombie',幽灵:'ghost',哥布林:'goblin',女神:'goddess',男:'male',男性:'male',女:'female',女性:'female',中性:'androgynous',扶他:'futanari'};translateAppearance(e){if(!e)return'';let t=e;const a=Object.entries(ci.APPEARANCE_TRANSLATIONS).sort((e,t)=>t[0].length-e[0].length);for(const[e,s]of a)t=t.replace(new RegExp(e,'g'),s);return t=t.replace(/[，,、。；：]/g,', ').replace(/\s+/g,' ').replace(/,\s*,/g,',').replace(/^\s*,\s*/,'').replace(/\s*,\s*$/,'').trim(),t}appearanceObjectToString(e){if(!e||'object'!=typeof e)return'';const t=[];for(const a in e){const s=e[a];s&&'string'==typeof s&&s.trim()&&t.push(s.trim())}return t.join(', ')}privateInfoToAppearanceHints(e){if(!e||'object'!=typeof e)return'';const t=['Body_Type','Breast_Size','Breast_Volume','Breast_Shape'],a=[];for(const s of t){const t=e[s];t&&'string'==typeof t&&t.trim()&&a.push(t.trim())}return a.join(', ')}async generateCharacterAvatar(e,t){const a=t?.size??1024,s=[];switch(t?.style??'portrait'){case'face':s.push('face close-up','detailed face','headshot','solo');break;case'bust':s.push('upper body','bust shot','portrait','solo');break;default:s.push('portrait','face','looking at viewer','solo')}if(s.push('masterpiece','best quality','highly detailed','detailed face','beautiful eyes'),e.gender){const t=this.translateAppearance(e.gender);t&&t!==e.gender&&s.push(t)}if(e.race){const t=this.translateAppearance(e.race);s.push(t)}let n='';if(e.appearanceInfo&&'object'==typeof e.appearanceInfo?n=this.appearanceObjectToString(e.appearanceInfo):e.appearance&&(n='object'==typeof e.appearance?this.appearanceObjectToString(e.appearance):e.appearance),n){const e=this.translateAppearance(n);s.push(e)}if(e.privateInfo){const t=this.privateInfoToAppearanceHints(e.privateInfo);if(t){const e=this.translateAppearance(t);s.push(e)}}if(e.class){const t=this.translateAppearance(e.class);t&&s.push(t)}e.additionalPrompt&&s.push(e.additionalPrompt);const r=s.filter(e=>e).join(', ');return console.log(`[ImageGenService] Generating avatar for ${e.name}`),console.log(`[ImageGenService] Original appearance: ${n}`),console.log(`[ImageGenService] Translated prompt: ${r}`),this.generate({mode:'free',prompt:r,quiet:!0,width:a,height:a})}async generatePlayerAvatar(e,t){return this.generateCharacterAvatar({name:e.base.name,race:e.base.race,class:e.base.class,gender:e.base.gender,appearance:e.base.status_desc},t)}async generateAllyAvatar(e,t){let a='';return e.private?.Body_Type&&(a=e.private.Body_Type),this.generateCharacterAvatar({name:e.name,race:e.race,class:e.class,gender:e.gender,appearance:a},t)}async generateNpcAvatar(e,t){return this.generateCharacterAvatar({name:e.name,appearance:e.appearance},t)}resolveImageUrl(e){return e?e.startsWith('http://')||e.startsWith('https://')||e.startsWith('data:')||e.startsWith('/')?e:`/${e}`:''}extractImageTags(e){const t=[],a=/<pic=['"]([^'"]+)['"]\s*\/?>/gi;let s;for(;null!==(s=a.exec(e));)t.push({fullMatch:s[0],prompt:s[1],index:s.index});const n=/<pic>([^<]+)<\/pic>/gi;for(;null!==(s=n.exec(e));){const e=s[1].trim();e&&t.push({fullMatch:s[0],prompt:e,index:s.index})}const r=/<image\s+prompt=['"]([^'"]+)['"]\s*\/?>/gi;for(;null!==(s=r.exec(e));)t.push({fullMatch:s[0],prompt:s[1],index:s.index});const l=/<generate_image>([\s\S]*?)<\/generate_image>/gi;for(;null!==(s=l.exec(e));)t.push({fullMatch:s[0],prompt:s[1].trim(),index:s.index});return t.sort((e,t)=>e.index-t.index).filter((e,t,a)=>0===t||e.index!==a[t-1].index)}async processImageTags(e,t){const a=this.extractImageTags(e);if(0===a.length)return{processedContent:e,generatedImages:[],failedTags:[]};const s=[],n=[];let r=e;const l=[...a].reverse();for(let e=0;e<l.length;e++){const o=l[e],i=l.length-1-e;t?.onProgress?.(i+1,a.length);try{let e=o.prompt;t?.useCharPrefix&&(e=`{{charPrefix}}, ${e}`);const a=await this.generate({mode:'free',prompt:e,quiet:!0,negativePrompt:t?.negativePrompt});if(a.success&&a.imageUrl){const e=this.resolveImageUrl(a.imageUrl);s.push(e);const t=`\n![${o.prompt}](${e})\n`;r=r.substring(0,o.index)+t+r.substring(o.index+o.fullMatch.length)}else{n.push({tag:o.fullMatch,error:a.error||'生成失败'});const e=`[图片生成失败: ${o.prompt}]`;r=r.substring(0,o.index)+e+r.substring(o.index+o.fullMatch.length)}}catch(e){const t=e instanceof Error?e.message:'未知错误';n.push({tag:o.fullMatch,error:t}),console.error('[ImageGenService] Failed to process tag:',o.fullMatch,e)}}return{processedContent:r,generatedImages:s,failedTags:n}}hasImageTags(e){return this.extractImageTags(e).length>0}}class di extends Bl{rngService;constructor(){super('LevelService')}init(){this.rngService=Ll.q.getInstance().get('RNGService'),console.log('LevelService initialized')}getExpRequired(e){return e<20?10*e:e<30?50*e:Math.floor(1500*Math.pow(1.2,e-30))}calculateBattleExp(e,t){let a=0;return t.forEach(t=>{const s=t.level||1;let n=2*s;const r=s-e;r>0?n*=1+.1*r:r<-5&&(n*=.5),a+=Math.floor(n)}),a}processLevelUp(e,t,a){let s=e,n=t+a,r=0,l=0;for(;n>=this.getExpRequired(s)&&s<99;)n-=this.getExpRequired(s),s++,r++,l+=s<=20?2:4;return{newLevel:s,newExp:n,levelUps:r,cpGained:l}}getAttrModifier(e){return Math.floor((e-10)/2)}calculateLevelUpGains(e,t){const a={hpGain:0,mpGain:0,spGain:0};if(t<=0||!this.rngService)return a;for(let s=0;s<t;s++){const t=this.getAttrModifier(e.CON||10),s=this.getAttrModifier(e.INT||10),n=this.getAttrModifier(e.DEX||10);a.hpGain+=Math.max(1,this.rngService.rollDice('1d6')+t),a.mpGain+=Math.max(1,this.rngService.rollDice('1d4')+s),a.spGain+=Math.max(1,this.rngService.rollDice('1d4')+n)}return a}}var ui=l(36);class pi{eventBus;logger;DICT_FIELDS=['items','quests','characters','factions','skills','allies'];ARRAY_FIELDS=[];EQUIPMENT_PATH_PREFIX='player.equipment.';ALLY_EQUIPMENT_REGEX=/^allies\.([^.]+)\.equipment\.([^.]+)$/;VALID_EQUIPMENT_SLOTS=new Set(['weapon_main','weapon_off','head','outer','upper','lower','underwear','underpants','socks','shoes','accessory_1','accessory_2','accessory_3','accessory_4']);constructor(){this.eventBus=Ll.serviceLocator.get('EventBus'),this.logger=Ll.serviceLocator.get('LoggerService')}applyPatch(e,t){const a={success:!0,appliedCount:0,errors:[],changelog:[]};try{const s=Array.isArray(t)?t:this.parsePatchContent(t);for(const t of s){const s=this.applyOperation(e,t);s.success?(a.appliedCount++,a.changelog.push(s.changelog)):a.errors.push({path:t.path,error:s.error})}a.errors.length>0&&(a.success=a.appliedCount>0),a.appliedCount>0&&(this.eventBus.emit('state:patched',{appliedCount:a.appliedCount,changelog:a.changelog}),this.checkLocationChange(e,a.changelog))}catch(e){this.logger.error('PatchService: Failed to apply patch',e),a.success=!1,a.errors.push({path:'',error:e.message})}return a}parsePatchContent(e){const t=e.trim().split('\n').filter(e=>!e.trim().startsWith('#')).join('\n').trim();if(!t)return[];if(t.startsWith('[')||t.startsWith('{'))return JSON.parse(t);{const e=jsyaml.load(t);return Array.isArray(e)?e:e&&'object'==typeof e?[e]:[]}}applyOperation(e,t){try{if((void 0!==t.set||void 0!==t.push)&&t.path.startsWith('allies.')){const a=t.path.split('.');if(2===a.length){const t=a[1],s=e.allies?.[t];if(!s&&e.allies){if(Object.values(e.allies).filter(e=>e.isActive).length>=3)return this.logger.log(`PatchService: Rejected adding new ally '${t}' - team is full (3/3)`),{success:!1,error:'队伍已满（3/3）'}}}}if(void 0!==t.set&&t.path.startsWith(this.EQUIPMENT_PATH_PREFIX))return this.handleEquipmentSet(e,t);if(void 0!==t.push&&t.path.startsWith(this.EQUIPMENT_PATH_PREFIX)){this.logger.log(`PatchService: Converting push to set for equipment slot '${t.path}' (equipment slots are single-item)`);const a={path:t.path,set:t.push};return this.handleEquipmentSet(e,a)}const a=t.path.match(this.ALLY_EQUIPMENT_REGEX);if(a&&(void 0!==t.set||void 0!==t.push))return this.handleAllyEquipmentSet(e,t,a[1],a[2]);const s=this.resolvePath(e,t.path);if(!s.found){if(void 0!==t.set||void 0!==t.push){if(s.target&&'object'==typeof s.target){const e=void 0;let a;return void 0!==t.set?(s.target[s.key]=t.set,a=t.set):void 0!==t.push&&(s.target[s.key]=t.push,a=t.push),{success:!0,changelog:{path:t.path,before:e,after:a}}}const a=this.resolveParentPath(e,t.path);return a.found?this.applyPushToNew(a,t):{success:!1,error:s.error||'Path not found'}}return{success:!1,error:s.error||'Path not found'}}const{target:n,key:r,parent:l,parentKey:o}=s,i=n[r];let c;if(void 0!==t.add)if('number'==typeof n[r]){n[r]+=t.add;[/^player\.stats\.(hp|mp|sp)\.current$/,/^player\.attributes\.(STR|DEX|CON|INT|WIS|CHA)$/,/^inventory\.wallet\.ledger$/,/^allies\.[^.]+\.stats\.(hp|mp|sp)\.current$/,/^allies\.[^.]+\.attributes\.(STR|DEX|CON|INT|WIS|CHA)$/].some(e=>e.test(t.path))&&(n[r]=Math.max(0,n[r])),c=n[r]}else{if(void 0!==n[r])return{success:!1,error:`Cannot add to non-number value at ${t.path}`};n[r]=t.add,c=t.add}else if(void 0!==t.set)'object'!=typeof n[r]||null===n[r]||Array.isArray(n[r])||'object'!=typeof t.set||null===t.set||Array.isArray(t.set)?(n[r]=t.set,c=t.set):(n[r]={...n[r],...t.set},c=n[r]);else if(void 0!==t.push)if(Array.isArray(n[r]))n[r].push(t.push),c=n[r];else{if(!n[r]||'object'!=typeof n[r])return{success:!1,error:`Cannot push to non-array/object at ${t.path}`};{const e=t.push,a=t.path.split('.'),s=a[a.length-1];'object'!=typeof n[r][s]||null===n[r][s]||Array.isArray(n[r][s])||'object'!=typeof e||null===e||Array.isArray(e)?n[r][s]=e:n[r][s]={...n[r][s],...e},c=n[r]}}else{if(!t.remove)return{success:!1,error:'No valid operation specified'};if(Array.isArray(l?.[o])){const e=l[o],t=e.findIndex(e=>e.id===r);if(!(t>=0))return{success:!1,error:`Element not found in array: ${r}`};e.splice(t,1),c=void 0}else{if(!n||'object'!=typeof n)return{success:!1,error:`Cannot remove from ${t.path}`};delete n[r],c=void 0}}return{success:!0,changelog:{path:t.path,before:i,after:c}}}catch(e){return{success:!1,error:e.message}}}handleEquipmentSet(e,t){try{const a=t.path.slice(this.EQUIPMENT_PATH_PREFIX.length);if(!a)return{success:!1,error:'Invalid equipment slot path'};const s=e.player?.equipment;if(!s)return{success:!1,error:'Player equipment not found'};const n=s[a],r=t.set;if(null==r)return this.VALID_EQUIPMENT_SLOTS.has(a)?(delete s[a],this.logger.log(`PatchService: Cleared player equipment slot '${a}'`),{success:!0,changelog:{path:t.path,before:n,after:void 0}}):(this.logger.warn(`PatchService: Rejected invalid slot name '${a}' for player equipment`),{success:!1,error:`无效的装备槽位: ${a}`});if(!this.VALID_EQUIPMENT_SLOTS.has(a))return this.logger.warn(`PatchService: Rejected invalid slot name '${a}' for player equipment`),{success:!1,error:`无效的装备槽位: ${a}`};try{const t=Ll.serviceLocator.get('InventoryService'),s=e.player?.base?.level||1,n=t.validateEquipmentForSlot(r,a,s);if(!n.valid)return this.logger.warn(`PatchService: Rejected invalid equipment for player: ${n.reason}`+(n.suggestedSlot?` (建议槽位: ${n.suggestedSlot})`:'')),this.eventBus.emit('equipment:validation_failed',{allyId:'player',allyName:e.player?.base?.name||'玩家',slotName:a,item:r,reason:n.reason,suggestedSlot:n.suggestedSlot}),{success:!1,error:`装备验证失败: ${n.reason}`}}catch(e){this.logger.warn('PatchService: InventoryService not available, skipping equipment validation for player')}if(n&&n.name)try{const e=Ll.serviceLocator.get('InventoryService'),t={...n,count:n.count||1};e.addItem(t),this.logger.log(`PatchService: Auto-returned equipment '${n.name}' to inventory from slot '${a}'`)}catch(e){this.logger.warn('PatchService: Could not return old equipment to inventory',e)}return s[a]={...r,count:1},this.logger.log(`PatchService: Equipped '${r.name}' to player slot '${a}'`+(n?.name?` (replaced: ${n.name})`:'')),{success:!0,changelog:{path:t.path,before:n,after:s[a]}}}catch(e){return{success:!1,error:e.message}}}handleAllyEquipmentSet(e,t,a,s){try{const n=e.allies?.[a];if(!n)return{success:!1,error:`找不到队友: ${a}`};const r=t.set??t.push??null;if(null==r){const e=n.equipment?.[s];return n.equipment&&delete n.equipment[s],this.logger.log(`PatchService: Cleared ally '${n.name}' equipment slot '${s}'`),{success:!0,changelog:{path:t.path,before:e,after:void 0}}}try{const e=Ll.serviceLocator.get('InventoryService').validateEquipmentForSlot(r,s,n.level||1);if(!e.valid)return this.logger.warn(`PatchService: Rejected invalid equipment for ally '${n.name}': ${e.reason}`+(e.suggestedSlot?` (建议槽位: ${e.suggestedSlot})`:'')),this.eventBus.emit('equipment:validation_failed',{allyId:a,allyName:n.name,slotName:s,item:r,reason:e.reason,suggestedSlot:e.suggestedSlot}),{success:!1,error:`装备验证失败: ${e.reason}`}}catch(e){this.logger.warn('PatchService: InventoryService not available, skipping equipment validation')}n.equipment||(n.equipment={});const l=n.equipment[s];return n.equipment[s]={...r,count:1},this.logger.log(`PatchService: Equipped '${r.name}' to ally '${n.name}' slot '${s}'`+(l?.name?` (replaced: ${l.name})`:'')),{success:!0,changelog:{path:t.path,before:l,after:n.equipment[s]}}}catch(e){return{success:!1,error:e.message}}}applyPushToNew(e,t){const{target:a}=e;if(!a||'object'!=typeof a)return{success:!1,error:'Parent path is not an object'};const s=t.push;let n;if(Array.isArray(a))a.push(s),n=s;else{const e=t.path.split('.'),r=e[e.length-1];'object'!=typeof a[r]||null===a[r]||Array.isArray(a[r])||'object'!=typeof s||null===s||Array.isArray(s)?a[r]=s:a[r]={...a[r],...s},n=a[r]}return{success:!0,changelog:{path:t.path,before:void 0,after:n}}}resolvePath(e,t){const a=t.split('.');let s=e,n=null,r='';for(let e=0;e<a.length-1;e++){const t=a[e];if(n=s,r=t,null==s)return{target:null,key:'',found:!1,error:`Path segment '${t}' is null/undefined`};if(this.DICT_FIELDS.includes(t)){const r=a[e+1];if(!r)return{target:null,key:'',found:!1,error:`Missing ID after '${t}'`};if(s=s[t],!s||!s[r])return s?{target:s,key:r,parent:n,parentKey:t,found:!1,error:`Item '${r}' not found in '${t}'`}:{target:null,key:'',found:!1,error:`'${t}' is null/undefined`};s=s[r],e++}else if(this.ARRAY_FIELDS.includes(t)&&Array.isArray(s[t])){const l=a[e+1];if(!l){s=s[t];continue}const o=s[t],i=o.find(e=>e.id===l);if(!i)return{target:o,key:l,parent:s,parentKey:t,found:!1,error:`Element with id '${l}' not found in array '${t}'`};n=s,r=t,s=i,e++}else s=s[t]}const l=a[a.length-1];return null==s?{target:null,key:l,parent:n,parentKey:r,found:!1,error:'Parent is null/undefined'}:{target:s,key:l,parent:n,parentKey:r,found:!0}}resolveParentPath(e,t){const a=t.split('.');if(a.length<2)return{target:e,key:a[0],found:!0};const s=a.slice(0,-1).join('.'),n=a[a.length-1],r=this.resolvePath(e,s);return r.found?{target:r.target[r.key],key:n,found:!0}:r}validatePatch(e){const t=[];try{const a=this.parsePatchContent(e);if(!Array.isArray(a))return t.push('Patch content must be an array of operations'),{valid:!1,errors:t};for(let e=0;e<a.length;e++){const s=a[e];if(!s.path||'string'!=typeof s.path){t.push(`Operation ${e}: missing or invalid 'path'`);continue}void 0!==s.add||void 0!==s.set||void 0!==s.push||void 0!==s.remove||t.push(`Operation ${e}: no operation specified (add/set/push/remove)`);[void 0!==s.add,void 0!==s.set,void 0!==s.push,void 0!==s.remove].filter(Boolean).length>1&&t.push(`Operation ${e}: multiple operations specified, should have only one`)}}catch(e){t.push(`Parse error: ${e.message}`)}return{valid:0===t.length,errors:t}}previewPatch(e,t){const a=[];try{const s=this.parsePatchContent(t);for(const t of s){const s=this.resolvePath(e,t.path);let n,r;s.found&&(n=s.target[s.key]),void 0!==t.add&&'number'==typeof n?r=n+t.add:void 0!==t.set?r=t.set:void 0!==t.push?r='[PUSH]':t.remove&&(r='[REMOVED]'),a.push({path:t.path,current:n,proposed:r})}}catch(e){this.logger.error('PatchService: Preview failed',e)}return a}static extractPatchTag(e){const t=e.match(/<patch>([\s\S]*?)<\/patch>/i);return t?t[1].trim():void 0}static extractAllPatchTags(e){const t=/<patch>([\s\S]*?)<\/patch>/gi,a=[];let s;for(;null!==(s=t.exec(e));)a.push(s[1].trim());return a}checkLocationChange(e,t){t.some(e=>'scene.locationPath'===e.path||e.path.startsWith('scene.locationPath.'))&&e.scene?.locationPath&&e.scene.locationPath.length>0&&(this.clearPendingEnemies(e),this.clearCurrentShop(e))}clearPendingEnemies(e){let t=0;e.pendingEnemies&&(t=Object.keys(e.pendingEnemies).length,e.pendingEnemies={}),e.pendingEnemy&&(t++,e.pendingEnemy=void 0),t>0&&this.logger.log(`PatchService: Cleared ${t} pending enemy cache(s) due to location change`)}clearCurrentShop(e){if(e.currentShop){const t=e.currentShop.merchant_name;e.currentShop=void 0,this.logger.log(`PatchService: Cleared currentShop (${t}) due to location change`)}}}var mi=l(725);const gi='story:generating',hi='story:received',fi='story:invalid',vi='story:error',yi='toolai:processing',bi='toolai:completed',xi='toolai:error',wi='imagegen:generating',ki='imagegen:completed',Si='imagegen:error',_i='chat:received',Ci='chat:error';class Ii extends Bl{logger;promptInjector;patchService;saveService;toolAIService;offlineActionService;imageGenService;commandQueueService;textOptimizationService;useTagParser=!0;useToolAI=!0;useAutoImageGen=!0;useTextOptimization=!1;currentRoundTasks=new Set;constructor(){super('LLMService')}init(){const e=Ll.q.getInstance();this.logger=e.get('LoggerService'),this.promptInjector=e.get('PromptInjector'),this.saveService=e.get('SaveService');try{this.patchService=e.get('PatchService')}catch{this.logger?.log('PatchService not registered, patch processing disabled')}try{this.toolAIService=e.get('ToolAIService')}catch{this.logger?.log('ToolAIService not registered, tool AI processing disabled')}try{this.offlineActionService=e.get('OfflineActionService')}catch{this.logger?.log('OfflineActionService not registered')}try{this.imageGenService=e.get('ImageGenService')}catch{this.logger?.log('ImageGenService not registered, auto image generation disabled')}try{this.commandQueueService=e.get('CommandQueueService')}catch{this.logger?.log('CommandQueueService not registered')}try{this.textOptimizationService=e.get('TextOptimizationService')}catch{this.logger?.log('TextOptimizationService not registered, text optimization disabled')}this.logger?.log('LLMService initialized (using generate with tavern preset + injects)')}setUseTagParser(e){this.useTagParser=e,this.logger?.log('TagParser '+(e?'enabled':'disabled'))}setUseAutoImageGen(e){this.useAutoImageGen=e,this.logger?.log('Auto image generation '+(e?'enabled':'disabled'))}getUseAutoImageGen(){return this.useAutoImageGen}setUseTextOptimization(e){this.useTextOptimization=e,this.logger?.log('Text optimization '+(e?'enabled':'disabled'))}getUseTextOptimization(){return this.useTextOptimization}async advanceStory(e,t){if(this.logger?.log(`Advancing story with input: ${e}`),this.currentRoundTasks.size>0){this.logger?.log(`Cancelling ${this.currentRoundTasks.size} pending tasks from previous round`);const e=Ll.q.getInstance().get('BackgroundTaskService');for(const t of this.currentRoundTasks)e.cancelTask(t)}this.currentRoundTasks.clear();const a=await mi.storyDB.getLastAssistantMessage();let s;a&&a.id&&mi.storyDB.hasOptimizedContent(a)&&(this.logger?.log('Applying pending text optimization before new user input'),await mi.storyDB.applyOptimization(a.id));try{s=Ll.q.getInstance().get('EventBus')}catch{}s?.emit(gi);try{const a=await this.promptInjector.buildInjectsForGenerateRaw(t,void 0,e),n=this.saveService?.getGameState();n?(await mi.storyDB.addRecordWithSnapshot({timestamp:Date.now(),role:'user',content:e},n,'Player snapshot (before story AI)',mi.L.PRE_STORY_AI),this.logger?.log('Saved user message with PRE_STORY_AI snapshot')):await mi.storyDB.addRecord({timestamp:Date.now(),role:'user',content:e}),this.logger?.log(`Calling generate() with tavern preset + ${a.length} injects...`);for(let e=0;e<a.length;e++){const t=a[e],s=t.content.substring(0,80).replace(/\n/g,'\\n');this.logger?.log(`[Inject ${e}] depth=${t.depth}, role=${t.role}, preview="${s}..."`)}const r=`<user_input>\n${e}\n</user_input>`,l=await generate({user_input:r,max_chat_history:0,injects:a,overrides:{chat_history:{with_depth_entries:!0}}});this.promptInjector?.clearCachedOfflineActions();const o=this.parseResponse(l),i=o.content&&o.content.trim().length>0,c=o.exits&&o.exits.length>0||o.npcs&&o.npcs.length>0||o.objects&&o.objects.length>0||o.options&&o.options.length>0||o.pic&&o.pic.trim().length>0;if(!i&&!c)throw this.logger?.log('Invalid response: empty content and no functional tags. Aborting.'),s?.emit(fi,{reason:'AI 返回内容为空且无有效标签'}),new Error('AI 返回内容为空且无有效标签');if(s?.emit(hi),o.parsed&&this.applyParsedTagsToScene(o.parsed),this.useAutoImageGen&&this.imageGenService&&o.pic&&o.pic.trim()){const e=await this.runImageGenInBackground(o.pic.trim(),l);e&&(this.currentRoundTasks.add(e),this.logger?.log(`Added image generation task to tracking: ${e}`))}const d=o.content;await mi.storyDB.addRecord({timestamp:Date.now(),role:'assistant',content:l}),this.logger?.log('Story assistant record saved to DB');try{const e=Ll.q.getInstance().get('RegexService');if(e&&e.isEnabled()){const t=e.getRuleSets().filter(e=>e.enabled).flatMap(e=>e.rules.filter(e=>e.enabled&&'permanent'===e.mode));if(t.length>0){this.logger?.log(`Applying ${t.length} permanent regex rules to latest message`);for(const a of t){const{pattern:t,flags:s}=e.getPatternAndFlags(a);await mi.storyDB.applyRegexPermanent(t,a.replacement,s,0,0)}this.logger?.log('Permanent regex rules applied successfully')}}}catch(e){this.logger?.error('Failed to apply permanent regex rules:',e)}if(n){const e=await mi.storyDB.getLatestSnapshot(),t=e?e.version+1:1;await mi.storyDB.saveSnapshot(n,'Story AI snapshot (after story AI)',mi.L.GENERIC,t),this.logger?.log('Saved story AI snapshot for message deletion recovery')}try{Ll.q.getInstance().get('EventBus').emit('chat:refresh')}catch{}if(this.useTextOptimization&&this.textOptimizationService&&o.content){const e=await this.runTextOptimizationInBackground(o.content,l);e&&(this.currentRoundTasks.add(e),this.logger?.log(`Added text optimization task to tracking: ${e}`))}let u;if(this.useToolAI&&this.toolAIService){const t=await this.runToolAIInBackground(l,e);t&&(this.currentRoundTasks.add(t),this.logger?.log(`Added Tool AI task to tracking: ${t}`))}if(0===this.currentRoundTasks.size){this.logger?.log('No background tasks, emitting chat:received immediately');Ll.q.getInstance().get('EventBus').emit('chat:received')}else this.logger?.log(`Waiting for ${this.currentRoundTasks.size} background tasks to complete`);return{...o,content:d,toolOutput:u}}catch(e){if(e instanceof Error&&e.message&&(e.message.includes('取消')||e.message.includes('cancelled')||e.message.includes('无效')))this.logger?.log('Story generation cancelled or invalid'),s?.emit(vi,{error:'已取消'});else{this.logger?.error('Failed to advance story',e);const t=e instanceof Error?e.message:String(e);s?.emit(vi,{error:t})}throw e}}async stopGeneration(){if(this.logger?.log('Stopping generation...'),this.currentRoundTasks.size>0){this.logger?.log(`Cancelling ${this.currentRoundTasks.size} background tasks`);const e=Ll.q.getInstance().get('BackgroundTaskService');for(const t of this.currentRoundTasks)e.cancelTask(t);this.currentRoundTasks.clear()}'function'==typeof stopAllGeneration?await stopAllGeneration():console.warn('stopAllGeneration API not found')}parseResponse(e){if(this.useTagParser){const t=ui.e.parseStory(e);return{thinking:t.thinking,content:t.content||e,summary:t.summary,pic:t.pic,raw:e,exits:t.exits,npcs:t.npcs,objects:t.objects,options:t.options,parsed:t}}const t=t=>{const a=new RegExp(`<${t}>([\\s\\S]*?)<\\/${t}>`,'i'),s=e.match(a);return s?s[1].trim():void 0};return{thinking:t('thinking'),content:t('content')||e,summary:t('summary'),pic:t('pic'),raw:e}}extractContentFromRaw(e){const t=e.match(/<content>([\s\S]*?)<\/content>/i);return t?t[1].trim():e}normalizeNameWithBracket(e){const t=e.trim(),a=t.match(/^([^(（]+)[（(]([^)）]+)[)）]$/);return a?{name:a[1].trim(),brief:a[2].trim()}:{name:t}}applyParsedTagsToScene(e){const t=this.saveService?.getGameState();if(!t)return;t.scene||(t.scene={});let a=!1;if(e.exits&&e.exits.length>0){const s={};for(const t of e.exits){const e=this.normalizeNameWithBracket(t);e.name&&(s[e.name]={name:e.name})}t.scene.exits=s,a=!0,this.logger?.log(`Applied ${e.exits.length} exits to scene.exits`)}if(e.npcs&&e.npcs.length>0){const s={};for(const t of e.npcs){const e=this.normalizeNameWithBracket(t.name);if(e.name){const a=t.levelInfo?`${t.levelInfo}${t.description?' - '+t.description:''}`:t.description||'';s[e.name]={name:e.name,appearance:a,status:t.description||'在场',attitude:''}}}t.scene.npcs=s,a=!0,this.logger?.log(`Applied ${e.npcs.length} npcs to scene.npcs`)}if(e.objects&&e.objects.length>0){const s={};for(const t of e.objects){const e=this.normalizeNameWithBracket(t.name);if(e.name){const a=e.brief?t.description?`${e.brief}, ${t.description}`:e.brief:t.description||void 0;s[e.name]={name:e.name,brief:a,interactable:!0}}}t.scene.objects=s,a=!0,this.logger?.log(`Applied ${e.objects.length} objects to scene.objects`)}if(a){if(t.pendingEnemies&&Object.keys(t.pendingEnemies).length>0){const e=Object.keys(t.pendingEnemies).length;t.pendingEnemies={},this.logger?.log(`Cleared ${e} pending enemies due to scene update`)}this.saveService?.saveData('Story AI tags applied to scene');try{Ll.q.getInstance().get('EventBus').emit('state:updated')}catch{}}}async callToolAI(e){this.logger?.log('Tool AI analysis not yet implemented')}async runToolAIInBackground(e,t){let a,s;try{a=Ll.q.getInstance().get('EventBus')}catch{}a?.emit(yi);try{s=Ll.q.getInstance().get('BackgroundTaskService')}catch{this.logger?.log('BackgroundTaskService not available, running Tool AI synchronously');try{await this.executeToolAI(e,t),a?.emit(bi)}catch(e){const t=e instanceof Error?e.message:String(e);a?.emit(xi,{error:t})}return void a?.emit(_i)}const{taskId:n,abortController:r}=s.createTask(Rl.TOOL_AI);return s.startTask(n),this.executeToolAITask(n,e,t,r,s,a).catch(()=>{}),n}async executeToolAITask(e,t,a,s,n,r){try{if(s.signal.aborted)return void this.logger?.log('Tool AI task cancelled before start');await this.executeToolAI(t,a,s.signal),n.completeTask(e),r?.emit(bi),this.checkAndEmitCompletion(e)}catch(t){if(t instanceof Error&&'AbortError'===t.name)this.logger?.log('Tool AI task was cancelled'),n.cancelTask(e);else{const a=t instanceof Error?t.message:String(t);this.logger?.error('Tool AI background task failed',t),n.setTaskError(e,a),r?.emit(xi,{error:a})}this.checkAndEmitCompletion(e)}}async executeToolAI(e,t,a){if(!this.toolAIService||!this.saveService)return;if(this.logger?.log('Executing Tool AI for structured data extraction...'),a?.aborted)throw new DOMException('Tool AI cancelled','AbortError');const s=await mi.storyDB.getRecentContext(8),n=(s.length>=2?s.slice(0,-2):[]).map(e=>({role:e.role,content:'assistant'===e.role?this.extractContentFromRaw(e.content):e.content}));this.logger?.log(`Tool AI using ${n.length} historical dialogs (excluded current round)`);const r=this.offlineActionService?.getCompressedSummary?.()||[];if(a?.aborted)throw new DOMException('Tool AI cancelled','AbortError');const l=await this.toolAIService.process({storyOutput:this.toolAIService.filterStoryOutput(e),userInput:t,recentDialogs:n,offlineActions:r,gameState:this.saveService.getGameState()},a);if(a?.aborted)throw this.logger?.log('Tool AI cancelled after generateRaw completed, discarding results'),new DOMException('Tool AI cancelled','AbortError');const o=this.saveService?.getGameState();if(o){const e=await mi.storyDB.getLatestSnapshot(),t=e?e.version:void 0;await mi.storyDB.saveSnapshot(o,'Tool AI snapshot (after tool AI)',mi.L.POST_TOOL_AI,t),this.logger?.log(`Saved POST_TOOL_AI snapshot with baseVersion: ${t}`)}return this.logger?.log('Tool AI processing complete',l.errors?.length?`with ${l.errors.length} errors`:''),l}async runTextOptimizationInBackground(e,t){let a;try{a=Ll.q.getInstance().get('BackgroundTaskService')}catch{this.logger?.log('BackgroundTaskService not available, running text optimization synchronously');try{await this.executeTextOptimization(e,t)}catch(e){this.logger?.error('Text optimization failed:',e)}return}const{taskId:s,abortController:n}=a.createTask(Rl.STORY_POLISH);return a.startTask(s),this.executeTextOptimizationTask(s,e,t,n,a).catch(()=>{}),s}async executeTextOptimizationTask(e,t,a,s,n){try{if(s.signal.aborted)return void this.logger?.log('Text optimization task cancelled before start');await this.executeTextOptimization(t,a,s.signal),n.completeTask(e),this.checkAndEmitCompletion(e)}catch(t){if(t instanceof Error&&'AbortError'===t.name)this.logger?.log('Text optimization task was cancelled'),n.cancelTask(e);else{const a=t instanceof Error?t.message:String(t);this.logger?.error('Text optimization background task failed',t),n.setTaskError(e,a)}this.checkAndEmitCompletion(e)}}async executeTextOptimization(e,t,a){if(this.textOptimizationService){if(this.logger?.log('Executing text optimization...'),a?.aborted)throw new DOMException('Text optimization cancelled','AbortError');try{const t=await this.textOptimizationService.optimize(e,a);if(a?.aborted)throw this.logger?.log('Text optimization cancelled after optimization completed, discarding results'),new DOMException('Text optimization cancelled','AbortError');await this.textOptimizationService.completeOptimization(t),this.logger?.log('Text optimization completed and applied');try{Ll.q.getInstance().get('EventBus').emit('chat:refresh')}catch{}}catch(e){if(e instanceof Error&&'AbortError'===e.name)throw e;throw this.logger?.error('Text optimization failed:',e),e}}}async runImageGenInBackground(e,t){let a,s;try{a=Ll.q.getInstance().get('EventBus')}catch{}a?.emit(wi,{prompt:e});try{s=Ll.q.getInstance().get('BackgroundTaskService')}catch{this.logger?.log('BackgroundTaskService not available, running image generation synchronously');try{await this.executeImageGen(e,t),a?.emit(ki,{prompt:e})}catch(t){const s=t instanceof Error?t.message:String(t);a?.emit(Si,{prompt:e,error:s})}return}const{taskId:n,abortController:r}=s.createTask(Rl.IMAGE_GENERATE);return s.startTask(n),this.executeImageGenTask(n,e,t,r,s,a).catch(()=>{}),n}async executeImageGenTask(e,t,a,s,n,r){try{if(s.signal.aborted)return void this.logger?.log('Image generation task cancelled before start');await this.executeImageGen(t,a,s.signal),n.completeTask(e),r?.emit(ki,{prompt:t}),this.checkAndEmitCompletion(e)}catch(a){if(a instanceof Error&&'AbortError'===a.name)this.logger?.log('Image generation task was cancelled'),n.cancelTask(e);else{const s=a instanceof Error?a.message:String(a);this.logger?.error('Image generation background task failed',a),n.setTaskError(e,s),r?.emit(Si,{prompt:t,error:s})}this.checkAndEmitCompletion(e)}}checkAndEmitCompletion(e){if(this.currentRoundTasks.delete(e),this.logger?.log(`Task completed: ${e}, remaining: ${this.currentRoundTasks.size}`),0===this.currentRoundTasks.size){this.logger?.log('All background tasks completed, emitting chat:received');try{Ll.q.getInstance().get('EventBus').emit('chat:received')}catch(e){this.logger?.error('Failed to emit chat:received',e)}}}async executeImageGen(e,t,a){if(this.imageGenService){if(this.logger?.log('Executing image generation for prompt:',e),a?.aborted)throw new DOMException('Image generation cancelled','AbortError');try{const t=await this.imageGenService.generateCustom(e,{quiet:!0});if(a?.aborted)throw this.logger?.log('Image generation cancelled after generation completed, discarding results'),new DOMException('Image generation cancelled','AbortError');if(t.success&&t.imageUrl){const e=this.imageGenService.resolveImageUrl(t.imageUrl);this.logger?.log(`Image generated successfully: ${e}`);const a=[...await mi.storyDB.getRecentContext(5)].reverse().find(e=>'assistant'===e.role);if(a&&a.id){const t=`\n\n![](${e})`,s=a.content+t;await mi.storyDB.updateRecord(a.id,{content:s}),this.logger?.log('AI message updated with generated image'),await mi.storyDB.updateCurrentSnapshot(),this.logger?.log('Current snapshot updated with generated image');try{Ll.q.getInstance().get('EventBus').emit('chat:refresh')}catch{}}else this.logger?.log('Could not find AI message to update with image')}else this.logger?.log(`Image generation failed: ${t.error}`)}catch(e){if(e instanceof Error&&'AbortError'===e.name)throw e;throw this.logger?.error('Image generation failed:',e),e}}}async processToolResponse(e){if(!this.patchService)return this.logger?.log('PatchService not available, skipping patch processing'),{success:!1};const t=pi.extractPatchTag(e);if(!t)return this.logger?.log('No patch tag found in tool response'),{success:!0};try{const e=Ll.q.getInstance().get('SaveService'),a=e.getGameState();if(!a)return this.logger?.error('No game state available for patching'),{success:!1};const s=this.patchService.applyPatch(a,t);return s.success?(this.logger?.log(`Patch applied: ${s.appliedCount} operations, changelog:`,s.changelog),e.saveData('Patch applied')):this.logger?.error('Patch application failed:',s.errors),{success:s.success,patchResult:s}}catch(e){return this.logger?.error('Error processing tool response:',e),{success:!1}}}getLastOptions(){}async executeTask(e){this.logger?.log('Executing specialized LLM task...');const t=[];e.useWorldInfo&&(t.push('world_info_before'),t.push('scenario'),t.push('world_info_after')),e.systemPrompt&&t.push({role:'system',content:e.systemPrompt}),e.history&&e.history.length>0&&t.push(...e.history),t.push({role:'user',content:e.input});try{return await generateRaw({ordered_prompts:t,user_input:e.input,max_chat_history:0})}catch(e){throw this.logger?.error('LLM Task execution failed',e),e}}async regenerateStory(e){if(this.logger?.log(`Regenerating story (剧情正文重roll)... messageId: ${e??'latest'}`),this.currentRoundTasks.size>0){this.logger?.log(`Cancelling ${this.currentRoundTasks.size} pending tasks from previous round`);const e=Ll.q.getInstance().get('BackgroundTaskService');for(const t of this.currentRoundTasks)e.cancelTask(t)}let t;this.currentRoundTasks.clear();try{t=Ll.q.getInstance().get('EventBus')}catch{}t?.emit(gi);try{const a=await mi.storyDB.getRecentContext(50);if(0===a.length)throw new Error('没有可重roll的消息');let s=-1,n=null;if(void 0!==e){if(s=a.findIndex(t=>t.id===e),-1===s)throw new Error(`没有找到ID为 ${e} 的消息`);n=a[s]}else{for(let e=a.length-1;e>=0;e--)if('assistant'===a[e].role){s=e,n=a[e];break}if(!n)throw new Error('没有找到可重roll的AI回复')}let r=null;if('user'===n.role)r=n,this.logger?.log(`Target is user message, will resend: "${n.content.substring(0,50)}..."`);else{for(let e=s-1;e>=0;e--)if('user'===a[e].role){r=a[e];break}if(!r)throw new Error('没有找到对应的用户消息')}const l=r.content;this.logger?.log(`Found user message for input: "${l.substring(0,50)}..."`),this.logger?.log(`Target message to delete from, id: ${n.id}`);const o=await mi.storyDB.getSnapshotBefore(n.timestamp);if(o&&this.saveService){this.logger?.log(`Restoring snapshot from ${new Date(o.timestamp).toLocaleTimeString()}`);const e=this.saveService.getGameState();e&&(Object.assign(e,JSON.parse(JSON.stringify(o.gameState))),await this.saveService.saveData('Snapshot restored for regeneration')),this.commandQueueService?.clearAll(),this.logger?.log('Command queue cleared after snapshot restoration')}else this.logger?.log('No snapshot found to restore, proceeding without state restoration');if(n.id&&(await mi.storyDB.deleteSnapshotsAfter(n.timestamp),this.logger?.log(`Deleted snapshots from timestamp: ${n.timestamp} and onwards`),await mi.storyDB.deleteRecordsFromId(n.id),this.logger?.log(`Deleted messages from id: ${n.id} and onwards`)),'user'===n.role)return this.logger?.log('Target was user message, calling advanceStory...'),await this.advanceStory(l);const i=await this.promptInjector.buildInjectsForGenerateRaw(void 0,void 0,l),c=`<user_input>\n${l}\n</user_input>`;this.logger?.log(`Calling generate() for regeneration with tavern preset + ${i.length} injects...`);const d=await generate({user_input:c,max_chat_history:0,injects:i,overrides:{chat_history:{with_depth_entries:!0}}});this.promptInjector?.clearCachedOfflineActions();const u=this.parseResponse(d),p=u.content&&u.content.trim().length>0,m=u.exits&&u.exits.length>0||u.npcs&&u.npcs.length>0||u.objects&&u.objects.length>0||u.options&&u.options.length>0||u.pic&&u.pic.trim().length>0;if(!p&&!m)throw this.logger?.log('Invalid response: empty content and no functional tags. Aborting.'),t?.emit(fi,{reason:'AI 返回内容为空且无有效标签'}),new Error('AI 返回内容为空且无有效标签');t?.emit(hi),u.parsed&&this.applyParsedTagsToScene(u.parsed);const g=this.saveService?.getGameState();if(g?.pendingEnemies&&Object.keys(g.pendingEnemies).length>0){const e=Object.keys(g.pendingEnemies).length;g.pendingEnemies={},this.logger?.log(`Cleared ${e} pending enemies due to regeneration`)}if(this.useAutoImageGen&&this.imageGenService&&u.pic&&u.pic.trim()){const e=await this.runImageGenInBackground(u.pic.trim(),d);e&&(this.currentRoundTasks.add(e),this.logger?.log(`Added image generation task to tracking: ${e}`))}const h=u.content;if(await mi.storyDB.addRecord({timestamp:Date.now(),role:'assistant',content:d}),this.logger?.log('Story assistant record saved to DB'),g){const e=await mi.storyDB.getLatestSnapshot(),t=e?e.version+1:1;await mi.storyDB.saveSnapshot(g,'Story AI snapshot (after story AI regeneration)',mi.L.GENERIC,t),this.logger?.log('Saved story AI snapshot for message deletion recovery')}try{Ll.q.getInstance().get('EventBus').emit('chat:refresh')}catch{}if(this.useTextOptimization&&this.textOptimizationService&&u.content){const e=await this.runTextOptimizationInBackground(u.content,d);e&&(this.currentRoundTasks.add(e),this.logger?.log(`Added text optimization task to tracking: ${e}`))}let f;if(this.useToolAI&&this.toolAIService){const e=await this.runToolAIInBackground(d,l);e&&(this.currentRoundTasks.add(e),this.logger?.log(`Added Tool AI task to tracking: ${e}`))}if(0===this.currentRoundTasks.size){this.logger?.log('No background tasks, emitting chat:received immediately');Ll.q.getInstance().get('EventBus').emit('chat:received')}else this.logger?.log(`Waiting for ${this.currentRoundTasks.size} background tasks to complete`);return this.logger?.log('Story regeneration complete'),{...u,content:h,toolOutput:f}}catch(e){if(e instanceof Error&&e.message&&(e.message.includes('取消')||e.message.includes('cancelled')||e.message.includes('无效')))this.logger?.log('Story regeneration cancelled or invalid'),t?.emit(vi,{error:'已取消'});else{this.logger?.error('Failed to regenerate story',e);const a=e instanceof Error?e.message:String(e);t?.emit(vi,{error:a})}throw e}}async reprocessToolAI(){this.logger?.log('Reprocessing Tool AI (变量思考重roll)...');try{const e=await mi.storyDB.getLatestSnapshot();if(!e)throw new Error('没有找到当前快照');const t=e.baseVersion;if(!t)throw new Error('当前快照没有baseVersion，无法重roll工具AI');this.logger?.log(`Current snapshot version: ${e.version}, baseVersion: ${t}`);const a=await mi.storyDB.getSnapshotByVersion(t);if(!a)throw new Error(`没有找到版本 ${t} 的快照`);if(this.saveService){this.logger?.log(`Restoring to baseVersion ${t} snapshot`);const e=this.saveService.getGameState();e&&(Object.assign(e,JSON.parse(JSON.stringify(a.gameState))),await this.saveService.saveData('Snapshot restored for tool AI reroll')),this.commandQueueService?.clearAll(),this.logger?.log('Command queue cleared after snapshot restoration')}const s=await mi.storyDB.getRecentContext(10);let n=null,r=null;for(let e=s.length-1;e>=0;e--)if('assistant'===s[e].role){n=s[e];for(let t=e-1;t>=0;t--)if('user'===s[t].role){r=s[t];break}break}if(!n||!r)throw new Error('没有找到可重roll的消息');const l=n.content,o=r.content,i=this.saveService?.getGameState();if(i?.pendingEnemies&&Object.keys(i.pendingEnemies).length>0){const e=Object.keys(i.pendingEnemies).length;i.pendingEnemies={},this.logger?.log(`Cleared ${e} pending enemies due to variable reroll`)}let c;if(!this.useToolAI||!this.toolAIService)throw new Error('工具AI服务未启用');try{this.logger?.log('Re-calling Tool AI for variable reroll...');const e=s.findIndex(e=>e===n),t=(e>=2?s.slice(0,e-1):[]).map(e=>({role:e.role,content:'assistant'===e.role?this.extractContentFromRaw(e.content):e.content}));this.logger?.log(`Variable reroll using ${t.length} historical dialogs (excluded current round)`);const a=this.offlineActionService?.getCompressedSummary?.()||[];c=await this.toolAIService.process({storyOutput:this.toolAIService.filterStoryOutput(l),userInput:o,recentDialogs:t,offlineActions:a,gameState:this.saveService.getGameState()}),this.logger?.log('Tool AI reprocessing complete',c.errors?.length?`with ${c.errors.length} errors`:'')}catch(e){throw this.logger?.error('Tool AI reprocessing failed',e),e}return this.logger?.log('Variable reroll complete'),c}catch(e){throw this.logger?.error('Failed to reprocess Tool AI',e),e}}async reprocessTextOptimization(){this.logger?.log('Reprocessing text optimization (正文优化重roll)...');try{const e=await mi.storyDB.getLastAssistantMessage();if(!e)throw new Error('没有找到AI消息');const t=ui.e.extractTag(e.content,'content')||'';if(!t)throw new Error('消息中没有找到 <content> 标签');if(this.logger?.log(`Found original content for reprocessing: "${t.substring(0,50)}..."`),!this.textOptimizationService)throw new Error('TextOptimizationService not available');const a=await this.textOptimizationService.optimize(t),s=await mi.storyDB.getLastAssistantMessage();s&&s.id&&await this.textOptimizationService.completeOptimization(a),this.logger?.log('Text optimization reprocessing complete');try{Ll.q.getInstance().get('EventBus').emit('chat:refresh')}catch{}return a}catch(e){throw this.logger?.error('Failed to reprocess text optimization',e),e}}async reprocessImageGen(){this.logger?.log('Reprocessing image generation (生图重roll)...');try{const e=await mi.storyDB.getLastAssistantMessage();if(!e)throw new Error('没有找到AI消息');let t='';const a=e.content.match(/<pic>([\s\S]*?)<\/pic>/i);if(a)t=a[1].trim();else{const a=e.content.match(/<pic\s*=\s*"([^"]*)"/i);a&&(t=a[1].trim())}if(!t)throw new Error('消息中没有找到 <pic> 标签');if(this.logger?.log(`Found pic prompt for reprocessing: "${t.substring(0,50)}..."`),!this.imageGenService)throw new Error('ImageGenService not available');const s=await this.imageGenService.generateCustom(t,{quiet:!0});if(!s.success||!s.imageUrl)throw new Error(s.error||'生图失败');const n=this.imageGenService.resolveImageUrl(s.imageUrl);this.logger?.log(`Image regenerated successfully: ${n}`);const r=await mi.storyDB.getLastAssistantMessage();if(r&&r.id){const e=`\n\n![](${n})`,t=r.content+e;await mi.storyDB.updateRecord(r.id,{content:t}),this.logger?.log('AI message updated with regenerated image'),await mi.storyDB.updateCurrentSnapshot(),this.logger?.log('Current snapshot updated with new image')}this.logger?.log('Image generation reprocessing complete');try{Ll.q.getInstance().get('EventBus').emit('chat:refresh')}catch{}return n}catch(e){throw this.logger?.error('Failed to reprocess image generation',e),e}}}class Ti extends Bl{constructor(){super('LoggerService')}init(){console.log('LoggerService initialized')}log(e,t){console.log(`[Game] ${e}`,t||''),this.eventBus.emit('log:info',{message:e,context:t})}warn(e,t){console.warn(`[Game Warning] ${e}`,t||''),this.eventBus.emit('log:warn',{message:e,context:t})}error(e,t){console.error(`[Game Error] ${e}`,t||''),this.eventBus.emit('log:error',{message:e,error:t})}}function Ai(){return{nodes:{},edges:{},edgeInfo:{},currentNode:void 0,lastUpdated:(new Date).toISOString()}}class Mi extends Bl{graph;constructor(){super('NodeMapService'),this.graph=Ai()}async init(){console.log('[NodeMapService] 初始化完成')}getGraph(){return this.graph}setGraph(e){this.graph=e}reset(){this.graph=Ai()}insertLocationPath(e,t,a){if(!e||0===e.length)return;const s=this.graph;e.forEach((t,a)=>{s.nodes[t]||(s.nodes[t]={id:t,name:t,depth:a,type:this.inferNodeType(a,e.length)},s.edges[t]=[]),s.nodes[t].depth=Math.min(s.nodes[t].depth??a,a)});const n=e[e.length-1];a&&(s.nodes[n].lastVisit=a),t&&!s.nodes[n].desc&&(s.nodes[n].desc=t),s.currentNode=n;for(let t=0;t<e.length-1;t++){const a=e[t],n=e[t+1];if(s.edges[a].includes(n)){const e=`${a}->${n}`;s.edgeInfo?.[e]&&s.edgeInfo[e].traverseCount++}else{s.edges[a].push(n);const e=`${a}->${n}`;s.edgeInfo||(s.edgeInfo={}),s.edgeInfo[e]={from:a,to:n,traverseCount:1}}}this.cleanupTransitiveEdges(),a&&(s.lastUpdated=a),console.log('[NodeMapService] 路径已插入:',e.join(' → '))}inferNodeType(e,t){return 0===e?'country':1===e?'city':2===e?'building':e===t-1?'room':'floor'}cleanupTransitiveEdges(){const e=this.graph,t=Object.keys(e.edges);for(const a of t){const t=[...e.edges[a]];for(const s of t)if(this.hasAlternativePath(a,s)){e.edges[a]=e.edges[a].filter(e=>e!==s);const t=`${a}->${s}`;e.edgeInfo?.[t]&&delete e.edgeInfo[t],console.log(`[NodeMapService] 移除冗余边: ${a} → ${s}`)}}}hasAlternativePath(e,t,a=5){const s=this.graph,n=new Set,r=[];for(const a of s.edges[e]||[])a!==t&&r.push({node:a,depth:1});for(;r.length>0;){const{node:e,depth:l}=r.shift();if(e===t)return!0;if(!(l>=a)&&!n.has(e)){n.add(e);for(const t of s.edges[e]||[])n.has(t)||r.push({node:t,depth:l+1})}}return!1}updateNodeDesc(e,t){this.graph.nodes[e]&&(this.graph.nodes[e].desc=t)}addNodeTag(e,t){const a=this.graph.nodes[e];a&&(a.tags||(a.tags=[]),a.tags.includes(t)||a.tags.push(t))}removeNodeTag(e,t){const a=this.graph.nodes[e];a?.tags&&(a.tags=a.tags.filter(e=>e!==t))}deleteNode(e,t=!1){const a=this.graph;if(!a.nodes[e])return console.warn('[NodeMapService] 节点不存在:',e),!1;if(e===a.currentNode)return console.warn('[NodeMapService] 不能删除当前位置节点:',e),!1;if(t){const t=this.getDescendants(e);for(const e of t)e!==a.currentNode&&this.deleteNodeInternal(e)}return this.deleteNodeInternal(e),console.log('[NodeMapService] 已删除节点:',e),!0}getDescendants(e){const t=[],a=new Set,s=[...this.graph.edges[e]||[]];for(;s.length>0;){const e=s.shift();if(!a.has(e)){a.add(e),t.push(e);for(const t of this.graph.edges[e]||[])a.has(t)||s.push(t)}}return t}deleteNodeInternal(e){const t=this.graph;delete t.nodes[e],delete t.edges[e];for(const a of Object.keys(t.edges))t.edges[a]=t.edges[a].filter(t=>t!==e);if(t.edgeInfo)for(const a of Object.keys(t.edgeInfo))(a.startsWith(`${e}->`)||a.endsWith(`->${e}`))&&delete t.edgeInfo[a]}getNode(e){return this.graph.nodes[e]}canDeleteNode(e){return this.graph.nodes[e]?e===this.graph.currentNode?'不能删除当前位置':null:'节点不存在'}getChildCount(e){return this.getDescendants(e).length}findPathToNode(e){const t=this.graph,a=new Set;for(const e of Object.values(t.edges))for(const t of e)a.add(t);const s=Object.keys(t.nodes).filter(e=>!a.has(e));for(const t of s){const a=this.bfsPath(t,e);if(a)return a}return s.includes(e)?[e]:null}bfsPath(e,t){if(e===t)return[e];const a=this.graph,s=new Set,n=new Map,r=[e];for(s.add(e);r.length>0;){const e=r.shift();for(const l of a.edges[e]||[])if(!s.has(l)){if(s.add(l),n.set(l,e),l===t){const e=[];let a=t;for(;a;)e.unshift(a),a=n.get(a);return e}r.push(l)}}return null}layoutNodes(){const e=this.graph,t=[],a=new Map;for(const t of Object.values(e.nodes)){const e=t.depth??0;a.has(e)||a.set(e,[]),a.get(e).push(t)}return a.forEach((a,s)=>{const n=-(120*a.length)/2+60;a.forEach((a,r)=>{t.push({...a,x:n+120*r,y:80*s,isCurrent:a.id===e.currentNode})})}),t}layoutEdges(e){const t=this.graph,a=[],s=new Map;for(const t of e)s.set(t.id,t);for(const[e,n]of Object.entries(t.edges)){const r=s.get(e);if(r)for(const l of n){const n=s.get(l);if(!n)continue;const o=e===t.currentNode||l===t.currentNode;a.push({id:`${e}->${l}`,x1:r.x,y1:r.y,x2:n.x,y2:n.y,isCurrent:o})}}return a}getStats(){const e=this.graph,t=Object.keys(e.nodes).length;let a=0,s=0;for(const t of Object.values(e.edges))a+=t.length;for(const t of Object.values(e.nodes))t.depth>s&&(s=t.depth);return{nodeCount:t,edgeCount:a,maxDepth:s}}}const Ei={Body_Type:'体型',Pubic_Hair:'阴毛',Body_Hair:'体毛',Skin_Sensitivity:'皮肤敏感度',Oral_Sex:'口交次数',Manual_Sex:'手交次数',Footjob:'足交次数',Masturbation:'自慰次数',Anal_Intercourse:'肛交次数',Sexual_Orientation:'性取向',Kinks:'特殊癖好',Breast_Size:'胸部尺寸',Breast_Volume:'胸部容积',Breast_Shape:'胸部形状',Areola_Color:'乳晕颜色',Nipple_Sensitivity:'乳头敏感度',Vulva_Appearance:'外阴外观',Vulva_Color:'外阴颜色',Clitoris_Sensitivity:'阴蒂敏感度',Virginity_Status:'贞操状态',Hymen_Status:'处女膜状态',Pregnancy_Status:'怀孕状态',Gestation:'妊娠周数',Fertility:'生育能力',Vaginal_Intercourse:'阴道性交次数',Childbirth:'分娩次数',Abortion:'流产次数',Menstrual_Cycle:'月经周期',Penis_Length:'阴茎长度',Penis_Girth:'阴茎粗细',Penis_Shape:'阴茎形状',Foreskin_Status:'包皮状态',Testicle_Size:'睾丸大小',Scrotum_Appearance:'阴囊外观',Erectile_Function:'勃起功能',Ejaculation_Volume:'射精量',Refractory_Period:'不应期',Ejaculation_Count:'射精次数',Impregnation_Count:'使人怀孕次数',Dominant_Genitalia:'主导生殖器'};class $i{static STORAGE_KEY_PREFIX='game_prompts_';static PRESET_KEY_PREFIX='game_prompt_presets_';prompts=new Map;presets=new Map;constructor(){this.loadFromStorage()}loadFromStorage(){const e=['varMaintenance','textOptimization'];for(const t of e)try{const e=localStorage.getItem($i.STORAGE_KEY_PREFIX+t);e?this.prompts.set(t,JSON.parse(e)):this.prompts.set(t,this.getDefaultPrompts(t));const a=localStorage.getItem($i.PRESET_KEY_PREFIX+t);a?this.presets.set(t,JSON.parse(a)):this.presets.set(t,[])}catch(e){console.error(`Failed to load prompts for ${t}`,e),this.prompts.set(t,this.getDefaultPrompts(t)),this.presets.set(t,[])}}getDefaultPrompts(e){switch(e){case'varMaintenance':return[{id:'vm_core_system',name:'🔧 核心系统提示词',content:'# 工具AI - 游戏状态管理器\n\n你是一个游戏状态管理器，负责将剧情AI的输出转换为结构化的游戏数据。\n\n## 你的职责\n\n1. 解析剧情标签 - 从剧情AI的输出中提取 npcs, exits, objects 标签\n2. 分析剧情变化 - 从 content 中识别状态变化（HP/MP/金币/物品等）\n3. 生成结构化数据 - 输出 YAML 格式的 scene, patch 等标签\n\n## 重要注意事项\n\n1. 只输出变化 - 不要输出没有发生变化的状态\n2. 路径正确性 - 确保路径与当前GameState结构匹配\n3. 数值计算 - 使用 add 进行增减，不要假设当前值\n4. 物品ID - 使用小写下划线格式（如 potion_hp, iron_sword）\n5. NPC数据 - 必须包含 name, appearance, status, rel 四个必需字段\n\n## 输出格式\n\n请直接输出标签，不需要额外的解释文字。\n\n## 建议的思考顺序\n\n**第一步：检查状态栏中的relation.characters**\n- 查看是否有已提供的角色，他们都是关键关注或者好感度>50的角色\n- 如果剧情中涉及这些角色，**必须**更新他们的信息（好感度、状态、位置、新了解到的背景等）\n- 这是持久化角色档案，应当随剧情发展逐步完善\n\n**第二步：使用patch格式更新游戏状态**\n  1. 世界信息变化（时间、日期、天气、任务）\n  2. 场景信息变化（位置数组、场景描述、周围角色、出口、物品）\n  3. 玩家数据变更（资源(非战斗中消耗的hp、mp、sp)、物品、装备、当前状态、私密信息）\n  4. **人际关系更新**（relation.characters.{charId}的好感度、状态、背景等，见"人际关系更新规则"）\n\n**第三步：使用标签更新特殊数据**\n  5. 敌人信息（若有，用enemy标签包裹）\n  6. 商店信息（若有，用shop标签包裹）',enabled:!0,order:0,category:'核心',description:'工具AI的身份定义和核心职责说明'},{id:'vm_scene_rules',name:'🏠 场景更新规则',content:'## 场景更新\n\n场景数据通过 <patch> 标签更新，与其他状态变化一起处理。\n\n**注意**：npcs、objects、exits 使用**字典结构**（而非数组），键为名称。\n\n### 场景路径说明\n\n```yaml\nscene.locationPath      # 位置数组 ["国家/地理", "城市/领地", "建筑/地标", "楼层/位置", "房间(可选)"]\nscene.name              # 场景别名（可选）\nscene.desc              # 环境描述（20字以内）\nscene.npcs.{npcName}    # 单个NPC（字典，键为角色名）\nscene.objects.{objName} # 单个物品（字典，键为物品名）\nscene.exits.{exitName}  # 单个出口（字典，键为出口名）\n```\n\n### 场景更新示例\n\n```yaml\n<patch>\n# 切换位置时，整体设置 locationPath\n- path: scene.locationPath\n  set:\n    - 中立地带\n    - 四风集镇\n    - 铃兰酒馆\n    - 大厅\n\n- path: scene.name\n  set: 酒馆大厅\n\n- path: scene.desc\n  set: 热闹的酒馆大厅，空气中弥漫着麦酒香气   # 高度概括，限20字以内\n\n# 添加/更新单个NPC（使用 set 或 push ，标准化为以下键值对）\n- path: scene.npcs.老张\n  set:\n    name: 老张\n    appearance: 中年男人，油腻围裙，麻布衫，麻布短裤\n    personality: 友善健谈    # 可选\n    status: 正在擦拭酒杯\n    attitude: 中立    # 友好/中立/敌对。如果为敌对，立即生成enemy标签\n\n# 更新NPC状态\n- path: scene.npcs.老张.status\n  set: 笑着和xx角色打招呼\n\n# 添加可交互物品\n- path: scene.objects.布告栏\n  set:\n    name: 布告栏\n    brief: 贴满任务委托\n    interactable: true\n\n# 添加出口\n- path: scene.exits.酒馆二楼\n  set:\n    name: 酒馆二楼\n    direction: 上\n\n# 移除NPC（离开场景）\n- path: scene.npcs.流浪商人\n  remove: true\n</patch>\n```\n\n### NPC 必需字段\n\n| 字段 | 说明 | 示例 |\n|------|------|------|\n| name | 角色名（必需） | 老张 |\n| appearance | 外貌特征（必需） | 中年男性，围着白围裙 |\n| status | 当前状态（必需） | 正在擦拭酒杯 |\n| attitude | 态度（必需） | 友好/中立/敌对 |\n| personality | 性格（可选） | 友善健谈 |',enabled:!0,order:1,category:'场景',description:'场景数据通过patch更新的规范'},{id:'vm_patch_rules',name:'📊 状态更新规则 (patch)',content:'## 状态更新 <patch>\n\n仅当剧情中发生状态变化时输出。\n\n```yaml\n<patch>\n# 操作符：add(数值增减) set(直接设置) push(添加元素) remove(删除)\n\n- path: player.stats.hp.current\n  add: -25\n\n- path: inventory.wallet.ledger\n  add: -200\n\n- path: inventory.items.potion_hp.count\n  add: 5\n\n# 更新世界时间和天气\n- path: world.time\n  set: "14:00"\n\n- path: world.weather\n  set: "多云"\n</patch>\n```\n\n### 操作符说明\n\n| 操作符 | 用途 | 示例 |\n|--------|------|------|\n| add | 数值增减 | HP减少25: `add: -25` |\n| set | 直接设置 | 天气变化: `set: "下雨"` |\n| push | 添加元素 | 添加事迹: `push: "击败了哥布林首领"` |\n| remove | 删除元素 | 丢弃物品: `remove: true` |\n| cleanse | 净化减益 | 移除目标身上的debuff |\n| dispel | 驱散增益 | 移除目标身上的buff |\n\n### 装备操作特殊说明\n\n**重要**：装备槽位操作有自动保护机制\n\n- 使用 `set` 操作更换装备时，系统会**自动将旧装备放回背包**\n- **不需要**手动先卸下旧装备，直接 set 新装备即可\n- 如果要清空槽位，使用 `set: null` 或 `remove: true`\n\n```yaml\n# ✅ 正确：直接装备新武器（旧武器自动放回背包）\n- path: player.equipment.weapon_main\n  set:\n    name: 火焰剑\n    type: weapon\n    subtype: sword\n    attribute: fire\n    quality: rare\n    baseDamage: "1d8+2"\n\n# ❌ 错误：不要手动先放回背包再装备（会导致重复）\n# - path: inventory.items.iron_sword  # 多余操作！\n#   push: {...}\n- path: player.equipment.weapon_main\n  set: {...}\n\n# 清空装备槽位\n- path: player.equipment.weapon_main\n  set: null\n```',enabled:!0,order:2,category:'状态',description:'使用patch格式更新游戏状态'},{id:'vm_paths',name:'📍 可用路径参考',content:'## 可用路径\n\n```yaml\n# ========== 玩家 ==========\nplayer.stats.hp.current      # 当前HP\nplayer.stats.hp.max          # 最大HP\nplayer.stats.mp.current      # 当前MP\nplayer.stats.sp.current      # 当前SP\nplayer.base.level            # 等级\nplayer.base.exp.current      # 当前经验\nplayer.attributes.str        # 力量（同理dex/int/cha/con/wis，全部小写）\nplayer.attributes.spd        # 速度\nplayer.attributes.crit_rate  # 暴击率\nplayer.attributes.crit_dmg   # 暴击伤害\nplayer.attributes.ac         # 护甲等级\n\n# ========== 玩家外貌（固定特征，详见外貌信息规则）==========\nplayer.appearance.hair_color     # 发色\nplayer.appearance.hair_length    # 发长\nplayer.appearance.eye_color      # 瞳色\nplayer.appearance.height         # 身高\nplayer.appearance.body_build     # 体型\n\n# ========== 背包 ==========\ninventory.wallet.ledger      # 铜币（1金=10000铜，1银=100铜）\ninventory.items.{itemId}.count  # 物品数量\n\n# ========== 场景（详见场景更新规则）==========\n# scene.locationPath / scene.npcs.{name} / scene.objects / scene.exits\n\n# ========== 队友（数组按ID查找）==========\nallies.{allyId}.stats.hp.current  # 队友当前HP\nallies.{allyId}.stats.mp.current  # 队友当前MP\nallies.{allyId}.affinity          # 队友好感度\nallies.{allyId}.appearance.*      # 队友外貌（详见外貌信息规则）\n\n# ========== 关系（已星标角色）==========\nrelation.characters.{charId}     # 单个持久化角色\nrelation.characters.{charId}.rel # 好感度\nrelation.factions.{factionId}.rep # 势力声望\n\n# ========== 世界 ==========\nworld.time                   # 游戏内时间（如 "08:00" 或 "第3天 下午"）\nworld.weather                # 天气（如 "晴朗"、"下雨"、"暴风雪"）\nworld.canUseWorldMap         # 🆕 世界地图使用权限（暂未实装）\nworld.quests.{questId}.progress  # 任务进度\nworld.quests.{questId}.status    # 任务状态\n```\n\n### 🗺️ 世界地图权限 (world.canUseWorldMap)\n\n控制玩家是否可以使用世界地图功能进行自由旅行。\n\n**默认值**: `false`（暂未实装）\n\n**设置为 false 的情况**:\n- 玩家被囚禁/关押\n- 玩家被禁足/监管\n- 玩家无法独自离开当前位置（如城堡公主、被软禁等）\n- 剧情需要限制玩家行动范围\n\n**设置为 true 的情况**:\n- 玩家获得自由\n- 玩家逃脱成功\n- 限制解除\n- 剧情允许玩家自由行动\n\n**示例**:\n```yaml\n<patch>\n# 玩家被囚禁时\n- path: world.canUseWorldMap\n  set: false\n\n# 玩家获得自由后\n- path: world.canUseWorldMap\n  set: true\n</patch>\n```\n\n**注意**: 此字段仅影响世界地图功能，不影响场景内移动或与NPC对话。',enabled:!0,order:3,category:'路径',description:'GameState中可用的路径列表'},{id:'vm_appearance_rules',name:'👤 外貌信息规则',content:'## 外貌信息更新 (player.appearance.* / allies.{id}.appearance.*)\n\n**重要**：外貌信息仅记录**固定的长相特征**，不包含衣着/服饰（衣着属于临时状态，记录在 status_desc）。\n\n### 可用字段\n\n| 字段 | 说明 | 示例值 |\n|------|------|--------|\n| hair_color | 发色 | 银白色、黑色、金色、粉色 |\n| hair_length | 发长 | 短发、及肩、长发、及腰、超长 |\n| hair_style | 发型 | 马尾、双马尾、披肩、盘发、短碎发 |\n| eye_color | 瞳色 | 红瞳、蓝眸、金色、异色瞳 |\n| height | 身高 | 165cm、矮小、高挑 |\n| body_build | 体型 | 纤细、匀称、健壮、微胖、丰满 |\n| skin_tone | 肤色 | 白皙、小麦色、古铜色 |\n| face_features | 五官特点 | 柳叶眉、高鼻梁、厚唇 |\n| special_marks | 特殊标记 | 左眼下有泪痣、背部有刺青 |\n| racial_traits | 种族外貌 | 尖耳、兽耳、尾巴、翅膀 |\n\n### 更新示例\n\n```yaml\n<patch>\n# 设置玩家外貌（角色创建/首次描述时）\n- path: player.appearance.hair_color\n  set: "银白色"\n\n- path: player.appearance.hair_length\n  set: "及腰长发"\n\n- path: player.appearance.eye_color\n  set: "红瞳"\n\n- path: player.appearance.height\n  set: "168cm"\n\n- path: player.appearance.body_build\n  set: "纤细匀称"\n\n# 设置队友外貌\n- path: allies.ally_001.appearance.hair_color\n  set: "金色"\n\n- path: allies.ally_001.appearance.racial_traits\n  set: "精灵尖耳"\n\n# 外貌变化（染发、受伤留疤等）\n- path: player.appearance.hair_color\n  set: "染成粉色"\n\n- path: player.appearance.special_marks\n  set: "右脸有新伤疤"\n</patch>\n```\n\n### 注意事项\n\n1. **不要在此记录衣着** - 衣着是临时状态，使用 `player.base.status_desc`\n2. **仅在变化时更新** - 外貌通常是固定的，只在明确变化时才更新\n3. **种族特征** - 尖耳、兽耳等记录在 `racial_traits`\n4. **与私密信息区分** - 体型细节（如胸围）属于私密信息，不在此记录',enabled:!0,order:4,category:'外貌',description:'固定外貌特征的维护规则（发色、瞳色、身高等）'},{id:'vm_shop_rules',name:'🛒 商店数据规则',order:5,content:'## 商店数据 <shop>\n\n当检测到商店交互时输出。\n\n**重要**：\n1. 商品使用**对象结构**（物品ID作为键）\n2. 商品必须是**完整的物品对象**（包含type、subtype、effects等，详见物品规范）\n3. 商品的price和stock字段是商店专用字段\n\n```yaml\n<shop>\nmerchant_id: tavern_keeper_zhang\nmerchant_name: 老张\nbuy_rate: 1.0      # 购买价格倍率\nsell_rate: 0.5     # 出售价格倍率\nitems:              # 商品使用对象结构（ID作为键）\n  potion_hp:        # 物品ID作为外层键\n    name: 治疗药水\n    type: consumable\n    subtype: potion\n    quality: common\n    desc: 恢复50点生命值\n    price: 50       # 商店售价（铜币）\n    stock: 10       # 库存数量（-1表示无限）\n    count: 1        # 购买时获得的数量\n    effects:        # 物品效果（必需）\n      - trigger: immediate\n        action: heal\n        target: self\n        value: 50\n        tags: [hp]\n  bread:\n    name: 面包\n    type: consumable\n    subtype: food_bread\n    quality: common\n    desc: 恢复10点生命值\n    price: 5\n    stock: 20\n    count: 1\n    effects:\n      - trigger: immediate\n        action: heal\n        target: self\n        value: 10\n        tags: [hp]\n  iron_sword:       # 装备示例\n    name: 铁剑\n    type: weapon\n    subtype: sword\n    attribute: steel\n    quality: common\n    desc: 普通的铁制长剑\n    price: 500\n    stock: 3\n    count: 1\n    baseDamage: "1d8"\n    effects:\n      - trigger: passive\n        action: buff\n        target: self\n        statusName: 武器加成\n        duration: -1\n        modifiers:\n          str: 1\n</shop>\n```\n\n### 商店字段说明\n\n| 字段 | 说明 | 示例 |\n|------|------|------|\n| merchant_id | 商人ID | tavern_keeper_zhang |\n| merchant_name | 商人名称 | 老张 |\n| buy_rate | 购买价格倍率 | 1.0 (原价), 1.2 (涨价20%) |\n| sell_rate | 出售价格倍率 | 0.5 (半价), 0.7 (7折) |\n| items | 商品对象（ID作为键） | 见上方示例 |\n\n### 商品必需字段\n\n每个商品必须包含以下字段（完整物品结构）：\n\n| 字段 | 说明 | 必需 | 参考 |\n|------|------|------|------|\n| name | 物品名称 | ✓ | 物品规范 |\n| type | 物品类型 | ✓ | weapon/armor/consumable/material等 |\n| subtype | 子类型（决定图标） | ✓ | 见物品规范的图标对照表 |\n| quality | 品质 | 推荐 | common/uncommon/rare/epic等 |\n| desc | 物品描述 | 推荐 | 简短描述 |\n| price | 商店售价（铜币） | ✓ | 商店专用字段 |\n| stock | 库存数量 | ✓ | -1表示无限 |\n| count | 购买获得数量 | ✓ | 通常为1 |\n| effects | 物品效果 | 消耗品/装备必需 | 见技能详细规范 |\n| attribute | 元素/风格属性 | 装备推荐 | 决定图标列 |\n| baseDamage | 武器基础伤害 | 武器必需 | 如"1d8+2" |\n\n### 注意事项\n\n1. **完整物品数据**：商品必须包含完整的物品字段（type、subtype、effects等），不能只有name和price\n2. **效果必需**：消耗品和装备必须有effects字段，否则无法使用\n3. **图标显示**：subtype和attribute决定物品图标，必须使用物品规范中的有效值\n4. **物品详情**：完整的物品字段说明和效果编写规则请参考"物品完整规范"和"技能详细规范"',enabled:!0,category:'商店',description:'商店数据的YAML格式规范'},{id:'vm_enemy_rules',name:'⚔️ 敌人数据规则',order:6,content:'## 敌人数据 <enemy>\n\n当检测到\'战斗遭遇\'或\'潜在战斗\'时输出。\n\n**重要**：\n1. 使用**team结构**组织在场的所有npc（仅玩家队内队友除外），支持多阵营战斗\n2. 每个team可以独立设置immediate标记\n3. 敌人和技能都使用字典结构（ID作为键）\n4. loot放在每个enemy内部（而非team级别）\n\n```yaml\n<enemy>\nteam1:                    # 阵营1（玩家的敌对方）\n  immediate: true         # true=敌对 false=中立/友好\n  enemy:                  # 该阵营的敌人字典\n    goblin_001:           # 敌人ID作为键（不需要id字段）\n      name: 哥布林斥候\n      race: beast         # 种族类型（影响抗性）\n      level: 3\n      stats:\n        hp: { current: 30, max: 30 }\n        mp: { current: 0, max: 0 }\n        sp: { current: 100, max: 100 }\n      attributes:\n        str: 8\n        dex: 12\n        con: 8\n        int: 4\n        wis: 4\n        cha: 4\n        spd: 10\n      skills:             # 技能字典（ID作为键），实例中杂兵/精英/BOSS至少0/2/3个技能\n        goblin_slash:     # 技能ID\n          name: 劈砍\n          type: active\n          tier: 1         # 1:杂兵 2:精英 3:Boss\n          tags: [physical, melee]\n          cost: { sp: 20 }\n          cooldown: 0\n          target: single_enemy\n          effects:\n            - trigger: immediate\n              action: damage\n              target: target\n              value: "1d6+str"\n              tags: [slashing]\n      loot:               # 掉落物字典（每个enemy独立），若为空对象则表示无掉落物\n        mat_goblin_ear:   # 物品ID作为键\n          name: 哥布林耳朵\n          type: material\n          subtype: monster_organ\n          quality: common\n          count: 1\n          value: 5\n          desc: 可以作为任务证明或出售\n    goblin_002:\n      name: 哥布林战士\n      race: beast\n      level: 4\n      # ... 其他字段同上\nteam2:                    # 阵营2（场景的第二个npc阵营）\n  immediate: false        # 中立/友好\n  enemy:\n    wolf_001:\n      name: 野狼\n      race: beast\n      level: 2\n      # ... 其他字段\nteam3:\n  # ... 以此类推\n</enemy>\n```\n\n### 种族类型 (race)\n\n| race | 中文 |\n|------|------|\n| human | 人类 |\n| elf | 精灵 |\n| dwarf | 矮人 |\n| orc | 兽人 |\n| undead | 亡灵 |\n| demon | 恶魔 |\n| angel | 天使 |\n| dragon | 龙族 |\n| beast | 野兽 |\n| elemental | 元素生物 |\n| construct | 构造体 |\n| plant | 植物 |\n| slime | 史莱姆 |\n| spirit | 幽灵 |\n| aberration | 异怪 |\n\n### 使用说明\n\n- **单阵营战斗**：只需定义team1即可\n- **多阵营战斗**：定义team1、team2等，同阵营敌人会协同作战\n- **immediate标记**：true时显示战前弹窗（可选择战斗或逃跑），false时暂存等待玩家主动攻击\n- **loot设计**：每个enemy独立拥有loot配置，击败后按概率掉落\n',enabled:!0,category:'战斗',description:'敌人数据的YAML格式规范（team结构）'},{id:'vm_ally_rules',name:'👥 队友创建规则',order:7,content:'## 队友数据创建\n\n当检测到\'角色加入队伍\'、\'招募队友\'或类似剧情时，使用 <patch> 标签直接添加到 allies 字典。\n\n**重要**：\n- 队友数据通过 **patch 操作**添加到 `allies.{allyId}` 路径\n- 技能使用**对象结构**（与玩家、敌人相同，技能ID作为键）\n- 装备必须齐全（对应具体穿着），但不一定需要复杂效果和详细desc\n- 私密信息结构与玩家完全相同\n\n### 添加队友示例\n\n```yaml\n<patch>\n# 添加一个新队友到 allies 字典\n- path: allies.ally_elara\n  set:\n    name: 艾丽娅\n    race: 精灵\n    class: 战士\n    level: 5\n    gender: 女\n    avatar: 🧝\n    appearance:\n      hair_color: 银白色\n      hair_length: 及腰长发\n      hair_style: 披肩\n      eye_color: 翠绿色\n      height: 168cm\n      body_build: 纤细匀称\n      skin_tone: 白皙\n      racial_traits: 尖耳\n    allyType: 同伴\n    affinity: 50\n    relationship: 冒险伙伴\n    stats:\n      hp: { current: 80, max: 80 }\n      mp: { current: 20, max: 20 }\n      sp: { current: 60, max: 60 }\n    attributes:\n      str: 14\n      dex: 12\n      con: 13\n      int: 10\n      wis: 11\n      cha: 10\n      spd: 10\n      crit_rate: 5\n      crit_dmg: 150\n      ac: 12\n    equipment:\n      weapon_main:\n        name: 精钢长剑\n        type: weapon\n        subtype: sword\n        attribute: steel\n        quality: uncommon\n        baseDamage: "1d8+2"\n      upper:\n        name: 强化皮甲\n        type: armor\n        subtype: top_female\n        attribute: leather\n      lower:\n        name: 旅行裤\n        type: armor\n        subtype: pant_long\n        attribute: adventurer\n      shoes:\n        name: 皮靴\n        type: armor\n        subtype: boot_heavy\n        attribute: leather\n    skills:\n      skill_basic_attack:\n        name: 普通攻击\n        type: active\n        tier: 1\n        tags: [physical, melee]\n        cost: { sp: 10 }\n        cooldown: 0\n        target: single_enemy\n        effects:\n          - trigger: immediate\n            action: damage\n            target: target\n            value: "1d8+str"\n            tags: [slashing]\n    private:\n      Body_Type: 少女\n      Breast_Size: B\n      Breast_Volume: 普乳\n      Virginity_Status: 处女\n\n# 如果需要添加第二个队友，继续添加\n- path: allies.ally_marcus\n  set:\n    name: 马库斯\n    race: 人类\n    class: 法师\n    level: 4\n    gender: 男\n    # ... 其他字段\n</patch>\n```\n\n\n\n### 队友字段说明\n```yaml\nname: 艾丽娅              # 角色名（必需）\nrace: 精灵                # 种族\nclass: 战士               # 职业\nlevel: 5                  # 等级\ngender: 女                # 性别（女/男/扶她/未知）\navatar: 🧝               # 头像（可选，推荐使用emoji）\n\n# ===== 外貌特征（固定长相，不含衣着）=====\nappearance:\n  hair_color: 银白色\n  hair_length: 及腰长发\n  hair_style: 披肩\n  eye_color: 翠绿色\n  height: 168cm\n  body_build: 纤细匀称\n  skin_tone: 白皙\n  face_features: 柳叶眉，琼鼻樱唇    # 可选\n  special_marks: 右肩有蔷薇纹身      # 可选\n  racial_traits: 尖耳               # 种族特征\n\n# ===== 队友特有字段 =====\nallyType: 同伴       # 同伴/雇佣兵/临时队友/召唤物/...(任意中文字符串)\naffinity: 50              # 好感度 (-100 ~ 999)\nrelationship: 冒险伙伴    # 与玩家的关系描述\npersonality: 勇敢、正义   # 性格特点（可选）\nbackground: 来自精灵王国的流亡战士  # 背景故事（可选）\n\n# ===== 战斗属性 =====\nstats:\n  hp: { current: 80, max: 80 }\n  mp: { current: 20, max: 20 }\n  sp: { current: 60, max: 60 }\n\n# ===== 必需属性（六维 + spd + 双爆 + ac，全部小写）=====\nattributes:\n  str: 14        # 力量\n  dex: 12        # 敏捷\n  con: 13        # 体质\n  int: 10        # 智力\n  wis: 11        # 感知\n  cha: 10        # 魅力\n  spd: 10        # 速度（影响行动顺序）\n  crit_rate: 5   # 暴击率（%）\n  crit_dmg: 150  # 暴击伤害（%）\n  ac: 12         # 护甲等级\n\n# ===== 装备（必须齐全，对应穿着，可带效果）=====\nequipment:\n  weapon_main:\n    name: 精钢长剑\n    type: weapon\n    subtype: sword\n    attribute: steel\n    quality: uncommon\n    baseDamage: "1d8+2"\n    effects:\n      - trigger: passive\n        action: buff\n        target: self\n        duration: -1\n        modifiers:\n          str: 1\n  head:\n    name: 皮质头带\n    type: armor\n    subtype: hat\n    attribute: leather\n  outer:\n    name: 冒险者斗篷\n    type: armor\n    subtype: cloak\n    attribute: adventurer\n    quality: common\n    effects:\n      - trigger: passive\n        action: buff\n        target: self\n        duration: -1\n        modifiers:\n          dex: 1\n  upper:\n    name: 强化皮甲\n    type: armor\n    subtype: top_female\n    attribute: leather\n    quality: uncommon\n    effects:\n      - trigger: passive\n        action: buff\n        target: self\n        duration: -1\n        modifiers:\n          ac: 2\n  underwear:\n    name: 棉质胸衣\n    type: armor\n    subtype: lingerie_top\n    attribute: common\n  underpants:\n    name: 棉质内裤\n    type: armor\n    subtype: underpants_female\n    attribute: common\n  lower:\n    name: 旅行裤\n    type: armor\n    subtype: pant_long\n    attribute: adventurer\n  socks:\n    name: 棉袜\n    type: armor\n    subtype: sock_short\n    attribute: common\n  shoes:\n    name: 皮靴\n    type: armor\n    subtype: boot_heavy\n    attribute: leather\n    quality: common\n    effects:\n      - trigger: passive\n        action: buff\n        target: self\n        statusName: 行者之靴\n        duration: -1\n        modifiers:\n          spd: 3\n  accessory_1:\n    name: 守护戒指\n    type: accessory\n    subtype: ring\n    attribute: standard\n    quality: uncommon\n    effects:\n      - trigger: passive\n        action: buff\n        target: self\n        statusName: 守护祝福\n        duration: -1\n        modifiers:\n          hp_max: 10\n          con: 1\n\n# ===== 技能（队友使用对象结构，与玩家/敌人相同）=====\nskills:\n  skill_basic_attack:         # 🆕 技能ID作为键（对象结构）\n    name: 劈砍\n    type: active\n    tier: 1\n    tags: [physical, melee]\n    cost: { sp: 10 }\n    cooldown: 0\n    target: single_enemy\n    effects:\n      - trigger: immediate\n        action: damage\n        target: target\n        value: "1d8+str"\n        tags: [slashing]\n  skill_shield_bash:          # 🆕 技能ID作为键（对象结构）\n    name: 盾击\n    type: active\n    tier: 1\n    tags: [physical, melee, stun]\n    cost: { sp: 25 }\n    cooldown: 2\n    target: single_enemy\n    effects:\n      - trigger: immediate\n        action: damage\n        target: target\n        value: "1d6+str"\n        tags: [bludgeoning]\n      - trigger: on_hit\n        action: debuff\n        target: target\n        statusName: 眩晕\n        duration: 1\n        chance: 40\n\n# ===== 私密信息（与玩家相同结构）=====\nprivate:\n  Body_Type: 少女\n  Breast_Size: B\n  Breast_Volume: 普乳\n  Vulva_Appearance: 馒头型\n  Vulva_Color: 粉色\n  Virginity_Status: 处女\n  Hymen_Status: 完整\n  Sexual_Orientation: 异性恋\n  Pubic_Hair: 稀疏\n  # 男性角色使用以下字段\n  # Penis_Length: 15cm\n  # Foreskin_Status: 未割\n  # Virginity_Status: 童贞\n</ally>\n```\n\n### 必需装备槽位\n\n队友的装备对应其具体穿着，必须配置以下槽位：\n\n| 槽位 | 说明 | 必需 |\n|------|------|------|\n| weapon_main | 主手武器 | ✓ |\n| weapon_off | 副手/盾牌 | 可选 |\n| head | 头部 | 可选 |\n| outer | 外套/披风 | 可选 |\n| upper | 上装 | ✓ |\n| underwear | 内衣 | 可选 |\n| underpants | 内裤 | 可选 |\n| lower | 下装 | ✓ |\n| socks | 袜子 | 可选 |\n| shoes | 鞋子 | ✓ |\n| hands | 手部/手套 | 可选 |\n| accessory_1 | 饰品1 | 可选 |\n| accessory_2 | 饰品2 | 可选 |\n| accessory_3 | 饰品3 | 可选 |\n\n### 装备简化规则\n\n**注意**：装备槽位中**不需要 count 字段**（装备不是堆叠物品）\n\n队友装备可以简单配置，也可以添加被动效果：\n```yaml\nequipment:\n  upper:                   # 使用正确的槽位名\n    name: 丝绸长裙         # 名称（必需）\n    type: armor            # 类型（必需）\n    subtype: coat          # 子类型，决定图标（必需）\n    attribute: silk        # 风格，决定图标列（可选）\n    quality: rare          # 品质（可选）\n    # 可选：desc, effects, value 等\n    effects:               # 装备效果（可选）\n      - trigger: passive\n        action: buff\n        target: self\n        statusName: 丝绸优雅\n        duration: -1\n        modifiers:\n          cha: 2\n```\n\n### 私密信息字段参考\n\n**女性角色常用**:\n- Body_Type: 幼女/萝莉/少女/御姐/熟女\n- Breast_Size: AA-Z杯\n- Breast_Volume: 微乳/普乳/巨乳/爆乳/豪乳/超乳\n- Virginity_Status: 处女/非处女\n- Vulva_Appearance: 馒头型/蝴蝶型/水滴型\n\n**男性角色常用**:\n- Body_Type: 幼儿/正太/少年/青壮/中年\n- Penis_Length: Xcm\n- Foreskin_Status: 未割\n- Virginity_Status: 童贞/非童贞\n\n### 外貌字段对照\n\n| 字段 | 说明 | 示例 |\n|------|------|------|\n| hair_color | 发色 | 银白色、黑色、金色 |\n| hair_length | 发长 | 短发、及肩、长发、及腰 |\n| hair_style | 发型 | 马尾、双马尾、披肩 |\n| eye_color | 瞳色 | 红瞳、蓝眸、异色瞳 |\n| height | 身高 | 165cm、矮小、高挑 |\n| body_build | 体型 | 纤细、匀称、健壮 |\n| skin_tone | 肤色 | 白皙、小麦色 |\n| face_features | 五官 | 柳叶眉、高鼻梁 |\n| special_marks | 特殊标记 | 泪痣、纹身、疤痕 |\n| racial_traits | 种族特征 | 尖耳、兽耳、尾巴 |\n',enabled:!0,category:'队友',description:'队友创建的完整YAML格式规范'},{id:'vm_skill_rules',name:'🎯 技能详细规范',order:8,content:'## 技能编写指南\n\n        **⚠️ 重要**：\n        1. 所有技能使用**对象结构**，技能ID作为键\n        2. 所有枚举值必须使用**英文小写**，不要使用中文！\n\n        ### 技能基础结构（对象格式）\n\n        ```yaml\n        skills:                   # 🆕 技能集合使用对象结构\n          <skillId>:              # 🆕 技能ID作为外层键\n            name: string          # 显示名称\n            type: active | passive  # 主动技能 / 被动技能\n            tier: 1 | 2 | 3         # 强度：1杂兵 2精英 3Boss\n            tags: [physical, fire, ...]  # 必须用英文标签\n\n            # 主动技能必需\n            cost: { mp: 数值, sp: 数值 }  # 消耗\n            cooldown: 数值                # 冷却回合\n            target: string                # 目标类型（见下表）\n\n            effects: [...]          # 效果列表\n        ```\n\n        ### ID使用规则\n\n        | 操作 | 使用的ID格式 | 示例 |\n        |------|-------------|------|\n        | 操作**已有**技能 | 用你看到的ID | `skill_01, skill_02...` |\n        | 添加**新**技能 | 用语义化ID | `fireball, heal...` |\n\n        **说明**：\n        - 你看到的玩家技能使用 `skill_01, skill_02...` 格式\n        - 添加新技能时请用语义化ID（如 `fireball`），系统会自动转换\n        - 同名技能会自动处理，无需考虑ID冲突\n\n### 效果(Effect)编写\n\n```yaml\neffect:\n  # === 必需字段 ===\n  trigger: string         # 触发时机（见下表）\n  action: string          # 效果类型（见下表）\n  target: string          # 目标（见下表）\n\n  # === 通用可选字段 ===\n  value?: string | number # 数值（支持骰子表达式如 "2d6+str"；通用占位符 "5%_max"/"10%_cur"/"15%_missing" 默认为HP）\n  tags?: string[]         # 标签数组（支持别名自动转换）\n                          # - damage效果：伤害类型标签（如 fire, ice, slashing 等）\n                          # - heal效果：资源类型 [hp/mp/sp] + 可选描述标签（如 [hp, light, holy]）\n                          # - 其他效果：描述性标签（如 buff, debuff, stun 等）\n                          # 鼓励使用丰富的标签组合来描述效果特性，系统会自动过滤和标准化\n  chance?: number         # 触发概率 (0-100，默认100)\n  persistent?: boolean    # 🆕 是否永久生效（用于 buff，战斗胜利后写入属性）\n  description?: string    # 效果描述（用于UI展示）\n  lifesteal?: number      # 吸血百分比（造成伤害后按百分比恢复HP）\n\n  # === 状态效果专用（buff/debuff）===\n  statusName?: string     # 状态名称（可选）\n  duration?: number       # 持续回合（-1=永久）\n  stacks?: number         # 叠加层数（默认1）\n  maxStacks?: number      # 最大层数\n  modifiers?: object      # 属性修正 { str: 3, ac: 2, lifesteal: 10 }\n  dot?: string | number   # 每回合伤害（支持骰子表达式如 "1d6+int" 或百分比 "5%_max"）\n  hot?: string | number   # 每回合治疗（支持骰子表达式如 "1d6+wis" 或百分比 "3%_max"）\n\n  # === 特殊效果专用 ===\n  shieldValue?: string | number  # 护盾数值（shield必需，支持骰子表达式如 "2d6+con"）\n  shieldMode?: \'hp\' | \'hits\'  # hp=数值盾 / hits=次数盾\n  advancePercent?: number # 拉条百分比（advance必需）\n  delayPercent?: number   # 推条百分比（delay必需）\n  reviveHpPercent?: number # 复活血量百分比（revive，默认20）\n  summonId?: string       # 召唤物模板ID\n  summonCount?: number    # 召唤数量（默认1）\n```\n\n### 触发时机(trigger) - 共11个\n\n| trigger | 说明 | 使用场景 |\n|---------|------|----------|\n| `immediate` | 立即执行 | 主动技能直接效果 |\n| `passive` | 被动常驻 | 装备属性加成 |\n| `on_hit` | 命中时 | 武器附加效果（普攻触发） |\n| `on_damage` | 造成伤害后 | 吸血治疗、击杀判定 |\n| `on_hurt` | 受到伤害时 | 受伤反击、进化 |\n| `on_kill` | 击杀时 | 击杀恢复、吞噬 |\n| `on_death` | 死亡时 | 遗言效果 |\n| `turn_start` | 回合开始 | 被动光环、DOT结算 |\n| `turn_end` | 回合结束 | HOT结算、状态结算 |\n| `battle_start` | 战斗开始 | 开局buff |\n| `battle_end` | 战斗结束 | 结算效果（永久属性提升） |\n\n### 效果类型(action) - 共12个\n\n| action | 说明 | 必需字段 |\n|--------|------|----------|\n| `damage` | 伤害 | value（支持通用占位符如"5%_max"默认HP）, tags（伤害类型） |\n| `heal` | 治疗 | value（支持通用占位符）, tags:[hp/mp/sp]指定恢复资源 |\n| `buff` | 增益状态 | statusName, duration |\n| `debuff` | 减益状态 | statusName, duration |\n| `shield` | 护盾 | shieldValue |\n| `cleanse` | 净化debuff | count(可选) |\n| `dispel` | 驱散buff | count(可选) |\n| `advance` | 拉条 | advancePercent |\n| `delay` | 推条 | delayPercent |\n| `summon` | 召唤 | summonId |\n| `revive` | 复活 | reviveHpPercent |\n| `extra_turn` | 额外回合 | - |\n\n### 技能目标类型(target) - 共7个\n\n| target | 说明 |\n|--------|------|\n| `single_enemy` | 敌方单体 |\n| `all_enemies` | 敌方全体 |\n| `single_ally` | 友方单体 |\n| `all_allies` | 友方全体 |\n| `self` | 自身 |\n| `random_enemy` | 随机敌方 |\n| `random_ally` | 随机友方 |\n\n### 效果目标类型(effect.target) - 共6个\n\n| target | 说明 |\n|--------|------|\n| `self` | 自身 |\n| `target` | 技能选中的目标 |\n| `all_enemies` | 所有敌人 |\n| `all_allies` | 所有友方 |\n| `random_enemy` | 随机敌人 |\n| `random_ally` | 随机友方 |\n\n### DOT/HOT 扁平化写法\n\n使用 `dot` 和 `hot` 字段直接指定每回合伤害/治疗，支持骰子表达式和百分比：\n\n```yaml\n# 灼烧 DOT（固定数值）\neffects:\n  - trigger: on_hit\n    action: debuff\n    target: target\n    statusName: 灼烧\n    duration: 3\n    dot: 5        # 每回合5点伤害\n    tags: [fire]  # 伤害类型\n\n# 灼烧 DOT（骰子表达式）\neffects:\n  - trigger: on_hit\n    action: debuff\n    target: target\n    statusName: 灼烧\n    duration: 3\n    dot: "1d6+int"  # 每回合1d6+智力点伤害\n    tags: [fire]\n\n# 再生 HOT（固定数值）\neffects:\n  - trigger: immediate\n    action: buff\n    target: self\n    statusName: 再生\n    duration: 3\n    hot: 10\n    tags: [hp]    # 每回合10点治疗\n\n# 巨魔再生 HOT（百分比）\neffects:\n  - trigger: passive\n    action: buff\n    target: self\n    statusName: 巨魔再生\n    duration: -1\n    hot: "3%_max"\n    tags: [hp]   # 每回合恢复3%最大HP\n```\n\n### 属性修正 (modifiers)\n\n使用 `modifiers` 对象，键名必须使用英文小写：\n\n```yaml\nmodifiers:\n  str: 3         # 力量+3\n  dex: 2         # 敏捷+2\n  hp_max: 25     # HP上限+25\n  crit_rate: 5   # 暴击率+5%\n  fire_res: 20   # 火焰抗性+20%\n```\n\n**有效的 modifiers 键**：\n- **基础属性**: str, dex, con, int, wis, cha, ac, spd\n- **资源上限**: hp_max, mp_max, sp_max\n- **战斗属性**: crit_rate, crit_dmg, hitrate, dodgerate, damage, defense, attack\n- **吸血/治疗**: lifesteal (吸血百分比), heal_bonus (治疗加成), heal_received (受疗加成)\n- **伤害加成**: physical_dmg, magic_dmg, fire_dmg, ice_dmg, lightning_dmg, dark_dmg, light_dmg\n- **抗性**: all_res, physical_res, magic_res, fire_res, ice_res, lightning_res, dark_res, light_res\n\n### 常用标签速查 (tags)\n\n**标签别名系统**：系统支持标签别名自动转换，例如 `cold`、`frost`、`freeze` 都会被转换为核心标签 `ice`。你可以使用任意常见的同义词，系统会自动标准化。\n\n**🔥 伤害类型标签**（用于 effect.tags，影响增伤/抗性计算）:\n\n| 核心标签 | 别名 | 说明 |\n|---------|------|------|\n| physical | - | 物理（父类） |\n| slashing | slash, cut | 斩击 |\n| bludgeoning | blunt, crush | 钝击 |\n| piercing | pierce, stab | 穿刺 |\n| fire | flame, burn, burning | 火焰 |\n| ice | cold, frost, freeze, frozen | 冰霜 |\n| lightning | thunder, electric, shock | 雷电 |\n| water | aqua | 水 |\n| earth | ground, rock, stone | 土 |\n| wind | air, gust | 风 |\n| nature | plant, wood | 自然 |\n| light | radiant, sacred, divine | 光明 |\n| dark | shadow, necrotic | 暗影 |\n| poison | acid, toxic, venom | 毒素 |\n| psychic | mental, mind | 心灵 |\n| force | - | 力场 |\n| arcane | - | 奥术 |\n| void | - | 虚空 |\n| true | - | 真实（无视防御） |\n| time | temporal, chrono | 时间 |\n| space | spatial, dimension | 空间 |\n| gravity | - | 重力 |\n| blood | blood_magic, hemomancy | 血液 |\n| curse | cursed, hex | 诅咒 |\n| holy | blessed, consecrated | 神圣 |\n| chaos | chaotic, entropy | 混沌 |\n| order | lawful | 秩序 |\n| life | vitality | 生命 |\n| death | mortality, necro | 死亡 |\n| dream | - | 梦境 |\n| reality | - | 现实 |\n| emotion | - | 情感 |\n| concept | - | 概念 |\n\n**✨ 效果类型标签**:\n\n| 核心标签 | 别名 | 说明 |\n|---------|------|------|\n| heal | healing | 治疗 |\n| buff | - | 增益 |\n| debuff | - | 减益 |\n| dot | - | 持续伤害 |\n| hot | - | 持续治疗 |\n| stun | - | 眩晕 |\n| silence | - | 沉默 |\n| blind | - | 致盲 |\n| slow | - | 减速 |\n| root | - | 定身 |\n| charm | - | 魅惑 |\n| fear | - | 恐惧 |\n| taunt | - | 嘲讽 |\n| bleed | - | 流血 |\n| cleanse | purify | 净化 |\n| dispel | - | 驱散 |\n| revive | - | 复活 |\n| summon | - | 召唤 |\n| dodge | - | 闪避 |\n| block | parry | 格挡 |\n\n**🎯 技能分类标签**:\nmelee, ranged, defensive, support, aoe, passive, active\n\n### 标签使用建议\n\n**伤害效果标签组合示例**：\n- 物理+元素：`[slashing, fire]` - 火焰斩击\n- 多元素：`[fire, lightning]` - 火雷双属性\n- 特殊概念：`[psychic, dream]` - 梦境心灵攻击\n- 混合伤害：`[physical, dark, curse]` - 诅咒暗影物理攻击\n\n**治疗效果标签组合示例**：\n- 基础治疗：`[hp]` - 恢复生命\n- 神圣治疗：`[hp, light, holy]` - 神圣光明治疗\n- 自然治疗：`[hp, nature, life]` - 自然生命治疗\n- 多资源：`[hp, mp]` - 同时恢复生命和魔力\n\n**状态效果标签组合示例**：\n- 控制效果：`[stun, lightning]` - 雷电眩晕\n- 持续伤害：`[dot, fire, burn]` - 火焰灼烧\n- 增益效果：`[buff, holy, light]` - 神圣光明祝福\n\n**注意**：\n- 系统会自动过滤无效标签，只保留有效的核心标签\n- 别名会自动转换为核心标签（如 cold → ice）\n- 多个标签可以组合使用，增强描述性和视觉效果\n\n### 技能示例（对象结构）\n\n```yaml\n# 🆕 技能使用对象结构，ID作为键\nskills:\n  basic_attack:           # 🆕 技能ID作为键\n    name: 普通攻击\n    type: active\n    tier: 1\n    tags: [physical, melee]\n    cost: { sp: 10 }\n    cooldown: 0\n    target: single_enemy\n    effects:\n      - trigger: immediate\n        action: damage\n        target: target\n        value: "1d6+str"\n        tags: [slashing]\n\n  fireball:               # 🆕 AOE火球（带DOT - 使用扁平化dot字段）\n    name: 火球术\n    type: active\n    tier: 2\n    tags: [magic, fire]\n    cost: { mp: 15 }\n    cooldown: 2\n    target: all_enemies\n    effects:\n      - trigger: immediate\n        action: damage\n        target: all_enemies\n        value: "2d6+int"\n        tags: [fire]\n      - trigger: on_hit\n        action: debuff\n        target: target\n        statusName: 灼烧\n        duration: 3\n        dot: 5           # 每回合5点火焰伤害\n        tags: [fire]\n        chance: 30\n\n  heal:                   # 🆕 治疗术\n    name: 治疗术\n    type: active\n    tier: 1\n    tags: [magic, healing]\n    cost: { mp: 10 }\n    cooldown: 1\n    target: single_ally\n    effects:\n      - trigger: immediate\n        action: heal\n        target: target\n        value: "2d4+wis"\n        tags: [hp]\n\n  troll_blood:            # 🆕 百分比回血被动（巨魔血统）\n    name: 巨魔血统\n    type: passive\n    tier: 2\n    tags: [nature, heal]\n    effects:\n      - trigger: turn_start\n        action: heal\n        target: self\n        value: "5%_max"       # 🆕 通用占位符，由tags决定资源类型\n        tags: [hp]            # 恢复HP（可多选如 [hp, mp] 同时恢复）\n\n  mana_siphon:            # 🆕 多资源恢复示例\n    name: 魔力虹吸\n    type: passive\n    tier: 2\n    tags: [arcane]\n    effects:\n      - trigger: on_kill\n        action: heal\n        target: self\n        value: "10%_missing"  # 🆕 恢复已损失值的10%\n        tags: [hp, mp]        # 同时恢复HP和MP\n\n  barrier:                # 🆕 护盾术\n    name: 护盾术\n    type: active\n    tier: 1\n    tags: [magic, defense]\n    cost: { mp: 15 }\n    cooldown: 2\n    target: single_ally\n    effects:\n      - trigger: immediate\n        action: shield\n        target: target\n        shieldValue: "2d6+con"  # 支持骰子表达式\n        shieldMode: hp    # hp=数值盾 / hits=次数盾\n\n  battle_cry:             # 🆕 增益Buff\n    name: 战吼\n    type: active\n    tier: 2\n    tags: [physical, buff]\n    cost: { sp: 25 }\n    cooldown: 3\n    target: all_allies\n    effects:\n      - trigger: immediate\n        action: buff\n        target: all_allies\n        statusName: 战意昂扬\n        duration: 3\n        modifiers:\n          str: 3\n          crit_rate: 10\n\n  quick_step:             # 🆕 拉条技能\n    name: 疾步\n    type: active\n    tier: 1\n    tags: [physical]\n    cost: { sp: 20 }\n    cooldown: 2\n    target: single_ally\n    effects:\n      - trigger: immediate\n        action: advance\n        target: target\n        advancePercent: 50\n\n  summon_skeleton:        # 🆕 召唤技能\n    name: 召唤骷髅\n    type: active\n    tier: 2\n    tags: [dark, summon]\n    cost: { mp: 25 }\n    cooldown: 4\n    target: self\n    effects:\n      - trigger: immediate\n        action: summon\n        target: self\n        summonId: skeleton_warrior\n        summonCount: 1\n\n  resurrection:           # 🆕 复活术\n    name: 复活术\n    type: active\n    tier: 3\n    tags: [light, healing]\n    cost: { mp: 50 }\n    cooldown: 5\n    target: single_ally\n    effects:\n      - trigger: immediate\n        action: revive\n        target: target\n        reviveHpPercent: 50\n\n  purify:                 # 🆕 净化术\n    name: 净化\n    type: active\n    tier: 1\n    tags: [light]\n    cost: { mp: 15 }\n    cooldown: 2\n    target: single_ally\n    effects:\n      - trigger: immediate\n        action: cleanse\n        target: target\n        count: 2\n\n  devour_power:           # 🆕 永久buff示例\n    name: 吞噬之力\n    type: passive\n    tier: 2\n    tags: [dark]\n    effects:\n      - trigger: on_kill\n        action: buff\n        target: self\n        statusName: 吞噬力量\n        modifiers:\n          str: 1\n        persistent: true\n\n  chaos_adaptation:       # 🆕 带概率的永久buff\n    name: 混沌适应\n    type: passive\n    tier: 2\n    tags: [void]\n    effects:\n      - trigger: on_hurt\n        action: buff\n        target: self\n        statusName: 混沌适应\n        modifiers:\n          con: 1\n          str: 1\n        persistent: true\n        chance: 30\n\n  time_warp:              # 🆕 额外回合技能\n    name: 时间扭曲\n    type: active\n    tier: 3\n    tags: [arcane]\n    cost: { mp: 40 }\n    cooldown: 4\n    target: self\n    effects:\n      - trigger: immediate\n        action: extra_turn\n        target: self\n\n  swift_strike:           # 🆕 带伤害的额外回合技能\n    name: 迅捷斩击\n    type: active\n    tier: 2\n    tags: [physical, melee]\n    cost: { sp: 35 }\n    cooldown: 3\n    target: single_enemy\n    effects:\n      - trigger: immediate\n        action: damage\n        target: target\n        value: "1d8+dex"\n        tags: [slashing]\n      - trigger: immediate\n        action: extra_turn\n        target: self\n\n  bloodlust:              # 🆕 击杀时获得额外回合（被动）\n    name: 嗜血\n    type: passive\n    tier: 2\n    tags: [dark]\n    effects:\n      - trigger: on_kill\n        action: extra_turn\n        target: self\n```\n\n### 永久buff说明 (persistent: true)\n\n使用 `action: buff` + `persistent: true` 可以创建永久属性加成：\n\n- **战斗中**：立即作为临时buff生效\n- **战斗胜利后**：写入角色的永久属性（STR, DEX, CON, INT, WIS, CHA, SPD）\n\n**适用场景**：\n- 击杀敌人获得永久力量（on_kill + persistent）\n- 受伤后永久增加体质（on_hurt + persistent）\n- 战斗结束时的永久奖励（battle_end + persistent）\n\n**注意**：只有 modifiers 中的基础属性（str, dex, con, int, wis, cha, spd）会被永久保留\n\n### 额外回合说明 (extra_turn)\n\n使用 `action: extra_turn` 可以让角色获得额外的行动回合。\n\n**机制说明**：\n- 使用后立即获得额外回合，可以再次行动\n- 支持多次触发累积（如连续击杀会累积额外回合）\n- 可与其他效果组合（如先造成伤害，再获得额外回合）\n\n**常见用法**：\n- **主动技能**：消耗资源直接获得额外回合（如时间魔法）\n- **被动技能**：击杀敌人时触发（on_kill + extra_turn）\n- **组合技能**：伤害 + 额外回合，实现连击效果\n\n**示例**：\n```yaml\n# 纯额外回合\neffects:\n  - trigger: immediate\n    action: extra_turn\n    target: self\n\n# 击杀时获得额外回合（被动）\neffects:\n  - trigger: on_kill\n    action: extra_turn\n    target: self\n\n# 伤害 + 额外回合组合\neffects:\n  - trigger: immediate\n    action: damage\n    target: target\n    value: "2d6+str"\n    tags: [physical]\n  - trigger: immediate\n    action: extra_turn\n    target: self\n```\n\n### 预定义召唤物模板\n\n| summonId | 名称 | 说明 |\n|----------|------|------|\n| skeleton_warrior | 骷髅战士 | 物理近战 |\n| healing_sprite | 治疗精灵 | 治疗友方 |\n| fire_totem | 火焰图腾 | AOE火焰 |\n| battle_wolf | 战狼 | 忠诚伙伴 |\n| ice_elemental | 冰元素 | 冰霜控制 |\n| stone_golem | 石魔像 | 坚固肉盾 |\n| ghost_archer | 幽灵弓手 | 远程输出 |\n| shadow_clone | 暗影分身 | 敏捷分身 |\n| poison_spider | 毒蜘蛛 | 中毒控制 |\n| light_guardian | 圣光守卫 | 强力辅助 |\n| street_thug | 地痞流氓 | 低级打手 |\n| hired_guard | 雇佣护卫 | 中级护卫 |\n| guild_mage | 公会法师 | 魔法输出 |\n| elite_knight | 精锐骑士 | 高级肉盾 |\n| assassin | 刺客 | 高爆发 |\n| archer | 弓箭手 | 远程物理 |\n| mercenary | 雇佣兵 | 通用战士 |',enabled:!0,category:'战斗',description:'技能和效果的完整YAML格式规范'},{id:'vm_item_id',name:'📦 物品完整规范',order:9,content:'## 物品数据结构\n\n**重要**：背包物品使用**字典结构**，物品ID作为外层键。\n\n### ID使用规则\n\n| 操作 | 使用的ID格式 | 示例 |\n|------|-------------|------|\n| 操作**已有**物品 | 用你看到的ID | `id_01, id_02...` |\n| 添加**新**物品 | 用语义化ID | `iron_sword, potion_hp...` |\n\n**说明**：\n- 你看到的背包物品使用 `id_01, id_02...` 格式\n- 添加新物品时请用语义化ID（如 `iron_sword`），系统会自动转换\n- 同名物品会自动堆叠，无需考虑ID\n\n```yaml\n# 操作已有物品（用看到的ID）\n- path: inventory.items.id_01.count\n  add: -1\n\n# 添加新物品（用语义化ID）\n- path: inventory.items.iron_sword\n  set:\n    name: 铁剑\n    type: weapon\n    count: 1\n    ...\n```\n\n### 单个物品字段说明\n```yaml\n<itemId>:                 # 物品ID作为字典键（使用小写下划线格式）\n  name: string            # 物品名称（必需）\n  type: weapon | armor | consumable | material | quest | misc | accessory\n  count: number           # 数量（必需）\n\n  # 基础属性\n  quality: common | uncommon | rare | epic | legendary | mythic\n  desc: string            # 物品描述\n  value: number           # 基础售价（铜币）\n  level: number           # 等级限制\n\n  # 图标系统（重要！用于自动显示正确图标）\n  subtype: string         # 子类型，决定图标行（必须使用下方列表中的值）\n  attribute: string       # 元素/风格属性，决定图标列（必须使用下方列表中的值）\n\n  # 效果（消耗品/装备）\n  effects: Effect[]       # 使用/装备时的效果\n\n  # 装备限制\n  req:\n    level: number         # 等级需求\n    class: string         # 职业需求\n```\n\n## 图标子类型对照表（subtype）\n\n### 武器 (type: weapon)\n| subtype | 中文 | subtype | 中文 |\n|---------|------|---------|------|\n| sword | 长剑 | broadsword | 大剑/刀 |\n| dagger | 匕首 | shield | 盾牌 |\n| staff | 法杖 | hammer | 锤 |\n| bow | 弓 | gun | 枪械 |\n| axe | 斧 | gauntlet | 拳套 |\n| dual_blades | 双刃 | whip | 鞭 |\n| katana | 太刀 | spear | 长枪/矛 |\n| grimoire | 魔导书 | horn | 号角 |\n\n### 防具 (type: armor)\n| subtype | 中文 | subtype | 中文 |\n|---------|------|---------|------|\n| hat | 帽子 | helmet | 头盔 |\n| cloak | 斗篷/披风 | glove | 手套 |\n| top_male | 上衣(男) | top_female | 上衣(女) |\n| lingerie_top | 内衣 | underpants_male | 内裤(男) |\n| underpants_female | 内裤(女) | sock_short | 短袜 |\n| sock_long | 长袜 | shoe_light | 轻便鞋 |\n| boot_heavy | 重靴 | pant_long | 长裤 |\n| pant_short | 短裤 | coat | 外套/大衣 |\n\n### 饰品 (type: accessory)\n\n**普通饰品 (0-7)**\n| subtype | 中文 | subtype | 中文 |\n|---------|------|---------|------|\n| ring | 戒指 | necklace | 项链 |\n| earring | 耳环 | bracelet | 手镯 |\n| headband | 头带/发饰 | belt | 腰带 |\n| choker | 颈圈 | body_chain | 身体链 |\n\n**特殊饰品 (8-15)**\n| subtype | 中文 | subtype | 中文 |\n|---------|------|---------|------|\n| collar_slave | 奴隶项圈 | handcuffs | 手铐/脚镣 |\n| blindfold | 眼罩 | gag | 口球/口枷 |\n| shibari | 绳艺/绳索 | whip | 鞭子 |\n| dildo | 假阳具 | anal_plug | 肛塞 |\n\n### 材料 (type: material)\n| subtype | 中文 | subtype | 中文 |\n|---------|------|---------|------|\n| ore | 矿石 | ingot | 金属锭 |\n| gem | 宝石 | crystal | 水晶 |\n| herb | 药草 | mushroom | 蘑菇 |\n| flower | 花朵 | potion | 药水 |\n| monster_bone | 怪物骨 | monster_organ | 怪物器官 |\n| leather | 皮革 | fabric | 布料 |\n| wood | 木材 | paper | 纸张 |\n| powder | 粉末 | rune | 符文石 |\n\n### 综合物品 (type: consumable/misc/quest)\n| subtype | 中文 | subtype | 中文 |\n|---------|------|---------|------|\n| food_meat | 肉类 | food_fruit | 水果/蔬菜 |\n| food_bread | 面包/奶酪 | food_meal | 菜肴 |\n| drink | 饮料/酒 | key | 钥匙 |\n| chest | 宝箱 | bag | 背包/袋 |\n| tool | 工具 | camping | 露营用品 |\n| book | 书籍 | letter | 信件/卷轴 |\n| currency | 货币 | card | 卡牌 |\n| light | 光源(灯/蜡烛) | artifact_curse | 诅咒神器 |\n\n## 元素/风格属性对照表（attribute）\n\n### 武器/饰品属性\n| attribute | 中文 | attribute | 中文 |\n|-----------|------|-----------|------|\n| rusty | 生锈 | basic | 基础 |\n| steel | 钢铁 | standard | 标准(默认) |\n| fire | 火焰 | ice | 冰霜 |\n| lightning | 雷电 | poison | 毒 |\n| void | 虚空 | dark | 黑暗 |\n| light | 光明 | twisted | 扭曲 |\n| divine | 神圣 | earth | 大地 |\n| wind | 风 | crystal | 水晶 |\n\n### 防具风格\n| attribute | 中文 | attribute | 中文 |\n|-----------|------|-----------|------|\n| common | 普通 | linen | 亚麻 |\n| wool | 羊毛 | tattered | 破旧 |\n| leather | 皮革 | adventurer | 冒险者(默认) |\n| padded | 软垫 | denim | 牛仔 |\n| silk | 丝绸 | noble | 贵族 |\n| lace | 蕾丝 | gold_trim | 镀金 |\n| plate | 板甲 | mythical | 神话 |\n| rune | 符文 | dragon | 龙鳞 |\n\n## 物品ID命名规范\n\n| 前缀 | 类型 | 示例 |\n|------|------|------|\n| potion_ | 药水 | potion_hp, potion_mp, potion_antidote |\n| food_ | 食物 | food_bread, food_apple, food_meat |\n| weapon_ | 武器 | weapon_iron_sword, weapon_staff |\n| armor_ | 防具 | armor_leather, armor_chainmail |\n| acc_ | 饰品 | acc_ring_fire, acc_amulet |\n| mat_ | 材料 | mat_iron_ore, mat_herb, mat_goblin_ear |\n| key_ | 钥匙 | key_dungeon, key_treasure |\n| quest_ | 任务物品 | quest_letter, quest_artifact |\n| misc_ | 杂项 | misc_rope, misc_torch |\n\n## 装备示例（字典结构，ID作为键）\n\n```yaml\n# 火焰剑 - 武器（命中附加DOT示例 - 使用扁平化dot字段）\nweapon_fire_sword:        # 物品ID作为键\n  name: 火焰剑\n  type: weapon\n  subtype: sword          # 使用长剑图标\n  attribute: fire         # 火焰属性外观\n  quality: rare\n  desc: 附有火焰魔法的长剑\n  value: 8000\n  count: 1\n  level: 5\n  baseDamage: "1d8+2"     # 武器基础伤害\n  effects:\n    - trigger: on_hit     # 命中时触发\n      action: debuff      # 施加减益状态\n      target: target\n      statusName: 灼烧    # 状态名称\n      duration: 3         # 持续3回合\n      dot: 5              # 🆕 每回合5点伤害（扁平化写法）\n      tags: [fire]        # 伤害类型\n      chance: 30          # 30%概率触发\n\n# 吸血匕首 - 武器（生命偷取示例 - 推荐使用 lifesteal 字段）\nweapon_vampiric_dagger:\n  name: 吸血匕首\n  type: weapon\n  subtype: dagger\n  attribute: dark\n  quality: epic\n  desc: 饮血的暗黑匕首\n  value: 18000\n  count: 1\n  baseDamage: "1d4+3"\n  effects:\n    - trigger: immediate   # 🆕 推荐写法：在伤害效果上直接定义 lifesteal\n      action: damage\n      target: target\n      value: "1d4+3+str"\n      tags: [slashing, dark]\n      lifesteal: 20        # 🆕 吸血20%（造成伤害后恢复伤害值的20%HP）\n\n# 毒蛇之牙 - 武器（毒素DOT示例 - 使用扁平化dot字段）\nweapon_venom_fang:\n  name: 毒蛇之牙\n  type: weapon\n  subtype: dagger\n  attribute: poison\n  quality: rare\n  desc: 淬毒的蛇牙匕首\n  value: 6000\n  count: 1\n  baseDamage: "1d4+1"\n  effects:\n    - trigger: on_hit\n      action: debuff\n      target: target\n      statusName: 中毒\n      duration: 4\n      dot: 3              # 🆕 每回合3点毒素伤害\n      tags: [poison]\n      stacks: 1           # 可叠加层数\n      maxStacks: 5        # 🆕 最大叠加5层\n      chance: 40\n\n# 生命橡木盾 - 武器（HOT治疗示例 - 使用扁平化hot字段）\nweapon_lifeoak_shield:\n  name: 生命橡木盾\n  type: weapon\n  subtype: shield\n  attribute: earth\n  quality: rare\n  desc: 蕴含自然之力的盾牌\n  value: 5500\n  count: 1\n  effects:\n    - trigger: passive     # 🆕 被动效果（装备时生效）\n      action: buff\n      target: self\n      statusName: 自然再生\n      duration: -1         # 永久（装备期间）\n      hot: 3               # 🆕 每回合恢复3点HP\n      tags: [hp]\n\n# 贵族丝绸长裙 - 防具\narmor_noble_dress:\n  name: 贵族丝绸长裙\n  type: armor\n  subtype: coat           # 使用外套图标\n  attribute: silk         # 丝绸风格\n  quality: epic\n  desc: 华丽的贵族服饰\n  value: 48000\n  count: 1\n\n# 雷电戒指 - 饰品（命中额外伤害）\nacc_ring_lightning:\n  name: 雷霆指环\n  type: accessory\n  subtype: ring           # 使用戒指图标\n  attribute: lightning    # 雷电属性外观\n  quality: rare\n  desc: 蕴含雷霆之力的戒指\n  value: 15000\n  count: 1\n  effects:\n    - trigger: on_hit\n      action: damage      # 命中时直接造成额外伤害\n      target: target\n      value: 5\n      tags: [lightning]\n      chance: 20\n\n# 诅咒项链 - 饰品（命中时给目标施加属性削弱debuff）\nacc_cursed_amulet:\n  name: 诅咒护符\n  type: accessory\n  subtype: necklace\n  attribute: dark\n  quality: epic\n  desc: 以血为代价的诅咒饰品\n  value: 57000\n  count: 1\n  effects:\n    - trigger: on_hit      # 命中时触发\n      action: debuff       # 施加减益状态\n      target: target\n      statusName: 诅咒\n      duration: 2\n      chance: 100\n      modifiers:           # 直接在debuff效果上设置属性修正\n        attack: -3         # 攻击-3（使用标准键名）\n        defense: -3        # 防御-3（使用标准键名）\n\n# 铁矿石 - 材料\nmat_iron_ore:\n  name: 铁矿石\n  type: material\n  subtype: ore            # 使用矿石图标\n  quality: common\n  desc: 普通的铁矿石\n  value: 30\n  count: 5\n\n# 治疗药水 - 消耗品\npotion_hp:\n  name: 治疗药水\n  type: consumable\n  subtype: potion         # 使用药水图标（材料类）\n  quality: common\n  desc: 恢复少量生命值\n  value: 50\n  count: 3\n  effects:\n    - trigger: immediate\n      action: heal\n      target: self\n      value: 20\n      tags: [hp]\n\n# 面包 - 食物\nfood_bread:\n  name: 面包\n  type: consumable\n  subtype: food_bread     # 使用面包图标\n  quality: common\n  desc: 普通的面包\n  value: 5\n  count: 10\n  effects:\n    - trigger: immediate\n      action: heal\n      target: self\n      value: 10\n      tags: [hp]\n\n# ========== 被动效果装备示例（使用modifiers统一写法）==========\n\n# 生命之心 - 饰品（增加HP上限）\nacc_heart_of_life:\n  name: 生命之心\n  type: accessory\n  subtype: necklace\n  attribute: light\n  quality: rare\n  desc: 蕴含生命力量的项链，佩戴后感到更加健壮\n  value: 6000\n  count: 1\n  effects:\n    - trigger: passive      # 被动效果（装备时生效）\n      action: buff\n      target: self\n      statusName: 生命祝福  # 状态名称\n      duration: -1          # -1表示永久（装备期间）\n      modifiers:            # 🆕 使用modifiers对象\n        hp_max: 25          # HP上限+25\n\n# 智慧王冠 - 头盔（增加MP上限）\narmor_crown_wisdom:\n  name: 智慧王冠\n  type: armor\n  subtype: hat\n  attribute: crystal\n  quality: epic\n  desc: 镶嵌水晶的王冠，增强魔力容量\n  value: 15000\n  count: 1\n  effects:\n    - trigger: passive\n      action: buff\n      target: self\n      statusName: 智慧光环\n      duration: -1\n      modifiers:\n        mp_max: 30\n        int: 2              # 还可以加智力\n\n# 巨人之力手套 - 饰品（增加力量属性）\nacc_giant_gauntlet:\n  name: 巨人之力手套\n  type: accessory\n  subtype: bracelet\n  attribute: earth\n  quality: rare\n  desc: 传说中巨人佩戴的手套，蕴含强大力量\n  value: 18000\n  count: 1\n  effects:\n    - trigger: passive\n      action: buff\n      target: self\n      statusName: 巨人之力\n      duration: -1\n      modifiers:\n        str: 3              # 力量+3\n\n# 敏捷之靴 - 防具（多属性提升 - 一个效果多个modifiers）\narmor_swift_boots:\n  name: 敏捷之靴\n  type: armor\n  subtype: shoe_light\n  attribute: wind\n  quality: rare\n  desc: 轻盈的魔法靴子，使穿戴者更加敏捷\n  value: 7000\n  count: 1\n  effects:\n    - trigger: passive\n      action: buff\n      target: self\n      statusName: 疾风之力\n      duration: -1\n      modifiers:\n        dex: 2              # 敏捷+2\n        spd: 10             # 速度+10\n\n# 龙鳞胸甲 - 防具（多属性提升）\narmor_dragon_chest:\n  name: 龙鳞胸甲\n  type: armor\n  subtype: top_male\n  attribute: dragon\n  quality: legendary\n  desc: 由龙鳞锻造的胸甲，赋予穿戴者龙之力量\n  value: 250000\n  count: 1\n  effects:\n    - trigger: passive\n      action: buff\n      target: self\n      statusName: 龙之庇护\n      duration: -1\n      modifiers:\n        hp_max: 50          # HP上限+50\n        con: 3              # 体质+3\n        ac: 5               # 护甲+5\n        fire_res: 20        # 火焰抗性+20%\n\n# 暴击指环 - 饰品（暴击属性）\nacc_crit_ring:\n  name: 致命一击指环\n  type: accessory\n  subtype: ring\n  attribute: fire\n  quality: epic\n  desc: 燃烧着战意的戒指，增强致命打击能力\n  value: 12000\n  count: 1\n  effects:\n    - trigger: passive\n      action: buff\n      target: self\n      statusName: 致命直觉\n      duration: -1\n      modifiers:\n        crit_rate: 5        # 暴击率+5%\n        crit_dmg: 20        # 暴击伤害+20%\n```\n\n## 效果中的 tags 说明\n\n消耗品的 heal 效果通过 tags 指定恢复的资源类型：\n| tags | 效果 |\n|------|------|\n| [hp] | 恢复HP |\n| [mp] | 恢复MP |\n| [sp] | 恢复SP |\n| [hp, mp] | 同时恢复HP和MP |\n\n## 装备效果写法总结\n\n### 触发时机\n| trigger | 说明 | 适用场景 |\n|---------|------|---------|\n| `passive` | 被动效果 | 装备时永久生效的属性加成 |\n| `on_hit` | 命中时 | 武器附加效果（普攻触发） |\n| `on_damage` | 造成伤害后 | 吸血效果 |\n| `on_hurt` | 受到伤害时 | 反击效果 |\n\n### 常用效果组合\n\n**1. 属性加成（被动）**\n```yaml\neffects:\n  - trigger: passive\n    action: buff\n    target: self\n    statusName: 效果名\n    duration: -1          # 永久\n    modifiers:\n      str: 3              # 使用modifiers对象\n      hp_max: 25\n```\n\n**2. DOT伤害（扁平化写法）**\n```yaml\neffects:\n  - trigger: on_hit\n    action: debuff\n    target: target\n    statusName: 灼烧\n    duration: 3\n    dot: 5                # 🆕 直接指定每回合伤害\n    tags: [fire]\n    chance: 30\n```\n\n**3. HOT治疗（扁平化写法）**\n```yaml\neffects:\n  - trigger: passive\n    action: buff\n    target: self\n    statusName: 再生\n    duration: -1\n    hot: 3                # 🆕 直接指定每回合治疗\n    tags: [hp]\n```\n\n**4. 吸血效果（推荐使用 lifesteal 字段）**\n```yaml\n# 推荐写法：直接在伤害效果上定义 lifesteal\neffects:\n  - trigger: immediate\n    action: damage\n    target: target\n    value: "1d6+str"\n    tags: [slashing]\n    lifesteal: 15         # 🆕 吸血15%，造成伤害后恢复伤害值的15%HP\n\n# 或通过 modifiers 提供被动吸血\neffects:\n  - trigger: passive\n    action: buff\n    target: self\n    statusName: 吸血光环\n    duration: -1\n    modifiers:\n      lifesteal: 10       # 所有伤害均有10%吸血\n\n# 备选写法：固定值吸血（on_damage + heal）\neffects:\n  - trigger: on_damage    # 造成伤害后\n    action: heal\n    target: self\n    value: 10       # 固定值回血\n    tags: [hp]\n    chance: 50\n```\n\n### 注意事项\n1. **使用英文小写**：所有trigger、action、target必须用英文小写\n2. **modifiers统一**：属性修正使用modifiers对象，不要用value+tags\n3. **DOT/HOT扁平化**：使用dot/hot字段，不要用嵌套effects\n4. **duration: -1**：表示永久效果（装备期间）',enabled:!0,category:'物品',description:'物品数据结构和效果的完整规范'},{id:'vm_private_info',name:'🔒 私密信息规则',order:10,content:'## 私密信息更新 (path: player.private.*)\n\n**注意**：字段名必须严格区分大小写（PascalCase）。\n\n【体型参考 (Body_Type)】\n- 女性: 幼女(未发育), 萝莉(微发育), 少女(发育中), 御姐(成熟), 熟女, 老妪\n- 男性: 幼儿, 正太, 少年, 青壮, 中年, 老年\n\n【乳量参考 (Breast_Volume)】\n- 微乳(AA杯), 普乳(A-C杯), 巨乳(D-F杯), 爆乳(G-I杯)\n- 豪乳(J-L杯), 超乳(M-P杯), 皇乳/圣乳/神乳(Q+杯)\n\n【常用字段一览】\n1. **基础特征**:\n   - Body_Type (体型), Sexual_Orientation (性取向), Kinks (癖好列表)\n   - Skin_Sensitivity (皮肤敏感度), Pubic_Hair (阴毛), Body_Hair (体毛)\n\n2. **女性特征**:\n   - Breast_Size (尺寸), Breast_Volume (容积描述), Breast_Shape (形状)\n   - Vulva_Appearance (外阴外观), Vulva_Color (外阴颜色)\n   - Virginity_Status (处女/非处女), Hymen_Status (处女膜状态)\n   - Pregnancy_Status (怀孕状态), Gestation (周数)\n\n3. **男性特征**:\n   - Penis_Length (长度), Penis_Girth (粗细), Foreskin_Status (包皮)\n   - Testicle_Size (睾丸), Ejaculation_Volume (射精量)\n\n4. **性行为计数 (累加)**:\n   - Vaginal_Intercourse (阴道性交), Anal_Intercourse (肛交)\n   - Oral_Sex (口交), Manual_Sex (手交), Footjob (足交)\n   - Masturbation (自慰), Ejaculation_Count (射精次数)\n\n### 更新示例\n```yaml\n<patch>\n# 设置身体特征\n- path: player.private.Body_Type\n  set: "少女"\n\n- path: player.private.Breast_Size\n  set: "C杯"\n\n- path: player.private.Breast_Volume\n  set: "普乳"\n\n# 更新状态\n- path: player.private.Virginity_Status\n  set: "非处女"\n\n- path: player.private.Hymen_Status\n  set: "破裂"\n\n# 计数增加\n- path: player.private.Vaginal_Intercourse\n  add: 1\n\n- path: player.private.Oral_Sex\n  add: 1\n</patch>\n```',enabled:!0,category:'私密',description:'私密信息的更新规则'},{id:'vm_relation_rules',name:'👥 人际关系更新规则',order:11,content:'## 人际关系更新 (relation.characters.{charId}.*)\n\n**重要**：玩家星标的角色会保存到 relation.characters 中，应当在剧情发展时维护这些角色的信息。\n\n### 可用路径\n\n```yaml\n# ========== 角色基础信息 ==========\nrelation.characters.{charId}.name         # 角色名（通常不变）\nrelation.characters.{charId}.appearance   # 外貌特征（仅固定长相，不含衣着/临时状态）\nrelation.characters.{charId}.personality  # 性格\nrelation.characters.{charId}.occupation   # 职业/身份\nrelation.characters.{charId}.likes        # 喜好\nrelation.characters.{charId}.dislikes     # 厌恶\nrelation.characters.{charId}.haunt        # 常出没地点\n\n# ========== 详细信息（逐步解锁）==========\nrelation.characters.{charId}.background   # 人物背景\nrelation.characters.{charId}.biography    # 生平经历\nrelation.characters.{charId}.motivation.current    # 当前动机\nrelation.characters.{charId}.motivation.shortTerm  # 短期目标\nrelation.characters.{charId}.motivation.longTerm   # 长期目标\nrelation.characters.{charId}.deeds        # 事迹列表（数组）\n\n# ========== 关系数据 ==========\nrelation.characters.{charId}.rel          # 好感度 (-100 ~ 999)\nrelation.characters.{charId}.relType      # 关系类型（如"朋友"、"队友"、"敌人"、"师徒"等，自由填写）\nrelation.characters.{charId}.status       # 当前状态\nrelation.characters.{charId}.location     # 当前位置\nrelation.characters.{charId}.lastSeen     # 最后见面时间\n\n# ========== 势力声望 ==========\nrelation.factions.{factionId}.rep         # 声望值 (-100 ~ 100)\nrelation.factions.{factionId}.status      # 与玩家的关系状态\n```\n\n### 更新时机\n\n1. **好感度变化** - 当与角色互动时（交谈、送礼、帮助、冲突等）\n2. **状态变化** - 当角色的状态发生变化时\n3. **信息补充** - 当玩家了解到角色的新信息时（背景、动机、喜好等）\n4. **事迹记录** - 当角色做出重要行动时\n\n### 外貌字段说明\n\n**重要区别**：\n- **scene.npcs.{name}.appearance**：临时的完整外观描述，包含衣着、当前状态（如"穿着脏兮兮的围裙"、"头发凌乱"）\n- **relation.characters.{charId}.appearance**：持久化的固定长相特征，仅记录发色、瞳色、身高、体型等不变特征，**不包含衣着和临时状态**\n\n补全角色档案时，appearance应该填写：\n- ✅ 正确："银白色长发，红色瞳孔，身材纤细，左眼下有泪痣"\n- ❌ 错误："头发乱糟糟的，衣服很脏，脸上有灰尘"（这些是临时状态，应记录在status字段）\n\n### 更新示例\n\n```yaml\n<patch>\n# ========== 创建新角色（必须一次性设置完整对象）==========\n- path: relation.characters.miffir\n  set:\n    id: miffir\n    name: 米拉尔\n    appearance: 银白色短发，身材娇小的精灵，翠绿眼瞳\n    personality: 纯真活泼\n    occupation: 贴身女仆\n    rel: 50\n    metAt: "6月1日 上午"\n    isStarred: true\n\n# ========== 更新已存在角色的属性 ==========\n# 好感度变化（交谈后增加好感）\n- path: relation.characters.Zhang.rel\n  add: 5\n\n# 更新角色当前状态（临时状态，不是外貌）\n- path: relation.characters.Zhang.status\n  set: "正在酒馆休息"\n\n# 更新最后见面时间\n- path: relation.characters.Zhang.lastSeen\n  set: "xx年x月x日 下午"\n\n# 补充角色信息（玩家通过对话了解到）\n- path: relation.characters.Zhang.background\n  set: "曾是王国骑士团的成员，因一场冤案被逐出"\n\n# 补充固定外貌特征（仅固定长相，不含衣着）\n- path: relation.characters.Zhang.appearance\n  set: "中年男性，黑色短发，棕色眼睛，身材健壮，右臂有旧伤疤"\n\n- path: relation.characters.Zhang.likes\n  set: "烈酒、武术切磋、怀念往事"\n\n# 记录事迹（使用 push 添加到数组）\n- path: relation.characters.Zhang.deeds\n  push: "在酒馆斗殴中帮助玩家击退流氓"\n\n# 更新动机\n- path: relation.characters.Zhang.motivation.current\n  set: "寻找能证明自己清白的证据"\n\n# 更新势力声望\n- path: relation.factions.faction_thieves_guild.rep\n  add: -10\n\n- path: relation.factions.faction_thieves_guild.status\n  set: "敌对"\n</patch>\n```\n\n### 好感度影响表\n\n| 行为 | 好感度变化 |\n|------|-----------|\n| 普通交谈 | +1~3 |\n| 送礼（喜欢的） | +5~15 |\n| 送礼（厌恶的） | -5~10 |\n| 帮助完成任务 | +10~30 |\n| 救命之恩 | +30~50 |\n| 攻击/伤害 | -20~50 |\n| 背叛/欺骗 | -30~80 |\n| 调情（接受） | +5~10 |\n| 调情（拒绝） | -2~5 |\n\n### 注意事项\n\n1. **只更新已星标角色** - relation.characters 中的角色是玩家主动收藏的\n2. **场景NPC无好感度** - 场景NPC好感度通过 scene.npcs.{name}.attitude 更新基本态度（友好/中立/敌对）\n3. **同步更新** - 如果角色同时在场景中，应同时更新 scene.npcs 和 relation.characters\n4. **信息增量补充** - 角色信息应随剧情逐步解锁，不要一次填充所有字段',enabled:!0,category:'人际关系',description:'指导工具AI如何更新人际关系数据'},{id:'vm_quest_rules',name:'📜 任务系统规则',order:12,content:'## 任务系统更新 (world.quests.{questId}.*)\n\n**重要**：任务数据存储在 `world.quests` 字典中，工具AI应当在剧情发展时维护任务状态。\n\n### 任务数据结构\n\n```yaml\nworld.quests.{questId}:\n  id: string          # 任务ID（小写下划线格式，如 quest_find_sword）\n  name: string        # 任务名称（显示用）\n  status: string      # 任务状态：active | completed | failed\n  progress: number    # 任务进度（0-100）\n  desc: string        # 任务描述\n  reward: string      # 奖励描述（可选）\n```\n\n### 任务状态说明\n\n| status | 说明 | 触发时机 |\n|--------|------|---------|\n| active | 进行中 | 接受任务时 |\n| completed | 已完成 | 完成所有目标时 |\n| failed | 已失败 | 任务失败条件触发时 |\n\n### 可用路径\n\n```yaml\nworld.quests.{questId}           # 整个任务对象\nworld.quests.{questId}.status    # 任务状态\nworld.quests.{questId}.progress  # 任务进度（0-100）\nworld.quests.{questId}.desc      # 任务描述\nworld.quests.{questId}.reward    # 奖励描述\n```\n\n### 更新示例\n\n```yaml\n<patch>\n# 接受新任务（整体设置）\n- path: world.quests.quest_find_herb\n  set:\n    name: 寻找草药\n    status: active\n    progress: 0\n    desc: 为老张寻找5株治愈草药\n    reward: 100铜币，治疗药水x2\n\n# 更新任务进度\n- path: world.quests.quest_find_herb.progress\n  set: 60\n\n# 更新任务描述（发现新线索时）\n- path: world.quests.quest_find_herb.desc\n  set: 已找到3株草药，还需要2株。据说森林深处有更多。\n\n# 完成任务（标记为完成，不需要移除）\n- path: world.quests.quest_find_herb.status\n  set: completed\n\n- path: world.quests.quest_find_herb.progress\n  set: 100\n\n# 任务失败\n- path: world.quests.quest_escort_merchant.status\n  set: failed\n\n- path: world.quests.quest_escort_merchant.desc\n  set: 商人在路上被强盗杀害，任务失败。\n</patch>\n```\n\n### 任务ID命名规范\n\n| 前缀 | 类型 | 示例 |\n|------|------|------|\n| quest_ | 普通任务 | quest_find_sword, quest_rescue_princess |\n| main_ | 主线任务 | main_chapter1, main_find_artifact |\n| side_ | 支线任务 | side_help_farmer, side_collect_herbs |\n| daily_ | 日常任务 | daily_hunt_goblins |\n| event_ | 事件任务 | event_festival_competition |\n\n### 更新时机\n\n1. **接受任务** - 当NPC给予任务或玩家主动接受时\n2. **进度更新** - 当完成部分目标时（如收集5个物品中的3个）\n3. **描述更新** - 当发现新线索或情况变化时\n4. **状态变化** - 当完成或失败时\n\n### 注意事项\n\n1. **ID唯一性** - 确保每个任务ID唯一，避免覆盖\n2. **进度范围** - progress 值应在 0-100 之间\n3. **保留记录** - 通常不要删除已完成的任务，让玩家可以回顾\n4. **与剧情同步** - 任务状态应与剧情发展一致',enabled:!0,category:'任务',description:'指导工具AI如何创建和更新任务数据'}];case'textOptimization':return[{id:'to_1',name:'文风一致性',content:'保持回复的文风与之前的对话一致，注意语气、用词习惯和叙事风格的连贯性。',enabled:!0,order:0,category:'风格',description:'确保AI回复的文风一致'},{id:'to_2',name:'描写细节',content:'在描写场景和动作时，注意添加感官细节（视觉、听觉、触觉等），让描写更加生动。',enabled:!0,order:1,category:'描写',description:'提升描写的细节程度'},{id:'to_3',name:'对话优化',content:'角色对话应符合其性格和背景，避免过于书面化的表达，增加口语化和个性化的语言特点。',enabled:!0,order:2,category:'对话',description:'优化角色对话的自然度'},{id:'to_4',name:'节奏控制',content:'注意叙事节奏的控制，在紧张场景加快节奏，在情感场景适当放慢，给读者喘息的空间。',enabled:!1,order:3,category:'节奏',description:'控制叙事的节奏感'}]}}getPrompts(e){return[...this.prompts.get(e)||[]].sort((e,t)=>e.order-t.order)}getEnabledPrompts(e){return this.getPrompts(e).filter(e=>e.enabled)}getMergedPromptText(e){return this.getEnabledPrompts(e).map(e=>`【${e.name}】\n${e.content}`).join('\n\n')}addPrompt(e,t){const a=this.prompts.get(e)||[],s={...t,id:`${e}_${Date.now()}`,order:a.length};return a.push(s),this.prompts.set(e,a),this.saveToStorage(e),s}updatePrompt(e,t,a){const s=this.prompts.get(e)||[],n=s.findIndex(e=>e.id===t);return-1!==n&&(s[n]={...s[n],...a},this.prompts.set(e,s),this.saveToStorage(e),!0)}deletePrompt(e,t){const a=this.prompts.get(e)||[],s=a.findIndex(e=>e.id===t);return-1!==s&&(a.splice(s,1),a.forEach((e,t)=>e.order=t),this.prompts.set(e,a),this.saveToStorage(e),!0)}togglePrompt(e,t){const a=(this.prompts.get(e)||[]).find(e=>e.id===t);return!!a&&(a.enabled=!a.enabled,this.saveToStorage(e),!0)}reorderPrompts(e,t,a){const s=this.prompts.get(e)||[];if(t<0||t>=s.length)return;if(a<0||a>=s.length)return;const n=[...s].sort((e,t)=>e.order-t.order),[r]=n.splice(t,1);n.splice(a,0,r),n.forEach((e,t)=>e.order=t),this.prompts.set(e,n),this.saveToStorage(e)}saveToStorage(e){try{localStorage.setItem($i.STORAGE_KEY_PREFIX+e,JSON.stringify(this.prompts.get(e)||[]))}catch(t){console.error(`Failed to save prompts for ${e}`,t)}}getPresets(e){return this.presets.get(e)||[]}saveAsPreset(e,t,a){const s=this.presets.get(e)||[],n={id:`preset_${Date.now()}`,name:t,description:a,entries:[...this.prompts.get(e)||[]],createdAt:Date.now(),updatedAt:Date.now()};return s.push(n),this.presets.set(e,s),this.savePresetsToStorage(e),n}loadPreset(e,t){const a=(this.presets.get(e)||[]).find(e=>e.id===t);return!!a&&(this.prompts.set(e,[...a.entries]),this.saveToStorage(e),!0)}deletePreset(e,t){const a=this.presets.get(e)||[],s=a.findIndex(e=>e.id===t);return-1!==s&&(a.splice(s,1),this.presets.set(e,a),this.savePresetsToStorage(e),!0)}savePresetsToStorage(e){try{localStorage.setItem($i.PRESET_KEY_PREFIX+e,JSON.stringify(this.presets.get(e)||[]))}catch(t){console.error(`Failed to save presets for ${e}`,t)}}exportConfig(e){const t={type:e,entries:this.prompts.get(e)||[],exportedAt:Date.now()};return JSON.stringify(t,null,2)}importConfig(e,t,a=!1){try{const s=JSON.parse(t);if(!s.entries||!Array.isArray(s.entries))throw new Error('Invalid config format');if(a){const t=this.prompts.get(e)||[],a=Math.max(...t.map(e=>e.order),-1),n=s.entries.map((t,s)=>({...t,id:`${e}_imported_${Date.now()}_${s}`,order:a+1+s}));this.prompts.set(e,[...t,...n])}else{const t=s.entries.map((t,a)=>({...t,id:`${e}_imported_${Date.now()}_${a}`,order:a}));this.prompts.set(e,t)}return this.saveToStorage(e),!0}catch(e){return console.error('Failed to import config',e),!1}}resetToDefault(e){this.prompts.set(e,this.getDefaultPrompts(e)),this.saveToStorage(e)}}let Di=null;function Pi(){return Di||(Di=new $i),Di}class Ni extends Bl{logger;saveService;promptService;DEFAULT_MESSAGES_PER_BLOCK=50;constructor(){super('AdventureSummaryService')}init(){const e=Ll.q.getInstance();this.logger=e.get('LoggerService'),this.saveService=e.get('SaveService'),this.promptService=Pi(),this.logger?.log('AdventureSummaryService initialized')}getApiConfig(){try{const e=localStorage.getItem('game_api_config');if(e){return JSON.parse(e).adventureSummary||{useTavernApi:!0,endpoint:'',apiKey:'',model:''}}}catch(e){this.logger?.error('Failed to load API config',e)}return{useTavernApi:!0,endpoint:'',apiKey:'',model:''}}getAdventureNotes(){const e=this.saveService?.getGameState();return e?(e.adventureNotes||(e.adventureNotes=this.createEmptyAdventureNotes(),this.saveService?.saveData('Initialize adventure notes')),e.adventureNotes):this.createEmptyAdventureNotes()}createEmptyAdventureNotes(){return{blocks:[],lastCheckedMsgId:0,totalAIMessages:0,messagesPerBlock:this.DEFAULT_MESSAGES_PER_BLOCK,lastUpdated:Date.now()}}async countAIMessages(){try{return await mi.storyDB.story.where('role').equals('assistant').count()}catch(e){return this.logger?.error('Failed to count AI messages',e),0}}async getAIMessagesInRange(e,t){try{return await mi.storyDB.story.where('id').between(e,t,!0,!0).filter(e=>'assistant'===e.role).toArray()}catch(e){return this.logger?.error('Failed to get AI messages in range',e),[]}}async getAllAIMessages(){try{return await mi.storyDB.story.where('role').equals('assistant').sortBy('id')}catch(e){return this.logger?.error('Failed to get all AI messages',e),[]}}async checkBlocks(){const e=this.getAdventureNotes(),t=await this.getAllAIMessages(),a=t.length,s=e.messagesPerBlock||this.DEFAULT_MESSAGES_PER_BLOCK,n=Math.floor(a/s);for(let a=0;a<n;a++){const n=a+1;if(!e.blocks.find(e=>e.blockId===n)){const r=a*s,l=r+s-1,o=t[r]?.id||0,i=t[l]?.id||0,c={blockId:n,startMsgId:o,endMsgId:i,messageCount:s,summary:'',status:'pending',createdAt:Date.now()};e.blocks.push(c),this.logger?.log(`Created new block #${n}: messages ${o}-${i}`)}}e.blocks.sort((e,t)=>e.blockId-t.blockId),e.totalAIMessages=a,e.lastUpdated=Date.now(),this.saveService?.saveData('Update adventure notes blocks');const r=e.blocks.filter(e=>'completed'===e.status).length,l=e.blocks.filter(e=>'pending'===e.status||'error'===e.status).length;return{totalAIMessages:a,completedBlocks:r,pendingBlocks:l,currentBlockProgress:a%s,needsSummarization:l>0,blocks:[...e.blocks]}}getPendingBlocks(){return this.getAdventureNotes().blocks.filter(e=>'pending'===e.status||'error'===e.status)}async generateSummary(e){const t=this.getAdventureNotes(),a=t.blocks.find(t=>t.blockId===e);if(!a)return{success:!1,blockId:e,error:`Block #${e} not found`};if('completed'===a.status)return{success:!0,blockId:e,summary:a.summary};a.status='summarizing',this.saveService?.saveData('Start summarizing block'),this.eventBus?.emit('adventure:summarizing',{blockId:e});try{const s=await this.getAIMessagesInRange(a.startMsgId,a.endMsgId);if(0===s.length)throw new Error('No messages found in block range');const n=await this.callSummaryAPI(s,e);return a.summary=n,a.status='completed',a.summarizedAt=Date.now(),delete a.error,t.lastUpdated=Date.now(),this.saveService?.saveData('Complete block summary'),this.eventBus?.emit('adventure:summarized',{blockId:e,summary:n}),{success:!0,blockId:e,summary:n}}catch(t){return a.status='error',a.error=t instanceof Error?t.message:String(t),this.saveService?.saveData('Block summary failed'),this.eventBus?.emit('adventure:summary-error',{blockId:e,error:a.error}),{success:!1,blockId:e,error:a.error}}}async callSummaryAPI(e,t){const a=this.getApiConfig(),s=e.map((e,t)=>{const a=e.content.match(/<summary>([\s\S]*?)<\/summary>/i);if(a)return`[${t+1}] ${a[1].trim()}`;const s=e.content.match(/<content>([\s\S]*?)<\/content>/i);if(s){const e=s[1].trim();return`[${t+1}] ${e.length>200?e.substring(0,200)+'...':e}`}return`[${t+1}] ${e.content.length>200?e.content.substring(0,200)+'...':e.content}`}).join('\n\n'),n=this.buildSummarySystemPrompt(t,e.length);return a.useTavernApi?await this.callTavernAPI(n,s):await this.callExternalAPI(a,n,s)}buildSummarySystemPrompt(e,t){return`你是一个专业的剧情总结助手。以下是 ${t} 条剧情的小总结（已由AI预生成），请将它们整合成一个连贯的章节大纲（第 ${e} 章节）。\n\n要求：\n1. 将零散的小总结整合成连贯的章节叙述\n2. 保留关键剧情节点、重要事件和转折\n3. 记录重要的NPC互动和关系变化\n4. 标注获得的物品、技能或状态变化\n5. 使用简洁的叙述风格，突出因果关系\n6. 总结长度控制在 200-400 字\n\n输出格式：\n【章节 ${e}】\n[一段简洁的章节概述，描述这段剧情的主要发展]\n\n关键事件：\n- ...\n- ...\n\n重要变化：\n- ...`}async callTavernAPI(e,t){if(this.logger?.log('Calling Tavern API for summary...'),'function'!=typeof generateRaw)throw new Error('Tavern API (generateRaw) not available');return(await generateRaw({ordered_prompts:[{role:'system',content:e},{role:'user',content:`请总结以下剧情内容：\n\n${t}`}],user_input:'',max_chat_history:0})).trim()}async callExternalAPI(e,t,a){if(this.logger?.log('Calling external API for summary...'),!e.endpoint||!e.apiKey)throw new Error('External API not configured');let s=e.endpoint.trim();s.endsWith('/')&&(s=s.slice(0,-1)),s.endsWith('/v1')||(s+='/v1');const n=await fetch(`${s}/chat/completions`,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${e.apiKey}`},body:JSON.stringify({model:e.model||'gpt-4',messages:[{role:'system',content:t},{role:'user',content:`请总结以下剧情内容：\n\n${a}`}],temperature:.7,max_tokens:1e3})});if(!n.ok){const e=await n.text();throw new Error(`API error: ${n.status} - ${e}`)}const r=await n.json();return r.choices?.[0]?.message?.content?.trim()||''}async summarizeAllPending(){const e=this.getPendingBlocks(),t=[];for(const a of e){const e=await this.generateSummary(a.blockId);t.push(e),e.success||this.logger?.error(`Failed to summarize block #${a.blockId}:`,e.error)}return t}getCompletedSummaries(){return this.getAdventureNotes().blocks.filter(e=>'completed'===e.status&&e.summary).sort((e,t)=>e.blockId-t.blockId).map(e=>e.summary)}getFormattedSummaries(){const e=this.getCompletedSummaries();return 0===e.length?'':`[冒险笔记 - 剧情回顾]\n${e.join('\n\n')}`}updateUserNotes(e){const t=this.getAdventureNotes();t.userNotes=e,t.lastUpdated=Date.now(),this.saveService?.saveData('Update user notes')}getUserNotes(){return this.getAdventureNotes().userNotes||''}resetBlock(e){const t=this.getAdventureNotes(),a=t.blocks.find(t=>t.blockId===e);return!!a&&(a.status='pending',a.summary='',delete a.summarizedAt,delete a.error,t.lastUpdated=Date.now(),this.saveService?.saveData('Reset block status'),!0)}setMessagesPerBlock(e){const t=this.getAdventureNotes();t.messagesPerBlock=Math.max(10,Math.min(100,e)),t.lastUpdated=Date.now(),this.saveService?.saveData('Update messages per block')}updateBlockSummary(e,t){const a=this.getAdventureNotes(),s=a.blocks.find(t=>t.blockId===e);return!!s&&(s.summary=t,s.summarizedAt=Date.now(),a.lastUpdated=Date.now(),this.saveService?.saveData('Update block summary'),!0)}}let Ri=null;function ji(){return Ri||(Ri=new Ni),Ri}const Li={summaryCount:10,dialogCount:5,scanThreshold:2,adventureNotesDepth:60,summaryBaseDepth:50,summaryDepthStep:3,stateDepth:3,relationDepth:4,hiddenRole:'user',enableAdventureNotes:!0,enableRelationInjection:!0,maxRelationCharacters:5},Bi=[/<thinking>[\s\S]*?<\/thinking>/gi,/<think>[\s\S]*?<\/think>/gi,/<thought>[\s\S]*?<\/thought>/gi],Oi={content:/<content>([\s\S]*?)<\/content>/i,summary:/<summary>([\s\S]*?)<\/summary>/i,places:/<places>([\s\S]*?)<\/places>/i,npcs:/<npcs>([\s\S]*?)<\/npcs>/i,objects:/<objects>([\s\S]*?)<\/objects>/i,options:/<options>([\s\S]*?)<\/options>/i};class qi extends Bl{uninjectFn=null;config={...Li};saveService;loggerService;offlineActionService;adventureSummaryService;cachedOfflineActions=[];constructor(){super('PromptInjector')}async init(){const e=Ll.q.getInstance();this.saveService=e.get('SaveService'),this.loggerService=e.get('LoggerService');try{this.offlineActionService=e.get('OfflineActionService')}catch(e){console.warn('OfflineActionService not found')}try{this.adventureSummaryService=ji();try{this.adventureSummaryService.init()}catch{}}catch(e){console.warn('AdventureSummaryService not available')}console.log('PromptInjector initialized')}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}getCachedOfflineActions(e=!1){const t=[...this.cachedOfflineActions];return e&&(this.cachedOfflineActions=[]),t}clearCachedOfflineActions(){this.cachedOfflineActions=[]}async buildInjectionParams(e,t,a,s=!1){this.cachedOfflineActions=[];const n=this.saveService?.getGameState();if(!n)throw new Error('No game state available');const r=2*(this.config.summaryCount+this.config.dialogCount),l=(await mi.storyDB.getRecentContext(r)).filter(e=>'user'===e.role||'assistant'===e.role),o=[];let i={};for(const e of l)'user'===e.role?(i.user&&(o.push(i),i={}),i.user=e):'assistant'===e.role&&(i.assistant=e,o.push(i),i={});(i.user||i.assistant)&&o.push(i);const c=o.length,d=Math.min(c,this.config.dialogCount),u=Math.min(Math.max(0,c-this.config.dialogCount),this.config.summaryCount),p=o.slice(c-d-u,c-d),m=o.slice(-d),g=[];for(const e of p)if(e.assistant){const t=ui.e.extractTag(e.assistant.content,'summary');t&&g.push({record:e.assistant,summary:t})}const h=[];for(const e of m)e.user&&h.push(e.user),e.assistant&&h.push(e.assistant);const f=this.buildPlayerPanel(n);let v=[];this.offlineActionService&&(v=this.offlineActionService.getCompressedSummary(!s));const y=[...v,...n.world.pendingContext||[],...t||[]];this.cachedOfflineActions=[...y],!s&&n.world.pendingContext&&n.world.pendingContext.length>0&&(n.world.pendingContext=[]);const b=this.buildTeammatesInfo(n);let x,w;return this.config.enableAdventureNotes&&this.adventureSummaryService&&(x=this.adventureSummaryService.getFormattedSummaries(),x&&console.log('[PromptInjector] Adventure notes loaded for injection')),this.config.enableRelationInjection&&n.relation?.characters&&(w=this.scanAndMatchCharacters(n,h,a),w.length>0&&console.log(`[PromptInjector] Matched ${w.length} relation characters for injection`)),{summaries:g,recentDialogs:h,playerPanel:f,teammates:b,offlineActions:y,hiddenInstructions:e,currentUserInput:a,adventureNotes:x,matchedCharacters:w}}scanAndMatchCharacters(e,t,a){const s=e.relation?.characters||{},n=Object.values(s).map(e=>e.name);if(0===n.length)return[];const r=new RegExp(`\\b(${n.map(e=>this.escapeRegex(e)).join('|')})\\b`,'gi'),l=new Map;if(a){const e=a.match(r);if(e)for(const t of e){const e=this.findCharacterByName(s,t);e&&!l.has(e.id)&&l.set(e.id,{character:e,matchedIn:'userInput',priority:100})}}const o=t.slice(2*-this.config.scanThreshold);for(let e=o.length-1;e>=0;e--){const t=o[e].content.match(r);if(t)for(const a of t){const t=this.findCharacterByName(s,a);t&&!l.has(t.id)&&l.set(t.id,{character:t,matchedIn:'dialog',priority:o.length-e+50})}}if(e.scene?.npcs)for(const t of Object.keys(e.scene.npcs)){const e=this.findCharacterByName(s,t);e&&!l.has(e.id)&&l.set(e.id,{character:e,matchedIn:'scene',priority:30})}return Array.from(l.values()).sort((e,t)=>t.priority-e.priority).slice(0,this.config.maxRelationCharacters)}findCharacterByName(e,t){const a=t.toLowerCase();return Object.values(e).find(e=>e.name.toLowerCase()===a)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}buildTeammatesInfo(e){const t=e.allies;if(!t||0===Object.keys(t).length)return;const a=Object.values(t).filter(e=>e.isActive&&e.isAvailable);return 0!==a.length?a.map(e=>this.allyToTeammateInfo(e)):void 0}allyToTeammateInfo(e){const t=this.buildAllyAppearance(e);let a='正常';return e.stats.hp.current<=0?a='倒地':e.stats.hp.current/e.stats.hp.max<.3?a='重伤':e.stats.hp.current/e.stats.hp.max<.5&&(a='轻伤'),{name:e.name,class:e.class,level:e.level,hp:{current:e.stats.hp.current,max:e.stats.hp.max},mp:{current:e.stats.mp.current,max:e.stats.mp.max},status:a,appearance:t}}buildAllyAppearance(e){const t=[],a=e.equipment||{};return a.weapon_main?.name&&t.push(`持${a.weapon_main.name}`),a.outer?.name?t.push(`穿${a.outer.name}`):a.upper?.name?t.push(`穿${a.upper.name}`):a.underwear?.name?t.push(`仅着${a.underwear.name}`):t.push('赤露上身'),a.lower?.name?t.push(`着${a.lower.name}`):a.underpants?.name?t.push(`仅穿${a.underpants.name}`):t.push('赤露下身'),a.head?.name&&t.push(`戴${a.head.name}`),t.join(', ')}buildPlayerPanel(e){const t=e.player;let a='未知';e.scene?.locationPath?.length?a=e.scene.locationPath.join(' > '):e.scene?.name&&(a=e.scene.name);const s=Object.values(e.inventory?.items||{}).map(e=>({name:e.name,count:e.count,rarity:e.quality,value:e.value,description:e.desc})),n={};['weapon_main','weapon_off','head','outer','upper','lower','shoes','underwear','underpants','socks','accessory','accessory_1','accessory_2','accessory_3','accessory_4'].forEach(e=>{const a=t.equipment?.[e];a&&a.name?n[e]={name:a.name,rarity:a.quality,description:a.desc}:n[e]=null});const r=t.attributes.STR||10,l=t.attributes.DEX||10,o=t.attributes.INT||10,i=t.attributes.CHA||10,c=t.attributes.SPD,d=Ro(t.equipment),u=t.statModifiers||{},p=1===u._overweight,m=r+(d.str||0)+(u.str||0),g=l+(d.dex||0)+(u.dex||0),h={strength:m,agility:p?`${g} (因物品栏超重而减半)`:g,intelligence:o+(d.int||0)+(u.int||0),charisma:i+(d.cha||0)+(u.cha||0),speed:void 0!==c?c+(d.spd||0)+(u.spd||0):void 0};return{name:t.base.name,level:t.base.level,race:t.base.race,class:t.base.class,gender:t.base.gender,age:t.base.age_bio,identity:t.base.identity,statusDesc:t.base.status_desc,hp:{current:t.stats.hp.current,max:t.stats.hp.max},mp:{current:t.stats.mp.current,max:t.stats.mp.max},sp:t.stats.sp?{current:t.stats.sp.current,max:t.stats.sp.max}:void 0,gold:e.inventory?.wallet?.ledger||0,location:a,attributes:h,isOverweight:p,appearance:t.appearance,privateInfo:t.private,world:e.world?{time:e.world.time||'未知时间',weather:e.world.weather||'未知天气'}:void 0,inventory:s,equipment:n}}async buildInjectsForGenerateRaw(e,t,a){const s=await this.buildInjectionParams(e,t,a);console.log('[PromptInjector] Building injects for generateRaw'),console.log('[PromptInjector] PlayerPanel name:',s.playerPanel?.name),console.log('[PromptInjector] PlayerPanel location:',s.playerPanel?.location),console.log('[PromptInjector] PlayerPanel HP:',s.playerPanel?.hp),console.log('[PromptInjector] Summaries count:',s.summaries?.length),console.log('[PromptInjector] RecentDialogs count:',s.recentDialogs?.length);const n=this.buildInjectsFromParams(s);return console.log('[PromptInjector] Generated injects count:',n.length),n.forEach((e,t)=>{const a=e.content.substring(0,100).replace(/\n/g,'\\n');console.log(`[PromptInjector] Inject[${t}]: depth=${e.depth}, role=${e.role}, scan=${e.should_scan}, preview="${a}..."`)}),n}buildInjectsFromParams(e){const t=[];if(e.adventureNotes&&this.config.enableAdventureNotes&&t.push({position:'in_chat',depth:this.config.adventureNotesDepth,role:'system',content:e.adventureNotes,should_scan:!1}),e.summaries.length>0){const a=`=== 历史摘要 ===\n${e.summaries.map((e,t)=>`${t+1}. ${e.summary}`).join('\n')}`;t.push({position:'in_chat',depth:this.config.summaryBaseDepth,role:'assistant',content:a,should_scan:!1})}const a=[];let s={};for(const t of e.recentDialogs)'user'===t.role?(s.user&&(a.push(s),s={}),s.user=t):'assistant'===t.role&&(s.assistant=t,a.push(s),s={});(s.user||s.assistant)&&a.push(s);const n=a.length;for(let e=0;e<n;e++){const s=a[e],r=n-e,l=r<=this.config.scanThreshold,o=l?'latest':'story',i=l?2*r:5+2*(r-this.config.scanThreshold);if(s.user&&t.push({position:'in_chat',depth:i+1,role:'user',content:s.user.content,should_scan:l}),s.assistant){const e=this.processAssistantContent(s.assistant.content,o);t.push({position:'in_chat',depth:i,role:'assistant',content:e,should_scan:l})}}const r=this.buildStateContent(e.playerPanel,e.teammates,e.offlineActions);if(t.push({position:'in_chat',depth:this.config.stateDepth,role:'system',content:r,should_scan:!1}),this.config.enableRelationInjection&&e.matchedCharacters&&e.matchedCharacters.length>0){const a=this.buildRelationContent(e.matchedCharacters);t.push({position:'in_chat',depth:this.config.relationDepth,role:'system',content:a,should_scan:!1})}return e.hiddenInstructions&&t.push({position:'in_chat',depth:0,role:this.config.hiddenRole,content:`<hidden>\n${e.hiddenInstructions}\n</hidden>`,should_scan:!1}),t}filterThinkingTags(e){let t=e;for(const e of Bi)t=t.replace(e,'');return t.trim()}extractTagContent(e,t){const a=Oi[t];if(!a)return null;const s=e.match(a);return s?s[1].trim():null}processAssistantContent(e,t){const a=this.filterThinkingTags(e),s=[];if('summary'===t){const e=this.extractTagContent(a,'summary');e&&s.push(`[回顾] ${e}`)}else if('story'===t){const e=this.extractTagContent(a,'content'),t=this.extractTagContent(a,'summary');e&&s.push(e),t&&s.push(`<summary>${t}</summary>`)}else{const e=this.extractTagContent(a,'content'),t=this.extractTagContent(a,'summary'),n=this.extractTagContent(a,'places'),r=this.extractTagContent(a,'npcs'),l=this.extractTagContent(a,'objects'),o=this.extractTagContent(a,'options');e&&s.push(e),t&&s.push(`<summary>${t}</summary>`),n&&s.push(`<places>${n}</places>`),r&&s.push(`<npcs>${r}</npcs>`),l&&s.push(`<objects>${l}</objects>`),o&&s.push(`<options>${o}</options>`)}return 0===s.length?a:s.join('\n\n')}inject(e){this.clear();const t=[];if(e.adventureNotes&&this.config.enableAdventureNotes&&t.push({id:'adventure-notes',position:'in_chat',depth:this.config.adventureNotesDepth,role:'system',content:e.adventureNotes,should_scan:!1}),e.summaries.length>0){const a=`=== 历史摘要 ===\n${e.summaries.map((e,t)=>`${t+1}. ${e.summary}`).join('\n')}`;t.push({id:'summary-block',position:'in_chat',depth:this.config.summaryBaseDepth,role:'assistant',content:a,should_scan:!1})}const a=[];let s={};for(const t of e.recentDialogs)'user'===t.role?(s.user&&(a.push(s),s={}),s.user=t):'assistant'===t.role&&(s.assistant=t,a.push(s),s={});(s.user||s.assistant)&&a.push(s);const n=a.length;for(let e=0;e<n;e++){const s=a[e],r=n-e,l=r<=this.config.scanThreshold,o=l?'latest':'story',i=l?2*r:5+2*(r-this.config.scanThreshold);if(s.user&&t.push({id:`dialog-user-${s.user.id||e}`,position:'in_chat',depth:i+1,role:'user',content:s.user.content,should_scan:l}),s.assistant){const a=this.processAssistantContent(s.assistant.content,o);t.push({id:`dialog-ai-${s.assistant.id||e}`,position:'in_chat',depth:i,role:'assistant',content:a,should_scan:l})}}const r=this.buildStateContent(e.playerPanel,e.teammates,e.offlineActions);if(t.push({id:'game-state',position:'in_chat',depth:this.config.stateDepth,role:'system',content:r,should_scan:!1}),this.config.enableRelationInjection&&e.matchedCharacters&&e.matchedCharacters.length>0){const a=this.buildRelationContent(e.matchedCharacters);t.push({id:'relation-characters',position:'in_chat',depth:this.config.relationDepth,role:'system',content:a,should_scan:!1})}e.currentUserInput&&t.push({id:'current-user-input',position:'in_chat',depth:0,role:'user',content:e.currentUserInput,should_scan:!0}),e.hiddenInstructions&&t.push({id:'hidden-instructions',position:'in_chat',depth:0,role:this.config.hiddenRole,content:`<hidden>\n${e.hiddenInstructions}\n</hidden>`,should_scan:!1});try{const e=injectPrompts(t);this.uninjectFn=e.uninject,this.loggerService?.log(`PromptInjector: 注入 ${t.length} 条提示词`)}catch(e){console.error('PromptInjector: 注入失败',e)}}buildStateContent(e,t,a){const s=[];a&&a.length>0&&s.push(`[系统事件]\n${a.map(e=>`- ${e}`).join('\n')}`);let n=`[玩家状态]\n${e.name} Lv.${e.level}`;if(e.race||e.class){n+=` (${[e.race,e.class].filter(Boolean).join(' ')})`}n+='\n';const r=[];if(e.gender&&r.push(e.gender),e.age&&r.push(`${e.age}岁`),e.identity&&r.push(e.identity),r.length>0&&(n+=`身份: ${r.join(' | ')}\n`),e.statusDesc&&(n+=`状态: ${e.statusDesc}\n`),e.appearance){const t=this.formatAppearanceInfo(e.appearance);t&&(n+=`外貌: ${t}\n`)}if(e.world&&(n+=`时间: ${e.world.time} | 天气: ${e.world.weather}\n`),n+=`位置: ${e.location}\n`,n+=`HP: ${e.hp.current}/${e.hp.max} | MP: ${e.mp.current}/${e.mp.max}`,e.sp&&(n+=` | SP: ${e.sp.current}/${e.sp.max}`),n+=`\n钱币: ${this.formatCurrency(e.gold)}`,n+=`\n属性: 力量${e.attributes.strength} 敏捷${e.attributes.agility} 智力${e.attributes.intelligence} 魅力${e.attributes.charisma}`,e.attributes.speed&&(n+=` 速度${e.attributes.speed}`),s.push(n),e.privateInfo&&Object.keys(e.privateInfo).length>0){const t=this.formatPrivateInfo(e.privateInfo);t&&s.push(`=== [身体信息] ===\n${t}`)}const l=this.saveService?.getGameState(),o=Object.values(l?.skills||{});if(o.length>0){const e=o.map(e=>{let t=e.icon?`${e.icon} ${e.name}`:e.name;return e.type&&(t+='passive'===e.type?' (被动)':' (主动)'),e.description&&(t+=` - ${e.description}`),`- ${t}`});s.push(`=== [技能栏] ===\n${e.join('\n')}`)}else s.push('=== [技能栏] ===\n(空)');const i={weapon_main:'主手武器',weapon_off:'副手武器',head:'头部',outer:'外套',upper:'上装',lower:'下装',shoes:'鞋子',underwear:'内衣',underpants:'内裤',socks:'袜子',accessory:'饰品',accessory_1:'饰品1',accessory_2:'饰品2',accessory_3:'饰品3',accessory_4:'饰品4'},c=[];for(const[t,a]of Object.entries(e.equipment)){const e=i[t]||t;if(a){let t=`${a.name}`;a.rarity&&(t+=` [${a.rarity}]`),a.description&&(t+=` - ${a.description}`),c.push(`${e}：${t}`)}else c.push(`${e}：空`)}if(c.length>0&&s.push(`=== [装备栏] ===\n${c.join('\n')}`),e.inventory.length>0){const t=e.inventory.map(e=>{let t=`${e.name} x${e.count}`;return e.rarity&&(t+=` [${e.rarity}]`),e.value&&(t+=` (价值:${e.value})`),e.description&&(t+=` - ${e.description}`),`- ${t}`});s.push(`=== [物品栏] ===\n${t.join('\n')}`)}else s.push('=== [物品栏] ===\n(空)');const d=l?.world?.quests;if(d&&Object.keys(d).length>0){const e=Object.entries(d).filter(([_,e])=>'active'===e.status).map(([e,t])=>{let a=`- ${t.name}`;return void 0!==t.progress&&(a+=` (${t.progress}%)`),t.desc&&(a+=`: ${t.desc}`),a});e.length>0&&s.push(`=== [进行中的任务] ===\n${e.join('\n')}`)}if(t&&t.length>0){const e=t.map(e=>{let t=`- ${e.name} Lv.${e.level} (${e.class}): HP ${e.hp.current}/${e.hp.max}`;return e.mp&&(t+=` | MP ${e.mp.current}/${e.mp.max}`),t+=` [${e.status}]`,e.appearance&&(t+=` 外观: ${e.appearance}`),t});s.push(`[队伍成员]\n${e.join('\n')}`)}return s.join('\n\n')}buildRelationContent(e){const t=[];t.push('[相关角色档案]'),t.push('以下是与当前对话相关的角色详细信息：\n');for(const a of e){const e=a.character,s=[];s.push(`【${e.name}】`),e.occupation&&s.push(`身份: ${e.occupation}`),e.appearance&&s.push(`外貌: ${e.appearance}`),e.personality&&s.push(`性格: ${e.personality}`),s.push(`好感度: ${e.rel}${this.getRelationshipLabel(e.rel)}`),e.relType&&s.push(`关系类型: ${e.relType}`),e.background&&s.push(`背景: ${e.background}`),e.likes&&s.push(`喜好: ${e.likes}`),e.dislikes&&s.push(`厌恶: ${e.dislikes}`),e.haunt&&s.push(`常出没: ${e.haunt}`),e.status&&s.push(`当前状态: ${e.status}`),e.location&&s.push(`当前位置: ${e.location}`),e.notes&&s.push(`备注: ${e.notes}`),e.motivation&&(e.motivation.current&&s.push(`当前动机: ${e.motivation.current}`),e.motivation.shortTerm&&s.push(`短期目标: ${e.motivation.shortTerm}`),e.motivation.longTerm&&s.push(`长期目标: ${e.motivation.longTerm}`)),e.deeds&&e.deeds.length>0&&s.push(`事迹: ${e.deeds.join('; ')}`),t.push(s.join('\n'))}return t.join('\n\n')}isValidAppearanceValue(e){if(!e)return!1;const t=e.trim();return''!==t&&'无'!==t&&'暂无'!==t&&'N/A'!==t&&'-'!==t}formatPrivateInfo(e){const t=[];for(const[a,s]of Object.entries(e)){if(null==s||''===s)continue;const e=Ei[a]||a;Array.isArray(s)?t.push(`${e}: ${s.join(', ')}`):t.push(`${e}: ${s}`)}return t.join('\n')}formatAppearanceInfo(e){const t=[],a=[];return this.isValidAppearanceValue(e.hair_color)&&a.push(e.hair_color),this.isValidAppearanceValue(e.hair_length)&&a.push(e.hair_length),this.isValidAppearanceValue(e.hair_style)&&a.push(e.hair_style),a.length>0&&t.push(a.join('')),this.isValidAppearanceValue(e.eye_color)&&t.push(`${e.eye_color}眼眸`),this.isValidAppearanceValue(e.height)&&t.push(`身高${e.height}`),this.isValidAppearanceValue(e.body_build)&&t.push(`${e.body_build}身材`),this.isValidAppearanceValue(e.skin_tone)&&t.push(`${e.skin_tone}肤色`),this.isValidAppearanceValue(e.face_features)&&t.push(e.face_features),this.isValidAppearanceValue(e.special_marks)&&t.push(e.special_marks),this.isValidAppearanceValue(e.racial_traits)&&t.push(e.racial_traits),t.join(', ')}getRelationshipLabel(e){return e>=80?' (亲密)':e>=50?' (友好)':e>=20?' (好感)':e>=0?' (中立)':e>=-30?' (冷淡)':e>=-60?' (敌意)':' (仇恨)'}async quickInject(e,t,a){const s=await this.buildInjectionParams(e,t,a);this.inject(s)}formatCurrency(e){const t=Math.floor(e/1e4),a=Math.floor(e%1e4/100),s=e%100,n=[];return t>0&&n.push(`${t}金`),a>0&&n.push(`${a}银`),(s>0||0===n.length)&&n.push(`${s}铜`),`${e} (${n.join(', ')})`}clear(){if(this.uninjectFn){try{this.uninjectFn()}catch(e){console.warn('PromptInjector: 清除注入时出错',e)}this.uninjectFn=null}}destroy(){this.clear()}}let Ui=null;class Vi{eventBus;logger;ruleSets=[];config={applyMode:'render',enabled:!0};STORAGE_KEY='game_regex_rules';CONFIG_KEY='game_regex_config';constructor(){this.eventBus=Ll.serviceLocator.get('EventBus'),this.logger=Ll.serviceLocator.get('LoggerService'),this.loadRules(),this.loadConfig()}loadConfig(){try{const e=localStorage.getItem(this.CONFIG_KEY);e&&(this.config={...this.config,...JSON.parse(e)})}catch(e){this.logger.error('RegexService: Failed to load config',e)}}saveConfig(){try{localStorage.setItem(this.CONFIG_KEY,JSON.stringify(this.config)),this.eventBus.emit('regex:config_updated',this.config)}catch(e){this.logger.error('RegexService: Failed to save config',e)}}getConfig(){return{...this.config}}setApplyMode(e){this.config.applyMode=e,this.saveConfig(),this.logger.log(`RegexService: Apply mode set to ${e}`)}getApplyMode(){return this.config.applyMode}setEnabled(e){this.config.enabled=e,this.saveConfig()}isEnabled(){return this.config.enabled}getRecommendedMaxDepth(e){return'render'===e?-1:1}parseRegexLiteral(e){if(!e||'string'!=typeof e)return null;const t=e.trim();if(!t.startsWith('/'))return null;const a=t.lastIndexOf('/');if(a<=0)return null;const s=t.slice(1,a),n=t.slice(a+1);return n&&!/^[gimsuy]*$/.test(n)?null:{pattern:s,flags:n}}toRegexLiteral(e,t){if('string'==typeof e){const a=e;return this.parseRegexLiteral(a)?a:`/${a}/${t||''}`}const a=e;return a.regex?a.regex:`/${a.pattern}/${a.flags}`}getPatternAndFlags(e,t=''){if('string'==typeof e){const a=this.parseRegexLiteral(e);return a||{pattern:e,flags:t}}const a=e;if(a.regex){const e=this.parseRegexLiteral(a.regex);if(e)return e}return{pattern:a.pattern,flags:a.flags}}normalizeRule(e){if(e.regex){const t=this.parseRegexLiteral(e.regex);if(t)return{...e,pattern:t.pattern,flags:t.flags}}return{...e,regex:`/${e.pattern}/${e.flags}`}}loadRules(){try{const e=localStorage.getItem(this.STORAGE_KEY);e?(this.ruleSets=JSON.parse(e),this.logger.log('RegexService: Loaded rules from storage')):this.ruleSets=[this.createDefaultRuleSet()],this.ensureSystemRuleSet()}catch(e){this.logger.error('RegexService: Failed to load rules',e),this.ruleSets=[this.createDefaultRuleSet()],this.ensureSystemRuleSet()}}ensureSystemRuleSet(){const e='__system__';let t=this.ruleSets.find(t=>t.id===e);t?(t.enabled=!0,t.applyMode='render',t.isSystem=!0):(t={id:e,name:'🔒 系统内置规则（屏蔽标签）',rules:[],enabled:!0,applyMode:'render',isSystem:!0},this.ruleSets.unshift(t));const a=[{name:'屏蔽 thinking 标签',pattern:'<thinking>[\\s\\S]*?</thinking>',replacement:'',order:0},{name:'屏蔽 think 标签',pattern:'<think>[\\s\\S]*?</think>',replacement:'',order:1},{name:'优先显示优化内容',pattern:'<content>[\\s\\S]*?</content>[\\s\\S]*?<optimized>([\\s\\S]*?)</optimized>',replacement:'$1',order:2},{name:'删除 content 标签保留内容',pattern:'<content>([\\s\\S]*?)</content>',replacement:'$1',order:3},{name:'屏蔽 summary 标签',pattern:'<summary>[\\s\\S]*?</summary>',replacement:'',order:4},{name:'屏蔽 exits 标签',pattern:'<exits>[\\s\\S]*?</exits>',replacement:'',order:5},{name:'屏蔽 npcs 标签',pattern:'<npcs>[\\s\\S]*?</npcs>',replacement:'',order:6},{name:'屏蔽 objects 标签',pattern:'<objects>[\\s\\S]*?</objects>',replacement:'',order:7},{name:'屏蔽 pic 标签（完整格式）',pattern:'<pic\\s*=\\s*["\'][\\s\\S]*?["\']\\s*/?>',replacement:'',order:8},{name:'屏蔽 pic 闭合标签',pattern:'<pic>[\\s\\S]*?</pic>',replacement:'',order:9},{name:'屏蔽 hidden 标签',pattern:'<hidden>[\\s\\S]*?</hidden>',replacement:'',order:10},{name:'屏蔽 options 标签',pattern:'<options>[\\s\\S]*?</options>',replacement:'',order:11}];for(const e of a){const a=t.rules.find(t=>t.name===e.name);a?(a.replacement=e.replacement,a.pattern=e.pattern,a.regex=`/${e.pattern}/gi`):t.rules.push({id:`__system_rule_${e.order}__`,name:e.name,pattern:e.pattern,replacement:e.replacement,flags:'gi',regex:`/${e.pattern}/gi`,minDepth:0,maxDepth:-1,enabled:!0,order:e.order})}}saveRules(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.ruleSets)),this.eventBus.emit('regex:rules_updated')}catch(e){this.logger.error('RegexService: Failed to save rules',e)}}createDefaultRuleSet(){return{id:'default',name:'默认规则集',rules:[],enabled:!0}}getRuleSets(){return[...this.ruleSets]}getRuleSet(e){return this.ruleSets.find(t=>t.id===e)}addRuleSet(e){const t={id:`ruleset_${Date.now()}`,name:e,rules:[],enabled:!0};return this.ruleSets.push(t),this.saveRules(),t}removeRuleSet(e){if('__system__'===e)return this.logger.log('RegexService: Cannot remove system rule set'),!1;const t=this.ruleSets.findIndex(t=>t.id===e);return-1!==t&&(this.ruleSets.splice(t,1),this.saveRules(),!0)}addRule(e,t){const a=this.ruleSets.find(t=>t.id===e);if(!a)return null;const s={...t,id:`rule_${Date.now()}`,order:a.rules.length};return a.rules.push(s),this.saveRules(),s}updateRule(e,t,a){const s=this.ruleSets.find(t=>t.id===e);if(!s)return!1;const n=s.rules.find(e=>e.id===t);return!!n&&(Object.assign(n,a),this.saveRules(),!0)}removeRule(e,t){const a=this.ruleSets.find(t=>t.id===e);if(!a)return!1;const s=a.rules.findIndex(e=>e.id===t);return-1!==s&&(a.rules.splice(s,1),this.saveRules(),!0)}validatePattern(e,t=''){try{const a=this.parseRegexLiteral(e);return a?new RegExp(a.pattern,a.flags):new RegExp(e,t),{valid:!0}}catch(e){return{valid:!1,error:e.message}}}processMacros(e){return e.replace(/\{\{random:(.+?)\}\}/g,(e,t)=>{const a=t.split('::').map(e=>e.trim());if(0===a.length)return e;return a[Math.floor(Math.random()*a.length)]})}applyRule(e,t){if(!t.enabled)return{text:e,matchCount:0};try{const{pattern:a,flags:s}=this.getPatternAndFlags(t),n=new RegExp(a,s);let r=0;const l=this.processMacros(t.replacement);return{text:e.replace(n,(...e)=>{r++;let t=l;for(let a=1;a<e.length-2;a++)t=t.replace(new RegExp(`\\$${a}`,'g'),e[a]||'');return t}),matchCount:r}}catch(a){return this.logger.error(`RegexService: Failed to apply rule ${t.name}`,a),{text:e,matchCount:0}}}applyAllRules(e,t=0){const a={originalText:e,modifiedText:e,matchCount:0,rulesApplied:[]},s=[];for(const e of this.ruleSets){if(!e.enabled)continue;let a;a=e.isSystem?'render':e.applyMode?e.applyMode:this.config.applyMode;for(const n of e.rules){if(!n.enabled)continue;if(t<n.minDepth)continue;if(-1!==n.maxDepth&&t>n.maxDepth)continue;const r=n.mode||a;s.push({rule:n,setName:e.name,applyMode:r})}}s.sort((e,t)=>e.rule.order-t.rule.order);let n=e;for(const{rule:e,setName:t}of s){const{text:s,matchCount:r}=this.applyRule(n,e);r>0&&(n=s,a.matchCount+=r,a.rulesApplied.push(`${t}/${e.name}`))}return a.modifiedText=n,a}previewRule(e,t,a,s=''){const n={originalText:e,modifiedText:e,matchCount:0,rulesApplied:['预览']};try{let r=t,l=s;const o=this.parseRegexLiteral(t);o&&(r=o.pattern,l=o.flags);const i=new RegExp(r,l);let c=0;const d=this.processMacros(a);n.modifiedText=e.replace(i,(...e)=>{c++;let t=d;for(let a=1;a<e.length-2;a++)t=t.replace(new RegExp(`\\$${a}`,'g'),e[a]||'');return t}),n.matchCount=c}catch(e){this.logger.error('RegexService: Preview failed',e)}return n}getMacroHelp(){return'支持的宏:\n• {{random:选项1::选项2::选项3}} - 从给定选项中随机选择一个\n\n示例:\n• 替换为 {{random:你好::您好::哈喽}} → 随机输出其中一个问候语\n• 替换为 {{random:$1很棒::$1太强了}} → 结合捕获组使用'}importRules(e){try{const t=JSON.parse(e),a=Array.isArray(t)?t:[t];let s=0;for(const e of a){if(!e.name||!Array.isArray(e.rules))continue;const t={id:`imported_${Date.now()}_${s}`,name:e.name+' (导入)',rules:e.rules.map((e,t)=>{let a=e.pattern||'',s=e.flags||'g',n=e.regex;if(n){const e=this.parseRegexLiteral(n);e&&(a=e.pattern,s=e.flags)}else n=`/${a}/${s}`;return{id:`imported_rule_${Date.now()}_${t}`,name:e.name||`规则${t+1}`,pattern:a,replacement:e.replacement||'',flags:s,regex:n,minDepth:e.minDepth??0,maxDepth:e.maxDepth??-1,enabled:e.enabled??!0,order:e.order??t,mode:e.mode}}),enabled:!0};this.ruleSets.push(t),s++}return s>0?(this.saveRules(),{success:!0,message:`成功导入 ${s} 个规则集`,imported:s}):{success:!1,message:'没有有效的规则集可导入'}}catch(e){return{success:!1,message:`导入失败: ${e.message}`}}}exportRules(e,t=!0){const a=e?this.ruleSets.filter(t=>e.includes(t.id)):this.ruleSets;if(t){const e=a.map(e=>({name:e.name.replace(' (导入)',''),enabled:e.enabled,rules:e.rules.map(e=>({name:e.name,regex:this.toRegexLiteral(e),replacement:e.replacement,minDepth:e.minDepth,maxDepth:e.maxDepth,enabled:e.enabled,order:e.order,mode:e.mode}))}));return JSON.stringify(e,null,2)}return JSON.stringify(a,null,2)}migrateRules(){let e=0;for(const t of this.ruleSets)for(const a of t.rules)a.regex||(a.regex=`/${a.pattern}/${a.flags}`,e++);return e>0&&(this.saveRules(),this.logger.log(`RegexService: Migrated ${e} rules to new format`)),e}toggleRuleSet(e){const t=this.ruleSets.find(t=>t.id===e);return!!t&&(t.enabled=!t.enabled,this.saveRules(),t.enabled)}toggleRule(e,t){const a=this.ruleSets.find(t=>t.id===e);if(!a)return!1;const s=a.rules.find(e=>e.id===t);return!!s&&(s.enabled=!s.enabled,this.saveRules(),s.enabled)}}class Fi extends Bl{constructor(){super('RNGService')}init(){console.log('RNGService initialized')}roll(e,t){let a=0;for(let s=0;s<e;s++)a+=Math.floor(Math.random()*t)+1;return a}rollDice(e='1d4'){if('string'!=typeof e)return 0;const t=e.match(/(\d+)d(\d+)(?:\s*([+-])\s*(\d+))?/i);if(!t)return 0;const[,a,s,n,r]=t,l=parseInt(a,10),o=parseInt(s,10),i=parseInt(r||'0',10);let c=0;for(let e=0;e<l;e++)c+=Math.floor(Math.random()*o)+1;return'-'===n?c-i:c+i}calculateAverageValue(e){if('string'!=typeof e&&'number'!=typeof e)return 0;const t=String(e).trim(),a=t.match(/(\d+)d(\d+)(?:\s*([+-])\s*(\d+))?/i);if(a){const[,e,t,s,n]=a,r=parseInt(e,10)*(1+parseInt(t,10))/2,l=parseInt(n||'0',10);return Math.round('-'===s?r-l:r+l)}const s=parseInt(t,10);return isNaN(s)?0:s}}class Hi extends Bl{gameState=null;levelService;loggerService;rngService;nodeMapService;offlineActionService;commandQueueService;constructor(){super('SaveService')}async init(){const e=Ll.q.getInstance();this.levelService=e.get('LevelService'),this.loggerService=e.get('LoggerService'),this.rngService=e.get('RNGService');try{this.offlineActionService=e.get('OfflineActionService')}catch{}console.log('SaveService initialized')}getOfflineActionService(){if(!this.offlineActionService)try{this.offlineActionService=Ll.q.getInstance().get('OfflineActionService')}catch{}return this.offlineActionService}getCommandQueueService(){if(!this.commandQueueService)try{this.commandQueueService=Ll.q.getInstance().get('CommandQueueService')}catch{}return this.commandQueueService}async hasSaveData(){try{return!!await mi.storyDB.getSaveSlot(0)}catch(e){return console.error('Error checking save data:',e),!1}}async createNewGame(e){await mi.storyDB.clearActiveSession(),this.getOfflineActionService()?.clearActions(),this.loggerService?.log('Cleared offline actions for new game'),this.getCommandQueueService()?.clearAll(),this.loggerService?.log('Cleared command queue for new game'),this.gameState=e,this.ensureStructure(this.gameState),await this.saveToSlot(0,'Autosave - New Game')}getGameState(){return this.gameState}async loadData(){this.loggerService?.log('Loading game data from StoryDB...');const e=await mi.storyDB.getLatestSnapshot();let t=e?e.gameState:null;t?this.ensureStructure(t):(this.loggerService?.log('No existing data found, creating empty state.'),t={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}}),this.gameState=t;return await this.runInitialCorrector(this.gameState)&&(this.loggerService?.log('Data corrected, saving updates...'),await this.saveData()),this.gameState}async saveData(e){if(this.gameState)try{await this.saveToSlot(0,e||'Autosave'),this.loggerService?.log('Game saved successfully.')}catch(e){console.error('Save failed:',e),this.loggerService?.error('Failed to save game data.')}}async saveToSlot(e,t){if(this.gameState)try{const a=new Date,s=t||`Save Slot ${e} - ${a.toLocaleString()}`;await mi.storyDB.saveToSlot(e,this.gameState,s,0),this.loggerService?.log(`Game saved to slot ${e}.`)}catch(t){throw console.error(`Failed to save to slot ${e}:`,t),t}}async loadFromSlot(e){try{const t=await mi.storyDB.getSaveSlot(e);if(t){if(await mi.storyDB.clearActiveSession(),t.storyRecords&&t.storyRecords.length>0){for(const e of t.storyRecords){const{id:t,...a}=e;await mi.storyDB.addRecord(a)}this.loggerService?.log(`Restored ${t.storyRecords.length} chat records from slot ${e}.`)}if(t.snapshots&&t.snapshots.length>0){const a=Math.max(...t.snapshots.map(e=>e.version));for(const e of t.snapshots){const{id:t,...a}=e;await mi.storyDB.snapshots.add(a)}this.loggerService?.log(`Restored ${t.snapshots.length} snapshots from slot ${e}, max version: ${a}.`)}return this.gameState=t.gameState,this.ensureStructure(this.gameState),await this.runInitialCorrector(this.gameState),this.getOfflineActionService()?.clearActions(),this.loggerService?.log(`Game loaded from slot ${e}, offline actions cleared.`),this.getCommandQueueService()?.clearAll(),this.loggerService?.log(`Command queue cleared for slot ${e} load.`),!0}}catch(t){console.error(`Failed to load from slot ${e}:`,t)}return!1}async getAllSlots(){return await mi.storyDB.getAllSlots()}async deleteSlot(e){await mi.storyDB.deleteSlot(e)}async renameSlot(e,t){await mi.storyDB.renameSlot(e,t)}async undo(){const e=await mi.storyDB.getPreviousSnapshot(1);return e?(this.gameState=e.gameState,await this.saveData(`Undo to ${new Date(e.timestamp).toLocaleTimeString()}`),this.loggerService?.log('Game state reverted.'),!0):(this.loggerService?.warn('No previous snapshot to revert to.'),!1)}async deleteMessageAndRestoreState(e){try{const t=await mi.storyDB.deleteRecordAndGetRestorePoint(e);if(t){const e=await mi.storyDB.getSnapshotById(t);if(e)return this.gameState=e.gameState,this.ensureStructure(this.gameState),this.loggerService?.log(`Message deleted, game state restored to snapshot ${t}.`),!0}return this.loggerService?.warn('No previous snapshot to restore, messages deleted but state unchanged.'),!0}catch(e){return console.error('Failed to delete message and restore state:',e),this.loggerService?.error('Failed to delete message.'),!1}}async rewindTo(e){const t=await mi.storyDB.getSnapshotBefore(e);return t?(this.gameState=t.gameState,await this.saveData(`Rewind to ${new Date(t.timestamp).toLocaleTimeString()}`),this.loggerService?.log(`Game state rewinded to before ${new Date(e).toLocaleTimeString()}.`),!0):(this.loggerService?.warn('No suitable snapshot found for rewind.'),!1)}async exportSave(){if(!this.gameState)throw new Error('No game state to export');const e={version:1,timestamp:Date.now(),gameState:this.gameState};return JSON.stringify(e,null,2)}async exportSlot(e){const t=await mi.storyDB.getSaveSlot(e);if(!t)throw new Error(`Slot ${e} is empty`);const a={version:1,timestamp:t.timestamp,gameState:t.gameState};return JSON.stringify(a,null,2)}async importSave(e){try{const t=JSON.parse(e);if(!t.gameState)throw new Error('Invalid save file format');return this.gameState=t.gameState,this.ensureStructure(this.gameState),await this.saveData('Imported Save'),this.loggerService?.log('Game imported successfully.'),!0}catch(e){return console.error('Failed to import save:',e),this.loggerService?.error('Failed to import save data.'),!1}}ensureStructure(e){e.player||(e.player={base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}}),e.world||(e.world={date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]}),e.player.battleSettings||(e.player.battleSettings={autoBattle:!1,speedMultiplier:1}),e.allies||(e.allies=[]),e.inventory||(e.inventory={wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}}),e.scene||(e.scene={locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}}),e.relation||(e.relation={characters:{},factions:{}}),e.nodeMap||(e.nodeMap=Ai()),this.syncNodeMapToService(e)}syncNodeMapToService(e){if(!this.nodeMapService)try{this.nodeMapService=Ll.q.getInstance().get('NodeMapService')}catch{return}if(e.nodeMap&&this.nodeMapService.setGraph(e.nodeMap),e.scene?.locationPath&&e.scene.locationPath.length>0){const t=e.world?.date&&e.world?.time?`${e.world.date} ${e.world.time}`:void 0;this.nodeMapService.insertLocationPath(e.scene.locationPath,e.scene.desc,t),e.nodeMap=this.nodeMapService.getGraph()}}updateNodeMap(e,t){if(!this.gameState)return;if(!this.nodeMapService)try{this.nodeMapService=Ll.q.getInstance().get('NodeMapService')}catch{return}const a=this.gameState.world?.date&&this.gameState.world?.time?`${this.gameState.world.date} ${this.gameState.world.time}`:void 0;this.nodeMapService.insertLocationPath(e,t,a),this.gameState.nodeMap=this.nodeMapService.getGraph()}async runInitialCorrector(e){if(!e||!this.levelService||!this.rngService)return!1;let t=!1;const a=e.player?.stats;a&&['hp','mp','sp'].forEach(e=>{const s=a[e];if(s){const e=s.current;let a=Math.max(0,s.current);a=Math.min(s.max,a),a!==e&&(s.current=a,t=!0)}});const s=e.player?.base;if(s&&s.exp&&s.exp.current>=s.exp.max)for(t=!0,this.loggerService?.log('EXP overflow detected, processing level up...'),s.level=s.level||1;s.exp.current>=s.exp.max&&s.level<99;)s.exp.current-=s.exp.max,s.level++,a?.hp&&(a.hp.max+=10),a?.mp&&(a.mp.max+=5),a?.sp&&(a.sp.max+=5),s.exp.max=100*s.level,this.loggerService?.log(`Leveled up to Lv.${s.level}!`);return t}}class Gi extends Bl{constructor(){super('ShieldService')}async init(){}createShield(e){return{id:t(),name:e.name,value:e.value,max:e.value,type:e.type,priority:e.priority??50,expiration:e.duration??-1,sourceId:e.sourceId,sourceName:e.sourceName,absorbTypes:e.absorbTypes,onBreakEffects:e.onBreakEffects}}addShield(e,t){const a=this.createShield(t);return e.shields.push(a),this.sortShields(e),this.eventBus.emit('shield:added',{unit:e,shield:a}),a}sortShields(e){e.shields.sort((e,t)=>t.priority-e.priority)}absorbDamage(e,t,a){const s={originalDamage:t,absorbedDamage:0,remainingDamage:t,consumedShields:[],fullyAbsorbed:!1};if(t<=0||0===e.shields.length)return s;this.sortShields(e);const n=e.shields.filter(e=>'count'===e.type&&e.value>0&&this.canAbsorbType(e,a));if(n.length>0){const a=n[0];return a.value-=1,s.consumedShields.push({shield:a,absorbed:t,broken:a.value<=0}),s.absorbedDamage=t,s.remainingDamage=0,s.fullyAbsorbed=!0,a.value<=0&&this.handleShieldBreak(e,a),s}const r=e.shields.filter(e=>'value'===e.type&&e.value>0&&this.canAbsorbType(e,a));let l=t;for(const t of r){if(l<=0)break;const a=Math.min(t.value,l);t.value-=a,l-=a,s.consumedShields.push({shield:t,absorbed:a,broken:t.value<=0}),t.value<=0&&this.handleShieldBreak(e,t)}return s.absorbedDamage=t-l,s.remainingDamage=l,s.fullyAbsorbed=l<=0,s}canAbsorbType(e,t){return!e.absorbTypes||0===e.absorbTypes.length||(!t||e.absorbTypes.includes(t))}handleShieldBreak(e,t){const a=e.shields.indexOf(t);a>-1&&e.shields.splice(a,1),this.eventBus.emit('shield:broken',{unit:e,shield:t}),t.onBreakEffects&&t.onBreakEffects.length>0&&this.eventBus.emit('shield:break_effects',{unit:e,shield:t,effects:t.onBreakEffects})}removeShield(e,t){const a=e.shields.findIndex(e=>e.id===t);if(a>-1){const t=e.shields.splice(a,1)[0];return this.eventBus.emit('shield:removed',{unit:e,shield:t}),!0}return!1}removeAllShields(e){const t=[...e.shields];return e.shields=[],t.forEach(t=>{this.eventBus.emit('shield:removed',{unit:e,shield:t})}),t}removeShieldsBySource(e,t){const a=[];return e.shields=e.shields.filter(e=>e.sourceId!==t||(a.push(e),!1)),a.forEach(t=>{this.eventBus.emit('shield:removed',{unit:e,shield:t})}),a}refreshShield(e,t,a){const s=e.shields.find(e=>e.id===t);return!!s&&(void 0!==a?(s.value=a,s.max=Math.max(s.max,a)):s.value=s.max,this.eventBus.emit('shield:refreshed',{unit:e,shield:s}),!0)}stackShield(e,t){const a=e.shields.find(e=>e.name===t.name);return a?(a.value+=t.value,a.max=Math.max(a.max,a.value),void 0!==t.duration&&(a.expiration=t.duration),this.eventBus.emit('shield:stacked',{unit:e,shield:a}),a):this.addShield(e,t)}tickShields(e){const t=[];e.shields=e.shields.filter(e=>void 0===e.expiration||-1===e.expiration||(e.expiration-=1,!(e.expiration<=0)||(t.push(e),!1))),t.forEach(t=>{this.eventBus.emit('shield:expired',{unit:e,shield:t})})}getTotalShieldValue(e){return e.shields.filter(e=>'value'===e.type).reduce((e,t)=>e+t.value,0)}getTotalShieldCharges(e){return e.shields.filter(e=>'count'===e.type).reduce((e,t)=>e+t.value,0)}hasShield(e){return e.shields.some(e=>e.value>0)}hasInvincibility(e){return e.shields.some(e=>'count'===e.type&&e.value>0)}}const zi=3,Wi=6;class Qi extends Bl{templates=new Map;activeSummons=new Map;constructor(){super('SummonService')}async init(){this.registerDefaultTemplates()}registerTemplate(e){this.templates.set(e.id,e)}getTemplate(e){return this.templates.get(e)}createSummon(e,t,a){const s=this.templates.get(t);if(!s)return{success:!1,message:`未找到召唤物模板: ${t}`};const n=this.getSummonsBySummoner(e.id);if(n.length>=zi){const t=n[0];return this.destroySummon(t.id,a),this.createSummonInternal(e,s,a,t)}if(this.activeSummons.size>=Wi){const t=Array.from(this.activeSummons.values())[0];return this.destroySummon(t.id,a),this.createSummonInternal(e,s,a,t)}return this.createSummonInternal(e,s,a)}createSimpleSummon(e,t,a){const s=this.getSummonsBySummoner(e.id);let n;if(s.length>=zi){const e=s[0];this.destroySummon(e.id,a),n=e}else if(this.activeSummons.size>=Wi){const e=Array.from(this.activeSummons.values())[0];this.destroySummon(e.id,a),n=e}return t.templateId?this.createFromTemplateWithCustomName(e,t,a,n):this.createSimpleSummonInternal(e,t,a,n)}createFromTemplateWithCustomName(e,a,s,n){const r=this.templates.get(a.templateId);if(!r)return console.warn(`[SummonService] Template "${a.templateId}" not found, falling back to simple summon`),this.createSimpleSummonInternal(e,a,s,n);const l=t(),o=`summon_${l}`,i=a.name,c=Math.max(1,(e.level||1)-2),d=this.calcSummonStats(c),u={id:o,name:i,isPlayer:e.isPlayer,isAlly:e.isAlly,level:c,stats:{hp:{current:d.hp,max:d.hp},mp:{current:d.mp,max:d.mp},sp:{current:d.sp,max:d.sp}},attributes:{STR:r.baseStats.str,DEX:r.baseStats.dex,CON:r.baseStats.con,INT:r.baseStats.int,WIS:r.baseStats.wis,CHA:r.baseStats.cha,SPD:r.baseStats.spd},statModifiers:{},statusEffects:[],shields:[],skills:{...r.skills},isDead:!1,isStunned:!1,hasActed:!1,isSummon:!0,summonerId:e.id,aiType:a.aiType||r.aiType},p=a.duration??r.duration,m={id:l,templateId:a.templateId,summonerId:e.id,name:i,remainingDuration:p,combatantRef:o};return this.activeSummons.set(l,m),e.summons||(e.summons=[]),e.summons.push(m),s&&s.addUnit(o,i,r.baseStats.spd,e.isPlayer||!!e.isAlly,{isSummon:!0,summonerId:e.id,initialPosition:5e3}),this.eventBus.emit('summon:created',{summoner:e,summon:m,combatant:u,isTemplateWithCustomName:!0}),{success:!0,summonId:l,combatant:u,replacedSummon:n}}createSimpleSummonInternal(e,a,s,n){const r=t(),l=`summon_${r}`,o=Math.max(1,(e.level||1)-2),i=a.inherit??.5,c={STR:Math.floor((e.attributes.STR||10)*i),DEX:Math.floor((e.attributes.DEX||10)*i),CON:Math.floor((e.attributes.CON||10)*i),INT:Math.floor((e.attributes.INT||10)*i),WIS:Math.floor((e.attributes.WIS||10)*i),CHA:Math.floor((e.attributes.CHA||10)*i),SPD:Math.floor((e.attributes.SPD||10)*i)},d=this.calcSummonStats(o);let u={basic_attack:this.getDefaultBasicAttackSkill(c.STR)[0]};if(a.skillKey&&'basic_attack'!==a.skillKey){const t=e.skills?.[a.skillKey];t&&(u={basic_attack:{...t}})}const p={id:l,name:a.name,isPlayer:e.isPlayer,isAlly:!!e.isAlly,level:o,stats:{hp:{current:d.hp,max:d.hp},mp:{current:d.mp,max:d.mp},sp:{current:d.sp,max:d.sp}},attributes:c,statModifiers:{},statusEffects:[],shields:[],skills:u,isDead:!1,isStunned:!1,hasActed:!1,isSummon:!0,summonerId:e.id,aiType:a.aiType||'aggressive'},m=a.duration??3,g={id:r,templateId:`simple_${a.name}`,summonerId:e.id,name:a.name,remainingDuration:m,combatantRef:l};if(this.activeSummons.set(r,g),e.summons||(e.summons=[]),e.summons.push(g),s){const t=10*c.SPD;s.addUnit(l,a.name,t,e.isPlayer||!!e.isAlly,{isSummon:!0,summonerId:e.id,initialPosition:5e3})}return this.eventBus.emit('summon:created',{summoner:e,summon:g,combatant:p,isSimple:!0}),{success:!0,summonId:r,combatant:p,replacedSummon:n}}getDefaultBasicAttackSkill(e){const t=Math.floor((e-10)/2);return[{name:'普通攻击',type:'active',tier:1,tags:['physical','melee','basic'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:t>=0?`1d6+${t}`:`1d6${t}`,tags:['physical']}]}]}createSummonInternal(e,a,s,n){const r=t(),l=`summon_${r}`,o=Math.max(1,(e.level||1)-2),i=this.calcSummonStats(o),c={id:l,name:a.name,isPlayer:e.isPlayer,level:o,stats:{hp:{current:i.hp,max:i.hp},mp:{current:i.mp,max:i.mp},sp:{current:i.sp,max:i.sp}},attributes:{STR:a.baseStats.str,DEX:a.baseStats.dex,CON:a.baseStats.con,INT:a.baseStats.int,WIS:a.baseStats.wis,CHA:a.baseStats.cha,SPD:a.baseStats.spd},statModifiers:{},statusEffects:[],shields:[],skills:{...a.skills},isDead:!1,isStunned:!1,hasActed:!1,isSummon:!0,summonerId:e.id,aiType:a.aiType},d={id:r,templateId:a.id,summonerId:e.id,name:a.name,remainingDuration:a.duration,combatantRef:l};return this.activeSummons.set(r,d),e.summons||(e.summons=[]),e.summons.push(d),s&&s.addUnit(l,a.name,a.baseStats.spd,e.isPlayer,{isSummon:!0,summonerId:e.id,initialPosition:5e3}),this.eventBus.emit('summon:created',{summoner:e,summon:d,combatant:c}),{success:!0,summonId:r,combatant:c,replacedSummon:n}}destroySummon(e,t){const a=this.activeSummons.get(e);return!!a&&(t&&t.removeUnit(a.combatantRef),this.activeSummons.delete(e),this.eventBus.emit('summon:destroyed',{summon:a}),!0)}destroyAllSummonsBySummoner(e,t){const a=this.getSummonsBySummoner(e);return a.forEach(e=>this.destroySummon(e.id,t)),a.length}getSummonsBySummoner(e){return Array.from(this.activeSummons.values()).filter(t=>t.summonerId===e)}getAllActiveSummons(){return Array.from(this.activeSummons.values())}tickSummon(e,t){const a=this.activeSummons.get(e);return!!a&&(-1===a.remainingDuration||(a.remainingDuration--,!(a.remainingDuration<=0)||(this.destroySummon(e,t),this.eventBus.emit('summon:expired',{summon:a}),!1)))}isSummon(e){return Array.from(this.activeSummons.values()).some(t=>t.combatantRef===e)}getSummonerId(e){const t=Array.from(this.activeSummons.values()).find(t=>t.combatantRef===e);return t?.summonerId}calcSummonStats(e){return{hp:25+4*e,mp:20+2*e,sp:25+3*e}}registerDefaultTemplates(){const e=this.calcSummonStats(3);this.registerTemplate({id:'skeleton_warrior',name:'骷髅战士',description:'由死灵法术召唤的骷髅战士',baseStats:{hp:e.hp,mp:e.mp,sp:e.sp,str:12,dex:10,con:10,int:6,wis:6,cha:4,spd:80},skills:{skeleton_slash:{name:'骨刃斩',type:'active',tier:1,tags:['physical','slashing'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['physical','slashing']}]}},duration:5,summonType:'minion',aiType:'aggressive'});const t=this.calcSummonStats(2);this.registerTemplate({id:'healing_sprite',name:'治疗精灵',description:'光明系的治疗精灵',baseStats:{hp:t.hp,mp:t.mp,sp:t.sp,str:4,dex:14,con:8,int:14,wis:16,cha:12,spd:100},skills:{sprite_heal:{name:'治愈之光',type:'active',tier:1,tags:['magic','light','heal'],cooldown:1,target:'single_ally',cost:{mp:10},effects:[{trigger:'immediate',action:'heal',target:'target',value:'2d4+5'}]}},duration:4,summonType:'spirit',aiType:'support'});const a=this.calcSummonStats(2);this.registerTemplate({id:'fire_totem',name:'火焰图腾',description:'固定的火焰图腾，对敌人造成持续伤害',baseStats:{hp:a.hp,mp:a.mp,sp:a.sp,str:0,dex:0,con:15,int:12,wis:10,cha:0,spd:50},skills:{totem_burn:{name:'灼烧',type:'active',tier:1,tags:['magic','fire'],cooldown:0,target:'all_enemies',effects:[{trigger:'immediate',action:'damage',target:'all_enemies',value:'1d4+2',tags:['magic','fire']}]}},duration:3,summonType:'turret',aiType:'aggressive'});const s=this.calcSummonStats(3);this.registerTemplate({id:'battle_wolf',name:'战狼',description:'忠诚的战斗伙伴',baseStats:{hp:s.hp,mp:s.mp,sp:s.sp,str:14,dex:14,con:10,int:4,wis:12,cha:6,spd:120},skills:{wolf_bite:{name:'撕咬',type:'active',tier:1,tags:['physical','piercing'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+4',tags:['physical','piercing']}]}},duration:4,summonType:'minion',aiType:'aggressive'});const n=this.calcSummonStats(4);this.registerTemplate({id:'ice_elemental',name:'冰元素',description:'由冰霜魔法凝聚的元素生物',baseStats:{hp:n.hp,mp:n.mp,sp:n.sp,str:10,dex:8,con:14,int:14,wis:10,cha:6,spd:70},skills:{frost_bolt:{name:'冰霜箭',type:'active',tier:1,tags:['magic','ice'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['magic','ice']},{trigger:'on_hit',action:'debuff',target:'target',statusName:'冰冻',duration:1,chance:20}]}},duration:4,summonType:'minion',aiType:'aggressive'});const r=this.calcSummonStats(6);this.registerTemplate({id:'stone_golem',name:'石魔像',description:'坚固的石头守护者',baseStats:{hp:r.hp,mp:r.mp,sp:r.sp,str:16,dex:6,con:18,int:4,wis:8,cha:4,spd:40},skills:{golem_slam:{name:'重击',type:'active',tier:1,tags:['physical','bludgeoning'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+5',tags:['physical','bludgeoning']}]}},duration:5,summonType:'minion',aiType:'defensive'});const l=this.calcSummonStats(3);this.registerTemplate({id:'ghost_archer',name:'幽灵弓手',description:'来自彼岸的幽魂射手',baseStats:{hp:l.hp,mp:l.mp,sp:l.sp,str:8,dex:16,con:8,int:10,wis:12,cha:8,spd:100},skills:{spectral_arrow:{name:'幽魂箭',type:'active',tier:1,tags:['physical','dark'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+5',tags:['piercing','dark']}]}},duration:3,summonType:'minion',aiType:'aggressive'});const o=this.calcSummonStats(2);this.registerTemplate({id:'shadow_clone',name:'暗影分身',description:'由阴影凝聚的分身',baseStats:{hp:o.hp,mp:o.mp,sp:o.sp,str:12,dex:14,con:8,int:10,wis:10,cha:8,spd:110},skills:{shadow_strike:{name:'暗影突袭',type:'active',tier:1,tags:['physical','dark'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['physical','dark']}]}},duration:2,summonType:'clone',aiType:'aggressive'});const i=this.calcSummonStats(2);this.registerTemplate({id:'poison_spider',name:'毒蜘蛛',description:'剧毒的巨型蜘蛛',baseStats:{hp:i.hp,mp:i.mp,sp:i.sp,str:10,dex:14,con:10,int:4,wis:10,cha:4,spd:90},skills:{venom_bite:{name:'毒牙',type:'active',tier:1,tags:['physical','poison'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d4+2',tags:['piercing']},{trigger:'on_hit',action:'debuff',target:'target',statusName:'中毒',duration:3,chance:50}]}},duration:3,summonType:'minion',aiType:'aggressive'});const c=this.calcSummonStats(5);this.registerTemplate({id:'light_guardian',name:'圣光守卫',description:'光明神殿的守护天使',baseStats:{hp:c.hp,mp:c.mp,sp:c.sp,str:12,dex:10,con:14,int:14,wis:16,cha:14,spd:80},skills:{holy_smite:{name:'神圣打击',type:'active',tier:2,tags:['magic','light'],cooldown:1,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+4',tags:['light']}]},blessing:{name:'祝福',type:'active',tier:1,tags:['magic','light','healing'],cooldown:2,target:'single_ally',cost:{mp:15},effects:[{trigger:'immediate',action:'heal',target:'target',value:'1d6+5'}]}},duration:4,summonType:'spirit',aiType:'support'});const d=this.calcSummonStats(2);this.registerTemplate({id:'street_thug',name:'地痞流氓',description:'街头混混，装备简陋但人多势众',baseStats:{hp:d.hp,mp:d.mp,sp:d.sp,str:12,dex:10,con:10,int:8,wis:8,cha:8,spd:80},skills:{crude_strike:{name:'粗暴殴打',type:'active',tier:1,tags:['physical','bludgeoning'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+2',tags:['physical','bludgeoning']}]}},duration:4,summonType:'minion',aiType:'aggressive'});const u=this.calcSummonStats(4);this.registerTemplate({id:'hired_guard',name:'雇佣护卫',description:'受过训练的专业护卫',baseStats:{hp:u.hp,mp:u.mp,sp:u.sp,str:14,dex:12,con:12,int:10,wis:10,cha:10,spd:90},skills:{sword_slash:{name:'剑击',type:'active',tier:1,tags:['physical','slashing'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+3',tags:['physical','slashing']}]}},duration:5,summonType:'minion',aiType:'defensive'});const p=this.calcSummonStats(3);this.registerTemplate({id:'guild_mage',name:'公会法师',description:'冒险者公会的职业法师',baseStats:{hp:p.hp,mp:p.mp,sp:p.sp,str:8,dex:10,con:10,int:14,wis:12,cha:10,spd:85},skills:{arcane_bolt:{name:'奥术飞弹',type:'active',tier:1,tags:['magic','arcane'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['magic','arcane']}]}},duration:4,summonType:'minion',aiType:'aggressive'});const m=this.calcSummonStats(6);this.registerTemplate({id:'elite_knight',name:'精锐骑士',description:'身经百战的精锐骑士',baseStats:{hp:m.hp,mp:m.mp,sp:m.sp,str:16,dex:12,con:14,int:10,wis:10,cha:12,spd:75},skills:{heavy_slash:{name:'重斩',type:'active',tier:2,tags:['physical','slashing'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+4',tags:['physical','slashing']}]},shield_block:{name:'盾击',type:'active',tier:1,tags:['physical','defense'],cooldown:2,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+2',tags:['bludgeoning']},{trigger:'on_hit',action:'debuff',target:'target',statusName:'眩晕',duration:1,chance:30}]}},duration:5,summonType:'minion',aiType:'defensive'});const g=this.calcSummonStats(4);this.registerTemplate({id:'assassin',name:'刺客',description:'隐藏在阴影中的杀手',baseStats:{hp:g.hp,mp:g.mp,sp:g.sp,str:10,dex:16,con:10,int:12,wis:12,cha:8,spd:120},skills:{backstab:{name:'背刺',type:'active',tier:2,tags:['physical','piercing','dark'],cooldown:1,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+5',tags:['piercing']}]}},duration:3,summonType:'minion',aiType:'aggressive'});const h=this.calcSummonStats(3);this.registerTemplate({id:'archer',name:'弓箭手',description:'熟练的弓箭射手',baseStats:{hp:h.hp,mp:h.mp,sp:h.sp,str:10,dex:14,con:10,int:10,wis:12,cha:10,spd:100},skills:{arrow_shot:{name:'射箭',type:'active',tier:1,tags:['physical','piercing','ranged'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+3',tags:['piercing']}]}},duration:4,summonType:'minion',aiType:'aggressive'});const f=this.calcSummonStats(4);this.registerTemplate({id:'mercenary',name:'雇佣兵',description:'以金钱为驱动的职业战士',baseStats:{hp:f.hp,mp:f.mp,sp:f.sp,str:14,dex:12,con:12,int:10,wis:10,cha:8,spd:85},skills:{mercenary_strike:{name:'军刀斩',type:'active',tier:1,tags:['physical','slashing'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+3',tags:['physical','slashing']}]}},duration:5,summonType:'minion',aiType:'aggressive'})}reset(){this.activeSummons.clear()}}class Xi extends Bl{logger;constructor(){super('TextOptimizationService')}init(){const e=Ll.q.getInstance();this.logger=e.get('LoggerService'),this.logger?.log('TextOptimizationService initialized')}async optimize(e,t){if(this.logger?.log('Starting text optimization...'),t?.aborted)throw new DOMException('Text optimization cancelled','AbortError');const a=Pi().getMergedPromptText('textOptimization'),s=localStorage.getItem('game_preset_textOptimization');let n;if(s)try{const e=JSON.parse(s),t=e.parsedText||'';a?(n=`${t}\n\n${a}`,this.logger?.log(`Using preset: ${e.name} + PromptService rules`)):(n=t,this.logger?.log(`Using preset: ${e.name}`))}catch(e){this.logger?.error('Failed to parse preset, falling back to PromptService rules',e),n=a}else n=a,this.logger?.log('Using PromptService rules only');if(!n)return this.logger?.log('No optimization rules configured, returning original content'),e;if(t?.aborted)throw new DOMException('Text optimization cancelled','AbortError');try{const a=await generateRaw({ordered_prompts:[{role:'system',content:n},{role:'user',content:`请优化以下正文内容：\n\n${e}`}],user_input:e,max_chat_history:0});if(t?.aborted)throw this.logger?.log('Text optimization cancelled after generation completed, discarding results'),new DOMException('Text optimization cancelled','AbortError');return this.logger?.log('Text optimization completed'),a.trim()}catch(e){if(e instanceof Error&&'AbortError'===e.name)throw e;throw this.logger?.error('Text optimization failed:',e),e}}async completeOptimization(e){const t=await mi.storyDB.getLastAssistantMessage();if(t&&t.id){const a=this.addOptimizedTag(t.content,e);await mi.storyDB.updateRecord(t.id,{content:a}),this.logger?.log('Text optimization applied to message'),await mi.storyDB.updateCurrentSnapshot(),this.logger?.log('Current snapshot updated with optimized content')}}addOptimizedTag(e,t){return`${e.replace(/<optimized>[\s\S]*?<\/optimized>/i,'')}<optimized>${t}</optimized>`}}const Yi={worldInfoBefore:'world_info_before',personaDescription:'persona_description',charDescription:'char_description',charPersonality:'char_personality',scenario:'scenario',worldInfoAfter:'world_info_after',dialogueExamples:'dialogue_examples',chatHistory:'chat_history'},Ki='game_preset_varMaintenance';class Ji extends Bl{logger;patchService;saveService;inventoryService;offlineActionService;promptService;promptInjector;config;constructor(){super('ToolAIService'),this.promptService=Pi(),this.promptInjector=(Ui||(Ui=new qi),Ui),this.config={dialogRounds:3,includeOfflineActions:!0,stateFormat:'yaml',enableWorldBookScan:!0}}init(){const e=Ll.q.getInstance();this.logger=e.get('LoggerService'),this.saveService=e.get('SaveService');try{this.patchService=e.get('PatchService')}catch{this.logger?.log('PatchService not registered, patch processing disabled')}try{this.inventoryService=e.get('InventoryService')}catch{this.logger?.log('InventoryService not registered, inventory compaction disabled')}try{this.offlineActionService=e.get('OfflineActionService')}catch{this.logger?.log('OfflineActionService not registered')}this.logger?.log('ToolAIService initialized')}setConfig(e){this.config={...this.config,...e}}getApiConfig(){try{const e=localStorage.getItem('game_api_config');if(e){return JSON.parse(e).varMaintenance||{useTavernApi:!0,endpoint:'',apiKey:'',model:''}}}catch(e){this.logger?.error('Failed to load API config',e)}return{useTavernApi:!0,endpoint:'',apiKey:'',model:''}}isPlaceholderPrompt(e){return e in Yi}loadToolAIPreset(){try{const e=localStorage.getItem(Ki);if(e){const t=JSON.parse(e);return this.logger?.log(`Loaded tool AI preset with ${t.prompts?.length||0} prompts`),t}}catch(e){this.logger?.error('Failed to load tool AI preset:',e)}return null}saveToolAIPreset(e){try{localStorage.setItem(Ki,JSON.stringify(e)),this.logger?.log(`Saved tool AI preset with ${e.prompts?.length||0} prompts`)}catch(e){this.logger?.error('Failed to save tool AI preset:',e)}}clearToolAIPreset(){localStorage.removeItem(Ki),this.logger?.log('Tool AI preset cleared')}hasToolAIPreset(){return null!==localStorage.getItem(Ki)}getEnabledPromptsByOrder(e){let t=e.prompt_order?.find(e=>100001===e.character_id);if(t||(t=e.prompt_order?.find(e=>1e5===e.character_id)),!t)return e.prompts.filter(e=>!1!==e.enabled);const a=[],s=new Map(e.prompts.map(e=>[e.identifier,e]));for(const e of t.order){if(!e.enabled)continue;const t=s.get(e.identifier);t?!1!==t.enabled&&a.push(t):this.isPlaceholderPrompt(e.identifier)&&a.push({identifier:e.identifier,name:e.identifier,role:'system',content:'',marker:!0,injection_position:0,injection_depth:0,injection_order:0})}return a}buildOrderedPromptsFromPreset(e,t){const a=[],s=this.getEnabledPromptsByOrder(e);let n=!1,r=!1;for(const e of s){const s=e.identifier;if(this.isPlaceholderPrompt(s)){const e=Yi[s];a.push(e),'world_info_after'!==e||n||(a.push({role:'system',content:t}),n=!0),'chat_history'===e&&(r=!0)}else e.content&&!e.marker&&a.push({role:e.role,content:e.content})}return n||a.push({role:'system',content:t}),r||a.push('chat_history'),this.logger?.log(`Built ordered_prompts from preset: ${a.length} items`),a}async process(e,t){this.logger?.log('Processing tool AI input...');try{if(t?.aborted)throw new DOMException('Tool AI cancelled before start','AbortError');const a=this.promptService.getMergedPromptText('varMaintenance'),s=this.loadToolAIPreset();let n;s?(this.logger?.log('Using imported tavern preset for tool AI'),n=this.buildOrderedPromptsFromPreset(s,a)):(this.logger?.log('Using simplified ordered_prompts (no preset imported)'),n=['world_info_before','char_description','scenario','world_info_after',{role:'system',content:a},'chat_history']);const r=this.buildChatHistoryPrompts(e);if(t?.aborted)throw new DOMException('Tool AI cancelled before generateRaw','AbortError');const l=this.getApiConfig(),o={ordered_prompts:n,overrides:{chat_history:{with_depth_entries:!0,prompts:r}},max_chat_history:0};!l.useTavernApi&&l.endpoint&&l.apiKey&&l.model?(this.logger?.log(`Using custom API for tool AI: ${l.endpoint}, model: ${l.model}`),o.custom_api={apiurl:l.endpoint,key:l.apiKey,model:l.model,source:'openai'}):this.logger?.log('Using Tavern API for tool AI'),this.logger?.log('Calling generateRaw for tool AI...');const i=await generateRaw(o);if(t?.aborted)throw this.logger?.log('Tool AI cancelled after generateRaw, discarding results'),new DOMException('Tool AI cancelled after generateRaw','AbortError');const c=this.parseToolOutput(i);if(this.autoAdvanceTime(e.gameState),t?.aborted)throw this.logger?.log('Tool AI cancelled before applying patches'),new DOMException('Tool AI cancelled before patches','AbortError');if(c.patches&&c.patches.length>0&&this.patchService&&this.saveService){const e=this.saveService.getGameState();if(e){const t=this.patchService.applyPatch(e,c.patches);t.success?(this.logger?.log(`Applied ${t.appliedCount} patch operations`),this.saveService.saveData('Tool AI patch applied')):(c.errors=c.errors||[],c.errors.push(...t.errors.map(e=>`[${e.path}] ${e.error}`)))}}if(c.enemy&&this.saveService){const e=this.saveService.getGameState();e&&this.handleEnemyData(c.enemy,e)}if(c.shop&&this.saveService){const e=this.saveService.getGameState();e&&this.handleShopData(c.shop,e)}return c}catch(e){if(e instanceof DOMException&&'AbortError'===e.name)throw e;return this.logger?.error('Tool AI processing failed',e),{raw:'',errors:[e instanceof Error?e.message:'Unknown error']}}}buildChatHistoryPrompts(e){const t=[];for(const a of e.recentDialogs){const e='user'===a.role?'[玩家]':'[剧情AI回复]';t.push({role:a.role,content:`${e}\n${a.content}`})}const a=[];return this.config.includeOfflineActions&&e.offlineActions?.length&&a.push(`[系统事件]\n${e.offlineActions.map(e=>`- ${e}`).join('\n')}`),a.push(this.buildFullStateContent(e.gameState)),a.push(`[玩家]\n${e.userInput}`),a.push(`[剧情AI输出]\n${e.storyOutput}`),e.additionalInstructions&&a.push(`${e.additionalInstructions}`),t.push({role:'user',content:a.filter(Boolean).join('\n\n')}),t}buildScanPrompts(e){const t=[];if(e.recentDialogs.length>0){const a=e.recentDialogs.map(e=>e.content).join('\n');t.push({role:'system',content:a,position:'none',depth:0,should_scan:!0})}const a=this.extractStateKeywords(e.gameState);a&&t.push({role:'system',content:a,position:'none',depth:0,should_scan:!0}),t.push({role:'system',content:e.userInput,position:'none',depth:0,should_scan:!0});const s=e.storyOutput.match(/<content>([\s\S]*?)<\/content>/i);s&&t.push({role:'system',content:s[1],position:'none',depth:0,should_scan:!0});const n=this.extractStoryKeywords(e.storyOutput);return n&&t.push({role:'system',content:n,position:'none',depth:0,should_scan:!0}),t}buildFullStateContent(e){this.inventoryService?.compactItemIds(),this.compactSkillIds(e);const t=[],a=e.player,s=e.inventory;if(e.world){const a={time:e.world.time,date:e.world.date,weather:e.world.weather,canUseWorldMap:e.world.canUseWorldMap,location:e.world.location};if(e.world.quests&&Object.keys(e.world.quests).length>0){const t={};for(const[a,s]of Object.entries(e.world.quests))'active'===s.status&&(t[a]=s);Object.keys(t).length>0&&(a.quests=t)}t.push(this.formatSection('world','世界状态',a))}if(e.scene){const a={locationPath:e.scene.locationPath,name:e.scene.name,desc:e.scene.desc,npcs:e.scene.npcs,objects:e.scene.objects,exits:e.scene.exits};t.push(this.formatSection('scene','当前场景',a))}const n={base:{name:a.base.name,level:a.base.level,race:a.base.race,class:a.base.class,exp:a.base.exp},stats:{hp:a.stats.hp,mp:a.stats.mp,sp:a.stats.sp},attributes:a.attributes};t.push(this.formatSection('player','玩家状态',n));const r=this.buildEquipmentSubset(a.equipment);t.push(this.formatSection('player.equipment','装备栏',r));const l={wallet:{ledger:s?.wallet?.ledger||0,formatted:this.formatCurrency(s?.wallet?.ledger||0)},items:this.buildItemsSubset(s?.items)};if(t.push(this.formatSection('inventory','背包',l)),e.allies&&Object.keys(e.allies).length>0){const a=Object.values(e.allies).map(e=>({id:e.id,name:e.name,race:e.race,class:e.class,level:e.level,gender:e.gender,allyType:e.allyType,affinity:e.affinity,relationship:e.relationship,appearance:e.appearance,stats:{hp:e.stats.hp,mp:e.stats.mp,sp:e.stats.sp},attributes:e.attributes,equipment:this.buildEquipmentSubset(e.equipment)}));t.push(this.formatSection('allies','队友信息',a))}if(e.relation){const a=this.buildRelationSubset(e.relation);a.characters&&Object.keys(a.characters).length>0&&t.push(this.formatSection('relation','人际关系',a))}if(e.skills&&Object.keys(e.skills).length>0){const a={};for(const[t,s]of Object.entries(e.skills))a[t]={name:s.name,type:s.type,tier:s.tier,description:s.description,cost:s.cost,cooldown:s.cooldown,currentCooldown:s.currentCooldown,target:s.target,tags:s.tags};t.push(this.formatSection('skills','玩家技能',a))}return t.join('\n\n')}formatSection(e,t,s){return`=== [${e}] ${t} ===\n\`\`\`yaml\n${a.stringify(s,{indent:2,lineWidth:0})}\`\`\``}buildEquipmentSubset(e){const t={},a=['mainHand','offHand','head','coat','top','bottom','shoes','accessory'];for(const s of a){const a=e[s];t[s]=a?{name:a.name,quality:a.quality,type:a.type,slot:a.slot,value:a.value,desc:a.desc,effects:a.effects?.length?a.effects:void 0}:null}return t}buildItemsSubset(e){if(!e||0===Object.keys(e).length)return{};const t={};for(const[a,s]of Object.entries(e))s.count>0&&(t[a]={name:s.name,count:s.count,quality:s.quality,type:s.type,slot:s.slot,value:s.value,desc:s.desc,effects:s.effects?.length?s.effects:void 0});return t}buildAllyEquipmentSubset(e){if(!e)return;const t={};let a=!1;for(const[s,n]of Object.entries(e))n&&'object'==typeof n&&'name'in n&&(t[s]={id:n.id,name:n.name,quality:n.quality},a=!0);return a?t:void 0}buildRelationSubset(e){if(!e)return{};const t={};if(e.characters&&Object.keys(e.characters).length>0){const a={};for(const[t,s]of Object.entries(e.characters)){const e=!0===s.isStarred,n=(s.rel??0)>=50;(e||n)&&(a[t]={name:s.name,appearance:s.appearance,personality:s.personality,occupation:s.occupation,likes:s.likes,dislikes:s.dislikes,haunt:s.haunt,background:s.background,biography:s.biography,motivation:s.motivation,deeds:s.deeds?.length?s.deeds:void 0,rel:s.rel,relType:s.relType,status:s.status,location:s.location,linkedAllyId:s.linkedAllyId,metAt:s.metAt,lastSeen:s.lastSeen,isStarred:s.isStarred})}t.characters=a}if(e.factions&&Object.keys(e.factions).length>0){const a={};for(const[t,s]of Object.entries(e.factions))a[t]={name:s.name,desc:s.desc,rep:s.rep,status:s.status,members:s.members?.length?s.members:void 0};t.factions=a}return t}formatCurrency(e){return`${Math.floor(e/1e4)}金 ${Math.floor(e%1e4/100)}银 ${e%100}铜`}extractStateKeywords(e){const t=[],a=e.player?.equipment;a&&Object.values(a).forEach(e=>{e?.name&&t.push(e.name)});const s=e.inventory?.items;s&&Object.values(s).forEach(e=>{e?.name&&t.push(e.name)});const n=e.allies;return n&&Object.values(n).forEach(e=>{e?.name&&t.push(e.name)}),t.join(' ')}extractStoryKeywords(e){const t=[],a=e.match(/<npcs>([\s\S]*?)<\/npcs>/i);if(a){const e=a[1].match(/\d+\.\s*(\S+)/g);e&&t.push(...e.map(e=>e.replace(/\d+\.\s*/,'').split(/[-–—]/)[0].trim()))}const s=e.match(/<places>([\s\S]*?)<\/places>/i);if(s){const e=s[1].match(/\d+\.\s*(\S+)/g);e&&t.push(...e.map(e=>e.replace(/\d+\.\s*/,'').split(/[-–—]/)[0].trim()))}const n=e.match(/<objects>([\s\S]*?)<\/objects>/i);if(n){const e=n[1].match(/\d+\.\s*(\S+)/g);e&&t.push(...e.map(e=>e.replace(/\d+\.\s*/,'').split(/[-–—]/)[0].trim()))}return t.join(' ')}compactSkillIds(e){const t=e.skills;if(!t||0===Object.keys(t).length)return!1;const a=Object.keys(t),s=a.filter(e=>/^skill_\d+$/.test(e)),n=a.filter(e=>!/^skill_\d+$/.test(e)),r=s.sort((e,t)=>parseInt(e.replace('skill_',''),10)-parseInt(t.replace('skill_',''),10)),l=[...r,...n.sort()];let o=n.length>0;if(!o)for(let e=0;e<r.length;e++){const t=`skill_${(e+1).toString().padStart(2,'0')}`;if(r[e]!==t){o=!0;break}}if(!o)return!1;const i={};for(let e=0;e<l.length;e++){const a=l[e];i[`skill_${(e+1).toString().padStart(2,'0')}`]=t[a]}e.skills=i;const c=n.length;return c>0?this.logger?.log(`Compacted skills: ${a.length} skills, converted ${c} non-standard IDs`):this.logger?.log(`Compacted skill IDs: ${a.length} skills reorganized`),!0}autoAdvanceTime(e){if(!e.world)return;const t=e.world.time||'08:00',a=e.world.date,s=t.match(/^(\d{1,2}):(\d{2})$/);if(!s)return void this.logger?.warn(`Invalid time format: ${t}, skipping auto-advance`);let n=parseInt(s[1],10),r=parseInt(s[2],10);r+=1,r>=60&&(r=0,n+=1);let l=!1;n>=24&&(n=0,l=!0);const o=`${n.toString().padStart(2,'0')}:${r.toString().padStart(2,'0')}`;if(e.world.time=o,l&&a){const s=this.advanceDate(a);s?(e.world.date=s,this.logger?.log(`Auto-advanced time: ${t} → ${o}, date: ${a} → ${s}`)):this.logger?.log(`Auto-advanced time: ${t} → ${o} (new day, date unchanged)`)}else this.logger?.log(`Auto-advanced time: ${t} → ${o}`)}advanceDate(e){const t=e.match(/^(\d+)年(\d{1,2})月(\d{1,2})日$/);if(t){let e=parseInt(t[1],10),a=parseInt(t[2],10),s=parseInt(t[3],10);s+=1;return s>this.getDaysInMonth(e,a)&&(s=1,a+=1,a>12&&(a=1,e+=1)),`${e}年${a.toString().padStart(2,'0')}月${s.toString().padStart(2,'0')}日`}const a=e.match(/^(\d+)-(\d{1,2})-(\d{1,2})$/);if(a){let e=parseInt(a[1],10),t=parseInt(a[2],10),s=parseInt(a[3],10);s+=1;return s>this.getDaysInMonth(e,t)&&(s=1,t+=1,t>12&&(t=1,e+=1)),`${e}-${t.toString().padStart(2,'0')}-${s.toString().padStart(2,'0')}`}return this.logger?.warn(`Cannot parse date format: ${e}`),null}getDaysInMonth(e,t){return new Date(e,t,0).getDate()}parseToolOutput(e){const t={raw:e,errors:[]},s=e.match(/<patch>([\s\S]*?)<\/patch>/i);if(s)try{t.patches=a.parse(s[1])}catch(e){t.errors?.push(`Patch YAML parse error: ${e}`)}const n=e.match(/<shop>([\s\S]*?)<\/shop>/i);if(n)try{t.shop=a.parse(n[1])}catch(e){t.errors?.push(`Shop YAML parse error: ${e}`)}const r=e.match(/<enemy>([\s\S]*?)<\/enemy>/i);if(r)try{const e=a.parse(r[1]),s=Object.keys(e).some(e=>/^team\d+$/i.test(e));t.enemy=s?{encounter_id:`encounter_${Date.now()}`,immediate:!1,battle_type:'random',enemies:{},teams:e}:e}catch(e){t.errors?.push(`Enemy YAML parse error: ${e}`)}return 0===t.errors?.length&&delete t.errors,t}handleEnemyData(e,t){this.logger?.log(`Processing enemy data: ${e.encounter_id}, immediate: ${e.immediate}`);const a=e.enemies;let s;if(void 0!==e.teams){const a=e.teams;this.logger?.log(`Using teams structure with ${Object.keys(a).length} teams`);const n={},r=[],l=[];let o=!1;for(const[e,s]of Object.entries(a)){const a=s.enemy;if(!a||'object'!=typeof a){this.logger?.warn(`Team ${e} has invalid enemy data (expected object), skipping`);continue}const i=Object.entries(a).map(([e,t])=>({id:e,...t})),c=i.filter(t=>t&&'object'==typeof t?!(!t.name||!t.id)||(this.logger?.warn(`Enemy missing required fields (name/id) in team ${e}:`,t),!1):(this.logger?.warn(`Invalid enemy data in team ${e}:`,t),!1)).map(t=>{const a=t.skills||{};let s;return s=Array.isArray(a)?a.reduce((e,t)=>(e[t.id]=t,e),{}):a,{...t,skills:s,team:e}});n[e]={enemies:c,immediate:s.immediate},!0===s.immediate&&(o=!0),r.push(...c),l.push(...this.extractLinkedNpcNames(c,t))}s={encounter_id:e.encounter_id,immediate:o,battle_type:e.battle_type,enemies:r,teams:n,linkedNpcNames:[...new Set(l)],source:'tool_ai',createdAt:Date.now()}}else{let n;n=Array.isArray(a)?a:Object.entries(a).map(([e,t])=>({id:e,...t}));const r=n.map(e=>{let t;const a=e.skills||[];return t=Array.isArray(a)?a.reduce((e,t)=>(e[t.id]=t,e),{}):a,{...e,skills:t}});s={encounter_id:e.encounter_id,immediate:e.immediate,battle_type:e.battle_type,enemies:r,linkedNpcNames:this.extractLinkedNpcNames(r,t),source:'tool_ai',createdAt:Date.now()}}t.pendingEnemies||(t.pendingEnemies={}),t.pendingEnemies[s.encounter_id]=s,this.saveService?.saveData('Enemy data stored'),this.logger?.log(`Enemy data stored: ${e.encounter_id}, linked NPCs: ${s.linkedNpcNames?.join(', ')||'none'}, teams: ${s.teams?Object.keys(s.teams).length:0}`),s.immediate&&(this.logger?.log(`Immediate battle triggered: ${s.encounter_id}`),this.triggerBattle(s))}extractLinkedNpcNames(e,t){const a=[],s=t.scene?.npcs;if(!s)return a;const n=Object.values(s).map(e=>e.name);for(const t of e)n.includes(t.name)&&a.push(t.name);return a}triggerBattle(e){try{this.eventBus.emit('battle:pre_battle_trigger',{pendingEnemy:e}),this.logger?.log(`Pre-battle modal triggered for encounter: ${e.encounter_id}`)}catch(e){this.logger?.error('Failed to trigger pre-battle modal',e)}}handleShopData(e,t){const a=Object.keys(e.items).length;this.logger?.log(`Processing shop data: merchant=${e.merchant_name}, items=${a}`);const s={};for(const[t,a]of Object.entries(e.items))s[t]={id:t,...a,stock:a.stock??-1};t.currentShop={merchant_id:e.merchant_id,merchant_name:e.merchant_name,buy_rate:e.buy_rate??1,sell_rate:e.sell_rate??.5,items:s},this.saveService?.saveData('Shop data stored'),this.logger?.log(`Shop data stored: ${e.merchant_name} with ${a} items`)}filterStoryOutput(e){const t=['content','summary','places','npcs','objects'],a=[];for(const s of t){const t=new RegExp(`<${s}>([\\s\\S]*?)</${s}>`,'i'),n=e.match(t);n&&a.push(`<${s}>${n[1]}</${s}>`)}return a.join('\n\n')}async getRecentDialogs(e=3){return(await mi.storyDB.getRecentContext(2*e)).map(e=>({role:e.role,content:'assistant'===e.role?this.extractContentTag(e.content):e.content}))}extractContentTag(e){const t=e.match(/<content>([\s\S]*?)<\/content>/i);return t?t[1].trim():e}async processWithContext(e,t,a,s){const n=this.saveService?.getGameState();if(!n)return{raw:'',errors:['No game state available']};const r=await this.getRecentDialogs(this.config.dialogRounds),l=a??this.promptInjector.getCachedOfflineActions(!0);return this.logger?.log(`Tool AI using ${l.length} offline actions`),this.process({storyOutput:this.filterStoryOutput(e),userInput:t,recentDialogs:r,offlineActions:l,gameState:n,additionalInstructions:s})}getFullStatePreview(e){return this.buildFullStateContent(e)}async buildPreviewPrompts(e,t='（玩家输入示例）',a,s){const n=[],r=this.promptService.getMergedPromptText('varMaintenance');n.push('┌─────────────────────────────────────────────────────────────┐'),n.push('│ 工具AI完整提示词预览                                        │'),n.push('└─────────────────────────────────────────────────────────────┘');const l=localStorage.getItem('game_tool_ai_preset');if(l)try{const e=JSON.parse(l);n.push(`\n📦 已导入预设: ${e.name||'自定义预设'}`);const t=e.prompts?.filter(e=>!1!==e.enabled)||[];n.push(`   启用的提示词条目: ${t.length} 条`)}catch(e){n.push(`\n⚠️ 预设解析失败: ${e}`)}else n.push('\n📋 未导入预设，使用 PromptService 规则');if(n.push('\n=== [ordered_prompts] PromptService 规则 (varMaintenance) ==='),r){const e=r.substring(0,800);n.push(e+(r.length>800?'\n... (共 '+r.length+' 字符)':''))}else n.push('(无规则配置)');const o=await this.getRecentDialogs(this.config.dialogRounds);if(n.push('\n=== [chat_history] 二次打包内容 ==='),o.length>0){n.push(`\n--- 近期对话 (${o.length} 条) ---`);for(const e of o){const t='user'===e.role?'[玩家]':'[剧情AI回复]',a=e.content.substring(0,100);n.push(`${t}\n${a}${e.content.length>100?'...':''}`)}}else n.push('\n--- 近期对话 (0 条) ---'),n.push('(无对话记录)');n.push('\n--- 最终 User 消息 ---');const i=s||[];i.length>0?(n.push('\n[系统事件]'),n.push(i.map(e=>`- ${e}`).join('\n'))):n.push('\n[系统事件] (无离线行为)'),n.push(`\n${this.buildFullStateContent(e)}`),n.push(`\n[玩家]\n${t}`),a?n.push(`\n[剧情AI输出]\n${a}`):n.push('\n[剧情AI输出]\n<content>\n（剧情AI回复内容示例...）\n</content>\n\n<summary>\n（剧情摘要示例）\n</summary>\n\n<npcs>\n1. NPC名称 - 描述\n</npcs>\n\n<places>\n1. 地点名称 (当前)\n2. 可去地点\n</places>\n\n<objects>\n1. 物品名称 - 描述\n</objects>'),n.push('\n=== [injects] 世界书扫描策略 ==='),n.push('工具AI通过 injects 参数设置以下扫描源 (position: \'none\', should_scan: true):'),n.push('  • 近期对话内容');const c=this.extractStateKeywords(e);return c?n.push(`  • 玩家状态关键词: ${c.substring(0,100)}${c.length>100?'...':''}`):n.push('  • 玩家状态关键词: (无)'),n.push('  • 用户最新输入'),n.push('  • 剧情AI content 正文'),n.push('  • 剧情AI npcs/places/objects 名称'),n.push('\n=== 工具AI输出格式 ==='),n.push('工具AI将输出以下YAML标签:'),n.push('  • <scene> - 场景数据 (locationPath, npcs, objects, exits)'),n.push('  • <patch> - 状态更新操作 (path + add/set/push/remove)'),n.push('  • <shop> - 商店数据 (可选)'),n.push('  • <enemy> - 敌人数据 (可选)'),n.join('\n')}}let Zi=null;class ec{static instance;isInitialized=!1;constructor(){}static getInstance(){return ec.instance||(ec.instance=new ec),ec.instance}async init(){this.isInitialized?console.warn('GameCore already initialized.'):(console.log('GameCore: Initializing services...'),Ll.serviceLocator.register('EventBus',Nl),Ll.serviceLocator.register('LoggerService',new Ti),Ll.serviceLocator.register('RNGService',new Fi),Ll.serviceLocator.register('SaveService',new Hi),Ll.serviceLocator.register('IconService',new ii),Ll.serviceLocator.register('LevelService',new di),Ll.serviceLocator.register('EffectService',new Eo),Ll.serviceLocator.register('DamageService',new Yo),Ll.serviceLocator.register('ShieldService',new Gi),Ll.serviceLocator.register('SummonService',new Qi),Ll.serviceLocator.register('InventoryService',new Oo),Ll.serviceLocator.register('BattleService',new qo),Ll.serviceLocator.register('BattleSettlementService',new Uo),Ll.serviceLocator.register('NodeMapService',new Mi),Ll.serviceLocator.register('OfflineActionService',new No),Ll.serviceLocator.register('PatchService',new pi),Ll.serviceLocator.register('ImageGenService',new ci),Ll.serviceLocator.register('TextOptimizationService',new Xi),Ll.serviceLocator.register('LLMService',new Ii),Ll.serviceLocator.register('ToolAIService',new Ji),Ll.serviceLocator.register('PromptInjector',new qi),Ll.serviceLocator.register('RegexService',new Vi),Ll.serviceLocator.register('CommandQueueService',new Qo),Ll.serviceLocator.register('BackgroundTaskService',new ql),Ll.serviceLocator.get('LoggerService').init(),Ll.serviceLocator.get('RNGService').init(),await Ll.serviceLocator.get('SaveService').init(),Ll.serviceLocator.get('IconService').init(),Ll.serviceLocator.get('LevelService').init(),Ll.serviceLocator.get('EffectService').init(),Ll.serviceLocator.get('DamageService').init(),Ll.serviceLocator.get('ShieldService').init(),Ll.serviceLocator.get('SummonService').init(),Ll.serviceLocator.get('InventoryService').init(),Ll.serviceLocator.get('BattleService').init(),await Ll.serviceLocator.get('BattleSettlementService').init(),await Ll.serviceLocator.get('NodeMapService').init(),Ll.serviceLocator.get('OfflineActionService').init(),Ll.serviceLocator.get('TextOptimizationService').init(),Ll.serviceLocator.get('LLMService').init(),Ll.serviceLocator.get('ToolAIService').init(),await Ll.serviceLocator.get('PromptInjector').init(),Ll.serviceLocator.get('BackgroundTaskService').init(),this.isInitialized=!0,console.log('GameCore: Initialization complete.'))}}const tc=xt({visible:!1,type:'info',message:'',duration:3e3});let ac=null;function sc(e,t='info',a=3e3){ac&&(clearTimeout(ac),ac=null),tc.message=e,tc.type=t,tc.duration=a,tc.visible=!0,a>0&&(ac=setTimeout(()=>{tc.visible=!1},a))}function nc(){ac&&(clearTimeout(ac),ac=null),tc.visible=!1}function rc(e=!0){const t={};return us(()=>{if(!e)return;let a;try{a=Ll.serviceLocator.get('EventBus')}catch{return}t[vi]=e=>{const t=e;sc(`剧情生成失败: ${t?.error||'未知错误'}`,'error',4e3)},a.on(vi,t[vi]),t[fi]=e=>{const t=e;sc(`剧情校验失败: ${t?.reason||'AI返回内容无效'}`,'warning',4e3)},a.on(fi,t[fi]),t[xi]=e=>{const t=e;sc(`变量更新失败: ${t?.error||'未知错误'}`,'error',4e3)},a.on(xi,t[xi]),t[Si]=e=>{const t=e;sc(`图片生成失败: ${t?.error||'未知错误'}`,'error',4e3)},a.on(Si,t[Si]),t[Ci]=()=>{sc('消息发送失败','error',3e3)},a.on(Ci,t[Ci])}),gs(()=>{let e;try{e=Ll.serviceLocator.get('EventBus')}catch{return}for(const[a,s]of Object.entries(t))e.off(a,s)}),{state:wt(tc),show:sc,hide:nc,success:(e,t)=>sc(e,'success',t),error:(e,t)=>sc(e,'error',t??4e3),warning:(e,t)=>sc(e,'warning',t??4e3),info:(e,t)=>sc(e,'info',t)}}const lc={class:'content-layer'},oc={class:'creation-header'},ic={class:'header-center'},cc={class:'step-label'},dc={class:'step-indicators'},uc={class:'creation-content'},pc={key:0,class:'mode-selection'},mc={key:1,class:'w-full max-w-5xl'},gc={class:'grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3'},hc=['onClick'],fc={class:'mb-2 text-3xl'},vc={class:'font-bold'},yc={class:'mb-1 text-xs text-gray-500'},bc={class:'text-sm text-gray-400'},xc={key:2,class:'grid w-full max-w-4xl grid-cols-1 gap-4 sm:grid-cols-2'},wc=['onClick'],kc={class:'text-lg font-bold'},Sc={class:'text-sm text-[#ffd700]'},_c={class:'text-xs text-gray-400'},Cc={key:3,class:'grid w-full max-w-6xl grid-cols-1 gap-8 lg:grid-cols-3'},Ic={class:'space-y-4'},Tc={class:'grid grid-cols-2 gap-4'},Ac={class:'mb-1 block text-sm text-gray-400'},Mc=['value'],Ec={class:'mt-1 text-xs text-[#7289da]'},$c=['value'],Dc={class:'space-y-4'},Pc={class:'flex items-center justify-between border-b border-[#373a40] pb-2'},Nc={class:'space-y-2'},Rc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},jc=['value'],Lc=['value'],Bc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},Oc=['value'],qc=['value'],Uc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},Vc=['value'],Fc=['value'],Hc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},Gc=['value'],zc=['value'],Wc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},Qc=['value'],Xc=['value'],Yc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},Kc=['value'],Jc=['value'],Zc={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},ed=['value'],td=['value'],ad={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},sd=['value'],nd=['value'],rd={class:'grid grid-cols-[1fr_100px] gap-2 sm:grid-cols-[1fr_120px]'},ld=['value'],od=['value'],id={class:'space-y-4'},cd={class:'text-gray-400'},dd={key:0,class:'space-y-3 rounded border border-[#373a40] bg-[#25262b] p-3'},ud={class:'space-y-4'},pd={class:'mb-4 flex items-end justify-between border-b border-[#373a40] pb-2'},md={class:'text-xl font-bold text-[#ffd700]'},gd={class:'space-y-3'},hd={class:'w-12 font-bold'},fd={class:'flex items-center space-x-3'},vd=['onClick'],yd=['onClick'],bd={class:'w-16 text-right text-xs text-gray-500'},xd={key:4,class:'flex h-full w-full max-w-6xl flex-col'},wd={class:'mb-4 flex shrink-0 items-center justify-between'},kd={class:'text-xl font-bold text-[#ffd700]'},Sd={class:'flex-1 overflow-y-auto pr-2'},_d={class:'mb-2 border-b border-[#373a40] pb-1 text-[#7289da]'},Cd={key:0,class:'space-y-2'},Id=['onClick'],Td={class:'flex-1'},Ad={class:'flex items-center gap-2'},Md={class:'text-xs text-[#ffd700]'},Ed={key:0,class:'rounded-full bg-[#4caf50] px-2 py-0.5 text-xs text-white'},$d={class:'mt-1 text-xs text-gray-400'},Dd=['onClick'],Pd={class:'grid grid-cols-2 gap-3 md:grid-cols-4 lg:grid-cols-5'},Nd=['onClick'],Rd={key:0,class:'absolute -top-2 -right-2 rounded-full bg-[#4caf50] px-2 py-0.5 text-xs text-white shadow'},jd={class:'absolute top-1 right-1 rounded bg-black/50 px-1 text-xs text-[#ffd700]'},Ld={class:'mb-1 flex items-center justify-center'},Bd={class:'truncate text-xs text-gray-500'},Od=['onClick'],qd={key:5,class:'w-full max-w-2xl space-y-6'},Ud={class:'rounded border border-[#373a40] bg-[#2c2e33] p-4'},Vd={class:'grid grid-cols-2 gap-4 text-sm'},Fd={key:0,class:'space-y-4'},Hd={class:'rounded border border-[#373a40] bg-[#2c2e33] p-4'},Gd={class:'text-sm text-gray-300'},zd={class:'space-y-4'},Wd={class:'mb-2'},Qd=['value'],Xd={class:'space-y-2 rounded border border-[#373a40] bg-[#2c2e33] p-3'},Yd=['value'],Kd=['value'],Jd=['value'],Zd=['value'],eu=['value'],tu={key:4,class:'mt-2 rounded bg-[#1a1b1e] p-2 text-sm text-[#7289da]'},au={class:'creation-footer'},su={key:1},nu={key:2,class:'footer-btn disabled',disabled:''};const ru=e=>['武器'].includes(e)?'weapon':['上装','外套','头部','手部','鞋子','袜子','内衣','内裤'].includes(e)?'armor':['饰品'].includes(e)?'accessory':['消耗品'].includes(e)?'consumable':'misc',lu=(e,t,a,s,n,r=[],l)=>{const o={name:e,type:ru(t),count:1,quality:'Common',emoji:a,desc:s,effects:[],value:10,slotTarget:ou(t),subtype:l?.subtype,attribute:l?.attribute};if(n)if(n.startsWith('AC+')){const e=parseInt(n.replace('AC+',''));o.effects?.push({trigger:'passive',action:'buff',target:'self',value:e.toString(),tags:['ac']})}else'武器'===t&&o.effects?.push({trigger:'on_hit',action:'damage',target:'target',value:n,tags:['physical']});return r&&(o.effects=[...o.effects||[],...r]),o},ou=e=>({武器:'weapon_main',上装:'upper',外套:'outer',头部:'head',手部:'hands',鞋子:'shoes',袜子:'socks',内衣:'underwear',内裤:'underpants',饰品:'accessory_1'}[e]),iu=(e,t,a,s,n)=>({name:e,type:'active',tier:1,tags:[],cooldown:s,cost:'mp'===a.type?{mp:a.val}:{sp:a.val},description:t,target:'single_enemy',effects:n}),cu={平民:{attributes:{},items:[lu('干粮','消耗品','🍞','硬邦邦的黑面包，勉强果腹。',void 0,[{trigger:'on_use',action:'heal',target:'self',value:'1d8',tags:['sp']}],{subtype:'food_bread'})],skills:[]},战士:{attributes:{STR:2,CON:2},items:[lu('制式铁剑','武器','⚔️','王国军队的标准配剑，坚固耐用。','1d6+STR',[],{subtype:'sword',attribute:'steel'}),lu('旧铁甲','上装','🛡️','有些生锈的铁甲，能提供基础防护。','AC+2',[],{subtype:'coat',attribute:'plate'})],skills:[iu('顺劈斩','挥舞武器横扫前方的敌人。',{val:5,type:'sp'},2,[{trigger:'on_use',action:'damage',target:'all_enemies',value:'1d4+STR',tags:['physical']}])]},法师:{attributes:{INT:3,WIS:1},items:[lu('学徒法杖','武器','🪄','刻有基础符文的木杖。','1d4+INT',[],{subtype:'staff',attribute:'basic'}),lu('法师袍','上装','👘','轻便的长袍，便于施法。','AC+0',[{trigger:'passive',action:'buff',target:'self',value:'5',tags:['mp_max']}],{subtype:'coat',attribute:'silk'}),lu('魔法水','消耗品','🧪','恢复少量魔力。',void 0,[{trigger:'on_use',action:'heal',target:'self',value:'10',tags:['mp']}],{subtype:'potion'})],skills:[iu('火球术','凝聚火焰元素轰击敌人。',{val:5,type:'mp'},0,[{trigger:'on_use',action:'damage',target:'target',value:'1d8+INT',tags:['fire']}])]},游侠:{attributes:{DEX:3,WIS:1},items:[lu('短弓','武器','🏹','猎人常用的短弓，轻便灵活。','1d6+DEX',[],{subtype:'bow',attribute:'basic'}),lu('皮甲','上装','🧥','鞣制过的皮革护具。','AC+1',[],{subtype:'coat',attribute:'leather'})],skills:[iu('二连射','快速射出两只箭矢。',{val:6,type:'sp'},1,[{trigger:'on_use',action:'damage',target:'target',value:'1d6',tags:['physical']},{trigger:'on_use',action:'damage',target:'target',value:'1d6',tags:['physical']}])]},牧师:{attributes:{WIS:3,CHA:1},items:[lu('战锤','武器','🔨','用来惩戒异端的钝器。','1d6+STR',[],{subtype:'hammer',attribute:'divine'}),lu('圣徽','饰品','⚜️','信仰的象征。',void 0,[],{subtype:'necklace',attribute:'light'})],skills:[iu('治疗术','引导圣光治愈伤口。',{val:5,type:'mp'},0,[{trigger:'on_use',action:'heal',target:'single_ally',value:'1d8+WIS',tags:['hp']}])]}},du=[{name:'铃兰平原',type:'region',desc:'位于大陆正中央的四方辐辏之地，既是交通枢纽，也是各大势力博弈的缓冲带。',children:[{name:'最后壁垒',type:'city',desc:'冒险者公会总部，绝对中立区。',children:[{name:'公会大厅',type:'building'},{name:'任务告示板',type:'building'},{name:'训练场',type:'outdoor'},{name:'冒险者旅馆',type:'building'}]},{name:'四风集镇',type:'city',desc:'位于壁垒东侧，世界上最大的贸易中转站。',children:[{name:'中央广场',type:'outdoor'},{name:'商业街',type:'outdoor'},{name:'北门',type:'landmark',desc:'通往断旗战场'},{name:'南门',type:'landmark',desc:'通往狮鹫哨塔要塞'},{name:'东门',type:'landmark',desc:'通往翡翠联邦'},{name:'西门',type:'landmark',desc:'通往熔炉城邦'}]},{name:'泣语高塔',type:'building',desc:'位于平原西侧的孤立高塔，实为欲望教派的据点。'},{name:'风铃村',type:'city',desc:'位于平原边缘的流亡者聚落，鱼龙混杂。',children:[{name:'村口',type:'outdoor'},{name:'破旧酒馆',type:'building'},{name:'流民营地',type:'outdoor'}]}]},{name:'圣银王国',type:'country',desc:'人类王权，圣光信仰，森严的等级制度，女王独裁。',children:[{name:'狮鹫哨塔要塞',type:'city',desc:'横亘在平原南端山谷间的巨型要塞，王国的大门。',children:[{name:'北门',type:'landmark',desc:'直面铃兰平原'},{name:'南门',type:'landmark',desc:'通往王国腹地'},{name:'要塞驻军营',type:'building'},{name:'哨塔',type:'building'}]},{name:'海因斯公爵领',type:'region',desc:'穿过要塞后的富庶农业区，大片金色的麦田。',children:[{name:'橡木镇',type:'city',children:[{name:'镇中心广场',type:'outdoor'},{name:'橡木酒馆',type:'building'}]},{name:'银月城堡',type:'building',desc:'海因斯公爵府邸',children:[{name:'大厅',type:'room'},{name:'花园',type:'outdoor'},{name:'图书馆',type:'room'},{name:'五楼',type:'floor',children:[{name:'艾莉诺房间',type:'room',desc:'公爵三女艾莉诺的闺房'},{name:'客房',type:'room'}]},{name:'地下室',type:'floor'}]},{name:'麦田',type:'outdoor'}]},{name:'圣都·艾恩格拉德',type:'city',desc:'依山而建的宏伟白色巨城，圣光信仰的中心。',children:[{name:'王宫',type:'building'},{name:'圣光大教堂',type:'building'},{name:'皇家魔法学院',type:'building'},{name:'贵族区',type:'region'},{name:'平民区',type:'region'},{name:'贫民窟',type:'region'}]},{name:'金麦村',type:'city',desc:'沿海渔农混合村落。'},{name:'白帆港',type:'city',desc:'大陆南端最大的港口，贸易船队云集。',children:[{name:'港口码头',type:'outdoor'},{name:'船坞',type:'building'},{name:'海员酒馆',type:'building'}]},{name:'乡野',type:'region',desc:'王国各地的乡村地区',children:[{name:'无名废墟',type:'outdoor',desc:'被遗弃的建筑废墟'},{name:'荒野小道',type:'outdoor'},{name:'废弃农舍',type:'building'}]}]},{name:'猩红部落',type:'country',desc:'兽人领地，战斗至上，弱肉强食，占据大陆北方蛮荒之地。',children:[{name:'断旗战场',type:'region',desc:'位于平原北缘与北境交界的荒原，遍地是巨大的弹坑与折断的兵器。',children:[{name:'废弃营地',type:'outdoor'},{name:'战场遗迹',type:'outdoor'}]},{name:'枯败丘陵',type:'region',desc:'穿过战场后的缓冲区，植被枯死，土地呈现红褐色。'},{name:'战吼高地',type:'city',desc:'兽人的核心聚集区，地势较高，布满巨大的兽皮帐篷与图腾柱。',children:[{name:'酋长大帐',type:'building'},{name:'角斗场',type:'outdoor'},{name:'祭祀场',type:'outdoor'}]},{name:'碎骨隘口',type:'landmark',desc:'通往极北的狭窄山道，常年寒风呼啸。'},{name:'霜冻苔原',type:'region',desc:'位于大陆最北端，终年积雪。这里是通往天空虚空回廊的地面锚点。'}]},{name:'翡翠联邦',type:'country',desc:'精灵领地，长老制，自然崇拜，母系社会。',children:[{name:'绿叶哨站',type:'building',desc:'建立在巨树之上的木质哨塔，精灵游侠在此警戒。'},{name:'低语之森',type:'region',desc:'进入联邦的外围森林，终年弥漫着淡淡的薄雾。',children:[{name:'森林小径',type:'outdoor'},{name:'精灵岗哨',type:'building'}]},{name:'月光林地',type:'city',desc:'森林深处的开阔地，巨大的发光植物照亮黑夜。',children:[{name:'母树议会',type:'building'},{name:'自然神龛',type:'building'},{name:'精灵村落',type:'region'}]},{name:'永劫树海',type:'region',desc:'位于联邦最东侧，被视为禁区。植被极度茂密且具有攻击性，是魔物的温床。',children:[{name:'边缘地带',type:'outdoor',desc:'树海与文明世界的交界处'},{name:'阳光林地',type:'outdoor',desc:'少数阳光能照射到的安全地带'},{name:'哀伤沼泽',type:'outdoor',desc:'树海边缘的危险沼泽'},{name:'邪魔肉瘤',type:'outdoor',desc:'树海极深处，极度危险'}]}]},{name:'熔炉城邦',type:'country',desc:'矮人领地，机械飞升，义体改造，盘踞于大陆西部山脉。',children:[{name:'黑矿镇',type:'city',desc:'位于山脚下的混乱矿业小镇，充满了煤灰与机械废料。',children:[{name:'矿井入口',type:'building'},{name:'工人宿舍',type:'building'},{name:'废料场',type:'outdoor'}]},{name:'铁锈山脉',type:'region',desc:'阻隔平原与海岸的高耸山脉，山体被挖掘得千疮百孔。'},{name:'齿轮之心',type:'city',desc:'建立在山脉中的巨型立体城市，蒸汽管道纵横交错。',children:[{name:'动力熔炉',type:'building'},{name:'义体诊所',type:'building'},{name:'发条镇',type:'region',desc:'疯狂发明家聚落'},{name:'下层区',type:'region',desc:'贫民和孤儿聚居区',children:[{name:'废墟工坊',type:'building'}]},{name:'中层区',type:'region'},{name:'上层区',type:'region'}]},{name:'沉船墓地',type:'outdoor',desc:'堆满废弃船只残骸的沙滩。'},{name:'风暴海岸',type:'outdoor',desc:'位于大陆最西端，海况恶劣，常有雷暴。'}]},{name:'晶沙帝国',type:'country',desc:'龙裔领地，议会制国家，时间魔法，沙海文明。',children:[{name:'幻影绿洲',type:'city',desc:'位于沙漠边缘的中转站，连接来自圣银王国的商队。'},{name:'时之沙都',type:'city',desc:'矗立在沙海中央的宏伟城市，以控制时间的魔法闻名。',children:[{name:'太阳金字塔',type:'building'},{name:'时间观测台',type:'building'},{name:'龙裔议会厅',type:'building'}]},{name:'沙漠深处',type:'region',desc:'无尽的沙海，极少有人涉足',children:[{name:'沉日古城遗迹',type:'outdoor',desc:'掩埋在深沙之下的古代文明遗址'},{name:'葬神陵墓',type:'building',desc:'埋藏着古代文明秘密的遗迹群',children:[{name:'入口大厅',type:'room'},{name:'实验区',type:'region',children:[{name:'休眠舱',type:'room',desc:'古代实验体的休眠之处'}]},{name:'深层区域',type:'region'}]}]}]},{name:'虚空回廊',type:'country',desc:'魔族领地，封建贵族制，反重力浮空城，位于极北上空。',children:[{name:'虚空城',type:'city',desc:'主要的浮空城市。',children:[{name:'贵族区',type:'region'},{name:'平民区',type:'region'},{name:'魔王城堡',type:'building'}]},{name:'没落贵族区',type:'region',desc:'曾经辉煌的贵族府邸区，如今多已衰败。',children:[{name:'破败府邸',type:'building',children:[{name:'大厅',type:'room',desc:'昔日辉煌的大厅已然衰败'},{name:'卧室',type:'room'}]}]},{name:'边缘浮岛',type:'outdoor'}]},{name:'无垠之海',type:'region',desc:'大陆西南方海域。',children:[{name:'迷雾群岛',type:'region',desc:'移动的海盗据点，通常出没于西南海域。',children:[{name:'龟岛之喉',type:'city',desc:'海盗都市',children:[{name:'海盗港',type:'outdoor'},{name:'黑市',type:'building'},{name:'海盗酒馆',type:'building'}]}]},{name:'叹息之墙',type:'landmark',desc:'世界边缘的风暴屏障。'}]}];const uu=[{name:'最后壁垒 - 公会大厅',path:['铃兰平原','最后壁垒','公会大厅'],desc:'冒险者公会总部，适合作为冒险者的起点'},{name:'四风集镇 - 中央广场',path:['铃兰平原','四风集镇','中央广场'],desc:'世界上最大的贸易中转站'},{name:'圣银王国 - 圣都广场',path:['圣银王国','圣都·艾恩格拉德','平民区'],desc:'人类王国的首都'},{name:'熔炉城邦 - 齿轮之心',path:['熔炉城邦','齿轮之心','中层区'],desc:'矮人的机械大都市'},{name:'翡翠联邦 - 月光林地',path:['翡翠联邦','月光林地','精灵村落'],desc:'精灵的森林家园'},{name:'风铃村',path:['铃兰平原','风铃村','村口'],desc:'流亡者聚落，适合无家可归的角色'}];const pu=(e,t,a,s,n,r,l=[],o='Common',i=100)=>({name:e,type:t,count:1,quality:o,emoji:a,desc:s,value:i,effects:l,slotTarget:n,subtype:r?.subtype,attribute:r?.attribute}),mu=(e,t,a,s,n,r=50)=>({name:e,type:'consumable',count:1,quality:'Common',emoji:t,desc:a,value:r,effects:s,subtype:n?.subtype,attribute:n?.attribute,iconVariant:n?.iconVariant}),gu=(e,t,a,s,n=0,r=[],l=[],o)=>({name:e,description:t,type:a,tier:1,tags:l,cooldown:n,cost:s,target:o??('active'===a?'single_enemy':'self'),effects:r}),hu=[{id:'elinor',name:'艾莉诺·海因斯',icon:'👸',race:'人类',class:'法师学徒',gender:'女',desc:'圣银王国海因斯公爵最年幼的小女儿，拥有【魔力亲和】的魔法奇才。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'艾莉诺·海因斯',race:'人类',class:'法师学徒',level:1,exp:{current:0,max:10},gender:'女',age_bio:'12',age_psy:'12',alignment:'绝对中立',identity:'公爵三女',status_desc:'穿着华丽的蕾丝洋裙，铂金色长发如月光织成的绸缎般柔顺。'},e.player.appearance={hair_color:'铂金色',hair_length:'及肩长发',hair_style:'柔顺披肩',eye_color:'蓝宝石色',height:'120cm',body_build:'娇小纤细',skin_tone:'白皙如瓷',face_features:'精致如陶瓷娃娃',special_marks:'无',racial_traits:'无'},e.player.attributes={STR:4,DEX:8,CON:6,INT:18,WIS:14,CHA:16,SPD:8,CRIT_RATE:10,CRIT_DMG:180,AC:8},e.player.stats={hp:{current:22,max:22},mp:{current:46,max:46},sp:{current:26,max:26}},e.world.time='08:00',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['圣银王国','海因斯公爵领','银月城堡','五楼','艾莉诺房间'],name:'艾莉诺房间',desc:'一间布置精美的闺房，到处是蕾丝和蝴蝶结。窗外阳光透过彩色玻璃洒入，在地毯上投下斑斓光影。书桌上堆满了魔法入门书籍。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.equipment={weapon_main:pu('入门法杖','weapon','🔮','刻有基础符文的木杖，适合初学者使用。','weapon_main',{subtype:'staff',attribute:'basic'},[{trigger:'passive',action:'buff',target:'self',modifiers:{mp_max:15}}],'Uncommon',800),head:pu('蝴蝶结发饰','armor','🎀','镶嵌着小水晶的精美发饰。','head',{subtype:'hat',attribute:'silk'},[],'Uncommon',300),upper:pu('华丽蕾丝洋裙','armor','👗','带有大量蕾丝和蝴蝶结的华丽洋裙，是公爵府定制的。','upper',{subtype:'top_female',attribute:'noble'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:1}}],'Rare',5e3),shoes:pu('漆皮小皮鞋','armor','👠','精致的漆皮小皮鞋，适合贵族小姐。','shoes',{subtype:'shoe_light',attribute:'leather'},[],'Uncommon',200),underwear:pu('棉质背心','armor','👙','柔软舒适的棉质内衣。','underwear',{subtype:'lingerie_top',attribute:'common'},[],'Common',20),underpants:pu('棉质内裤','armor','🩲','可爱图案的棉质内裤。','underpants',{subtype:'underpants_female',attribute:'common'},[],'Common',15),socks:pu('白色长筒袜','armor','🧦','精致的白色丝袜。','socks',{subtype:'sock_long',attribute:'silk'},[],'Uncommon',80)},e.inventory.wallet.ledger=99100,e.inventory.items={id_01:{...mu('小型魔力药水','💧','炼金术的基础产物，味道像蓝莓。',[{trigger:'immediate',action:'heal',target:'self',value:'2d6+5',tags:['mp']}],{subtype:'potion',iconVariant:3},200),count:5},id_02:{...mu('精致点心','🍰','公爵府厨房特制的精致点心。',[{trigger:'immediate',action:'heal',target:'self',value:'1d4',tags:['hp']}],{subtype:'food_bread',iconVariant:5},30),count:3}},e.skills={spark:gu('火花术','初学者的基础火系法术，释放一团小火花攻击敌人。','active',{mp:3},0,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d6+INT',tags:['fire','magic']}],['fire','magic']),frost_ray:gu('冰霜射线','初学者的基础冰系法术，发射一道寒冷射线。','active',{mp:4},1,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d8+INT',tags:['ice','magic']},{trigger:'immediate',action:'debuff',target:'enemy',statusName:'冰冷',modifiers:{spd:-2},chance:40,duration:2}],['ice','magic']),mana_affinity:{name:'魔力亲和',description:'与魔法元素的连接远超常人，能以更少的消耗、更快的速度施展魔法，并更容易领悟高深法术的原理。',type:'passive',tier:3,tags:['passive','magic'],cooldown:0,target:'self',effects:[{trigger:'passive',action:'buff',target:'self',modifiers:{magic_dmg:50}},{trigger:'turn_start',action:'heal',target:'self',value:'15',tags:['mp']},{trigger:'passive',action:'buff',target:'self',modifiers:{int:5}}]}},e.player.private={Body_Type:'幼女',Breast_Size:'AA杯',Breast_Volume:'微乳',Breast_Shape:'平坦型乳房',Areola_Color:'淡粉色',Nipple_Sensitivity:'低',Vulva_Appearance:'馒头型阴唇',Vulva_Color:'粉嫩',Clitoris_Sensitivity:'低',Pubic_Hair:'无阴毛',Virginity_Status:'处女',Hymen_Status:'完整',Pregnancy_Status:'未怀孕',Fertility:'未发育',Menstrual_Cycle:'未初潮',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:0,Sexual_Orientation:'未知',Skin_Sensitivity:'中'},e}},{id:'lilith',name:'莉莉丝',icon:'😈',race:'魔族',class:'没落贵族',gender:'女',desc:'虚空回廊没落贵族家庭的后裔，比同龄人更早理解人情世故与利益交换的法则。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'莉莉丝',race:'魔族',class:'没落贵族',level:1,exp:{current:0,max:10},gender:'女',age_bio:'16',age_psy:'20',alignment:'混乱中立',identity:'没落贵族后裔',status_desc:'穿着哥特风格的黑色短裙，银色短发下一双魅惑的红色眼瞳闪烁着狡黠的光芒。头顶有一对小巧的黑色犄角，身后的心形尾巴轻轻摇摆。'},e.player.appearance={hair_color:'银色',hair_length:'短发',hair_style:'柔顺',eye_color:'魅惑红色',height:'130cm',body_build:'纤细娇小',skin_tone:'象牙白',face_features:'精致妖媚，带着与年龄不符的成熟',special_marks:'无',racial_traits:'头顶一对小巧黑色犄角，身后心形尾巴'},e.world.time='22:00',e.world.weather='🌙',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['虚空回廊','红月荒区','破败府邸','大厅'],name:'荒废的大厅',desc:'昔日辉煌的大厅已然衰败，蜘蛛网布满角落，但依稀可见曾经的奢华。破旧的水晶吊灯摇摇欲坠，褪色的壁画诉说着往日荣光。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:6,DEX:12,CON:8,INT:14,WIS:12,CHA:18,SPD:11,CRIT_RATE:8,CRIT_DMG:160,AC:10},e.player.stats={hp:{current:26,max:26},mp:{current:38,max:38},sp:{current:28,max:28}},e.player.equipment={upper:pu('哥特萝莉裙','armor','🖤','带有暗黑魔力的哥特风格裙装，散发着微弱的魔族气息。','upper',{subtype:'top_female',attribute:'noble'},[{trigger:'passive',action:'buff',target:'self',modifiers:{cha:3}}],'Rare',3e3),outer:pu('黑色小坎肩','armor','🧥','时尚的黑色坎肩。','outer',{subtype:'coat',attribute:'noble'},[],'Uncommon',500),underwear:pu('黑色抹胸','armor','🖤','精致的黑色抹胸。','underwear',{subtype:'lingerie_top',attribute:'noble'},[],'Uncommon',100),underpants:pu('黑色蕾丝内裤','armor','🩲','精致的黑色蕾丝内裤。','underpants',{subtype:'underpants_female',attribute:'lace'},[],'Uncommon',80),socks:pu('黑色过膝袜','armor','🧦','带有蕾丝边的黑色过膝袜。','socks',{subtype:'sock_long',attribute:'noble'},[],'Uncommon',120),shoes:pu('厚底皮靴','armor','👢','时尚的厚底皮靴。','shoes',{subtype:'boot_heavy',attribute:'leather'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:1}}],'Uncommon',400)},e.skills={charm_eyes:gu('魅惑之眼','用魅惑的目光迷乱敌人的心智，使其无法正常行动。','active',{mp:8},3,[{trigger:'immediate',action:'debuff',target:'enemy',statusName:'魅惑',tags:['charm'],chance:70,duration:2}],['charm','magic','dark']),shadow_claw:gu('暗影爪击','召唤暗影之力形成利爪攻击敌人。','active',{mp:5},1,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d8+CHA',tags:['dark','magic']}],['dark','magic']),demon_bloodline:gu('魔族血统','流淌着魔族贵族的血脉，拥有天生的魅惑能力和对暗系魔法的亲和。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',modifiers:{cha:3}},{trigger:'passive',action:'buff',target:'self',modifiers:{dark_dmg:20}}],['racial','dark'])},e.inventory.wallet.ledger=500,e.inventory.items={id_01:{...mu('暗黑魔力结晶','💜','蕴含魔族魔力的紫色结晶，服用后可恢复魔力。味道带着一丝硫磺的苦涩。',[{trigger:'immediate',action:'heal',target:'self',value:'2d6+3',tags:['mp']}],{subtype:'gem',iconVariant:12},180),count:2},id_02:{name:'褪色家族徽记',type:'misc',count:1,quality:'Uncommon',emoji:'🔮',desc:'莉莉丝家族的徽记，曾经代表着虚空回廊的贵族身份。金属已经氧化，但依稀可见精致的雕刻。也许哪天能证明她的血统。',value:100,subtype:'artifact_curse'},id_03:{...mu('魅惑香水','🌹','魔族特制的香水，散发着令人迷醉的气息。使用后短时间内魅力值提升。',[{trigger:'immediate',action:'buff',target:'self',statusName:'魅惑芬芳',duration:3,modifiers:{cha:3}}],{subtype:'potion',iconVariant:8},250),count:1}},e.player.private={Body_Type:'少女',Breast_Size:'A杯',Breast_Volume:'微乳',Breast_Shape:'娇小型乳房',Areola_Color:'深粉色',Nipple_Sensitivity:'高',Vulva_Appearance:'蝴蝶型阴唇',Vulva_Color:'粉红',Clitoris_Sensitivity:'高',Pubic_Hair:'无阴毛',Virginity_Status:'处女',Hymen_Status:'完整',Pregnancy_Status:'未怀孕',Fertility:'未发育',Menstrual_Cycle:'未初潮',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:2,Sexual_Orientation:'双性恋',Skin_Sensitivity:'高',Kinks:['支配','魅惑']},e}},{id:'renn',name:'雷恩',icon:'🔧',race:'人类',class:'机械师学徒',gender:'男',desc:'熔炉城邦下层区的孤儿，拥有【械心通感】，对机械有着天生的亲和力。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'雷恩',race:'人类',class:'机械师学徒',level:1,exp:{current:0,max:10},gender:'男',age_bio:'15',age_psy:'18',alignment:'混乱善良',identity:'孤儿',status_desc:'穿着沾满油污的工装，乱糟糟的黑色短发沾着些许油污，古铜色的皮肤上遍布细小的伤痕与陈旧的疤痕。眼神锐利而坚毅。'},e.player.appearance={hair_color:'黑色',hair_length:'短发',hair_style:'乱糟糟',eye_color:'深棕色',height:'165cm',body_build:'结实精瘦',skin_tone:'古铜色',face_features:'眼神锐利坚毅',special_marks:'皮肤上遍布细小的伤痕与陈旧的疤痕，手指关节粗大',racial_traits:'无'},e.world.time='06:00',e.world.weather='🌫️',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['熔炉城邦','齿轮之心','下层区','废墟工坊'],name:'废墟工坊',desc:'被遗弃的机械工坊，到处散落着零件和齿轮。蒸汽管道发出嘶嘶声，锈蚀的机械偶尔发出嗡嗡声。空气中弥漫着机油和煤灰的味道。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:13,DEX:14,CON:13,INT:16,WIS:10,CHA:8,SPD:10,CRIT_RATE:8,CRIT_DMG:160,AC:12},e.player.stats={hp:{current:36,max:36},mp:{current:42,max:42},sp:{current:33,max:33}},e.player.equipment={weapon_main:pu('巨型扳手','weapon','🔧','可当武器使用的巨型扳手，重量十足。','weapon_main',{subtype:'hammer',attribute:'steel'},[{trigger:'on_hit',action:'damage',target:'enemy',value:'1d8+STR',tags:['physical','blunt']}],'Common',150),upper:pu('沾满油污的工装','armor','👕','耐用的工作服，虽然满是油污但非常结实。','upper',{subtype:'top_male',attribute:'tattered'},[],'Common',50),outer:pu('多功能工具带','armor','🔨','挂满了各种工具的皮带，有扳手、螺丝刀、钳子等。','outer',{subtype:'coat',attribute:'leather'},[{trigger:'passive',action:'buff',target:'self',modifiers:{int:2}}],'Uncommon',600),hands:pu('防割手套','armor','🧤','厚实的皮革手套，保护双手免受机械伤害。','hands',{subtype:'glove',attribute:'leather'},[],'Common',80),underwear:pu('破旧背心','armor','👕','有些破旧的背心。','underwear',{subtype:'lingerie_top',attribute:'tattered'},[],'Common',10),underpants:pu('平角裤','armor','🩲','普通的平角裤。','underpants',{subtype:'underpants_male',attribute:'common'},[],'Common',15),socks:pu('棉袜','armor','🧦','普通的棉袜。','socks',{subtype:'sock_short',attribute:'common'},[],'Common',10),shoes:pu('防砸劳保鞋','armor','👞','钢头劳保鞋，能抵御重物砸落。','shoes',{subtype:'boot_heavy',attribute:'plate'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:2}}],'Uncommon',350)},e.skills={wrench_smash:gu('扳手猛击','用巨型扳手进行一次猛烈的击打。','active',{sp:10},0,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d10+STR',tags:['physical','blunt']}],['physical','melee']),machine_empathy:{name:'械心通感',description:'能够模糊地感知到机械的"情绪"与构造，这让他在修理和改造方面拥有无与伦比的潜力。',type:'passive',tier:2,tags:['epic','talent','tech'],cooldown:0,target:'self',effects:[{trigger:'passive',action:'buff',target:'self',modifiers:{int:5}},{trigger:'passive',action:'buff',target:'self',modifiers:{dex:2}},{trigger:'passive',action:'buff',target:'self',modifiers:{physical_dmg:15}}]},emergency_repair:gu('紧急维修','利用随身工具进行快速修复，恢复少量生命值。','active',{sp:15},3,[{trigger:'immediate',action:'heal',target:'self',value:'2d6+INT',tags:['hp']}],['tech','heal'],'self')},e.inventory.wallet.ledger=350,e.inventory.items={id_01:{name:'铜制齿轮',type:'material',count:5,quality:'Common',emoji:'⚙️',desc:'废墟工坊中找到的铜制齿轮，虽然有些磨损但还能使用。是机械制作的基础材料。',value:15,subtype:'ingot',iconVariant:4},id_02:{...mu('机油瓶','🛢️','用来润滑机械的黑色机油，也可以涂抹在伤口上止血（虽然不太卫生）。',[{trigger:'immediate',action:'heal',target:'self',value:'1d4+2',tags:['hp']}],{subtype:'potion',iconVariant:1},20),count:3},id_03:{name:'弹簧零件',type:'material',count:3,quality:'Common',emoji:'🔩',desc:'从废弃机械上拆下的弹簧，弹性依然良好。',value:10,subtype:'ingot',iconVariant:6},id_04:{name:'破旧维修手册',type:'misc',count:1,quality:'Uncommon',emoji:'📖',desc:'一本沾满油污的维修手册，是雷恩自学机械的启蒙读物。封面已经模糊，但内容还能辨认。',value:50,subtype:'book'}},e.player.private={Body_Type:'少年',Body_Hair:'稀疏',Pubic_Hair:'稀疏',Penis_Length:'12cm',Penis_Girth:'普通',Penis_Shape:'普通',Foreskin_Status:'未割',Testicle_Size:'普通',Scrotum_Appearance:'正常',Erectile_Function:'正常',Ejaculation_Volume:'少量',Refractory_Period:'短',Virginity_Status:'童贞',Ejaculation_Count:0,Impregnation_Count:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:5,Sexual_Orientation:'异性恋',Skin_Sensitivity:'中'},e}},{id:'avril',name:'艾薇儿',icon:'🧝‍♀️',race:'精灵',class:'奴隶',gender:'女',desc:'翡翠联邦边境村落被兽人摧毁后沦为奴隶的精灵少女，母亲遗物🟣稀有级【月神泪滴】守护着她的心智。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'艾薇儿',race:'精灵',class:'奴隶',level:1,exp:{current:0,max:10},gender:'女',age_bio:'14',age_psy:'14',alignment:'守序善良',identity:'俘虏/奴隶',status_desc:'身穿破烂的麻布囚服，月白色的长发因缺乏打理而纠结干枯，澄澈的绿色眼眸因恐惧与迷茫而显得黯淡。尖俏的耳朵无力地垂着，瘦弱的身体蜷缩在铁笼角落。'},e.player.appearance={hair_color:'月白色',hair_length:'长发',hair_style:'纠结干枯',eye_color:'翠绿色',height:'140cm',body_build:'瘦弱纤细',skin_tone:'苍白',face_features:'精致的精灵面容',special_marks:'身上有一些被虐待的伤痕',racial_traits:'尖俏的精灵耳朵'},e.world.time='10:00',e.world.weather='☁️',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['中立地带','铃兰平原','奴隶商队','运输马车','铁笼'],name:'奴隶运输马车',desc:'颠簸的马车里，生锈的铁笼中挤满了待售的"货物"。空气中弥漫着汗臭、血腥和绝望的气息。透过铁栏，只能看到外面荒凉的道路。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:6,DEX:14,CON:6,INT:12,WIS:14,CHA:10,SPD:10,CRIT_RATE:5,CRIT_DMG:150,AC:8},e.player.stats={hp:{current:12,max:22},mp:{current:28,max:34},sp:{current:10,max:26}},e.player.equipment={upper:pu('破烂麻布囚服','armor','👗','破旧不堪的麻布衣物，几乎无法遮体。','upper',{subtype:'top_female',attribute:'tattered'},[],'Common',5),accessory_1:pu('月神泪滴','accessory','💧','母亲的遗物，一颗水滴状的晶石，散发着微弱的清冷月光。能缓慢治愈伤势，并守护佩戴者的心智免于崩溃。','accessory_1',{subtype:'necklace',attribute:'divine'},[{trigger:'passive',action:'buff',target:'self',statusName:'月神祝福',modifiers:{wis:5,int:3},duration:-1},{trigger:'turn_start',action:'heal',target:'self',value:'2',tags:['hp']}],'Rare',5e4)},e.skills={nature_affinity:gu('自然亲和','精灵的天生能力，对自然元素有亲和感。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',modifiers:{wis:2}},{trigger:'passive',action:'buff',target:'self',modifiers:{nature_res:10}}],['racial','nature'])},e.inventory.wallet.ledger=0,e.inventory.items={id_01:{name:'母亲的发丝',type:'misc',count:1,quality:'Common',emoji:'💫',desc:'一缕月白色的精灵发丝，用一根草茎小心地系着。这是艾薇儿在被俘时唯一能藏起来的东西，是她与母亲最后的联系。',value:0,subtype:'letter'}},e.player.private={Body_Type:'少女',Breast_Size:'AA杯',Breast_Volume:'微乳',Breast_Shape:'娇小型乳房',Areola_Color:'淡粉色',Nipple_Sensitivity:'中',Vulva_Appearance:'馒头型阴唇',Vulva_Color:'粉嫩',Clitoris_Sensitivity:'中',Pubic_Hair:'无',Virginity_Status:'处女',Hymen_Status:'完整',Pregnancy_Status:'未怀孕',Fertility:'未发育',Menstrual_Cycle:'未初潮',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:0,Sexual_Orientation:'未知',Skin_Sensitivity:'高'},e}},{id:'guli',name:'咕哩',icon:'🫧',race:'史莱姆',class:'魔物',gender:'无',desc:'诞生于永劫树海边缘的最普通最弱小的史莱姆，却拥有独一无二的传说级天赋【无限吞噬】。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'咕哩',race:'史莱姆',class:'魔物',level:1,exp:{current:0,max:100},gender:'无',age_bio:'1',age_psy:'1',alignment:'绝对中立',identity:'魔物',status_desc:'一团直径约三十厘米的半透明蓝色凝胶状物质，内部包裹着一颗小小的闪亮核心。身体可以自由地变形、拉伸和流动。'},e.player.appearance={hair_color:'无',hair_length:'无',hair_style:'无',eye_color:'核心微微发光',height:'约30cm直径（可变）',body_build:'不定形凝胶状',skin_tone:'半透明蓝色',face_features:'无固定面容，可模仿其他生物',special_marks:'核心处有一颗小小的光点',racial_traits:'凝胶状身体，可自由变形、拉伸、流动'},e.world.time='12:00',e.world.weather='🌲',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['翡翠联邦','永劫树海','边缘地带','阳光林地'],name:'树海边缘',desc:'茂密的树林边缘，阳光透过树叶形成斑驳的光影。空气中弥漫着清新的草木气息，偶尔有小动物和昆虫经过。这里是永劫树海中少数阳光能够照射到的安全地带。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:4,DEX:8,CON:16,INT:4,WIS:6,CHA:2,SPD:6,CRIT_RATE:5,CRIT_DMG:150,AC:6},e.player.stats={hp:{current:42,max:42},mp:{current:18,max:18},sp:{current:36,max:36}},e.player.equipment={},e.skills={gel_slam:gu('凝胶冲撞','用自己的身体撞击敌人。','active',{sp:5},0,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d4+CON',tags:['physical','blunt']}],['physical','melee']),split_regeneration:gu('分裂再生','分出一部分身体来恢复伤口。','active',{sp:10},3,[{trigger:'immediate',action:'heal',target:'self',value:'1d6+CON',tags:['hp']}],['heal','slime'],'self'),infinite_devour:{name:'无限吞噬',description:'其存在本身即是一个奇迹。能够吞噬万物，有概率获取被吞噬目标的特性、技能或属性。战斗胜利时，击杀的敌人可能永久提升自身属性。',type:'passive',tier:3,tags:['legendary','talent','absorption'],cooldown:0,target:'self',effects:[{trigger:'on_kill',action:'buff',target:'self',statusName:'吞噬·力量',modifiers:{str:1},persistent:!0,chance:12},{trigger:'on_kill',action:'buff',target:'self',statusName:'吞噬·敏捷',modifiers:{dex:1},persistent:!0,chance:12},{trigger:'on_kill',action:'buff',target:'self',statusName:'吞噬·体质',modifiers:{con:1},persistent:!0,chance:12},{trigger:'on_kill',action:'buff',target:'self',statusName:'吞噬·智力',modifiers:{int:1},persistent:!0,chance:12},{trigger:'on_kill',action:'buff',target:'self',statusName:'吞噬·感知',modifiers:{wis:1},persistent:!0,chance:12},{trigger:'on_kill',action:'buff',target:'self',statusName:'吞噬·魅力',modifiers:{cha:1},persistent:!0,chance:12},{trigger:'on_kill',action:'heal',target:'self',value:'10',tags:['hp'],chance:50},{trigger:'on_kill',action:'heal',target:'self',value:'5',tags:['sp'],chance:50},{trigger:'passive',action:'buff',target:'self',statusName:'凝胶身体',modifiers:{physical_res:10}}]}},e.inventory.wallet.ledger=0,e.inventory.items={id_01:{name:'未消化的浆果',type:'consumable',count:2,quality:'Common',emoji:'🫐',desc:'咕哩在森林中吞噬的野生浆果，还没有完全消化。可以吐出来食用。',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'1d4',tags:['hp']}],subtype:'food_fruit',iconVariant:2},id_02:{name:'闪亮的石头',type:'misc',count:1,quality:'Common',emoji:'✨',desc:'咕哩在阳光林地发现的闪闪发光的小石头，因为好看所以吞了进去。',value:10,subtype:'gem'}},e.player.private={Body_Type:'不定形',Skin_Sensitivity:'全身',Sexual_Orientation:'无',Kinks:['吞噬','包裹','变形']},e}},{id:'yeyuan',name:'夜愿',icon:'🌑',race:'影裔人类',class:'阴影使徒',gender:'女',desc:'一个移动的"灾厄源"，拥有诅咒级权能【永夜】，被所有人恐惧、憎恨、驱逐的流浪者。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'夜愿',race:'影裔人类',class:'阴影使徒',level:1,exp:{current:0,max:10},gender:'女',age_bio:'16',age_psy:'16',alignment:'绝对中立',identity:'灾厄源',status_desc:'墨一样漆黑的长发垂至腰间，皮肤是毫无血色的苍白。总是低着头，用过长的刘海遮住自己的脸。身体异常瘦弱，穿着破旧的布衣，散发着一种让生者不安的孤独气息。'},e.player.appearance={hair_color:'墨黑色',hair_length:'及腰长发',hair_style:'披散，刘海过长遮住脸',eye_color:'黑色',height:'145cm',body_build:'瘦弱',skin_tone:'苍白',face_features:'面容被遮住',special_marks:'周围的生物会无故感到不安',racial_traits:'散发着死亡的气息'},e.world.time='03:00',e.world.weather='🌑',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['圣银王国','西部乡野','无名废墟'],name:'枯萎的废墟',desc:'这是一片被黑暗吞噬的废墟。周围的草木已经枯萎变黑，仿佛生命本身被抽离。月光无法照进这里，只有她独自蜷缩在角落。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:8,DEX:14,CON:8,INT:12,WIS:10,CHA:4,SPD:12,CRIT_RATE:15,CRIT_DMG:180,AC:10},e.player.stats={hp:{current:26,max:26},mp:{current:34,max:34},sp:{current:28,max:28}},e.player.equipment={upper:pu('漆黑紧身衣','armor','🖤','与影子融为一体的衣物，似乎是由黑暗本身编织而成。','upper',{subtype:'top_female',attribute:'mythical'},[],'Rare',2e3),outer:pu('暗影斗篷','armor','🌑','仿佛由影子编织而成的斗篷，边缘如同流动的黑雾。','outer',{subtype:'cloak',attribute:'mythical'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:2}},{trigger:'passive',action:'buff',target:'self',modifiers:{dex:2}}],'Epic',25e3),underwear:pu('破旧裹胸布','armor','🩱','简单破旧的裹胸布。','underwear',{subtype:'lingerie_top',attribute:'tattered'},[],'Common',5),underpants:pu('黑色短裤','armor','🩳','破旧的黑色短裤。','underpants',{subtype:'pant_short',attribute:'tattered'},[],'Common',10),shoes:pu('无声布鞋','armor','👟','走路不会发出任何声音的布鞋。','shoes',{subtype:'shoe_light',attribute:'common'},[],'Uncommon',300)},e.skills={shadow_claw:gu('影爪','操控影子形成利爪攻击敌人。','active',{mp:5},0,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d8+DEX',tags:['dark','physical']}],['dark','physical']),shadow_dive:gu('影潜','融入阴影中躲避攻击。','active',{mp:8},3,[{trigger:'immediate',action:'buff',target:'self',statusName:'影潜',modifiers:{dodgerate:50},duration:2}],['dark','defensive'],'self'),eternal_night:{name:'永夜',description:'能够操控影子，潜行于黑暗，并能汲取他人的生命力来维系自身的存在。这股力量异常强大，能轻易杀死敌人，但也在无时无刻地吞噬着她的情感与人性。',type:'passive',tier:3,tags:['cursed','power','dark','drain'],cooldown:0,target:'self',effects:[{trigger:'turn_start',action:'damage',target:'all_enemies',value:'15',tags:['dark','drain']},{trigger:'turn_start',action:'heal',target:'self',value:'15',tags:['hp']},{trigger:'passive',action:'buff',target:'self',modifiers:{dark_dmg:50}},{trigger:'passive',action:'buff',target:'self',modifiers:{dark_res:30}},{trigger:'passive',action:'buff',target:'self',modifiers:{cha:-5}}]}},e.inventory.wallet.ledger=0,e.inventory.items={id_01:{...mu('干硬黑面包','🍞','从废弃村庄翻出来的面包，已经硬得像石头，但至少还能充饥。',[{trigger:'immediate',action:'heal',target:'self',value:'1d4',tags:['hp']}],{subtype:'food_bread',iconVariant:3},3),count:2},id_02:{...mu('凝固暗影','🌑','夜愿的【永夜】能力凝结的暗影实体，可以吸收后恢复魔力。散发着令人不安的黑暗气息。',[{trigger:'immediate',action:'heal',target:'self',value:'2d6+4',tags:['mp']}],{subtype:'gem',iconVariant:14},0),count:3},id_03:{name:'枯萎的野花',type:'misc',count:1,quality:'Common',emoji:'🥀',desc:'曾经是一朵美丽的野花，但在夜愿的接触下枯萎了。她还是留着它，作为自己曾经想要触碰美好事物的证明。',value:0,subtype:'flower'}},e.player.private={Body_Type:'少女',Breast_Size:'AA杯',Breast_Volume:'微乳',Breast_Shape:'娇小型乳房',Areola_Color:'淡粉色',Nipple_Sensitivity:'低',Vulva_Appearance:'馒头型阴唇',Vulva_Color:'苍白',Clitoris_Sensitivity:'低',Pubic_Hair:'无',Virginity_Status:'处女',Hymen_Status:'完整',Pregnancy_Status:'未怀孕',Fertility:'正常',Menstrual_Cycle:'正常',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:0,Sexual_Orientation:'未知',Skin_Sensitivity:'低'},e}},{id:'zero',name:'"零号"',icon:'🔬',race:'未知（高度改造人类）',class:'实验体',gender:'女',desc:'古代文明禁忌实验中唯一幸存的"作品"，从【葬神陵墓】深处苏醒的记忆空白存在，拥有禁忌级天赋【混沌适应性】。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'"零号"',race:'未知（高度改造人类）',class:'实验体',level:1,exp:{current:0,max:10},gender:'女',age_bio:'18',age_psy:'80',alignment:'绝对中立',identity:'古代实验体',status_desc:'一头长及脚踝的苍白长发，双眼被一条陈旧的黑色布带蒙住。肌肤呈现病态的白色，隐约可见皮下的青色血管。'},e.player.appearance={hair_color:'苍白色',hair_length:'长及脚踝',hair_style:'自然垂落',eye_color:'白色',height:'150cm',body_build:'纤细',skin_tone:'苍白',face_features:'双眼被陈旧的黑色布带蒙住',special_marks:'皮下隐约可见青色血管，身上有实验留下的痕迹',racial_traits:'身体似乎被反复分解与重构，用以适应不应存在于世的力量'},e.world.time='00:00',e.world.weather='🌑',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['晶沙帝国','沙漠深处','葬神陵墓','实验区','休眠舱'],name:'崩塌的休眠室',desc:'古老的实验设施早已崩塌，到处是落满尘埃的精密仪器残骸。一个打开的休眠舱中，覆盖着数千年的灰尘，被某种力量唤醒的"它"正从沉睡中苏醒。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:12,DEX:14,CON:16,INT:10,WIS:8,CHA:6,SPD:10,CRIT_RATE:10,CRIT_DMG:170,AC:14},e.player.stats={hp:{current:42,max:42},mp:{current:30,max:30},sp:{current:36,max:36}},e.player.equipment={head:pu('陈旧黑色布带','armor','🩹','蒙住双眼的陈旧布带，似乎有某种封印作用。','head',{subtype:'hat',attribute:'mythical'},[],'Rare',1e4),upper:pu('实验服残片','armor','🥼','破碎的白色实验服，只能勉强遮体。','upper',{subtype:'top_female',attribute:'tattered'},[],'Common',5)},e.skills={instinct_strike:gu('本能打击','凭借身体本能进行的攻击。','active',{sp:5},0,[{trigger:'immediate',action:'damage',target:'enemy',value:'1d8+STR',tags:['physical']}],['physical','melee']),chaos_adaptation:{name:'混沌适应性',description:'身体拥有惊人的适应力，所有受到的伤害都会被削减。更可怕的是，在受伤时，身体有概率发生不可预测的进化，可能获得增益，也可能产生有害的变异。',type:'passive',tier:3,tags:['forbidden','talent','adaptation','chaos'],cooldown:0,target:'self',effects:[{trigger:'passive',action:'buff',target:'self',modifiers:{all_res:20}},{trigger:'passive',action:'buff',target:'self',modifiers:{con:4}},{trigger:'on_hurt',action:'buff',target:'self',statusName:'适应进化',modifiers:{con:1},chance:10,duration:-1},{trigger:'on_hurt',action:'buff',target:'self',statusName:'混沌变异',modifiers:{int:-1},chance:10,duration:-1}]},regeneration:gu('再生','身体的适应性允许快速恢复伤口。','active',{sp:15},3,[{trigger:'immediate',action:'heal',target:'self',value:'2d6+CON',tags:['hp']}],['heal','adaptation'],'self')},e.inventory.wallet.ledger=0,e.inventory.items={id_01:{name:'休眠舱碎片',type:'material',count:3,quality:'Rare',emoji:'🔷',desc:'从休眠舱上脱落的金属碎片，材质未知，表面刻有无法辨认的古代符文。似乎蕴含着某种能量。',value:500,subtype:'crystal',attribute:'mythical'},id_02:{name:'实验记录残页',type:'misc',count:1,quality:'Rare',emoji:'📜',desc:'一张几乎腐烂的纸张，上面的文字大部分已经模糊。能辨认出的只有"零号"和"适应性"几个词。也许能找到解读它的人。',value:1e3,subtype:'letter'},id_03:{...mu('未知药剂残液','🧪','在休眠舱附近找到的半瓶液体，颜色呈现诡异的银色。喝下去会发生什么？',[{trigger:'immediate',action:'heal',target:'self',value:'3d6',tags:['hp']},{trigger:'immediate',action:'heal',target:'self',value:'2d6',tags:['mp']}],{subtype:'potion',iconVariant:15},0),count:1}},e.player.private={Body_Type:'少女',Breast_Size:'A杯',Breast_Volume:'微乳',Breast_Shape:'碗型乳房',Areola_Color:'苍白粉色',Nipple_Sensitivity:'低',Vulva_Appearance:'馒头型阴唇',Vulva_Color:'苍白',Clitoris_Sensitivity:'低',Pubic_Hair:'无阴毛',Virginity_Status:'非处女',Hymen_Status:'已破裂',Pregnancy_Status:'未怀孕',Fertility:'无',Menstrual_Cycle:'无',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:0,Sexual_Orientation:'无',Skin_Sensitivity:'低'},e}},{id:'seraphina',name:'塞拉菲娜',icon:'👼',race:'神裔人类',class:'神官',gender:'女',desc:'世界因果的"锚点"，诞生于古老神殿。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'塞拉菲娜',race:'神裔人类',class:'神官',level:1,exp:{current:0,max:10},gender:'女',age_bio:'18',identity:'圣女',alignment:'守序善良'},e.world.time='06:00',e.world.weather='☀️',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['圣银王国','圣都·艾恩格拉德','圣光神殿','祈祷厅'],name:'主祈祷厅',desc:'晨光透过彩色玻璃窗洒下，神像前的祭坛散发着温暖的圣光。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:8,DEX:10,CON:10,INT:12,WIS:18,CHA:16,SPD:10,CRIT_RATE:5,CRIT_DMG:150,AC:12},e.player.stats={hp:{current:30,max:30},mp:{current:34,max:34},sp:{current:30,max:30}},e.player.equipment={weapon_main:pu('圣光权杖','weapon','✨','散发着神圣光芒的权杖。','weapon_main',{subtype:'staff',attribute:'divine'},[{trigger:'on_hit',action:'damage',target:'enemy',value:'1d6+WIS',tags:['light']}],'Rare',8e3),upper:pu('圣洁祭袍','armor','👗','纯白的神官祭袍。','upper',{subtype:'top_female',attribute:'gold_trim'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:2}}],'Rare',6e3),head:pu('金色发饰','armor','👑','镶嵌着神圣宝石的发饰。','head',{subtype:'hat',attribute:'gold_trim'},[],'Rare',3e3),shoes:pu('白色凉鞋','armor','👡','轻便的白色凉鞋。','shoes',{subtype:'shoe_light',attribute:'noble'},[],'Uncommon',150),underwear:pu('白色胸衣','armor','🩱','纯白的胸衣。','underwear',{subtype:'lingerie_top',attribute:'silk'},[],'Uncommon',100),underpants:pu('白色内裤','armor','🩲','纯白的内裤。','underpants',{subtype:'underpants_female',attribute:'silk'},[],'Uncommon',80),accessory_1:pu('神圣徽记','accessory','⚜️','神殿赐予的圣徽。','accessory_1',{subtype:'necklace',attribute:'divine'},[{trigger:'passive',action:'buff',target:'self',modifiers:{wis:3}}],'Epic',5e4)},e.skills={holy_heal:gu('圣光治愈','引导圣光治愈伤口。','active',{mp:5},0,[{trigger:'immediate',action:'heal',target:'ally',value:'2d8+WIS',tags:['hp']}],['light','heal'],'single_ally'),purifying_light:gu('净化之光','释放净化之光驱散黑暗。','active',{mp:10},2,[{trigger:'immediate',action:'damage',target:'enemy',value:'2d6+WIS',tags:['light']},{trigger:'immediate',action:'cleanse',target:'ally',tags:['debuff']}],['light','purify']),divine_haste:gu('神速祝福','神圣的时光祝福，每回合概率获得额外行动机会。','passive',void 0,0,[{trigger:'turn_start',action:'extra_turn',target:'self',chance:30}],['passive','time','divine'])},e.inventory.wallet.ledger=5e4,e.inventory.items={id_01:{...mu('圣水','💧','经过神殿祝福的纯净之水，饮用后可治愈伤势，对亡灵和恶魔有特殊效果。',[{trigger:'immediate',action:'heal',target:'self',value:'2d8+5',tags:['hp']}],{subtype:'potion',iconVariant:0},300),count:5},id_02:{...mu('祝福面包','🥖','神殿厨房制作的面包，每一个都经过圣光的祝福。食用后能恢复少量生命和精神。',[{trigger:'immediate',action:'heal',target:'self',value:'1d6+2',tags:['hp']},{trigger:'immediate',action:'heal',target:'self',value:'1d4',tags:['mp']}],{subtype:'food_bread',iconVariant:7},50),count:3},id_03:{name:'圣典手抄本',type:'misc',count:1,quality:'Rare',emoji:'📖',desc:'塞拉菲娜亲手抄写的圣光教典节选，封面镶嵌着神殿的徽记。是她每日祈祷和修行的必备之物。',value:2e3,subtype:'book'},id_04:{name:'净化圣盐',type:'material',count:5,quality:'Uncommon',emoji:'🧂',desc:'经过圣光祝福的盐，可用于驱邪仪式或净化被污染的物品。',value:100,subtype:'powder',iconVariant:8}},e.player.private={Body_Type:'少女',Breast_Size:'C杯',Breast_Volume:'普乳',Breast_Shape:'挺拔型乳房',Areola_Color:'淡粉色',Nipple_Sensitivity:'中',Vulva_Appearance:'馒头型阴唇',Vulva_Color:'粉嫩',Clitoris_Sensitivity:'中',Pubic_Hair:'无',Virginity_Status:'处女',Hymen_Status:'完整',Pregnancy_Status:'未怀孕',Fertility:'正常',Menstrual_Cycle:'正常',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:0,Sexual_Orientation:'无性恋',Skin_Sensitivity:'中'},e}},{id:'ignis',name:'伊格尼斯·龙焰',icon:'🐉',race:'龙裔',class:'活体兵器',gender:'女',desc:'晶沙古帝国的末代公主,禁忌仪式的产物,拥有神话级天赋【烬灭龙心】的"伪神"容器。',generator:()=>{const e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};return e.player.base={...e.player.base,name:'伊格尼斯·龙焰',race:'龙裔',class:'活体兵器',level:1,exp:{current:0,max:10},gender:'女',age_bio:'16',age_psy:'16',alignment:'混乱中立',identity:'末代公主/伪神容器',status_desc:'一头火焰般的红色短发桀骜不驯,金色的竖瞳宛如熔融的黄金,透露出与年龄不符的威严与暴戾。脸颊和脖颈处覆盖着细密的赤色龙鳞,头顶上两根初生的龙角彰显着她危险的本质。'},e.player.appearance={hair_color:'火焰红色',hair_length:'短发',hair_style:'桀骜不驯',eye_color:'金色竖瞳',height:'168cm',body_build:'高挑挺拔,充满爆发力',skin_tone:'健康小麦色',face_features:'威严而暴戾,带着龙族的高傲',special_marks:'脸颊和脖颈处覆盖着细密的赤色龙鳞',racial_traits:'头顶两根初生的龙角,身体部分覆盖龙鳞'},e.world.time='14:00',e.world.weather='🔥',e.world.date='200-05-01',e.world.canUseWorldMap=!1,e.scene={locationPath:['晶沙帝国遗迹','沙漠深处','崩塌的炼金实验室'],name:'废弃的炼金实验室',desc:'古老帝国的炼金实验室早已崩塌,到处是破碎的仪器和焦黑的痕迹。空气中弥漫着硫磺和灰烬的气息,地面上刻满了复杂的炼金阵纹。',npcs:{},objects:{},exits:{}},e.relation={characters:{},factions:{}},e.player.attributes={STR:18,DEX:12,CON:16,INT:10,WIS:6,CHA:12,SPD:11,CRIT_RATE:15,CRIT_DMG:200,AC:14},e.player.stats={hp:{current:42,max:42},mp:{current:30,max:30},sp:{current:36,max:36}},e.player.equipment={upper:pu('破损的帝国战甲','armor','🛡️','晶沙帝国炼金术的杰作,虽已破损但依然坚固。','upper',{subtype:'top_female',attribute:'plate'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:3,fire_res:20}}],'Epic',3e4),hands:pu('龙鳞护手','armor','🧤','由她自己脱落的龙鳞制成的护手。','hands',{subtype:'glove',attribute:'scale'},[{trigger:'passive',action:'buff',target:'self',modifiers:{str:2}}],'Rare',5e3),shoes:pu('战斗靴','armor','👢','适合战斗的重型靴子。','shoes',{subtype:'boot_heavy',attribute:'plate'},[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:1}}],'Uncommon',400),underwear:pu('简易胸衣','armor','🩱','简单的胸衣。','underwear',{subtype:'lingerie_top',attribute:'common'},[],'Common',20),underpants:pu('短裤','armor','🩳','简单的短裤。','underpants',{subtype:'pant_short',attribute:'common'},[],'Common',15)},e.skills={dragon_breath:gu('龙息','喷吐灼热的龙炎攻击敌人。','active',{mp:8},1,[{trigger:'immediate',action:'damage',target:'enemy',value:'2d8+STR',tags:['fire','magic']}],['fire','magic','dragon']),ember_rage:gu('烬灭狂怒','释放龙心的力量,造成巨额火焰伤害,但会损失理智(降低感知)。','active',{hp:10,mp:15},3,[{trigger:'immediate',action:'damage',target:'all_enemies',value:'3d10+STR+INT',tags:['fire','magic']},{trigger:'immediate',action:'debuff',target:'self',statusName:'理智侵蚀',duration:3,modifiers:{wis:-3}}],['fire','magic','dragon'],'all_enemies'),ember_dragon_heart:{name:'烬灭龙心',description:'心脏即是龙魂的熔炉,拥有无与伦比的火焰亲和力与肉体力量。但每当动用这份力量,无数灵魂的怨念与龙魂混合而成的精神风暴便会吞噬理智。',type:'passive',tier:3,tags:['mythical','talent','dragon','fire'],cooldown:0,target:'self',effects:[{trigger:'passive',action:'buff',target:'self',modifiers:{fire_dmg:60}},{trigger:'passive',action:'buff',target:'self',modifiers:{str:4,con:3}},{trigger:'passive',action:'buff',target:'self',modifiers:{fire_res:50}},{trigger:'turn_start',action:'heal',target:'self',value:'10%_max',tags:['hp']},{trigger:'passive',action:'buff',target:'self',modifiers:{wis:-4}}]},dragon_scales:gu('龙鳞护体','龙裔的天生防御,龙鳞提供额外护甲。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',modifiers:{ac:2}},{trigger:'passive',action:'buff',target:'self',modifiers:{physical_res:10}}],['racial','dragon'])},e.inventory.wallet.ledger=1e3,e.inventory.items={id_01:{...mu('龙血结晶','💎','她自己的龙血凝结而成的结晶,蕴含强大的生命力。食用后恢复大量生命值。',[{trigger:'immediate',action:'heal',target:'self',value:'3d8+10',tags:['hp']}],{subtype:'gem',iconVariant:11},500),count:2},id_02:{...mu('烈焰药剂','🔥','炼金术制成的火焰药剂,饮用后短时间内火焰伤害提升。',[{trigger:'immediate',action:'buff',target:'self',statusName:'烈焰之力',duration:3,modifiers:{fire_dmg:30}}],{subtype:'potion',iconVariant:9},300),count:3},id_03:{name:'帝国徽记碎片',type:'misc',count:1,quality:'Epic',emoji:'👑',desc:'晶沙古帝国皇室的徽记碎片,证明着她末代公主的身份。也许能唤起某些人的记忆。',value:1e4,subtype:'artifact_curse'}},e.player.private={Body_Type:'少女',Breast_Size:'B杯',Breast_Volume:'普乳',Breast_Shape:'挺拔型乳房',Areola_Color:'淡红色',Nipple_Sensitivity:'低',Vulva_Appearance:'馒头型阴唇',Vulva_Color:'粉红',Clitoris_Sensitivity:'中',Pubic_Hair:'无',Virginity_Status:'处女',Hymen_Status:'完整',Pregnancy_Status:'未怀孕',Fertility:'正常',Menstrual_Cycle:'正常',Vaginal_Intercourse:0,Oral_Sex:0,Anal_Intercourse:0,Masturbation:0,Sexual_Orientation:'未知',Skin_Sensitivity:'低',Kinks:['支配','力量']},e}}],fu={人类:{desc:'全属性均衡，适应性强',mods:{}},精灵:{desc:'敏捷/感知+，优雅而敏锐',mods:{DEX:2,WIS:1,CON:-1}},兽人:{desc:'力量/体质+，强壮而坚韧',mods:{STR:2,CON:1,INT:-1}},矮人:{desc:'体质/力量+，矮壮而固执',mods:{CON:2,STR:1,CHA:-1}},魔族:{desc:'智力/魅力+，神秘而诱惑',mods:{INT:2,CHA:1,WIS:-1}},龙裔:{desc:'力量/魅力+，威严而强大',mods:{STR:2,CHA:1,DEX:-1}},史莱姆:{desc:'体质极高，智力低下，可变形态',mods:{CON:8,INT:-4,WIS:-2,CHA:0}},影裔:{desc:'敏捷/智力+，与阴影共生',mods:{DEX:2,INT:1,STR:-1}},神裔:{desc:'感知/魅力+，拥有神圣血脉',mods:{WIS:2,CHA:1,CON:-1}}};function vu(e){let t=0;for(const a of Object.keys(e)){const e=a.match(/^id_(\d+)$/);if(e){const a=parseInt(e[1],10);a>t&&(t=a)}}return`id_${(t+1).toString().padStart(2,'0')}`}const yu=(e,t,a,s,n,r=[],l,o,i)=>({name:e,type:t,count:1,quality:i?.quality??'Common',emoji:a,desc:s,value:n,effects:r,slotTarget:l,subtype:o?.subtype,attribute:o?.attribute,iconVariant:i?.iconVariant,capacityBonus:i?.capacityBonus}),bu=(e,t,a,s,n=0,r=[],l='single_enemy',o=[])=>({name:e,type:a,tier:1,tags:o,cooldown:n,cost:s,description:t,target:l,effects:r}),xu={consumable:'📦 消耗品',equipment:'🛡️ 装备',combatSkill:'⚔️ 战斗技能',passiveSkill:'💠 被动技能',explorationSkill:'🗺️ 探索技能',money:'💰 货币'},wu=[{id:'s_hp_pot',name:'小型生命药水',category:'consumable',type:'消耗品',cost:1,data:yu('小型生命药水','consumable','🧪','炼金术的基础产物，味道像草莓。',5,[{trigger:'immediate',action:'heal',target:'self',value:'15',tags:['hp']}],void 0,{subtype:'potion'})},{id:'s_hp_pot_m',name:'中型生命药水',category:'consumable',type:'消耗品',cost:3,data:yu('中型生命药水','consumable','🧪','更浓缩的生命精华，回复效果显著。',15,[{trigger:'immediate',action:'heal',target:'self',value:'35',tags:['hp']}],void 0,{subtype:'potion'})},{id:'s_hp_pot_l',name:'大型生命药水',category:'consumable',type:'消耗品',cost:8,data:yu('大型生命药水','consumable','🧪','顶级炼金师的杰作，能治愈重伤。',40,[{trigger:'immediate',action:'heal',target:'self',value:'80',tags:['hp']}],void 0,{subtype:'potion'})},{id:'s_mp_pot',name:'小型魔力药水',category:'consumable',type:'消耗品',cost:1,data:yu('小型魔力药水','consumable','🧪','散发着微光的蓝色液体。',5,[{trigger:'immediate',action:'heal',target:'self',value:'10',tags:['mp']}],void 0,{subtype:'potion'})},{id:'s_mp_pot_m',name:'中型魔力药水',category:'consumable',type:'消耗品',cost:3,data:yu('中型魔力药水','consumable','🧪','蕴含更多魔力的蓝色药剂。',15,[{trigger:'immediate',action:'heal',target:'self',value:'25',tags:['mp']}],void 0,{subtype:'potion'})},{id:'s_stimulant',name:'战斗兴奋剂',category:'consumable',type:'消耗品',cost:2,data:yu('战斗兴奋剂','consumable','💉','短时间内大幅提升力量，但有副作用。',10,[{trigger:'immediate',action:'buff',target:'self',statusName:'狂暴',duration:3,modifiers:{str:4}}],void 0,{subtype:'potion'})},{id:'s_speed_pot',name:'迅捷药剂',category:'consumable',type:'消耗品',cost:3,data:yu('迅捷药剂','consumable','💨','喝下后身体变得轻盈，行动更加敏捷。',15,[{trigger:'immediate',action:'buff',target:'self',statusName:'迅捷',duration:3,modifiers:{spd:20,dex:2}}],void 0,{subtype:'potion'})},{id:'s_iron_skin',name:'铁皮药剂',category:'consumable',type:'消耗品',cost:3,data:yu('铁皮药剂','consumable','🛡️','皮肤暂时变得坚硬如铁。',15,[{trigger:'immediate',action:'buff',target:'self',statusName:'铁皮',duration:3,modifiers:{ac:3,con:2}}],void 0,{subtype:'potion'})},{id:'s_antidote',name:'解毒剂',category:'consumable',type:'消耗品',cost:2,data:yu('解毒剂','consumable','💚','能清除体内的毒素和负面状态。',10,[{trigger:'immediate',action:'cleanse',target:'self',count:2}],void 0,{subtype:'potion'})},{id:'s_revive',name:'凤凰之羽',category:'consumable',type:'消耗品',cost:10,data:yu('凤凰之羽','consumable','🪶','传说中凤凰的羽毛，拥有起死回生的奇迹之力。',50,[{trigger:'immediate',action:'revive',target:'ally',reviveHpPercent:50}],void 0,{subtype:'rune'})},{id:'s_bag_basic',name:'旅行者挎包',category:'equipment',type:'饰品',cost:2,limit:!0,data:yu('旅行者挎包','accessory','👜','简单的挎包，能多装几件小物品。',30,[],'accessory_1',{subtype:'bag'},{capacityBonus:2})},{id:'s_bag',name:'冒险者背包',category:'equipment',type:'饰品',cost:5,limit:!0,data:yu('冒险者背包','accessory','🎒','冒险者标配的背包，合理的收纳让你身轻如燕。',80,[{trigger:'passive',action:'buff',target:'self',statusName:'轻装',duration:-1,modifiers:{dex:1}}],'accessory_1',{subtype:'bag'},{capacityBonus:4})},{id:'s_bag_large',name:'探险家大背包',category:'equipment',type:'饰品',cost:12,limit:!0,data:yu('探险家大背包','accessory','🎒','专业探险家使用的大容量背包，内部空间惊人。',200,[{trigger:'passive',action:'buff',target:'self',statusName:'轻装',duration:-1,modifiers:{dex:2}}],'accessory_1',{subtype:'bag'},{capacityBonus:8,quality:'Uncommon'})},{id:'s_bag_magic',name:'无底魔法袋',category:'equipment',type:'饰品',cost:30,limit:!0,data:yu('无底魔法袋','accessory','✨','施加了空间扩展魔法的神奇袋子，内部空间远超外观。',500,[{trigger:'passive',action:'buff',target:'self',duration:-1,modifiers:{dex:2,int:1}}],'accessory_1',{subtype:'bag'},{capacityBonus:12,quality:'Rare'})},{id:'s_sword',name:'生锈的铁剑',category:'equipment',type:'武器',cost:3,limit:!0,data:yu('生锈的铁剑','weapon','🗡️','甚至切不开硬面包，但总比空手好。',15,[{trigger:'on_hit',action:'damage',target:'target',value:'1d6',tags:['physical']}],'weapon_main',{subtype:'sword',attribute:'rusty'})},{id:'s_shield',name:'木盾',category:'equipment',type:'手部',cost:2,limit:!0,data:yu('木盾','weapon','🛡️','简单的橡木盾牌。',15,[{trigger:'passive',action:'buff',target:'self',statusName:'格挡',duration:-1,modifiers:{ac:1}}],'weapon_off',{subtype:'shield',attribute:'basic'})},{id:'s_iron_shield',name:'铁盾',category:'equipment',type:'手部',cost:5,limit:!0,data:yu('铁盾','weapon','🛡️','坚固的铁制盾牌，能抵挡更强的攻击。',50,[{trigger:'passive',action:'buff',target:'self',statusName:'铁壁',duration:-1,modifiers:{ac:2,con:1}}],'weapon_off',{subtype:'shield',attribute:'steel'},{quality:'Uncommon'})},{id:'s_mithril_vest',name:'秘银背心',category:'equipment',type:'上装',cost:8,limit:!0,data:yu('秘银背心','armor','👕','轻便且坚硬的秘银护具，精灵工艺。',100,[{trigger:'passive',action:'buff',target:'self',statusName:'秘银护甲',duration:-1,modifiers:{ac:3}}],'upper',{subtype:'top_male',attribute:'mythical'},{quality:'Uncommon'})},{id:'s_leather_armor',name:'皮甲',category:'equipment',type:'上装',cost:4,limit:!0,data:yu('皮甲','armor','🦺','轻便的皮革护甲，适合敏捷型战士。',40,[{trigger:'passive',action:'buff',target:'self',statusName:'轻甲',duration:-1,modifiers:{ac:1,dex:1}}],'upper',{subtype:'top_male',attribute:'leather'})},{id:'s_steel_sword',name:'钢剑',category:'equipment',type:'武器',cost:6,limit:!0,data:yu('钢剑','weapon','⚔️','锋利的钢制长剑，战士的可靠伙伴。',60,[{trigger:'on_hit',action:'damage',target:'target',value:'1d8+STR',tags:['physical']}],'weapon_main',{subtype:'sword',attribute:'steel'},{quality:'Uncommon'})},{id:'s_dagger',name:'匕首',category:'equipment',type:'武器',cost:2,limit:!0,data:yu('匕首','weapon','🗡️','轻巧的匕首，适合快速攻击。',20,[{trigger:'on_hit',action:'damage',target:'target',value:'1d4+DEX',tags:['physical']}],'weapon_main',{subtype:'dagger',attribute:'basic'})},{id:'s_staff',name:'法杖',category:'equipment',type:'武器',cost:5,limit:!0,data:yu('法杖','weapon','🪄','蕴含魔力的法杖，增强施法能力。',50,[{trigger:'on_hit',action:'damage',target:'target',value:'1d4+INT',tags:['magic']},{trigger:'passive',action:'buff',target:'self',statusName:'魔力增幅',duration:-1,modifiers:{int:2}}],'weapon_main',{subtype:'staff',attribute:'magic'},{quality:'Uncommon'})},{id:'s_bow',name:'短弓',category:'equipment',type:'武器',cost:4,limit:!0,data:yu('短弓','weapon','🏹','轻便的短弓，适合远程攻击。',40,[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+DEX',tags:['physical']}],'weapon_main',{subtype:'bow',attribute:'basic'})},{id:'s_fire_sword',name:'烈焰长剑',category:'equipment',type:'武器',cost:12,limit:!0,data:yu('烈焰长剑','weapon','🔥','剑身燃烧着永不熄灭的火焰。',200,[{trigger:'on_hit',action:'damage',target:'target',value:'1d8+STR',tags:['physical']},{trigger:'on_hit',action:'damage',target:'target',value:'1d6',tags:['fire']}],'weapon_main',{subtype:'sword',attribute:'fire'})},{id:'s_storm_hammer',name:'风暴战锤',category:'equipment',type:'武器',cost:25,limit:!0,data:yu('风暴战锤','weapon','⚡','传说中矮人王使用的战锤，蕴含雷霆之力。',500,[{trigger:'on_hit',action:'damage',target:'target',value:'2d6+STR',tags:['physical','lightning']},{trigger:'on_hit',action:'debuff',target:'target',statusName:'眩晕',duration:1,chance:30}],'weapon_main',{subtype:'hammer',attribute:'lightning'},{quality:'Rare'})},{id:'s_invis_cloak',name:'隐身斗篷',category:'equipment',type:'外套',cost:15,limit:!0,data:yu('隐身斗篷','armor','👻','穿上它，你将融入阴影。',300,[{trigger:'passive',action:'buff',target:'self',statusName:'隐匿',duration:-1,modifiers:{ac:1,dex:3,dodgerate:10}}],'outer',{subtype:'cloak',attribute:'mythical'},{quality:'Rare'})},{id:'s_skill_heal',name:'快速包扎',category:'combatSkill',type:'技能',cost:3,limit:!0,data:bu('快速包扎','紧急处理伤口。','active',{sp:3},2,[{trigger:'immediate',action:'heal',target:'self',value:15}],'self',['heal','support'])},{id:'s_skill_slash',name:'强力一击',category:'combatSkill',type:'技能',cost:3,limit:!0,data:bu('强力一击','蓄力后发动的沉重一击。','active',{sp:5},1,[{trigger:'immediate',action:'damage',target:'target',value:'1d8+STR',tags:['physical']}],'single_enemy',['physical','melee'])},{id:'s_skill_shield_bash',name:'盾击',category:'combatSkill',type:'技能',cost:4,limit:!0,data:bu('盾击','用盾牌猛击敌人,有几率眩晕。','active',{sp:4},2,[{trigger:'immediate',action:'damage',target:'target',value:'1d6+CON',tags:['physical']},{trigger:'immediate',action:'debuff',target:'target',statusName:'眩晕',duration:1,chance:40}],'single_enemy',['physical','melee','stun','defensive'])},{id:'s_skill_ice_lance',name:'冰枪术',category:'combatSkill',type:'技能',cost:5,limit:!0,data:bu('冰枪术','凝聚寒冰形成尖锐的冰枪刺向敌人。','active',{mp:8},1,[{trigger:'immediate',action:'damage',target:'target',value:'2d6+INT',tags:['ice','magic']},{trigger:'immediate',action:'debuff',target:'target',statusName:'冻伤',duration:2,modifiers:{spd:-10},chance:30}],'single_enemy',['ice','magic','ranged','debuff'])},{id:'s_skill_fireball',name:'爆裂火球',category:'combatSkill',type:'技能',cost:10,limit:!0,data:bu('爆裂火球','大范围的火焰爆炸。','active',{mp:15},3,[{trigger:'immediate',action:'damage',target:'all_enemies',value:'4d6',tags:['fire','magic']}],'all_enemies',['fire','magic','aoe','ranged'])},{id:'s_skill_heal_all',name:'群体治疗',category:'combatSkill',type:'技能',cost:12,limit:!0,data:bu('群体治疗','神圣的光芒治愈所有友方。','active',{mp:20},4,[{trigger:'immediate',action:'heal',target:'all_allies',value:'2d6+WIS'}],'all_allies',['heal','support','aoe','light'])},{id:'s_skill_poison_blade',name:'淬毒',category:'combatSkill',type:'技能',cost:6,limit:!0,data:bu('淬毒','在武器上涂抹剧毒，下次攻击附加毒伤。','active',{sp:6},3,[{trigger:'immediate',action:'buff',target:'self',statusName:'淬毒',duration:2,modifiers:{poison_dmg:15}}],'self',['poison','buff'])},{id:'s_skill_berserk',name:'狂暴',category:'combatSkill',type:'技能',cost:8,limit:!0,data:bu('狂暴','进入狂暴状态，大幅提升攻击但降低防御。','active',{hp:10},5,[{trigger:'immediate',action:'buff',target:'self',statusName:'狂暴',duration:3,modifiers:{str:5,crit_rate:15,ac:-3}}],'self',['buff','physical'])},{id:'s_skill_timestop',name:'时之停滞',category:'combatSkill',type:'技能',cost:50,limit:!0,data:bu('时之停滞','停止时间流动，获得1次额外回合。','active',{mp:50},10,[{trigger:'immediate',action:'extra_turn',target:'self'}],'self',['time','magic','forbidden'])},{id:'s_skill_advance',name:'疾风步',category:'combatSkill',type:'技能',cost:5,limit:!0,data:bu('疾风步','快速移动，大幅提升速度。','active',{sp:5},3,[{trigger:'immediate',action:'buff',target:'self',statusName:'疾风',duration:3,modifiers:{spd:30,dex:2}}],'self',['wind','buff'])},{id:'s_skill_delay',name:'时间减速',category:'combatSkill',type:'技能',cost:8,limit:!0,data:bu('时间减速','减缓敌人的时间流速。','active',{mp:12},4,[{trigger:'immediate',action:'delay',target:'target',delayPercent:40}],'single_enemy',['time','magic','debuff'])},{id:'s_passive_run',name:'飞毛腿',category:'passiveSkill',type:'技能',cost:4,limit:!0,data:bu('飞毛腿','天生跑得比别人快。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',statusName:'飞毛腿',duration:-1,modifiers:{dex:2,spd:10}}],'self',['passive','talent'])},{id:'s_passive_regen',name:'巨魔血统',category:'passiveSkill',type:'技能',cost:15,limit:!0,data:bu('巨魔血统','拥有强大的再生能力。','passive',void 0,0,[{trigger:'turn_start',action:'heal',target:'self',value:'5%_max',tags:['hp']}],'self',['passive','talent','heal','hot'])},{id:'s_passive_lucky',name:'强运',category:'passiveSkill',type:'技能',cost:8,limit:!0,data:bu('强运','命运总是眷顾你。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',statusName:'强运',duration:-1,modifiers:{cha:3,crit_rate:5}}],'self',['passive','talent'])},{id:'s_passive_tank',name:'铁壁',category:'passiveSkill',type:'技能',cost:10,limit:!0,data:bu('铁壁','坚韧的体魄让你更难被击倒。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',statusName:'铁壁',duration:-1,modifiers:{con:2,ac:2,hp_max:20}}],'self',['passive','talent','defensive'])},{id:'s_passive_lifesteal',name:'吸血本能',category:'passiveSkill',type:'技能',cost:20,limit:!0,data:bu('吸血本能','每次攻击都能吸取敌人的生命力。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',statusName:'吸血本能',duration:-1,modifiers:{lifesteal:10}}],'self',['passive','talent','drain'])},{id:'s_passive_counter',name:'反击姿态',category:'passiveSkill',type:'技能',cost:12,limit:!0,data:bu('反击姿态','受到攻击时有几率反击。','passive',void 0,0,[{trigger:'on_hurt',action:'damage',target:'enemy',value:'1d6+DEX',tags:['physical'],chance:30}],'self',['passive','talent','melee'])},{id:'s_explore_eye',name:'鉴定眼',category:'explorationSkill',type:'技能',cost:2,limit:!0,data:bu('鉴定眼','可以查看物品详情，洞察弱点。','passive',void 0,0,[{trigger:'passive',action:'buff',target:'self',statusName:'鉴定眼',duration:-1,modifiers:{int:1}}],'self',['passive','support'])},{id:'s_gold',name:'一大袋铜币(500)',category:'money',type:'货币',cost:1,data:{value:500,subtype:'bag',iconVariant:8}},{id:'s_gold_bar',name:'一袋银币(50银)',category:'money',type:'货币',cost:5,data:{value:5e3,subtype:'currency',iconVariant:15}},{id:'s_gold_chest',name:'一小袋金币(10金)',category:'money',type:'货币',cost:20,data:{value:1e5,subtype:'currency',iconVariant:3}}],ku=(e,t,a,s,n,r=[],l,o='Common')=>({name:e,type:t,count:1,quality:o,emoji:s,desc:n,value:5,effects:r,slotTarget:a,subtype:l?.subtype,attribute:l?.attribute}),Su={平民:e=>[ku('破旧布衣','armor','upper','👕','打满补丁的破旧衣服。',[{trigger:'passive',action:'buff',target:'self',statusName:'基础防护',duration:-1,modifiers:{ac:0}}],{subtype:'coat',attribute:'tattered'}),ku('破旧长裤','armor','lower','👖','磨损严重的长裤。',[],{subtype:'pant_long',attribute:'tattered'}),ku('布鞋','armor','shoes','👞','简陋的布制鞋子。',[],{subtype:'shoe_light',attribute:'common'}),ku('木棍','weapon','weapon_main','🏑','随手捡来的木棍,勉强能当武器。',[{trigger:'on_hit',action:'damage',target:'target',value:'1d4',tags:['physical']}],{subtype:'staff',attribute:'basic'})],战士:e=>[ku('训练用铠甲','armor','upper','🛡️','新兵训练时使用的轻型铠甲。',[{trigger:'passive',action:'buff',target:'self',statusName:'训练护甲',duration:-1,modifiers:{ac:2}}],{subtype:'coat',attribute:'plate'}),ku('皮质护腿','armor','lower','🦵','加固的皮质护腿。',[{trigger:'passive',action:'buff',target:'self',statusName:'护腿加固',duration:-1,modifiers:{ac:1}}],{subtype:'pant_long',attribute:'leather'}),ku('战斗靴','armor','shoes','🥾','适合长途行军的结实靴子。',[],{subtype:'boot_heavy',attribute:'leather'}),ku('制式铁剑','weapon','weapon_main','⚔️','王国军队的标准配剑。',[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}],{subtype:'sword',attribute:'steel'})],法师:e=>[ku('学徒法袍','armor','upper','👘','魔法学院发放的学徒长袍。',[{trigger:'passive',action:'buff',target:'self',statusName:'学徒法袍加成',duration:-1,modifiers:{ac:0,mp_max:5}}],{subtype:'coat',attribute:'silk'}),ku('法师长裤','armor','lower','👖','便于行动的轻便长裤。',[],{subtype:'pant_long',attribute:'silk'}),ku('软底鞋','armor','shoes','👞','便于施法的软底鞋。',[],{subtype:'shoe_light',attribute:'silk'}),ku('学徒法杖','weapon','weapon_main','🪄','刻有基础符文的木杖。',[{trigger:'on_hit',action:'damage',target:'target',value:'1d4+INT',tags:['arcane']}],{subtype:'staff',attribute:'basic'})],游侠:e=>[ku('猎人皮甲','armor','upper','🧥','灵活的皮革护甲。',[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:1}}],{subtype:'coat',attribute:'leather'}),ku('行动裤','armor','lower','👖','方便行动的紧身裤。',[],{subtype:'pant_long',attribute:'leather'}),ku('轻便靴','armor','shoes','👟','适合长途跋涉的轻便靴。',[{trigger:'passive',action:'buff',target:'self',statusName:'轻便',duration:-1,modifiers:{dex:1}}],{subtype:'shoe_light',attribute:'adventurer'}),ku('短弓','weapon','weapon_main','🏹','猎人常用的短弓。',[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+DEX',tags:['physical']}],{subtype:'bow',attribute:'basic'})],牧师:e=>[ku('祭司长袍','armor','upper','👘','教会发放的神职人员长袍。',[{trigger:'passive',action:'buff',target:'self',statusName:'祭司祝福',duration:-1,modifiers:{ac:1,wis:1}}],{subtype:'coat',attribute:'linen'}),ku('祭司长裤','armor','lower','👖','庄重的长裤。',[],{subtype:'pant_long',attribute:'linen'}),ku('皮质凉鞋','armor','shoes','🩴','简朴的皮质凉鞋。',[],{subtype:'shoe_light',attribute:'leather'}),ku('祭祀战锤','weapon','weapon_main','🔨','用来惩戒异端的圣锤。',[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical','divine']}],{subtype:'hammer',attribute:'divine'}),ku('圣徽项链','accessory','accessory_1','⚜️','象征信仰的圣徽。',[{trigger:'passive',action:'buff',target:'self',statusName:'圣徽光辉',duration:-1,modifiers:{cha:1}}],{subtype:'necklace',attribute:'light'})]},_u={精灵:()=>[ku('精灵斗篷','armor','outer','🧣','轻盈的精灵族传统斗篷。',[{trigger:'passive',action:'buff',target:'self',statusName:'精灵之敏',duration:-1,modifiers:{dex:1}}],{subtype:'cloak',attribute:'mythical'},'Uncommon')],矮人:()=>[ku('矮人头盔','armor','head','⛑️','矮人工匠打造的坚固头盔。',[{trigger:'passive',action:'buff',target:'self',statusName:'矮人护甲',duration:-1,modifiers:{ac:1}}],{subtype:'helmet',attribute:'steel'},'Uncommon')]};function Cu(e,t,a){const s=[];s.push(...(e=>{const t='♂'===e,a=[ku('普通内裤','armor','underpants','🩲',t?'简单的男士内裤。':'简单的女士内裤。',[],{subtype:t?'underpants_male':'underpants_female',attribute:'common'})];return t||a.push(ku('普通内衣','armor','underwear','👙','简单的贴身内衣。',[],{subtype:'lingerie_top',attribute:'common'})),a.push(ku('普通短袜','armor','socks','🧦','普通的棉质短袜。',[],{subtype:'sock_short',attribute:'common'})),a})(e));const n=Su[t];n?s.push(...n(e)):s.push(...Su['平民'](e));const r=_u[a];return r&&s.push(...r()),s}const Iu={hair_color:{common:['黑色','棕色','金色','红色','灰色','白色'],human:['黑色','棕色','金色','红色','灰色'],elf:['银色','金色','淡蓝色','翠绿色','月白色','浅紫色'],dwarf:['棕色','红棕色','黑色','灰色','姜黄色'],orc:['黑色','深棕色','暗红色'],demon:['黑色','暗红色','紫色','银白色'],angel:['金色','银色','白色','浅蓝色'],dragon:['黑色','红色','金色','银色','青色'],beast:['棕色','黑色','白色','灰色','斑纹']},hair_length:{male:['寸头','短发','中长发','长发','光头'],female:['短发','中长发','长发','及腰长发','超长发'],neutral:['短发','中长发','长发']},hair_style:{male:['自然散落','背梳','偏分','中分','马尾','辫子','凌乱','刺猬头'],female:['自然散落','马尾','双马尾','丸子头','编发','公主切','卷发','波浪卷','直发'],neutral:['自然散落','马尾','辫子','凌乱']},eye_color:{common:['黑色','棕色','蓝色','绿色','灰色','琥珀色'],human:['黑色','棕色','蓝色','绿色','灰色'],elf:['翠绿色','天蓝色','紫罗兰','银色','金色'],dwarf:['棕色','黑色','灰色','琥珀色'],orc:['黄色','红色','黑色'],demon:['红色','金色','紫色','黑色','异色瞳'],angel:['金色','蓝色','白色','银色'],dragon:['金色','红色','蓝色','绿色','竖瞳'],beast:['黄色','绿色','蓝色','琥珀色']},height:{human_male:['矮小(160cm以下)','偏矮(160-170cm)','中等(170-178cm)','偏高(178-185cm)','高大(185cm以上)'],human_female:['娇小(150cm以下)','偏矮(150-158cm)','中等(158-165cm)','偏高(165-172cm)','高挑(172cm以上)'],elf_male:['偏矮(165-175cm)','中等(175-185cm)','偏高(185-195cm)','高挑(195cm以上)'],elf_female:['娇小(155-165cm)','中等(165-175cm)','偏高(175-185cm)','高挑(185cm以上)'],dwarf_male:['矮小(120-130cm)','普通(130-140cm)','高大(140-150cm)'],dwarf_female:['矮小(110-120cm)','普通(120-130cm)','高大(130-140cm)'],orc_male:['中等(180-190cm)','高大(190-210cm)','巨大(210cm以上)'],orc_female:['中等(170-180cm)','高大(180-195cm)','巨大(195cm以上)'],default_male:['偏矮','中等','偏高','高大'],default_female:['娇小','偏矮','中等','偏高','高挑']},body_build:{male:['瘦弱','纤细','匀称','健壮','魁梧','壮硕'],female:['纤瘦','苗条','匀称','丰满','健美','丰腴'],neutral:['纤细','匀称','健壮']},skin_tone:{common:['白皙','浅肤色','小麦色','蜜色','古铜色','深色'],human:['白皙','浅肤色','小麦色','蜜色','古铜色'],elf:['苍白','白皙','银白','淡金色'],dwarf:['红润','古铜色','土褐色'],orc:['灰绿色','深绿色','灰色','褐色'],demon:['苍白','暗红色','灰色','紫黑色'],angel:['白皙透亮','金色光泽','银白'],dragon:['鳞片纹理','人形白皙','人形古铜'],beast:['毛皮覆盖','浅色','深色']},face_features:['五官端正','柔和的轮廓','棱角分明','精致秀气','英气勃勃','温和亲切','冷峻锐利','稚嫩可爱','成熟稳重','妩媚动人','阳刚俊朗','清秀脱俗','野性粗犷','优雅高贵','普通平凡'],racial_traits:{human:null,elf:['尖耳','尖耳(略长)','尖耳(修长)'],dwarf:['浓密胡须','络腮胡','长须(男)','无胡须但面部粗犷'],orc:['獠牙','獠牙(突出)','尖耳','面部伤疤'],demon:['小角','弯角','尾巴','尖耳','瞳孔竖直'],angel:['光环','隐约翅膀轮廓','神圣气息'],dragon:['竖瞳','鳞片(局部)','尖耳','细长尾巴'],beast:['兽耳','尾巴','毛发','利爪']}};function Tu(e){return e[Math.floor(Math.random()*e.length)]}function Au(e){return{人类:'human',精灵:'elf',矮人:'dwarf',兽人:'orc',恶魔:'demon',天使:'angel',龙族:'dragon',兽人族:'beast',狼人:'beast',猫人:'beast'}[e]||'human'}function Mu(e){return'♂'===e?'male':'♀'===e?'female':'neutral'}const Eu=Za({name:'CharacterCreation',props:{useVhHeight:{type:Boolean,default:!1}},emits:['finish','back'],setup(e,{emit:a}){const s=$t(1),n=$t(null),r=$t(null),l=xt({name:'',sex:'♂',age:18,race:'人类',class:'平民',attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10},appearance:{},privateInfo:{}}),o=$t(!1),i=$t(0),c=$t(0),d=xt({}),u=xt({date:'200-05-01',locationPath:['铃兰平原','最后壁垒','公会大厅'],intro:''}),p=uu,m=$t(''),g=ir(()=>{const e=u.locationPath.filter(e=>e);return 0===e.length?'':e.join(' - ')}),h=['STR','DEX','CON','INT','WIS','CHA','spd'],f=ir(()=>i.value-c.value),v=fu,y=cu,b=xu,x=hu,w=ir(()=>'preset'===n.value?r.value?.name:l.name||'无名氏'),k=ir(()=>'preset'===n.value?r.value?.race:l.race),S=ir(()=>'preset'===n.value?r.value?.class:l.class),C=ir(()=>'preset'===n.value?r.value?.gender:l.sex),I=ir(()=>{if('preset'!==n.value||!r.value)return'';const e=r.value.generator();return e.scene?.locationPath?.length?e.scene.locationPath.join(' > '):'未设置'}),T=e=>e>13?2:1,A=e=>l.attributes[e]+(v[l.race]?.mods[e]||0),M=()=>{try{return Ll.serviceLocator.get('IconService')}catch{return null}};return{currentStep:s,mode:n,selectedPreset:r,presets:x,difficulties:[{id:'hard',name:'凡人 (Hard)',cp:50,desc:'资源匮乏，充满挑战'},{id:'normal',name:'英雄 (Normal)',cp:100,desc:'标准开局，均衡发展'},{id:'easy',name:'传说 (Easy)',cp:200,desc:'天赋异禀，资源丰富'},{id:'sandbox',name:'半神 (Sandbox)',cp:999,desc:'随心所欲，无视规则'}],draft:l,currentCP:f,raceModifiers:v,classKits:y,attributesList:h,attributeNames:{STR:'力量',DEX:'敏捷',CON:'体质',INT:'智力',WIS:'感知',CHA:'魅力',spd:'速度'},shopCategories:b,shopCart:d,scene:u,finalName:w,finalRace:k,finalClass:S,finalSex:C,APPEARANCE_OPTIONS:Iu,advancedOptionsExpanded:o,selectMode:e=>{n.value=e,s.value='preset'===e?1.5:2},selectDifficulty:e=>{i.value=e,c.value=0;for(const e in d)delete d[e];h.forEach(e=>l.attributes[e]=10),s.value=3},getStepTitle:e=>1===e?'选择起源':1.5===e?'选择预设角色':2===e?'选择难度':3===e?'构建角色':4===e?'物资采购':5===e?'最终确认':'',modAttr:(e,t)=>{const a=l.attributes[e],s=a+t;if(t>0){if(s>15)return;const e=T(s);if(f.value<e)return;c.value+=e}else{if(s<8)return;const e=T(a);c.value-=e}l.attributes[e]=s},getFinalAttr:A,getAttrColor:e=>{const t=v[l.race]?.mods[e]||0;return t>0?'text-[#4caf50]':t<0?'text-[#f44336]':'text-white'},getShopItemsByCategory:e=>wu.filter(t=>t.category===e),buyItem:e=>{e.limit&&(d[e.id]||0)>=1||f.value<e.cost||(c.value+=e.cost,d[e.id]=(d[e.id]||0)+1)},sellItem:e=>{d[e.id]&&(c.value-=e.cost,d[e.id]--,d[e.id]<=0&&delete d[e.id])},nextStep:()=>{1.5===s.value?s.value=5:s.value++},prevStep:()=>{5===s.value?'preset'===n.value?s.value=1.5:s.value=4:1.5===s.value?(s.value=1,r.value=null):s.value--},finishCreation:async()=>{let e,s=[];if('preset'===n.value&&r.value){const t=r.value.generator();r.value.initialMessages&&(s=r.value.initialMessages);const a={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}};e={...a,...t,player:{...a.player,...t.player,base:{...a.player.base,...t.player?.base},stats:{...a.player.stats,...t.player?.stats},attributes:{...a.player.attributes,...t.player?.attributes}},inventory:{...a.inventory,...t.inventory},skills:t.skills||{},world:{...a.world,...t.world},scene:t.scene||a.scene,relation:{characters:{...a.relation?.characters,...t.relation?.characters},factions:{...a.relation?.factions,...t.relation?.factions}}},t.player?.equipment&&(e.player.equipment=t.player.equipment);const n=Ro(e.player.equipment);0!==n.hp_max&&(e.player.stats.hp.current+=n.hp_max,e.player.stats.hp.max+=n.hp_max),0!==n.mp_max&&(e.player.stats.mp.current+=n.mp_max,e.player.stats.mp.max+=n.mp_max),0!==n.sp_max&&(e.player.stats.sp.current+=n.sp_max,e.player.stats.sp.max+=n.sp_max)}else{e={player:{base:{name:'冒险者',race:'人类',class:'无',level:1,exp:{current:0,max:100},age_bio:'18',age_psy:'18',gender:'未知',alignment:'中立',identity:'流浪者',status_desc:'精神饱满，衣着整洁。'},stats:{hp:{current:30,max:30},mp:{current:30,max:30},sp:{current:30,max:30}},attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,spd:10,crit_rate:5,crit_dmg:150},equipment:{},statusEffects:[],shields:[],statModifiers:{},battleSettings:{autoBattle:!1,speedMultiplier:1}},inventory:{wallet:{ledger:0,rates:[{name:'金',value:1e4},{name:'银',value:100},{name:'铜',value:1}]},items:{item_01:{name:'新手铁剑',type:'weapon',count:1,quality:'Common',desc:'一把普通的铁剑，适合新手冒险者。',emoji:'🗡️',value:10,level:1,effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d6+STR',tags:['physical']}]},item_02:{name:'治疗药水',type:'consumable',count:3,quality:'Common',desc:'回复少量生命值。',emoji:'🧪',value:5,effects:[{trigger:'immediate',action:'heal',target:'self',value:'20'}]},item_03:{name:'皮甲',type:'armor',count:1,quality:'Common',desc:'简单的皮质护甲，提供基础防护。',emoji:'🧥',value:15,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'皮甲防护',duration:-1,modifiers:{ac:2}}]},item_04:{name:'活力戒指',type:'accessory',count:1,quality:'Uncommon',desc:'散发着微弱光芒的戒指。',emoji:'💍',value:50,level:1,effects:[{trigger:'passive',action:'buff',target:'self',statusName:'活力',duration:-1,modifiers:{hp_max:10}}]}}},skills:{},world:{date:'200-05-01',time:'08:00',weather:'☀️',canUseWorldMap:!1,quests:{},currentMapId:'map-5',playerPos:{x:50,y:50},unlockedGates:[],pendingContext:[]},scene:{locationPath:['新手村','广场'],name:'新手村广场',desc:'阳光明媚的广场，中央有一个喷泉，周围是熙熙攘攘的村民。',npcs:{},objects:{},exits:{}},relation:{characters:{},factions:{}},allies:{}},e.player.base.name=l.name||'无名氏',e.player.base.race=l.race,e.player.base.class=l.class,e.player.base.gender=l.sex,e.player.base.age_bio=String(l.age),e.player.base.ext={sex:l.sex,age:l.age},l.appearance.hair_color&&(e.player.appearance={...l.appearance}),h.forEach(t=>{e.player.attributes[t]=A(t)});const a=e.player.attributes.CON,s=30+2*(a-10),n=30+2*(e.player.attributes.INT-10),r=a-10+30;e.player.stats.hp={current:s,max:s},e.player.stats.mp={current:n,max:n},e.player.stats.sp={current:r,max:r};Cu(l.sex,l.class,l.race).forEach(t=>{const a={...t};if(delete a.id,a.slotTarget)if(e.player.equipment[a.slotTarget]){const t=vu(e.inventory.items);e.inventory.items[t]=a}else e.player.equipment[a.slotTarget]=a;else{const t=vu(e.inventory.items);e.inventory.items[t]=a}});const o=cu[l.class];if(o){for(const t in o.attributes)e.player.attributes[t]+=o.attributes[t];o.skills.forEach((t,a)=>{const s=Object.keys(e.skills).length,n=`skill_${String(s+a+1).padStart(2,'0')}`;e.skills[n]={...t}})}for(const[a,s]of Object.entries(d)){const n=wu.find(e=>e.id===a);if(n)if('money'===n.category)e.inventory.wallet.ledger+=n.data.value*s;else if(['combatSkill','passiveSkill','explorationSkill'].includes(n.category)){const a=t(),s={...n.data,id:a};e.skills[a]=s}else{const t=n.data;if(t.slotTarget&&1===s){const a={...t};if(delete a.id,!e.player.equipment[a.slotTarget]&&n.limit)e.player.equipment[a.slotTarget]=a;else{const t=vu(e.inventory.items);e.inventory.items[t]=a}}else{const a={...t,count:s};delete a.id;const n=vu(e.inventory.items);e.inventory.items[n]=a}}}}if(e.world.date=u.date,e.world.time='08:00','preset'!==n.value){e.scene||(e.scene={});const t=u.locationPath.filter(e=>e);e.scene.locationPath=t.length>0?t:['铃兰平原','最后壁垒','公会大厅'],e.scene.name=e.scene.locationPath.at(-1)||'公会大厅',e.scene.desc=''}e.relation||(e.relation={characters:{},factions:{}}),u.intro&&(e.logs=[u.intro]),a('finish',e,s)},rollAppearance:()=>{const e=Au(l.race),t=Mu(l.sex),a=Iu.hair_color[e]||Iu.hair_color.common;l.appearance.hair_color=Tu(a);const s=Iu.hair_length[t];l.appearance.hair_length=Tu(s);const n=Iu.hair_style[t];l.appearance.hair_style=Tu(n);const r=Iu.eye_color[e]||Iu.eye_color.common;l.appearance.eye_color=Tu(r);const o=`default_${t}`,i=Iu.height[`${e}_${t}`]||Iu.height[o]||Iu.height.default_male;l.appearance.height=Tu(i);const c=Iu.body_build[t];l.appearance.body_build=Tu(c);const d=Iu.skin_tone[e]||Iu.skin_tone.common;l.appearance.skin_tone=Tu(d),l.appearance.face_features=Tu(Iu.face_features);const u=Iu.racial_traits[e];u&&u.length>0?l.appearance.racial_traits=Tu(u):l.appearance.racial_traits=void 0},getAppearanceOptions:e=>{const t=Au(l.race),a=Mu(l.sex);if('hair_color'===e)return Iu.hair_color[t]||Iu.hair_color.common;if('hair_length'===e)return Iu.hair_length[a];if('hair_style'===e)return Iu.hair_style[a];if('eye_color'===e)return Iu.eye_color[t]||Iu.eye_color.common;if('height'===e){const e=`default_${a}`;return Iu.height[`${t}_${a}`]||Iu.height[e]||Iu.height.default_male}if('body_build'===e)return Iu.body_build[a];if('skin_tone'===e)return Iu.skin_tone[t]||Iu.skin_tone.common;if('racial_traits'===e){const e=Iu.racial_traits[t];return e&&Array.isArray(e)?e:[]}return[]},recommendedLocations:p,selectedRecommendedLocation:m,getLocationOptionsAtLevel:e=>function(e,t){if(0===e)return du;let a=du;for(let s=0;s<e&&s<t.length;s++){const e=t[s],n=a.find(t=>t.name===e);if(!n||!n.children)return[];a=n.children}return a}(e,u.locationPath),onLocationLevelChange:e=>{for(let t=e+1;t<5;t++)u.locationPath[t]='';u.locationPath=u.locationPath.filter(e=>e),m.value=''},applyRecommendedLocation:()=>{const e=p.find(e=>e.name===m.value);e&&(u.locationPath=[...e.path])},currentLocationDisplay:g,presetLocationDisplay:I,hasIconData:e=>{if(!M())return!1;if(['combatSkill','passiveSkill','explorationSkill'].includes(e.category))return!1;return!(!e.data.subtype&&!['weapon','armor','accessory','material','consumable','money'].includes(e.category))},getIconStyle:(e,t=32)=>{const a=M();if(!a)return{};const s=e.data;let n,r=s.subtype;if(s.subtype){const e=a.mapTypeToCategoryAndSubtype(s.subtype);n=e.category,r=e.subtype||s.subtype}else'consumable'===e.category?(n='material',r='potion'):n=['weapon','armor','accessory','material','item'].includes(e.category)?e.category:'item';'material'!==n&&'item'!==n||void 0!==s.iconVariant||(s.iconVariant=Math.floor(16*Math.random()));return a.getIconStyle(n,r,s.attribute,s.iconVariant,t)},getQualityBorderClass:e=>`quality-border-${(e.data.quality||'Common').toLowerCase()}`,getQualityTextClass:e=>`quality-${(e.data.quality||'Common').toLowerCase()}`,getItemTypeDisplay:e=>e.data.desc||e.data.description||e.type}}});var $u=l(502);const Du=(0,$u.A)(Eu,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',{class:ee(['creation-root',{'use-vh':e.useVhHeight}])},[Rn(' 背景层 '),t[118]||(t[118]=Mn('div',{class:'bg-layer'},null,-1)),t[119]||(t[119]=Mn('div',{class:'vignette'},null,-1)),t[120]||(t[120]=Mn('div',{class:'noise'},null,-1)),Rn(' 内容层 '),Mn('div',lc,[Rn(' Header '),Mn('div',oc,[Mn('button',{class:'back-btn',onClick:t[0]||(t[0]=t=>e.$emit('back'))},[...t[52]||(t[52]=[Mn('span',{class:'back-icon'},'←',-1),Mn('span',{class:'back-text'},'返回菜单',-1)])]),Mn('div',ic,[t[53]||(t[53]=Mn('h2',{class:'header-title'},[Mn('span',{class:'title-deco'},'◇'),Pn(' 角色创建 '),Mn('span',{class:'title-deco'},'◇')],-1)),Mn('div',cc,oe(e.getStepTitle(e.currentStep)),1)]),Mn('div',dc,[(yn(),Sn(pn,null,xs(5,t=>Mn('div',{key:t,class:ee(['step-dot',{active:t<=e.currentStep,current:t===Math.floor(e.currentStep)}])},null,2)),64))])]),Rn(' Content Area '),Mn('div',uc,[Rn(' Step 1: Mode Selection '),1===e.currentStep?(yn(),Sn('div',pc,[Mn('div',{class:'mode-card',onClick:t[1]||(t[1]=t=>e.selectMode('preset'))},[...t[54]||(t[54]=[Nn('<div class="mode-icon" data-v-768e54ca>📜</div><h3 class="mode-title" data-v-768e54ca>传奇再现</h3><div class="mode-subtitle" data-v-768e54ca>预设角色</div><p class="mode-desc" data-v-768e54ca>选择世界中已存在的知名人物，体验原本的故事轨迹。</p><div class="mode-glow" data-v-768e54ca></div>',5)])]),Mn('div',{class:'mode-card',onClick:t[2]||(t[2]=t=>e.selectMode('custom'))},[...t[55]||(t[55]=[Nn('<div class="mode-icon" data-v-768e54ca>✨</div><h3 class="mode-title" data-v-768e54ca>命运自塑</h3><div class="mode-subtitle" data-v-768e54ca>自定义角色</div><p class="mode-desc" data-v-768e54ca>从零开始构建你的角色，分配属性，选择职业与出身。</p><div class="mode-glow" data-v-768e54ca></div>',5)])])])):Rn('v-if',!0),Rn(' Step 1.5: Preset Selection (Only if mode is preset) '),1.5===e.currentStep?(yn(),Sn('div',mc,[Mn('div',gc,[(yn(!0),Sn(pn,null,xs(e.presets,t=>(yn(),Sn('div',{key:t.id,class:ee(['cursor-pointer rounded-lg border border-[#373a40] bg-[#25262b] p-4 transition-all hover:border-[#7289da]',e.selectedPreset?.id===t.id?'border-[#7289da] bg-[#2c2e33]':'']),onClick:a=>e.selectedPreset=t},[Mn('div',fc,oe(t.icon),1),Mn('div',vc,oe(t.name),1),Mn('div',yc,oe(t.race),1),Mn('div',bc,oe(t.desc),1)],10,hc))),128))])])):Rn('v-if',!0),Rn(' Step 2: Difficulty (Only custom) '),2===e.currentStep?(yn(),Sn('div',xc,[(yn(!0),Sn(pn,null,xs(e.difficulties,t=>(yn(),Sn('div',{key:t.id,class:'cursor-pointer rounded-lg border border-[#373a40] bg-[#25262b] p-4 hover:border-[#7289da]',onClick:a=>e.selectDifficulty(t.cp)},[Mn('div',kc,oe(t.name),1),Mn('div',Sc,oe(t.cp)+' CP',1),Mn('div',_c,oe(t.desc),1)],8,wc))),128))])):Rn('v-if',!0),Rn(' Step 3: Builder (Custom) '),3===e.currentStep?(yn(),Sn('div',Cc,[Rn(' Left: Basic Info '),Mn('div',Ic,[Mn('div',null,[t[56]||(t[56]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'姓名',-1)),xa(Mn('input',{'onUpdate:modelValue':t[3]||(t[3]=t=>e.draft.name=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',placeholder:'输入角色姓名'},null,512),[[fl,e.draft.name]])]),Mn('div',Tc,[Mn('div',null,[t[58]||(t[58]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'性别',-1)),xa(Mn('select',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.draft.sex=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none',onChange:t[5]||(t[5]=(...t)=>e.rollAppearance&&e.rollAppearance(...t))},[...t[57]||(t[57]=[Mn('option',{value:'♂'},'男',-1),Mn('option',{value:'♀'},'女',-1),Mn('option',{value:'未知'},'未知',-1)])],544),[[bl,e.draft.sex]])]),Mn('div',null,[t[59]||(t[59]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'年龄',-1)),xa(Mn('input',{'onUpdate:modelValue':t[6]||(t[6]=t=>e.draft.age=t),type:'number',class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none'},null,512),[[fl,e.draft.age,void 0,{number:!0}]])])]),Mn('div',null,[Mn('label',Ac,'种族 ('+oe(e.raceModifiers[e.draft.race]?.desc)+')',1),xa(Mn('select',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.draft.race=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none',onChange:t[8]||(t[8]=(...t)=>e.rollAppearance&&e.rollAppearance(...t))},[(yn(!0),Sn(pn,null,xs(e.raceModifiers,(e,t)=>(yn(),Sn('option',{key:t,value:t},oe(t),9,Mc))),128))],544),[[bl,e.draft.race]]),Mn('div',Ec,[(yn(!0),Sn(pn,null,xs(e.raceModifiers[e.draft.race]?.mods,(e,t)=>(yn(),Sn('span',{key:t,class:'mr-2'},oe(t)+oe(e>0?'+':'')+oe(e),1))),128))])]),Mn('div',null,[t[60]||(t[60]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'职业 (决定初始装备)',-1)),xa(Mn('select',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.draft.class=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none'},[(yn(!0),Sn(pn,null,xs(e.classKits,(e,t)=>(yn(),Sn('option',{key:t,value:t},oe(t),9,$c))),128))],512),[[bl,e.draft.class]])])]),Rn(' Middle: Appearance Customization '),Mn('div',Dc,[Mn('div',Pc,[t[61]||(t[61]=Mn('span',{class:'text-gray-400'},'🎨 外貌特征',-1)),Mn('button',{class:'rounded bg-[#7289da] px-3 py-1 text-sm font-bold text-white hover:bg-[#5b6eae]',onClick:t[10]||(t[10]=(...t)=>e.rollAppearance&&e.rollAppearance(...t))},' 🎲 随机 ')]),Mn('div',Nc,[Mn('div',Rc,[Mn('div',null,[t[62]||(t[62]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'发色',-1)),xa(Mn('input',{'onUpdate:modelValue':t[11]||(t[11]=t=>e.draft.appearance.hair_color=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.hair_color]])]),Mn('div',null,[t[64]||(t[64]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.hair_color,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[12]||(t[12]=t=>e.draft.appearance.hair_color=t.target.value)},[t[63]||(t[63]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('hair_color'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,Lc))),128))],40,jc)])]),Mn('div',Bc,[Mn('div',null,[t[65]||(t[65]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'发长',-1)),xa(Mn('input',{'onUpdate:modelValue':t[13]||(t[13]=t=>e.draft.appearance.hair_length=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.hair_length]])]),Mn('div',null,[t[67]||(t[67]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.hair_length,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[14]||(t[14]=t=>e.draft.appearance.hair_length=t.target.value)},[t[66]||(t[66]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('hair_length'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,qc))),128))],40,Oc)])]),Mn('div',Uc,[Mn('div',null,[t[68]||(t[68]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'发型',-1)),xa(Mn('input',{'onUpdate:modelValue':t[15]||(t[15]=t=>e.draft.appearance.hair_style=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.hair_style]])]),Mn('div',null,[t[70]||(t[70]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.hair_style,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[16]||(t[16]=t=>e.draft.appearance.hair_style=t.target.value)},[t[69]||(t[69]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('hair_style'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,Fc))),128))],40,Vc)])]),Mn('div',Hc,[Mn('div',null,[t[71]||(t[71]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'瞳色',-1)),xa(Mn('input',{'onUpdate:modelValue':t[17]||(t[17]=t=>e.draft.appearance.eye_color=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.eye_color]])]),Mn('div',null,[t[73]||(t[73]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.eye_color,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[18]||(t[18]=t=>e.draft.appearance.eye_color=t.target.value)},[t[72]||(t[72]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('eye_color'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,zc))),128))],40,Gc)])]),Mn('div',Wc,[Mn('div',null,[t[74]||(t[74]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'身高',-1)),xa(Mn('input',{'onUpdate:modelValue':t[19]||(t[19]=t=>e.draft.appearance.height=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.height]])]),Mn('div',null,[t[76]||(t[76]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.height,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[20]||(t[20]=t=>e.draft.appearance.height=t.target.value)},[t[75]||(t[75]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('height'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,Xc))),128))],40,Qc)])]),Mn('div',Yc,[Mn('div',null,[t[77]||(t[77]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'体型',-1)),xa(Mn('input',{'onUpdate:modelValue':t[21]||(t[21]=t=>e.draft.appearance.body_build=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.body_build]])]),Mn('div',null,[t[79]||(t[79]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.body_build,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[22]||(t[22]=t=>e.draft.appearance.body_build=t.target.value)},[t[78]||(t[78]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('body_build'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,Jc))),128))],40,Kc)])]),Mn('div',Zc,[Mn('div',null,[t[80]||(t[80]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'肤色',-1)),xa(Mn('input',{'onUpdate:modelValue':t[23]||(t[23]=t=>e.draft.appearance.skin_tone=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.skin_tone]])]),Mn('div',null,[t[82]||(t[82]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.skin_tone,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[24]||(t[24]=t=>e.draft.appearance.skin_tone=t.target.value)},[t[81]||(t[81]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('skin_tone'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,td))),128))],40,ed)])]),Mn('div',ad,[Mn('div',null,[t[83]||(t[83]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'面部特征',-1)),xa(Mn('input',{'onUpdate:modelValue':t[25]||(t[25]=t=>e.draft.appearance.face_features=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.face_features]])]),Mn('div',null,[t[85]||(t[85]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.face_features,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[26]||(t[26]=t=>e.draft.appearance.face_features=t.target.value)},[t[84]||(t[84]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.APPEARANCE_OPTIONS.face_features,e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,nd))),128))],40,sd)])]),Mn('div',rd,[Mn('div',null,[t[86]||(t[86]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'种族特征（可选）',-1)),xa(Mn('input',{'onUpdate:modelValue':t[27]||(t[27]=t=>e.draft.appearance.racial_traits=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none focus:border-[#7289da]',placeholder:'输入自定义值'},null,512),[[fl,e.draft.appearance.racial_traits]])]),Mn('div',null,[t[88]||(t[88]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'快选',-1)),Mn('select',{value:e.draft.appearance.racial_traits,class:'h-[34px] w-full rounded border border-[#373a40] bg-[#1a1b1e] px-2 text-sm outline-none focus:border-[#7289da]',onChange:t[28]||(t[28]=t=>e.draft.appearance.racial_traits=t.target.value)},[t[87]||(t[87]=Mn('option',{value:''},'--',-1)),(yn(!0),Sn(pn,null,xs(e.getAppearanceOptions('racial_traits'),e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,od))),128))],40,ld)])])]),Rn(' Advanced Options (Collapsible) '),Mn('div',id,[Mn('div',{class:'flex cursor-pointer items-center justify-between rounded border border-[#373a40] bg-[#2c2e33] p-3 hover:border-[#7289da]',onClick:t[29]||(t[29]=t=>e.advancedOptionsExpanded=!e.advancedOptionsExpanded)},[t[89]||(t[89]=Mn('div',{class:'flex items-center gap-2'},[Mn('span',{class:'text-base'},'🔞'),Mn('span',{class:'text-sm font-bold text-gray-300'},'高级选项'),Mn('span',{class:'text-xs text-gray-500'},'(可选)')],-1)),Mn('span',cd,oe(e.advancedOptionsExpanded?'▼':'▶'),1)]),e.advancedOptionsExpanded?(yn(),Sn('div',dd,[Rn(' 女性字段 '),'♀'===e.draft.sex?(yn(),Sn(pn,{key:0},[Mn('div',null,[t[90]||(t[90]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'胸部尺寸',-1)),xa(Mn('input',{'onUpdate:modelValue':t[30]||(t[30]=t=>e.draft.privateInfo.Breast_Size=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none',placeholder:'例如: C杯'},null,512),[[fl,e.draft.privateInfo.Breast_Size]])]),Mn('div',null,[t[92]||(t[92]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'处女状态',-1)),xa(Mn('select',{'onUpdate:modelValue':t[31]||(t[31]=t=>e.draft.privateInfo.Virginity_Status=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none'},[...t[91]||(t[91]=[Mn('option',{value:''},'未设置',-1),Mn('option',{value:'处女'},'处女',-1),Mn('option',{value:'非处女'},'非处女',-1)])],512),[[bl,e.draft.privateInfo.Virginity_Status]])])],64)):'♂'===e.draft.sex?(yn(),Sn(pn,{key:1},[Rn(' 男性字段 '),Mn('div',null,[t[93]||(t[93]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'阴茎长度',-1)),xa(Mn('input',{'onUpdate:modelValue':t[32]||(t[32]=t=>e.draft.privateInfo.Penis_Length=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none',placeholder:'例如: 15cm'},null,512),[[fl,e.draft.privateInfo.Penis_Length]])]),Mn('div',null,[t[95]||(t[95]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'童贞状态',-1)),xa(Mn('select',{'onUpdate:modelValue':t[33]||(t[33]=t=>e.draft.privateInfo.Virginity_Status=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 text-sm outline-none'},[...t[94]||(t[94]=[Mn('option',{value:''},'未设置',-1),Mn('option',{value:'童贞'},'童贞',-1),Mn('option',{value:'非童贞'},'非童贞',-1)])],512),[[bl,e.draft.privateInfo.Virginity_Status]])])],64)):(yn(),Sn(pn,{key:2},[Rn(' 未知性别 '),t[96]||(t[96]=Mn('div',{class:'text-center text-sm text-gray-500'},'请先选择性别以显示相关选项',-1))],64))])):Rn('v-if',!0)])]),Rn(' Right: Attributes '),Mn('div',ud,[Mn('div',pd,[t[97]||(t[97]=Mn('span',{class:'text-gray-400'},'属性分配',-1)),Mn('span',md,'剩余 CP: '+oe(e.currentCP),1)]),Mn('div',gd,[(yn(!0),Sn(pn,null,xs(e.attributesList,t=>(yn(),Sn('div',{key:t,class:'flex items-center justify-between rounded bg-[#2c2e33] p-2'},[Mn('span',hd,oe(e.attributeNames[t]),1),Mn('div',fd,[Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full bg-[#373a40] hover:bg-[#7289da]',onClick:a=>e.modAttr(t,-1)},' - ',8,vd),Mn('span',{class:ee(['w-8 text-center font-mono text-lg',e.getAttrColor(t)])},oe(e.getFinalAttr(t)),3),Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full bg-[#373a40] hover:bg-[#7289da]',onClick:a=>e.modAttr(t,1)},' + ',8,yd)]),Mn('div',bd,'base: '+oe(e.draft.attributes[t]),1)]))),128))])])])):Rn('v-if',!0),Rn(' Step 4: Shop (Custom) '),4===e.currentStep?(yn(),Sn('div',xd,[Mn('div',wd,[t[98]||(t[98]=Mn('h3',{class:'font-bold'},'初始物资商店',-1)),Mn('span',kd,'剩余 CP: '+oe(e.currentCP),1)]),Mn('div',Sd,[(yn(!0),Sn(pn,null,xs(e.shopCategories,(t,a)=>(yn(),Sn('div',{key:a,class:'mb-6'},[Mn('h4',_d,oe(t),1),Rn(' 技能类别使用列表布局 '),['combatSkill','passiveSkill','explorationSkill'].includes(a)?(yn(),Sn('div',Cd,[(yn(!0),Sn(pn,null,xs(e.getShopItemsByCategory(a),t=>(yn(),Sn('div',{key:t.id,class:ee(['relative flex cursor-pointer items-center gap-3 rounded border border-[#373a40] bg-[#25262b] p-3 hover:border-[#7289da]',{'border-[#ffd700]':e.shopCart[t.id]}]),onClick:a=>e.buyItem(t)},[Mn('div',Td,[Mn('div',Ad,[Mn('span',{class:ee(['font-bold',e.getQualityTextClass(t)])},oe(t.name),3),Mn('span',Md,oe(t.cost)+' CP',1),e.shopCart[t.id]?(yn(),Sn('span',Ed,' x'+oe(e.shopCart[t.id]),1)):Rn('v-if',!0)]),Mn('div',$d,oe(e.getItemTypeDisplay(t)),1)]),e.shopCart[t.id]?(yn(),Sn('button',{key:0,class:'flex h-6 w-6 items-center justify-center rounded bg-red-900/50 text-xs text-red-200 hover:bg-red-600',onClick:Cl(a=>e.sellItem(t),['stop'])},' - ',8,Dd)):Rn('v-if',!0)],10,Id))),128))])):(yn(),Sn(pn,{key:1},[Rn(' 其他类别使用卡片网格布局 '),Mn('div',Pd,[(yn(!0),Sn(pn,null,xs(e.getShopItemsByCategory(a),t=>(yn(),Sn('div',{key:t.id,class:ee(['relative cursor-pointer rounded border border-[#373a40] bg-[#25262b] p-3 hover:border-[#7289da]',{'border-[#ffd700]':e.shopCart[t.id]}]),onClick:a=>e.buyItem(t)},[e.shopCart[t.id]?(yn(),Sn('div',Rd,' x'+oe(e.shopCart[t.id]),1)):Rn('v-if',!0),Mn('div',jd,oe(t.cost)+' CP ',1),Rn(' 图标显示：优先使用 Sprite Sheet，降级到 emoji，添加稀有度边框 '),Mn('div',Ld,[e.hasIconData(t)?(yn(),Sn('div',{key:0,class:ee(['shop-item-icon rounded',e.getQualityBorderClass(t)]),style:X(e.getIconStyle(t,48))},null,6)):(yn(),Sn('div',{key:1,class:ee(['flex h-12 w-12 items-center justify-center rounded text-2xl',e.getQualityBorderClass(t)])},oe(t.data.emoji||'📦'),3))]),Mn('div',{class:ee(['truncate text-sm font-bold',e.getQualityTextClass(t)])},oe(t.name),3),Mn('div',Bd,oe(e.getItemTypeDisplay(t)),1),e.shopCart[t.id]?(yn(),Sn('button',{key:1,class:'absolute right-1 bottom-1 flex h-5 w-5 items-center justify-center rounded bg-red-900/50 text-xs text-red-200 hover:bg-red-600',onClick:Cl(a=>e.sellItem(t),['stop'])},' - ',8,Od)):Rn('v-if',!0)],10,Nd))),128))])],2112))]))),128))])])):Rn('v-if',!0),Rn(' Step 5: Finalize '),5===e.currentStep?(yn(),Sn('div',qd,[Mn('div',Ud,[t[103]||(t[103]=Mn('h3',{class:'mb-4 text-lg font-bold text-[#7289da]'},'最终确认',-1)),Mn('div',Vd,[Mn('div',null,[t[99]||(t[99]=Mn('span',{class:'text-gray-400'},'姓名:',-1)),Pn(' '+oe(e.finalName),1)]),Mn('div',null,[t[100]||(t[100]=Mn('span',{class:'text-gray-400'},'种族:',-1)),Pn(' '+oe(e.finalRace),1)]),Mn('div',null,[t[101]||(t[101]=Mn('span',{class:'text-gray-400'},'职业:',-1)),Pn(' '+oe(e.finalClass),1)]),Mn('div',null,[t[102]||(t[102]=Mn('span',{class:'text-gray-400'},'性别:',-1)),Pn(' '+oe(e.finalSex),1)])])]),Rn(' 预设模式：显示预设的出生地点（不可修改） '),'preset'===e.mode&&e.selectedPreset?(yn(),Sn('div',Fd,[Mn('div',Hd,[t[104]||(t[104]=Mn('h4',{class:'mb-2 text-sm font-bold text-[#7289da]'},'📍 预设出生地点',-1)),Mn('div',Gd,oe(e.presetLocationDisplay),1),t[105]||(t[105]=Mn('div',{class:'mt-2 text-xs text-gray-500 italic'},'（预设角色使用内置的出生地点，无需手动选择）',-1))]),Mn('div',null,[t[106]||(t[106]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'开场剧情 / 备注 (Prompt)',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[34]||(t[34]=t=>e.scene.intro=t),rows:'4',class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none',placeholder:'描述你的角色正处于什么状况...'},null,512),[[fl,e.scene.intro]])])])):(yn(),Sn(pn,{key:1},[Rn(' 自定义模式：允许选择出生地点 '),Mn('div',zd,[Mn('div',null,[t[107]||(t[107]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'开局时间',-1)),xa(Mn('input',{'onUpdate:modelValue':t[35]||(t[35]=t=>e.scene.date=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none'},null,512),[[fl,e.scene.date]])]),Rn(' 开局地点：级联下拉菜单 '),Mn('div',null,[t[115]||(t[115]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'开局地点',-1)),Rn(' 快速选择推荐地点 '),Mn('div',Wd,[xa(Mn('select',{'onUpdate:modelValue':t[36]||(t[36]=t=>e.selectedRecommendedLocation=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',onChange:t[37]||(t[37]=(...t)=>e.applyRecommendedLocation&&e.applyRecommendedLocation(...t))},[t[108]||(t[108]=Mn('option',{value:''},'-- 快速选择推荐地点 --',-1)),(yn(!0),Sn(pn,null,xs(e.recommendedLocations,e=>(yn(),Sn('option',{key:e.name,value:e.name},oe(e.name)+' - '+oe(e.desc),9,Qd))),128))],544),[[bl,e.selectedRecommendedLocation]])]),Rn(' 级联选择器 '),Mn('div',Xd,[t[114]||(t[114]=Mn('div',{class:'mb-2 text-xs text-gray-500'},'或者逐级选择地点：',-1)),Rn(' 第一级：国家/区域 '),xa(Mn('select',{'onUpdate:modelValue':t[38]||(t[38]=t=>e.scene.locationPath[0]=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',onChange:t[39]||(t[39]=t=>e.onLocationLevelChange(0))},[t[109]||(t[109]=Mn('option',{value:''},'-- 选择区域/国家 --',-1)),(yn(!0),Sn(pn,null,xs(e.getLocationOptionsAtLevel(0),e=>(yn(),Sn('option',{key:e.name,value:e.name},oe(e.name),9,Yd))),128))],544),[[bl,e.scene.locationPath[0]]]),Rn(' 第二级 '),e.scene.locationPath[0]&&e.getLocationOptionsAtLevel(1).length>0?xa((yn(),Sn('select',{key:0,'onUpdate:modelValue':t[40]||(t[40]=t=>e.scene.locationPath[1]=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',onChange:t[41]||(t[41]=t=>e.onLocationLevelChange(1))},[t[110]||(t[110]=Mn('option',{value:''},'-- 选择子区域 --',-1)),(yn(!0),Sn(pn,null,xs(e.getLocationOptionsAtLevel(1),e=>(yn(),Sn('option',{key:e.name,value:e.name},oe(e.name),9,Kd))),128))],544)),[[bl,e.scene.locationPath[1]]]):Rn('v-if',!0),Rn(' 第三级 '),e.scene.locationPath[1]&&e.getLocationOptionsAtLevel(2).length>0?xa((yn(),Sn('select',{key:1,'onUpdate:modelValue':t[42]||(t[42]=t=>e.scene.locationPath[2]=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',onChange:t[43]||(t[43]=t=>e.onLocationLevelChange(2))},[t[111]||(t[111]=Mn('option',{value:''},'-- 选择具体地点 --',-1)),(yn(!0),Sn(pn,null,xs(e.getLocationOptionsAtLevel(2),e=>(yn(),Sn('option',{key:e.name,value:e.name},oe(e.name),9,Jd))),128))],544)),[[bl,e.scene.locationPath[2]]]):Rn('v-if',!0),Rn(' 第四级 '),e.scene.locationPath[2]&&e.getLocationOptionsAtLevel(3).length>0?xa((yn(),Sn('select',{key:2,'onUpdate:modelValue':t[44]||(t[44]=t=>e.scene.locationPath[3]=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',onChange:t[45]||(t[45]=t=>e.onLocationLevelChange(3))},[t[112]||(t[112]=Mn('option',{value:''},'-- 选择详细位置 --',-1)),(yn(!0),Sn(pn,null,xs(e.getLocationOptionsAtLevel(3),e=>(yn(),Sn('option',{key:e.name,value:e.name},oe(e.name),9,Zd))),128))],544)),[[bl,e.scene.locationPath[3]]]):Rn('v-if',!0),Rn(' 第五级 '),e.scene.locationPath[3]&&e.getLocationOptionsAtLevel(4).length>0?xa((yn(),Sn('select',{key:3,'onUpdate:modelValue':t[46]||(t[46]=t=>e.scene.locationPath[4]=t),class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none focus:border-[#7289da]',onChange:t[47]||(t[47]=t=>e.onLocationLevelChange(4))},[t[113]||(t[113]=Mn('option',{value:''},'-- 选择房间/区域 --',-1)),(yn(!0),Sn(pn,null,xs(e.getLocationOptionsAtLevel(4),e=>(yn(),Sn('option',{key:e.name,value:e.name},oe(e.name),9,eu))),128))],544)),[[bl,e.scene.locationPath[4]]]):Rn('v-if',!0),Rn(' 显示当前选择的完整路径 '),e.currentLocationDisplay?(yn(),Sn('div',tu,' 📍 '+oe(e.currentLocationDisplay),1)):Rn('v-if',!0)])]),Mn('div',null,[t[116]||(t[116]=Mn('label',{class:'mb-1 block text-sm text-gray-400'},'开场剧情 / 备注 (Prompt)',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[48]||(t[48]=t=>e.scene.intro=t),rows:'4',class:'w-full rounded border border-[#373a40] bg-[#1a1b1e] p-2 outline-none',placeholder:'描述你的角色正处于什么状况...'},null,512),[[fl,e.scene.intro]])])])],2112))])):Rn('v-if',!0)]),Rn(' Footer Actions '),Mn('div',au,[e.currentStep>1?(yn(),Sn('button',{key:0,class:'footer-btn secondary',onClick:t[49]||(t[49]=(...t)=>e.prevStep&&e.prevStep(...t))},[...t[117]||(t[117]=[Mn('span',null,'← 上一步',-1)])])):(yn(),Sn('div',su)),1.5!==e.currentStep||e.selectedPreset?5===e.currentStep?(yn(),Sn('button',{key:3,class:'footer-btn finish',onClick:t[50]||(t[50]=(...t)=>e.finishCreation&&e.finishCreation(...t))},'🚀 进入世界')):(yn(),Sn('button',{key:4,class:'footer-btn primary',onClick:t[51]||(t[51]=(...t)=>e.nextStep&&e.nextStep(...t))},'下一步 →')):(yn(),Sn('button',nu,'请选择预设'))])])],2)}],['__scopeId','data-v-768e54ca']]),Pu={class:'game-ui-root font-sans'},Nu={class:'flex flex-col text-xs md:flex-row md:items-center md:text-base'},Ru={class:'mr-2 font-bold'},ju={class:'text-[10px] text-gray-400 md:text-sm'},Lu={key:0,class:'relative'},Bu={class:'flex flex-col bg-[#2f3136] px-2 py-1.5 text-sm shadow-inner sm:px-4 sm:py-2 sm:text-base'},Ou={class:'flex flex-col md:flex-row md:items-start md:space-x-4'},qu={key:0,class:'flex-1 leading-relaxed text-gray-300 italic'},Uu={key:1,class:'flex-1 text-xs text-gray-500 italic sm:text-sm'},Vu={key:0},Fu={key:1},Hu={key:0,class:'absolute top-full right-0 left-0 z-30 border-t border-gray-700 bg-[#2f3136]/95 px-2 py-2 shadow-lg backdrop-blur-sm sm:px-4 sm:py-3'},Gu={class:'grid grid-cols-1 gap-2 sm:gap-4 md:grid-cols-3'},zu={key:0,class:'space-y-1 sm:space-y-1.5'},Wu={key:0,class:'space-y-1'},Qu=['onClick'],Xu={key:0,class:'ml-1 text-[10px] text-gray-500 opacity-70 sm:text-xs'},Yu={key:0,class:'ml-1 text-[10px] text-gray-400 opacity-60 sm:text-xs'},Ku={key:1,class:'ml-1 text-[10px] text-gray-500 sm:text-xs'},Ju={class:'list-disc space-y-0.5 pl-3 text-xs text-gray-300 marker:text-green-500/50 sm:pl-4 sm:text-sm'},Zu={key:1,class:'space-y-1 sm:space-y-1.5'},ep={key:0,class:'space-y-1'},tp=['onClick'],ap={class:'flex-1 truncate'},sp={key:0,class:'ml-1 text-[10px] text-gray-500 sm:text-xs'},np={key:1,class:'ml-1 text-[10px] text-yellow-500 sm:text-xs'},rp={class:'list-disc space-y-0.5 pl-3 text-xs text-gray-300 marker:text-blue-500/50 sm:pl-4 sm:text-sm'},lp=['onClick'],op={key:2,class:'space-y-1 sm:space-y-1.5'},ip={key:0,class:'space-y-1'},cp=['onClick'],dp={class:'flex-1 truncate'},up={key:0,class:'ml-1 truncate text-[10px] text-gray-500 opacity-70 sm:text-xs'},pp={class:'list-disc space-y-0.5 pl-3 text-xs text-gray-300 marker:text-orange-500/50 sm:pl-4 sm:text-sm'},mp={class:'pointer-events-none -mt-3 flex items-center justify-center gap-2 pb-1 sm:-mt-6 sm:pb-2'},gp={class:'absolute -top-1.5 -right-1.5 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white sm:h-5 sm:w-5 sm:text-xs'},hp={key:0},fp={key:1},vp={class:'right-sidebar-container custom-scrollbar flex h-full flex-col overflow-y-auto text-gray-200'},yp={class:'sidebar-icon-bar relative z-10 mb-4 flex items-center justify-around px-2 py-2'},bp={class:'relative z-10 flex-1 overflow-y-auto px-3 pb-4'},xp={class:'sidebar-group mb-4'},wp={class:'sidebar-group-content'},kp=['disabled','title'],Sp={key:0,class:'lock-icon'},_p={class:'sidebar-group mb-4'},Cp={class:'sidebar-group-content'},Ip={class:'sidebar-group mb-4'},Tp={class:'sidebar-group-content'},Ap=['disabled'],Mp={class:'btn-text'},Ep=['disabled'],$p={class:'btn-text'},Dp=['disabled'],Pp={class:'btn-text'},Np={class:'sidebar-group mb-4'},Rp={class:'sidebar-group-content'},jp={key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50'},Lp={class:'animate-pulse font-bold text-white'};const Bp=xt({visible:!1,type:'alert',title:'',message:'',variant:'info',confirmText:'确定',cancelText:'取消',placeholder:'',initialValue:'',inputValue:'',resolve:null}),Op=e=>new Promise(t=>{Bp.visible=!0,Bp.type=e.type,Bp.title=e.title,Bp.message=e.message,Bp.variant=e.variant||'info',Bp.confirmText=e.confirmText||'确定',Bp.cancelText=e.cancelText||'取消',Bp.placeholder=e.placeholder||'',Bp.initialValue=e.initialValue||'',Bp.inputValue=e.initialValue||'',Bp.resolve=t}),qp=()=>{const{resolve:e,type:t,inputValue:a}=Bp;Bp.visible=!1,e&&(e('prompt'!==t||a),Bp.resolve=null)},Up=()=>{const{resolve:e,type:t}=Bp;Bp.visible=!1,e&&(e('prompt'===t&&null),Bp.resolve=null)},Vp=e=>{Bp.inputValue=e},Fp=(e,t,a='info')=>Op({type:'alert',title:e,message:t,variant:a}),Hp=(e,t,a)=>Op({type:'confirm',title:e,message:t,variant:a?.variant||'warning',confirmText:a?.confirmText,cancelText:a?.cancelText}),Gp=(e,t,a)=>Op({type:'prompt',title:e,message:t,placeholder:a?.placeholder,initialValue:a?.initialValue,variant:a?.variant||'info'}),zp=(e,t)=>Fp(e,t,'success'),Wp=(e,t)=>Fp(e,t,'warning'),Qp=(e,t,a)=>Hp(e,t,{variant:'danger',confirmText:a?.confirmText||'确定删除',cancelText:a?.cancelText||'取消'});function Xp(){return{state:wt(Bp),handleConfirm:qp,handleCancel:Up,updateInputValue:Vp,alert:Fp,confirm:Hp,prompt:Gp,success:zp,warning:Wp,danger:Qp}}function Yp(e){const{alert:t,success:a,danger:s}=Xp(),n=$t(!1),r=$t(null),l=$t('');return{showEquipmentDetail:n,selectedEquipmentItem:r,selectedEquipmentSlot:l,handleEquipItem:e=>{const t=(()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();return e?.player})();if(!t)return;Ll.serviceLocator.get('InventoryService').equipItem(e.id,t)},handleUnequipItem:t=>{const a=e.value?.player?.equipment?.[t];a&&(r.value=a,l.value=t,n.value=!0)},handleEquipmentUnequip:e=>{Ll.serviceLocator.get('InventoryService').unequipItem(e),n.value=!1,r.value=null,l.value=''},handleUnequipAll:async()=>{const n=Ll.serviceLocator.get('InventoryService'),r=e.value?.player?.equipment;if(!r)return;const l=Object.keys(r).filter(e=>{const t=r[e];return t&&t.name});if(0===l.length)return void await t('没有装备','当前没有任何已装备的物品。');if(await s('卸下全部装备',`确定要卸下所有装备吗？（共 ${l.length} 件）`)){for(const e of l)n.unequipItem(e);await a('卸下成功',`已卸下 ${l.length} 件装备。`)}},handleShowEquipmentDetailFromPanel:e=>{r.value=e.item,l.value=e.slot,n.value=!0},handleEquipmentDiscard:async e=>{if(await s('丢弃装备',`确定要丢弃 ${e.name} 吗？此操作无法撤销。`)){const t=Ll.serviceLocator.get('InventoryService'),a=l.value;t.unequipItem(a),setTimeout(()=>{t.removeItem(e.id,1)},50),n.value=!1,r.value=null,l.value=''}},closeEquipmentDetail:()=>{n.value=!1,r.value=null,l.value=''},createDiscardItemAction:e=>({title:'丢弃物品',message:`确定要丢弃 ${e.name} 吗？此操作无法撤销。`,confirmText:'丢弃',cancelText:'取消',item:e,isDestructive:!0,actions:[],onConfirm:()=>{Ll.serviceLocator.get('InventoryService').removeItem(e.id,1)}})}}const Kp='https://testingcf.jsdelivr.net/gh/Platium-T/alg@main/地图',Jp={'map-1':{id:'map-1',name:'荒芜之地',image:`${Kp}/map-1(荒芜之地).webp`,mapData:void 0},'map-2':{id:'map-2',name:'猩红部落',image:`${Kp}/map-2(猩红部落).webp`,mapData:void 0},'map-3':{id:'map-3',name:'冰原',image:`${Kp}/map-3(冰原).webp`,mapData:void 0},'map-4':{id:'map-4',name:'熔炉城邦',image:`${Kp}/map-4(熔炉城邦).webp`,mapData:void 0},'map-5':{id:'map-5',name:'铃兰平原',image:`${Kp}/map-5(铃兰平原).webp`,mapData:JSON.parse('{"meta":{"width":200,"height":200,"cellSize":10},"walls":[[6,3,200,6],[6,9,2,194],[8,9,1,123],[81,9,2,5],[83,9,2,2],[120,9,10,3],[196,9,10,194],[80,10,1,7],[79,11,1,6],[83,11],[78,12,1,5],[121,12,9,2],[77,13,1,5],[130,13,1,30],[74,14,3,4],[81,14,1,2],[122,14,8,1],[72,15,2,5],[123,15,7,2],[131,15,1,28],[70,16,2,7],[69,17,1,10],[124,17,6,2],[132,17,1,27],[74,18,2,1],[68,19,1,9],[74,19],[125,19,5,2],[133,19,1,25],[67,20,1,10],[72,20,1,2],[134,20,1,24],[126,21,4,2],[135,22,1,20],[66,23,1,8],[70,23,1,2],[127,23,3,1],[128,24,2,2],[65,25,1,7],[136,25,1,15],[129,26,1,3],[64,27,1,6],[62,28,2,5],[61,29,1,6],[59,30,2,6],[58,31,1,6],[57,32,1,5],[38,33,3,1],[56,33,1,4],[62,33],[39,34,4,1],[54,34,2,5],[31,35,5,5],[41,35,3,1],[50,35,4,4],[129,35,1,8],[36,36,1,12],[42,36,3,1],[47,36,3,5],[37,37,2,10],[43,37,4,1],[39,38,2,8],[45,38,2,1],[41,39,2,7],[46,39],[50,39,1,4],[33,40,3,1],[43,40,1,7],[128,40,1,3],[35,41],[44,41,1,7],[48,41,2,1],[51,41,2,3],[127,41,1,2],[45,42,1,7],[53,42,1,3],[126,42],[35,43,1,6],[46,43,1,7],[54,43,1,3],[34,44,1,6],[47,44,2,7],[55,44,1,3],[125,44,4,31],[129,44,2,8],[33,45,1,6],[49,45,1,8],[56,45,1,3],[131,45,2,2],[50,46,1,8],[57,46,3,3],[124,46,1,28],[32,47,1,6],[37,47],[51,47,1,7],[60,47,1,3],[131,47],[31,48,1,5],[52,48,1,6],[123,48,1,26],[30,49,1,5],[53,49,1,5],[58,49,2,1],[122,49,1,24],[27,50,3,5],[59,50],[121,50,1,14],[25,51,2,4],[48,51],[19,52,6,4],[120,52,1,8],[129,52,1,3],[18,53,1,4],[14,54,4,4],[11,55,3,4],[176,55,6,8],[9,56,2,4],[19,56,2,1],[14,58,2,1],[11,59],[21,60,2,2],[129,61,1,21],[25,63,4,2],[130,64,1,22],[16,65,5,3],[11,66,3,2],[121,67,1,3],[131,67,1,22],[14,69,3,2],[132,69,1,21],[133,70,1,24],[134,71,1,24],[11,72,3,2],[18,72,2,2],[135,72,1,23],[162,74,5,8],[170,74,16,1],[188,74,8,10],[126,75,3,1],[160,75,2,11],[167,75,1,6],[173,75,6,3],[181,75,5,9],[9,76,8,44],[94,76,16,39],[127,76,2,1],[136,76,1,19],[158,76,2,11],[17,77,2,43],[89,77,5,37],[110,77,6,37],[128,77,1,2],[157,77,1,11],[19,78,2,42],[85,78,4,35],[116,78,2,35],[137,78,1,17],[155,78,2,11],[21,79,2,41],[84,79,1,34],[118,79,2,33],[150,79,2,1],[154,79,1,10],[171,79,9,6],[23,80,1,40],[40,80,2,22],[82,80,2,31],[120,80,1,31],[138,80,1,15],[149,80,2,1],[153,80,1,9],[24,81,2,9],[79,81],[81,81,1,29],[148,81,2,1],[152,81,1,7],[26,82,1,7],[78,82],[80,82,1,27],[121,82,1,28],[147,82,1,12],[148,82],[151,82,1,5],[162,82,2,2],[164,82],[27,83,2,5],[39,83,1,19],[42,83,1,19],[79,83,1,25],[122,83,2,25],[139,83,1,12],[150,83,1,4],[78,84,1,23],[124,84,1,23],[162,84],[77,85,1,21],[125,85,1,20],[181,85,15,10],[76,86,1,18],[140,86,1,8],[126,87,1,16],[27,88],[75,88,1,14],[127,89,1,11],[148,89,5,5],[24,90],[74,91,1,9],[38,92,1,10],[43,92,1,10],[24,96,1,20],[134,96,6,25],[147,96,9,5],[181,96,15,11],[25,97,1,19],[37,97,1,5],[44,97,1,5],[133,97,1,22],[140,97,1,5],[158,98,4,5],[157,99,1,3],[162,99,3,6],[26,100,1,16],[165,100,1,7],[132,101,1,16],[147,101,1,3],[166,101,1,7],[150,102,6,7],[167,102,2,6],[156,103,1,10],[160,103,2,1],[169,103,2,4],[172,103,5,12],[149,104,1,5],[157,104,1,9],[161,104],[27,105,1,11],[131,105,1,10],[158,105,2,9],[163,105,2,1],[160,106,2,8],[162,107,2,5],[181,107,3,4],[122,108],[140,108,1,24],[164,108,1,3],[170,108,2,7],[151,109,5,1],[169,109,1,6],[177,109,1,5],[153,110,3,1],[83,111],[155,111],[181,111],[141,112,1,30],[162,112],[180,112,1,4],[86,113,3,1],[93,114],[110,114],[101,115,5,1],[142,116,1,26],[180,117,1,9],[35,119,5,9],[143,119,1,23],[9,120,5,12],[144,120,1,22],[135,121,5,2],[136,123,4,1],[145,123,1,20],[137,124,3,2],[146,124,1,17],[181,125,15,1],[138,126,2,1],[147,126,1,11],[139,127,1,3],[148,127,1,10],[149,128,2,10],[151,129,1,11],[152,130,1,11],[153,132,2,10],[155,134,2,8],[157,136,1,5],[140,138,1,4],[150,138],[158,139,2,2],[139,140,1,2],[137,143,6,10],[156,143,6,9],[136,144,1,12],[143,144,4,8],[154,144,2,8],[162,144,1,10],[135,145,1,12],[147,145,7,6],[163,145,2,9],[134,146,1,12],[165,146,1,9],[133,147,1,12],[166,147,1,9],[131,148,2,11],[167,148,2,9],[130,149,1,11],[169,149,1,9],[170,150,2,9],[189,150],[128,151,2,10],[147,151],[172,151,2,10],[127,152,1,10],[143,152],[160,152,2,1],[174,152,1,10],[125,153,2,9],[137,153,2,2],[139,153],[175,153,1,10],[123,154,2,9],[164,154],[176,154,1,9],[122,155,1,10],[137,155],[177,155,2,9],[121,156,1,10],[179,156,2,9],[118,157,3,14],[168,157],[181,157,1,9],[117,158,1,12],[182,158,2,8],[115,159,2,11],[131,159],[171,159,1,2],[184,159,3,8],[108,160,7,18],[187,160,2,8],[173,161],[189,161,4,8],[107,162,1,3],[125,162],[193,162,2,9],[123,163],[195,163,1,9],[106,164],[178,164],[180,165],[100,166,5,8],[183,166],[185,167,2,1],[105,168,3,12],[188,168],[191,169,2,1],[118,171,2,1],[194,171],[115,173,2,3],[101,174,4,1],[103,175,2,9],[102,176,1,11],[115,176],[100,177,2,11],[99,178,1,13],[108,178,6,1],[98,179,1,13],[108,179],[105,180,2,2],[97,181,1,12],[96,182,1,13],[105,182],[95,183,1,20],[103,184],[94,185,1,18],[93,186,1,17],[92,188,1,15],[100,188],[91,189,1,14],[90,190,1,13],[89,191,1,12],[88,192,1,11],[87,193,1,10],[85,194,2,9],[8,197,77,6],[96,197,100,6]],"regions":{},"events":[{"id":"默认出生点","type":"spawn","at":[[85,156]]},{"id":"最后壁垒                    ","type":"gate","at":[[80,77,6,5],[115,77,6,6],[82,110,6,6],[116,110,6,5]]},{"id":"通路旅店                 ","type":"enter","at":[[90,29,27,23]]},{"id":"德鲁伊之石             ","type":"enter","at":[[43,61,15,13]]},{"id":"四风集镇            ","type":"enter","at":[[144,68,53,54]]},{"id":"古战场遗迹(小型)          ","type":"enter","at":[[141,47,23,18]]},{"id":"黄昏农场","type":"enter","at":[[80,126,41,22]]},{"id":"泣雨高塔","type":"gate","at":[[36,100,10,5]]},{"id":"风铃村","type":"enter","at":[[12,145,47,38]]},{"id":"渡鸦堡","type":"transition","at":[[106,165,2,3],[105,166,1,2],[115,170,3,2],[115,172,2,1]]},{"id":"渡鸦堡","type":"gate","at":[[103,163,3,3],[117,172,3,3]]},{"id":"晶沙帝国","type":"portal_in","at":[[189,180,7,8]],"params":{"portalTargetMap":"map-9(晶沙帝国)","portalTargetId":"铃兰-晶沙"}},{"id":"圣银王国","type":"portal_in","at":[[158,191,11,6]],"params":{"portalTargetMap":"map-8(圣银王国)","portalTargetId":"铃兰-圣银"}},{"id":"翡翠联邦","type":"portal_in","at":[[192,46,4,7]],"params":{"portalTargetMap":"map-6(翡翠联邦)","portalTargetId":"铃兰-翡翠"}},{"id":"猩红部落","type":"portal_in","at":[[100,9,6,5]],"params":{"portalTargetMap":"map-2(猩红部落)","portalTargetId":"铃兰-猩红"}},{"id":"熔炉城邦","type":"portal_in","at":[[14,120,6,5]],"params":{"portalTargetMap":"map-4(熔炉城邦)","portalTargetId":"铃兰-熔炉"}},{"id":"荒芜之地","type":"portal_in","at":[[9,12,5,7]],"params":{"portalTargetMap":"map-1(荒芜之地)","portalTargetId":"铃兰-荒芜"}},{"id":"无垠之海","type":"portal_in","at":[[8,191,7,6]],"params":{"portalTargetMap":"map-7(无垠之海)","portalTargetId":"铃兰-无垠"}},{"id":"冰原","type":"portal_in","at":[[183,9,6,5]],"params":{"portalTargetMap":"map-3(冰原)","portalTargetId":"铃兰-冰原"}}]}')},'map-6':{id:'map-6',name:'翡翠联邦',image:`${Kp}/map-6(翡翠联邦).webp`,mapData:void 0},'map-7':{id:'map-7',name:'无垠之海',image:`${Kp}/map-7(无垠之海).webp`,mapData:JSON.parse('{"meta":{"width":103,"height":103,"cellSize":10},"walls":[[77,0,7,1],[88,0,15,1],[77,1,1,2],[96,1,7,6],[76,2,1,4],[94,2,2,4],[92,3,2,1],[93,4],[75,6,1,6],[84,7,6,4],[97,7,6,1],[74,8,1,3],[76,8,1,6],[83,8,1,5],[90,8,1,4],[98,8,5,1],[77,9,1,7],[82,9,1,4],[91,9,1,2],[99,9,4,1],[81,10,1,4],[100,10,3,1],[78,11,3,4],[84,11],[101,11,2,1],[95,12,1,4],[102,12],[78,15,2,1],[94,15,1,2],[93,16,1,2],[92,17],[102,17,1,7],[91,18],[90,19,1,5],[88,20,2,2],[99,20,3,4],[97,21,2,4],[89,22,1,2],[91,22,1,3],[96,22,1,3],[92,23,4,3],[99,24]],"regions":{},"events":[{"id":"默认出生点","at":[[89,12]]},{"id":"传送至map-4(熔炉城邦)","at":[[84,0,4,2]]},{"id":"传送至map-8(圣银王国)","at":[[100,13,3,4]]}]}')},'map-8':{id:'map-8',name:'圣银王国',image:`${Kp}/map-8(圣银王国).webp`,mapData:void 0},'map-9':{id:'map-9',name:'晶沙帝国',image:`${Kp}/map-9(晶沙帝国).webp`,mapData:void 0}};var Zp;console.log('[Maps] Registered maps:',Object.keys(Jp)),function(e){e.TELEPORT='teleport',e.PORTAL_IN='portal_in',e.PORTAL_OUT='portal_out',e.GATE='gate',e.ENTER='enter',e.SPAWN='spawn',e.NPC='npc',e.CHEST='chest',e.ENCOUNTER='encounter',e.TRIGGER='trigger',e.TRANSITION='transition'}(Zp||(Zp={}));const em={[Zp.TELEPORT]:{label:'传送门(旧版)',icon:'🌀',color:'rgba(139, 92, 246, 0.6)',description:'传送到其他地图的指定坐标（需要硬编码）'},[Zp.PORTAL_IN]:{label:'传送入口',icon:'🚪',color:'rgba(59, 130, 246, 0.6)',description:'传送入口：填写目标地图ID和传送点ID，自动连接到对应的传送出口'},[Zp.PORTAL_OUT]:{label:'传送出口',icon:'📍',color:'rgba(34, 197, 94, 0.6)',description:'传送出口：设置传送点ID，供其他地图的传送入口引用'},[Zp.GATE]:{label:'城门/检查点',icon:'🚪',color:'rgba(251, 191, 36, 0.6)',description:'需要确认才能通过的关卡点'},[Zp.ENTER]:{label:'区域入口',icon:'📍',color:'rgba(34, 197, 94, 0.6)',description:'进入时显示区域名称'},[Zp.SPAWN]:{label:'出生点',icon:'⭐',color:'rgba(59, 130, 246, 0.6)',description:'玩家初始位置或复活点'},[Zp.NPC]:{label:'NPC',icon:'💬',color:'rgba(249, 115, 22, 0.6)',description:'NPC对话交互点'},[Zp.CHEST]:{label:'宝箱',icon:'📦',color:'rgba(234, 179, 8, 0.6)',description:'可开启的宝箱或物品点'},[Zp.ENCOUNTER]:{label:'遭遇区',icon:'⚔️',color:'rgba(239, 68, 68, 0.6)',description:'随机触发战斗的区域'},[Zp.TRIGGER]:{label:'触发器',icon:'⚡',color:'rgba(6, 182, 212, 0.6)',description:'自定义条件触发的事件'},[Zp.TRANSITION]:{label:'区域传送',icon:'🔄',color:'rgba(168, 85, 247, 0.6)',description:'地图内部的传送点'}};var tm,am;!function(e){e.ALWAYS='always',e.HAS_ITEM='hasItem',e.NO_ITEM='noItem',e.HAS_FLAG='hasFlag',e.NO_FLAG='noFlag',e.FIRST_VISIT='firstVisit',e.CHANCE='chance',e.HP_BELOW='hpBelow',e.HP_ABOVE='hpAbove',e.LEVEL_MIN='levelMin',e.QUEST_ACTIVE='questActive',e.QUEST_COMPLETE='questComplete'}(tm||(tm={})),function(e){e.TELEPORT='teleport',e.SHOW_MESSAGE='showMessage',e.GIVE_ITEM='giveItem',e.TAKE_ITEM='takeItem',e.SET_FLAG='setFlag',e.CLEAR_FLAG='clearFlag',e.START_BATTLE='startBattle',e.HEAL='heal',e.DAMAGE='damage',e.PLAY_SOUND='playSound',e.START_DIALOGUE='startDialogue',e.COMPLETE_QUEST='completeQuest'}(am||(am={}));tm.HAS_ITEM,am.TAKE_ITEM,am.SHOW_MESSAGE,am.TELEPORT,tm.CHANCE,am.START_BATTLE,tm.FIRST_VISIT,am.SHOW_MESSAGE,am.SET_FLAG,tm.NO_FLAG,am.GIVE_ITEM,am.SHOW_MESSAGE,am.SET_FLAG,tm.HP_BELOW,am.HEAL,am.SHOW_MESSAGE;const sm={key:0,class:'battle-view relative flex h-full flex-col overflow-hidden bg-[#202225] font-sans'},nm={key:0,class:'absolute top-14 left-2 z-20 md:top-12 md:left-4'},rm={key:0,class:'absolute top-14 left-1/2 z-30 -translate-x-1/2 rounded-lg border border-yellow-500/50 bg-yellow-900/90 px-4 py-2 text-sm text-yellow-300 shadow-lg backdrop-blur-sm md:top-16'},lm={class:'animate-pulse'},om={class:'mb-4 md:mb-6'},im={class:'flex flex-wrap justify-center gap-2 md:gap-3'},cm=['id','onClick'],dm={key:0,class:'absolute -top-2 -right-1 z-20 flex h-5 w-5 items-center justify-center rounded-full border border-gray-600 bg-gray-800 shadow-md md:-top-3 md:-right-2 md:h-6 md:w-6'},um={class:'text-[10px] md:text-xs'},pm={key:1,class:'absolute -top-1 -left-1 z-20 flex h-5 w-5 items-center justify-center rounded-full bg-red-600 text-[10px] font-bold text-white shadow-md md:h-6 md:w-6'},mm={class:'flex items-center justify-between bg-[#202225] px-1.5 py-0.5 text-[10px] md:px-2 md:py-1 md:text-xs'},gm={class:'truncate font-bold text-gray-200'},hm={class:'hidden text-[9px] text-gray-500 md:inline'},fm={class:'space-y-0.5 p-1.5 md:space-y-1 md:p-2'},vm={class:'relative h-3 w-full overflow-hidden rounded bg-gray-800 md:h-4'},ym={class:'absolute inset-0 flex items-center justify-center text-[8px] font-bold text-white drop-shadow-lg md:text-[10px]'},bm={class:'h-1 w-full overflow-hidden rounded bg-gray-800/30 md:h-1.5'},xm={class:'flex h-3 flex-wrap items-center justify-center gap-0.5 md:h-4'},wm=['title'],km={key:0,class:'text-[8px] text-gray-500'},Sm={key:0,class:'mb-4 md:mb-6'},_m={class:'flex flex-wrap justify-center gap-2 md:gap-3'},Cm=['onClick'],Im={class:'bg-[#202225] px-1.5 py-0.5 text-center text-[9px] font-bold text-gray-300 md:px-2 md:text-[10px]'},Tm={class:'p-1'},Am={class:'relative h-2 w-full overflow-hidden rounded bg-gray-800 md:h-2.5'},Mm={class:'mt-4 md:mt-8'},Em={class:'flex flex-wrap justify-center gap-2 md:gap-4'},$m={class:'flex items-center justify-between bg-linear-to-r from-blue-900/40 to-transparent px-2 py-0.5 md:px-3 md:py-1'},Dm={class:'truncate text-xs font-bold text-blue-100 md:text-sm'},Pm={class:'text-[9px] text-blue-300 md:text-[10px]'},Nm={class:'space-y-1 p-1.5 md:space-y-1.5 md:p-2'},Rm={class:'relative h-3.5 w-full overflow-hidden rounded bg-gray-800 md:h-4'},jm={class:'absolute inset-0 flex items-center justify-center text-[9px] font-bold text-white drop-shadow-lg md:text-[10px]'},Lm={class:'h-1.5 w-full overflow-hidden rounded bg-gray-800/30 md:h-2'},Bm={class:'flex gap-1'},Om={class:'relative h-1.5 flex-1 overflow-hidden rounded bg-gray-800 md:h-2'},qm={class:'relative h-1.5 flex-1 overflow-hidden rounded bg-gray-800 md:h-2'},Um={class:'flex h-3 flex-wrap items-center justify-center gap-0.5 md:h-4'},Vm=['title'],Fm={key:0,class:'text-[8px] text-gray-500'},Hm=['id','onClick'],Gm={class:'flex items-center justify-between bg-linear-to-r from-green-900/40 to-transparent px-2 py-0.5 md:px-3 md:py-1'},zm={class:'truncate text-xs font-bold text-green-100 md:text-sm'},Wm={class:'text-[9px] text-green-300 md:text-[10px]'},Qm={class:'space-y-1 p-1.5 md:space-y-1.5 md:p-2'},Xm={class:'relative h-3.5 w-full overflow-hidden rounded bg-gray-800 md:h-4'},Ym={class:'absolute inset-0 flex items-center justify-center text-[9px] font-bold text-white drop-shadow-lg md:text-[10px]'},Km={class:'h-1.5 w-full overflow-hidden rounded bg-gray-800/30 md:h-2'},Jm={class:'flex gap-1'},Zm={class:'relative h-1.5 flex-1 overflow-hidden rounded bg-gray-800 md:h-2'},eg={class:'relative h-1.5 flex-1 overflow-hidden rounded bg-gray-800 md:h-2'},tg={class:'flex h-3 flex-wrap items-center justify-center gap-0.5 md:h-4'},ag=['title'],sg={key:0,class:'text-[8px] text-gray-500'},ng={class:'z-30 border-t border-[#202225] bg-[#2f3136] p-1.5 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.3)] md:p-2'},rg={key:0},lg={class:'grid h-[52px] grid-cols-4 gap-1.5 md:h-[60px] md:gap-2'};const og={physical:'⚔️',slashing:'🗡️',piercing:'🏹',bludgeoning:'🔨',fire:'🔥',water:'💧',wood:'🌿',metal:'🪙',earth:'🪨',wind:'💨',ice:'🧊',lightning:'⚡',sound:'🔊',poison:'🧪',light:'✨',dark:'🌑',force:'🔮',psychic:'🧠',void:'🧬',elemental:'🌀',magical:'💫',true:'💀',bleed:'🩸',holy:'👼',物理:'⚔️',火:'🔥',水:'💧',木:'🌿',金:'🪙',土:'🪨',风:'💨',冰:'🧊',雷:'⚡',音:'🔊',毒:'🧪',光:'✨',暗:'🌑',力场:'🔮',心灵:'🧠',虚空:'🧬',元素:'🌀',魔法:'💫',真实:'💀',流血:'🩸',神圣:'👼'},ig={STR:{emoji:'💪',name:'力量',color:'#E57373'},str:{emoji:'💪',name:'力量',color:'#E57373'},DEX:{emoji:'🏃',name:'敏捷',color:'#81C784'},dex:{emoji:'🏃',name:'敏捷',color:'#81C784'},CON:{emoji:'🛡️',name:'体质',color:'#64B5F6'},con:{emoji:'🛡️',name:'体质',color:'#64B5F6'},INT:{emoji:'🧠',name:'智力',color:'#BA68C8'},int:{emoji:'🧠',name:'智力',color:'#BA68C8'},WIS:{emoji:'👁️',name:'睿智',color:'#FFF176'},wis:{emoji:'👁️',name:'睿智',color:'#FFF176'},CHA:{emoji:'🫦',name:'魅力',color:'#F06292'},cha:{emoji:'🫦',name:'魅力',color:'#F06292'},critRate:{emoji:'🎯',name:'暴击率',color:'#FF6B6B'},暴击率:{emoji:'🎯',name:'暴击率',color:'#FF6B6B'},critDamage:{emoji:'💥',name:'暴击伤害',color:'#FFA94D'},暴击伤害:{emoji:'💥',name:'暴击伤害',color:'#FFA94D'},AC:{emoji:'🛡️',name:'AC',color:'#4DD0E1'},ac:{emoji:'🛡️',name:'AC',color:'#4DD0E1'},CP:{emoji:'⭐',name:'强化点',color:'#FFD700'},cp:{emoji:'⭐',name:'强化点',color:'#FFD700'},SPD:{emoji:'⚡',name:'速度',color:'#FFD54F'},spd:{emoji:'⚡',name:'速度',color:'#FFD54F'}},cg={增益:'⬆️',buff:'⬆️',护盾:'🪩',shield:'🪩',增伤:'⚔️',damageUp:'⚔️',易伤:'💔',vulnerable:'💔','AC+':'🛡️',acUp:'🛡️',抗性:'🧱',resistance:'🧱',额外行动:'⚡',extraAction:'⚡',额外回合:'🔄',extraTurn:'🔄',持续治疗:'💚',hot:'💚','持续治疗:HP':'❤️','持续治疗:MP':'💙','持续治疗:SP':'💚',治疗效果:'💗',healBonus:'💗',恢复效率:'💗',受到治疗量:'🤲',复活:'🔮',revive:'🔮',减益:'⬇️',debuff:'⬇️','AC-':'🔓',acDown:'🔓',睡眠:'😴',sleep:'😴',眩晕:'💫',stun:'💫',中毒:'🧪',poison:'🧪',恐惧:'😱',fear:'😱',流血:'🩸',bleed:'🩸',燃烧:'🔥',burn:'🔥',沉默:'🪧',silence:'🪧',减速:'🐌',slow:'🐌',持续伤害:'☠️',dot:'☠️',抵抗:'🧱','STR+':'💪','STR-':'😰','DEX+':'🏃','DEX-':'🦥','CON+':'🩹','CON-':'🤒','INT+':'🧠','INT-':'😵','WIS+':'👁️','WIS-':'🫧','CHA+':'😍','CHA-':'🫥','ALL+':'🌟','ALL-':'🪦','STR*':'💪','DEX*':'🏃','CON*':'🩹','INT*':'🧠','WIS*':'👁️','CHA*':'😍','ALL*':'🌟','HP+':'❤️','HP-':'💔','MP+':'💙','MP-':'🩵','SP+':'💚','SP-':'🩶',吸血:'🧛','吸血+':'🧛','吸血-':'🧷',lifesteal:'🧛',嘲讽:'😤',taunt:'😤',潜行:'👻',stealth:'👻',无敌:'✨',invulnerable:'✨'},dg={attack:'⚔️',defend:'🛡️',buff:'✨',debuff:'💀',ultimate:'❗',heal:'💚',summon:'👥',wait:'💤'};function ug(e){return og[e]||og[e.toLowerCase()]||'⚔️'}function pg(e){return ig[e]||ig[e.toUpperCase()]||{emoji:'📊',name:e,color:'#9E9E9E'}}function mg(e){if('string'==typeof e)return cg[e]||'🔹';if(e.name&&cg[e.name])return cg[e.name];if(e.tags)for(const t of e.tags)if(cg[t])return cg[t];return!0===e.isBuff?'⬆️':!1===e.isBuff?'⬇️':'🔹'}function gg(e){return dg[e]||'❓'}function hg(e){const t=mg(e),a=-1===e.duration?'永久':`${e.duration}回合`,s=e.stacks>1?` x${e.stacks}`:'';let n=`${t} ${e.name}${s} (${a})`;e.description&&(n+=`\n${e.description}`);const r=e.name.match(/[+-]\d+/);if(e.modifiers&&!r){const t=[];for(const[a,s]of Object.entries(e.modifiers))if(null!=s&&0!==s){const e=s,n=e>0?'+':'';t.push(`${a}: ${n}${e}`)}t.length>0&&(n+=`\n${t.join(', ')}`)}return n}function fg(e){if(void 0!==e.isBuff)return e.isBuff;if(e.tags?.includes('buff'))return!0;if(e.tags?.includes('debuff'))return!1;const t=e.name.toLowerCase();if(['增益','护盾','增伤','加速','强化','治疗','buff','shield'].some(e=>t.includes(e)))return!0;if(['减益','减速','中毒','流血','眩晕','沉默','debuff','slow','stun'].some(e=>t.includes(e)))return!1;if(e.modifiers){const t=Object.values(e.modifiers).filter(e=>'number'==typeof e);if(t.length>0)return t.every(e=>e>=0)}return!0}const vg={class:'log-content custom-scrollbar h-full overflow-y-auto bg-[#202225]/95 p-2 backdrop-blur-sm md:p-3'},yg={key:0,class:'py-4 text-center text-xs text-gray-500'},bg={key:1,class:'flex flex-col gap-1'},xg=['title'],wg={class:'log-icon flex-shrink-0'},kg={class:'log-entry-content min-w-0 flex-1'},Sg={class:'log-text text-gray-300'},_g={key:0,class:'log-details mt-0.5 block text-[9px] text-gray-500'};const Cg={damage:'⚔️',heal:'💚',buff:'⬆️',debuff:'⬇️',action:'🎯',system:'📋',crit:'💥',miss:'💨',death:'💀',shield:'🛡️'},Ig={damage:'border-red-500/50 bg-red-900/10',heal:'border-green-500/50 bg-green-900/10',buff:'border-blue-500/50 bg-blue-900/10',debuff:'border-purple-500/50 bg-purple-900/10',action:'border-yellow-500/50 bg-yellow-900/10',system:'border-gray-500/50 bg-gray-900/10',crit:'border-orange-500/50 bg-orange-900/15',miss:'border-gray-400/50 bg-gray-800/10',death:'border-red-600/60 bg-red-950/20',shield:'border-amber-500/50 bg-amber-900/10'},Tg=Za({name:'BattleLogDrawer',props:{logs:{type:Array,default:()=>[]},maxLogs:{type:Number,default:50},showDetails:{type:Boolean,default:!1}},setup(e){const t=$t(!1),a=e=>{if('object'==typeof e&&'type'in e&&'text'in e)return e;const t=String(e),a=(e=>{const t=e.toLowerCase();return t.includes('暴击')||t.includes('crit')?'crit':t.includes('击败')||t.includes('死亡')||t.includes('倒下')?'death':t.includes('闪避')||t.includes('未命中')||t.includes('落空')?'miss':t.includes('护盾')?'shield':t.includes('伤害')||t.includes('攻击')||t.includes('damage')?'damage':t.includes('治疗')||t.includes('恢复')||t.includes('heal')?'heal':t.includes('增益')||t.includes('获得')||t.includes('buff')?'buff':t.includes('减益')||t.includes('中毒')||t.includes('debuff')||t.includes('施加')?'debuff':t.includes('行动')||t.includes('使用')||t.includes('释放')?'action':'system'})(t);return{type:a,text:t,icon:Cg[a]}},s=ir(()=>e.logs.map(a)),n=ir(()=>[...s.value].reverse().slice(0,e.maxLogs));return{isExpanded:t,toggleExpand:()=>{t.value=!t.value},normalizedLogs:s,reversedLogs:n,getLogClass:e=>Ig[e.type]||Ig.system}}}),Ag=(0,$u.A)(Tg,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',{class:ee(['battle-log-drawer',{expanded:e.isExpanded}])},[Rn(' Handle Bar '),Mn('div',{class:'handle-bar flex cursor-pointer items-center justify-center gap-2 border-t border-[#40444b] bg-[#36393f] py-1 transition-colors hover:bg-[#40444b]',onClick:t[0]||(t[0]=(...t)=>e.toggleExpand&&e.toggleExpand(...t))},[t[1]||(t[1]=Mn('span',{class:'handle-line h-0.5 w-8 rounded bg-gray-600'},null,-1)),Mn('span',{class:ee(['handle-icon text-[10px] text-gray-500 transition-transform',{'rotate-180':e.isExpanded}])},' ▲ ',2),t[2]||(t[2]=Mn('span',{class:'handle-text text-[10px] font-bold tracking-wider text-gray-500 uppercase'},' 战斗日志 ',-1)),Mn('span',{class:ee(['handle-icon text-[10px] text-gray-500 transition-transform',{'rotate-180':e.isExpanded}])},' ▲ ',2),t[3]||(t[3]=Mn('span',{class:'handle-line h-0.5 w-8 rounded bg-gray-600'},null,-1))]),Rn(' Log Content (Expandable) '),Mn('div',{class:'log-content-wrapper transition-all duration-300 ease-in-out',style:X({maxHeight:e.isExpanded?'16rem':'0px',opacity:e.isExpanded?1:0})},[Mn('div',vg,[0===e.normalizedLogs.length?(yn(),Sn('div',yg,'暂无战斗记录')):(yn(),Sn('div',bg,[(yn(!0),Sn(pn,null,xs(e.reversedLogs,(t,a)=>(yn(),Sn('div',{key:a,class:ee(['log-entry flex items-start gap-2 rounded border-l-2 px-2 py-1 text-[10px] md:text-xs',e.getLogClass(t)]),title:t.details},[Mn('span',wg,oe(t.icon),1),Mn('div',kg,[Mn('span',Sg,oe(t.text),1),e.showDetails&&t.details?(yn(),Sn('span',_g,oe(t.details),1)):Rn('v-if',!0)])],10,xg))),128))]))])],4)],2)}],['__scopeId','data-v-92dc781c']]),Mg={class:'battle-top-bar flex items-center justify-between border-b border-[#18191c] bg-[#2f3136] px-2 py-1.5 md:px-4 md:py-2'},Eg={class:'flex items-center gap-2 md:gap-4'},$g={class:'flex items-center gap-1 rounded-lg bg-[#202225] px-2 py-1 md:px-3'},Dg={class:'text-sm font-bold text-yellow-400 md:text-base'},Pg={class:'flex items-center gap-2 text-xs md:text-sm'},Ng={class:'flex items-center gap-1'},Rg={class:'text-gray-300'},jg={class:'flex items-center gap-1'},Lg={class:'text-gray-300'},Bg={class:'flex items-center gap-1 md:gap-2'},Og=['title'],qg=['title'];const Ug=Za({name:'BattleTopBar',props:{currentWave:{type:Number,default:1},totalWaves:{type:Number,default:1},enemyCount:{type:Number,default:0},allyCount:{type:Number,default:1}},emits:['speed-change','auto-toggle'],setup(e,{emit:t}){const a=Ll.serviceLocator.get('EventBus'),s=Ll.serviceLocator.get('BattleService'),n=$t(!1),r=$t(!1),l=e=>{n.value=2===e.multiplier},o=e=>{r.value=e.enabled};return us(()=>{a.on('battle:speed_change',l),a.on('battle:auto_toggle',o),n.value=2===s.getSpeedMultiplier(),r.value=s.getAutoBattle()}),gs(()=>{a.off('battle:speed_change',l),a.off('battle:auto_toggle',o)}),{isSpeedUp:n,isAutoBattle:r,toggleSpeed:()=>{n.value=!n.value;const e=n.value?2:1;t('speed-change',e),a.emit('battle:speed_change',{multiplier:e})},toggleAuto:()=>{r.value=!r.value,t('auto-toggle',r.value),a.emit('battle:auto_toggle',{enabled:r.value})}}}}),Vg=(0,$u.A)(Ug,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',Mg,[Rn(' Left: Wave Info '),Mn('div',Eg,[Rn(' Wave Badge '),Mn('div',$g,[t[2]||(t[2]=Mn('span',{class:'text-xs font-bold text-gray-400 md:text-sm'},'Wave',-1)),Mn('span',Dg,oe(e.currentWave)+'/'+oe(e.totalWaves),1)]),Rn(' Unit Counts '),Mn('div',Pg,[Mn('span',Ng,[t[3]||(t[3]=Mn('span',{class:'text-red-400'},'⚔️',-1)),Mn('span',Rg,'x'+oe(e.enemyCount),1)]),t[5]||(t[5]=Mn('span',{class:'text-gray-600'},'|',-1)),Mn('span',jg,[t[4]||(t[4]=Mn('span',{class:'text-blue-400'},'🛡️',-1)),Mn('span',Lg,'x'+oe(e.allyCount),1)])])]),Rn(' Right: Control Buttons '),Mn('div',Bg,[Rn(' Speed Toggle Button '),Mn('button',{class:ee(['top-bar-btn flex h-8 w-8 items-center justify-center rounded-lg transition-all duration-200 md:h-9 md:w-9',e.isSpeedUp?'active':'inactive']),title:e.isSpeedUp?'2倍速 (点击切换为1倍速)':'1倍速 (点击切换为2倍速)',onClick:t[0]||(t[0]=(...t)=>e.toggleSpeed&&e.toggleSpeed(...t))},[...t[6]||(t[6]=[Mn('span',{class:'text-lg md:text-xl'},'⏩',-1)])],10,Og),Rn(' Auto Battle Toggle Button '),Mn('button',{class:ee(['top-bar-btn flex h-8 w-8 items-center justify-center rounded-lg transition-all duration-200 md:h-9 md:w-9',e.isAutoBattle?'active':'inactive']),title:e.isAutoBattle?'自动战斗中 (点击关闭)':'手动操作 (点击开启自动战斗)',onClick:t[1]||(t[1]=(...t)=>e.toggleAuto&&e.toggleAuto(...t))},[...t[7]||(t[7]=[Mn('span',{class:'text-lg md:text-xl'},'🔄',-1)])],10,qg)])])}],['__scopeId','data-v-732e41ce']]),Fg={class:'flex items-center gap-3'},Hg={class:'flex-1'},Gg={class:'text-lg font-bold text-white sm:text-xl'},zg={class:'mt-1 flex items-center gap-2'},Wg={class:'text-xs text-gray-300'},Qg={key:0,class:'rounded bg-black/30 px-1.5 py-0.5 text-[10px] text-gray-400'},Xg={class:'modal-content custom-scrollbar'},Yg={class:'content-section'},Kg={class:'space-y-3'},Jg={class:'space-y-1'},Zg={class:'relative h-5 w-full overflow-hidden rounded-lg bg-gray-800'},eh={class:'absolute inset-0 flex items-center justify-center text-xs font-bold text-white drop-shadow-lg'},th={key:0,class:'space-y-1'},ah={class:'relative h-4 w-full overflow-hidden rounded-lg bg-gray-800/50'},sh={class:'absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white drop-shadow-lg'},nh={key:1,class:'space-y-1'},rh={class:'relative h-4 w-full overflow-hidden rounded-lg bg-gray-800'},lh={class:'absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white drop-shadow-lg'},oh={key:2,class:'space-y-1'},ih={class:'relative h-4 w-full overflow-hidden rounded-lg bg-gray-800'},ch={class:'absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white drop-shadow-lg'},dh={key:0,class:'content-section'},uh={class:'grid grid-cols-3 gap-2'},ph={class:'text-xs text-gray-400'},mh={key:1,class:'content-section'},gh={class:'flex flex-wrap gap-2'},hh=['title'],fh={class:'text-base'},vh={key:0,class:'font-bold'},yh={key:1,class:'text-xs text-gray-400'},bh={key:2,class:'content-section'},xh={class:'flex flex-wrap gap-2'},wh=['title'],kh={class:'text-base'},Sh={key:0,class:'font-bold'},_h={key:1,class:'text-xs text-gray-400'},Ch={key:3,class:'content-section'},Ih={key:4,class:'content-section'},Th={class:'space-y-2'},Ah={class:'text-xl'},Mh={class:'flex-1'},Eh={class:'text-sm text-gray-200'},$h={key:0,class:'text-xs text-yellow-500'},Dh={key:0,class:'text-center text-xs text-gray-500'},Ph={key:5,class:'content-section'},Nh={class:'flex items-center gap-3 rounded-lg border border-yellow-900/50 bg-yellow-900/20 px-3 py-2'},Rh={class:'text-2xl'},jh={class:'text-sm text-yellow-200'},Lh={key:6,class:'content-section'},Bh={class:'flex flex-wrap gap-2'},Oh={class:'modal-footer'};const qh=['src'];const Uh=Za({name:'AvatarDisplay',inheritAttrs:!1,props:{avatar:{type:String,default:''},name:{type:String,default:''},size:{type:String,default:'md'},clickable:{type:Boolean,default:!1},bgColor:{type:String,default:''}},setup(e){const t=$t(!1),a=ir(()=>!(!e.avatar||t.value)&&(e.avatar.startsWith('data:image/')||e.avatar.startsWith('http://')||e.avatar.startsWith('https://')||e.avatar.startsWith('/user/images/')||e.avatar.startsWith('user/images/'))),s=ir(()=>a.value||!e.avatar?'':e.avatar),n=ir(()=>s.value||a.value?'':e.name?e.name.charAt(0).toUpperCase():''),r=ir(()=>{const t={xs:'h-6 w-6',sm:'h-8 w-8',md:'h-10 w-10',lg:'h-12 w-12',xl:'h-16 w-16','2xl':'h-24 w-24'};return t[e.size]||t.md}),l=ir(()=>{const t={xs:'text-sm',sm:'text-base',md:'text-xl',lg:'text-2xl',xl:'text-3xl','2xl':'text-5xl'};return t[e.size]||t.md}),o=ir(()=>{const t={xs:'text-xs',sm:'text-sm',md:'text-base',lg:'text-lg',xl:'text-xl','2xl':'text-3xl'};return t[e.size]||t.md}),i=ir(()=>{const t={xs:'h-3 w-3',sm:'h-4 w-4',md:'h-5 w-5',lg:'h-6 w-6',xl:'h-8 w-8','2xl':'h-10 w-10'};return t[e.size]||t.md}),c=ir(()=>a.value?{}:{backgroundColor:e.bgColor||'#40444b'});return{isImageUrl:a,displayAvatar:s,fallbackLetter:n,sizeClass:r,emojiSizeClass:l,letterSizeClass:o,iconSizeClass:i,backgroundStyle:c,handleImageError:()=>{t.value=!0}}}}),Vh=(0,$u.A)(Uh,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',On({class:['avatar-display flex items-center justify-center overflow-hidden rounded-full',[e.sizeClass,{'cursor-pointer':e.clickable}]],style:e.backgroundStyle},e.$attrs),[Rn(' Image Avatar '),e.isImageUrl?(yn(),Sn('img',{key:0,src:e.avatar,alt:'Avatar',class:'avatar-image h-full w-full object-cover',onError:t[0]||(t[0]=(...t)=>e.handleImageError&&e.handleImageError(...t))},null,40,qh)):e.displayAvatar?(yn(),Sn(pn,{key:1},[Rn(' Emoji Avatar '),Mn('span',{class:ee(e.emojiSizeClass)},oe(e.displayAvatar),3)],2112)):e.fallbackLetter?(yn(),Sn(pn,{key:2},[Rn(' Fallback: First letter of name or default icon '),Mn('span',{class:ee([e.letterSizeClass,'font-bold text-gray-400'])},oe(e.fallbackLetter),3)],2112)):(yn(),Sn(pn,{key:3},[Rn(' Default Icon '),(yn(),Sn('svg',{class:ee(['opacity-50',e.iconSizeClass]),fill:'currentColor',viewBox:'0 0 20 20'},[...t[1]||(t[1]=[Mn('path',{'fill-rule':'evenodd',d:'M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z','clip-rule':'evenodd'},null,-1)])],2))],2112))],16)}],['__scopeId','data-v-1c57ac4f']]),Fh=Za({name:'CombatantDetailPopover',components:{AvatarDisplay:Vh},props:{combatant:{type:Object,required:!0},visible:{type:Boolean,default:!1}},emits:['close'],setup(e,{emit:t}){const a=$t(null),s=$t(0),n=$t(0),r=$t(!1),l=$t(0),o=()=>{r.value=!1,l.value=0,s.value=0,n.value=0};_a(()=>e.visible,e=>{e||o()});const i=ir(()=>l.value>0?{transform:`translateY(${l.value}px)`,transition:r.value?'none':'transform 0.2s ease-out'}:{}),c=ir(()=>e.combatant.isPlayer||e.combatant.isAlly),d=ir(()=>{if(e.combatant.isPlayer)return'玩家';if(e.combatant.isAlly){return{companion:'同伴',mercenary:'雇佣兵',npc:'NPC'}[e.combatant.allyType||'']||'队友'}return e.combatant.isSummon?'召唤物':'敌人'}),u=ir(()=>e.combatant.isPlayer?'header-player':e.combatant.isAlly?'header-ally':'header-enemy'),p=ir(()=>e.combatant.isPlayer?'border-blue-500 bg-blue-900':e.combatant.isAlly?'border-green-500 bg-green-900':'border-red-500 bg-red-900'),m=ir(()=>e.combatant.stats.hp.current/e.combatant.stats.hp.max*100),g=ir(()=>!e.combatant.stats.mp||e.combatant.stats.mp.max<=0?0:e.combatant.stats.mp.current/e.combatant.stats.mp.max*100),h=ir(()=>!e.combatant.stats.sp||e.combatant.stats.sp.max<=0?0:e.combatant.stats.sp.current/e.combatant.stats.sp.max*100),f=ir(()=>e.combatant.shields?e.combatant.shields.filter(e=>'value'===e.type).reduce((e,t)=>e+t.value,0):0),v=ir(()=>f.value<=0?0:Math.min(100,f.value/e.combatant.stats.hp.max*100)),y=ir(()=>(e.combatant.statusEffects||[]).filter(e=>fg(e))),b=ir(()=>(e.combatant.statusEffects||[]).filter(e=>!fg(e))),x=ir(()=>e.combatant.attributes&&Object.keys(e.combatant.attributes).length>0),w=ir(()=>{const t={},a=['STR','DEX','CON','INT','WIS','CHA'];for(const s of a)void 0===e.combatant.attributes[s]&&void 0===e.combatant.attributes[s.toLowerCase()]||(t[s]=pg(s));return t}),k=ir(()=>!!e.combatant.resistances&&Object.values(e.combatant.resistances).some(e=>0!==e)),S=ir(()=>{if(!e.combatant.resistances)return{};const t={};for(const[a,s]of Object.entries(e.combatant.resistances))0!==s&&(t[a]=s);return t});return gs(()=>{o()}),{modalRef:a,modalDragStyle:i,isAllyUnit:c,unitTypeLabel:d,headerBgClass:u,avatarBorderClass:p,hpPercent:m,mpPercent:g,spPercent:h,totalShield:f,shieldPercent:v,buffEffects:y,debuffEffects:b,hasAttributes:x,displayAttributes:w,getAttrValue:t=>e.combatant.attributes[t]||e.combatant.attributes[t.toLowerCase()]||0,hasResistances:k,displayResistances:S,getIntentIcon:e=>gg(e),getIntentText:e=>({attack:'准备攻击',defend:'准备防御',buff:'准备强化',debuff:'准备削弱',ultimate:'准备必杀技！',heal:'准备治疗',summon:'准备召唤',wait:'观望中...'}[e]||'???'),getStatusEmoji:mg,getStatusTooltip:hg,getDamageEmoji:ug,handleTouchStart:e=>{window.innerWidth>=640||(s.value=e.touches[0].clientY,r.value=!0)},handleTouchMove:e=>{if(!r.value)return;if(window.innerWidth>=640)return;n.value=e.touches[0].clientY;const t=n.value-s.value;t>0&&(l.value=.6*t,e.preventDefault())},handleTouchEnd:()=>{r.value&&(window.innerWidth>=640||(l.value>100&&t('close'),o()))}}}}),Hh=(0,$u.A)(Fh,[['render',function(e,t,a,s,n,r){const l=fs('AvatarDisplay');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'combatant-detail-overlay',onClick:t[5]||(t[5]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',{ref:'modalRef',class:'combatant-detail-modal',style:X(e.modalDragStyle),onTouchstart:t[2]||(t[2]=(...t)=>e.handleTouchStart&&e.handleTouchStart(...t)),onTouchmove:t[3]||(t[3]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t)),onTouchend:t[4]||(t[4]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Rn(' Swipe Handle (移动端下滑提示) '),t[9]||(t[9]=Mn('div',{class:'swipe-handle sm:hidden'},[Mn('div',{class:'handle-bar'})],-1)),Rn(' Header '),Mn('div',{class:ee(['modal-header',e.headerBgClass])},[Mn('div',Fg,[Rn(' Avatar '),En(l,{avatar:e.combatant.avatar||e.combatant.base?.avatar,name:e.combatant.name,size:'lg',class:ee(['border-2',e.avatarBorderClass])},null,8,['avatar','name','class']),Rn(' Title + Info '),Mn('div',Hg,[Mn('h2',Gg,oe(e.combatant.name),1),Mn('div',zg,[Mn('span',Wg,'Lv.'+oe(e.combatant.level||'?'),1),e.unitTypeLabel?(yn(),Sn('span',Qg,oe(e.unitTypeLabel),1)):Rn('v-if',!0)])]),Rn(' Close Button '),Mn('button',{class:'flex h-8 w-8 items-center justify-center rounded-full bg-black/30 text-white transition-colors hover:bg-black/50',onClick:t[0]||(t[0]=t=>e.$emit('close'))},' ✕ ')])],2),Rn(' Content '),Mn('div',Xg,[Rn(' Resources Section '),Mn('section',Yg,[Mn('div',Kg,[Rn(' HP '),Mn('div',Jg,[Mn('div',Zg,[Mn('div',{class:'absolute inset-0 bg-gradient-to-r from-red-700 to-red-500',style:X({width:e.hpPercent+'%'})},null,4),Mn('div',eh,' ❤️ '+oe(Math.floor(e.combatant.stats.hp.current))+' / '+oe(e.combatant.stats.hp.max),1)])]),Rn(' Shield (if any) '),e.totalShield>0?(yn(),Sn('div',th,[Mn('div',ah,[Mn('div',{class:'absolute inset-0 bg-cyan-400',style:X({width:e.shieldPercent+'%'})},null,4),Mn('div',sh,' 🪩 '+oe(e.totalShield),1)])])):Rn('v-if',!0),Rn(' MP (if has) '),e.combatant.stats.mp&&e.combatant.stats.mp.max>0?(yn(),Sn('div',nh,[Mn('div',rh,[Mn('div',{class:'absolute inset-0 bg-blue-600',style:X({width:e.mpPercent+'%'})},null,4),Mn('div',lh,' 💙 '+oe(Math.floor(e.combatant.stats.mp.current))+' / '+oe(e.combatant.stats.mp.max),1)])])):Rn('v-if',!0),Rn(' SP (if has) '),e.combatant.stats.sp&&e.combatant.stats.sp.max>0?(yn(),Sn('div',oh,[Mn('div',ih,[Mn('div',{class:'absolute inset-0 bg-green-600',style:X({width:e.spPercent+'%'})},null,4),Mn('div',ch,' 💚 '+oe(Math.floor(e.combatant.stats.sp.current))+' / '+oe(e.combatant.stats.sp.max),1)])])):Rn('v-if',!0)])]),Rn(' Attributes '),e.hasAttributes?(yn(),Sn('section',dh,[Mn('div',uh,[(yn(!0),Sn(pn,null,xs(e.displayAttributes,(t,a)=>(yn(),Sn('div',{key:a,class:'flex items-center justify-between rounded-lg bg-[#36393f] px-2 py-1.5'},[Mn('span',ph,oe(t.name),1),Mn('span',{class:'text-sm font-bold',style:X({color:t.color})},oe(e.getAttrValue(a)),5)]))),128))])])):Rn('v-if',!0),Rn(' Buffs Section '),e.buffEffects.length>0?(yn(),Sn('section',mh,[t[6]||(t[6]=Mn('h3',{class:'section-title text-green-500'},'✨ 增益效果',-1)),Mn('div',gh,[(yn(!0),Sn(pn,null,xs(e.buffEffects,t=>(yn(),Sn('div',{key:t.id,class:'flex items-center gap-1.5 rounded-lg bg-green-900/40 px-2 py-1 text-sm text-green-300',title:e.getStatusTooltip(t)},[Mn('span',fh,oe(e.getStatusEmoji(t)),1),Mn('span',null,oe(t.name),1),t.stacks>1?(yn(),Sn('span',vh,'x'+oe(t.stacks),1)):Rn('v-if',!0),-1!==t.duration?(yn(),Sn('span',yh,'('+oe(t.duration)+')',1)):Rn('v-if',!0)],8,hh))),128))])])):Rn('v-if',!0),Rn(' Debuffs Section '),e.debuffEffects.length>0?(yn(),Sn('section',bh,[t[7]||(t[7]=Mn('h3',{class:'section-title text-red-500'},'💀 减益效果',-1)),Mn('div',xh,[(yn(!0),Sn(pn,null,xs(e.debuffEffects,t=>(yn(),Sn('div',{key:t.id,class:'flex items-center gap-1.5 rounded-lg bg-red-900/40 px-2 py-1 text-sm text-red-300',title:e.getStatusTooltip(t)},[Mn('span',kh,oe(e.getStatusEmoji(t)),1),Mn('span',null,oe(t.name),1),t.stacks>1?(yn(),Sn('span',Sh,'x'+oe(t.stacks),1)):Rn('v-if',!0),-1!==t.duration?(yn(),Sn('span',_h,'('+oe(t.duration)+')',1)):Rn('v-if',!0)],8,wh))),128))])])):Rn('v-if',!0),Rn(' No Status Effects Message '),0===e.buffEffects.length&&0===e.debuffEffects.length?(yn(),Sn('section',Ch,[...t[8]||(t[8]=[Mn('div',{class:'rounded-lg bg-[#36393f] p-3 text-center text-sm text-gray-500'},'无状态效果',-1)])])):Rn('v-if',!0),Rn(' Skills '),e.combatant.skills&&Object.keys(e.combatant.skills).length>0?(yn(),Sn('section',Ih,[Mn('div',Th,[(yn(!0),Sn(pn,null,xs(Object.entries(e.combatant.skills).slice(0,6),([e,t])=>(yn(),Sn('div',{key:e,class:'flex items-center gap-3 rounded-lg bg-[#36393f] px-3 py-2'},[Mn('span',Ah,oe(t.icon||'⚡'),1),Mn('div',Mh,[Mn('span',Eh,oe(t.name),1)]),t.currentCooldown&&t.currentCooldown>0?(yn(),Sn('span',$h,' CD: '+oe(t.currentCooldown),1)):Rn('v-if',!0)]))),128)),Object.keys(e.combatant.skills).length>6?(yn(),Sn('div',Dh,' +'+oe(Object.keys(e.combatant.skills).length-6)+' 更多技能... ',1)):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' Next Action Intent (for enemies only) '),!e.isAllyUnit&&e.combatant.nextAction?(yn(),Sn('section',Ph,[Mn('div',Nh,[Mn('span',Rh,oe(e.getIntentIcon(e.combatant.nextAction.type)),1),Mn('span',jh,oe(e.combatant.nextAction.description||e.getIntentText(e.combatant.nextAction.type)),1)])])):Rn('v-if',!0),Rn(' Resistances (if any) '),e.hasResistances?(yn(),Sn('section',Lh,[Mn('div',Bh,[(yn(!0),Sn(pn,null,xs(e.displayResistances,(t,a)=>(yn(),Sn('div',{key:a,class:ee(['flex items-center gap-1 rounded-lg px-2 py-1 text-sm',t>0?'bg-green-900/30 text-green-400':'bg-red-900/30 text-red-400'])},[Mn('span',null,oe(e.getDamageEmoji(a)),1),Mn('span',null,oe(t>0?'+':'')+oe(t)+'%',1)],2))),128))])])):Rn('v-if',!0)]),Rn(' Footer '),Mn('div',Oh,[Mn('button',{class:'action-btn close-btn',onClick:t[1]||(t[1]=t=>e.$emit('close'))},'关闭')])],36)])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-46d08669']]),Gh={key:0,class:'dice-overlay show'},zh=['data-value'],Wh=['data-value'],Qh=Za({name:'DiceAnimation',setup(e,{expose:t}){const a=$t(!1),s=$t([]),n=$t(''),r=$t(''),l=$t(null),o=$t(null),i=$t(null);return t({roll:(e,t)=>{a.value=!0,n.value='',r.value='';const c=void 0!==t?Math.max(1,Math.min(20,Math.round(t))):Math.floor(20*Math.random())+1,d=new Array(20).fill(0).map((_,e)=>10===e?1:e<10?e+2:e+1);s.value=d,Zt(()=>{if(!o.value||!l.value||!i.value)return;const t=o.value,d=l.value,u=i.value;t.className='dice-icosahedron',u.className='dice-result-text';const p=1e3,m=[],g=[];for(let e=0;e<=60;e++){const t=e/60,a=(1-Math.pow(1-t,1.2))*Math.PI*2,s=-65*Math.sin(a),n=-30*Math.sin(2*a);m.push({transform:`translateX(${s}px) translateY(${n}px)`,offset:t});const r=1080*Math.sin(a),l=900*Math.sin(a),o=360*Math.sin(a)+45*Math.sin(2*a);g.push({transform:`rotateX(${r}deg) rotateY(${l}deg) rotateZ(${o}deg)`,offset:t})}d.animate(m,{duration:p,easing:'linear',fill:'forwards'});const h=t.animate(g,{duration:p,easing:'linear',fill:'forwards'});setTimeout(()=>{const e=Array.from({length:20},(_,e)=>e+1),t=e.indexOf(c);e.splice(t,1);for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}const a=[...s.value];let n=0;for(let t=0;t<20;t++)a[t]=10===t?c:e[n++];s.value=a},400),h.onfinish=()=>{t.animate([{transform:'rotateX(0deg) rotateY(0deg) rotateZ(0deg)'},{transform:'rotateX(2deg) rotateY(0deg) rotateZ(-2deg)'},{transform:'rotateX(0deg) rotateY(0deg) rotateZ(0deg)'}],{duration:250,easing:'ease-out',fill:'forwards'}).onfinish=()=>{20===c?(n.value='致命一击！',r.value='crit show'):1===c?(n.value='大失败！',r.value='fumble show'):(n.value=`点数: ${c}`,r.value='show'),setTimeout(()=>{a.value=!1,e(c)},1200)}}})}}),(e,t)=>a.value?(yn(),Sn('div',Gh,[Mn('div',{ref_key:'containerRef',ref:l,class:'dice-roller-container'},[Mn('div',{ref_key:'icosahedronRef',ref:o,class:'dice-icosahedron'},[Rn(' 面 1-10 (上) '),(yn(),Sn(pn,null,xs(10,e=>Mn('div',{key:`up-${e}`,class:ee(['face',`face-${e}`,'up']),'data-value':s.value[e-1]},null,10,zh)),64)),Rn(' 面 11-20 (下) '),(yn(),Sn(pn,null,xs(10,e=>Mn('div',{key:`down-${e}`,class:ee(['face',`face-${e+10}`,'down']),'data-value':s.value[e+9]},null,10,Wh)),64))],512)],512),Mn('div',{ref_key:'resultTextRef',ref:i,class:ee(['dice-result-text',r.value])},oe(n.value),3)])):Rn('v-if',!0)}}),Xh=(0,$u.A)(Qh,[['__scopeId','data-v-4d58fc00']]),Yh={class:'skill-effect-layer pointer-events-none absolute inset-0 z-20 overflow-hidden'};const Kh={physical:{bg:'rgba(239, 68, 68, 0.8)',text:'#ef4444'},slashing:{bg:'rgba(239, 68, 68, 0.8)',text:'#ef4444'},bludgeoning:{bg:'rgba(234, 88, 12, 0.8)',text:'#ea580c'},piercing:{bg:'rgba(220, 38, 38, 0.8)',text:'#dc2626'},fire:{bg:'rgba(249, 115, 22, 0.8)',text:'#f97316'},water:{bg:'rgba(59, 130, 246, 0.8)',text:'#3b82f6'},ice:{bg:'rgba(34, 211, 238, 0.8)',text:'#22d3ee'},lightning:{bg:'rgba(168, 85, 247, 0.8)',text:'#a855f7'},wind:{bg:'rgba(74, 222, 128, 0.8)',text:'#4ade80'},earth:{bg:'rgba(161, 98, 7, 0.8)',text:'#a16207'},metal:{bg:'rgba(148, 163, 184, 0.8)',text:'#94a3b8'},wood:{bg:'rgba(34, 197, 94, 0.8)',text:'#22c55e'},light:{bg:'rgba(250, 204, 21, 0.8)',text:'#facc15'},dark:{bg:'rgba(88, 28, 135, 0.8)',text:'#581c87'},poison:{bg:'rgba(132, 204, 22, 0.8)',text:'#84cc16'},psychic:{bg:'rgba(236, 72, 153, 0.8)',text:'#ec4899'},sonic:{bg:'rgba(6, 182, 212, 0.8)',text:'#06b6d4'},force:{bg:'rgba(99, 102, 241, 0.8)',text:'#6366f1'},void:{bg:'rgba(76, 29, 149, 0.8)',text:'#4c1d95'},true:{bg:'rgba(255, 255, 255, 0.9)',text:'#ffffff'},magic:{bg:'rgba(139, 92, 246, 0.8)',text:'#8b5cf6'},elemental:{bg:'rgba(139, 92, 246, 0.8)',text:'#8b5cf6'},special:{bg:'rgba(168, 85, 247, 0.8)',text:'#a855f7'},heal:{bg:'rgba(34, 197, 94, 0.8)',text:'#22c55e'}};function Jh(e){return e&&Kh[e]||Kh.physical}const Zh=Za({name:'SkillEffectLayer',setup(){const e=$t([]);return{activeEffects:e,showEffect:(t,a,s,n,r,l)=>{(t=>{const a=Date.now()+Math.random().toString();e.value.push({...t,id:a}),setTimeout(()=>{e.value=e.value.filter(e=>e.id!==a)},1e3)})({x:t,y:a,type:s,value:n,isCrit:r,damageType:l})},getEffectStyle:e=>{if('heal'===e.type)return{background:`radial-gradient(circle, ${Kh.heal.bg} 0%, transparent 70%)`};if('shield'===e.type)return{background:'radial-gradient(circle, rgba(34, 211, 238, 0.8) 0%, transparent 70%)'};return{background:`radial-gradient(circle, ${Jh(e.damageType).bg} 0%, transparent 70%)`}},getTextStyle:e=>{if(e.isCrit){return{color:'#ffd700',textShadow:`2px 2px 4px ${Jh(e.damageType).text}`}}if('heal'===e.type)return{color:Kh.heal.text};return{color:Jh(e.damageType).text}}}}}),ef=(0,$u.A)(Zh,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',Yh,[En(ol,{name:'fade'},{default:ba(()=>[(yn(!0),Sn(pn,null,xs(e.activeEffects,t=>(yn(),Sn('div',{key:t.id,class:'absolute',style:X({left:t.x+'px',top:t.y+'px',transform:'translate(-50%, -50%)'})},[Mn('div',{class:ee(['effect-sprite',t.type]),style:X(e.getEffectStyle(t))},null,6),t.value?(yn(),Sn('div',{key:0,class:ee(['floating-text',t.isCrit?'crit':'']),style:X(e.getTextStyle(t))},oe(t.value),7)):Rn('v-if',!0)],4))),128))]),_:1})])}],['__scopeId','data-v-331054ae']]),tf=ef,af={class:'skill-modal w-full max-w-full rounded-t-xl border-x border-t border-gray-600 bg-[#2f3136] shadow-2xl md:mx-4 md:max-w-md md:rounded-xl md:border'},sf={class:'flex items-center justify-between rounded-t-xl border-b border-gray-700 bg-[#202225] px-3 py-2 md:px-4 md:py-3'},nf={class:'custom-scrollbar max-h-[50vh] overflow-y-auto p-2 md:max-h-96 md:p-4'},rf={key:0,class:'py-6 text-center text-xs text-gray-500 md:py-8 md:text-sm'},lf={key:1,class:'grid grid-cols-1 gap-1.5 md:gap-3'},of=['disabled','onClick'],cf={class:'min-w-0 flex-1'},df={class:'flex items-center justify-between gap-2'},uf={class:'truncate text-sm font-bold text-white md:text-base'},pf={class:'flex shrink-0 items-center gap-1'},mf={key:0,class:'rounded bg-yellow-900/50 px-1 py-0.5 text-[9px] font-bold text-yellow-400 md:px-1.5 md:text-[10px]'},gf={key:1,class:'flex items-center gap-0.5 text-[9px] text-gray-400 md:text-[10px]'},hf={key:2,class:'flex items-center gap-0.5 text-[9px] text-blue-400 md:hidden'},ff={key:3,class:'flex items-center gap-0.5 text-[9px] text-green-400 md:hidden'},vf={class:'mt-0.5 line-clamp-1 text-[10px] text-gray-400 md:line-clamp-2 md:text-xs'},yf={class:'mt-1 hidden items-center gap-2 md:flex'},bf={key:0,class:'flex items-center gap-0.5 text-[10px] text-blue-400'},xf={key:1,class:'flex items-center gap-0.5 text-[10px] text-green-400'},wf={key:2,class:'flex items-center gap-0.5 text-[10px] font-bold text-yellow-400'},kf={key:3,class:'flex items-center gap-0.5 text-[10px] text-gray-500'},Sf={class:'rounded-b-xl border-t border-gray-700 bg-[#202225]/50 px-3 py-2 md:px-4 md:py-3'};const _f=Za({name:'SkillSelectModal',props:{visible:{type:Boolean,default:!1},skills:{type:Object,default:()=>({})},playerStats:{type:Object,default:()=>({hp:{current:100,max:100},mp:{current:50,max:50},sp:{current:100,max:100}})}},emits:['close','select'],setup(e,{emit:t}){const a=ir(()=>Object.entries(e.skills).filter(([_,e])=>'active'===e.type)),s=e=>{if(!e.cost)return 0;const t=e.cost;return'mp'===t.type?t.val||0:t.mp||0},n=e=>{if(!e.cost)return 0;const t=e.cost;return'sp'===t.type?t.val||0:t.sp||0},r=t=>{if(t.currentCooldown&&t.currentCooldown>0)return!1;const a=s(t),r=n(t);return!(a>e.playerStats.mp.current)&&!(r>e.playerStats.sp.current)};return{handleClose:()=>{t('close')},activeSkills:a,selectSkill:e=>{r(e)&&t('select',e)},canUseSkill:r,getSkillCardClass:e=>r(e)?'border-gray-600 bg-[#36393f] hover:border-blue-500 hover:bg-[#404449] cursor-pointer':'border-gray-700 bg-gray-800/50 opacity-50 cursor-not-allowed',getIconClass:e=>{if(!r(e))return'border-gray-700 bg-gray-800 text-gray-500';const t=e.tags||[];if(t.length>0){Zl(t[0]);return'border-2 bg-opacity-30 text-opacity-100'}return'border-gray-600 bg-gray-800/50 text-gray-300'},getIconStyle:e=>{if(!r(e))return{};const t=e.tags||[];if(t.length>0){const e=Zl(t[0]);return{borderColor:e,backgroundColor:`${e}30`,color:e}}return{}},getSkillMpCost:s,getSkillSpCost:n,getSkillDescription:e=>{if(!e.effects||0===e.effects.length)return'使用此技能';const t=Io.translateSkill(e);if(t.effects.length>1){const t=e.effects.map((e,t)=>Io.getEffectPreview(e));return t.join('；')}return t.mainEffect}}}}),Cf=Za({name:'BattleView',components:{BattleTopBar:Vg,BattleLogDrawer:Ag,SkillSelectModal:(0,$u.A)(_f,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'skill-modal-overlay fixed inset-0 z-50 flex items-end justify-center bg-black/70 backdrop-blur-sm md:items-center',onClick:t[2]||(t[2]=Cl((...t)=>e.handleClose&&e.handleClose(...t),['self']))},[Mn('div',af,[Rn(' Header (更紧凑) '),Mn('div',sf,[t[3]||(t[3]=Mn('div',{class:'flex items-center gap-1.5'},[Mn('span',{class:'text-lg md:text-xl'},'✨'),Mn('h3',{class:'text-sm font-bold text-white md:text-lg'},'选择技能')],-1)),Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full text-sm text-gray-400 transition-colors hover:bg-gray-700 hover:text-white md:h-7 md:w-7',onClick:t[0]||(t[0]=(...t)=>e.handleClose&&e.handleClose(...t))},' ✕ ')]),Rn(' Skill List (手机端更紧凑) '),Mn('div',nf,[0===e.activeSkills.length?(yn(),Sn('div',rf,' 暂无可用技能 ')):(yn(),Sn('div',lf,[(yn(!0),Sn(pn,null,xs(e.activeSkills,([a,s])=>(yn(),Sn('button',{key:a,class:ee(['skill-card group flex items-center gap-2 rounded-lg border p-2 text-left transition-all md:items-start md:gap-3 md:p-4',e.getSkillCardClass(s)]),disabled:!e.canUseSkill(s),onClick:t=>e.selectSkill(s)},[Rn(' Skill Icon (手机端更小) '),Mn('div',{class:ee(['flex h-8 w-8 shrink-0 items-center justify-center rounded-md border text-base md:h-12 md:w-12 md:rounded-lg md:text-2xl',e.getIconClass(s)]),style:X(e.getIconStyle(s))},oe(s.icon||'⚡'),7),Rn(' Skill Info '),Mn('div',cf,[Mn('div',df,[Mn('span',uf,oe(s.name),1),Mn('div',pf,[Rn(' Cooldown: 冷却中显示CD:X，否则显示预览 '),s.currentCooldown&&s.currentCooldown>0?(yn(),Sn('span',mf,' CD:'+oe(s.currentCooldown),1)):s.cooldown&&s.cooldown>0?(yn(),Sn('span',gf,' ⏱️'+oe(s.cooldown),1)):Rn('v-if',!0),Rn(' Cost badges (手机端显示在右侧) '),e.getSkillMpCost(s)>0?(yn(),Sn('span',hf,' 💙'+oe(e.getSkillMpCost(s)),1)):Rn('v-if',!0),e.getSkillSpCost(s)>0?(yn(),Sn('span',ff,' 💚'+oe(e.getSkillSpCost(s)),1)):Rn('v-if',!0)])]),Rn(' Description (手机端单行) '),Mn('p',vf,oe(s.description||e.getSkillDescription(s)),1),Rn(' Cost (桌面端显示) '),Mn('div',yf,[e.getSkillMpCost(s)>0?(yn(),Sn('span',bf,' 💙 '+oe(e.getSkillMpCost(s)),1)):Rn('v-if',!0),e.getSkillSpCost(s)>0?(yn(),Sn('span',xf,' 💚 '+oe(e.getSkillSpCost(s)),1)):Rn('v-if',!0),Rn(' 桌面端冷却显示：冷却中显示CD:X，否则显示预览 '),s.currentCooldown&&s.currentCooldown>0?(yn(),Sn('span',wf,' CD:'+oe(s.currentCooldown),1)):s.cooldown&&s.cooldown>0?(yn(),Sn('span',kf,' ⏱️ '+oe(s.cooldown)+'回合 ',1)):Rn('v-if',!0)])]),Rn(' Arrow indicator (手机端隐藏) '),t[4]||(t[4]=Mn('div',{class:'hidden shrink-0 text-gray-600 transition-transform group-hover:translate-x-1 group-hover:text-gray-400 md:block'},' → ',-1))],10,of))),128))]))]),Rn(' Footer (更紧凑) '),Mn('div',Sf,[Mn('button',{class:'w-full rounded-lg bg-gray-700 py-1.5 text-xs font-bold text-gray-300 transition-colors hover:bg-gray-600 md:py-2 md:text-sm',onClick:t[1]||(t[1]=(...t)=>e.handleClose&&e.handleClose(...t))},' 取消 ')])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-d870dc00']]),CombatantDetailPopover:Hh,DiceAnimation:Xh,SkillEffectLayer:tf},setup(){const e=Ll.serviceLocator.get('SaveService'),t=Ll.serviceLocator.get('BattleService'),a=Ll.serviceLocator.get('EventBus'),{confirm:s}=Xp(),n=$t(0),r=$t(window.innerWidth<768),l=()=>{r.value=window.innerWidth<768},o=$t(1),i=$t(!1),c=$t(!1),d=$t(null),u=$t(null),p=$t(null),m=ir(()=>p.value),g=ir(()=>{n.value;const t=e.getGameState();return t?.combat}),h=ir(()=>{n.value;const t=e.getGameState();if(t?.player)return{...t.player,stats:{hp:{...t.player.stats.hp},mp:{...t.player.stats.mp},sp:{...t.player.stats.sp}}}}),f=ir(()=>h.value?.statusEffects||[]),v=ir(()=>1),y=ir(()=>1),b=ir(()=>g.value?.enemies.filter(e=>!e.isDead).length||0),x=ir(()=>1+w.value.filter(e=>!e.isDead).length),w=ir(()=>{n.value;const e=g.value;return e?.allies?e.allies:[]}),k=ir(()=>{if(!S.value)return'请选择目标...';const{side:e}=yo(S.value.target||'enemy');return'enemy'===e?'请选择敌方目标...':'ally'===e?'请选择己方目标...':'请选择目标...'}),S=$t(null),C=$t(null),I=ir(()=>{n.value;const e=g.value;return e?void 0!==e.currentActorId&&null!==e.currentActorId?e.currentActorId:e.timeline&&Array.isArray(e.timeline)?e.timeline[e.currentTurnIndex]:null:null}),T=ir(()=>{if(i.value)return!1;const e=I.value;if(!e)return!1;if('player'===e)return!0;const t=g.value;return!!t?.allies&&t.allies.some(t=>t.id===e)}),A=ir(()=>'player'===I.value),M=ir(()=>{const e=I.value;if(!e)return null;if('player'===e)return Q();const t=g.value;if(t?.allies){const a=t.allies.find(t=>t.id===e);if(a)return a}return null}),E=ir(()=>{const e=M.value;return e&&e.skills||{}}),D=ir(()=>{const e=M.value;return e?e.stats:{hp:{current:0,max:1},mp:{current:0,max:1},sp:{current:0,max:1}}}),P=()=>{n.value++},N=e=>{o.value>=2||d.value&&d.value.roll(()=>{},e.diceResult)},R=$t(new Set),j=e=>{const t=e.target?.id;if(t&&(R.value.add(t),setTimeout(()=>{R.value.delete(t)},500),u.value)){const a=document.getElementById(`combatant-${t}`);if(a){const t=a.getBoundingClientRect(),s=document.querySelector('.battle-view');if(s){const a=s.getBoundingClientRect(),n=t.left+t.width/2-a.left,r=t.top+t.height/2-a.top,l=e.damage?.damageType;u.value.showEffect(n,r,'slash',e.actualDamage,e.damage?.isCrit,l)}}}},L=e=>{i.value=e.enabled};us(()=>{window.addEventListener('resize',l),a.on('combat:state_update',P),a.on('combat:start',P),a.on('combat:end',P),a.on('combat:roll_dice',N),a.on('combat:damage',j),a.on('battle:auto_toggle',L),i.value=t.getAutoBattle(),o.value=t.getSpeedMultiplier()}),gs(()=>{window.removeEventListener('resize',l),a.off('combat:state_update',P),a.off('combat:start',P),a.off('combat:end',P),a.off('combat:roll_dice',N),a.off('combat:damage',j),a.off('battle:auto_toggle',L)});const B=e=>e?.shields?e.shields.filter(e=>'value'===e.type).reduce((e,t)=>e+t.value,0):0,O=ir(()=>(n.value,h.value?.stats||{hp:{current:0,max:1},mp:{current:0,max:1},sp:{current:0,max:1}})),q=ir(()=>O.value.hp.current/O.value.hp.max*100),U=ir(()=>O.value.mp.current/O.value.mp.max*100),V=ir(()=>O.value.sp.current/O.value.sp.max*100),F=ir(()=>(n.value,Object.values(e.getGameState()?.skills||{}))),H=e=>{if(!S.value)return!1;if(e.isDead)return!1;const{side:t}=yo(S.value.target||'enemy'),a=e.isPlayer||e.isAlly;return('enemy'!==t||!a)&&(!('ally'===t&&!a)&&(C.value=e.id,G([e]),!0))},G=e=>{if(!S.value)return;const a=M.value;a&&(t.executeSkill(a,S.value,e),S.value=null,C.value=null)},W=()=>{S.value=null,C.value=null},Q=()=>{const e=h.value;return{id:'player',name:e.base.name,isPlayer:!0,avatar:e.base.avatar,base:e.base,level:e.base.level,stats:e.stats,attributes:e.attributes,skills:F.value,statusEffects:e.statusEffects||[],shields:e.shields||[],statModifiers:e.statModifiers||{},isDead:!1,isStunned:!1,hasActed:!1}};return{combatState:g,currentActorId:I,showActionBar:T,isPlayerTurn:A,currentActor:M,currentActorSkills:E,currentActorStats:D,shakingTargets:R,playerState:h,playerStats:O,playerSkills:F,playerHpPercent:q,playerMpPercent:U,playerSpPercent:V,playerStatusEffects:f,selectedSkill:S,selectedTargetId:C,showSkillModal:c,allyUnits:w,isMobile:r,detailCombatant:m,targetPromptText:k,currentWave:v,totalWaves:y,aliveEnemyCount:b,aliveAllyCount:x,speedMultiplier:o,isAutoBattle:i,diceAnimationRef:d,skillEffectLayerRef:u,getIntentIcon:e=>gg(e),getHpPercent:e=>e.stats.hp.current/e.stats.hp.max*100,getTotalShield:B,getShieldPercent:e=>{const t=B(e);return t<=0?0:Math.min(100,t/e.stats.hp.max*100)},getStatusEmoji:e=>mg(e),handleBasicAttack:()=>{const e=M.value;if(!e)return;const t=e.skills?.basic_attack||Object.values(e.skills||{}).find(e=>e.tags?.includes('basic'));if(t)return void(S.value=t);S.value={name:'普通攻击',type:'active',tier:1,tags:['physical','melee'],cooldown:0,target:'single_enemy',effects:[{trigger:'on_hit',action:'damage',target:'target',value:'1d4+STR',tags:['physical']}]}},handleDefend:()=>{const e=M.value;if(e){if(u.value){const t='player'===e.id?'combatant-player':`combatant-${e.id}`,a=document.getElementById(t);if(a){const e=a.getBoundingClientRect(),t=document.querySelector('.battle-view');if(t){const a=t.getBoundingClientRect(),s=e.left+e.width/2-a.left,n=e.top+e.height/2-a.top;u.value.showEffect(s,n,'shield','🛡️')}}}t.defend(e)}},handleFlee:()=>{const e=M.value;e&&t.attemptFlee(e)},openSkillModal:()=>{c.value=!0},closeSkillModal:()=>{c.value=!1},handleSkillSelect:e=>{c.value=!1,S.value=e;const{mode:t,side:a}=yo(e.target||'enemy'),s=M.value;if(s)if('self'===t)G([s]);else if('all'===t){if('enemy'===a)G(g.value?.enemies.filter(e=>!e.isDead)||[]);else if('ally'===a){const e=[Q(),...w.value.filter(e=>!e.isDead)];G(e)}}else if('random'===t)if('enemy'===a){const e=g.value?.enemies.filter(e=>!e.isDead)||[];if(e.length>0){const t=e[Math.floor(Math.random()*e.length)];G([t])}}else if('ally'===a){const e=[Q(),...w.value.filter(e=>!e.isDead)];if(e.length>0){const t=e[Math.floor(Math.random()*e.length)];G([t])}}},selectTarget:H,cancelSkill:W,handleBattlefieldClick:()=>{S.value&&W()},handleActionButtonClick:e=>{W(),e()},forceEndCombat:async()=>{if(await s('强制结束战斗','确定要强制结束战斗吗？这将清除所有战斗状态。',{variant:'danger',confirmText:'确定结束',cancelText:'取消'})){const t=e.getGameState();t&&(Object.values(t.skills).forEach(e=>{e.currentCooldown=0}),t.player.shields&&(t.player.shields=[]),t.combat=void 0,e.saveData(),n.value++,a.emit('combat:end',{result:'debug_exit'}))}},getPlayerCombatant:Q,handleSpeedChange:e=>{o.value=e,t.setSpeedMultiplier(e)},handleAutoToggle:e=>{i.value=e,t.setAutoBattle(e)},handleEnemyClick:(e,t)=>{if(S.value){if(H(e))return}p.value=e},handleAllyClick:(e,t)=>{if(S.value){if(H(e))return}p.value=e},closeDetailPopover:()=>{p.value=null},rollDice:e=>{d.value?d.value.roll(e):e(Math.floor(20*Math.random())+1)}}}}),If=(0,$u.A)(Cf,[['render',function(e,t,a,s,n,r){const l=fs('BattleTopBar'),o=fs('BattleLogDrawer'),i=fs('SkillSelectModal'),c=fs('CombatantDetailPopover'),d=fs('DiceAnimation'),u=fs('SkillEffectLayer');return e.combatState?(yn(),Sn('div',sm,[Rn(' Top Bar: Wave Info + Speed/Auto Controls '),En(l,{'current-wave':e.currentWave,'total-waves':e.totalWaves,'enemy-count':e.aliveEnemyCount,'ally-count':e.aliveAllyCount,onSpeedChange:e.handleSpeedChange,onAutoToggle:e.handleAutoToggle},null,8,['current-wave','total-waves','enemy-count','ally-count','onSpeedChange','onAutoToggle']),Rn(' Debug Button (Overlay) - 放在左上角避免与自动战斗按钮重合 '),e.combatState?.isDebugBattle?(yn(),Sn('div',nm,[Mn('button',{class:'flex items-center gap-1 rounded-full border border-gray-600 bg-black/40 px-2 py-1 text-xs text-gray-400 backdrop-blur-sm transition-colors hover:border-red-500 hover:text-red-300',title:'强制结束战斗 (Debug)',onClick:t[0]||(t[0]=(...t)=>e.forceEndCombat&&e.forceEndCombat(...t))},[...t[7]||(t[7]=[Mn('span',{class:'text-sm'},'🛠️',-1),Mn('span',{class:'hidden md:inline'},'强制退出',-1)])])])):Rn('v-if',!0),Rn(' Target Selection Prompt (固定在顶部，不影响布局) '),En(wr,{name:'slide-down'},{default:ba(()=>[e.selectedSkill?(yn(),Sn('div',rm,[Mn('span',lm,'🎯 '+oe(e.targetPromptText),1)])):Rn('v-if',!0)]),_:1}),Rn(' Battlefield (Scrollable) - 使用flex居中内容，点击空白取消选择 '),Mn('div',{class:'relative flex flex-1 flex-col justify-center overflow-y-auto bg-linear-to-b from-[#202225] to-[#2f3136] p-2 md:p-4',onClick:t[2]||(t[2]=Cl((...t)=>e.handleBattlefieldClick&&e.handleBattlefieldClick(...t),['self']))},[Rn(' Enemies Section '),Mn('div',om,[t[8]||(t[8]=Mn('div',{class:'mb-2 text-center text-[10px] font-bold tracking-wider text-gray-500 uppercase md:mb-4 md:text-xs'},' 敌方单位 ',-1)),Mn('div',im,[(yn(!0),Sn(pn,null,xs(e.combatState.enemies,t=>(yn(),Sn('div',{id:`combatant-${t.id}`,key:t.id,class:ee(['enemy-card group relative cursor-pointer transition-all duration-300',[t.isDead?'opacity-40 grayscale':'hover:-translate-y-1',e.selectedTargetId===t.id?'z-10 -translate-y-1':'',e.shakingTargets.has(t.id)?'animate-shake':'','w-[28%] max-w-28 md:w-28 lg:w-32']]),onClick:a=>e.handleEnemyClick(t,a)},[Rn(' Intent Icon '),!t.isDead&&t.nextAction?(yn(),Sn('div',dm,[Mn('span',um,oe(e.getIntentIcon(t.nextAction.type)),1)])):Rn('v-if',!0),Rn(' Quantity Badge '),t.quantity&&t.quantity>1?(yn(),Sn('div',pm,' x'+oe(t.quantity),1)):Rn('v-if',!0),Rn(' Card '),Mn('div',{class:ee(['overflow-hidden rounded-lg border bg-[#2f3136] shadow-lg transition-all',[e.selectedTargetId===t.id?'border-red-500 ring-2 ring-red-500/50':e.currentActorId===t.id?'border-yellow-500 ring-2 ring-yellow-400/50':'border-[#40444b] group-hover:border-gray-500']])},[Rn(' Name Header '),Mn('div',mm,[Mn('span',gm,oe(t.name),1),Mn('span',hm,'Lv.'+oe(t.level||'?'),1)]),Rn(' HP Bar with embedded value '),Mn('div',fm,[Mn('div',vm,[Mn('div',{class:'absolute inset-0 bg-linear-to-r from-red-800 to-red-600 transition-all duration-300',style:X({width:e.getHpPercent(t)+'%'})},null,4),Mn('div',ym,oe(Math.floor(t.stats.hp.current))+'/'+oe(t.stats.hp.max),1)]),Rn(' Shield bar (always reserve space to prevent layout jump) '),Mn('div',bm,[Mn('div',{class:'h-full bg-cyan-400 transition-all duration-300',style:X({width:e.getShieldPercent(t)+'%'})},null,4)]),Rn(' Status effects (fixed height to prevent layout jump) '),Mn('div',xm,[t.statusEffects.length>0?(yn(),Sn(pn,{key:0},[(yn(!0),Sn(pn,null,xs(t.statusEffects.slice(0,e.isMobile?3:5),t=>(yn(),Sn('span',{key:t.id,class:'text-[9px] md:text-[10px]',title:t.name},oe(e.getStatusEmoji(t)),9,wm))),128)),t.statusEffects.length>(e.isMobile?3:5)?(yn(),Sn('span',km,' +'+oe(t.statusEffects.length-(e.isMobile?3:5)),1)):Rn('v-if',!0)],64)):Rn('v-if',!0)])])],2)],10,cm))),128))])]),Rn(' Summons Section '),e.combatState.summons&&e.combatState.summons.length>0?(yn(),Sn('div',Sm,[t[9]||(t[9]=Mn('div',{class:'mb-2 text-center text-[10px] font-bold tracking-wider text-gray-500 uppercase md:mb-4 md:text-xs'},' 召唤单位 ',-1)),Mn('div',_m,[(yn(!0),Sn(pn,null,xs(e.combatState.summons,t=>(yn(),Sn('div',{key:t.id,class:ee(['group relative cursor-pointer transition-all duration-300',[t.isDead?'opacity-40 grayscale':'',e.currentActorId===t.id?'ring-2 ring-yellow-400/50':'','w-[22%] max-w-20 md:w-24']]),onClick:a=>t.isPlayer?null:e.selectTarget(t)},[Mn('div',{class:ee(['overflow-hidden rounded-lg border border-[#40444b] bg-[#2f3136] shadow-md',e.currentActorId===t.id?'border-yellow-500':''])},[Mn('div',Im,oe(t.name),1),Mn('div',Tm,[Mn('div',Am,[Mn('div',{class:'absolute inset-0 bg-green-500 transition-all duration-300',style:X({width:e.getHpPercent(t)+'%'})},null,4)])])],2)],10,Cm))),128))])])):Rn('v-if',!0),Rn(' Player/Allies Section '),Mn('div',Mm,[t[10]||(t[10]=Mn('div',{class:'mb-2 text-center text-[10px] font-bold tracking-wider text-gray-500 uppercase md:hidden'},' 我方单位 ',-1)),Mn('div',Em,[Rn(' Player Card '),Mn('div',{id:'combatant-player',class:ee(['player-card cursor-pointer transition-all duration-300',['player'===e.currentActorId?'-translate-y-1':'hover:-translate-y-1',e.shakingTargets.has('player')?'animate-shake':'','player'===e.selectedTargetId?'z-10 -translate-y-1':'','w-[45%] max-w-40 md:w-44 lg:w-48']]),onClick:t[1]||(t[1]=t=>e.handleAllyClick(e.getPlayerCombatant(),t))},[Mn('div',{class:ee(['overflow-hidden rounded-xl border bg-[#2f3136] shadow-xl transition-all',['player'===e.currentActorId?'border-yellow-500 ring-2 ring-yellow-400/50':'player'===e.selectedTargetId?'border-blue-500 ring-2 ring-blue-500/50':'border-blue-900/50 ring-1 ring-blue-900/30']])},[Rn(' Header '),Mn('div',$m,[Mn('span',Dm,oe(e.playerState?.base?.name||'Player'),1),Mn('span',Pm,'Lv.'+oe(e.playerState?.base?.level||1),1)]),Rn(' Body '),Mn('div',Nm,[Rn(' HP Bar with embedded value '),Mn('div',Rm,[Mn('div',{class:'absolute inset-0 bg-linear-to-r from-red-700 to-red-500 transition-all duration-300',style:X({width:e.playerHpPercent+'%'})},null,4),Mn('div',jm,' ❤️ '+oe(Math.floor(e.playerStats.hp.current))+'/'+oe(e.playerStats.hp.max),1)]),Rn(' Shield (always reserve space to prevent layout jump) '),Mn('div',Lm,[Mn('div',{class:'h-full bg-cyan-400 transition-all duration-300',style:X({width:e.getShieldPercent(e.getPlayerCombatant())+'%'})},null,4)]),Rn(' MP/SP in one row (like ally cards) '),Mn('div',Bm,[Mn('div',Om,[Mn('div',{class:'absolute inset-0 bg-blue-600 transition-all duration-300',style:X({width:e.playerMpPercent+'%'})},null,4)]),Mn('div',qm,[Mn('div',{class:'absolute inset-0 bg-green-600 transition-all duration-300',style:X({width:e.playerSpPercent+'%'})},null,4)])]),Rn(' Status effects (fixed height to prevent layout jump) '),Mn('div',Um,[e.playerStatusEffects.length>0?(yn(),Sn(pn,{key:0},[(yn(!0),Sn(pn,null,xs(e.playerStatusEffects.slice(0,6),t=>(yn(),Sn('span',{key:t.id,class:'text-[9px] md:text-[10px]',title:t.name},oe(e.getStatusEmoji(t)),9,Vm))),128)),e.playerStatusEffects.length>6?(yn(),Sn('span',Fm,' +'+oe(e.playerStatusEffects.length-6),1)):Rn('v-if',!0)],64)):Rn('v-if',!0)])])],2)],2),Rn(' Ally Cards '),(yn(!0),Sn(pn,null,xs(e.allyUnits,t=>(yn(),Sn('div',{id:`combatant-${t.id}`,key:t.id,class:ee(['ally-card cursor-pointer transition-all duration-300',[t.isDead?'opacity-40 grayscale':'hover:-translate-y-1',e.currentActorId===t.id?'-translate-y-1':'',e.selectedTargetId===t.id?'z-10 -translate-y-1':'',e.shakingTargets.has(t.id)?'animate-shake':'','w-[45%] max-w-40 md:w-40 lg:w-44']]),onClick:a=>e.handleAllyClick(t,a)},[Mn('div',{class:ee(['overflow-hidden rounded-xl border bg-[#2f3136] shadow-xl transition-all',[e.currentActorId===t.id?'border-yellow-500 ring-2 ring-yellow-400/50':e.selectedTargetId===t.id?'border-green-500 ring-2 ring-green-500/50':'border-green-900/50 ring-1 ring-green-900/30']])},[Mn('div',Gm,[Mn('span',zm,oe(t.name),1),Mn('span',Wm,'Lv.'+oe(t.level||1),1)]),Mn('div',Qm,[Rn(' HP Bar '),Mn('div',Xm,[Mn('div',{class:'absolute inset-0 bg-linear-to-r from-red-700 to-red-500 transition-all duration-300',style:X({width:e.getHpPercent(t)+'%'})},null,4),Mn('div',Ym,' ❤️ '+oe(Math.floor(t.stats.hp.current))+'/'+oe(t.stats.hp.max),1)]),Rn(' Shield (always reserve space to prevent layout jump) '),Mn('div',Km,[Mn('div',{class:'h-full bg-cyan-400 transition-all duration-300',style:X({width:e.getShieldPercent(t)+'%'})},null,4)]),Rn(' MP/SP in one row '),Mn('div',Jm,[Mn('div',Zm,[Mn('div',{class:'absolute inset-0 bg-blue-600 transition-all duration-300',style:X({width:(t.stats.mp?.current||0)/(t.stats.mp?.max||1)*100+'%'})},null,4)]),Mn('div',eg,[Mn('div',{class:'absolute inset-0 bg-green-600 transition-all duration-300',style:X({width:(t.stats.sp?.current||0)/(t.stats.sp?.max||1)*100+'%'})},null,4)])]),Rn(' Status effects for allies (fixed height to prevent layout jump) '),Mn('div',tg,[t.statusEffects&&t.statusEffects.length>0?(yn(),Sn(pn,{key:0},[(yn(!0),Sn(pn,null,xs(t.statusEffects.slice(0,4),t=>(yn(),Sn('span',{key:t.id,class:'text-[9px] md:text-[10px]',title:t.name},oe(e.getStatusEmoji(t)),9,ag))),128)),t.statusEffects.length>4?(yn(),Sn('span',sg,' +'+oe(t.statusEffects.length-4),1)):Rn('v-if',!0)],64)):Rn('v-if',!0)])])],2)],10,Hm))),128))])])]),Rn(' Battle Log Drawer '),En(o,{logs:e.combatState.logs||[]},null,8,['logs']),Rn(' Bottom Action Bar (固定高度，不会因提示而重绘) '),Mn('div',ng,[e.showActionBar?(yn(),Sn('div',rg,[Rn(' Main Actions: 普攻, 技能, 防御, 逃跑 - 使用固定高度 h-[52px] 保持一致 '),Mn('div',lg,[Mn('button',{class:'action-btn flex flex-col items-center justify-center gap-0.5 rounded-lg border border-gray-600 bg-[#36393f] py-2 text-xs font-bold text-gray-200 transition-all hover:border-gray-500 hover:bg-[#40444b] md:flex-row md:gap-2 md:py-2.5 md:text-sm',onClick:t[3]||(t[3]=t=>e.handleActionButtonClick(e.handleBasicAttack))},[...t[11]||(t[11]=[Mn('span',{class:'text-base md:text-lg'},'⚔️',-1),Mn('span',{class:'text-[10px] md:text-sm'},'普攻',-1)])]),Mn('button',{class:'action-btn flex flex-col items-center justify-center gap-0.5 rounded-lg border border-gray-600 bg-[#36393f] py-2 text-xs font-bold text-gray-200 transition-all hover:border-blue-500 hover:bg-[#40444b] md:flex-row md:gap-2 md:py-2.5 md:text-sm',onClick:t[4]||(t[4]=t=>e.handleActionButtonClick(e.openSkillModal))},[...t[12]||(t[12]=[Mn('span',{class:'text-base md:text-lg'},'✨',-1),Mn('span',{class:'text-[10px] md:text-sm'},'技能',-1)])]),Mn('button',{class:'action-btn flex flex-col items-center justify-center gap-0.5 rounded-lg border border-gray-600 bg-[#36393f] py-2 text-xs font-bold text-gray-200 transition-all hover:border-green-500 hover:bg-[#40444b] md:flex-row md:gap-2 md:py-2.5 md:text-sm',onClick:t[5]||(t[5]=t=>e.handleActionButtonClick(e.handleDefend))},[...t[13]||(t[13]=[Mn('span',{class:'text-base md:text-lg'},'🛡️',-1),Mn('span',{class:'text-[10px] md:text-sm'},'防御',-1)])]),Mn('button',{class:'action-btn flex flex-col items-center justify-center gap-0.5 rounded-lg border border-gray-600 bg-[#36393f] py-2 text-xs font-bold text-gray-200 transition-all hover:border-yellow-500 hover:bg-[#40444b] md:flex-row md:gap-2 md:py-2.5 md:text-sm',onClick:t[6]||(t[6]=t=>e.handleActionButtonClick(e.handleFlee))},[...t[14]||(t[14]=[Mn('span',{class:'text-base md:text-lg'},'🏃',-1),Mn('span',{class:'text-[10px] md:text-sm'},'逃跑',-1)])])])])):(yn(),Sn(pn,{key:1},[Rn(' 非玩家回合时显示等待信息，使用固定高度 h-[52px] 保持与按钮区一致 '),t[15]||(t[15]=Mn('div',{class:'flex h-[52px] items-center justify-center text-gray-500 md:h-[60px]'},[Mn('span',{class:'animate-pulse text-sm'},'等待行动...')],-1))],2112))]),Rn(' Skill Select Modal '),En(i,{visible:e.showSkillModal,skills:e.currentActorSkills,'player-stats':e.currentActorStats,onClose:e.closeSkillModal,onSelect:e.handleSkillSelect},null,8,['visible','skills','player-stats','onClose','onSelect']),Rn(' Combatant Detail Popover (for all unit types) '),e.detailCombatant?(yn(),_n(c,{key:1,combatant:e.detailCombatant,visible:!!e.detailCombatant,onClose:e.closeDetailPopover},null,8,['combatant','visible','onClose'])):Rn('v-if',!0),Rn(' Dice Animation '),En(d,{ref:'diceAnimationRef'},null,512),Rn(' Skill Effect Layer '),En(u,{ref:'skillEffectLayerRef'},null,512)])):Rn('v-if',!0)}],['__scopeId','data-v-594fc2cc']]),Tf={class:'relative mx-2 flex max-h-[50vh] w-full max-w-sm flex-col overflow-hidden rounded-xl border border-[#40444b] bg-[#36393f] shadow-2xl sm:mx-4 sm:max-w-md sm:rounded-2xl'},Af={class:'text-center'},Mf={key:0,class:'custom-scrollbar flex-1 space-y-2 overflow-y-auto p-3 sm:space-y-3 sm:p-4'},Ef={class:'grid grid-cols-2 gap-2 sm:gap-3'},$f={class:'flex flex-col items-center rounded-lg border border-blue-500/30 bg-blue-900/20 px-2 py-2 sm:px-3'},Df={class:'text-base font-bold text-blue-300 sm:text-lg'},Pf={class:'flex flex-col items-center rounded-lg border border-yellow-500/30 bg-yellow-900/20 px-2 py-2 sm:px-3'},Nf={class:'text-base font-bold text-yellow-300 sm:text-lg'},Rf={key:0,class:'rounded-lg border border-purple-500/50 bg-linear-to-r from-purple-900/30 to-pink-900/30 p-2 text-center sm:p-3'},jf={class:'text-xs text-gray-300'},Lf={key:0,class:'mt-1 text-[10px] text-green-400 sm:text-xs'},Bf={class:'rounded-lg border border-gray-600/50 bg-[#2f3136]'},Of={class:'grid grid-cols-2 gap-1 px-3 pb-2 text-[10px] sm:gap-2 sm:text-xs'},qf={class:'flex justify-between'},Uf={class:'text-red-400'},Vf={class:'flex justify-between'},Ff={class:'text-orange-400'},Hf={class:'flex justify-between'},Gf={class:'text-green-400'},zf={class:'flex justify-between'},Wf={class:'text-yellow-400'},Qf={class:'flex justify-between'},Xf={class:'text-purple-400'},Yf={class:'flex justify-between'},Kf={class:'text-blue-400'},Jf={key:1,class:'rounded-lg border border-amber-500/30 bg-amber-900/10 p-2 sm:p-3'},Zf={class:'text-[10px] text-gray-400 sm:text-xs'},ev={key:0,class:'mt-1 space-y-0.5'},tv={class:'flex-1 p-4 text-center sm:p-6'},av={key:0,class:'mb-3 text-sm text-gray-400'},sv={key:1,class:'text-sm text-gray-400'},nv={class:'shrink-0 border-t border-[#202225] bg-[#2f3136] p-2 sm:p-3'},rv={key:0,class:'flex flex-col gap-2 sm:grid sm:grid-cols-2 sm:gap-2'},lv={class:'flex gap-2'};const ov=Za({name:'BattleResultModal',props:{visible:{type:Boolean,default:!1},result:{type:String,default:'win'},settlement:{type:Object,default:null}},emits:['close','loot','retry','load','continue'],setup:(e,{emit:t})=>({isVictory:ir(()=>'win'===e.result),handleSkip:()=>{t('close')},handleLoot:()=>{e.settlement?.lootContext&&t('loot',e.settlement.lootContext),t('close')},handleRetry:()=>{t('retry')},handleLoad:()=>{t('load')},handleContinue:()=>{t('continue')}})}),iv=(0,$u.A)(ov,[['render',function(e,t,a,s,n,r){return yn(),_n(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-100 flex items-center justify-center bg-black/70 p-2 font-sans sm:p-4',onClick:t[6]||(t[6]=Cl((...t)=>e.handleSkip&&e.handleSkip(...t),['self']))},[Mn('div',Tf,[Rn(' Header (固定) '),Mn('div',{class:ee(['shrink-0 px-4 py-2 sm:px-6 sm:py-3',e.isVictory?'bg-gradient-to-r from-yellow-900/50 to-amber-800/30':'bg-gradient-to-r from-gray-800 to-gray-700'])},[Mn('div',Af,[Mn('h2',{class:ee(['text-lg font-bold sm:text-xl',e.isVictory?'text-yellow-300':'text-gray-300'])},oe(e.isVictory?'🎉 战斗胜利!':'lose'===e.result?'💀 战斗失败':'🏃 成功逃离'),3)])],2),Rn(' Settlement Details (可滚动) '),e.isVictory&&e.settlement?(yn(),Sn('div',Mf,[Rn(' EXP & Gold '),Mn('div',Ef,[Mn('div',$f,[t[7]||(t[7]=Mn('span',{class:'text-lg sm:text-xl'},'⭐',-1)),Mn('span',Df,'+'+oe(e.settlement.exp),1),t[8]||(t[8]=Mn('span',{class:'text-[10px] text-gray-400 sm:text-xs'},'经验值',-1))]),Mn('div',Pf,[t[9]||(t[9]=Mn('span',{class:'text-lg sm:text-xl'},'🪙',-1)),Mn('span',Nf,'+'+oe(e.settlement.gold),1),t[10]||(t[10]=Mn('span',{class:'text-[10px] text-gray-400 sm:text-xs'},'铜币',-1))])]),Rn(' Level Up Banner '),e.settlement.levelUp?(yn(),Sn('div',Rf,[t[11]||(t[11]=Mn('div',{class:'text-xl sm:text-2xl'},'🎊',-1)),t[12]||(t[12]=Mn('div',{class:'text-sm font-bold text-purple-300 sm:text-base'},'等级提升!',-1)),Mn('div',jf,'Lv.'+oe(e.settlement.previousLevel)+' → Lv.'+oe(e.settlement.newLevel),1),e.settlement.attributePointsGained?(yn(),Sn('div',Lf,' 获得 '+oe(e.settlement.attributePointsGained)+' 点可分配属性点 ',1)):Rn('v-if',!0)])):Rn('v-if',!0),Rn(' Battle Statistics (可折叠) '),Mn('details',Bf,[t[19]||(t[19]=Mn('summary',{class:'cursor-pointer px-3 py-2 text-xs font-bold text-gray-400 sm:text-sm'},'📊 战斗统计',-1)),Mn('div',Of,[Mn('div',qf,[t[13]||(t[13]=Mn('span',{class:'text-gray-500'},'总输出',-1)),Mn('span',Uf,oe(e.settlement.statistics.totalDamageDealt),1)]),Mn('div',Vf,[t[14]||(t[14]=Mn('span',{class:'text-gray-500'},'承受伤害',-1)),Mn('span',Ff,oe(e.settlement.statistics.totalDamageTaken),1)]),Mn('div',Hf,[t[15]||(t[15]=Mn('span',{class:'text-gray-500'},'治疗量',-1)),Mn('span',Gf,oe(e.settlement.statistics.totalHealing),1)]),Mn('div',zf,[t[16]||(t[16]=Mn('span',{class:'text-gray-500'},'暴击次数',-1)),Mn('span',Wf,oe(e.settlement.statistics.criticalHits),1)]),Mn('div',Qf,[t[17]||(t[17]=Mn('span',{class:'text-gray-500'},'击杀数',-1)),Mn('span',Xf,oe(e.settlement.statistics.killCount),1)]),Mn('div',Yf,[t[18]||(t[18]=Mn('span',{class:'text-gray-500'},'回合数',-1)),Mn('span',Kf,oe(e.settlement.statistics.turnCount),1)])])]),Rn(' Loot Context (搜刮提示) '),e.settlement.lootContext?.enabled?(yn(),Sn('div',Jf,[t[20]||(t[20]=Mn('div',{class:'mb-1 flex items-center gap-1 sm:gap-2'},[Mn('span',{class:'text-base sm:text-lg'},'🎒'),Mn('span',{class:'text-xs font-bold text-amber-300 sm:text-sm'},'可搜刮')],-1)),Mn('p',Zf,oe(e.settlement.lootContext.locationHint),1),e.settlement.lootContext.specialDropHints?.length?(yn(),Sn('div',ev,[(yn(!0),Sn(pn,null,xs(e.settlement.lootContext.specialDropHints,(e,t)=>(yn(),Sn('div',{key:t,class:'text-[10px] text-amber-400 sm:text-xs'},' ✨ '+oe(e),1))),128))])):Rn('v-if',!0)])):Rn('v-if',!0)])):(yn(),Sn(pn,{key:1},[Rn(' Non-victory message '),Mn('div',tv,['lose'===e.result?(yn(),Sn('p',av,'你被击败了...')):'flee'===e.result?(yn(),Sn('p',sv,'你成功逃离了战斗。')):Rn('v-if',!0)])],2112)),Rn(' Actions (固定在底部) '),Mn('div',nv,[Rn(' 失败时的三选项 (响应式布局:手机竖排,平板2+1,桌面横排) '),'lose'===e.result?(yn(),Sn('div',rv,[Mn('button',{class:'w-full rounded-lg bg-gradient-to-r from-red-600 to-orange-500 py-2 text-xs font-bold text-white transition-colors hover:from-red-500 hover:to-orange-400 sm:py-2.5 sm:text-sm',onClick:t[0]||(t[0]=(...t)=>e.handleRetry&&e.handleRetry(...t))},' ⚔️ 重新战斗 '),Mn('button',{class:'w-full rounded-lg bg-gradient-to-r from-blue-600 to-cyan-500 py-2 text-xs font-bold text-white transition-colors hover:from-blue-500 hover:to-cyan-400 sm:py-2.5 sm:text-sm',onClick:t[1]||(t[1]=(...t)=>e.handleLoad&&e.handleLoad(...t))},' 📂 读取存档 '),Mn('button',{class:'w-full rounded-lg bg-gray-600 py-2 text-xs font-bold text-white transition-colors hover:bg-gray-500 sm:col-span-2 sm:py-2.5 sm:text-sm',onClick:t[2]||(t[2]=(...t)=>e.handleContinue&&e.handleContinue(...t))},' 📜 继续剧情 (濒死状态) ')])):e.isVictory&&e.settlement?.lootContext?.enabled?(yn(),Sn(pn,{key:1},[Rn(' 胜利时的搜刮/跳过按钮 '),Mn('div',lv,[Mn('button',{class:'flex-1 rounded-lg bg-gray-600 py-2 text-xs font-bold text-white transition-colors hover:bg-gray-500 sm:py-2.5 sm:text-sm',onClick:t[3]||(t[3]=(...t)=>e.handleSkip&&e.handleSkip(...t))},' 跳过 '),Mn('button',{class:'flex-1 rounded-lg bg-gradient-to-r from-amber-600 to-yellow-500 py-2 text-xs font-bold text-white transition-colors hover:from-amber-500 hover:to-yellow-400 sm:py-2.5 sm:text-sm',onClick:t[4]||(t[4]=(...t)=>e.handleLoot&&e.handleLoot(...t))},' 🎒 搜刮 ')])],2112)):(yn(),Sn(pn,{key:2},[Rn(' 胜利（无搜刮）或逃跑 '),Mn('button',{class:ee(['w-full rounded-lg py-2 text-xs font-bold text-white transition-colors sm:py-2.5 sm:text-sm',e.isVictory?'bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-500 hover:to-emerald-400':'bg-gray-600 hover:bg-gray-500']),onClick:t[5]||(t[5]=(...t)=>e.handleSkip&&e.handleSkip(...t))},' 继续 ',2)],2112))])])])):Rn('v-if',!0)]),_:1})}],['__scopeId','data-v-d471d57a']]),cv={class:'w-full max-w-md rounded-lg border border-[#202225] bg-[#36393f] shadow-xl'},dv={class:'flex items-center justify-between border-b border-[#202225] bg-[#2f3136] px-4 py-3'},uv={class:'p-4'},pv={class:'mb-4 space-y-2 rounded bg-[#2f3136] p-3'},mv={class:'text-white'},gv={class:'text-gray-400'},hv={class:'flex justify-end gap-2 border-t border-[#202225] bg-[#2f3136] px-4 py-3'},fv=['disabled'],vv=['disabled'];const yv=Za({name:'PreBattleModal',props:{visible:{type:Boolean,required:!0},enemies:{type:Array,required:!0}},emits:['close','battle','flee'],setup(_,{emit:e}){const t=$t(!1);return{isProcessing:t,handleClose:()=>{t.value||e('close')},handleBattle:()=>{t.value||e('battle')},handleFlee:async()=>{t.value||(t.value=!0,e('flee'),setTimeout(()=>{t.value=!1},1e3))}}}}),bv=(0,$u.A)(yv,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[3]||(t[3]=Cl((...t)=>e.handleClose&&e.handleClose(...t),['self']))},[Mn('div',cv,[Mn('div',dv,[t[4]||(t[4]=Mn('h3',{class:'font-bold text-red-400'},'⚔️ 遭遇战',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=(...t)=>e.handleClose&&e.handleClose(...t))},'✕')]),Mn('div',uv,[t[5]||(t[5]=Mn('p',{class:'mb-3 text-sm text-gray-300'},'即将与以下敌人战斗：',-1)),Mn('div',pv,[(yn(!0),Sn(pn,null,xs(e.enemies,e=>(yn(),Sn('div',{key:e.id,class:'flex items-center justify-between text-sm'},[Mn('span',mv,oe(e.name),1),Mn('span',gv,'Lv.'+oe(e.level),1)]))),128))]),t[6]||(t[6]=Mn('p',{class:'text-xs text-gray-400'},'选择你的行动：',-1))]),Mn('div',hv,[Mn('button',{class:'rounded bg-[#40444b] px-4 py-2 text-sm text-white hover:bg-[#4a4f57]',disabled:e.isProcessing,onClick:t[1]||(t[1]=(...t)=>e.handleFlee&&e.handleFlee(...t))},oe(e.isProcessing?'检定中...':'逃跑'),9,fv),Mn('button',{class:'rounded bg-red-600 px-4 py-2 text-sm text-white hover:bg-red-700',disabled:e.isProcessing,onClick:t[2]||(t[2]=(...t)=>e.handleBattle&&e.handleBattle(...t))},' 战斗 ',8,vv)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-15909d2c']]),xv={class:'animate-fade-in relative w-full max-w-[280px] rounded-lg border border-[#202225] bg-[#36393f] p-4 shadow-2xl sm:max-w-sm sm:p-6'},wv={class:'mb-4 flex items-center justify-between'},kv={class:'text-lg font-bold text-white'},Sv={key:0,class:'mb-4 flex gap-3 rounded border border-[#202225] bg-[#2f3136] p-3'},_v={key:1,class:'flex h-12 w-12 shrink-0 items-center justify-center rounded border border-[#202225] bg-[#36393f] text-2xl'},Cv={class:'flex flex-col justify-center overflow-hidden'},Iv={class:'truncate font-bold text-gray-200'},Tv=['title'],Av={class:'mb-6 text-sm text-gray-300'},Mv={class:'flex justify-end gap-3'},Ev=['onClick'];const $v=Za({name:'ActionModal',props:{visible:{type:Boolean,default:!1},title:{type:String,default:'确认'},message:{type:String,default:'确定执行此操作吗？'},confirmText:{type:String,default:'确认'},cancelText:{type:String,default:'取消'},item:{type:Object,default:null},isDestructive:{type:Boolean,default:!1},actions:{type:Array,default:()=>[]}},emits:['confirm','cancel'],setup(){const e=()=>{try{return Ll.serviceLocator.get('IconService')}catch{return null}};return{hasIconData:t=>{if(!t)return!1;return!!e()&&!(!t.subtype&&!['weapon','armor','accessory','material','consumable'].includes(t.type))},getIconStyle:(t,a=48)=>{if(!t)return{};const s=e();if(!s)return{};let n,r=t.subtype;if(t.subtype){const e=s.mapTypeToCategoryAndSubtype(t.subtype);n=e.category,r=e.subtype||t.subtype}else'consumable'===t.type?(n='material',r='potion'):n=['weapon','armor','accessory','material','item'].includes(t.type)?t.type:'item';return'material'!==n&&'item'!==n||void 0!==t.iconVariant||s.ensureIconVariant(t),s.getIconStyle(n,r,t.attribute,t.iconVariant,a)}}}}),Dv=(0,$u.A)($v,[['render',function(e,t,a,s,n,r){return e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-[100] flex items-center justify-center bg-black/70 px-4 backdrop-blur-sm',onClick:t[4]||(t[4]=Cl(t=>e.$emit('cancel'),['self']))},[Mn('div',xv,[Rn(' Header '),Mn('div',wv,[Mn('h3',kv,oe(e.title),1),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('cancel'))},'✕')]),Rn(' Item Preview (if item provided) '),e.item?(yn(),Sn('div',Sv,[Rn(' Sprite Sheet Icon or Emoji fallback '),e.hasIconData(e.item)?(yn(),Sn('div',{key:0,class:'item-sprite h-12 w-12 shrink-0 rounded border border-[#202225]',style:X(e.getIconStyle(e.item,48))},null,4)):(yn(),Sn('div',_v,oe(e.item.emoji||'📦'),1)),Mn('div',Cv,[Mn('div',Iv,oe(e.item.name),1),Mn('div',{class:'line-clamp-2 text-xs text-gray-400',title:e.item.desc},oe(e.item.desc||'暂无描述'),9,Tv)])])):Rn('v-if',!0),Rn(' Message '),Mn('p',Av,oe(e.message),1),Rn(' Actions '),Mn('div',Mv,[e.actions&&e.actions.length>0?(yn(),Sn(pn,{key:0},[(yn(!0),Sn(pn,null,xs(e.actions,(e,t)=>(yn(),Sn('button',{key:t,class:ee(['rounded px-4 py-2 text-sm font-bold text-white shadow-sm transition-transform active:scale-95',{'bg-[#ed4245] hover:bg-[#c03537]':'danger'===e.type,'bg-[#5865f2] hover:bg-[#4752c4]':'primary'===e.type,'bg-[#4f545c] hover:bg-[#5d6269]':!e.type||'default'===e.type}]),onClick:e.handler},oe(e.label),11,Ev))),128)),Mn('button',{class:'rounded px-4 py-2 text-sm text-gray-300 transition-colors hover:bg-[#40444b] hover:text-white',onClick:t[1]||(t[1]=t=>e.$emit('cancel'))},oe(e.cancelText||'取消'),1)],64)):(yn(),Sn(pn,{key:1},[Mn('button',{class:'rounded px-4 py-2 text-sm text-gray-300 transition-colors hover:bg-[#40444b] hover:text-white',onClick:t[2]||(t[2]=t=>e.$emit('cancel'))},oe(e.cancelText||'取消'),1),Mn('button',{class:ee(['rounded px-4 py-2 text-sm font-bold text-white shadow-sm transition-transform active:scale-95',e.isDestructive?'bg-[#ed4245] hover:bg-[#c03537]':'bg-[#5865f2] hover:bg-[#4752c4]']),onClick:t[3]||(t[3]=t=>e.$emit('confirm'))},oe(e.confirmText||'确认'),3)],64))])])])):Rn('v-if',!0)}],['__scopeId','data-v-3c06f73b']]),Pv={class:'w-full max-w-sm rounded-lg border border-[#202225] bg-[#36393f] shadow-xl'},Nv={class:'flex items-center justify-between border-b border-[#202225] bg-[#2f3136] px-4 py-3'},Rv={class:'p-4'},jv={class:'text-sm text-gray-300'},Lv={class:'font-bold text-white'},Bv={class:'flex justify-end gap-2 border-t border-[#202225] bg-[#2f3136] px-4 py-3'};const Ov=Za({name:'AttackConfirmModal',props:{visible:{type:Boolean,required:!0},targetName:{type:String,required:!0},targetId:{type:String,default:''},isSceneNpc:{type:Boolean,default:!1}},emits:['close','confirm'],setup:(e,{emit:t})=>({handleConfirm:()=>{t('confirm',{targetName:e.targetName,targetId:e.targetId,isSceneNpc:e.isSceneNpc})}})}),qv=(0,$u.A)(Ov,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[3]||(t[3]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',Pv,[Mn('div',Nv,[t[4]||(t[4]=Mn('h3',{class:'font-bold text-red-400'},'⚔️ 确认攻击',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),Mn('div',Rv,[Mn('p',jv,[t[5]||(t[5]=Pn(' 确定要攻击 ',-1)),Mn('span',Lv,oe(e.targetName),1),t[6]||(t[6]=Pn(' 吗？ ',-1))])]),Mn('div',Bv,[Mn('button',{class:'rounded bg-[#40444b] px-4 py-2 text-sm text-white hover:bg-[#4a4f57]',onClick:t[1]||(t[1]=t=>e.$emit('close'))},' 取消 '),Mn('button',{class:'rounded bg-red-600 px-4 py-2 text-sm text-white hover:bg-red-700',onClick:t[2]||(t[2]=(...t)=>e.handleConfirm&&e.handleConfirm(...t))},' 确认攻击 ')])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-078f7cf0']]),Uv={class:'relative flex max-h-[70vh] w-[95%] max-w-md flex-col overflow-hidden rounded-lg border border-gray-700 bg-[#2f3136] p-4 shadow-2xl md:p-6'},Vv={class:'mb-4 flex items-center justify-between'},Fv={class:'text-base font-bold text-white md:text-lg'},Hv={class:'mb-4 flex justify-center'},Gv=['src'],zv={class:'text-4xl md:text-5xl'},Wv={key:3,class:'absolute inset-0 flex items-center justify-center rounded-full bg-black/50 opacity-0 transition-opacity group-hover:opacity-100'},Qv={class:'mb-4 flex gap-1 rounded-lg bg-[#202225] p-1'},Xv=['onClick'],Yv={class:'flex h-[200px] flex-col overflow-hidden md:h-[220px]'},Kv={key:0,class:'flex h-full flex-col space-y-3 overflow-y-auto'},Jv={class:'min-h-0 flex-1'},Zv={class:'custom-scrollbar grid h-full max-h-[120px] grid-cols-6 gap-1.5 overflow-y-auto md:grid-cols-8 md:gap-2'},ey=['onClick'],ty={class:'flex h-full flex-col items-center justify-center space-y-4'},ay={class:'flex h-full flex-col space-y-3 overflow-y-auto'},sy={class:'grid grid-cols-2 gap-2'},ny=['onClick'],ry={key:0,class:'rounded-lg bg-[#202225] p-2'},ly={class:'mt-1 text-xs text-gray-300'},oy={key:0,class:'mr-2'},iy={key:1,class:'mr-2'},cy={key:2,class:'mr-2'},dy={key:0,class:'mt-1 line-clamp-2 text-[10px] text-purple-300'},uy={key:1},py={class:'mb-1 flex items-center justify-between'},my={class:'text-xs text-gray-400'},gy=['placeholder'],hy={class:'mt-1 text-[10px] text-gray-500'},fy={key:0},vy={key:1},yy={key:2,class:'rounded-lg bg-red-900/30 px-3 py-2 text-xs text-red-300'},by={class:'flex justify-center pt-2'},xy=['disabled'],wy={key:0,class:'mr-2 h-5 w-5 animate-spin',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},ky={key:1,class:'mr-2 h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Sy={key:3,class:'text-center text-[10px] text-gray-500'},_y={class:'mt-4 flex justify-end gap-2 border-t border-gray-700 pt-4'},Cy=['disabled'],Iy=['src'];const Ty=Za({name:'AvatarEditorModal',props:{visible:{type:Boolean,required:!0},currentAvatar:{type:String,default:''},title:{type:String,default:'编辑头像'},characterInfo:{type:Object,default:null}},emits:['close','update-avatar'],setup(e,{emit:t}){const a=$t('emoji'),s=$t(''),n=$t(null),r=$t(e.currentAvatar||''),l=$t(!1);let o=null;try{o=Ll.serviceLocator.get('ImageGenService')}catch{console.log('[AvatarEditorModal] ImageGenService not registered, creating new instance'),o=new ci}const i=$t(!1),c=$t(!1),d=$t(''),u=$t('smart'),p=$t(''),m=$t(''),g=$t(!1),h=ir(()=>e.characterInfo&&(e.characterInfo.appearance||e.characterInfo.race||e.characterInfo.gender)),f=ir(()=>{const e=[];return h.value&&e.push({id:'smart',label:'🧠 智能生成'}),e.push({id:'face',label:'🎭 面部特写'},{id:'fullbody',label:'🧍 全身像'},{id:'custom',label:'✨ 自定义'}),e});_a(h,e=>{e||'smart'!==u.value||(u.value='face')});const v=t=>{if(!o)return'';const a=[];switch(t){case'face':a.push('face close-up','detailed face','headshot','solo');break;case'fullbody':a.push('full body','standing','solo')}if(a.push('masterpiece','best quality','highly detailed'),e.characterInfo){const t=e.characterInfo;if(t.gender){const e=o.translateAppearance(t.gender);e&&e!==t.gender&&a.push(e)}if(t.race){const e=o.translateAppearance(t.race);a.push(e)}let s='';if(t.appearance&&(s='object'==typeof t.appearance?o.appearanceObjectToString(t.appearance):t.appearance),s){const e=o.translateAppearance(s);a.push(e)}if(t.private){const e=o.privateInfoToAppearanceHints(t.private);if(e){const t=o.translateAppearance(e);a.push(t)}}if(t.class){const e=o.translateAppearance(t.class);e&&a.push(e)}}return'fullbody'===t&&a.push('full body shot'),a.filter(e=>e).join(', ')},y=e=>!!e&&(e.startsWith('data:image/')||e.startsWith('http://')||e.startsWith('https://')||e.startsWith('/user/images/')||e.startsWith('user/images/')),b=ir(()=>{const t=e.characterInfo?.appearance;if(!t)return'';if('string'==typeof t)return t;const a=[];for(const e in t){const s=t[e];s&&'string'==typeof s&&s.trim()&&a.push(s.trim())}return a.join(', ')}),x=async()=>{i.value=!!o&&await o.isAvailable()};_a(()=>e.currentAvatar,e=>{r.value=e||'',s.value=y(e)?'':e||''}),_a(()=>e.visible,t=>{t&&(r.value=e.currentAvatar||'',s.value=y(e.currentAvatar)?'':e.currentAvatar||'',d.value='',m.value='',g.value=!1,y(e.currentAvatar)?a.value='import':a.value='emoji',x())});return us(()=>{x()}),{activeTab:a,tabs:[{id:'emoji',label:'表情符号'},{id:'import',label:'导入图片'},{id:'ai',label:'AI生成'}],emojiInput:s,previewAvatar:r,presetAvatars:['🧙','🧝','🧛','🧜','🧚','🦸','🦹','🥷','👨‍🦰','👩‍🦰','👨‍🦱','👩‍🦱','👨‍🦳','👩‍🦳','👱‍♂️','👱‍♀️','🐺','🐱','🦊','🐰','🐻','🐼','🦁','🐯','👸','🤴','🧞','🧟','👹','👺','👻','💀','🤖','👽','🎭','🃏','⚔️','🛡️','🗡️','🏹'],fileInput:n,isImageUrl:y,handleEmojiInput:()=>{r.value=s.value},selectEmoji:e=>{s.value=e,r.value=e},triggerFileInput:()=>{n.value?.click()},handleFileChange:e=>{const t=e.target;if(t.files&&t.files[0]){const e=t.files[0],a=new FileReader;a.onload=e=>{e.target?.result&&(r.value=e.target.result)},a.readAsDataURL(e)}},handleSave:()=>{r.value&&(t('update-avatar',r.value),t('close'))},aiGenAvailable:i,isGenerating:c,aiGenError:d,selectedAiMode:u,customPrompt:p,aiGenModes:f,handleAiGenerate:async()=>{if(!c.value&&i.value&&o){c.value=!0,d.value='';try{let t;const a=t=>{if(!e.characterInfo)return null;const a=e.characterInfo,s=a.appearance&&'object'==typeof a.appearance;return{name:a.name,race:a.race,class:a.class,gender:a.gender,appearance:s?void 0:a.appearance,appearanceInfo:s?a.appearance:void 0,privateInfo:a.private,additionalPrompt:t}};switch(u.value){case'smart':if(e.characterInfo){const e=a();console.log('[AvatarEditorModal] Smart generation with character info:',e),t=await o.generateCharacterAvatar(e,{size:1024,style:'portrait'})}else t=await o.generateFacePortrait();break;case'face':case'fullbody':case'custom':{const e=m.value.trim();e?(console.log('[AvatarEditorModal] Using editable prompt directly:',e),t=await o.generateCustom(e,{width:1024,height:1024})):t='fullbody'===u.value?await o.generateFullBody():await o.generateFacePortrait()}}if(t?.success&&t.imageUrl){const e=o.resolveImageUrl(t.imageUrl);r.value=e}else d.value=t?.error||'生成失败，请重试'}catch(e){d.value=e instanceof Error?e.message:'生成时发生错误',console.error('[AvatarEditorModal] AI generation error:',e)}finally{c.value=!1}}},editablePrompt:m,promptModified:g,handleModeChange:e=>{u.value=e,g.value=!1,'smart'!==e&&(m.value='custom'===e?'':v(e))},resetPromptToDefault:()=>{'smart'!==u.value&&'custom'!==u.value&&(m.value=v(u.value),g.value=!1)},getPromptPlaceholder:()=>{switch(u.value){case'face':return'例如：detailed face, beautiful eyes, soft lighting...';case'fullbody':return'例如：full body, standing pose, dynamic lighting...';case'custom':return'输入你想要的描述，例如：anime style, detailed eyes, fantasy background...';default:return''}},hasCharacterInfo:h,displayAppearance:b,showLightbox:l,handlePreviewClick:()=>{y(r.value)&&(l.value=!0)}}}}),Ay=(0,$u.A)(Ty,[['render',function(e,t,a,s,n,r){return e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-80 flex items-center justify-center bg-black/80 backdrop-blur-sm',onClick:t[15]||(t[15]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',Uv,[Rn(' Header '),Mn('div',Vv,[Mn('h3',Fv,oe(e.title),1),Mn('button',{class:'p-1 text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[16]||(t[16]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Rn(' Current Avatar Preview '),Mn('div',Hv,[Mn('div',{class:ee(['avatar-preview-container group relative flex h-24 w-24 cursor-pointer items-center justify-center overflow-hidden rounded-full border-2 border-dashed border-gray-600 bg-[#202225] shadow-inner transition-all md:h-32 md:w-32',{'border-[#5865f2]':e.previewAvatar,'cursor-default':!e.previewAvatar}]),onClick:t[1]||(t[1]=(...t)=>e.handlePreviewClick&&e.handlePreviewClick(...t))},[Rn(' Image Avatar '),e.isImageUrl(e.previewAvatar)?(yn(),Sn('img',{key:0,src:e.previewAvatar,alt:'Avatar',class:'avatar-image h-full w-full object-cover'},null,8,Gv)):e.previewAvatar?(yn(),Sn(pn,{key:1},[Rn(' Emoji Avatar '),Mn('span',zv,oe(e.previewAvatar),1)],2112)):(yn(),Sn(pn,{key:2},[Rn(' No Avatar '),t[17]||(t[17]=Mn('div',{class:'flex flex-col items-center justify-center text-gray-500'},[Mn('svg',{class:'h-10 w-10 opacity-50 md:h-12 md:w-12',fill:'none',viewBox:'0 0 24 24',stroke:'currentColor'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'})]),Mn('span',{class:'mt-1 text-xs'},'无头像')],-1))],2112)),Rn(' 放大提示 '),e.isImageUrl(e.previewAvatar)?(yn(),Sn('div',Wv,[...t[18]||(t[18]=[Mn('svg',{class:'h-6 w-6 text-white',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7'})],-1)])])):Rn('v-if',!0)],2)]),Rn(' Mode Tabs '),Mn('div',Qv,[(yn(!0),Sn(pn,null,xs(e.tabs,t=>(yn(),Sn('button',{key:t.id,class:ee(['flex-1 rounded-md px-2 py-1.5 text-xs font-medium transition-colors md:text-sm',e.activeTab===t.id?'bg-[#5865f2] text-white':'text-gray-400 hover:bg-[#36393f] hover:text-white']),onClick:a=>e.activeTab=t.id},oe(t.label),11,Xv))),128))]),Rn(' Tab Content - 固定高度保证三个标签页一致 '),Mn('div',Yv,[Rn(' Emoji Tab '),'emoji'===e.activeTab?(yn(),Sn('div',Kv,[Rn(' Emoji Input '),Mn('div',null,[t[19]||(t[19]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'直接输入表情',-1)),xa(Mn('input',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.emojiInput=t),type:'text',class:'w-full rounded border border-[#202225] bg-[#40444b] px-3 py-2 text-center text-2xl text-white focus:border-[#5865f2] focus:outline-none',maxlength:'4',placeholder:'👤',onInput:t[3]||(t[3]=(...t)=>e.handleEmojiInput&&e.handleEmojiInput(...t))},null,544),[[fl,e.emojiInput]])]),Rn(' Preset Emojis '),Mn('div',Jv,[t[20]||(t[20]=Mn('label',{class:'mb-1.5 block text-xs text-gray-400'},'或选择预设头像',-1)),Mn('div',Zv,[(yn(!0),Sn(pn,null,xs(e.presetAvatars,t=>(yn(),Sn('button',{key:t,class:ee(['flex aspect-square items-center justify-center rounded-lg bg-[#40444b] text-xl transition-all hover:scale-105 hover:bg-[#4f545c] md:text-2xl',{'ring-2 ring-[#5865f2]':e.previewAvatar===t}]),onClick:a=>e.selectEmoji(t)},oe(t),11,ey))),128))])])])):'import'===e.activeTab?(yn(),Sn(pn,{key:1},[Rn(' Import Tab '),Mn('div',ty,[t[22]||(t[22]=Mn('div',{class:'text-center text-sm text-gray-400'},[Mn('p',null,'上传一张图片作为头像'),Mn('p',{class:'mt-1 text-xs text-gray-500'},'支持 JPG、PNG、GIF 等格式')],-1)),Mn('button',{class:'flex items-center rounded-lg border border-gray-600 bg-[#36393f] px-6 py-3 text-sm text-gray-300 transition-colors hover:border-amber-500 hover:text-white',onClick:t[4]||(t[4]=(...t)=>e.triggerFileInput&&e.triggerFileInput(...t))},[...t[21]||(t[21]=[Mn('svg',{class:'mr-2 h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12'})],-1),Pn(' 选择图片 ',-1)])]),Mn('input',{ref:'fileInput',type:'file',accept:'image/*',class:'hidden',onChange:t[5]||(t[5]=(...t)=>e.handleFileChange&&e.handleFileChange(...t))},null,544)])],2112)):'ai'===e.activeTab?(yn(),Sn(pn,{key:2},[Rn(' AI Generate Tab '),Mn('div',ay,[Rn(' 生成模式选择 '),Mn('div',null,[t[23]||(t[23]=Mn('label',{class:'mb-1 block text-xs text-gray-400'},'生成模式',-1)),Mn('div',sy,[(yn(!0),Sn(pn,null,xs(e.aiGenModes,t=>(yn(),Sn('button',{key:t.id,class:ee(['rounded-lg border px-3 py-2 text-xs transition-colors',e.selectedAiMode===t.id?'border-purple-500 bg-purple-900/30 text-purple-300':'border-gray-600 bg-[#40444b] text-gray-300 hover:border-purple-400']),onClick:a=>e.handleModeChange(t.id)},oe(t.label),11,ny))),128))])]),Rn(' 角色信息预览（智能生成模式） '),'smart'===e.selectedAiMode&&e.hasCharacterInfo?(yn(),Sn('div',ry,[t[24]||(t[24]=Mn('div',{class:'text-[10px] text-gray-500'},'将使用以下角色信息生成：',-1)),Mn('div',ly,[e.characterInfo?.race?(yn(),Sn('span',oy,oe(e.characterInfo.race),1)):Rn('v-if',!0),e.characterInfo?.gender?(yn(),Sn('span',iy,oe(e.characterInfo.gender),1)):Rn('v-if',!0),e.characterInfo?.class?(yn(),Sn('span',cy,oe(e.characterInfo.class),1)):Rn('v-if',!0)]),e.displayAppearance?(yn(),Sn('div',dy,' 外貌: '+oe(e.displayAppearance),1)):Rn('v-if',!0)])):Rn('v-if',!0),Rn(' 提示词编辑框（面部特写、全身像、自定义模式） '),'smart'!==e.selectedAiMode?(yn(),Sn('div',uy,[Mn('div',py,[Mn('label',my,oe('custom'===e.selectedAiMode?'自定义提示词':'提示词预览（可编辑）'),1),'custom'!==e.selectedAiMode?(yn(),Sn('button',{key:0,class:'text-[10px] text-purple-400 hover:text-purple-300',onClick:t[6]||(t[6]=(...t)=>e.resetPromptToDefault&&e.resetPromptToDefault(...t))},' 重置默认 ')):Rn('v-if',!0)]),xa(Mn('textarea',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.editablePrompt=t),class:'custom-scrollbar h-20 w-full resize-none rounded border border-[#202225] bg-[#40444b] px-3 py-2 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none',placeholder:e.getPromptPlaceholder(),onInput:t[8]||(t[8]=t=>e.promptModified=!0)},null,40,gy),[[fl,e.editablePrompt]]),Mn('div',hy,['custom'===e.selectedAiMode?(yn(),Sn('span',fy,'请输入英文标签，NovelAI 仅支持英文')):(yn(),Sn('span',vy,'系统已自动翻译，若仍有中文请手动修改为英文'))])])):Rn('v-if',!0),Rn(' 分辨率提示 '),t[27]||(t[27]=Mn('div',{class:'text-center text-[10px] text-gray-500'},'将使用 1024×1024 分辨率生成正方形头像',-1)),Rn(' 状态提示 '),e.aiGenError?(yn(),Sn('div',yy,oe(e.aiGenError),1)):Rn('v-if',!0),Rn(' 生成按钮 '),Mn('div',by,[Mn('button',{class:ee(['flex items-center rounded-lg border px-6 py-3 text-sm transition-colors',e.isGenerating?'cursor-wait border-purple-600/50 bg-purple-900/20 text-purple-300 opacity-70':e.aiGenAvailable?'border-purple-500 bg-purple-900/30 text-purple-300 hover:bg-purple-900/50':'cursor-not-allowed border-gray-600 bg-gray-800/50 text-gray-500 opacity-50']),disabled:e.isGenerating||!e.aiGenAvailable,onClick:t[9]||(t[9]=(...t)=>e.handleAiGenerate&&e.handleAiGenerate(...t))},[e.isGenerating?(yn(),Sn('svg',wy,[...t[25]||(t[25]=[Mn('circle',{class:'opacity-25',cx:'12',cy:'12',r:'10',stroke:'currentColor','stroke-width':'4'},null,-1),Mn('path',{class:'opacity-75',fill:'currentColor',d:'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'},null,-1)])])):(yn(),Sn('svg',ky,[...t[26]||(t[26]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z'},null,-1)])])),Pn(' '+oe(e.isGenerating?'生成中...':'生成头像'),1)],10,xy)]),Rn(' 提示信息 '),e.aiGenAvailable?Rn('v-if',!0):(yn(),Sn('div',Sy,' 需要在酒馆中配置 NovelAI/Stable Diffusion 图像生成源 '))])],2112)):Rn('v-if',!0)]),Rn(' Actions '),Mn('div',_y,[Mn('button',{class:'rounded bg-[#40444b] px-4 py-2 text-xs font-medium text-gray-300 transition-colors hover:bg-[#4f545c] md:text-sm',onClick:t[10]||(t[10]=t=>e.$emit('close'))},' 取消 '),Mn('button',{class:'rounded bg-[#5865f2] px-4 py-2 text-xs font-medium text-white transition-colors hover:bg-[#4752c4] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',disabled:!e.previewAvatar||e.previewAvatar===e.currentAvatar,onClick:t[11]||(t[11]=(...t)=>e.handleSave&&e.handleSave(...t))},' 保存 ',8,Cy)])]),Rn(' 大图预览模态框 '),(yn(),_n(Ra,{to:'body'},[En(wr,{name:'lightbox-fade'},{default:ba(()=>[e.showLightbox?(yn(),Sn('div',{key:0,class:'lightbox-overlay fixed inset-0 z-[100] flex items-center justify-center bg-black/95',onClick:t[14]||(t[14]=t=>e.showLightbox=!1)},[Rn(' 关闭按钮 '),Mn('button',{class:'absolute top-4 right-4 z-10 rounded-full bg-white/10 p-2 text-white/80 transition-colors hover:bg-white/20 hover:text-white',onClick:t[12]||(t[12]=Cl(t=>e.showLightbox=!1,['stop']))},[...t[28]||(t[28]=[Mn('svg',{class:'h-6 w-6',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])]),Rn(' 大图显示 '),Mn('div',{class:'lightbox-content max-h-[90vh] max-w-[90vw]',onClick:t[13]||(t[13]=Cl(()=>{},['stop']))},[Mn('img',{src:e.previewAvatar,alt:'Avatar Full Size',class:'lightbox-image max-h-[90vh] max-w-[90vw] rounded-lg object-contain shadow-2xl'},null,8,Iy)]),Rn(' 提示文字 '),t[29]||(t[29]=Mn('div',{class:'absolute bottom-4 left-1/2 -translate-x-1/2 text-sm text-white/60'},'点击任意位置关闭',-1))])):Rn('v-if',!0)]),_:1})]))])):Rn('v-if',!0)}],['__scopeId','data-v-53479805']]),My=['onContextmenu','onTouchstart'],Ey=['innerHTML'],$y={class:'w-full max-w-full overflow-hidden'},Dy={class:'mt-2 flex justify-end space-x-2'},Py=['onClick'],Ny={key:0,class:'group relative flex flex-col items-start transition-all'},Ry=['innerHTML'],jy={key:0,class:'loading-indicator-wrapper'},Ly={class:'loading-indicator'},By={class:'loading-text'},Oy={class:'context-menu-inner'},qy={class:'delete-confirm-modal mx-2 w-full max-w-md overflow-hidden rounded-xl border border-gray-600 bg-[#2f3136] shadow-2xl sm:mx-4'},Uy={class:'px-3 py-3 sm:px-5 sm:py-4'},Vy={class:'mt-2 rounded-lg bg-[#202225] p-2 sm:mt-3 sm:p-3'},Fy={class:'mt-0.5 text-lg font-bold text-red-400 sm:mt-1 sm:text-2xl'},Hy={class:'flex justify-end gap-2 border-t border-gray-600 bg-[#25262b] px-3 py-2.5 sm:gap-3 sm:px-5 sm:py-4'},Gy=['src'],zy={class:'context-menu-inner'};const Wy=Za({name:'ChatArea',setup(){rc(!0);const e=$t(null),t=$t([]),a=$t(null),n=$t({fontSize:14,messageSpacing:12,showTimestamp:!1,compactMode:!1,chatMessageLimit:50}),r=ir(()=>({gap:`${n.value.messageSpacing}px`})),l=ir(()=>({fontSize:`${n.value.fontSize}px`})),o=new Map,i=$t(0);let c=null;const d=$t(!1),u=$t(null),p=$t(80),m=$t(!1),g=$t(!1),h=$t('正在思考中...'),f=['正在思考中...','正在构思回复...','正在编织故事...','正在推演剧情...'],v=$t(null),y=$t(''),b=xt({visible:!1,x:0,y:0,targetMsg:null}),x=xt({visible:!1,targetMsg:null,deleteCount:0}),w=xt({visible:!1,url:'',prompt:'',msgId:0,imageIndex:0}),k=xt({visible:!1,x:0,y:0,url:'',prompt:'',msgId:0,imageIndex:0}),S=$t(!1);let C=null;const I=ir(()=>({bottom:`${p.value}px`,left:'16px'})),T=()=>{if(!u.value)return;const{scrollTop:e,scrollHeight:t,clientHeight:a}=u.value,s=t-e-a;d.value=s>100},A=()=>{u.value&&u.value.scrollTo({top:u.value.scrollHeight,behavior:'smooth'})},M=()=>{if(!u.value)return;const e=u.value.parentElement;if(!e)return;const t=e.querySelector(':scope > div:last-child');if(t){const e=t.getBoundingClientRect().height;p.value=e+16}},E=()=>{try{const e=localStorage.getItem('game_display_config');if(e){const t=JSON.parse(e);void 0!==t.fontSize&&(n.value.fontSize=t.fontSize),void 0!==t.messageSpacing&&(n.value.messageSpacing=t.messageSpacing),void 0!==t.showTimestamp&&(n.value.showTimestamp=t.showTimestamp),void 0!==t.compactMode&&(n.value.compactMode=t.compactMode),void 0!==t.chatMessageLimit&&(n.value.chatMessageLimit=t.chatMessageLimit)}}catch(e){console.error('Failed to load display config',e)}},D=e=>{'game_display_config'===e.key&&E()},P=e=>{void 0!==e.fontSize&&(n.value.fontSize=e.fontSize),void 0!==e.messageSpacing&&(n.value.messageSpacing=e.messageSpacing),void 0!==e.showTimestamp&&(n.value.showTimestamp=e.showTimestamp),void 0!==e.compactMode&&(n.value.compactMode=e.compactMode),void 0!==e.chatMessageLimit&&(n.value.chatMessageLimit=e.chatMessageLimit)},N=$t(!0),R=async()=>{const e=n.value.chatMessageLimit,a=await mi.storyDB.getRecentContext(e);t.value=a.sort((e,t)=>e.timestamp-t.timestamp);const s=[...t.value].reverse().find(e=>'user'!==e.role);if(s){Ll.serviceLocator.get('EventBus').emit('chat:latest-message',s.content)}N.value&&t.value.length>0&&(N.value=!1,await Zt(),setTimeout(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)},50))},j=e=>{e.id&&(v.value=e.id,y.value=e.content)},L=e=>{if(!e.id)return;const a=t.value.filter(t=>t.id&&t.id>=e.id).length;x.targetMsg=e,x.deleteCount=a,x.visible=!0},B=()=>{x.visible=!1,x.targetMsg=null,x.deleteCount=0},O=()=>{b.visible=!1,b.targetMsg=null},q=(e,t)=>{let a=e.clientX,s=e.clientY;a+160>window.innerWidth&&(a=window.innerWidth-160-10),s+150>window.innerHeight&&(s=window.innerHeight-150-10),k.x=a,k.y=s,k.url=t.url,k.prompt=t.prompt,k.msgId=t.msgId,k.imageIndex=t.imageIndex,k.visible=!0},U=()=>{k.visible=!1};let V=null;let F,H=null,G=null,W=null,Q=0;const X=()=>{console.log('[ChatArea] 开始显示加载占位符, 当前 isWaitingForResponse:',g.value),g.value=!0,console.log('[ChatArea] 设置后 isWaitingForResponse:',g.value),Q=Date.now(),h.value=f[0];let e=0;W=setInterval(()=>{e=(e+1)%f.length,h.value=f[e]},3e3),setTimeout(A,50),setTimeout(A,200),setTimeout(A,500)},Y=()=>{const e=Date.now()-Q,t=Math.max(0,500-e);setTimeout(()=>{console.log('[ChatArea] 隐藏加载占位符'),g.value=!1,W&&(clearInterval(W),W=null)},t)},K=()=>{document.hidden||(console.log('[ChatArea] Page visible, force refresh messages'),R())};us(async()=>{E(),await R(),F=setInterval(R,1e3),document.addEventListener('visibilitychange',K);try{c=Ll.serviceLocator.get('RegexService'),o.clear(),i.value++,console.log('[ChatArea] RegexService initialized, enabled:',c.isEnabled())}catch(e){console.error('[ChatArea] RegexService not available:',e)}if('undefined'!=typeof eventOn&&'undefined'!=typeof tavern_events)try{eventOn(tavern_events.MESSAGE_RECEIVED,()=>{console.log('[ChatArea] MESSAGE_RECEIVED event, reloading messages'),R()}),eventOn(tavern_events.MESSAGE_UPDATED,()=>{console.log('[ChatArea] MESSAGE_UPDATED event, reloading messages'),R()}),eventOn(tavern_events.STREAM_TOKEN_RECEIVED,e=>{a.value?a.value.content=e:a.value={id:0,role:'assistant',content:e,timestamp:Date.now()},Zt(()=>A())}),eventOn(tavern_events.GENERATION_ENDED,async e=>{a.value&&(await mi.storyDB.addRecord({role:a.value.role,content:a.value.content,timestamp:a.value.timestamp}),a.value=null,await R())}),eventOn(tavern_events.GENERATION_STOPPED,()=>{a.value=null}),console.log('[ChatArea] Tavern events registered successfully')}catch(e){console.warn('[ChatArea] Failed to register tavern events:',e)}window.addEventListener('storage',D);const t=Ll.serviceLocator.get('EventBus');if(t&&(G=P,t.on('display:config-updated',G),t.on('chat:sending',X),t.on('chat:received',Y),t.on('chat:error',Y),t.on('story:received',Y),t.on('chat:refresh',R),t.on('regex:config_updated',()=>{i.value++,o.clear()}),t.on('regex:rules_updated',()=>{i.value++,o.clear()})),u.value=(()=>{if(!e.value)return null;let t=e.value.parentElement;for(;t;){const e=getComputedStyle(t);if('auto'===e.overflowY||'scroll'===e.overflowY)return t;t=t.parentElement}return null})(),u.value){u.value.addEventListener('scroll',T),T(),H=new ResizeObserver(()=>{M()});const e=u.value.parentElement;e&&H.observe(e),M()}}),gs(()=>{clearInterval(F),C&&clearTimeout(C),V&&clearTimeout(V),window.removeEventListener('storage',D),document.removeEventListener('visibilitychange',K);const e=Ll.serviceLocator.get('EventBus');e&&(G&&e.off('display:config-updated',G),e.off('chat:sending',X),e.off('chat:received',Y),e.off('chat:error',Y)),W&&clearInterval(W),u.value&&u.value.removeEventListener('scroll',T),H&&H.disconnect()});return{chatContainerRef:e,messages:t,streamingMessage:a,isTyping:m,formatTime:e=>new Date(e).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),editingId:v,editContent:y,startEdit:j,cancelEdit:()=>{v.value=null,y.value=''},saveEdit:async e=>{if(!e.id)return;await mi.storyDB.updateRecord(e.id,{content:y.value});const a=t.value.find(t=>t.id===e.id);a&&(a.content=y.value),v.value=null,y.value=''},renderContent:(e,t,a=0)=>{if(!e)return'';const n=t?`${t}_${e.length}_${e.slice(0,50)}_v${i.value}`:`${e.slice(0,100)}_v${i.value}`,r=o.get(n);if(void 0!==r)return r;let l=e;if(c&&c.isEnabled()){const t=c.applyAllRules(e,a);t.matchCount>0&&(l=t.modifiedText)}let d=l.trim().replace(/\n{3,}/g,'\n\n');const u=[];let p=0;const m=t??0;let g='';const h=[];let f=0;d=d.replace(/<pic=["']([^"']+)["']\s*\/?>/gi,(e,t)=>{const a=`{{PIC_TAG_${f++}}}`;return h.push({placeholder:a,prompt:t}),a});const v=e=>e?e.startsWith('http://')||e.startsWith('https://')||e.startsWith('data:')||e.startsWith('/')?e:`/${e}`:'';d=d.replace(/{{PIC_TAG_(\d+)}}|!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,a,n)=>{if(void 0!==t){const e=h[parseInt(t)];return e&&(g=e.prompt),''}const r=`{{IMG_PLACEHOLDER_${p}}}`,l=v(n),o=s.sanitize(l),i=a||g,c=s.sanitize(i||'图片'),d=i.replace(/[\r\n]+/g,' ').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');return u.push({placeholder:r,html:`<img src="${o}" alt="${c}" class="chat-image" data-prompt="${d}" data-msg-id="${m}" data-image-index="${p}" onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22100%22><rect fill=%22%23374151%22 width=%22200%22 height=%22100%22/><text fill=%22%239CA3AF%22 x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 dy=%22.3em%22>图片加载失败</text></svg>'; this.classList.add('opacity-50');" />`}),p++,r}),d=d.replace(/<img\s+[^>]*src=["']([^"']+)["'][^>]*>/gi,(e,t)=>{const a=`{{IMG_PLACEHOLDER_${p}}}`,n=v(t),r=s.sanitize(n);return u.push({placeholder:a,html:`<img src="${r}" alt="生成图片" class="chat-image" data-prompt="" data-msg-id="${m}" data-image-index="${p}" onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22100%22><rect fill=%22%23374151%22 width=%22200%22 height=%22100%22/><text fill=%22%239CA3AF%22 x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 dy=%22.3em%22>图片加载失败</text></svg>'; this.classList.add('opacity-50');" />`}),p++,a});const y=[];let b=0;d=d.replace(/\{color:([^}]+)\}([\s\S]*?)\{\/color\}/gi,(e,t,a)=>{const n=`{{COLOR_PLACEHOLDER_${b++}}}`,r=/^(#[0-9a-fA-F]{3,8}|[a-zA-Z]+|rgb\([^)]+\)|rgba\([^)]+\))$/.test(t.trim())?t.trim():'inherit';return y.push({placeholder:n,html:`<span style="color: ${r}">${s.sanitize(a)}</span>`}),n});let x=d.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/```([\s\S]*?)```/g,'<pre class="bg-[#202225]/80 p-3 rounded my-2 overflow-x-auto border border-gray-700 text-sm"><code>$1</code></pre>').replace(/`([^`]+)`/g,'<code class="bg-[#202225]/60 px-1.5 py-0.5 rounded text-sm font-mono text-pink-300 border border-gray-700/50">$1</code>').replace(/\*\*(.*?)\*\*/g,'<strong class="text-white font-semibold">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-gray-400 italic">$1</em>').replace(/^&gt; (.*$)/gm,'<blockquote class="border-l-4 border-amber-500/50 pl-3 py-1 my-1 text-amber-200/80 italic bg-amber-900/10 rounded-r">$1</blockquote>').replace(/~~(.*?)~~/g,'<del class="text-gray-500 line-through">$1</del>').replace(/__(.*?)__/g,'<u class="underline decoration-gray-500">$1</u>').replace(/^---$/gm,'<hr class="border-gray-600 my-4" />').replace(/\n/g,'<br>');for(const{placeholder:e,html:t}of u)x=x.replace(e,t);for(const{placeholder:e,html:t}of y)x=x.replace(e,t);const w=s.sanitize(x,{ALLOWED_TAGS:['strong','em','code','pre','blockquote','br','img','span','del','u','hr'],ALLOWED_ATTR:['class','style','src','alt','loading','onerror','data-prompt','data-msg-id','data-image-index'],ALLOW_DATA_ATTR:!0});if(o.size>=100){const e=o.keys().next().value;e&&o.delete(e)}return o.set(n,w),w},confirmRewind:async e=>{L(e)},getMessageDepth:e=>{if(!e.id)return 0;const a=t.value.findIndex(t=>t.id===e.id);return-1===a?0:t.value.length-1-a},displayConfig:n,containerStyle:r,messageStyle:l,contextMenu:b,showContextMenu:(e,t)=>{if(v.value===t.id)return;let a=e.clientX,s=e.clientY;a+180>window.innerWidth&&(a=window.innerWidth-180-10),s+200>window.innerHeight&&(s=window.innerHeight-200-10),b.x=a,b.y=s,b.targetMsg=t,b.visible=!0},closeContextMenu:O,handleTouchStart:(e,t)=>{v.value!==t.id&&(C=setTimeout(()=>{const a=e.touches[0];if(a){const e=180,s=200;let n=a.clientX,r=a.clientY;n+e>window.innerWidth&&(n=window.innerWidth-e-10),r+s>window.innerHeight&&(r=window.innerHeight-s-10),b.x=n,b.y=r,b.targetMsg=t,b.visible=!0}},500))},handleTouchEnd:()=>{C&&(clearTimeout(C),C=null)},handleMenuEdit:()=>{b.targetMsg&&j(b.targetMsg),O()},handleMenuResend:async()=>{if(!b.targetMsg)return void O();const e=b.targetMsg;O();const t=Ll.serviceLocator.get('EventBus');t.emit('chat:sending'),'user'===e.role?t.emit('chat:resend',{messageId:e.id,content:e.content}):t.emit('chat:regenerate',{messageId:e.id})},handleMenuCopy:async()=>{if(b.targetMsg)try{await navigator.clipboard.writeText(b.targetMsg.content),console.log('已复制到剪贴板')}catch(e){console.error('复制失败:',e);const t=document.createElement('textarea');t.value=b.targetMsg.content,document.body.appendChild(t),t.select(),document.execCommand('copy'),document.body.removeChild(t)}O()},handleMenuDelete:()=>{b.targetMsg&&L(b.targetMsg),O()},deleteConfirm:x,showDeleteConfirm:L,cancelDelete:B,executeDelete:async()=>{const e=x.targetMsg;if(!e||!e.id)return void B();const t=Ll.serviceLocator.get('SaveService'),a=Ll.serviceLocator.get('EventBus'),s=await mi.storyDB.getSnapshotBefore(e.timestamp);if(s){const e=t.getGameState();e&&(Object.assign(e,JSON.parse(JSON.stringify(s.gameState))),await t.saveData('Snapshot restored after message deletion'),console.log(`Game state restored to snapshot ${s.id} (version ${s.version})`),a.emit('state:updated'))}else console.warn('No snapshot found before message timestamp, state might be desynced');await mi.storyDB.deleteSnapshotsAfter(e.timestamp),console.log(`Deleted snapshots from timestamp: ${e.timestamp} and onwards`),await mi.storyDB.deleteRecordsFromId(e.id),console.log(`Deleted messages from id: ${e.id} and onwards`),B(),await R()},showScrollToBottom:d,scrollButtonStyle:I,scrollToBottom:A,isWaitingForResponse:g,loadingText:h,imagePreview:w,closeImagePreview:()=>{w.visible=!1},imageMenu:k,closeImageMenu:U,handleImageRegenerate:async()=>{const e=k.prompt,a=k.msgId;if(U(),!e)return void console.warn('没有可用的 prompt 进行重新生成');let s,n;S.value=!0;try{n=Ll.serviceLocator.get('BackgroundTaskService');const{taskId:e}=n.createTask(Rl.IMAGE_GENERATE,'图片生成中');s=e,n.startTask(s)}catch(e){console.warn('BackgroundTaskService 不可用:',e)}try{let r;try{r=Ll.serviceLocator.get('ImageGenService')}catch{return console.error('ImageGenService 不可用'),void(s&&n&&n.setTaskError(s,'ImageGenService 不可用'))}const l=await r.generateCustom(e,{quiet:!1});if(l.success&&l.imageUrl){const i=r.resolveImageUrl(l.imageUrl),c=t.value.find(e=>e.id===a);if(c){const t=`\n![${e}](${i})\n`,r=c.content+t;await mi.storyDB.updateRecord(a,{content:r}),o.clear(),await R(),console.log('图片重新生成成功'),s&&n&&n.completeTask(s)}}else console.error('图片生成失败:',l.error),s&&n&&n.setTaskError(s,l.error||'生成失败')}catch(e){console.error('重新生成图片时出错:',e),s&&n&&n.setTaskError(s,e instanceof Error?e.message:'未知错误')}finally{S.value=!1}},handleImageDelete:async()=>{const e=k.msgId,a=k.imageIndex;U();const s=t.value.find(t=>t.id===e);if(!s)return;const n=[...s.content.matchAll(/!\[[^\]]*\]\([^)]+\)/g)];if(a>=0&&a<n.length){const t=n[a],r=s.content.slice(0,t.index)+s.content.slice(t.index+t[0].length);await mi.storyDB.updateRecord(e,{content:r}),o.clear(),await R(),console.log('图片已删除')}else console.warn('无法找到要删除的图片')},handleImageOpenInNew:()=>{const e=k.url;U(),window.open(e,'_blank')},handleImageCopyUrl:async()=>{const e=k.url;U();try{await navigator.clipboard.writeText(e),console.log('图片链接已复制')}catch(e){console.error('复制失败:',e)}},handleImageClick:e=>{const t=e.target;if('IMG'===t.tagName&&t.classList.contains('chat-image')){e.preventDefault(),e.stopPropagation();const s=t;a={url:s.src,prompt:s.dataset.prompt||s.alt||'',msgId:parseInt(s.dataset.msgId||'0',10),imageIndex:parseInt(s.dataset.imageIndex||'0',10)},w.url=a.url,w.prompt=a.prompt,w.msgId=a.msgId,w.imageIndex=a.imageIndex,w.visible=!0}var a},handleImageContextMenu:e=>{const t=e.target;if('IMG'===t.tagName&&t.classList.contains('chat-image')){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const a=t;q(e,{url:a.src,prompt:a.dataset.prompt||a.alt||'',msgId:parseInt(a.dataset.msgId||'0',10),imageIndex:parseInt(a.dataset.imageIndex||'0',10)})}},handleImageTouchStart:e=>{const t=e.target;if('IMG'===t.tagName&&t.classList.contains('chat-image')){e.stopPropagation(),e.stopImmediatePropagation();const a=t,s=e.touches[0];V=setTimeout(()=>{q(s,{url:a.src,prompt:a.dataset.prompt||a.alt||'',msgId:parseInt(a.dataset.msgId||'0',10),imageIndex:parseInt(a.dataset.imageIndex||'0',10)})},500)}},handleImageTouchEnd:()=>{V&&(clearTimeout(V),V=null)},isRegeneratingImage:S}}}),Qy=(0,$u.A)(Wy,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',{ref:'chatContainerRef',class:'relative flex flex-col p-4 pb-0',style:X(e.containerStyle)},[Rn(' Scroll to Bottom Button '),En(wr,{name:'fade-slide'},{default:ba(()=>[e.showScrollToBottom?(yn(),Sn('button',{key:0,class:'fixed z-10 flex h-10 w-10 items-center justify-center rounded-full bg-blue-600/50 text-white/80 shadow-lg backdrop-blur-sm transition-all hover:bg-blue-600/80 hover:text-white hover:shadow-xl active:scale-95',style:X(e.scrollButtonStyle),title:'回到底部',onClick:t[0]||(t[0]=(...t)=>e.scrollToBottom&&e.scrollToBottom(...t))},[...t[30]||(t[30]=[Mn('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 14l-7 7m0 0l-7-7m7 7V3'})],-1)])],4)):Rn('v-if',!0)]),_:1}),(yn(!0),Sn(pn,null,xs(e.messages,a=>(yn(),Sn('div',{key:a.id,class:ee(['group relative flex flex-col transition-all',{'items-end':'user'===a.role,'items-start':'user'!==a.role}])},[Rn(' Message Bubble '),Mn('div',{class:ee(['message-bubble relative leading-relaxed whitespace-pre-wrap',['user'===a.role?'user-message':'ai-message',e.displayConfig.compactMode?'compact':'',e.editingId===a.id?'select-text':'no-select']]),style:X(e.messageStyle),onContextmenu:Cl(t=>e.showContextMenu(t,a),['prevent']),onTouchstart:t=>e.handleTouchStart(t,a),onTouchend:t[8]||(t[8]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t)),onTouchmove:t[9]||(t[9]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Rn(' Header removed as requested '),Rn(' Content (View Mode) '),Rn(' eslint-disable-next-line vue/no-v-html -- Content is sanitized by DOMPurify in renderContent() '),e.editingId!==a.id?(yn(),Sn('div',{key:0,class:'markdown-content min-h-[1.5em]',onClick:t[1]||(t[1]=(...t)=>e.handleImageClick&&e.handleImageClick(...t)),onContextmenu:t[2]||(t[2]=(...t)=>e.handleImageContextMenu&&e.handleImageContextMenu(...t)),onTouchstart:t[3]||(t[3]=(...t)=>e.handleImageTouchStart&&e.handleImageTouchStart(...t)),onTouchend:t[4]||(t[4]=(...t)=>e.handleImageTouchEnd&&e.handleImageTouchEnd(...t)),onTouchmove:t[5]||(t[5]=(...t)=>e.handleImageTouchEnd&&e.handleImageTouchEnd(...t)),innerHTML:e.renderContent(a.content,a.id,e.getMessageDepth(a))},null,40,Ey)):(yn(),Sn(pn,{key:1},[Rn(' Content (Edit Mode) '),Mn('div',$y,[xa(Mn('textarea',{'onUpdate:modelValue':t[6]||(t[6]=t=>e.editContent=t),class:'box-border min-h-[150px] w-full max-w-full resize-y rounded bg-[#202225] p-3 text-gray-200 outline-none focus:ring-1 focus:ring-blue-500 sm:min-h-[200px]',rows:'8'},null,512),[[fl,e.editContent]]),Mn('div',Dy,[Mn('button',{class:'rounded px-2 py-1 text-xs text-gray-400 hover:bg-gray-700 hover:text-white',onClick:t[7]||(t[7]=(...t)=>e.cancelEdit&&e.cancelEdit(...t))},' 取消 '),Mn('button',{class:'rounded bg-blue-600 px-3 py-1 text-xs font-bold text-white hover:bg-blue-500',onClick:t=>e.saveEdit(a)},' 保存 ',8,Py)])])],2112))],46,My)],2))),128)),Rn(' Streaming Message '),e.streamingMessage?(yn(),Sn('div',Ny,[Mn('div',{class:ee(['message-bubble ai-message relative leading-relaxed whitespace-pre-wrap select-text',e.displayConfig.compactMode?'compact':'']),style:X(e.messageStyle)},[Rn(' eslint-disable-next-line vue/no-v-html '),Mn('div',{class:'markdown-content min-h-[1.5em]',innerHTML:e.renderContent(e.streamingMessage.content,0,0)},null,8,Ry)],6)])):Rn('v-if',!0),Rn(' Loading Indicator (Teleport to body for fixed positioning) '),(yn(),_n(Ra,{to:'body'},[En(wr,{name:'loading-slide'},{default:ba(()=>[e.isWaitingForResponse?(yn(),Sn('div',jy,[Mn('div',Ly,[t[31]||(t[31]=Mn('div',{class:'loading-dots'},[Mn('span',{class:'loading-dot',style:{'animation-delay':'0ms'}}),Mn('span',{class:'loading-dot',style:{'animation-delay':'150ms'}}),Mn('span',{class:'loading-dot',style:{'animation-delay':'300ms'}})],-1)),Mn('span',By,oe(e.loadingText),1)])])):Rn('v-if',!0)]),_:1})])),Rn(' Context Menu '),(yn(),_n(Ra,{to:'body'},[e.contextMenu.visible?(yn(),Sn('div',{key:0,class:'context-menu',style:X({top:e.contextMenu.y+'px',left:e.contextMenu.x+'px'}),onClick:t[14]||(t[14]=Cl(()=>{},['stop']))},[Mn('div',Oy,[Rn(' 编辑信息 '),Mn('button',{class:'context-menu-item',onClick:t[10]||(t[10]=(...t)=>e.handleMenuEdit&&e.handleMenuEdit(...t))},[...t[32]||(t[32]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'})],-1),Mn('span',null,'编辑信息',-1)])]),Rn(' 重新发送 '),Mn('button',{class:'context-menu-item',onClick:t[11]||(t[11]=(...t)=>e.handleMenuResend&&e.handleMenuResend(...t))},[...t[33]||(t[33]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15'})],-1),Mn('span',null,'重新发送',-1)])]),Rn(' 复制信息 '),Mn('button',{class:'context-menu-item',onClick:t[12]||(t[12]=(...t)=>e.handleMenuCopy&&e.handleMenuCopy(...t))},[...t[34]||(t[34]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z'})],-1),Mn('span',null,'复制信息',-1)])]),Rn(' 分隔线 '),t[36]||(t[36]=Mn('div',{class:'context-menu-divider'},null,-1)),Rn(' 删除信息 '),Mn('button',{class:'context-menu-item danger',onClick:t[13]||(t[13]=(...t)=>e.handleMenuDelete&&e.handleMenuDelete(...t))},[...t[35]||(t[35]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1),Mn('span',null,'删除信息',-1)])])])],4)):Rn('v-if',!0),Rn(' 点击其他区域关闭菜单的遮罩 '),e.contextMenu.visible?(yn(),Sn('div',{key:1,class:'fixed inset-0 z-9998',onClick:t[15]||(t[15]=(...t)=>e.closeContextMenu&&e.closeContextMenu(...t)),onContextmenu:t[16]||(t[16]=Cl((...t)=>e.closeContextMenu&&e.closeContextMenu(...t),['prevent']))},null,32)):Rn('v-if',!0),Rn(' 删除确认弹窗 '),En(wr,{name:'modal-fade'},{default:ba(()=>[e.deleteConfirm.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-10000 flex items-center justify-center bg-black/60 backdrop-blur-sm',onClick:t[19]||(t[19]=Cl((...t)=>e.cancelDelete&&e.cancelDelete(...t),['self']))},[Mn('div',qy,[Rn(' 标题栏 '),t[39]||(t[39]=Mn('div',{class:'flex items-center gap-2 border-b border-gray-600 bg-[#25262b] px-3 py-2.5 sm:gap-3 sm:px-5 sm:py-4'},[Mn('div',{class:'flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-red-500/20 sm:h-10 sm:w-10'},[Mn('svg',{class:'h-4 w-4 text-red-400 sm:h-5 sm:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z'})])]),Mn('div',null,[Mn('h3',{class:'text-sm font-bold text-white sm:text-lg'},'删除确认'),Mn('p',{class:'text-[10px] text-gray-400 sm:text-sm'},'此操作无法撤销')])],-1)),Rn(' 内容区域 '),Mn('div',Uy,[t[38]||(t[38]=Mn('p',{class:'text-[11px] text-gray-300 sm:text-base'},[Pn(' 确定要删除此条及之后的'),Mn('span',{class:'font-bold text-red-400'},'所有消息'),Pn('，并回溯游戏状态吗？ ')],-1)),Mn('div',Vy,[t[37]||(t[37]=Mn('p',{class:'text-[9px] text-gray-500 sm:text-xs'},'将被删除的消息数量',-1)),Mn('p',Fy,oe(e.deleteConfirm.deleteCount)+' 条 ',1)])]),Rn(' 按钮区域 '),Mn('div',Hy,[Mn('button',{class:'rounded-lg px-3 py-1.5 text-[11px] font-medium text-gray-300 transition-colors hover:bg-gray-700 hover:text-white sm:px-4 sm:py-2 sm:text-sm',onClick:t[17]||(t[17]=(...t)=>e.cancelDelete&&e.cancelDelete(...t))},' 取消 '),Mn('button',{class:'rounded-lg bg-red-600 px-3 py-1.5 text-[11px] font-bold text-white transition-colors hover:bg-red-500 sm:px-4 sm:py-2 sm:text-sm',onClick:t[18]||(t[18]=(...t)=>e.executeDelete&&e.executeDelete(...t))},' 确认删除 ')])])])):Rn('v-if',!0)]),_:1}),Rn(' ========== 图片预览模态框 ========== '),En(wr,{name:'modal-fade'},{default:ba(()=>[e.imagePreview.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-10000 flex items-center justify-center bg-black/80 backdrop-blur-sm',onClick:t[22]||(t[22]=(...t)=>e.closeImagePreview&&e.closeImagePreview(...t))},[Mn('div',{class:'image-preview-container',onClick:t[21]||(t[21]=Cl(()=>{},['stop']))},[Rn(' 图片 '),Mn('img',{src:e.imagePreview.url,alt:'图片预览',class:'max-h-[90vh] max-w-[90vw] rounded-lg object-contain shadow-2xl'},null,8,Gy),Rn(' 关闭按钮 '),Mn('button',{class:'absolute -top-3 -right-3 flex h-8 w-8 items-center justify-center rounded-full bg-gray-800/90 text-white shadow-lg transition-colors hover:bg-gray-700',onClick:t[20]||(t[20]=(...t)=>e.closeImagePreview&&e.closeImagePreview(...t))},[...t[40]||(t[40]=[Mn('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])])])):Rn('v-if',!0)]),_:1}),Rn(' ========== 图片操作菜单 ========== '),e.imageMenu.visible?(yn(),Sn('div',{key:2,class:'context-menu',style:X({top:e.imageMenu.y+'px',left:e.imageMenu.x+'px'}),onClick:t[27]||(t[27]=Cl(()=>{},['stop']))},[Mn('div',zy,[Rn(' 在新标签页打开 '),Mn('button',{class:'context-menu-item',onClick:t[23]||(t[23]=(...t)=>e.handleImageOpenInNew&&e.handleImageOpenInNew(...t))},[...t[41]||(t[41]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14'})],-1),Mn('span',null,'新标签页打开',-1)])]),Rn(' 重新生成（仅有 prompt 时显示） '),e.imageMenu.prompt?(yn(),Sn('button',{key:0,class:'context-menu-item',onClick:t[24]||(t[24]=(...t)=>e.handleImageRegenerate&&e.handleImageRegenerate(...t))},[t[42]||(t[42]=Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15'})],-1)),Mn('span',null,oe(e.isRegeneratingImage?'生成中...':'重新生成'),1)])):Rn('v-if',!0),Rn(' 复制链接 '),Mn('button',{class:'context-menu-item',onClick:t[25]||(t[25]=(...t)=>e.handleImageCopyUrl&&e.handleImageCopyUrl(...t))},[...t[43]||(t[43]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z'})],-1),Mn('span',null,'复制链接',-1)])]),Rn(' 分隔线 '),t[45]||(t[45]=Mn('div',{class:'context-menu-divider'},null,-1)),Rn(' 删除图片 '),Mn('button',{class:'context-menu-item danger',onClick:t[26]||(t[26]=(...t)=>e.handleImageDelete&&e.handleImageDelete(...t))},[...t[44]||(t[44]=[Mn('svg',{class:'menu-icon',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1),Mn('span',null,'删除图片',-1)])])])],4)):Rn('v-if',!0),Rn(' 图片菜单遮罩 '),e.imageMenu.visible?(yn(),Sn('div',{key:3,class:'fixed inset-0 z-9998',onClick:t[28]||(t[28]=(...t)=>e.closeImageMenu&&e.closeImageMenu(...t)),onContextmenu:t[29]||(t[29]=Cl((...t)=>e.closeImageMenu&&e.closeImageMenu(...t),['prevent']))},null,32)):Rn('v-if',!0)]))],4)}]]),Xy={class:'w-full max-w-md rounded-lg border border-[#202225] bg-[#36393f] shadow-xl'},Yy={class:'flex items-center justify-between border-b border-[#202225] bg-[#2f3136] px-4 py-3'},Ky={class:'font-bold text-white'},Jy={class:'p-4'},Zy={class:'mb-3 text-sm text-gray-400'},eb={class:'text-white'},tb={class:'mt-2 flex flex-wrap gap-1.5'},ab=['onClick'],sb={class:'flex justify-end gap-2 border-t border-[#202225] bg-[#2f3136] px-4 py-3'},nb=['disabled'];const rb=Za({name:'ChatInputModal',props:{visible:{type:Boolean,required:!0},title:{type:String,default:'交谈'},targetName:{type:String,required:!0},targetId:{type:String,default:''},isSceneNpc:{type:Boolean,default:!1},action:{type:String,default:'chat'},quickPhrases:{type:Array,default:()=>['你好','再见','请问...','我想要...','能告诉我更多吗？']}},emits:['close','confirm'],setup(e,{emit:t}){const a=$t(''),s=$t(null);_a(()=>e.visible,e=>{e&&(a.value='',Zt(()=>{s.value?.focus()}))});return{message:a,textareaRef:s,handleConfirm:()=>{a.value.trim()&&(t('confirm',{action:e.action,targetName:e.targetName,targetId:e.targetId,isSceneNpc:e.isSceneNpc,message:a.value}),a.value='')}}}}),lb=(0,$u.A)(rb,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[5]||(t[5]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',Xy,[Mn('div',Yy,[Mn('h3',Ky,oe(e.title),1),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),Mn('div',Jy,[Mn('div',Zy,[t[6]||(t[6]=Pn(' 对 ',-1)),Mn('span',eb,oe(e.targetName),1),t[7]||(t[7]=Pn(' 说： ',-1))]),xa(Mn('textarea',{ref:'textareaRef','onUpdate:modelValue':t[1]||(t[1]=t=>e.message=t),class:'w-full rounded bg-[#40444b] p-3 text-sm text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-[#5865F2] focus:outline-none',rows:'3',placeholder:'输入你想说的话...',onKeydown:t[2]||(t[2]=Tl(Cl((...t)=>e.handleConfirm&&e.handleConfirm(...t),['ctrl']),['enter']))},null,544),[[fl,e.message]]),Mn('div',tb,[(yn(!0),Sn(pn,null,xs(e.quickPhrases,t=>(yn(),Sn('button',{key:t,class:'rounded bg-[#2f3136] px-2 py-1 text-xs text-gray-400 hover:bg-[#40444b] hover:text-white',onClick:a=>e.message=t},oe(t),9,ab))),128))])]),Mn('div',sb,[Mn('button',{class:'rounded bg-[#40444b] px-4 py-2 text-sm text-white hover:bg-[#4a4f57]',onClick:t[3]||(t[3]=t=>e.$emit('close'))},' 取消 '),Mn('button',{class:'rounded bg-[#5865F2] px-4 py-2 text-sm text-white hover:bg-[#4752C4]',disabled:!e.message.trim(),onClick:t[4]||(t[4]=(...t)=>e.handleConfirm&&e.handleConfirm(...t))},' 发送 ',8,nb)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-5e9fbc0e']]),ob={class:'w-full max-w-md rounded-t-xl border border-[#202225] bg-[#36393f] shadow-xl sm:rounded-lg sm:rounded-t-lg'},ib={class:'flex items-center justify-between border-b border-[#202225] bg-[#2f3136] px-3 py-2 sm:px-4 sm:py-3'},cb={class:'flex items-center space-x-2'},db={key:0,class:'rounded-full bg-red-500 px-1.5 py-0.5 text-[10px] font-bold text-white sm:px-2 sm:text-xs'},ub={class:'max-h-[50vh] overflow-y-auto p-3 sm:max-h-[60vh] sm:p-4'},pb={key:0,class:'py-6 text-center sm:py-8'},mb={class:'space-y-2'},gb={class:'flex min-w-0 flex-1 items-center space-x-2 sm:space-x-3'},hb={class:'shrink-0 text-lg sm:text-xl'},fb={class:'min-w-0 flex-1'},vb={class:'truncate text-xs font-medium text-white sm:text-sm'},yb={key:0,class:'truncate text-[10px] text-gray-400 sm:text-xs'},bb={key:1,class:'truncate text-[10px] text-gray-500 sm:text-xs'},xb=['onClick'],wb={key:0,class:'flex items-center justify-between border-t border-[#202225] bg-[#2f3136] px-3 py-2 sm:px-4 sm:py-3'};const kb=Za({name:'CommandQueueModal',props:{visible:{type:Boolean,default:!1}},emits:['close'],setup(e,{emit:t}){const{commands:a}=Xo();return{commands:a,getIcon:e=>Fo[e]?.icon||'📝',getName:e=>Fo[e]?.name||'未知',getPromptPreview:e=>{const t=Fo[e.type];if(!t)return'';let a=t.promptTemplate.replace(/\{\{playerName\}\}/g,'玩家').replace(/\{\{targetName\}\}/g,e.targetName).replace(/\{\{message\}\}/g,'...');if(e.type===Vo.TRAVEL&&e.exitInfo){const t=e.exitInfo.direction?` (${e.exitInfo.direction})`:'';a=a.replace(/\{\{direction\}\}/g,t)}else a=a.replace(/\{\{direction\}\}/g,'');return e.type===Vo.GIFT&&e.giftInfo&&(a=a.replace(/\{\{itemName\}\}/g,e.giftInfo.itemName).replace(/\{\{quantity\}\}/g,String(e.giftInfo.quantity)).replace(/\{\{quality\}\}/g,e.giftInfo.quality).replace(/\{\{totalValue\}\}/g,String(e.giftInfo.totalValue))),a.length>40&&(a=a.substring(0,40)+'...'),a},removeCommand:e=>{Ll.serviceLocator.get('CommandQueueService').removeCommand(e)},clearAll:()=>{Ll.serviceLocator.get('CommandQueueService').clearAll()}}}}),Sb=(0,$u.A)(kb,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-end justify-center bg-black/60 p-2 sm:items-center sm:p-4',onClick:t[3]||(t[3]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',ob,[Rn(' Header '),Mn('div',ib,[Mn('div',cb,[t[4]||(t[4]=Mn('span',{class:'text-base sm:text-lg'},'📋',-1)),t[5]||(t[5]=Mn('h3',{class:'text-sm font-bold text-white sm:text-base'},'待执行指令',-1)),e.commands.length>0?(yn(),Sn('span',db,oe(e.commands.length),1)):Rn('v-if',!0)]),Mn('button',{class:'p-1 text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),Rn(' Content '),Mn('div',ub,[Rn(' 空状态 '),0===e.commands.length?(yn(),Sn('div',pb,[...t[6]||(t[6]=[Mn('div',{class:'mb-2 text-2xl sm:text-3xl'},'📭',-1),Mn('p',{class:'text-xs text-gray-500 sm:text-sm'},'暂无待执行指令',-1),Mn('p',{class:'mt-1 text-[10px] text-gray-600 sm:text-xs'},' 在人际关系面板中对角色进行交互后，指令会显示在这里 ',-1)])])):(yn(),Sn(pn,{key:1},[Rn(' 指令列表 '),Mn('div',mb,[t[8]||(t[8]=Mn('div',{class:'mb-2 text-[10px] text-gray-400 sm:mb-3 sm:text-xs'},' 以下指令将在你发送下一条消息时一起提交给AI： ',-1)),(yn(!0),Sn(pn,null,xs(e.commands,a=>(yn(),Sn('div',{key:a.id,class:'group flex items-center justify-between rounded-lg bg-[#2f3136] p-2 transition-colors hover:bg-[#40444b] sm:p-3'},[Mn('div',gb,[Rn(' 图标 '),Mn('span',hb,oe(e.getIcon(a.type)),1),Rn(' 内容 '),Mn('div',fb,[Mn('div',vb,oe(e.getName(a.type))+': '+oe(a.targetName),1),a.message?(yn(),Sn('div',yb,' "'+oe(a.message)+'" ',1)):(yn(),Sn('div',bb,oe(e.getPromptPreview(a)),1))])]),Rn(' 撤销按钮 - 移动端始终显示 '),Mn('button',{class:'ml-2 shrink-0 rounded p-1 text-gray-400 opacity-100 transition-all hover:bg-red-500/20 hover:text-red-400 sm:p-1.5 sm:opacity-0 sm:group-hover:opacity-100',title:'撤销此指令',onClick:t=>e.removeCommand(a.id)},[...t[7]||(t[7]=[Mn('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])],8,xb)]))),128))])],2112))]),Rn(' Footer '),e.commands.length>0?(yn(),Sn('div',wb,[Mn('button',{class:'rounded bg-red-500/20 px-2 py-1 text-xs text-red-400 transition-colors hover:bg-red-500/30 sm:px-3 sm:py-1.5 sm:text-sm',onClick:t[1]||(t[1]=(...t)=>e.clearAll&&e.clearAll(...t))},' 全部撤销 '),Mn('button',{class:'rounded bg-[#5865F2] px-3 py-1 text-xs text-white transition-colors hover:bg-[#4752C4] sm:px-4 sm:py-1.5 sm:text-sm',onClick:t[2]||(t[2]=t=>e.$emit('close'))},' 确认 ')])):Rn('v-if',!0)])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-051eebbe']]),_b={class:'gift-select-modal mx-2 flex h-[85vh] w-full max-w-md flex-col rounded-xl border border-gray-600 bg-[#2f3136] shadow-2xl sm:mx-4 sm:h-[70vh]'},Cb={class:'flex shrink-0 items-center justify-between rounded-t-xl border-b border-gray-700 bg-[#202225] px-3 py-2 sm:px-4 sm:py-3'},Ib={class:'flex items-center gap-2'},Tb={class:'text-sm font-bold text-white sm:text-base'},Ab={class:'flex flex-1 flex-col overflow-hidden p-3 sm:p-4'},Mb={class:'mb-3 flex-1 overflow-y-auto'},Eb={key:0,class:'flex h-32 items-center justify-center text-sm text-gray-500'},$b={class:'grid grid-cols-1 gap-1.5 sm:gap-2'},Db=['onClick'],Pb={class:'flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-[#202225] text-lg sm:h-10 sm:w-10 sm:text-xl'},Nb={class:'min-w-0 flex-1'},Rb={class:'flex items-center gap-1.5'},jb={class:'truncate text-sm font-medium text-white'},Lb={class:'flex items-center gap-2 text-[10px] text-gray-400'},Bb={key:0},Ob={key:1,class:'text-yellow-400'},qb={key:0,class:'shrink-0 text-[#5865f2]'},Ub={key:0,class:'mb-2 shrink-0 sm:mb-3'},Vb={class:'flex items-center justify-center gap-2 sm:gap-3'},Fb=['disabled'],Hb={class:'w-16 text-center sm:w-20'},Gb={class:'text-lg font-bold text-white sm:text-xl'},zb=['disabled'],Wb={key:1,class:'shrink-0 rounded-lg bg-[#202225] p-2'},Qb={class:'flex flex-wrap items-center justify-between gap-1 text-xs sm:text-sm'},Xb={class:'text-gray-300'},Yb={class:'text-yellow-400'},Kb={key:0,class:'mt-1 line-clamp-2 text-[10px] text-gray-500 italic'},Jb={class:'flex shrink-0 gap-2 rounded-b-xl border-t border-gray-700 bg-[#202225]/50 px-3 py-2.5 sm:px-4 sm:py-3'},Zb=['disabled'];const ex=Za({name:'GiftSelectModal',props:{visible:{type:Boolean,default:!1},targetName:{type:String,required:!0},targetId:{type:String,default:''},isSceneNpc:{type:Boolean,default:!1},inventory:{type:Object,default:()=>({})}},emits:['cancel','confirm'],setup(e,{emit:t}){const a=$t(null),s=$t(1);_a(()=>e.visible,e=>{e&&(a.value=null,s.value=1)});const n=ir(()=>{if(!e.inventory)return[];const t=(()=>{try{return Ll.serviceLocator.get('CommandQueueService')}catch{return null}})();return Object.values(e.inventory).filter(e=>!!e.id&&!(!e.count||e.count<=0)).map(e=>{const a=t?.getReservedGiftCount(e.id)||0,s=Math.max(0,e.count-a);return{...e,availableCount:s}}).sort((e,t)=>e.availableCount>0&&0===t.availableCount?-1:0===e.availableCount&&t.availableCount>0?1:(t.value||0)-(e.value||0))}),r=ir(()=>a.value&&n.value.find(e=>e.id===a.value)||null),l=ir(()=>r.value?(r.value.value||0)*s.value:0),o=ir(()=>r.value&&s.value>0&&r.value.availableCount>=s.value);return{selectedItemId:a,quantity:s,giftableItems:n,selectedItem:r,totalValue:l,canConfirm:o,selectItem:e=>{e.availableCount<=0||!e.id||(a.value===e.id?(a.value=null,s.value=1):(a.value=e.id,s.value=1))},increaseQuantity:()=>{r.value&&s.value<r.value.availableCount&&s.value++},decreaseQuantity:()=>{s.value>1&&s.value--},translateQuality:e=>({Common:'普通',Uncommon:'优良',Rare:'稀有',Epic:'史诗',Legendary:'传说'}[e||'Common']||e||'普通'),getQualityColor:e=>({Common:'text-gray-400',Uncommon:'text-green-400',Rare:'text-blue-400',Epic:'text-purple-400',Legendary:'text-orange-400'}[e||'Common']||'text-gray-400'),handleConfirm:()=>{o.value&&r.value&&t('confirm',{targetName:e.targetName,targetId:e.targetId,isSceneNpc:e.isSceneNpc,giftInfo:{itemId:r.value.id,itemName:r.value.name,quantity:s.value,quality:r.value.quality||'Common',desc:r.value.desc,unitValue:r.value.value||0,totalValue:l.value,emoji:r.value.emoji,inventoryCount:r.value.count}})}}}}),tx=(0,$u.A)(ex,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-[80] flex items-center justify-center bg-black/70 backdrop-blur-sm',onClick:t[5]||(t[5]=Cl(t=>e.$emit('cancel'),['self']))},[Mn('div',_b,[Rn(' Header '),Mn('div',Cb,[Mn('div',Ib,[t[6]||(t[6]=Mn('span',{class:'text-base'},'🎁',-1)),Mn('h3',Tb,'送给 '+oe(e.targetName),1)]),Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full text-xs text-gray-400 transition-colors hover:bg-gray-700 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('cancel'))},' ✕ ')]),Rn(' Content '),Mn('div',Ab,[Rn(' 物品列表 '),Mn('div',Mb,[t[8]||(t[8]=Mn('div',{class:'mb-2 text-xs font-bold text-gray-500'},'选择礼物',-1)),Rn(' 空状态 '),0===e.giftableItems.length?(yn(),Sn('div',Eb,' 背包中没有可以赠送的物品 ')):(yn(),Sn(pn,{key:1},[Rn(' 物品网格 '),Mn('div',$b,[(yn(!0),Sn(pn,null,xs(e.giftableItems,a=>(yn(),Sn('div',{key:a.id,class:ee(['flex cursor-pointer items-center gap-2 rounded-lg border p-2 transition-all sm:gap-3',e.selectedItemId===a.id?'border-[#5865f2] bg-[#5865f2]/20':a.availableCount>0?'border-gray-600 bg-[#40444b] hover:border-gray-500':'cursor-not-allowed border-gray-700 bg-[#40444b]/50 opacity-50']),onClick:t=>a.availableCount>0&&e.selectItem(a)},[Rn(' 物品图标 '),Mn('div',Pb,oe(a.emoji||'📦'),1),Rn(' 物品信息 '),Mn('div',Nb,[Mn('div',Rb,[Mn('span',jb,oe(a.name),1),Mn('span',{class:ee(['text-[10px]',e.getQualityColor(a.quality)])},oe(e.translateQuality(a.quality)),3)]),Mn('div',Lb,[Mn('span',null,'单价: '+oe(a.value||0)+'铜币',1),t[7]||(t[7]=Mn('span',null,'·',-1)),a.availableCount===a.count?(yn(),Sn('span',Bb,' 可用: '+oe(a.count),1)):(yn(),Sn('span',Ob,' 可用: '+oe(a.availableCount)+'/'+oe(a.count),1))])]),Rn(' 选中指示器 '),e.selectedItemId===a.id?(yn(),Sn('div',qb,'✓')):Rn('v-if',!0)],10,Db))),128))])],2112))]),Rn(' 数量选择 (只有选中物品且数量>1时显示) '),e.selectedItem&&e.selectedItem.availableCount>1?(yn(),Sn('div',Ub,[t[11]||(t[11]=Mn('div',{class:'mb-1.5 text-xs font-bold text-gray-500 sm:mb-2'},'赠送数量',-1)),Mn('div',Vb,[Mn('button',{class:'flex h-9 w-9 items-center justify-center rounded-lg bg-[#40444b] text-white transition-colors hover:bg-[#5865f2] active:scale-95 disabled:opacity-50 sm:h-8 sm:w-8',disabled:e.quantity<=1,onClick:t[1]||(t[1]=(...t)=>e.decreaseQuantity&&e.decreaseQuantity(...t))},[...t[9]||(t[9]=[Mn('span',{class:'text-lg font-bold'},'−',-1)])],8,Fb),Mn('div',Hb,[Mn('span',Gb,oe(e.quantity),1)]),Mn('button',{class:'flex h-9 w-9 items-center justify-center rounded-lg bg-[#40444b] text-white transition-colors hover:bg-[#5865f2] active:scale-95 disabled:opacity-50 sm:h-8 sm:w-8',disabled:e.quantity>=e.selectedItem.availableCount,onClick:t[2]||(t[2]=(...t)=>e.increaseQuantity&&e.increaseQuantity(...t))},[...t[10]||(t[10]=[Mn('span',{class:'text-lg font-bold'},'+',-1)])],8,zb)])])):Rn('v-if',!0),Rn(' 礼物预览 '),e.selectedItem?(yn(),Sn('div',Wb,[t[12]||(t[12]=Mn('div',{class:'mb-1 text-[10px] font-bold text-gray-500'},'礼物预览',-1)),Mn('div',Qb,[Mn('span',Xb,' 「'+oe(e.selectedItem.name)+'」×'+oe(e.quantity),1),Mn('span',Yb,' 总价值: '+oe(e.totalValue)+' 铜币 ',1)]),e.selectedItem.desc?(yn(),Sn('div',Kb,oe(e.selectedItem.desc),1)):Rn('v-if',!0)])):Rn('v-if',!0)]),Rn(' Footer '),Mn('div',Jb,[Mn('button',{class:'flex-1 rounded-lg bg-gray-700 py-2.5 text-sm font-bold text-gray-300 transition-colors hover:bg-gray-600 active:scale-[0.98] sm:py-2 sm:text-xs',onClick:t[3]||(t[3]=t=>e.$emit('cancel'))},' 取消 '),Mn('button',{class:'flex-1 rounded-lg bg-[#5865f2] py-2.5 text-sm font-bold text-white transition-colors hover:bg-[#4752C4] active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-50 sm:py-2 sm:text-xs',disabled:!e.canConfirm,onClick:t[4]||(t[4]=(...t)=>e.handleConfirm&&e.handleConfirm(...t))},' 确认送礼 ',8,Zb)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-0064dcb2']]),ax={class:'relative'},sx=['disabled'],nx=['disabled'];const rx=Za({name:'InputArea',setup(){const e=$t(''),t=$t(''),a=$t(!1);let s=null,n=null,r=null,l=null,o=null;us(()=>{const e=Ll.serviceLocator.get('EventBus');e&&(s=()=>{a.value=!0},n=()=>{a.value=!0},r=()=>{a.value=!1},l=()=>{a.value=!1},o=()=>{a.value=!1},e.on('chat:sending',s),e.on(gi,n),e.on(hi,r),e.on(fi,l),e.on(vi,o))}),gs(()=>{const e=Ll.serviceLocator.get('EventBus');e&&(s&&e.off('chat:sending',s),n&&e.off(gi,n),r&&e.off(hi,r),l&&e.off(fi,l),o&&e.off(vi,o))}),_a(e,()=>{t.value&&(t.value='')});const i=async()=>{if(!e.value.trim()&&!zo.value||a.value)return;const s=e.value,n=t.value;e.value='',t.value='',a.value=!0;const r=Ll.serviceLocator.get('EventBus');console.log('[InputArea] 触发 chat:sending 事件'),r.emit('chat:sending');try{const e=Ll.serviceLocator.get('CommandQueueService'),t=e.generatePromptPrefix(),a=t?`${t}\n${s}`:s;console.log('[InputArea] 最终发送内容:',a),n&&console.log('[InputArea] Hidden instructions:',n);const r=Ll.serviceLocator.get('LLMService');await r.advanceStory(a,n||void 0),e.clearAll()}catch(e){console.error('Failed to send message:',e),r.emit('chat:error')}finally{a.value=!1}};return{inputText:e,hiddenInstructions:t,isProcessing:a,hasCommands:zo,handleEnter:e=>{e.shiftKey||i()},sendMessage:i,stopGeneration:async()=>{try{const e=Ll.serviceLocator.get('LLMService');await e.stopGeneration();Ll.serviceLocator.get('EventBus').emit('chat:received')}catch(e){console.error(e)}finally{a.value=!1}}}}}),lx=(0,$u.A)(rx,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',ax,[xa(Mn('textarea',{'onUpdate:modelValue':t[0]||(t[0]=t=>e.inputText=t),placeholder:'你要做什么？',class:'scrollbar-thin scrollbar-thumb-[#202225] w-full resize-none rounded-lg bg-[#40444b] p-3 pr-12 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:outline-none',rows:'1',disabled:e.isProcessing,onKeydown:t[1]||(t[1]=Tl(Cl((...t)=>e.handleEnter&&e.handleEnter(...t),['prevent']),['enter']))},null,40,sx),[[fl,e.inputText]]),Rn(' Send Button '),e.isProcessing?(yn(),Sn(pn,{key:1},[Rn(' Stop Button '),Mn('button',{class:'absolute top-1/2 right-3 -translate-y-1/2 animate-pulse p-2 text-red-400 transition-colors hover:text-red-300',onClick:t[3]||(t[3]=(...t)=>e.stopGeneration&&e.stopGeneration(...t))},[...t[5]||(t[5]=[Mn('svg',{class:'h-6 w-6',fill:'currentColor',viewBox:'0 0 24 24'},[Mn('rect',{x:'6',y:'6',width:'12',height:'12'})],-1)])])],2112)):(yn(),Sn('button',{key:0,disabled:!e.inputText.trim()&&!e.hasCommands,class:'absolute top-1/2 right-3 -translate-y-1/2 p-2 text-gray-400 transition-colors hover:text-white disabled:opacity-50',onClick:t[2]||(t[2]=(...t)=>e.sendMessage&&e.sendMessage(...t))},[...t[4]||(t[4]=[Mn('svg',{class:'h-6 w-6',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 19l9 2-9-18-9 18 9-2zm0 0v-8'})],-1)])],8,nx))])}]]),ox={class:'flex items-center gap-3'},ix={class:'flex-1'},cx={class:'text-lg font-bold text-white sm:text-xl'},dx={class:'mt-1 flex items-center gap-2'},ux={class:'text-xs text-gray-300'},px={class:'modal-content custom-scrollbar'},mx={key:0,class:'content-section'},gx={class:'text-sm whitespace-pre-wrap text-gray-300'},hx={key:1,class:'content-section'},fx={class:'effects-list'},vx={class:'effect-icons'},yx={key:0,class:'text-lg'},bx={class:'effect-info'},xx={class:'effect-text'},wx={key:0,class:'effect-meta'},kx={key:0,class:'meta-tag trigger'},Sx={key:1,class:'meta-tag chance'},_x={key:2,class:'meta-tag duration'},Cx={class:'content-section'},Ix={class:'properties-grid'},Tx={key:0,class:'property-item'},Ax={class:'property-value'},Mx={key:1,class:'property-item'},Ex={class:'property-value'},$x={key:2,class:'property-item'},Dx={class:'property-value'},Px={key:3,class:'property-item'},Nx={class:'property-value'},Rx={key:4,class:'property-item'},jx={class:'property-value'},Lx={class:'modal-footer'},Bx=['disabled'],Ox=['disabled'];const qx=['Common','Uncommon','Rare','Epic','Legendary','Mythic'],Ux={Common:{level:0,name:'普通',color:'#9d9d9d',tailwind:'text-gray-400',borderColor:'#4a4a4a',priceMultiplier:1,effectMultiplier:1,maxAffixes:0,stars:''},Uncommon:{level:1,name:'优秀',color:'#1eff00',tailwind:'text-green-400',borderColor:'#1eff00',priceMultiplier:2,effectMultiplier:1.2,maxAffixes:1,stars:'★'},Rare:{level:2,name:'稀有',color:'#0070dd',tailwind:'text-blue-400',borderColor:'#0070dd',priceMultiplier:5,effectMultiplier:1.5,maxAffixes:1,stars:'★★'},Epic:{level:3,name:'史诗',color:'#a335ee',tailwind:'text-purple-400',borderColor:'#a335ee',priceMultiplier:15,effectMultiplier:2,maxAffixes:2,stars:'★★★'},Legendary:{level:4,name:'传说',color:'#ff8000',tailwind:'text-orange-400',borderColor:'#ff8000',priceMultiplier:50,effectMultiplier:2.5,maxAffixes:3,stars:'★★★★'},Mythic:{level:5,name:'神话',color:'#e6cc80',tailwind:'text-amber-300',borderColor:'#e6cc80',priceMultiplier:200,effectMultiplier:3.5,maxAffixes:4,stars:'✦✦✦✦✦'}};function Vx(e){return'string'==typeof e&&qx.includes(e)}function Fx(e){if(!e)return Ux.Common;if(Vx(e))return Ux[e];const t=function(e){if(!e)return'Common';if(Vx(e))return e;const t=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();return Vx(t)?t:{普通:'Common',优秀:'Uncommon',稀有:'Rare',史诗:'Epic',传说:'Legendary',神话:'Mythic',精良:'Uncommon',卓越:'Rare',紫色:'Epic',橙色:'Legendary'}[e]??'Common'}(e);return Ux[t]}function Hx(e){return Fx(e).stars}function Gx(e){return`quality-${(e??'Common').toLowerCase()}`}const zx=Za({name:'ItemDetailModal',props:{visible:{type:Boolean,default:!1},item:{type:Object,default:null},isInCombat:{type:Boolean,default:!1},mode:{type:String,default:'inventory'},equipmentSlot:{type:String,default:''}},emits:['close','use-item','equip-item','discard-item','unequip-item'],setup(e,{emit:t}){const a=$t(null),s=$t(0),n=$t(0),r=$t(!1),l=$t(0),o=()=>{r.value=!1,l.value=0,s.value=0,n.value=0};_a(()=>e.visible,e=>{e||o()});const i=ir(()=>l.value>0?{transform:`translateY(${l.value}px)`,transition:r.value?'none':'transform 0.2s ease-out'}:{}),c=()=>{try{return Ll.serviceLocator.get('IconService')}catch{return null}},d=ir(()=>e.item?Io.translateItem(e.item):null),u=ir(()=>'consumable'===e.item?.type),p=ir(()=>!!e.item&&['weapon','armor','accessory'].some(t=>e.item?.type?.includes(t))),m={weapon:'武器',consumable:'消耗品',material:'材料',key:'关键物品',armor:'防具',accessory:'饰品',misc:'杂物',quest:'任务物品'};return{modalRef:a,translatedItem:d,canUse:u,canEquip:p,getTypeName:e=>m[e||'']||e||'物品',getQualityClass:e=>Gx(e),getQualityBgClass:e=>`quality-bg-${(e??'common').toLowerCase()}`,getQualityBorderClass:e=>`quality-border-${(e??'common').toLowerCase()}`,getQualityName:e=>Fx(e).name,getQualityStars:e=>Hx(e),hasIconData:e=>!!c()&&!(!e.subtype&&!['weapon','armor','accessory','material','consumable'].includes(e.type)),getIconStyle:(e,t=64)=>{const a=c();if(!a)return{};let s,n=e.subtype;if(e.subtype){const t=a.mapTypeToCategoryAndSubtype(e.subtype);s=t.category,n=t.subtype||e.subtype}else'consumable'===e.type?(s='material',n='potion'):s=['weapon','armor','accessory','material','item'].includes(e.type)?e.type:'item';return'material'!==s&&'item'!==s||void 0!==e.iconVariant||a.ensureIconVariant(e),a.getIconStyle(s,n,e.attribute,e.iconVariant,t)},formatCurrency:e=>{if(e>=1e4){const t=Math.floor(e/1e4),a=Math.floor(e%1e4/100),s=e%100,n=[];return t>0&&n.push(`${t}金`),a>0&&n.push(`${a}银`),(s>0||0===n.length)&&n.push(`${s}铜`),n.join(' ')}if(e>=100){const t=Math.floor(e/100),a=e%100;return a>0?`${t}银 ${a}铜`:`${t}银`}return`${e}铜`},handleTouchStart:e=>{window.innerWidth>=640||(s.value=e.touches[0].clientY,r.value=!0)},handleTouchMove:e=>{if(!r.value)return;if(window.innerWidth>=640)return;n.value=e.touches[0].clientY;const t=n.value-s.value;t>0&&(l.value=.6*t,e.preventDefault())},handleTouchEnd:()=>{r.value&&(window.innerWidth>=640||(l.value>100&&t('close'),o()))},modalDragStyle:i,handleDiscard:()=>{const a=e.item;t('close'),setTimeout(()=>{t('discard-item',a)},50)}}}}),Wx=(0,$u.A)(zx,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'item-detail-overlay',onClick:t[11]||(t[11]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',{ref:'modalRef',class:'item-detail-modal',style:X(e.modalDragStyle),onTouchstart:t[8]||(t[8]=(...t)=>e.handleTouchStart&&e.handleTouchStart(...t)),onTouchmove:t[9]||(t[9]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t)),onTouchend:t[10]||(t[10]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Rn(' Swipe Handle (移动端下滑提示) '),t[20]||(t[20]=Mn('div',{class:'swipe-handle sm:hidden'},[Mn('div',{class:'handle-bar'})],-1)),Rn(' Header '),Mn('div',{class:ee(['modal-header',e.getQualityBgClass(e.item?.quality)])},[Mn('div',ox,[Rn(' Icon '),e.item&&e.hasIconData(e.item)?(yn(),Sn('div',{key:0,class:ee(['item-icon h-11 w-11 rounded-lg sm:h-16 sm:w-16',e.getQualityBorderClass(e.item.quality)]),style:X(e.getIconStyle(e.item,64))},null,6)):e.item?(yn(),Sn('div',{key:1,class:ee(['flex h-11 w-11 items-center justify-center rounded-lg bg-[#36393f] text-2xl sm:h-16 sm:w-16 sm:text-4xl',e.getQualityBorderClass(e.item.quality)])},oe(e.item.emoji||'📦'),3)):Rn('v-if',!0),Rn(' Title + Quality '),Mn('div',ix,[Mn('h2',cx,oe(e.item?.name||'未知物品'),1),Mn('div',dx,[Mn('span',{class:ee(['quality-badge',e.getQualityClass(e.item?.quality)])},oe(e.getQualityName(e.item?.quality)),3),e.getQualityStars(e.item?.quality)?(yn(),Sn('span',{key:0,class:ee(['quality-stars text-xs leading-none',e.getQualityClass(e.item?.quality)])},oe(e.getQualityStars(e.item?.quality)),3)):Rn('v-if',!0),Mn('span',ux,oe(e.getTypeName(e.item?.type)),1)])]),Rn(' Close Button '),Mn('button',{class:'flex h-8 w-8 items-center justify-center rounded-full bg-black/30 text-white transition-colors hover:bg-black/50',onClick:t[0]||(t[0]=t=>e.$emit('close'))},' ✕ ')])],2),Rn(' Content '),Mn('div',px,[Rn(' Description '),e.item?.desc?(yn(),Sn('section',mx,[t[12]||(t[12]=Mn('h3',{class:'section-title'},'📜 描述',-1)),Mn('p',gx,oe(e.item.desc),1)])):Rn('v-if',!0),Rn(' Effects '),e.translatedItem&&e.translatedItem.effects.length>0?(yn(),Sn('section',hx,[t[13]||(t[13]=Mn('h3',{class:'section-title'},'✨ 效果',-1)),Mn('div',fx,[(yn(!0),Sn(pn,null,xs(e.translatedItem.effects,(e,t)=>(yn(),Sn('div',{key:t,class:'effect-item'},[Mn('div',vx,[e.icons&&e.icons.length>0?(yn(),Sn('span',yx,oe(e.icons[0]),1)):Rn('v-if',!0)]),Mn('div',bx,[Mn('p',xx,oe(e.text),1),e.trigger||e.chance||e.duration?(yn(),Sn('div',wx,[e.trigger?(yn(),Sn('span',kx,oe(e.trigger),1)):Rn('v-if',!0),e.chance?(yn(),Sn('span',Sx,oe(e.chance)+' 几率',1)):Rn('v-if',!0),e.duration?(yn(),Sn('span',_x,oe(e.duration),1)):Rn('v-if',!0)])):Rn('v-if',!0)])]))),128))])])):Rn('v-if',!0),Rn(' Item Properties '),Mn('section',Cx,[t[19]||(t[19]=Mn('h3',{class:'section-title'},'📋 属性',-1)),Mn('div',Ix,[e.item?.value?(yn(),Sn('div',Tx,[t[14]||(t[14]=Mn('span',{class:'property-label'},'💰 价值',-1)),Mn('span',Ax,oe(e.formatCurrency(e.item.value)),1)])):Rn('v-if',!0),e.item?.level?(yn(),Sn('div',Mx,[t[15]||(t[15]=Mn('span',{class:'property-label'},'📊 等级',-1)),Mn('span',Ex,'Lv.'+oe(e.item.level),1)])):Rn('v-if',!0),e.item?.count&&e.item.count>1?(yn(),Sn('div',$x,[t[16]||(t[16]=Mn('span',{class:'property-label'},'📦 数量',-1)),Mn('span',Dx,oe(e.item.count),1)])):Rn('v-if',!0),e.item?.req?.level?(yn(),Sn('div',Px,[t[17]||(t[17]=Mn('span',{class:'property-label'},'🔒 需求等级',-1)),Mn('span',Nx,'Lv.'+oe(e.item.req.level),1)])):Rn('v-if',!0),e.item?.req?.class?(yn(),Sn('div',Rx,[t[18]||(t[18]=Mn('span',{class:'property-label'},'🎭 限定职业',-1)),Mn('span',jx,oe(e.item.req.class),1)])):Rn('v-if',!0)])])]),Rn(' Footer Actions '),Mn('div',Lx,[Rn(' 背包模式：使用、装备、丢弃、关闭 '),'inventory'===e.mode?(yn(),Sn(pn,{key:0},[e.canUse?(yn(),Sn('button',{key:0,class:'action-btn use-btn',onClick:t[1]||(t[1]=t=>e.$emit('use-item',e.item))},'使用')):Rn('v-if',!0),e.canEquip?(yn(),Sn('button',{key:1,class:ee(['action-btn equip-btn',{disabled:e.isInCombat}]),disabled:e.isInCombat,onClick:t[2]||(t[2]=t=>!e.isInCombat&&e.$emit('equip-item',e.item))},oe(e.isInCombat?'战斗中':'装备'),11,Bx)):Rn('v-if',!0),Mn('button',{class:'action-btn discard-btn',onClick:t[3]||(t[3]=(...t)=>e.handleDiscard&&e.handleDiscard(...t))},'丢弃'),Mn('button',{class:'action-btn close-btn',onClick:t[4]||(t[4]=t=>e.$emit('close'))},'关闭')],64)):'equipment'===e.mode?(yn(),Sn(pn,{key:1},[Rn(' 装备模式：卸下、丢弃、关闭 '),Mn('button',{class:ee(['action-btn unequip-btn',{disabled:e.isInCombat}]),disabled:e.isInCombat,onClick:t[5]||(t[5]=t=>!e.isInCombat&&e.$emit('unequip-item',e.equipmentSlot))},oe(e.isInCombat?'战斗中':'卸下'),11,Ox),Mn('button',{class:'action-btn discard-btn',onClick:t[6]||(t[6]=(...t)=>e.handleDiscard&&e.handleDiscard(...t))},'丢弃'),Mn('button',{class:'action-btn close-btn',onClick:t[7]||(t[7]=t=>e.$emit('close'))},'关闭')],64)):Rn('v-if',!0)])],36)])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-46a14417']]),Qx=Wx,Xx={key:0,class:'flex flex-col space-y-2'},Yx=['onClick'],Kx={class:'flex-1 pr-4 text-sm font-medium text-gray-200 group-hover:text-white'},Jx={key:0,class:'flex flex-col items-end text-xs'},Zx={key:0},ew={key:0,class:'text-gray-500'},tw={key:1,class:'p-4 text-center text-sm text-gray-500 italic'};const aw=Za({name:'OptionSelector',props:{content:{type:String,default:''}},emits:['select'],setup(e,{emit:t}){const a=ir(()=>{if(!e.content)return[];const t=e.content.match(/<options>([\s\S]*?)<\/options>/i);if(!t)return[];return t[1].split('\n').map(e=>e.trim()).filter(e=>e).map(e=>{const t=e.match(/^(\d+\.|-)?\s*(?:\[([a-zA-Z]+)\s*(\d*)\])?\s*(.*)$/);return t?{raw:e,stat:t[2]?t[2].toUpperCase():void 0,dc:t[3]?parseInt(t[3],10):void 0,text:t[4]||e}:{raw:e,text:e}})}),s=e=>{if(!e.stat)return;const a=Ll.serviceLocator.get('RNGService'),s=Ll.serviceLocator.get('SaveService'),n=s.getGameState()?.player;if(!n)return void console.error('Player not found for check');const r=n.attributes[e.stat]||10,l=Math.floor((r-10)/2),o=a.roll(1,20),i=o+l;let c='',d=!0;e.dc?(d=i>=e.dc,c=`<hidden>\n[${e.stat} Check]\nRoll: ${o} + ${l} = ${i} (DC ${e.dc})\nResult: ${d?'SUCCESS':'FAILURE'}\n</hidden>\n${e.text}`):c=`<hidden>\n[${e.stat} Roll]\nRoll: ${o} + ${l} = ${i}\n</hidden>\n${e.text}`,t('select',c.trim())};return{parsedOptions:a,getStatTextColor:e=>({STR:'text-red-400',DEX:'text-green-400',CON:'text-orange-400',INT:'text-blue-400',WIS:'text-purple-400',CHA:'text-pink-400'}[e]||'text-gray-400'),getStatLabel:e=>({STR:'力量',DEX:'敏捷',CON:'体质',INT:'智力',WIS:'感知',CHA:'魅力'}[e]||e),calculateProbability:(e,t)=>{const a=Ll.serviceLocator.get('SaveService'),s=a.getGameState()?.player;if(!s)return 0;const n=s.attributes[e]||10,r=t-Math.floor((n-10)/2);if(r<=1)return 100;if(r>20)return 0;const l=20-r+1;return Math.round(l/20*100)},handleSelect:e=>{e.stat?s(e):t('select',e.text)}}}}),sw=(0,$u.A)(aw,[['render',function(e,t,a,s,n,r){return e.parsedOptions.length>0?(yn(),Sn('div',Xx,[Rn(' Header Removed as requested '),(yn(!0),Sn(pn,null,xs(e.parsedOptions,(t,a)=>(yn(),Sn('div',{key:a,class:'group relative flex w-full cursor-pointer items-center justify-between rounded-lg border border-[#202225] bg-[#36393f] p-3 text-left shadow-sm transition-all hover:border-blue-500 hover:bg-[#40444b]',onClick:a=>e.handleSelect(t)},[Rn(' Left: Text '),Mn('div',Kx,oe(t.text),1),Rn(' Right: Stat Check Info '),t.stat?(yn(),Sn('div',Jx,[Rn(' Stat Name & DC '),Mn('div',{class:ee(['font-bold uppercase',e.getStatTextColor(t.stat)])},[Pn(oe(e.getStatLabel(t.stat))+' 检定 ',1),t.dc?(yn(),Sn('span',Zx,oe(t.dc),1)):Rn('v-if',!0)],2),Rn(' Probability '),t.dc?(yn(),Sn('div',ew,'(成功率: '+oe(e.calculateProbability(t.stat,t.dc))+'%)',1)):Rn('v-if',!0)])):Rn('v-if',!0)],8,Yx))),128))])):(yn(),Sn('div',tw,'当前环境下无可用选项'))}]]),nw={class:'w-full max-w-sm rounded-lg border border-[#202225] bg-[#36393f] shadow-xl'},rw={class:'flex items-center justify-between border-b border-[#202225] bg-[#2f3136] px-4 py-3'},lw={class:'flex items-center gap-2 font-bold text-white'},ow={class:'p-4'},iw={key:0,class:'text-sm text-gray-300 italic'},cw={key:1,class:'text-sm text-gray-500'},dw={class:'mt-3'},uw={key:0,class:'inline-block rounded bg-green-600/30 px-2 py-0.5 text-xs font-medium text-white'},pw={key:1,class:'inline-block rounded bg-gray-600/30 px-2 py-0.5 text-xs font-medium text-white'},mw={class:'flex justify-end gap-2 border-t border-[#202225] bg-[#2f3136] px-4 py-3'};const gw=Za({name:'SceneObjectModal',props:{visible:{type:Boolean,required:!0},sceneObject:{type:Object,default:null}},emits:['close','observe','interact'],setup:(e,{emit:t})=>({handleObserve:()=>{e.sceneObject&&t('observe',e.sceneObject)},handleInteract:()=>{e.sceneObject&&t('interact',e.sceneObject)}})}),hw=(0,$u.A)(gw,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible&&e.sceneObject?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[3]||(t[3]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',nw,[Mn('div',rw,[Mn('h3',lw,[t[4]||(t[4]=Mn('span',{class:'text-orange-400'},'📦',-1)),Pn(' '+oe(e.sceneObject.name),1)]),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),Mn('div',ow,[Rn(' 物品描述 '),e.sceneObject.brief?(yn(),Sn('div',iw,'"'+oe(e.sceneObject.brief)+'"',1)):(yn(),Sn('div',cw,'暂无描述信息')),Rn(' 可交互状态 '),Mn('div',dw,[!1!==e.sceneObject.interactable?(yn(),Sn('span',uw,'可交互')):(yn(),Sn('span',pw,'仅观赏'))])]),Mn('div',mw,[Mn('button',{class:'rounded bg-[#40444b] px-4 py-2 text-sm text-white hover:bg-[#4a4f57]',onClick:t[1]||(t[1]=(...t)=>e.handleObserve&&e.handleObserve(...t))},' 👁️ 观察 '),!1!==e.sceneObject.interactable?(yn(),Sn('button',{key:0,class:'rounded bg-[#5865F2] px-4 py-2 text-sm text-white hover:bg-[#4752C4]',onClick:t[2]||(t[2]=(...t)=>e.handleInteract&&e.handleInteract(...t))},' 🤚 交互 ')):Rn('v-if',!0)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-f03fe5be']]),fw={key:0,class:'task-bubble-container'},vw=['onClick'],yw={class:'bubble-icon'},bw={key:0,class:'spinner'},xw={key:1,class:'icon-done'},ww={key:2,class:'icon-error'},kw={key:3,class:'icon-cancelled'},Sw={key:4,class:'icon-pending'},_w={class:'bubble-label'},Cw=['onClick'];const Iw=Za({name:'TaskBubble',setup(){const{tasks:e,hasActiveTasks:t,cancelTask:a}=Vl(),s=e=>e.status===jl.RUNNING||e.status===jl.PENDING;return{tasks:e,hasActiveTasks:t,cancelTask:a,isCancellable:s,handleClick:e=>{s(e)&&a(e.id)}}}}),Tw=(0,$u.A)(Iw,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'bubble-slide'},{default:ba(()=>[e.hasActiveTasks?(yn(),Sn('div',fw,[En(ol,{name:'bubble-list',tag:'div',class:'task-bubble-list'},{default:ba(()=>[(yn(!0),Sn(pn,null,xs(e.tasks,t=>(yn(),Sn('div',{key:t.id,class:ee(['task-bubble',[`status-${t.status}`,{cancellable:e.isCancellable(t)}]]),onClick:a=>e.handleClick(t)},[Rn(' 状态图标 '),Mn('span',yw,['running'===t.status?(yn(),Sn('span',bw)):'completed'===t.status?(yn(),Sn('span',xw,'✓')):'error'===t.status?(yn(),Sn('span',ww,'✕')):'cancelled'===t.status?(yn(),Sn('span',kw,'⊘')):(yn(),Sn('span',Sw,'○'))]),Rn(' 标签文本 '),Mn('span',_w,oe(t.label),1),Rn(' 取消按钮（仅运行中的任务显示） '),e.isCancellable(t)?(yn(),Sn('button',{key:0,class:'bubble-cancel-btn',title:'点击取消',onClick:Cl(a=>e.cancelTask(t.id),['stop'])},' ✕ ',8,Cw)):Rn('v-if',!0)],10,vw))),128))]),_:1})])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-6e278c1c']]),Aw={key:0,class:'fixed inset-0 z-[100] flex flex-col bg-[#202225] text-gray-200'},Mw={class:'flex items-center justify-between border-b border-gray-700 bg-[#2f3136] px-3 py-2 md:hidden'},Ew={class:'flex items-center space-x-2'},$w={class:'max-h-[50vh] overflow-y-auto border-b border-gray-700 bg-[#2f3136] p-3 md:hidden'},Dw={class:'mb-3 flex flex-wrap gap-2'},Pw={class:'cursor-pointer rounded bg-blue-600 px-3 py-1 text-xs hover:bg-blue-500'},Nw={class:'cursor-pointer rounded bg-cyan-700 px-3 py-1 text-xs hover:bg-cyan-600'},Rw={class:'mb-3'},jw={class:'text-xs text-gray-400'},Lw={class:'mb-3'},Bw={class:'flex flex-wrap gap-1'},Ow=['onClick'],qw={class:'mb-3 flex flex-wrap gap-2'},Uw={class:'flex gap-1'},Vw=['onClick'],Fw={class:'flex gap-1'},Hw=['onClick'],Gw={class:'mb-3 flex items-center gap-2'},zw={class:'w-6 text-center text-xs'},Ww={key:0,class:'mb-3'},Qw={key:1,class:'mb-3 space-y-2'},Xw={class:'flex items-center gap-2'},Yw=['value'],Kw={class:'flex items-center gap-2'},Jw={class:'space-y-2'},Zw={class:'flex items-center gap-2 text-xs text-gray-300'},ek={class:'flex items-center gap-2 text-xs text-gray-300'},tk={class:'flex items-center gap-2 text-xs text-gray-300'},ak={class:'hidden flex-col border-b border-gray-700 bg-[#2f3136] md:flex'},sk={class:'flex items-center justify-between px-4 py-2'},nk={class:'flex items-center space-x-4'},rk={class:'cursor-pointer rounded bg-blue-600 px-3 py-1 text-xs hover:bg-blue-500'},lk={class:'flex items-center space-x-2 text-xs text-gray-400'},ok={class:'flex cursor-pointer items-center space-x-1 hover:text-white'},ik={class:'flex items-center space-x-2'},ck={class:'cursor-pointer rounded bg-cyan-700 px-3 py-1 text-xs hover:bg-cyan-600'},dk={class:'flex items-center space-x-4 border-t border-gray-700 px-4 py-2'},uk={class:'flex items-center space-x-2'},pk={class:'flex rounded bg-[#202225]'},mk=['onClick'],gk={class:'flex items-center space-x-2'},hk={class:'flex overflow-hidden rounded bg-[#202225]'},fk=['onClick'],vk={class:'flex items-center space-x-2'},yk={class:'flex rounded bg-[#202225]'},bk=['onClick'],xk={class:'flex items-center space-x-2'},wk={class:'w-6 text-center text-xs text-white'},kk={class:'text-xs text-gray-500'},Sk={class:'flex flex-1 items-center space-x-2'},_k=['value'],Ck={key:2,class:'text-xs text-gray-500 italic'},Ik={class:'hidden items-center space-x-4 border-b border-gray-700 bg-[#2f3136] px-4 py-2 md:flex'},Tk={class:'flex items-center space-x-2 text-xs text-gray-300'},Ak={class:'flex items-center space-x-2 text-xs text-gray-300'},Mk={class:'flex cursor-pointer items-center space-x-2 text-xs text-gray-300 select-none'},Ek={key:0,class:'pointer-events-none absolute top-6 left-6 z-[120] space-y-1 rounded border border-gray-600 bg-black/80 p-2 text-xs text-white shadow-lg'},$k={class:'font-bold text-gray-400'},Dk={key:0,class:'text-green-400'},Pk={key:1,class:'text-yellow-400'},Nk={key:2,class:'text-red-400'},Rk={key:1,class:'pointer-events-none absolute top-6 right-6 z-[120] rounded bg-blue-600/80 px-3 py-1 text-xs text-white'},jk=['src'],Lk=['width','height'],Bk={class:'max-h-[80vh] w-[500px] overflow-y-auto rounded-lg bg-[#2f3136] p-4'},Ok={class:'mb-4 space-y-2'},qk={class:'flex items-center space-x-2'},Uk={class:'flex items-center space-x-2'},Vk={class:'flex items-center space-x-2'},Fk={class:'flex flex-wrap gap-1'},Hk=['onClick'],Gk={class:'mb-4 border-t border-gray-700 pt-4'},zk={class:'space-y-2'},Wk={class:'flex items-center space-x-2'},Qk={class:'flex items-center space-x-2'},Xk={class:'space-y-2'},Yk={class:'flex items-center space-x-2'},Kk={class:'space-y-2'},Jk={class:'flex items-center space-x-2'},Zk={class:'flex items-center space-x-2'},eS={class:'space-y-2'},tS={class:'flex items-center space-x-2'},aS={class:'space-y-2'},sS={class:'flex items-center space-x-2'},nS={class:'flex items-center space-x-2'},rS={class:'space-y-2'},lS={class:'flex items-center space-x-2'},oS={class:'flex items-center space-x-2'},iS={class:'mt-4 border-t border-gray-700 pt-4'},cS={class:'space-y-2'},dS={class:'flex items-center space-x-2'},uS={class:'flex items-center space-x-2'},pS={class:'flex justify-end space-x-2'},mS={class:'flex max-h-[80vh] w-[600px] flex-col rounded-lg bg-[#2f3136] p-4'},gS=['value'],hS={class:'mt-2 flex justify-end'};const fS=Object.entries(em).map(([e,t])=>({value:e,label:t.label,icon:t.icon,color:t.color})),vS=Za({name:'MapEditor',props:{visible:{type:Boolean,default:!1}},emits:['close'],setup(e){const t=$t(null),a=$t(null),s=$t(10),n=$t(200),r=ir(()=>n.value*s.value),l=ir(()=>n.value*s.value),o=$t('wall'),i=$t('rect'),c=$t('paint'),d=$t(!0),u=$t(!1),p=$t(1),m=$t(1),g=$t(null),h=$t(0),f=$t(0),v=$t(!1),y=$t(!1),b=$t(0),x=$t(0),w=$t(0),k=$t(0),S=$t(0),C=$t({x:0,y:0}),I=$t(0),T=$t('未命名区域'),A=$t('event_1'),M=$t(''),E=$t(Zp.TRIGGER),D=$t(1),P=$t(!1),N=$t({targetMap:'',targetX:0,targetY:0,portalTargetMap:'',portalTargetId:'',portalId:'',regionName:'',encounterRate:30,enemyPoolStr:'',oneTime:!0,itemRewardsStr:'',requireItem:'',requireFlag:''}),R=$t(new Set),j=$t(new Map),L=$t(new Map),B=fS,O=$t(!1),q=$t(!1),U=$t(null),V=$t(null),F=$t(null),H=$t(!1),G=$t('');function*W(e,t,a,s){const n=Math.abs(a-e),r=Math.abs(s-t),l=e<a?1:-1,o=t<s?1:-1;let i=n-r;for(;yield{x:e,y:t},e!==a||t!==s;){const a=2*i;a>-r&&(i-=r,e+=l),a<n&&(i+=n,t+=o)}}const Q=()=>{const e=a.value;if(!e)return;const t=e.getContext('2d');if(!t)return;t.clearRect(0,0,e.width,e.height);const n=s.value;j.value.forEach((e,a)=>{const[s,r]=a.split(',').map(Number);let l=0;for(let t=0;t<e.length;t++)l=e.charCodeAt(t)+((l<<5)-l);const o=Math.abs(l%360);t.fillStyle=`hsla(${o}, 70%, 50%, 0.3)`,t.fillRect(s*n,r*n,n,n),d.value&&(t.fillStyle='#FFF',t.font='10px sans-serif',t.textAlign='center',t.textBaseline='middle',t.fillText(e[0],(s+.5)*n,(r+.5)*n))}),t.fillStyle='rgba(255, 0, 0, 0.4)',R.value.forEach(e=>{const[a,s]=e.split(',').map(Number);t.fillRect(a*n,s*n,n,n)}),L.value.forEach((e,a)=>{const[s,r]=a.split(',').map(Number),l=em[e.type]||em[Zp.TRIGGER];t.fillStyle=l.color,t.fillRect(s*n,r*n,n,n),t.fillStyle='#FFF',t.font=`${Math.max(8,.6*n)}px sans-serif`,t.textAlign='center',t.textBaseline='middle',t.fillText(l.icon,(s+.5)*n,(r+.5)*n)}),t.beginPath(),t.strokeStyle='rgba(255, 255, 255, 0.1)',t.lineWidth=1;for(let e=0;e<=r.value;e+=n)t.moveTo(e,0),t.lineTo(e,l.value);for(let e=0;e<=l.value;e+=n)t.moveTo(0,e),t.lineTo(r.value,e);if(t.stroke(),O.value&&V.value){const{x:e,y:a}=V.value,s=U.value?.x||e,r=U.value?.y||a;t.fillStyle='erase'===c.value?'rgba(255, 255, 255, 0.3)':'rgba(0, 255, 255, 0.3)';const l=(e,a)=>{t.fillRect(e*n,a*n,n,n)},o=(e,t)=>{const a=D.value,s=Math.floor(a/2);for(let n=0;n<a;n++)for(let r=0;r<a;r++)l(e-s+n,t-s+r)};if('pencil'===i.value)o(e,a);else if('rect'===i.value){const l=Math.min(s,e),o=Math.min(r,a),i=Math.max(s,e),c=Math.max(r,a);t.fillRect(l*n,o*n,(i-l+1)*n,(c-o+1)*n),t.strokeRect(l*n,o*n,(i-l+1)*n,(c-o+1)*n)}else if('line'===i.value)for(const t of W(s,r,e,a))l(t.x,t.y)}},X=(e,t)=>{const a=`${e},${t}`;if('erase'===c.value)'wall'===o.value&&R.value.delete(a),'region'===o.value&&j.value.delete(a),'event'===o.value&&L.value.delete(a);else if('wall'===o.value&&R.value.add(a),'region'===o.value&&j.value.set(a,T.value),'event'===o.value){const s={id:A.value,type:E.value,name:M.value||void 0,at:[[e,t]],params:Y()};L.value.set(a,s)}},Y=()=>{const e={};return E.value===Zp.TELEPORT&&(N.value.targetMap&&(e.targetMap=N.value.targetMap),(N.value.targetX||N.value.targetY)&&(e.targetPos=[N.value.targetX,N.value.targetY])),E.value===Zp.PORTAL_IN&&(N.value.portalTargetMap&&(e.portalTargetMap=N.value.portalTargetMap),N.value.portalTargetId&&(e.portalTargetId=N.value.portalTargetId)),E.value===Zp.PORTAL_OUT&&N.value.portalId&&(e.portalId=N.value.portalId),E.value!==Zp.GATE&&E.value!==Zp.ENTER||N.value.regionName&&(e.regionName=N.value.regionName),E.value===Zp.ENCOUNTER&&(e.encounterRate=N.value.encounterRate,N.value.enemyPoolStr&&(e.enemyPool=N.value.enemyPoolStr.split(',').map(e=>e.trim()))),E.value===Zp.CHEST&&(e.oneTime=N.value.oneTime,N.value.itemRewardsStr&&(e.itemRewards=N.value.itemRewardsStr.split(',').map(e=>{const[t,a]=e.trim().split(':');return{itemId:t,count:parseInt(a)||1}}))),N.value.requireItem&&(e.requireItem=N.value.requireItem),N.value.requireFlag&&(e.requireFlag=N.value.requireFlag),Object.keys(e).length>0?e:void 0},K=(e,t)=>{const a=D.value,s=Math.floor(a/2);for(let r=0;r<a;r++)for(let l=0;l<a;l++){const a=e-s+r,o=t-s+l;a>=0&&o>=0&&a<n.value&&o<n.value&&X(a,o)}},J=e=>{'Space'!==e.code||y.value||(y.value=!0,e.preventDefault()),'BracketLeft'===e.code&&(D.value=Math.max(1,D.value-1),Q()),'BracketRight'===e.code&&(D.value=Math.min(10,D.value+1),Q())},Z=e=>{'Space'===e.code&&(y.value=!1,v.value=!1)},ee=e=>{if(e.length<2)return 0;const t=e[0].clientX-e[1].clientX,a=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+a*a)},te=e=>e.length<2?{x:e[0].clientX,y:e[0].clientY}:{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2},ae=e=>{const t=a.value;if(!t)return{gx:0,gy:0};const n=t.getBoundingClientRect(),o=r.value/n.width,i=l.value/n.height;return{gx:Math.floor((e.clientX-n.left)*o/s.value),gy:Math.floor((e.clientY-n.top)*i/s.value)}},se=e=>{let t=1/0,a=1/0,s=-1/0,n=-1/0;const r=[];if(e.forEach(e=>{const[l,o]=e.split(',').map(Number);r.push({x:l,y:o}),l<t&&(t=l),o<a&&(a=o),l>s&&(s=l),o>n&&(n=o)}),0===r.length)return[];const l=s-t+1,o=n-a+1,i=new Array(o).fill(!1).map(()=>new Array(l).fill(!1));r.forEach(e=>{i[e.y-a][e.x-t]=!0});const c=[];for(let e=0;e<o;e++)for(let s=0;s<l;s++)if(i[e][s]){let n=0,r=0,d=0,u=0;for(;s+u<l&&i[e][s+u];)u++;for(let t=1;t<=u;t++){let a=1;for(;e+a<o;){let n=!0;for(let r=0;r<t;r++)if(!i[e+a][s+r]){n=!1;break}if(!n)break;a++}const l=t*a;l>=n&&(n=l,r=t,d=a)}if(r>0&&d>0){const n=s+t,l=e+a;r>1||d>1?c.push([n,l,r,d]):c.push([n,l]);for(let t=0;t<d;t++)for(let a=0;a<r;a++)i[e+t][s+a]=!1;s--}}return c};return _a(()=>e.visible,e=>{e&&Zt(Q)}),us(()=>{Q(),window.addEventListener('keydown',J),window.addEventListener('keyup',Z)}),gs(()=>{window.removeEventListener('keydown',J),window.removeEventListener('keyup',Z)}),{imageUrl:t,backgroundOpacity:p,zoom:m,canvasRef:a,gridSize:s,mapWidth:r,gridCount:n,mapHeight:l,layers:[{value:'wall',label:'墙壁/阻挡',activeClass:'bg-red-700'},{value:'region',label:'区域/领地',activeClass:'bg-green-700'},{value:'event',label:'事件/交互',activeClass:'bg-yellow-700'}],tools:[{value:'pencil',label:'✏️ 画笔'},{value:'line',label:'📏 直线'},{value:'rect',label:'⬜ 矩形'}],activeLayer:o,activeTool:i,currentRegionName:T,currentEventId:A,currentEventName:M,currentEventType:E,brushSize:D,showEventEditor:P,eventParams:N,eventTypes:B,handleImageUpload:e=>{const a=e.target.files?.[0];if(!a)return;const r=new FileReader;r.onload=e=>{if(e.target?.result){t.value=e.target.result;const a=new Image;a.onload=()=>{const e=Math.max(a.width,a.height),t=Math.ceil(e/s.value);t>n.value&&(n.value=50*Math.ceil(t/50)),Q()},a.src=t.value}},r.readAsDataURL(a)},handleJsonUpload:e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{const t=JSON.parse(e.target?.result);if(t.meta){s.value=t.meta.cellSize||10;const e=t.meta.width||100,a=t.meta.height||100;n.value=Math.max(e,a)}if(R.value.clear(),j.value.clear(),L.value.clear(),Array.isArray(t.walls)&&t.walls.forEach(e=>{if(2===e.length)R.value.add(`${e[0]},${e[1]}`);else if(4===e.length){const[t,a,s,n]=e;for(let e=0;e<s;e++)for(let s=0;s<n;s++)R.value.add(`${t+e},${a+s}`)}}),t.regions)for(const[e,a]of Object.entries(t.regions))a.forEach(t=>{if(2===t.length)j.value.set(`${t[0]},${t[1]}`,e);else if(4===t.length){const[a,s,n,r]=t;for(let t=0;t<n;t++)for(let n=0;n<r;n++)j.value.set(`${a+t},${s+n}`,e)}});Array.isArray(t.events)&&t.events.forEach(e=>{Array.isArray(e.at)&&(Array.isArray(e.at[0])?e.at.forEach(t=>{if(2===t.length)L.value.set(`${t[0]},${t[1]}`,e.id);else if(4===t.length){const[a,s,n,r]=t;for(let t=0;t<n;t++)for(let n=0;n<r;n++)L.value.set(`${a+t},${s+n}`,e.id)}}):2===e.at.length&&L.value.set(`${e.at[0]},${e.at[1]}`,e.id))}),Zt(()=>{Q(),sc('地图数据导入成功！','success')})}catch(e){console.error(e),sc('导入失败：文件格式不正确','error')}},a.readAsText(t)},handleMouseDown:e=>{if(v.value||y.value)return;const{gx:t,gy:a}=ae(e);O.value=!0,q.value=!0,U.value={x:t,y:a},V.value={x:t,y:a},'pencil'===i.value&&K(t,a),Q()},handleMouseMove:e=>{if(v.value)return;const{gx:t,gy:a}=ae(e);F.value={x:t,y:a},O.value&&q.value&&(V.value?.x===t&&V.value?.y===a||(V.value={x:t,y:a},'pencil'===i.value&&K(t,a),Q()))},handleMouseUp:()=>{if(!(O.value&&U.value&&V.value&&q.value))return O.value=!1,void(q.value=!1);const e=U.value.x,t=U.value.y,a=V.value.x,s=V.value.y;if('rect'===i.value){const n=Math.min(e,a),r=Math.min(t,s),l=Math.max(e,a),o=Math.max(t,s);for(let e=n;e<=l;e++)for(let t=r;t<=o;t++)K(e,t)}else if('line'===i.value)for(const n of W(e,t,a,s))K(n.x,n.y);O.value=!1,q.value=!1,U.value=null,V.value=null,Q()},exportMapData:()=>{const e=se(R.value),t={},a=new Map;j.value.forEach((e,t)=>{a.has(e)||a.set(e,new Set),a.get(e).add(t)}),a.forEach((e,a)=>{t[a]=se(e)});const n=[],o=new Map;L.value.forEach((e,t)=>{const a=`${e.id}:${e.type}`;o.has(a)||o.set(a,{event:e,points:new Set}),o.get(a).points.add(t)}),o.forEach(({event:e,points:t})=>{const a=se(t);n.push({id:e.id,type:e.type,name:e.name,at:a,params:e.params})});const i={meta:{width:Math.ceil(r.value/s.value),height:Math.ceil(l.value/s.value),cellSize:s.value},walls:e,regions:t,events:n};G.value=JSON.stringify(i,null,0),H.value=!0},showExport:H,exportJson:G,copyToClipboard:()=>{navigator.clipboard.writeText(G.value),H.value=!1},activeMode:c,modes:[{value:'paint',label:'🖌️ 绘制',class:'bg-blue-600 text-white'},{value:'erase',label:'🧹 擦除',class:'bg-rose-600 text-white'}],showLabels:d,showMobileToolbar:u,hoverPos:F,workspaceRef:g,panX:h,panY:f,isPanning:v,handleWheel:e=>{e.preventDefault();const t=.001*-e.deltaY,a=Math.min(Math.max(.5,m.value+t),3);if(g.value){const t=g.value.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,n=e.clientY-t.top-t.height/2,r=a/m.value;h.value=s-(s-h.value)*r,f.value=n-(n-f.value)*r}m.value=a},handleWorkspaceMouseDown:e=>{(y.value||1===e.button)&&(v.value=!0,b.value=e.clientX,x.value=e.clientY,w.value=h.value,k.value=f.value,e.preventDefault())},handleWorkspaceMouseMove:e=>{v.value&&(h.value=w.value+(e.clientX-b.value),f.value=k.value+(e.clientY-x.value))},handleWorkspaceMouseUp:()=>{v.value&&(v.value=!1)},handleTouchStart:e=>{I.value=Date.now(),2===e.touches.length?(e.preventDefault(),v.value=!0,S.value=ee(e.touches),C.value=te(e.touches),w.value=h.value,k.value=f.value):1===e.touches.length&&(b.value=e.touches[0].clientX,x.value=e.touches[0].clientY,w.value=h.value,k.value=f.value)},handleTouchMove:e=>{if(2===e.touches.length){e.preventDefault();const t=ee(e.touches),a=te(e.touches);if(S.value>0){const e=t/S.value,a=Math.min(Math.max(.5,m.value*e),3);m.value=a}if(g.value){g.value.getBoundingClientRect();const e=a.x-C.value.x,t=a.y-C.value.y;h.value+=e,f.value+=t}S.value=t,C.value=a}else 1===e.touches.length&&v.value&&(h.value=w.value+(e.touches[0].clientX-b.value),f.value=k.value+(e.touches[0].clientY-x.value))},handleTouchEnd:e=>{0===e.touches.length?(v.value=!1,S.value=0,q.value=!1):1===e.touches.length&&(S.value=0,b.value=e.touches[0].clientX,x.value=e.touches[0].clientY,w.value=h.value,k.value=f.value)},resetView:()=>{m.value=1,h.value=0,f.value=0},showToast:sc,hoverInfo:ir(()=>{if(!F.value)return null;const e=`${F.value.x},${F.value.y}`;return{x:F.value.x,y:F.value.y,region:j.value.get(e),event:L.value.get(e),isWall:R.value.has(e)}})}}}),yS=(0,$u.A)(vS,[['render',function(e,t,a,s,n,r){return e.visible?(yn(),Sn('div',Aw,[Rn(' Mobile Header with Toggle '),Mn('div',Mw,[t[63]||(t[63]=Mn('h2',{class:'text-base font-bold text-amber-500'},'地图编辑器',-1)),Mn('div',Ew,[Mn('button',{class:'rounded bg-gray-600 px-2 py-1 text-xs hover:bg-gray-500',onClick:t[0]||(t[0]=t=>e.showMobileToolbar=!e.showMobileToolbar)},oe(e.showMobileToolbar?'收起工具':'展开工具'),1),Mn('button',{class:'rounded bg-gray-600 px-2 py-1 text-xs hover:bg-gray-500',onClick:t[1]||(t[1]=t=>e.$emit('close'))},'关闭')])]),Rn(' Mobile Toolbar (Collapsible) '),xa(Mn('div',$w,[Rn(' File Operations '),Mn('div',Dw,[Mn('label',Pw,[t[64]||(t[64]=Pn(' 加载图片 ',-1)),Mn('input',{type:'file',accept:'image/*',class:'hidden',onChange:t[2]||(t[2]=(...t)=>e.handleImageUpload&&e.handleImageUpload(...t))},null,32)]),Mn('label',Nw,[t[65]||(t[65]=Pn(' 导入JSON ',-1)),Mn('input',{type:'file',accept:'.json',class:'hidden',onChange:t[3]||(t[3]=(...t)=>e.handleJsonUpload&&e.handleJsonUpload(...t))},null,32)]),Mn('button',{class:'rounded bg-green-700 px-3 py-1 text-xs hover:bg-green-600',onClick:t[4]||(t[4]=(...t)=>e.exportMapData&&e.exportMapData(...t))},'导出')]),Rn(' Grid Settings '),Mn('div',Rw,[Mn('span',jw,'网格: '+oe(e.gridSize)+'px',1),xa(Mn('select',{'onUpdate:modelValue':t[5]||(t[5]=t=>e.gridCount=t),class:'ml-2 rounded border border-gray-600 bg-[#202225] px-2 py-1 text-xs text-white'},[...t[66]||(t[66]=[Mn('option',{value:100},'100x100',-1),Mn('option',{value:150},'150x150',-1),Mn('option',{value:200},'200x200',-1),Mn('option',{value:250},'250x250',-1)])],512),[[bl,e.gridCount,void 0,{number:!0}]])]),Rn(' Layer Selection '),Mn('div',Lw,[t[67]||(t[67]=Mn('span',{class:'mb-1 block text-xs font-bold text-gray-400'},'图层',-1)),Mn('div',Bw,[(yn(!0),Sn(pn,null,xs(e.layers,t=>(yn(),Sn('button',{key:t.value,class:ee(['rounded px-2 py-1 text-xs transition-colors',e.activeLayer===t.value?`${t.activeClass} text-white`:'bg-[#202225] text-gray-400']),onClick:a=>e.activeLayer=t.value},oe(t.label),11,Ow))),128))])]),Rn(' Mode & Tool '),Mn('div',qw,[Mn('div',Uw,[(yn(!0),Sn(pn,null,xs(e.modes,t=>(yn(),Sn('button',{key:t.value,class:ee(['rounded px-2 py-1 text-xs',e.activeMode===t.value?t.class:'bg-[#202225] text-gray-400']),onClick:a=>e.activeMode=t.value},oe(t.label),11,Vw))),128))]),Mn('div',Fw,[(yn(!0),Sn(pn,null,xs(e.tools,t=>(yn(),Sn('button',{key:t.value,class:ee(['rounded px-2 py-1 text-xs',e.activeTool===t.value?'bg-indigo-600 text-white':'bg-[#202225] text-gray-400']),onClick:a=>e.activeTool=t.value},oe(t.label),11,Hw))),128))])]),Rn(' Brush Size '),Mn('div',Gw,[t[68]||(t[68]=Mn('span',{class:'text-xs text-gray-400'},'笔刷:',-1)),Mn('button',{class:'rounded bg-[#202225] px-2 py-1 text-xs',onClick:t[6]||(t[6]=t=>e.brushSize=Math.max(1,e.brushSize-1))},' - '),Mn('span',zw,oe(e.brushSize),1),Mn('button',{class:'rounded bg-[#202225] px-2 py-1 text-xs',onClick:t[7]||(t[7]=t=>e.brushSize=Math.min(10,e.brushSize+1))},' + ')]),Rn(' Dynamic Properties '),'region'===e.activeLayer?(yn(),Sn('div',Ww,[t[69]||(t[69]=Mn('span',{class:'text-xs text-green-400'},'区域名称:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.currentRegionName=t),type:'text',class:'ml-2 w-32 rounded bg-[#202225] px-2 py-1 text-xs text-white',placeholder:'城堡大厅'},null,512),[[fl,e.currentRegionName]])])):Rn('v-if',!0),'event'===e.activeLayer?(yn(),Sn('div',Qw,[Mn('div',Xw,[t[70]||(t[70]=Mn('span',{class:'text-xs text-yellow-400'},'类型:',-1)),xa(Mn('select',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.currentEventType=t),class:'rounded border border-gray-600 bg-[#202225] px-2 py-1 text-xs text-white'},[(yn(!0),Sn(pn,null,xs(e.eventTypes,e=>(yn(),Sn('option',{key:e.value,value:e.value},oe(e.icon)+' '+oe(e.label),9,Yw))),128))],512),[[bl,e.currentEventType]])]),Mn('div',Kw,[xa(Mn('input',{'onUpdate:modelValue':t[10]||(t[10]=t=>e.currentEventId=t),type:'text',class:'w-24 rounded bg-[#202225] px-2 py-1 text-xs text-white',placeholder:'事件ID'},null,512),[[fl,e.currentEventId]]),xa(Mn('input',{'onUpdate:modelValue':t[11]||(t[11]=t=>e.currentEventName=t),type:'text',class:'w-24 rounded bg-[#202225] px-2 py-1 text-xs text-white',placeholder:'名称'},null,512),[[fl,e.currentEventName]]),Mn('button',{class:'rounded bg-purple-600 px-2 py-1 text-xs text-white',onClick:t[12]||(t[12]=t=>e.showEventEditor=!0)},'⚙️')])])):Rn('v-if',!0),Rn(' View Settings '),Mn('div',Jw,[Mn('label',Zw,[t[71]||(t[71]=Mn('span',null,'透明度:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[13]||(t[13]=t=>e.backgroundOpacity=t),type:'range',min:'0',max:'1',step:'0.1',class:'w-20'},null,512),[[fl,e.backgroundOpacity,void 0,{number:!0}]]),Mn('span',null,oe((100*e.backgroundOpacity).toFixed(0))+'%',1)]),Mn('label',ek,[t[72]||(t[72]=Mn('span',null,'缩放:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[14]||(t[14]=t=>e.zoom=t),type:'range',min:'0.8',max:'2.0',step:'0.1',class:'w-20'},null,512),[[fl,e.zoom,void 0,{number:!0}]]),Mn('span',null,oe((100*e.zoom).toFixed(0))+'%',1)]),Mn('label',tk,[xa(Mn('input',{'onUpdate:modelValue':t[15]||(t[15]=t=>e.showLabels=t),type:'checkbox',class:'rounded'},null,512),[[vl,e.showLabels]]),t[73]||(t[73]=Mn('span',null,'显示标签',-1))])])],512),[[Lr,e.showMobileToolbar]]),Rn(' Desktop Toolbar Row 1: Main Controls '),Mn('div',ak,[Mn('div',sk,[Mn('div',nk,[t[77]||(t[77]=Mn('h2',{class:'text-lg font-bold text-amber-500'},'地图编辑器',-1)),Rn(' File Input '),Mn('label',rk,[t[74]||(t[74]=Pn(' 加载图片 ',-1)),Mn('input',{type:'file',accept:'image/*',class:'hidden',onChange:t[16]||(t[16]=(...t)=>e.handleImageUpload&&e.handleImageUpload(...t))},null,32)]),Mn('div',lk,[Mn('span',null,'网格: '+oe(e.gridSize)+'px |',1),Mn('label',ok,[t[76]||(t[76]=Mn('span',null,'格子数:',-1)),xa(Mn('select',{'onUpdate:modelValue':t[17]||(t[17]=t=>e.gridCount=t),class:'rounded border border-gray-600 bg-[#202225] px-1 py-0.5 text-xs text-white focus:outline-none'},[...t[75]||(t[75]=[Mn('option',{value:100},'100x100 (小)',-1),Mn('option',{value:150},'150x150 (中)',-1),Mn('option',{value:200},'200x200 (大)',-1),Mn('option',{value:250},'250x250 (超大)',-1)])],512),[[bl,e.gridCount,void 0,{number:!0}]])]),Mn('span',null,'('+oe(e.mapWidth)+'x'+oe(e.mapHeight)+'px)',1)])]),Mn('div',ik,[Rn(' Import JSON '),Mn('label',ck,[t[78]||(t[78]=Pn(' 导入 JSON ',-1)),Mn('input',{type:'file',accept:'.json',class:'hidden',onChange:t[18]||(t[18]=(...t)=>e.handleJsonUpload&&e.handleJsonUpload(...t))},null,32)]),Mn('button',{class:'rounded bg-green-700 px-3 py-1 text-xs hover:bg-green-600',onClick:t[19]||(t[19]=(...t)=>e.exportMapData&&e.exportMapData(...t))},' 导出 JSON '),Mn('button',{class:'rounded bg-gray-600 px-3 py-1 text-xs hover:bg-gray-500',onClick:t[20]||(t[20]=t=>e.$emit('close'))},'关闭')])]),Rn(' Desktop Toolbar Row 2: Tools & Layers '),Mn('div',dk,[Rn(' Layer Selection '),Mn('div',uk,[t[79]||(t[79]=Mn('span',{class:'text-xs font-bold text-gray-400'},'图层:',-1)),Mn('div',pk,[(yn(!0),Sn(pn,null,xs(e.layers,t=>(yn(),Sn('button',{key:t.value,class:ee(['px-3 py-1 text-xs transition-colors first:rounded-l last:rounded-r',e.activeLayer===t.value?`${t.activeClass} text-white`:'text-gray-400 hover:bg-gray-700 hover:text-white']),onClick:a=>e.activeLayer=t.value},oe(t.label),11,mk))),128))])]),t[86]||(t[86]=Mn('div',{class:'h-4 w-px bg-gray-600'},null,-1)),Rn(' Mode Selection (Paint/Erase) '),Mn('div',gk,[Mn('div',hk,[(yn(!0),Sn(pn,null,xs(e.modes,t=>(yn(),Sn('button',{key:t.value,class:ee(['px-3 py-1 text-xs transition-colors',e.activeMode===t.value?t.class:'text-gray-400 hover:bg-gray-700 hover:text-white']),onClick:a=>e.activeMode=t.value},oe(t.label),11,fk))),128))])]),t[87]||(t[87]=Mn('div',{class:'h-4 w-px bg-gray-600'},null,-1)),Rn(' Tool Selection (Shape) '),Mn('div',vk,[t[80]||(t[80]=Mn('span',{class:'text-xs font-bold text-gray-400'},'形状:',-1)),Mn('div',yk,[(yn(!0),Sn(pn,null,xs(e.tools,t=>(yn(),Sn('button',{key:t.value,class:ee(['px-3 py-1 text-xs transition-colors first:rounded-l last:rounded-r',e.activeTool===t.value?'bg-indigo-600 text-white':'text-gray-400 hover:bg-gray-700 hover:text-white']),onClick:a=>e.activeTool=t.value},oe(t.label),11,bk))),128))])]),t[88]||(t[88]=Mn('div',{class:'h-4 w-px bg-gray-600'},null,-1)),Rn(' Brush Size '),Mn('div',xk,[t[81]||(t[81]=Mn('span',{class:'text-xs font-bold text-gray-400'},'笔刷:',-1)),Mn('button',{class:'rounded bg-[#202225] px-2 py-1 text-xs text-gray-300 hover:bg-gray-600',onClick:t[21]||(t[21]=t=>e.brushSize=Math.max(1,e.brushSize-1))},' - '),Mn('span',wk,oe(e.brushSize),1),Mn('button',{class:'rounded bg-[#202225] px-2 py-1 text-xs text-gray-300 hover:bg-gray-600',onClick:t[22]||(t[22]=t=>e.brushSize=Math.min(10,e.brushSize+1))},' + '),Mn('span',kk,'('+oe(e.brushSize)+'x'+oe(e.brushSize)+')',1)]),t[89]||(t[89]=Mn('div',{class:'h-4 w-px bg-gray-600'},null,-1)),Rn(' Dynamic Properties '),Mn('div',Sk,[Rn(' Region Props '),'region'===e.activeLayer?(yn(),Sn(pn,{key:0},[t[82]||(t[82]=Mn('span',{class:'text-xs font-bold text-green-400'},'区域名称:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[23]||(t[23]=t=>e.currentRegionName=t),type:'text',class:'rounded bg-[#202225] px-2 py-1 text-xs text-white focus:ring-1 focus:ring-green-500 focus:outline-none',placeholder:'例如: 城堡大厅'},null,512),[[fl,e.currentRegionName]])],64)):Rn('v-if',!0),Rn(' Event Props '),'event'===e.activeLayer?(yn(),Sn(pn,{key:1},[t[83]||(t[83]=Mn('span',{class:'text-xs font-bold text-yellow-400'},'类型:',-1)),xa(Mn('select',{'onUpdate:modelValue':t[24]||(t[24]=t=>e.currentEventType=t),class:'rounded border border-gray-600 bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none'},[(yn(!0),Sn(pn,null,xs(e.eventTypes,e=>(yn(),Sn('option',{key:e.value,value:e.value},oe(e.icon)+' '+oe(e.label),9,_k))),128))],512),[[bl,e.currentEventType]]),t[84]||(t[84]=Mn('span',{class:'text-xs font-bold text-yellow-400'},'ID:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[25]||(t[25]=t=>e.currentEventId=t),type:'text',class:'w-24 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:ring-1 focus:ring-yellow-500 focus:outline-none',placeholder:'event_1'},null,512),[[fl,e.currentEventId]]),t[85]||(t[85]=Mn('span',{class:'text-xs font-bold text-yellow-400'},'名称:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[26]||(t[26]=t=>e.currentEventName=t),type:'text',class:'w-24 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:ring-1 focus:ring-yellow-500 focus:outline-none',placeholder:'显示名称'},null,512),[[fl,e.currentEventName]]),Mn('button',{class:'rounded bg-purple-600 px-2 py-1 text-xs text-white hover:bg-purple-500',onClick:t[27]||(t[27]=t=>e.showEventEditor=!0)},' ⚙️ 详细 ')],64)):Rn('v-if',!0),Rn(' Wall Props '),'wall'===e.activeLayer?(yn(),Sn('span',Ck,'绘制不可通行的障碍物')):Rn('v-if',!0)])])]),Rn(' Desktop Toolbar Row 3: View Options '),Mn('div',Ik,[t[93]||(t[93]=Mn('span',{class:'text-xs font-bold text-gray-400'},'显示设置:',-1)),Mn('label',Tk,[t[90]||(t[90]=Mn('span',null,'背景透明度:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[28]||(t[28]=t=>e.backgroundOpacity=t),type:'range',min:'0',max:'1',step:'0.1',class:'w-24 accent-blue-500'},null,512),[[fl,e.backgroundOpacity,void 0,{number:!0}]]),Mn('span',null,oe((100*e.backgroundOpacity).toFixed(0))+'%',1)]),t[94]||(t[94]=Mn('div',{class:'h-4 w-px bg-gray-600'},null,-1)),Mn('label',Ak,[t[91]||(t[91]=Mn('span',null,'缩放:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[29]||(t[29]=t=>e.zoom=t),type:'range',min:'0.8',max:'2.0',step:'0.1',class:'w-24 accent-green-500'},null,512),[[fl,e.zoom,void 0,{number:!0}]]),Mn('span',null,oe((100*e.zoom).toFixed(0))+'%',1)]),t[95]||(t[95]=Mn('div',{class:'h-4 w-px bg-gray-600'},null,-1)),Mn('label',Mk,[xa(Mn('input',{'onUpdate:modelValue':t[30]||(t[30]=t=>e.showLabels=t),type:'checkbox',class:'rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-0'},null,512),[[vl,e.showLabels]]),t[92]||(t[92]=Mn('span',null,'显示区域标签',-1))])]),Rn(' Workspace '),Mn('div',{ref:'workspaceRef',class:'relative flex flex-1 touch-none items-center justify-center overflow-hidden bg-[#36393f]',onWheel:t[36]||(t[36]=(...t)=>e.handleWheel&&e.handleWheel(...t)),onMousedown:t[37]||(t[37]=(...t)=>e.handleWorkspaceMouseDown&&e.handleWorkspaceMouseDown(...t)),onMousemove:t[38]||(t[38]=(...t)=>e.handleWorkspaceMouseMove&&e.handleWorkspaceMouseMove(...t)),onMouseup:t[39]||(t[39]=(...t)=>e.handleWorkspaceMouseUp&&e.handleWorkspaceMouseUp(...t)),onMouseleave:t[40]||(t[40]=(...t)=>e.handleWorkspaceMouseUp&&e.handleWorkspaceMouseUp(...t)),onTouchstart:t[41]||(t[41]=(...t)=>e.handleTouchStart&&e.handleTouchStart(...t)),onTouchmove:t[42]||(t[42]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t)),onTouchend:t[43]||(t[43]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Rn(' Hover Info Box '),e.hoverInfo?(yn(),Sn('div',Ek,[Mn('div',$k,'坐标: '+oe(e.hoverInfo.x)+', '+oe(e.hoverInfo.y),1),e.hoverInfo.region?(yn(),Sn('div',Dk,'区域: '+oe(e.hoverInfo.region),1)):Rn('v-if',!0),e.hoverInfo.event?(yn(),Sn('div',Pk,'事件: '+oe(e.hoverInfo.event),1)):Rn('v-if',!0),e.hoverInfo.isWall?(yn(),Sn('div',Nk,'墙壁: 是')):Rn('v-if',!0)])):Rn('v-if',!0),Rn(' Pan/Zoom Mode Indicator '),e.isPanning?(yn(),Sn('div',Rk,' 拖动模式 (按住空格或双指) ')):Rn('v-if',!0),Mn('div',{class:'relative cursor-crosshair border border-gray-700 bg-[#1a1b1e] shadow-2xl',style:X({width:e.mapWidth+'px',height:e.mapHeight+'px',transform:`translate(${e.panX}px, ${e.panY}px) scale(${e.zoom})`,transformOrigin:'center center'}),onMouseleave:t[35]||(t[35]=t=>e.hoverPos=null)},[Rn(' Background Image '),Rn(' 使用CSS样式强制图片尺寸与画布完全一致 '),e.imageUrl?(yn(),Sn('img',{key:0,src:e.imageUrl,class:'pointer-events-none absolute top-0 left-0 select-none',style:X({opacity:e.backgroundOpacity,width:e.mapWidth+'px',height:e.mapHeight+'px',minWidth:e.mapWidth+'px',minHeight:e.mapHeight+'px',maxWidth:e.mapWidth+'px',maxHeight:e.mapHeight+'px'}),draggable:'false'},null,12,jk)):(yn(),Sn(pn,{key:1},[Rn(' Placeholder if no image '),t[96]||(t[96]=Mn('div',{class:'flex h-full w-full items-center justify-center text-gray-500'},' 请加载地图图片 (推荐 1024x1024) ',-1))],2112)),Rn(' Canvas Overlay '),Mn('canvas',{ref:'canvasRef',width:e.mapWidth,height:e.mapHeight,class:ee(['absolute inset-0',e.isPanning?'cursor-grab':'cursor-crosshair']),onMousedown:t[31]||(t[31]=(...t)=>e.handleMouseDown&&e.handleMouseDown(...t)),onMousemove:t[32]||(t[32]=(...t)=>e.handleMouseMove&&e.handleMouseMove(...t)),onMouseup:t[33]||(t[33]=(...t)=>e.handleMouseUp&&e.handleMouseUp(...t)),onMouseleave:t[34]||(t[34]=(...t)=>e.handleMouseUp&&e.handleMouseUp(...t))},null,42,Lk)],36)],544),Rn(' Event Editor Modal '),e.showEventEditor?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-[110] flex items-center justify-center bg-black/70',onClick:t[60]||(t[60]=Cl(t=>e.showEventEditor=!1,['self']))},[Mn('div',Bk,[t[123]||(t[123]=Mn('h3',{class:'mb-4 text-lg font-bold text-amber-500'},'事件属性编辑',-1)),Rn(' Basic Info '),Mn('div',Ok,[Mn('div',qk,[t[97]||(t[97]=Mn('span',{class:'w-20 text-xs text-gray-400'},'事件ID:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[44]||(t[44]=t=>e.currentEventId=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none'},null,512),[[fl,e.currentEventId]])]),Mn('div',Uk,[t[98]||(t[98]=Mn('span',{class:'w-20 text-xs text-gray-400'},'显示名称:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[45]||(t[45]=t=>e.currentEventName=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none'},null,512),[[fl,e.currentEventName]])]),Mn('div',Vk,[t[99]||(t[99]=Mn('span',{class:'w-20 text-xs text-gray-400'},'事件类型:',-1)),Mn('div',Fk,[(yn(!0),Sn(pn,null,xs(e.eventTypes,t=>(yn(),Sn('button',{key:t.value,class:ee(['rounded px-2 py-1 text-xs transition-colors',e.currentEventType===t.value?'text-white':'bg-gray-700 text-gray-400 hover:bg-gray-600']),style:X(e.currentEventType===t.value?{backgroundColor:t.color.replace('0.6','0.8')}:{}),onClick:a=>e.currentEventType=t.value},oe(t.icon)+' '+oe(t.label),15,Hk))),128))])])]),Rn(' Type-specific params '),Mn('div',Gk,[Rn(' Portal In (New system) '),'portal_in'===e.currentEventType?(yn(),Sn(pn,{key:0},[t[103]||(t[103]=Mn('h4',{class:'mb-2 text-sm font-bold text-blue-400'},'🚪 传送入口参数',-1)),Mn('div',zk,[Mn('div',Wk,[t[100]||(t[100]=Mn('span',{class:'w-24 text-xs text-gray-400'},'目标地图:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[46]||(t[46]=t=>e.eventParams.portalTargetMap=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'map-8(圣银王国) 或 map-8'},null,512),[[fl,e.eventParams.portalTargetMap]])]),Mn('div',Qk,[t[101]||(t[101]=Mn('span',{class:'w-24 text-xs text-gray-400'},'传送点ID:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[47]||(t[47]=t=>e.eventParams.portalTargetId=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'北边入口'},null,512),[[fl,e.eventParams.portalTargetId]])]),t[102]||(t[102]=Mn('div',{class:'mt-2 rounded bg-blue-900/30 p-2 text-xs text-blue-300'},[Mn('p',null,'💡 使用说明：'),Mn('p',{class:'mt-1'},'1. 目标地图填写地图ID，如 "map-8" 或 "map-8(圣银王国)"'),Mn('p',null,'2. 传送点ID需要与目标地图中的【传送出口】的ID匹配'),Mn('p',null,'3. 进入此格子时会自动传送到目标地图的对应出口位置')],-1))])],64)):Rn('v-if',!0),Rn(' Portal Out (New system) '),'portal_out'===e.currentEventType?(yn(),Sn(pn,{key:1},[t[106]||(t[106]=Mn('h4',{class:'mb-2 text-sm font-bold text-green-400'},'📍 传送出口参数',-1)),Mn('div',Xk,[Mn('div',Yk,[t[104]||(t[104]=Mn('span',{class:'w-24 text-xs text-gray-400'},'传送点ID:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[48]||(t[48]=t=>e.eventParams.portalId=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'北边入口'},null,512),[[fl,e.eventParams.portalId]])]),t[105]||(t[105]=Mn('div',{class:'mt-2 rounded bg-green-900/30 p-2 text-xs text-green-300'},[Mn('p',null,'💡 使用说明：'),Mn('p',{class:'mt-1'},'1. 传送点ID是其他地图传送入口引用的标识符'),Mn('p',null,'2. 例如：此处设置ID为"北边入口"，其他地图的传送入口可以设置目标为此ID'),Mn('p',null,'3. 玩家从传送入口进入后，会出现在此出口的位置')],-1))])],64)):Rn('v-if',!0),Rn(' Teleport (Legacy) '),'teleport'===e.currentEventType?(yn(),Sn(pn,{key:2},[t[110]||(t[110]=Mn('h4',{class:'mb-2 text-sm font-bold text-purple-400'},'🌀 传送参数 (旧版)',-1)),Mn('div',Kk,[Mn('div',Jk,[t[107]||(t[107]=Mn('span',{class:'w-20 text-xs text-gray-400'},'目标地图:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[49]||(t[49]=t=>e.eventParams.targetMap=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'map-7'},null,512),[[fl,e.eventParams.targetMap]])]),Mn('div',Zk,[t[108]||(t[108]=Mn('span',{class:'w-20 text-xs text-gray-400'},'目标坐标:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[50]||(t[50]=t=>e.eventParams.targetX=t),type:'number',class:'w-16 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'X'},null,512),[[fl,e.eventParams.targetX,void 0,{number:!0}]]),xa(Mn('input',{'onUpdate:modelValue':t[51]||(t[51]=t=>e.eventParams.targetY=t),type:'number',class:'w-16 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'Y'},null,512),[[fl,e.eventParams.targetY,void 0,{number:!0}]])]),t[109]||(t[109]=Mn('div',{class:'mt-2 rounded bg-purple-900/30 p-2 text-xs text-purple-300'},[Mn('p',null,'⚠️ 旧版传送需要硬编码坐标，推荐使用新版【传送入口+传送出口】系统')],-1))])],64)):Rn('v-if',!0),Rn(' Gate '),'gate'===e.currentEventType?(yn(),Sn(pn,{key:3},[t[112]||(t[112]=Mn('h4',{class:'mb-2 text-sm font-bold text-yellow-400'},'🚪 城门参数',-1)),Mn('div',eS,[Mn('div',tS,[t[111]||(t[111]=Mn('span',{class:'w-20 text-xs text-gray-400'},'区域名称:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[52]||(t[52]=t=>e.eventParams.regionName=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'圣银城堡'},null,512),[[fl,e.eventParams.regionName]])])])],64)):Rn('v-if',!0),Rn(' Encounter '),'encounter'===e.currentEventType?(yn(),Sn(pn,{key:4},[t[116]||(t[116]=Mn('h4',{class:'mb-2 text-sm font-bold text-red-400'},'⚔️ 遭遇参数',-1)),Mn('div',aS,[Mn('div',sS,[t[113]||(t[113]=Mn('span',{class:'w-20 text-xs text-gray-400'},'遭遇率:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[53]||(t[53]=t=>e.eventParams.encounterRate=t),type:'number',min:'0',max:'100',class:'w-20 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none'},null,512),[[fl,e.eventParams.encounterRate,void 0,{number:!0}]]),t[114]||(t[114]=Mn('span',{class:'text-xs text-gray-500'},'%',-1))]),Mn('div',nS,[t[115]||(t[115]=Mn('span',{class:'w-20 text-xs text-gray-400'},'敌人池:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[54]||(t[54]=t=>e.eventParams.enemyPoolStr=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'slime,goblin,wolf'},null,512),[[fl,e.eventParams.enemyPoolStr]])])])],64)):Rn('v-if',!0),Rn(' Chest '),'chest'===e.currentEventType?(yn(),Sn(pn,{key:5},[t[119]||(t[119]=Mn('h4',{class:'mb-2 text-sm font-bold text-yellow-500'},'📦 宝箱参数',-1)),Mn('div',rS,[Mn('label',lS,[xa(Mn('input',{'onUpdate:modelValue':t[55]||(t[55]=t=>e.eventParams.oneTime=t),type:'checkbox',class:'rounded border-gray-600 bg-gray-700 text-blue-500'},null,512),[[vl,e.eventParams.oneTime]]),t[117]||(t[117]=Mn('span',{class:'text-xs text-gray-300'},'一次性宝箱',-1))]),Mn('div',oS,[t[118]||(t[118]=Mn('span',{class:'w-20 text-xs text-gray-400'},'物品奖励:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[56]||(t[56]=t=>e.eventParams.itemRewardsStr=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'gold:100,potion:2'},null,512),[[fl,e.eventParams.itemRewardsStr]])])])],64)):Rn('v-if',!0),Rn(' Conditions '),Mn('div',iS,[t[122]||(t[122]=Mn('h4',{class:'mb-2 text-sm font-bold text-cyan-400'},'⚡ 条件设置',-1)),Mn('div',cS,[Mn('div',dS,[t[120]||(t[120]=Mn('span',{class:'w-20 text-xs text-gray-400'},'需要物品:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[57]||(t[57]=t=>e.eventParams.requireItem=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'留空=无需物品'},null,512),[[fl,e.eventParams.requireItem]])]),Mn('div',uS,[t[121]||(t[121]=Mn('span',{class:'w-20 text-xs text-gray-400'},'需要标记:',-1)),xa(Mn('input',{'onUpdate:modelValue':t[58]||(t[58]=t=>e.eventParams.requireFlag=t),type:'text',class:'flex-1 rounded bg-[#202225] px-2 py-1 text-xs text-white focus:outline-none',placeholder:'留空=无需标记'},null,512),[[fl,e.eventParams.requireFlag]])])])])]),Mn('div',pS,[Mn('button',{class:'rounded bg-gray-600 px-4 py-2 text-xs hover:bg-gray-500',onClick:t[59]||(t[59]=t=>e.showEventEditor=!1)},' 关闭 ')])])])):Rn('v-if',!0),Rn(' Export Modal '),e.showExport?(yn(),Sn('div',{key:1,class:'fixed inset-0 z-[110] flex items-center justify-center bg-black/70',onClick:t[62]||(t[62]=Cl(t=>e.showExport=!1,['self']))},[Mn('div',mS,[t[124]||(t[124]=Mn('h3',{class:'mb-2 text-lg font-bold'},'导出结果',-1)),Mn('textarea',{readonly:'',class:'h-64 flex-1 resize-none rounded bg-[#202225] p-2 font-mono text-xs text-gray-300',value:e.exportJson},null,8,gS),Mn('div',hS,[Mn('button',{class:'rounded bg-blue-600 px-4 py-2 hover:bg-blue-500',onClick:t[61]||(t[61]=(...t)=>e.copyToClipboard&&e.copyToClipboard(...t))},'复制并关闭')])])])):Rn('v-if',!0)])):Rn('v-if',!0)}]]),bS={class:'relative flex h-[95vh] w-[98vw] max-w-6xl flex-col rounded-lg border border-[#202225] bg-[#2f3136] shadow-2xl md:h-[90vh] md:w-[95vw]'},xS={class:'flex items-center justify-between border-b border-gray-700 bg-[#202225] px-2 pt-[max(1.5rem,env(safe-area-inset-top))] pb-2 md:px-4 md:py-3'},wS={class:'text-sm font-bold text-amber-500 md:text-xl'},kS={class:'flex items-center space-x-1 md:space-x-4'},SS={key:0,class:'pointer-events-none absolute top-12 left-1/2 z-50 -translate-x-1/2 rounded-full border border-amber-500/50 bg-black/70 px-3 py-1 text-sm font-bold text-amber-100 shadow-[0_0_15px_rgba(251,191,36,0.3)] backdrop-blur-sm md:top-16 md:px-6 md:py-2 md:text-lg'},_S={class:'relative flex-1 overflow-hidden bg-[#1a1b1e]'},CS={key:0,class:'absolute inset-0 flex items-center justify-center text-amber-500'},IS=['src'],TS=['width','height'],AS={class:'absolute -top-6 left-1/2 -translate-x-1/2 rounded bg-black/50 px-1 text-xs font-bold whitespace-nowrap text-white'},MS={key:1,class:'pointer-events-none absolute bottom-2 left-2 z-10 max-w-xs rounded border border-gray-600 bg-black/80 p-2 text-xs text-white shadow-xl backdrop-blur-sm md:bottom-4 md:left-4 md:max-w-sm md:p-3 md:text-sm'},ES={class:'mb-0.5 font-bold text-amber-400 md:mb-1'},$S={key:0,class:'text-green-300'},DS={key:1,class:'text-yellow-300'},PS={key:2,class:'text-red-400'};const NS={key:0,class:'absolute top-1/2 left-1/2 z-50 w-64 -translate-x-1/2 -translate-y-1/2 rounded-lg border border-amber-600/50 bg-[#1a1b1e]/95 p-4 text-center shadow-xl backdrop-blur-sm'},RS={class:'mb-2 text-lg font-bold text-amber-500'},jS={class:'mb-4 text-sm text-gray-300'},LS={class:'flex justify-center space-x-2'};const BS=Za({name:'MapInteractionModal',props:{visible:{type:Boolean,default:!1},title:{type:String,default:'提示'},message:{type:String,default:''},confirmText:{type:String,default:'确认'}},emits:['confirm','cancel']}),OS=Za({name:'MapViewer',components:{MapInteractionModal:(0,$u.A)(BS,[['render',function(e,t,a,s,n,r){return e.visible?(yn(),Sn('div',NS,[Mn('h3',RS,oe(e.title),1),Mn('p',jS,oe(e.message),1),Mn('div',LS,[Mn('button',{class:'rounded bg-red-800/80 px-3 py-1 text-xs text-white hover:bg-red-700',onClick:t[0]||(t[0]=t=>e.$emit('cancel'))},' 取消 '),Mn('button',{class:'rounded bg-green-700/80 px-3 py-1 text-xs text-white hover:bg-green-600',onClick:t[1]||(t[1]=t=>e.$emit('confirm'))},oe(e.confirmText),1)])])):Rn('v-if',!0)}]])},props:{visible:{type:Boolean,default:!1},mapId:{type:String,default:'map-5'},previousMapId:{type:String,default:''},playerPos:{type:Object,default:()=>({x:0,y:0})},playerSpd:{type:Number,default:10},playerName:{type:String,default:'You'}},emits:['close','location-select','update:playerPos','trigger-event','cancel-interaction','handle-interaction'],setup(e,{emit:t}){const a=$t(!1),s=$t(null),n=$t(null),r=$t('');let l=null;const o=$t(1),i=$t(0),c=$t(0),d=$t(!1),u=$t(0),p=$t(0),m=$t(0),g=$t({x:0,y:0}),h=$t(!1),f=$t({x:0,y:0}),v=$t(0),y=$t(!1),b=$t(window.innerWidth<768),x=()=>{b.value=window.innerWidth<768,O()},w=$t(''),k=$t(''),S=$t(1024),C=$t(1024),I=$t(10),T=$t(new Set),A=$t(new Map),M=$t(new Map),E=$t([]),D=$t([]),P=$t(null),N=$t({visible:!1,title:'',message:'',confirmText:'确认',eventData:null}),R=$t({x:0,y:0}),j=$t(null);let L=null,B=0;const O=()=>{if(!s.value)return;const e=s.value.getBoundingClientRect(),t=e.width,a=e.height,n=S.value*o.value,r=C.value*o.value;if(n<=t)i.value=0;else{const e=(t-n)/2,a=(n-t)/2;i.value=Math.min(Math.max(i.value,e),a)}if(r<=a)c.value=0;else{const e=(a-r)/2,t=(r-a)/2;c.value=Math.min(Math.max(c.value,e),t)}},q=e=>{if(e.length<2)return 0;const t=e[0].clientX-e[1].clientX,a=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+a*a)},U=e=>e.length<2?{x:e[0].clientX,y:e[0].clientY}:{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2},V=e=>{const a=n.value;if(!a)return;const s=a.getBoundingClientRect(),r=S.value/s.width,l=C.value/s.height,o=Math.floor((e.clientX-s.left)*r/I.value),i=Math.floor((e.clientY-s.top)*l/I.value),c=`${o},${i}`;T.value.has(c)||(t('cancel-interaction'),j.value={x:o,y:i},L||(B=performance.now(),L=requestAnimationFrame(Q)))},F=async s=>{const n=Jp[s];if(n){a.value=!0,w.value=n.name,k.value=n.image,R.value={...e.playerPos},j.value=null;try{if(n.mapData){H(n.mapData);const a=n.mapData;let s='默认出生点';if(e.previousMapId){const t=a?.events?.find(t=>t.id.includes(`传送至${e.previousMapId}`));t&&(s=t.id)}const r=a?.events?.find(e=>e.id===s)||a?.events?.find(e=>'默认出生点'===e.id);if(r&&r.at&&r.at.length>0){const e=r.at[0];let a=0,s=0;2===e.length?(a=e[0],s=e[1]):4===e.length&&(a=Math.floor(e[0]+e[2]/2),s=Math.floor(e[1]+e[3]/2)),R.value={x:a,y:s},t('update:playerPos',{x:a,y:s})}else 0===R.value.x&&R.value.y}else T.value.clear(),A.value.clear(),M.value.clear(),D.value=[]}catch(e){console.error('Failed to load map JSON',e)}finally{a.value=!1,setTimeout(K,100)}}else console.error(`Map ID ${s} not found.`)},H=e=>{if(T.value.clear(),A.value.clear(),M.value.clear(),D.value=[],E.value=[],e.meta&&(I.value=e.meta.cellSize||10,S.value=(e.meta.width||100)*I.value,C.value=(e.meta.height||100)*I.value),Array.isArray(e.walls)&&e.walls.forEach(e=>{if(2===e.length)T.value.add(`${e[0]},${e[1]}`);else if(4===e.length){const[t,a,s,n]=e;for(let e=0;e<s;e++)for(let s=0;s<n;s++)T.value.add(`${t+e},${a+s}`)}}),e.regions)for(const[t,a]of Object.entries(e.regions))a.forEach(e=>{if(2===e.length)A.value.set(`${e[0]},${e[1]}`,t);else if(4===e.length){const[a,s,n,r]=e;for(let e=0;e<n;e++)for(let n=0;n<r;n++)A.value.set(`${a+e},${s+n}`,t)}});Array.isArray(e.events)&&e.events.forEach(e=>{let t;var a;if(t=(a=e)&&'string'==typeof a.type&&Object.values(Zp).includes(a.type)?e:function(e){const t=e.id;if(t.includes('传送至')||t.includes('传送到')){const a=t.match(/传送[至到](map-\d+)/);return{id:t,type:Zp.TELEPORT,name:t,at:e.at,params:{targetMap:a?.[1]}}}return t.includes('城门')||t.includes('关卡')?{id:t,type:Zp.GATE,name:t,at:e.at}:t.includes('进入')?{id:t,type:Zp.ENTER,name:t.replace('进入','').trim(),at:e.at,params:{regionName:t.replace('进入','').trim()}}:'默认出生点'===t||t.includes('出生点')||t.includes('复活点')?{id:t,type:Zp.SPAWN,at:e.at}:t.includes('NPC')||t.includes('npc')?{id:t,type:Zp.NPC,name:t,at:e.at}:t.includes('宝箱')||t.includes('箱子')?{id:t,type:Zp.CHEST,name:t,at:e.at,params:{oneTime:!0}}:{id:t,type:Zp.TRIGGER,name:t,at:e.at}}(e),E.value.push(t),(t.type===Zp.TELEPORT||t.id.includes('传送至'))&&Array.isArray(t.at)&&t.at.length>0){const e=t.at[0];let a=0,s=0;2===e.length?(a=e[0],s=e[1]):4===e.length&&(a=Math.floor(e[0]+e[2]/2),s=Math.floor(e[1]+e[3]/2)),D.value.push({x:a,y:s})}const s=(e,a)=>{M.value.set(`${e},${a}`,{id:t.id,type:t.type,event:t})};Array.isArray(t.at)&&t.at.forEach(e=>{if(2===e.length)s(e[0],e[1]);else if(4===e.length){const[t,a,n,r]=e;for(let e=0;e<n;e++)for(let n=0;n<r;n++)s(t+e,a+n)}})})},G=e=>{const t=e.target.getBoundingClientRect(),a=S.value/t.width,s=C.value/t.height;return{gx:Math.floor((e.clientX-t.left)*a/I.value),gy:Math.floor((e.clientY-t.top)*s/I.value)}},W=(e,t)=>!T.value.has(`${e},${t}`),Q=a=>{if(!j.value)return void(L=null);const s=(a-B)/1e3;B=a;const n=Math.min(e.playerSpd,20)/10*8,r=j.value.x-R.value.x,l=j.value.y-R.value.y,o=Math.sqrt(r*r+l*l);if(o<.1)R.value.x=j.value.x,R.value.y=j.value.y,t('update:playerPos',{x:Math.round(R.value.x),y:Math.round(R.value.y)}),X(),j.value=null,L=null;else{const e=n*s,a=Math.min(1,e/o),i=r*a,c=l*a;let d=R.value.x+i,u=R.value.y+c;const p=Math.round(R.value.x),m=Math.round(R.value.y),g=Math.round(d),h=Math.round(u);if((g!==p||h!==m)&&!W(g,h)){const a=g!==p&&W(g,m),s=h!==m&&W(p,h);if(a&&s)Math.abs(i)>Math.abs(c)?(d=R.value.x+i,u=R.value.y):(d=R.value.x,u=R.value.y+c);else if(a)d=R.value.x+i,u=R.value.y;else if(s)d=R.value.x,u=R.value.y+c;else{const a=[],s=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}];for(const e of s){const t=p+e.dx,s=m+e.dy;if(W(t,s)){const n=j.value.x-p,r=j.value.y-m,l=e.dx*n+e.dy*r;l>0&&a.push({x:t,y:s,priority:l})}}if(!(a.length>0))return j.value=null,L=null,void t('update:playerPos',{x:p,y:m});{a.sort((e,t)=>t.priority-e.priority);const t=a[0],s=t.x-R.value.x,n=t.y-R.value.y,r=Math.sqrt(s*s+n*n),l=Math.min(1,e/r);d=R.value.x+s*l,u=R.value.y+n*l}}}R.value.x=d,R.value.y=u,L=requestAnimationFrame(Q)}},X=()=>{const e=`${Math.round(R.value.x)},${Math.round(R.value.y)}`,t=M.value.get(e),a=A.value.get(e);var s;t?Y(t):a&&(s=a,r.value=s,clearTimeout(l),l=setTimeout(()=>{r.value=''},3e3))},Y=e=>{const{type:a,event:s}=e,n=em[a];if(a===Zp.TELEPORT||a===Zp.ENCOUNTER)return void t('trigger-event',{type:a,id:e.id,x:Math.round(R.value.x),y:Math.round(R.value.y),event:s});let r=n?.icon?`${n.icon} `:'',l='',o='确认';switch(a){case Zp.GATE:r+=s.name||'城门',l='城门紧闭。是否尝试请求进入？',o='请求进入';break;case Zp.NPC:r+=s.name||'NPC',l=`是否与 ${s.name} 对话？`,o='对话';break;case Zp.CHEST:r+='发现宝箱',l='是否打开这个宝箱？',o='打开';break;case Zp.ENTER:case Zp.TRANSITION:r+=s.name||'区域',l=`是否进入 ${s.name}？`,o='进入';break;case Zp.TRIGGER:r+=s.name||'触发器',l=`是否触发 ${s.name}？`;break;default:return}N.value={visible:!0,title:r,message:l,confirmText:o,eventData:e}},K=()=>{if(!s.value)return;const e=R.value.x*I.value+I.value/2,t=R.value.y*I.value+I.value/2,a=S.value/2,n=C.value/2;i.value=(a-e)*o.value,c.value=(n-t)*o.value,O()};return _a(()=>e.visible,t=>{t?F(e.mapId):L&&(cancelAnimationFrame(L),L=null)}),_a(()=>e.mapId,t=>{e.visible&&F(t)}),us(()=>{e.visible&&F(e.mapId),window.addEventListener('resize',x)}),gs(()=>{L&&cancelAnimationFrame(L),window.removeEventListener('resize',x)}),{loading:a,containerRef:s,canvasRef:n,currentMapName:w,mapImage:k,mapWidth:S,mapHeight:C,gridSize:I,hoverInfo:P,toastMessage:r,isMobile:b,handleMouseMove:e=>{const{gx:t,gy:a}=G(e),s=`${t},${a}`,n=M.value.get(s);P.value={gx:t,gy:a,region:A.value.get(s),event:n?.id,eventType:n?.type,isWall:T.value.has(s)}},handleMapClick:e=>{const{gx:a,gy:s}=G(e),n=`${a},${s}`;T.value.has(n)||(t('cancel-interaction'),j.value={x:a,y:s},L||(B=performance.now(),L=requestAnimationFrame(Q)))},scale:o,translateX:i,translateY:c,handleWheel:e=>{e.preventDefault();const t=.001*-e.deltaY;o.value=Math.min(Math.max(.3,o.value+t),1.8),requestAnimationFrame(O)},startDrag:e=>{0===e.button&&(d.value=!0,u.value=e.clientX-i.value,p.value=e.clientY-c.value)},onDrag:e=>{d.value&&(i.value=e.clientX-u.value,c.value=e.clientY-p.value,O())},stopDrag:()=>{d.value=!1},handleTouchStart:e=>{h.value=!0,v.value=Date.now(),y.value=!1,1===e.touches.length?(f.value={x:e.touches[0].clientX,y:e.touches[0].clientY},u.value=e.touches[0].clientX-i.value,p.value=e.touches[0].clientY-c.value):2===e.touches.length&&(e.preventDefault(),m.value=q(e.touches),g.value=U(e.touches))},handleTouchMove:e=>{if(h.value)if(1===e.touches.length){const t=Math.abs(e.touches[0].clientX-f.value.x),a=Math.abs(e.touches[0].clientY-f.value.y);(t>10||a>10)&&(y.value=!0,e.preventDefault()),y.value&&(i.value=e.touches[0].clientX-u.value,c.value=e.touches[0].clientY-p.value,O())}else if(2===e.touches.length){e.preventDefault();const t=q(e.touches),a=U(e.touches);if(m.value>0){const e=t/m.value,a=Math.min(Math.max(.3,o.value*e),1.8);o.value=a}const s=a.x-g.value.x,n=a.y-g.value.y;i.value+=s,c.value+=n,m.value=t,g.value=a,O(),y.value=!0}},handleTouchEnd:e=>{const t=Date.now()-v.value;if(0===e.touches.length){if(!y.value&&t<300&&e.changedTouches.length>0){const t=e.changedTouches[0];V(t)}h.value=!1,m.value=0,y.value=!1}else 1===e.touches.length&&(u.value=e.touches[0].clientX-i.value,p.value=e.touches[0].clientY-c.value,m.value=0,f.value={x:e.touches[0].clientX,y:e.touches[0].clientY},y.value=!1)},centerOnPlayer:K,visualPlayerPos:R,targetPos:j,teleportPoints:D,interaction:N,handleInteractionConfirm:()=>{const{eventData:e}=N.value;e&&(N.value.visible=!1,t('handle-interaction',{type:e.type,id:e.id,event:e.event}))},handleInteractionCancel:()=>{N.value.visible=!1}}}}),qS=(0,$u.A)(OS,[['render',function(e,t,a,s,n,r){const l=fs('MapInteractionModal');return e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-[80] flex items-center justify-center bg-black/80',onClick:t[13]||(t[13]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',bS,[Rn(' Header - 手机端更紧凑 '),Mn('div',xS,[Mn('h2',wS,'🗺️ '+oe(e.currentMapName),1),Mn('div',kS,[Mn('button',{class:'rounded bg-blue-700 px-1.5 py-0.5 text-[10px] text-white hover:bg-blue-600 md:px-2 md:py-1 md:text-xs',onClick:t[0]||(t[0]=(...t)=>e.centerOnPlayer&&e.centerOnPlayer(...t))},[...t[14]||(t[14]=[Pn(' 📍 ',-1),Mn('span',{class:'hidden sm:inline'},'定位玩家',-1)])]),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[1]||(t[1]=t=>e.$emit('close'))},[...t[15]||(t[15]=[Mn('svg',{class:'h-5 w-5 md:h-6 md:w-6',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])])]),Rn(' Location Toast - 手机端更小 '),En(wr,{name:'fade'},{default:ba(()=>[e.toastMessage?(yn(),Sn('div',SS,oe(e.toastMessage),1)):Rn('v-if',!0)]),_:1}),Rn(' Content '),Mn('div',_S,[Rn(' Loading State '),e.loading?(yn(),Sn('div',CS,[...t[16]||(t[16]=[Mn('svg',{class:'h-8 w-8 animate-spin',viewBox:'0 0 24 24'},[Mn('circle',{class:'opacity-25',cx:'12',cy:'12',r:'10',stroke:'currentColor','stroke-width':'4',fill:'none'}),Mn('path',{class:'opacity-75',fill:'currentColor',d:'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'})],-1),Mn('span',{class:'ml-3'},'加载地图数据中...',-1)])])):Rn('v-if',!0),Rn(' Map Canvas Container '),Mn('div',{ref:'containerRef',class:'relative h-full w-full cursor-move touch-none overflow-hidden bg-[#1a1b1e] select-none',onWheel:t[5]||(t[5]=(...t)=>e.handleWheel&&e.handleWheel(...t)),onMousedown:t[6]||(t[6]=(...t)=>e.startDrag&&e.startDrag(...t)),onMousemove:t[7]||(t[7]=(...t)=>e.onDrag&&e.onDrag(...t)),onMouseup:t[8]||(t[8]=(...t)=>e.stopDrag&&e.stopDrag(...t)),onMouseleave:t[9]||(t[9]=(...t)=>e.stopDrag&&e.stopDrag(...t)),onTouchstart:t[10]||(t[10]=(...t)=>e.handleTouchStart&&e.handleTouchStart(...t)),onTouchmove:t[11]||(t[11]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t)),onTouchend:t[12]||(t[12]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Mn('div',{class:'absolute origin-center shadow-lg transition-transform duration-75 ease-out',style:X({width:e.mapWidth+'px',height:e.mapHeight+'px',transform:`translate(${e.translateX}px, ${e.translateY}px) scale(${e.scale})`,left:'50%',top:'50%',marginLeft:-e.mapWidth/2+'px',marginTop:-e.mapHeight/2+'px'})},[Rn(' Background Image '),Rn(' 使用CSS样式强制图片尺寸与画布完全一致 '),e.mapImage?(yn(),Sn('img',{key:0,src:e.mapImage,class:'pointer-events-none absolute top-0 left-0 block select-none',style:X({width:e.mapWidth+'px',height:e.mapHeight+'px',minWidth:e.mapWidth+'px',minHeight:e.mapHeight+'px',maxWidth:e.mapWidth+'px',maxHeight:e.mapHeight+'px'}),draggable:'false'},null,12,IS)):Rn('v-if',!0),Rn(' Canvas for Interaction & Highlights '),Mn('canvas',{ref:'canvasRef',width:e.mapWidth,height:e.mapHeight,class:'absolute inset-0 cursor-crosshair',onClick:t[2]||(t[2]=(...t)=>e.handleMapClick&&e.handleMapClick(...t)),onMousemove:t[3]||(t[3]=(...t)=>e.handleMouseMove&&e.handleMouseMove(...t)),onMouseleave:t[4]||(t[4]=t=>e.hoverInfo=null)},null,40,TS),Rn(' Teleport Markers (Enhanced) '),(yn(!0),Sn(pn,null,xs(e.teleportPoints,(a,s)=>(yn(),Sn('div',{key:s,class:'pointer-events-none absolute z-0 h-12 w-12 -translate-x-1/2 -translate-y-1/2 animate-pulse rounded-full border-2 border-amber-300 bg-amber-400/20 shadow-[0_0_20px_rgba(251,191,36,0.6)]',style:X({left:a.x*e.gridSize+e.gridSize/2+'px',top:a.y*e.gridSize+e.gridSize/2+'px'})},[...t[17]||(t[17]=[Mn('div',{class:'absolute top-1/2 left-1/2 h-4 w-4 -translate-x-1/2 -translate-y-1/2 rounded-full bg-amber-200 shadow-[0_0_10px_rgba(255,255,255,0.8)]'},null,-1)])],4))),128)),Rn(' Player Marker (Visual) '),e.visualPlayerPos?(yn(),Sn('div',{key:1,class:'pointer-events-none absolute z-10 h-4 w-4 -translate-x-1/2 -translate-y-1/2 transform rounded-full border-2 border-white bg-blue-500 shadow-md transition-all duration-75',style:X({left:e.visualPlayerPos.x*e.gridSize+e.gridSize/2+'px',top:e.visualPlayerPos.y*e.gridSize+e.gridSize/2+'px'})},[Mn('div',AS,oe(e.playerName),1)],4)):Rn('v-if',!0),Rn(' Target Marker (Debugging or Visual Aid) '),e.targetPos?(yn(),Sn('div',{key:2,class:'pointer-events-none absolute z-0 h-2 w-2 -translate-x-1/2 -translate-y-1/2 animate-ping rounded-full bg-green-500/50',style:X({left:e.targetPos.x*e.gridSize+e.gridSize/2+'px',top:e.targetPos.y*e.gridSize+e.gridSize/2+'px'})},null,4)):Rn('v-if',!0)],4)],544),Rn(' Hover Info - 手机端隐藏或更紧凑 '),e.hoverInfo&&!e.isMobile?(yn(),Sn('div',MS,[Mn('div',ES,'坐标: '+oe(e.hoverInfo.gx)+', '+oe(e.hoverInfo.gy),1),e.hoverInfo.region?(yn(),Sn('div',$S,[t[18]||(t[18]=Mn('span',{class:'mr-1'},'🌲',-1)),Pn(' '+oe(e.hoverInfo.region),1)])):Rn('v-if',!0),e.hoverInfo.event?(yn(),Sn('div',DS,[t[19]||(t[19]=Mn('span',{class:'mr-1'},'✨',-1)),Pn(' '+oe(e.hoverInfo.event),1)])):Rn('v-if',!0),e.hoverInfo.isWall?(yn(),Sn('div',PS,[...t[20]||(t[20]=[Mn('span',{class:'mr-1'},'🚫',-1),Pn(' 无法通行',-1)])])):Rn('v-if',!0)])):Rn('v-if',!0),Rn(' Slot for Modals '),ws(e.$slots,'default',{},void 0,!0),Rn(' Internal Interaction Modal '),En(l,{visible:e.interaction.visible,title:e.interaction.title,message:e.interaction.message,'confirm-text':e.interaction.confirmText,onConfirm:e.handleInteractionConfirm,onCancel:e.handleInteractionCancel},null,8,['visible','title','message','confirm-text','onConfirm','onCancel'])])])])):Rn('v-if',!0)}],['__scopeId','data-v-57b6116a']]),US={class:'flex items-center justify-between border-b border-gray-700 bg-[#202225] px-2 pt-[max(1.5rem,env(safe-area-inset-top))] pb-2 md:px-4 md:py-3'},VS={class:'flex items-center space-x-1 md:space-x-3'},FS={class:'hidden text-xs text-gray-400 sm:inline'},HS={class:'flex items-center space-x-1 md:space-x-2'},GS={class:'flex items-center space-x-1 border-b border-gray-700 bg-[#36393f] px-2 py-1 md:px-4 md:py-2'},zS={key:0,class:'flex flex-wrap items-center gap-0.5 md:gap-1'},WS=['onClick','onContextmenu','onTouchstart'],QS={key:0,class:'text-[10px] text-gray-500 md:text-xs'},XS={key:1,class:'text-[10px] text-gray-500 italic md:text-xs'},YS={key:0,class:'border-b border-gray-700 bg-[#36393f] px-2 py-1.5 md:px-4 md:py-2'},KS={class:'flex items-start gap-2'},JS={class:'flex shrink-0 items-center gap-1'},ZS={class:'text-base md:text-lg'},e_={key:0,class:'text-[9px] text-amber-500 md:text-xs'},t_={class:'flex shrink-0 items-center gap-2 text-[9px] text-gray-400 md:text-xs'},a_={key:0},s_={class:'ml-auto flex shrink-0 items-center gap-1'},n_={key:0,class:'mt-1 line-clamp-2 text-[10px] text-gray-300 md:text-xs'},r_={key:1,class:'mt-1 flex flex-wrap gap-1'},l_={key:0,class:'flex h-full flex-col items-center justify-center text-gray-500'},o_={key:1,class:'absolute top-4 left-1/2 z-20 -translate-x-1/2 transform rounded-lg bg-green-700 px-3 py-1.5 text-xs text-white shadow-lg md:px-4 md:py-2 md:text-sm'},i_=['viewBox'],c_=['transform'],d_={class:'edges'},u_=['x1','y1','x2','y2','stroke','stroke-width','marker-end'],p_={class:'nodes'},m_=['transform','onClick','onContextmenu','onTouchstart','onMouseenter'],g_=['r','fill','stroke','stroke-width'],h_=['font-size'],f_=['y','font-size','font-weight'],v_={class:'mb-1 flex items-center space-x-2'},y_={class:'text-base md:text-lg'},b_={class:'font-bold text-amber-400'},x_={key:0,class:'mb-2 text-[10px] text-gray-300 italic md:text-xs'},w_={class:'space-y-0.5 text-[10px] text-gray-400 md:text-xs'},k_={key:0},S_={key:1,class:'flex flex-wrap gap-1 pt-1'},__={class:'flex items-center justify-between border-t border-gray-700 bg-[#202225] px-2 py-1.5 md:px-4 md:py-2'},C_={class:'flex items-center space-x-1 md:space-x-2'},I_={class:'w-8 text-center text-[10px] text-white md:w-12 md:text-xs'},T_={class:'hidden items-center space-x-1 md:flex md:space-x-2'},A_=['disabled'],M_={class:'w-[90%] max-w-md rounded-lg border border-gray-600 bg-[#2f3136] p-4 shadow-xl'},E_={class:'mb-3 text-sm font-bold text-amber-500 md:text-base'},$_={class:'mt-3 flex justify-end gap-2'},D_={class:'w-[90%] max-w-md rounded-lg border border-gray-600 bg-[#2f3136] p-4 shadow-xl'},P_={class:'mb-3 text-sm font-bold text-amber-500 md:text-base'},N_={class:'mt-3 flex justify-end gap-2'},R_={class:'w-[90%] max-w-md rounded-lg border border-gray-600 bg-[#2f3136] p-4 shadow-xl'},j_={class:'mb-3 text-sm font-bold text-amber-500 md:text-base'},L_={class:'flex flex-wrap gap-2'},B_=['onClick'],O_={class:'mt-3 flex justify-end'},q_={class:'w-[90%] max-w-md rounded-lg border border-gray-600 bg-[#2f3136] p-4 shadow-xl'},U_={class:'mb-2 text-xs text-gray-300 md:text-sm'},V_={class:'font-bold text-white'},F_={key:0,class:'mb-2 text-xs text-amber-400 md:text-sm'},H_={class:'mt-4 flex justify-end gap-2'};const G_=Za({name:'NodeMapViewer',props:{visible:{type:Boolean,default:!1},graph:{type:Object,default:null},locationPath:{type:Array,default:()=>[]}},emits:['close','travel'],setup(e,{emit:t}){const a=$t(null),s=$t(null),n=$t(window.innerWidth<768),r=$t(2),l=$t(0),o=$t(0),i=$t(!1),c=$t(0),d=$t(0),u=$t(0),p=$t(0),m=$t(null),g=$t(null),h=$t(0),f=$t(0),v=$t(!1),y=$t(0),b=$t(0),x=$t(null),w=$t(null),k=$t({x:0,y:0}),S=$t(!1),C=$t(!1),I=$t(!1),T=$t(!1),A=$t(!1),M=$t(null),E=$t(''),D=$t(''),P=$t(0),N=$t(800),R=$t(600),j=$t(null),L=$t(0),B=ir(()=>{if(L.value,e.graph&&Object.keys(e.graph.nodes).length>0)return e.graph;const t=j.value?.getGraph();return t&&Object.keys(t.nodes).length>0?t:Ai()}),O=ir(()=>Object.keys(B.value.nodes).length),q=ir(()=>{let e=0;for(const t of Object.values(B.value.edges))e+=t.length;return e}),U=ir(()=>B.value.currentNode),V=ir(()=>e.locationPath&&e.locationPath.length>0?e.locationPath:U.value?j.value?.findPathToNode(U.value)||[U.value]:[]),F=ir(()=>j.value?j.value.layoutNodes():[]),H=ir(()=>j.value?j.value.layoutEdges(F.value):[]),G=ir(()=>{const e=g.value||U.value;return e&&B.value.nodes[e]||null}),W=ir(()=>{if(!G.value)return'';if(G.value.desc)return G.value.desc;if(G.value.id===U.value)try{const e=Ll.serviceLocator.get('SaveService').getGameState();if(e?.scene?.desc)return e.scene.desc}catch{}return''}),Q=ir(()=>{if(!x.value)return[];const e=B.value.nodes[x.value];return e?.tags||[]}),X=ir(()=>!(!x.value||!j.value)&&null===j.value.canDeleteNode(x.value)),Y=ir(()=>x.value&&j.value?j.value.canDeleteNode(x.value):null),K=ir(()=>{const e=F.value;if(0===e.length)return'0 0 800 600';let t=1/0,a=-1/0,s=1/0,n=-1/0;for(const r of e)r.x<t&&(t=r.x),r.x>a&&(a=r.x),r.y<s&&(s=r.y),r.y>n&&(n=r.y);return`0 0 ${Math.max(800,a-t+200)} ${Math.max(600,n-s+200)}`});_a(K,e=>{const t=e.split(' ').map(Number);4===t.length&&(N.value=t[2],R.value=t[3])},{immediate:!0});const J=()=>{n.value=window.innerWidth<768},Z=()=>{if(!U.value||!F.value.length)return;const e=F.value.find(e=>e.id===U.value);e&&(l.value=-e.x,o.value=100-e.y)},ee=(e,t)=>{let a,s;x.value=t,M.value=t,'touches'in e?(a=e.touches[0]?.clientX||0,s=e.touches[0]?.clientY||0):(a=e.clientX,s=e.clientY);y.value=Math.min(a,window.innerWidth-140),b.value=Math.min(s,window.innerHeight-160),v.value=!0},te=()=>{v.value=!1},ae=$t(!1),se=$t('');return _a(()=>e.visible,e=>{if(e){try{j.value=Ll.serviceLocator.get('NodeMapService')}catch{}setTimeout(()=>{Z()},100)}else te(),g.value=null}),us(()=>{try{j.value=Ll.serviceLocator.get('NodeMapService')}catch{}window.addEventListener('resize',J)}),gs(()=>{window.removeEventListener('resize',J),w.value&&clearTimeout(w.value)}),{containerRef:a,svgRef:s,scale:r,panX:l,panY:o,isPanning:i,svgWidth:N,svgHeight:R,viewBox:K,hoveredNode:m,selectedNode:g,tooltipX:h,tooltipY:f,nodeCount:O,edgeCount:q,currentNode:U,currentPath:V,computedNodes:F,computedEdges:H,isMobile:n,displayedNodeInfo:G,displayedNodeDesc:W,contextMenuVisible:v,contextMenuX:y,contextMenuY:b,contextMenuNodeId:x,contextMenuNodeTags:Q,canDeleteContextNode:X,deleteNodeReason:Y,editDescModalVisible:C,addTagModalVisible:I,removeTagModalVisible:T,deleteConfirmVisible:A,editingNodeId:M,editDescValue:E,newTagValue:D,deleteChildCount:P,getNodeColor:e=>{if(e.isCurrent)return'#292524';switch(e.type){case'country':return'#1e3a5f';case'city':return'#1e3a3f';case'building':return'#3f2a1e';case'floor':return'#2a2a3f';case'room':return'#2a3f2a';default:return'#2a2a2a'}},getNodeIcon:e=>{switch(e){case'country':return'🏔️';case'city':return'🏙️';case'building':return'🏛️';case'floor':return'🔼';case'room':return'🚪';case'outdoor':return'🌲';default:return'📍'}},truncateName:(e,t=8)=>e.length>t?e.slice(0,t-1)+'…':e,formatTime:e=>{if(!e||'string'!=typeof e)return'';const t=e.match(/^(\d+)-(\d{2})-(\d{2})(?:\s+(\d{2}:\d{2}))?$/);if(t){const[,,e,a,s]=t,n=parseInt(e,10),r=parseInt(a,10);return s?`${n}月${r}日 ${s}`:`${n}月${r}日`}return e},handleWheel:e=>{e.preventDefault();const t=.001*-e.deltaY;r.value=Math.min(Math.max(.3,r.value+t),2.5)},startPan:e=>{0===e.button&&(i.value=!0,c.value=e.clientX,d.value=e.clientY,u.value=l.value,p.value=o.value)},onPan:e=>{if(m.value&&a.value){const t=a.value.getBoundingClientRect();h.value=e.clientX-t.left+15,f.value=e.clientY-t.top+15}i.value&&(l.value=u.value+(e.clientX-c.value),o.value=p.value+(e.clientY-d.value))},stopPan:()=>{i.value=!1},startPanTouch:e=>{1===e.touches.length&&(i.value=!0,c.value=e.touches[0].clientX,d.value=e.touches[0].clientY,u.value=l.value,p.value=o.value)},onPanTouch:e=>{i.value&&1===e.touches.length&&(e.preventDefault(),l.value=u.value+(e.touches[0].clientX-c.value),o.value=p.value+(e.touches[0].clientY-d.value))},stopPanTouch:()=>{i.value=!1},resetView:()=>{r.value=2,l.value=0,o.value=0},centerOnCurrent:Z,handleNodeClick:e=>{te(),g.value=e===g.value?null:e},handleTravel:()=>{if(!g.value)return;const e=j.value?.findPathToNode(g.value);e&&t('travel',{path:e,target:g.value})},showContextMenu:ee,closeContextMenu:te,handleTouchStart:(e,t)=>{S.value=!1,k.value={x:e.touches[0].clientX,y:e.touches[0].clientY},w.value=setTimeout(()=>{S.value||ee(e,t)},500)},handleTouchMove:e=>{if(!w.value)return;const t=Math.abs(e.touches[0].clientX-k.value.x),a=Math.abs(e.touches[0].clientY-k.value.y);(t>10||a>10)&&(S.value=!0,w.value&&(clearTimeout(w.value),w.value=null))},handleTouchEnd:()=>{w.value&&(clearTimeout(w.value),w.value=null)},startEditDesc:()=>{if(!M.value)return;const e=B.value.nodes[M.value];E.value=e?.desc||'',C.value=!0,te()},saveDesc:()=>{if(M.value&&j.value){j.value.updateNodeDesc(M.value,E.value),L.value++,C.value=!1;try{const e=Ll.serviceLocator.get('SaveService').getGameState();e&&(e.nodeMap=j.value.getGraph())}catch{}}},startAddTag:()=>{D.value='',I.value=!0,te()},saveTag:()=>{if(M.value&&j.value&&D.value.trim()){j.value.addNodeTag(M.value,D.value.trim()),L.value++,D.value='',I.value=!1;try{const e=Ll.serviceLocator.get('SaveService').getGameState();e&&(e.nodeMap=j.value.getGraph())}catch{}}},startRemoveTag:()=>{T.value=!0,te()},removeTag:e=>{if(M.value&&j.value){j.value.removeNodeTag(M.value,e),L.value++,0===Q.value.length&&(T.value=!1);try{const e=Ll.serviceLocator.get('SaveService').getGameState();e&&(e.nodeMap=j.value.getGraph())}catch{}}},confirmDeleteNode:()=>{X.value&&M.value&&j.value&&(P.value=j.value.getChildCount(M.value),A.value=!0,te())},executeDeleteNode:()=>{if(!M.value||!j.value)return;if(j.value.deleteNode(M.value,!1)){L.value++,g.value=null;try{const e=Ll.serviceLocator.get('SaveService').getGameState();e&&(e.nodeMap=j.value.getGraph())}catch{}}A.value=!1},markCurrentLocation:()=>{try{const e=Ll.serviceLocator.get('SaveService').getGameState();if(e?.scene?.locationPath&&e.scene.locationPath.length>0){j.value||(j.value=Ll.serviceLocator.get('NodeMapService'));const t=e.world?.date&&e.world?.time?`${e.world.date} ${e.world.time}`:void 0;j.value.insertLocationPath(e.scene.locationPath,e.scene.desc,t),e.nodeMap=j.value.getGraph(),L.value++,se.value=e.scene.locationPath[e.scene.locationPath.length-1],ae.value=!0,setTimeout(()=>{ae.value=!1},2e3),console.log('[NodeMapViewer] 已标记位置:',e.scene.locationPath.join(' → '))}else console.warn('[NodeMapViewer] 当前场景没有 locationPath，无法标记')}catch(e){console.error('[NodeMapViewer] 标记失败:',e)}},showMarkSuccess:ae,lastMarkedPath:se}}}),z_=(0,$u.A)(G_,[['render',function(e,t,a,s,n,r){return e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-80 flex items-center justify-center bg-black/80',onClick:[t[42]||(t[42]=Cl((...t)=>e.closeContextMenu&&e.closeContextMenu(...t),['self'])),t[43]||(t[43]=(...t)=>e.closeContextMenu&&e.closeContextMenu(...t))]},[Mn('div',{class:'relative flex h-[95vh] w-[98vw] max-w-4xl flex-col rounded-lg border border-[#202225] bg-[#2f3136] shadow-2xl md:h-[90vh] md:w-[95vw]',onClick:t[22]||(t[22]=Cl(()=>{},['stop']))},[Rn(' Header - 手机端更紧凑 '),Mn('div',US,[Mn('div',VS,[t[44]||(t[44]=Mn('h2',{class:'text-sm font-bold text-amber-500 md:text-xl'},'🗺️ 节点地图',-1)),Mn('span',FS,oe(e.nodeCount)+' 个地点 · '+oe(e.edgeCount)+' 条路径 ',1)]),Mn('div',HS,[Mn('button',{class:'flex items-center space-x-0.5 rounded bg-amber-700 px-1.5 py-0.5 text-[10px] text-white hover:bg-amber-600 md:space-x-1 md:px-2 md:py-1 md:text-xs',title:'将当前位置添加到地图',onClick:t[0]||(t[0]=(...t)=>e.markCurrentLocation&&e.markCurrentLocation(...t))},[...t[45]||(t[45]=[Mn('span',null,'📌',-1),Mn('span',{class:'hidden md:inline'},'标记',-1)])]),Mn('button',{class:'rounded bg-blue-700 px-1.5 py-0.5 text-[10px] text-white hover:bg-blue-600 md:px-2 md:py-1 md:text-xs',title:'居中到当前位置',onClick:t[1]||(t[1]=(...t)=>e.centerOnCurrent&&e.centerOnCurrent(...t))},' 📍 '),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[2]||(t[2]=t=>e.$emit('close'))},[...t[46]||(t[46]=[Mn('svg',{class:'h-5 w-5 md:h-6 md:w-6',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])])]),Rn(' Current Location Breadcrumb - 手机端更紧凑 '),Mn('div',GS,[t[47]||(t[47]=Mn('span',{class:'text-[10px] text-gray-400 md:text-xs'},'位置:',-1)),e.currentPath.length>0?(yn(),Sn('div',zS,[(yn(!0),Sn(pn,null,xs(e.currentPath,(a,s)=>(yn(),Sn(pn,{key:a},[Mn('span',{class:'cursor-pointer rounded bg-[#40444b] px-1 py-0.5 text-[10px] text-white hover:bg-amber-700 md:px-2 md:text-xs',onClick:t=>e.handleNodeClick(a),onContextmenu:Cl(t=>e.showContextMenu(t,a),['prevent']),onTouchstart:t=>e.handleTouchStart(t,a),onTouchend:t[3]||(t[3]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t)),onTouchmove:t[4]||(t[4]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t))},oe(a),41,WS),s<e.currentPath.length-1?(yn(),Sn('span',QS,'→')):Rn('v-if',!0)],64))),128))])):(yn(),Sn('span',XS,'未知'))]),Rn(' Node Detail Panel - 顶部紧凑区域 '),e.displayedNodeInfo?(yn(),Sn('div',YS,[Mn('div',KS,[Rn(' 节点图标和名称 '),Mn('div',JS,[Mn('span',ZS,oe(e.getNodeIcon(e.displayedNodeInfo.type)),1),Mn('span',{class:ee(['text-[11px] font-bold md:text-sm',e.displayedNodeInfo.id===e.currentNode?'text-amber-400':'text-white'])},oe(e.displayedNodeInfo.name),3),e.displayedNodeInfo.id===e.currentNode?(yn(),Sn('span',e_,'(当前)')):Rn('v-if',!0)]),Rn(' 访问信息 '),Mn('div',t_,[e.displayedNodeInfo.lastVisit?(yn(),Sn('span',a_,oe(e.formatTime(e.displayedNodeInfo.lastVisit)),1)):Rn('v-if',!0)]),Rn(' 快捷操作按钮 '),Mn('div',s_,[e.selectedNode&&e.selectedNode!==e.currentNode?(yn(),Sn('button',{key:0,class:'rounded bg-green-700 px-1.5 py-0.5 text-[9px] text-white hover:bg-green-600 md:px-2 md:text-xs',onClick:t[5]||(t[5]=(...t)=>e.handleTravel&&e.handleTravel(...t))},' 🚶 前往 ')):Rn('v-if',!0),Mn('button',{class:'rounded bg-gray-600 px-1.5 py-0.5 text-[9px] text-white hover:bg-gray-500 md:px-2 md:text-xs',title:'编辑',onClick:t[6]||(t[6]=t=>e.showContextMenu(t,e.displayedNodeInfo.id))},' ⋮ ')])]),Rn(' 描述（如果有） '),e.displayedNodeDesc?(yn(),Sn('div',n_,' "'+oe(e.displayedNodeDesc)+'" ',1)):Rn('v-if',!0),Rn(' 标签 '),e.displayedNodeInfo.tags&&e.displayedNodeInfo.tags.length>0?(yn(),Sn('div',r_,[(yn(!0),Sn(pn,null,xs(e.displayedNodeInfo.tags,e=>(yn(),Sn('span',{key:e,class:'rounded bg-gray-700 px-1 py-0.5 text-[8px] text-gray-300 md:px-1.5 md:text-[10px]'},oe(e),1))),128))])):Rn('v-if',!0)])):Rn('v-if',!0),Rn(' Main Canvas Area '),Mn('div',{ref:'containerRef',class:'relative flex-1 overflow-hidden bg-[#1a1b1e]',onWheel:t[10]||(t[10]=(...t)=>e.handleWheel&&e.handleWheel(...t)),onMousedown:t[11]||(t[11]=(...t)=>e.startPan&&e.startPan(...t)),onMousemove:t[12]||(t[12]=(...t)=>e.onPan&&e.onPan(...t)),onMouseup:t[13]||(t[13]=(...t)=>e.stopPan&&e.stopPan(...t)),onMouseleave:t[14]||(t[14]=(...t)=>e.stopPan&&e.stopPan(...t)),onTouchstart:t[15]||(t[15]=(...t)=>e.startPanTouch&&e.startPanTouch(...t)),onTouchmove:t[16]||(t[16]=(...t)=>e.onPanTouch&&e.onPanTouch(...t)),onTouchend:t[17]||(t[17]=(...t)=>e.stopPanTouch&&e.stopPanTouch(...t))},[Rn(' Empty State '),0===e.nodeCount?(yn(),Sn('div',l_,[...t[48]||(t[48]=[Mn('svg',{class:'mb-4 h-16 w-16 opacity-50',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'1',d:'M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7'})],-1),Mn('p',{class:'mb-2 text-lg'},'尚未标记任何地点',-1),Mn('p',{class:'px-4 text-center text-sm text-gray-600'},'点击上方 📌 按钮标记当前位置到地图',-1)])])):Rn('v-if',!0),Rn(' Mark Success Toast '),e.showMarkSuccess?(yn(),Sn('div',o_,' ✓ 已标记: '+oe(e.lastMarkedPath),1)):(yn(),Sn(pn,{key:2},[Rn(' SVG Canvas '),(yn(),Sn('svg',{ref:'svgRef',class:'h-full w-full',viewBox:e.viewBox,style:X({cursor:e.isPanning?'grabbing':'grab'})},[t[49]||(t[49]=Mn('defs',null,[Rn(' Arrow marker for edges '),Mn('marker',{id:'arrowhead',markerWidth:'10',markerHeight:'7',refX:'9',refY:'3.5',orient:'auto'},[Mn('polygon',{points:'0 0, 10 3.5, 0 7',fill:'#6b7280'})]),Mn('marker',{id:'arrowhead-current',markerWidth:'10',markerHeight:'7',refX:'9',refY:'3.5',orient:'auto'},[Mn('polygon',{points:'0 0, 10 3.5, 0 7',fill:'#f59e0b'})])],-1)),Rn(' Transform group for pan/zoom '),Mn('g',{transform:`translate(${e.panX+e.svgWidth/2}, ${e.panY+50}) scale(${e.scale})`},[Rn(' Edges '),Mn('g',d_,[(yn(!0),Sn(pn,null,xs(e.computedEdges,e=>(yn(),Sn('line',{key:e.id,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stroke:e.isCurrent?'#f59e0b':'#4b5563','stroke-width':e.isCurrent?2:1.5,'stroke-dasharray':'4 2','marker-end':e.isCurrent?'url(#arrowhead-current)':'url(#arrowhead)'},null,8,u_))),128))]),Rn(' Nodes '),Mn('g',p_,[(yn(!0),Sn(pn,null,xs(e.computedNodes,a=>(yn(),Sn('g',{key:a.id,class:'node-group cursor-pointer',transform:`translate(${a.x}, ${a.y})`,onClick:Cl(t=>e.handleNodeClick(a.id),['stop']),onContextmenu:Cl(t=>e.showContextMenu(t,a.id),['prevent']),onTouchstart:t=>e.handleTouchStart(t,a.id),onTouchend:t[7]||(t[7]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t)),onTouchmove:t[8]||(t[8]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t)),onMouseenter:t=>e.hoveredNode=a,onMouseleave:t[9]||(t[9]=t=>e.hoveredNode=null)},[Rn(' Node background circle '),Mn('circle',{r:a.isCurrent?20:16,fill:e.getNodeColor(a),stroke:a.id===e.selectedNode?'#22c55e':a.isCurrent?'#f59e0b':'#4b5563','stroke-width':a.id===e.selectedNode||a.isCurrent?3:1.5,class:'transition-all duration-200'},null,8,g_),Rn(' Node icon - 手机端更小 '),Mn('text',{class:'pointer-events-none select-none','text-anchor':'middle','dominant-baseline':'central','font-size':e.isMobile?a.isCurrent?10:8:a.isCurrent?14:12},oe(e.getNodeIcon(a.type)),9,h_),Rn(' Node label - 手机端更小 '),Mn('text',{class:'pointer-events-none select-none','text-anchor':'middle',y:e.isMobile?a.isCurrent?24:20:a.isCurrent?32:28,fill:'white','font-size':e.isMobile?a.isCurrent?8:7:a.isCurrent?11:10,'font-weight':a.isCurrent?'bold':'normal'},oe(e.truncateName(a.name,e.isMobile?5:8)),9,f_)],40,m_))),128))])],8,c_)],12,i_))],2112)),Rn(' Hover Tooltip - 手机端隐藏（用点击代替） '),e.hoveredNode&&!e.isMobile?(yn(),Sn('div',{key:3,class:'pointer-events-none absolute z-10 max-w-xs rounded-lg border border-gray-600 bg-black/90 p-2 text-xs text-white shadow-xl md:p-3 md:text-sm',style:X({left:e.tooltipX+'px',top:e.tooltipY+'px'})},[Mn('div',v_,[Mn('span',y_,oe(e.getNodeIcon(e.hoveredNode.type)),1),Mn('span',b_,oe(e.hoveredNode.name),1)]),e.hoveredNode.desc?(yn(),Sn('div',x_,' "'+oe(e.hoveredNode.desc)+'" ',1)):Rn('v-if',!0),Mn('div',w_,[e.hoveredNode.lastVisit?(yn(),Sn('div',k_,'最后访问: '+oe(e.formatTime(e.hoveredNode.lastVisit)),1)):Rn('v-if',!0),e.hoveredNode.tags&&e.hoveredNode.tags.length>0?(yn(),Sn('div',S_,[(yn(!0),Sn(pn,null,xs(e.hoveredNode.tags,e=>(yn(),Sn('span',{key:e,class:'rounded bg-gray-700 px-1 py-0.5 text-[8px] md:px-1.5 md:text-[10px]'},oe(e),1))),128))])):Rn('v-if',!0)])],4)):Rn('v-if',!0)],544),Rn(' Footer Actions - 手机端更紧凑 '),Mn('div',__,[Mn('div',C_,[t[50]||(t[50]=Mn('span',{class:'hidden text-xs text-gray-400 sm:inline'},'缩放:',-1)),Mn('button',{class:'rounded bg-gray-700 px-1.5 py-0.5 text-[10px] text-white hover:bg-gray-600 md:px-2 md:py-1 md:text-xs',onClick:t[18]||(t[18]=t=>e.scale=Math.max(.5,e.scale-.1))},' − '),Mn('span',I_,oe(Math.round(100*e.scale))+'%',1),Mn('button',{class:'rounded bg-gray-700 px-1.5 py-0.5 text-[10px] text-white hover:bg-gray-600 md:px-2 md:py-1 md:text-xs',onClick:t[19]||(t[19]=t=>e.scale=Math.min(2.5,e.scale+.1))},' + '),Mn('button',{class:'ml-1 rounded bg-gray-700 px-1.5 py-0.5 text-[10px] text-white hover:bg-gray-600 md:ml-2 md:px-2 md:py-1 md:text-xs',onClick:t[20]||(t[20]=(...t)=>e.resetView&&e.resetView(...t))},' 重置 ')]),Mn('div',T_,[e.selectedNode&&e.selectedNode!==e.currentNode?(yn(),Sn('button',{key:0,class:'rounded bg-green-700 px-2 py-0.5 text-[10px] text-white hover:bg-green-600 md:px-3 md:py-1 md:text-xs',onClick:t[21]||(t[21]=(...t)=>e.handleTravel&&e.handleTravel(...t))},' 🚶 前往 ')):Rn('v-if',!0)])])]),Rn(' Context Menu '),e.contextMenuVisible?(yn(),Sn('div',{key:0,class:'fixed z-100 min-w-[120px] rounded-lg border border-gray-600 bg-[#2f3136] py-1 shadow-xl md:min-w-[140px]',style:X({left:e.contextMenuX+'px',top:e.contextMenuY+'px'}),onClick:t[27]||(t[27]=Cl(()=>{},['stop']))},[Mn('button',{class:'flex w-full items-center gap-2 px-3 py-1.5 text-left text-[11px] text-white hover:bg-gray-700 md:text-xs',onClick:t[23]||(t[23]=(...t)=>e.startEditDesc&&e.startEditDesc(...t))},[...t[51]||(t[51]=[Mn('span',null,'📝',-1),Mn('span',null,'编辑描述',-1)])]),Mn('button',{class:'flex w-full items-center gap-2 px-3 py-1.5 text-left text-[11px] text-white hover:bg-gray-700 md:text-xs',onClick:t[24]||(t[24]=(...t)=>e.startAddTag&&e.startAddTag(...t))},[...t[52]||(t[52]=[Mn('span',null,'🏷️',-1),Mn('span',null,'添加标签',-1)])]),e.contextMenuNodeTags.length>0?(yn(),Sn('button',{key:0,class:'flex w-full items-center gap-2 px-3 py-1.5 text-left text-[11px] text-white hover:bg-gray-700 md:text-xs',onClick:t[25]||(t[25]=(...t)=>e.startRemoveTag&&e.startRemoveTag(...t))},[...t[53]||(t[53]=[Mn('span',null,'🗑️',-1),Mn('span',null,'移除标签',-1)])])):Rn('v-if',!0),t[55]||(t[55]=Mn('div',{class:'my-1 border-t border-gray-600'},null,-1)),Mn('button',{class:ee(['flex w-full items-center gap-2 px-3 py-1.5 text-left text-[11px] hover:bg-gray-700 md:text-xs',e.canDeleteContextNode?'text-red-400':'cursor-not-allowed text-gray-500']),disabled:!e.canDeleteContextNode,onClick:t[26]||(t[26]=(...t)=>e.confirmDeleteNode&&e.confirmDeleteNode(...t))},[t[54]||(t[54]=Mn('span',null,'❌',-1)),Mn('span',null,oe(e.deleteNodeReason||'删除节点'),1)],10,A_)],4)):Rn('v-if',!0),Rn(' Edit Description Modal '),e.editDescModalVisible?(yn(),Sn('div',{key:1,class:'fixed inset-0 z-110 flex items-center justify-center bg-black/60',onClick:t[31]||(t[31]=Cl(t=>e.editDescModalVisible=!1,['self']))},[Mn('div',M_,[Mn('h3',E_,'编辑描述 - '+oe(e.editingNodeId),1),xa(Mn('textarea',{'onUpdate:modelValue':t[28]||(t[28]=t=>e.editDescValue=t),class:'w-full rounded border border-gray-600 bg-[#40444b] p-2 text-xs text-white placeholder-gray-400 focus:border-amber-500 focus:outline-none md:text-sm',rows:'3',placeholder:'输入场景描述...'},null,512),[[fl,e.editDescValue]]),Mn('div',$_,[Mn('button',{class:'rounded bg-gray-600 px-3 py-1 text-xs text-white hover:bg-gray-500 md:text-sm',onClick:t[29]||(t[29]=t=>e.editDescModalVisible=!1)},' 取消 '),Mn('button',{class:'rounded bg-amber-700 px-3 py-1 text-xs text-white hover:bg-amber-600 md:text-sm',onClick:t[30]||(t[30]=(...t)=>e.saveDesc&&e.saveDesc(...t))},' 保存 ')])])])):Rn('v-if',!0),Rn(' Add Tag Modal '),e.addTagModalVisible?(yn(),Sn('div',{key:2,class:'fixed inset-0 z-110 flex items-center justify-center bg-black/60',onClick:t[36]||(t[36]=Cl(t=>e.addTagModalVisible=!1,['self']))},[Mn('div',D_,[Mn('h3',P_,'添加标签 - '+oe(e.editingNodeId),1),xa(Mn('input',{'onUpdate:modelValue':t[32]||(t[32]=t=>e.newTagValue=t),class:'w-full rounded border border-gray-600 bg-[#40444b] p-2 text-xs text-white placeholder-gray-400 focus:border-amber-500 focus:outline-none md:text-sm',placeholder:'输入新标签...',onKeyup:t[33]||(t[33]=Tl((...t)=>e.saveTag&&e.saveTag(...t),['enter']))},null,544),[[fl,e.newTagValue]]),Mn('div',N_,[Mn('button',{class:'rounded bg-gray-600 px-3 py-1 text-xs text-white hover:bg-gray-500 md:text-sm',onClick:t[34]||(t[34]=t=>e.addTagModalVisible=!1)},' 取消 '),Mn('button',{class:'rounded bg-amber-700 px-3 py-1 text-xs text-white hover:bg-amber-600 md:text-sm',onClick:t[35]||(t[35]=(...t)=>e.saveTag&&e.saveTag(...t))},' 添加 ')])])])):Rn('v-if',!0),Rn(' Remove Tag Modal '),e.removeTagModalVisible?(yn(),Sn('div',{key:3,class:'fixed inset-0 z-110 flex items-center justify-center bg-black/60',onClick:t[38]||(t[38]=Cl(t=>e.removeTagModalVisible=!1,['self']))},[Mn('div',R_,[Mn('h3',j_,'移除标签 - '+oe(e.editingNodeId),1),Mn('div',L_,[(yn(!0),Sn(pn,null,xs(e.contextMenuNodeTags,t=>(yn(),Sn('button',{key:t,class:'rounded bg-red-900/50 px-2 py-1 text-xs text-red-300 hover:bg-red-800 md:text-sm',onClick:a=>e.removeTag(t)},' ❌ '+oe(t),9,B_))),128))]),Mn('div',O_,[Mn('button',{class:'rounded bg-gray-600 px-3 py-1 text-xs text-white hover:bg-gray-500 md:text-sm',onClick:t[37]||(t[37]=t=>e.removeTagModalVisible=!1)},' 关闭 ')])])])):Rn('v-if',!0),Rn(' Delete Confirmation Modal '),e.deleteConfirmVisible?(yn(),Sn('div',{key:4,class:'fixed inset-0 z-110 flex items-center justify-center bg-black/60',onClick:t[41]||(t[41]=Cl(t=>e.deleteConfirmVisible=!1,['self']))},[Mn('div',q_,[t[58]||(t[58]=Mn('h3',{class:'mb-3 text-sm font-bold text-red-400 md:text-base'},'⚠️ 确认删除',-1)),Mn('p',U_,[t[56]||(t[56]=Pn(' 确定要删除节点 "',-1)),Mn('span',V_,oe(e.editingNodeId),1),t[57]||(t[57]=Pn('" 吗？ ',-1))]),e.deleteChildCount>0?(yn(),Sn('p',F_,' 该节点有 '+oe(e.deleteChildCount)+' 个子节点，删除后子节点将变为孤立节点。 ',1)):Rn('v-if',!0),t[59]||(t[59]=Mn('p',{class:'text-[10px] text-gray-400 md:text-xs'},'此操作无法撤销。',-1)),Mn('div',H_,[Mn('button',{class:'rounded bg-gray-600 px-3 py-1 text-xs text-white hover:bg-gray-500 md:text-sm',onClick:t[39]||(t[39]=t=>e.deleteConfirmVisible=!1)},' 取消 '),Mn('button',{class:'rounded bg-red-700 px-3 py-1 text-xs text-white hover:bg-red-600 md:text-sm',onClick:t[40]||(t[40]=(...t)=>e.executeDeleteNode&&e.executeDeleteNode(...t))},' 确认删除 ')])])])):Rn('v-if',!0)])):Rn('v-if',!0)}],['__scopeId','data-v-6d45e7d0']]),W_={class:'modal-container relative flex w-full max-w-xs flex-col rounded-lg p-4 sm:max-w-sm sm:p-5'},Q_={class:'modal-header mb-3 pb-3 sm:mb-4 sm:pb-4'},X_={class:'flex items-center justify-between'},Y_={class:'custom-scrollbar modal-body max-h-[60vh] space-y-4 overflow-y-auto pr-1 sm:max-h-[70vh] sm:space-y-5'},K_={class:'attr-section'},J_={key:0,class:'overweight-warning'},Z_={class:'grid grid-cols-2 gap-2 sm:gap-3'},eC={key:0,class:'debuff-indicator'},tC={class:'flex items-center gap-1'},aC=['onClick'],sC=['onClick'],nC={class:'attr-section'},rC={class:'space-y-1.5'},lC={class:'combat-stat-row'},oC={class:'stat-value'},iC={class:'combat-stat-row'},cC={class:'stat-value'},dC={class:'combat-stat-row'},uC={class:'stat-value'},pC={class:'combat-stat-row'},mC={class:'stat-value'},gC={key:0,class:'combat-stat-row debuff-row'},hC={class:'stat-value text-red-400'},fC={class:'points-indicator'},vC={class:'points-value'},yC={key:1,class:'pending-indicator'},bC={key:0,class:'modal-footer mt-3 flex gap-2 pt-3'};const xC={STR:'力量',DEX:'敏捷',CON:'体质',INT:'智力',WIS:'感知',CHA:'魅力'},wC=Za({name:'AttributesModal',props:{visible:{type:Boolean,default:!1},attributes:{type:Object,required:!0},availablePoints:{type:Number,default:0},equipment:{type:Object,default:void 0},statModifiers:{type:Object,default:void 0}},emits:['close','enhance','batch-enhance'],setup(e,{emit:t}){const a=$t({STR:0,DEX:0,CON:0,INT:0,WIS:0,CHA:0}),s=ir(()=>Ro(e.equipment));_a(()=>e.visible,e=>{e&&u()});const n=e=>{const t=e.toLowerCase();return s.value[t]||0},r=t=>{if(!e.statModifiers)return 0;const a=t.toLowerCase();return e.statModifiers[a]||0},l=ir(()=>1===e.statModifiers?._overweight),o=ir(()=>({STR:e.attributes.STR+a.value.STR+n('STR')+r('STR'),DEX:e.attributes.DEX+a.value.DEX+n('DEX')+r('DEX'),CON:e.attributes.CON+a.value.CON+n('CON')+r('CON'),INT:e.attributes.INT+a.value.INT+n('INT')+r('INT'),WIS:e.attributes.WIS+a.value.WIS+n('WIS')+r('WIS'),CHA:e.attributes.CHA+a.value.CHA+n('CHA')+r('CHA')})),i=ir(()=>Object.values(a.value).reduce((e,t)=>e+t,0)),c=ir(()=>e.availablePoints-i.value),d=ir(()=>Object.values(a.value).some(e=>0!==e)),u=()=>{a.value={STR:0,DEX:0,CON:0,INT:0,WIS:0,CHA:0}};return{displayAttributes:o,combatStats:ir(()=>({AC:(e.attributes.AC||10)+(s.value.ac||0)+(e.statModifiers?.ac||0),SPD:(e.attributes.SPD||10)+(s.value.spd||0)+(e.statModifiers?.spd||0),CRIT_RATE:(e.attributes.CRIT_RATE||5)+(s.value.crit_rate||0)+(e.statModifiers?.crit_rate||0),CRIT_DMG:(e.attributes.CRIT_DMG||150)+(s.value.crit_dmg||0)+(e.statModifiers?.crit_dmg||0),DODGE_RATE:e.statModifiers?.dodgeRate||0})),effectiveAvailablePoints:c,hasPendingChanges:d,canDecrease:e=>{const t=e;return a.value[t]>0},increaseAttribute:e=>{const t=e;c.value>0&&a.value[t]++},decreaseAttribute:e=>{const t=e;a.value[t]>0&&a.value[t]--},resetChanges:u,applyChanges:()=>{const e={};for(const[t,s]of Object.entries(a.value))s>0&&(e[t]=s);Object.keys(e).length>0&&t('batch-enhance',e),u(),t('close')},handleClose:()=>{u(),t('close')},attrNameMap:xC,getEquipmentBonus:n,getStatModifier:r,hasDebuff:e=>r(e)<0,isOverweight:l}}}),kC=(0,$u.A)(wC,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'modal-backdrop fixed inset-0 z-[70] flex items-center justify-center p-4',onClick:t[3]||(t[3]=Cl((...t)=>e.handleClose&&e.handleClose(...t),['self']))},[Mn('div',W_,[Rn(' 噪点纹理 '),t[15]||(t[15]=Mn('div',{class:'noise-overlay'},null,-1)),Rn(' 标题区域 '),Mn('div',Q_,[t[5]||(t[5]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',X_,[t[4]||(t[4]=Mn('h2',{class:'header-title text-base font-bold tracking-wider sm:text-lg'},[Mn('span',{class:'title-icon'},'📊'),Pn(' 角色属性 ')],-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=(...t)=>e.handleClose&&e.handleClose(...t))},'✕')])]),Mn('div',Y_,[Rn(' Main Attributes (Six Dimensions) '),Mn('div',K_,[t[7]||(t[7]=Mn('h3',{class:'section-title'},[Mn('span',{class:'section-icon'},'⚔'),Pn(' 基础属性 ')],-1)),Rn(' 超重警告 '),e.isOverweight?(yn(),Sn('div',J_,[...t[6]||(t[6]=[Mn('span',{class:'warning-icon'},'⚠️',-1),Mn('span',{class:'warning-text'},'背包超重！敏捷和闪避率降低 50%',-1)])])):Rn('v-if',!0),Mn('div',Z_,[(yn(!0),Sn(pn,null,xs(e.displayAttributes,(t,a)=>(yn(),Sn('div',{key:a,class:ee(['attr-item',{'has-debuff':e.hasDebuff(a)}])},[Mn('span',{class:ee(['attr-name',{'text-red-400':e.hasDebuff(a)}])},[Pn(oe(e.attrNameMap[a]||a)+' ',1),e.hasDebuff(a)?(yn(),Sn('span',eC,'↓')):Rn('v-if',!0)],2),Mn('div',tC,[Rn(' 减号按钮 '),e.canDecrease(a)?(yn(),Sn('button',{key:0,class:'attr-btn decrease',onClick:t=>e.decreaseAttribute(a)},' - ',8,aC)):Rn('v-if',!0),Mn('span',{class:ee(['attr-value',{'text-red-400':e.hasDebuff(a)}])},oe(t),3),Rn(' 加号按钮 '),e.effectiveAvailablePoints>0?(yn(),Sn('button',{key:1,class:'attr-btn increase',onClick:t=>e.increaseAttribute(a)},' + ',8,sC)):Rn('v-if',!0)])],2))),128))])]),Rn(' Combat Stats '),Mn('div',nC,[t[14]||(t[14]=Mn('h3',{class:'section-title'},[Mn('span',{class:'section-icon'},'🛡️'),Pn(' 战斗属性 ')],-1)),Mn('div',rC,[Mn('div',lC,[t[8]||(t[8]=Mn('span',{class:'stat-label'},'🛡️ 防御等级',-1)),Mn('span',oC,oe(e.combatStats.AC||10),1)]),Mn('div',iC,[t[9]||(t[9]=Mn('span',{class:'stat-label'},'⚡ 速度',-1)),Mn('span',cC,oe(e.combatStats.SPD||10),1)]),Mn('div',dC,[t[10]||(t[10]=Mn('span',{class:'stat-label'},'🎯 暴击率',-1)),Mn('span',uC,oe(e.combatStats.CRIT_RATE||5)+'%',1)]),Mn('div',pC,[t[11]||(t[11]=Mn('span',{class:'stat-label'},'💥 暴击伤害',-1)),Mn('span',mC,oe(e.combatStats.CRIT_DMG||150)+'%',1)]),Rn(' 闪避率惩罚（仅在有惩罚时显示） '),0!==e.combatStats.DODGE_RATE?(yn(),Sn('div',gC,[t[12]||(t[12]=Mn('span',{class:'stat-label text-red-400'},'🕸 闪避率修正',-1)),Mn('span',hC,oe(e.combatStats.DODGE_RATE)+'%',1)])):Rn('v-if',!0),Rn(' Enhancement Points '),Mn('div',fC,[t[13]||(t[13]=Mn('span',{class:'points-label'},'✨ 可分配点数',-1)),Mn('span',vC,oe(e.effectiveAvailablePoints),1)]),Rn(' Pending Changes Indicator '),e.hasPendingChanges?(yn(),Sn('div',yC,'有未保存的修改')):Rn('v-if',!0)])])]),Rn(' Action Buttons '),e.hasPendingChanges?(yn(),Sn('div',bC,[Mn('button',{class:'action-btn secondary flex-1',onClick:t[1]||(t[1]=(...t)=>e.resetChanges&&e.resetChanges(...t))},'重置'),Mn('button',{class:'action-btn primary flex-1',onClick:t[2]||(t[2]=(...t)=>e.applyChanges&&e.applyChanges(...t))},'确认')])):Rn('v-if',!0),Rn(' 底部装饰线 '),t[16]||(t[16]=Mn('div',{class:'footer-deco-line mt-3'},[Mn('span',{class:'deco-diamond'},'◇')],-1))])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-a45dd3f8']]),SC={class:'equipment-modal-container relative flex h-[50vh] w-full max-w-md flex-col rounded-lg sm:h-auto sm:max-h-[80vh]'},_C={class:'modal-header relative z-10 px-3 py-2 sm:px-4 sm:py-3'},CC={class:'flex items-center justify-between'},IC={class:'relative z-10 flex-1 overflow-y-auto p-3 sm:p-4'};const TC={class:'equipment-grid'},AC=['title','onClick','onContextmenu','onTouchstart'],MC={key:1,class:'emoji'},EC={key:1,class:'empty-text'},$C={class:'context-menu-header'},DC={class:'context-menu-title'},PC={class:'context-menu-items'};const NC=Za({name:'EquipmentPanel',props:{equipment:{type:Object,default:()=>({})}},emits:['unequip-item','unequip-all','show-item-detail'],setup(e,{emit:t}){const a=()=>{try{return Ll.serviceLocator.get('IconService')}catch{return null}},s=t=>e.equipment?.[t],n=xt({visible:!1,x:0,y:0,slotKey:'',itemName:'',item:null}),r=$t(null),l=$t(!1),o=ir(()=>{let e=n.x,t=n.y;return e+160>window.innerWidth&&(e=window.innerWidth-160-10),t+150>window.innerHeight&&(t=window.innerHeight-150-10),{left:`${e}px`,top:`${t}px`}}),i=()=>{n.visible=!1},c=e=>{n.visible&&i()};us(()=>{document.addEventListener('click',c)}),gs(()=>{document.removeEventListener('click',c),r.value&&clearTimeout(r.value)});return{equipmentSlots:{weapon_main:'主手',weapon_off:'副手',head:'头部',outer:'外套',upper:'上装',underwear:'内衣',lower:'下装',underpants:'内裤',socks:'袜子',shoes:'鞋子',hands:'手部',accessory_1:'饰品 1',accessory_2:'饰品 2',accessory_3:'饰品 3'},getEquippedItem:s,handleSlotClick:e=>{l.value?l.value=!1:n.visible?i():s(e)&&t('unequip-item',e)},hasIconData:e=>{if(!e)return!1;return!!a()&&!(!e.subtype&&!['weapon','armor','accessory','material','consumable'].includes(e.type))},getIconStyle:(e,t=20)=>{if(!e)return{};const s=a();if(!s)return{};let n,r=e.subtype;if(e.subtype){const t=s.mapTypeToCategoryAndSubtype(e.subtype);n=t.category,r=t.subtype||e.subtype}else'consumable'===e.type?(n='material',r='potion'):n=['weapon','armor','accessory','material','item'].includes(e.type)?e.type:'item';return'material'!==n&&'item'!==n||void 0!==e.iconVariant||s.ensureIconVariant(e),s.getIconStyle(n,r,e.attribute,e.iconVariant,t)},getQualityClass:e=>Gx(e),getQualityName:e=>Fx(e).name,contextMenu:n,contextMenuStyle:o,handleContextMenu:(e,t)=>{const a=s(t);a&&(e.preventDefault(),e.stopPropagation(),n.visible=!0,n.x=e.clientX,n.y=e.clientY,n.slotKey=t,n.itemName=a.name||'未知物品',n.item=a)},handleTouchStart:(e,t)=>{const a=s(t);a&&(l.value=!1,r.value=setTimeout(()=>{l.value=!0;const s=e.touches[0];n.visible=!0,n.x=s.clientX,n.y=s.clientY,n.slotKey=t,n.itemName=a.name||'未知物品',n.item=a,e.preventDefault()},500))},handleTouchEnd:()=>{r.value&&(clearTimeout(r.value),r.value=null)},handleTouchMove:()=>{r.value&&(clearTimeout(r.value),r.value=null)},hideContextMenu:i,handleViewDetail:()=>{n.item&&n.slotKey&&t('show-item-detail',{item:n.item,slot:n.slotKey}),i()},handleUnequipSingle:()=>{n.slotKey&&t('unequip-item',n.slotKey),i()},handleUnequipAll:()=>{t('unequip-all'),i()}}}}),RC=Za({name:'EquipmentModal',components:{EquipmentPanel:(0,$u.A)(NC,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',{class:'equipment-panel',onClick:t[6]||(t[6]=(...t)=>e.hideContextMenu&&e.hideContextMenu(...t))},[t[11]||(t[11]=Mn('h3',{class:'mb-1.5 text-[10px] font-bold text-gray-400 uppercase sm:mb-2 sm:text-sm'},'当前装备',-1)),Mn('div',TC,[(yn(!0),Sn(pn,null,xs(e.equipmentSlots,(a,s)=>(yn(),Sn('div',{key:s,class:ee(['equipment-slot',[e.getEquippedItem(s)?e.getQualityClass(e.getEquippedItem(s).quality):'',{'has-item':e.getEquippedItem(s),clickable:e.getEquippedItem(s)}]]),title:e.getEquippedItem(s)?`${e.getEquippedItem(s).name} (${e.getQualityName(e.getEquippedItem(s).quality)}) - 右键查看更多`:`${a}：空`,onClick:t=>e.handleSlotClick(s),onContextmenu:Cl(t=>e.handleContextMenu(t,s),['prevent']),onTouchstart:t=>e.handleTouchStart(t,s),onTouchend:t[0]||(t[0]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t)),onTouchmove:t[1]||(t[1]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t))},[e.getEquippedItem(s)?(yn(),Sn(pn,{key:0},[Rn(' Sprite Sheet Icon or Emoji fallback '),e.hasIconData(e.getEquippedItem(s))?(yn(),Sn('span',{key:0,class:'item-sprite',style:X(e.getIconStyle(e.getEquippedItem(s),18))},null,4)):(yn(),Sn('span',MC,oe(e.getEquippedItem(s).emoji||'🛡️'),1)),Mn('span',{class:ee(['item-name',e.getQualityClass(e.getEquippedItem(s).quality)])},oe(e.getEquippedItem(s).name),3)],64)):(yn(),Sn('span',EC,'('+oe(a)+'：空)',1))],42,AC))),128))]),Rn(' Context Menu '),(yn(),_n(Ra,{to:'body'},[En(wr,{name:'context-menu'},{default:ba(()=>[e.contextMenu.visible?(yn(),Sn('div',{key:0,class:'context-menu',style:X(e.contextMenuStyle),onClick:t[5]||(t[5]=Cl(()=>{},['stop']))},[Mn('div',$C,[Mn('span',DC,oe(e.contextMenu.itemName),1)]),Mn('div',PC,[Mn('button',{class:'context-menu-item',onClick:t[2]||(t[2]=(...t)=>e.handleViewDetail&&e.handleViewDetail(...t))},[...t[7]||(t[7]=[Mn('span',{class:'menu-icon'},'📋',-1),Mn('span',null,'查看详情',-1)])]),Mn('button',{class:'context-menu-item',onClick:t[3]||(t[3]=(...t)=>e.handleUnequipSingle&&e.handleUnequipSingle(...t))},[...t[8]||(t[8]=[Mn('span',{class:'menu-icon'},'🔓',-1),Mn('span',null,'卸下装备',-1)])]),t[10]||(t[10]=Mn('div',{class:'context-menu-divider'},null,-1)),Mn('button',{class:'context-menu-item unequip-all',onClick:t[4]||(t[4]=(...t)=>e.handleUnequipAll&&e.handleUnequipAll(...t))},[...t[9]||(t[9]=[Mn('span',{class:'menu-icon'},'⚡',-1),Mn('span',null,'卸下全部',-1)])])])],4)):Rn('v-if',!0)]),_:1})]))])}],['__scopeId','data-v-51ec3a13']])},props:{visible:{type:Boolean,required:!0},equipment:{type:Object,default:null}},emits:['close','unequip-item','unequip-all','show-item-detail'],setup:(_,{emit:e})=>({handleUnequipItem:t=>{e('unequip-item',t)},handleUnequipAll:()=>{e('unequip-all')},handleShowItemDetail:t=>{e('show-item-detail',t)}})}),jC=(0,$u.A)(RC,[['render',function(e,t,a,s,n,r){const l=fs('EquipmentPanel');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'equipment-modal-backdrop fixed inset-0 z-60 flex items-center justify-center p-4',onClick:t[1]||(t[1]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',SC,[Rn(' 噪点纹理 '),t[4]||(t[4]=Mn('div',{class:'noise-overlay'},null,-1)),Rn(' Header '),Mn('div',_C,[t[3]||(t[3]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',CC,[t[2]||(t[2]=Mn('h2',{class:'header-title text-sm font-bold tracking-wider sm:text-lg'},[Mn('span',{class:'title-icon'},'🛡️'),Pn(' 装备 ')],-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')])]),Rn(' Content '),Mn('div',IC,[En(l,{equipment:e.equipment??{},onUnequipItem:e.handleUnequipItem,onUnequipAll:e.handleUnequipAll,onShowItemDetail:e.handleShowItemDetail},null,8,['equipment','onUnequipItem','onUnequipAll','onShowItemDetail'])]),Rn(' Footer Decoration '),t[5]||(t[5]=Mn('div',{class:'footer-deco-line relative z-10 px-4 pb-3'},[Mn('span',{class:'deco-diamond'},'◇')],-1))])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-3805d5d3']]),LC={class:'inventory-modal-container relative flex h-[65vh] w-full max-w-4xl flex-col rounded-lg sm:h-[70vh]'},BC={class:'modal-header relative z-10 px-3 py-2 sm:px-4 sm:py-3'},OC={class:'flex items-center justify-between'},qC={class:'relative z-10 flex-1 overflow-y-auto p-3 sm:p-4'};const UC={class:'inventory-panel flex h-full flex-col'},VC={class:'rounded-lg border border-red-500/50 bg-red-900/90 px-4 py-2 text-center text-xs font-medium text-white shadow-lg backdrop-blur-sm sm:text-sm'},FC={key:0,class:'detail-section mb-1.5 flex shrink-0 flex-col gap-1.5 overflow-y-auto rounded-lg border border-[#202225] bg-[#2f3136] p-2 shadow-sm sm:mb-3 sm:gap-2 sm:overflow-visible sm:p-3'},HC={class:'flex items-center gap-2'},GC={class:'shrink-0'},zC={class:'flex min-w-0 flex-1 flex-col'},WC={class:'mt-0.5 flex items-center gap-1.5'},QC={class:'text-[9px] text-gray-400 sm:text-[10px]'},XC={class:'action-row flex flex-wrap items-center gap-1.5'},YC=['disabled','title'],KC={key:0,class:'desc-row text-[10px] text-gray-300 sm:text-xs'},JC={class:'line-clamp-2 sm:line-clamp-3'},ZC={key:1,class:'effect-row'},eI={key:1,class:'flex h-16 w-full items-center justify-center text-xs text-gray-500 italic sm:h-20 sm:text-sm'},tI={key:1,class:'mb-1.5 flex items-center justify-between px-1 sm:mb-2'},aI={class:'flex flex-wrap items-center gap-x-1 text-[10px] font-bold text-gray-300 sm:text-xs',title:'1金 = 100银 = 10000铜'},sI={class:'text-yellow-400'},nI={class:'text-gray-400'},rI={class:'text-yellow-500'},lI={class:'text-gray-300'},oI={class:'text-orange-400'},iI={class:'flex shrink-0 items-center gap-1.5'},cI={key:0,class:'overweight-badge flex shrink-0 items-center gap-0.5 rounded px-1.5 py-0.5 text-[9px] font-bold whitespace-nowrap text-red-400 sm:text-[10px]',title:'超重！敏捷和闪避率降低50%'},dI={class:'item-grid min-h-0 flex-1 content-start overflow-y-auto'},uI=['title','onClick'],pI={key:1,class:'item-emoji'},mI={key:2,class:'item-quantity'};const gI=['title'],hI={class:'tag-icon'},fI={key:0,class:'tag-text'},vI=['title'],yI={class:'tag-text'};const bI=Za({name:'EffectTags',props:{effects:{type:Array,default:()=>[]},item:{type:Object,default:null},skill:{type:Object,default:null},maxTags:{type:Number,default:4},compact:{type:Boolean,default:!1},singleLine:{type:Boolean,default:!1},iconOnly:{type:Boolean,default:!1}},setup(e){const t=ir(()=>{const t=[];if(e.skill){const a=Io.getSkillEffectTags(e.skill);for(const e of a)t.push({icon:e.icon,text:e.text,type:l(e.icon)});return t}if(e.item){const a=Io.getItemEffectTags(e.item);for(const e of a)t.push({icon:e.icon,text:e.text,type:l(e.icon)});return t}if(e.effects&&e.effects.length>0)for(const a of e.effects){const e=Io.translateEffect(a);e.icons.length>0&&e.short&&t.push({icon:e.icons[0],text:e.short.replace(e.icons[0],'').trim(),fullText:e.text,type:l(e.icons[0])})}return t}),a=ir(()=>t.value.slice(0,e.maxTags)),s=ir(()=>t.value.length>e.maxTags),n=ir(()=>t.value.length-e.maxTags),r=ir(()=>t.value.slice(e.maxTags).map(e=>`${e.icon} ${e.text}`).join('\n')),l=e=>['⚔️','🗡️','🔱','🔨','🔥','❄️','⚡','🧪','🌑','💀','🧠','💫','🔮','🌿','💎'].includes(e)?'damage':['💚','💖','💝'].includes(e)?'heal':['⬆️','✨'].includes(e)?'buff':['⬇️','😱','💫','🔇','👁️','🐌','🌳','💕','😤','🩸'].includes(e)?'debuff':['🛡️'].includes(e)?'shield':['💎','⏱️'].includes(e)?'cost':'special';return{displayTags:a,hasMore:s,remainingCount:n,moreTooltip:r,getTagClass:e=>`tag-${e.type||'special'}`}}}),xI=(0,$u.A)(bI,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',{class:ee(['effect-tags',{compact:e.compact,'single-line':e.singleLine}])},[(yn(!0),Sn(pn,null,xs(e.displayTags,(t,a)=>(yn(),Sn('div',{key:a,class:ee(['effect-tag',e.getTagClass(t)]),title:t.fullText||t.text},[Mn('span',hI,oe(t.icon),1),e.iconOnly?Rn('v-if',!0):(yn(),Sn('span',fI,oe(t.text),1))],10,gI))),128)),e.hasMore?(yn(),Sn('div',{key:0,class:'effect-tag more-tag',title:e.moreTooltip},[Mn('span',yI,'+'+oe(e.remainingCount),1)],8,vI)):Rn('v-if',!0)],2)}],['__scopeId','data-v-0bc3401a']]),wI={class:'item-use-modal mx-4 w-full max-w-xs rounded-xl border border-gray-600 bg-[#2f3136] shadow-2xl'},kI={class:'flex items-center justify-between rounded-t-xl border-b border-gray-700 bg-[#202225] px-3 py-2 sm:px-4 sm:py-3'},SI={class:'flex items-center gap-2'},_I={class:'text-base'},CI={class:'text-sm font-bold text-white sm:text-base'},II={class:'p-3 sm:p-4'},TI={class:'mb-4'},AI={key:0,class:'mb-4'},MI={class:'flex items-center justify-center gap-3'},EI=['disabled'],$I={class:'w-16 text-center'},DI={class:'text-xl font-bold text-white'},PI=['disabled'],NI={class:'mt-1 text-center text-[10px] text-gray-500'},RI={key:1,class:'mb-4 rounded-lg bg-[#202225] p-2'},jI={class:'text-xs text-green-400'},LI={class:'flex gap-2 rounded-b-xl border-t border-gray-700 bg-[#202225]/50 px-3 py-2 sm:px-4 sm:py-3'},BI=['disabled'];const OI={class:'team-status-bar'},qI=['onClick'],UI={class:'member-info'},VI={class:'member-name-row'},FI={class:'member-name'},HI={key:0,class:'player-tag'},GI={key:0,class:'stat-bar-mini hp'},zI={class:'stat-bar-text'},WI={key:0,class:'preview-delta'},QI={key:1,class:'stat-bar-mini mp'},XI={class:'stat-bar-text'},YI={key:0,class:'preview-delta'},KI={key:2,class:'stat-bar-mini sp'},JI={class:'stat-bar-text'},ZI={key:0,class:'preview-delta'},eT={key:0,class:'warning-icon',title:'血量过低'},tT={key:0,class:'no-members'};const aT=Za({name:'TeamStatusBar',components:{AvatarDisplay:Vh},props:{player:{type:Object,required:!0},allies:{type:Array,default:()=>[]},selectable:{type:Boolean,default:!1},selectedId:{type:String,default:null},showHp:{type:Boolean,default:!0},showMp:{type:Boolean,default:!1},showSp:{type:Boolean,default:!1},previewEffect:{type:Object,default:null}},emits:['select'],setup:e=>({allMembers:ir(()=>{const t=[];if(e.player&&t.push({id:'player',name:e.player.name||'主角',avatar:e.player.avatar,isPlayer:!0,stats:e.player.stats}),e.allies&&e.allies.length>0)for(const a of e.allies)t.push({id:a.id,name:a.name,avatar:a.avatar,isPlayer:!1,stats:a.stats});return t}),getHpPercent:e=>e.stats?.hp?.max?Math.min(100,e.stats.hp.current/e.stats.hp.max*100):0,getMpPercent:e=>e.stats?.mp?.max?Math.min(100,e.stats.mp.current/e.stats.mp.max*100):0,getSpPercent:e=>e.stats?.sp?.max?Math.min(100,e.stats.sp.current/e.stats.sp.max*100):0,isLowHp:e=>!!e.stats?.hp?.max&&e.stats.hp.current/e.stats.hp.max<=.25,getPreviewDelta:(t,a)=>{if(!e.previewEffect||e.previewEffect.type!==a)return'';const s=t.stats[a].current,n=t.stats[a].max,r=e.previewEffect.value,l=Math.min(n,Math.max(0,s+r))-s;return 0===l?'':l>0?`(+${l})`:`(${l})`}})}),sT=Za({name:'ItemUseModal',components:{TeamStatusBar:(0,$u.A)(aT,[['render',function(e,t,a,s,n,r){const l=fs('AvatarDisplay');return yn(),Sn('div',OI,[Rn(' 当没有队友时只显示主角状态 '),(yn(!0),Sn(pn,null,xs(e.allMembers,t=>(yn(),Sn('div',{key:t.id,class:ee(['member-status',{selected:e.selectedId===t.id,clickable:e.selectable}]),onClick:a=>e.selectable&&e.$emit('select',t.id)},[Rn(' 头像/图标 '),En(l,{avatar:t.avatar,name:t.name,size:'sm',class:'flex-shrink-0'},null,8,['avatar','name']),Rn(' 名字和状态条 '),Mn('div',UI,[Mn('div',VI,[Mn('span',FI,oe(t.name),1),t.isPlayer?(yn(),Sn('span',HI,'主角')):Rn('v-if',!0)]),Rn(' HP 条（根据 showHp 显示） '),e.showHp?(yn(),Sn('div',GI,[Mn('div',{class:'stat-bar-fill',style:X({width:e.getHpPercent(t)+'%'})},null,4),Mn('span',zI,[Pn(oe(t.stats.hp.current)+'/'+oe(t.stats.hp.max)+' ',1),e.previewEffect&&e.selectedId===t.id?(yn(),Sn('span',WI,oe(e.getPreviewDelta(t,'hp')),1)):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' MP 条（根据 showMp 显示） '),e.showMp?(yn(),Sn('div',QI,[Mn('div',{class:'stat-bar-fill',style:X({width:e.getMpPercent(t)+'%'})},null,4),Mn('span',XI,[Pn(oe(t.stats.mp.current)+'/'+oe(t.stats.mp.max)+' ',1),e.previewEffect&&e.selectedId===t.id?(yn(),Sn('span',YI,oe(e.getPreviewDelta(t,'mp')),1)):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' SP 条（根据 showSp 显示） '),e.showSp?(yn(),Sn('div',KI,[Mn('div',{class:'stat-bar-fill',style:X({width:e.getSpPercent(t)+'%'})},null,4),Mn('span',JI,[Pn(oe(t.stats.sp.current)+'/'+oe(t.stats.sp.max)+' ',1),e.previewEffect&&e.selectedId===t.id?(yn(),Sn('span',ZI,oe(e.getPreviewDelta(t,'sp')),1)):Rn('v-if',!0)])])):Rn('v-if',!0)]),Rn(' 低血量警告 '),e.isLowHp(t)?(yn(),Sn('div',eT,'⚠️')):Rn('v-if',!0)],10,qI))),128)),Rn(' 无队友提示 '),0===e.allMembers.length?(yn(),Sn('div',tT,'暂无队伍成员')):Rn('v-if',!0)])}],['__scopeId','data-v-454e33b2']])},props:{visible:{type:Boolean,default:!1},item:{type:Object,default:null},player:{type:Object,required:!0},allies:{type:Array,default:()=>[]}},emits:['cancel','confirm'],setup(e,{emit:t}){const a=$t('player'),s=$t(1);_a(()=>e.visible,e=>{e&&(a.value='player',s.value=1)});const n=ir(()=>e.item&&e.item.count||1),r=ir(()=>{if(!e.item?.effects)return null;for(const t of e.item.effects){const e=t.tags||[];if(e.includes('mp')||e.includes('mana'))return'mp';if(e.includes('sp')||e.includes('stamina'))return'sp';if(e.includes('hp'))return'hp';if('heal'===t.action)return'hp'}return'hp'}),l=ir(()=>{if(!e.item?.effects)return 0;for(const t of e.item.effects){const e=t.tags||[];if('heal'===t.action||'buff'===t.action||e.includes('hp')||e.includes('mp')||e.includes('sp')){const e=t.value;if('number'==typeof e)return e*s.value;if('string'==typeof e){const t=parseInt(e,10);if(!isNaN(t))return t*s.value}}}return 0}),o=ir(()=>'hp'===r.value),i=ir(()=>'mp'===r.value),c=ir(()=>'sp'===r.value),d=ir(()=>r.value&&0!==l.value?{type:r.value,value:l.value}:null),u=ir(()=>{if(!e.item?.effects||0===e.item.effects.length)return e.item?.desc||null;const t=e.item.effects[0],a=l.value,s=t.tags||[];return s.includes('mp')||s.includes('mana')?`恢复 ${a} 点魔法值`:s.includes('sp')||s.includes('stamina')?`恢复 ${a} 点体力值`:s.includes('hp')||'heal'===t.action?`恢复 ${a} 点生命值`:'buff'===t.action?'获得增益效果':e.item.desc||null}),p=ir(()=>a.value&&s.value>0);return{selectedTargetId:a,quantity:s,maxQuantity:n,handleTargetSelect:e=>{a.value=e},increaseQuantity:()=>{s.value<n.value&&s.value++},decreaseQuantity:()=>{s.value>1&&s.value--},showHp:o,showMp:i,showSp:c,previewEffect:d,effectDescription:u,canConfirm:p,handleConfirm:()=>{p.value&&t('confirm',{targetId:a.value,quantity:s.value})}}}}),nT=Za({name:'InventoryPanel',components:{EffectTags:xI,ItemDetailModal:Qx,ItemUseModal:(0,$u.A)(sT,[['render',function(e,t,a,s,n,r){const l=fs('TeamStatusBar');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-[80] flex items-center justify-center bg-black/70 backdrop-blur-sm',onClick:t[5]||(t[5]=Cl(t=>e.$emit('cancel'),['self']))},[Mn('div',wI,[Rn(' Header '),Mn('div',kI,[Mn('div',SI,[Mn('span',_I,oe(e.item?.emoji||'📦'),1),Mn('h3',CI,'使用 '+oe(e.item?.name),1)]),Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full text-xs text-gray-400 transition-colors hover:bg-gray-700 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('cancel'))},' ✕ ')]),Rn(' Content '),Mn('div',II,[Rn(' Target Selection '),Mn('div',TI,[t[6]||(t[6]=Mn('div',{class:'mb-2 text-xs font-bold text-gray-500'},'选择目标',-1)),En(l,{player:e.player,allies:e.allies,selectable:!0,'selected-id':e.selectedTargetId,'show-hp':e.showHp,'show-mp':e.showMp,'show-sp':e.showSp,'preview-effect':e.previewEffect||void 0,onSelect:e.handleTargetSelect},null,8,['player','allies','selected-id','show-hp','show-mp','show-sp','preview-effect','onSelect'])]),Rn(' Quantity Selection (only if count > 1) '),e.item&&e.item.count>1?(yn(),Sn('div',AI,[t[9]||(t[9]=Mn('div',{class:'mb-2 text-xs font-bold text-gray-500'},'使用数量',-1)),Mn('div',MI,[Mn('button',{class:'flex h-8 w-8 items-center justify-center rounded-lg bg-[#40444b] text-white transition-colors hover:bg-[#5865f2] disabled:opacity-50',disabled:e.quantity<=1,onClick:t[1]||(t[1]=(...t)=>e.decreaseQuantity&&e.decreaseQuantity(...t))},[...t[7]||(t[7]=[Mn('span',{class:'text-lg font-bold'},'−',-1)])],8,EI),Mn('div',$I,[Mn('span',DI,oe(e.quantity),1)]),Mn('button',{class:'flex h-8 w-8 items-center justify-center rounded-lg bg-[#40444b] text-white transition-colors hover:bg-[#5865f2] disabled:opacity-50',disabled:e.quantity>=e.maxQuantity,onClick:t[2]||(t[2]=(...t)=>e.increaseQuantity&&e.increaseQuantity(...t))},[...t[8]||(t[8]=[Mn('span',{class:'text-lg font-bold'},'+',-1)])],8,PI)]),Mn('div',NI,'剩余: '+oe(e.item.count)+' 个',1)])):Rn('v-if',!0),Rn(' Effect Preview '),e.effectDescription?(yn(),Sn('div',RI,[t[10]||(t[10]=Mn('div',{class:'mb-1 text-[10px] font-bold text-gray-500'},'预计效果',-1)),Mn('div',jI,oe(e.effectDescription),1)])):Rn('v-if',!0)]),Rn(' Footer '),Mn('div',LI,[Mn('button',{class:'flex-1 rounded-lg bg-gray-700 py-2 text-xs font-bold text-gray-300 transition-colors hover:bg-gray-600',onClick:t[3]||(t[3]=t=>e.$emit('cancel'))},' 取消 '),Mn('button',{class:'flex-1 rounded-lg bg-[#3ba55c] py-2 text-xs font-bold text-white transition-colors hover:bg-[#2d7d46] disabled:cursor-not-allowed disabled:opacity-50',disabled:!e.canConfirm,onClick:t[4]||(t[4]=(...t)=>e.handleConfirm&&e.handleConfirm(...t))},' 确认使用 ',8,BI)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-ed1a6954']])},props:{inventory:{type:Object,default:()=>({items:[]})},compact:{type:Boolean,default:!1},isInCombat:{type:Boolean,default:!1},player:{type:Object,default:null},allies:{type:Array,default:()=>[]}},emits:['use-item','equip-item','discard-item'],setup(e,{emit:t}){const a=$t(null),s=$t(-1),n=$t(!1),r=$t(!1),l=$t(!1),o=$t(null),i=$t(null);let c=null;const d=()=>{n.value=window.innerWidth<640},u=()=>{try{return Ll.serviceLocator.get('EventBus')}catch{return null}},p=e=>{((e,t=2500)=>{c&&clearTimeout(c),i.value=e,c=setTimeout(()=>{i.value=null,c=null},t)})(`等级不足！「${e.itemName}」需要 ${e.requiredLevel} 级，当前 ${e.currentLevel} 级`)};us(()=>{d(),window.addEventListener('resize',d);const e=u();e&&e.on('equipment:level_insufficient',p)}),gs(()=>{window.removeEventListener('resize',d),c&&clearTimeout(c);const e=u();e&&e.off('equipment:level_insufficient',p)});const m=()=>{try{return Ll.serviceLocator.get('IconService')}catch{return null}},g=()=>{try{return Ll.serviceLocator.get('InventoryService')}catch{return null}},h=ir(()=>e.inventory?.items?Do(e.inventory.items):[]),f=ir(()=>{const e=g(),t=h.value.length,a=e?.getMaxCapacity()??8,s=e?.isOverweight()??!1,n=t/a;let r='text-gray-400';return s?r='text-red-500':n>=1?r='text-red-400':n>=.8&&(r='text-yellow-400'),{used:t,max:a,colorClass:r,isOverweight:s}}),v=ir(()=>{const t=e.inventory?.wallet?.ledger||0;return{total:t,gold:Math.floor(t/1e4),silver:Math.floor(t%1e4/100),copper:t%100}}),y=ir(()=>a.value?h.value.find(e=>e.id===a.value):null),b={weapon:'武器',consumable:'消耗品',material:'材料',key:'关键物品',armor:'防具',accessory:'饰品',misc:'杂物',quest:'任务物品'};_a(h,t=>{if(a.value&&!t.find(e=>e.id===a.value))if(t.length>0&&s.value>=0)if(s.value<t.length)a.value=t[s.value].id;else{const e=t.length-1;a.value=t[e].id,s.value=e}else a.value=null,s.value=-1;!a.value&&t.length>0&&!e.compact&&(a.value=t[0].id,s.value=0)},{immediate:!0,deep:!0});const x=e=>{o.value=e,l.value=!0};return{inventoryItems:h,selectedItem:y,selectItem:e=>{a.value=e.id,s.value=h.value.findIndex(t=>t.id===e.id)},getTypeName:e=>b[e]||e||'物品',canUse:e=>'consumable'===e.type,canEquip:e=>['weapon','armor','accessory'].some(t=>e.type?.includes(t)),hasEffects:e=>e.effects&&e.effects.length>0,currency:v,capacityStatus:f,hasIconData:e=>!!m()&&!(!e.subtype&&!['weapon','armor','accessory','material','consumable'].includes(e.type)),getIconStyle:(e,t=32)=>{const a=m();if(!a)return{};let s,n=e.subtype;if(e.subtype){const t=a.mapTypeToCategoryAndSubtype(e.subtype);s=t.category,n=t.subtype||e.subtype}else'consumable'===e.type?(s='material',n='potion'):s=['weapon','armor','accessory','material','item'].includes(e.type)?e.type:'item';if(('material'===s||'item'===s)&&void 0===e.iconVariant&&e.id){const t=g();if(t){const a=t.fixIconVariant(e.id);void 0!==a&&(e.iconVariant=a)}}return a.getIconStyle(s,n,e.attribute,e.iconVariant,t)},getQualityClass:e=>Gx(e),getQualityBorderClass:e=>`quality-border-${(e??'common').toLowerCase()}`,getQualityName:e=>Fx(e).name,getQualityStars:e=>Hx(e),isMobile:n,showDetailModal:r,showItemUseModal:l,itemToUse:o,toastMessage:i,openItemUseModal:x,handleItemUseConfirm:e=>{l.value=!1,o.value&&t('use-item',o.value,e.targetId,e.quantity)},handleUseFromModal:a=>{r.value=!1,'consumable'===a.type?x(a):t('use-item',a,e.player?.id||'player',1)},handleEquipFromModal:e=>{r.value=!1,t('equip-item',e)},handleDiscardFromModal:e=>{r.value=!1,t('discard-item',e)}}}}),rT=Za({name:'InventoryModal',components:{InventoryPanel:(0,$u.A)(nT,[['render',function(e,t,a,s,n,r){const l=fs('EffectTags'),o=fs('ItemDetailModal'),i=fs('ItemUseModal');return yn(),Sn('div',UC,[Rn(' Toast 提示 (避免手机安全区) '),En(wr,{name:'toast-fade'},{default:ba(()=>[e.toastMessage?(yn(),Sn('div',{key:0,class:ee(['toast-container fixed left-1/2 z-200 -translate-x-1/2 px-4',e.isMobile?'bottom-[calc(env(safe-area-inset-bottom)+70px)]':'bottom-20'])},[Mn('div',VC,oe(e.toastMessage),1)],2)):Rn('v-if',!0)]),_:1}),Rn(' Item Details Section (Fixed height on mobile to prevent layout shift) '),e.compact?Rn('v-if',!0):(yn(),Sn('div',FC,[e.selectedItem?(yn(),Sn(pn,{key:0},[Rn(' Row 1: Icon + Name + Quality '),Mn('div',HC,[Rn(' Icon '),Mn('div',GC,[e.hasIconData(e.selectedItem)?(yn(),Sn('div',{key:0,class:ee(['item-sprite-icon h-10 w-10 rounded sm:h-12 sm:w-12',e.getQualityBorderClass(e.selectedItem.quality)]),style:X(e.getIconStyle(e.selectedItem,40))},null,6)):(yn(),Sn('div',{key:1,class:ee(['flex h-10 w-10 items-center justify-center rounded bg-[#36393f] text-xl sm:h-12 sm:w-12 sm:text-2xl',e.getQualityBorderClass(e.selectedItem.quality)])},oe(e.selectedItem.emoji||'📦'),3))]),Rn(' Name + Quality + Type '),Mn('div',zC,[Mn('h3',{class:ee(['truncate text-sm font-bold sm:text-base',e.getQualityClass(e.selectedItem.quality)])},oe(e.selectedItem.name),3),Mn('div',WC,[Mn('span',{class:ee(['quality-badge shrink-0',e.getQualityClass(e.selectedItem.quality)])},oe(e.getQualityName(e.selectedItem.quality)),3),e.getQualityStars(e.selectedItem.quality)?(yn(),Sn('span',{key:0,class:ee(['quality-stars shrink-0 text-[9px] leading-none sm:text-[10px]',e.getQualityClass(e.selectedItem.quality)])},oe(e.getQualityStars(e.selectedItem.quality)),3)):Rn('v-if',!0),Mn('span',QC,oe(e.getTypeName(e.selectedItem.type)),1)])])]),Rn(' Row 2: Actions '),Mn('div',XC,[e.canUse(e.selectedItem)?(yn(),Sn('button',{key:0,class:'rounded bg-[#3ba55c] px-3 py-1 text-[10px] font-bold text-white transition-colors hover:bg-[#2d7d46] sm:px-3 sm:text-xs',onClick:t[0]||(t[0]=t=>e.openItemUseModal(e.selectedItem))},' 使用 ')):Rn('v-if',!0),e.canEquip(e.selectedItem)?(yn(),Sn('button',{key:1,class:ee(['rounded px-3 py-1 text-[10px] font-bold text-white transition-colors sm:px-3 sm:text-xs',e.isInCombat?'cursor-not-allowed bg-gray-600 opacity-50':'bg-[#5865f2] hover:bg-[#4752c4]']),disabled:e.isInCombat,title:e.isInCombat?'战斗中无法更换装备':'装备此物品',onClick:t[1]||(t[1]=t=>!e.isInCombat&&e.$emit('equip-item',e.selectedItem))},' 装备 ',10,YC)):Rn('v-if',!0),Mn('button',{class:'rounded bg-[#36393f] px-3 py-1 text-[10px] font-bold text-gray-300 transition-colors hover:bg-[#40444b] sm:px-3 sm:text-xs',title:'查看详情',onClick:t[2]||(t[2]=t=>e.showDetailModal=!0)},' 详情 '),Mn('button',{class:'rounded bg-[#ed4245] px-3 py-1 text-[10px] font-bold text-white transition-colors hover:bg-[#c03537] sm:px-3 sm:text-xs',onClick:t[3]||(t[3]=t=>e.$emit('discard-item',e.selectedItem))},' 丢弃 ')]),Rn(' Row 3: Description '),e.selectedItem.desc?(yn(),Sn('div',KC,[Mn('p',JC,oe(e.selectedItem.desc),1)])):Rn('v-if',!0),Rn(' Row 4: Effect Tags '),e.hasEffects(e.selectedItem)?(yn(),Sn('div',ZC,[En(l,{item:e.selectedItem,compact:!0,'max-tags':6,'single-line':''},null,8,['item'])])):Rn('v-if',!0)],64)):(yn(),Sn('div',eI,' 选择一个物品查看详情 '))])),Rn(' Grid Header (Money & Capacity) '),e.compact?Rn('v-if',!0):(yn(),Sn('div',tI,[Mn('div',aI,[Mn('span',sI,'🪙 '+oe(e.currency.total),1),Mn('span',nI,[t[8]||(t[8]=Pn(' ( ',-1)),e.currency.gold>0?(yn(),Sn(pn,{key:0},[Mn('span',rI,oe(e.currency.gold)+'金',1),t[6]||(t[6]=Pn(', ',-1))],64)):Rn('v-if',!0),e.currency.silver>0||e.currency.gold>0?(yn(),Sn(pn,{key:1},[Mn('span',lI,oe(e.currency.silver)+'银',1),t[7]||(t[7]=Pn(', ',-1))],64)):Rn('v-if',!0),Mn('span',oI,oe(e.currency.copper)+'铜',1),t[9]||(t[9]=Pn(' ) ',-1))])]),Mn('div',iI,[Rn(' 超重警告标识 '),e.capacityStatus.isOverweight?(yn(),Sn('span',cI,[...t[10]||(t[10]=[Mn('span',{class:'animate-pulse'},'⚠️',-1),Mn('span',{class:'shrink-0'},'超重',-1)])])):Rn('v-if',!0),Mn('span',{class:ee(['shrink-0 text-[10px] font-bold sm:text-xs',e.capacityStatus.colorClass])},' 容量: '+oe(e.capacityStatus.used)+'/'+oe(e.capacityStatus.max),3)])])),Rn(' Grid Area (with stable scrollbar gutter to prevent width jitter) '),Rn(' 使用 CSS 媒体查询代替 JS 检测，避免首次渲染闪烁 '),Mn('div',dI,[(yn(!0),Sn(pn,null,xs(e.inventoryItems,t=>(yn(),Sn('div',{key:t.id,class:ee(['item-grid-cell',[{selected:e.selectedItem?.id===t.id},e.getQualityClass(t.quality)]]),title:t.name,onClick:a=>e.selectItem(t)},[Rn(' Sprite Sheet Icon or Emoji fallback '),e.hasIconData(t)?(yn(),Sn('div',{key:0,class:'item-sprite',style:X(e.getIconStyle(t,32))},null,4)):(yn(),Sn('div',pI,oe(t.emoji||'📦'),1)),t.count>1?(yn(),Sn('div',mI,oe(t.count),1)):Rn('v-if',!0)],10,uI))),128)),Rn(' Empty Slots Filler '),(yn(!0),Sn(pn,null,xs(Math.max(0,e.capacityStatus.max-(e.inventoryItems.length||0)),e=>(yn(),Sn('div',{key:'empty-'+e,class:'item-grid-cell empty'}))),128))]),Rn(' Item Detail Modal '),En(o,{visible:e.showDetailModal,item:e.selectedItem,'is-in-combat':e.isInCombat,onClose:t[4]||(t[4]=t=>e.showDetailModal=!1),onUseItem:e.handleUseFromModal,onEquipItem:e.handleEquipFromModal,onDiscardItem:e.handleDiscardFromModal},null,8,['visible','item','is-in-combat','onUseItem','onEquipItem','onDiscardItem']),Rn(' Item Use Modal (Target & Quantity Selection) '),e.player?(yn(),_n(i,{key:2,visible:e.showItemUseModal,item:e.itemToUse??void 0,player:e.player,allies:e.allies,onCancel:t[5]||(t[5]=t=>e.showItemUseModal=!1),onConfirm:e.handleItemUseConfirm},null,8,['visible','item','player','allies','onConfirm'])):Rn('v-if',!0)])}],['__scopeId','data-v-5c3d5c4a']])},props:{visible:{type:Boolean,required:!0},inventory:{type:Object,default:null},isInCombat:{type:Boolean,default:!1},player:{type:Object,default:null},allies:{type:Array,default:()=>[]}},emits:['close','use-item','equip-item','discard-item'],setup:(_,{emit:e})=>({handleUseItem:(t,a,s)=>{e('use-item',t,a,s)},handleEquipItem:t=>{e('equip-item',t)},handleDiscardItem:t=>{e('discard-item',t)}})}),lT=(0,$u.A)(rT,[['render',function(e,t,a,s,n,r){const l=fs('InventoryPanel');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'inventory-modal-backdrop fixed inset-0 z-60 flex items-center justify-center p-4',onClick:t[1]||(t[1]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',LC,[Rn(' 噪点纹理 '),t[4]||(t[4]=Mn('div',{class:'noise-overlay'},null,-1)),Rn(' Header '),Mn('div',BC,[t[3]||(t[3]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',OC,[t[2]||(t[2]=Mn('h2',{class:'header-title text-sm font-bold tracking-wider sm:text-lg'},[Mn('span',{class:'title-icon'},'📦'),Pn(' 背包 ')],-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')])]),Rn(' Content '),Mn('div',qC,[En(l,{inventory:e.inventory??{items:{}},'is-in-combat':e.isInCombat,player:e.player,allies:e.allies,onUseItem:e.handleUseItem,onEquipItem:e.handleEquipItem,onDiscardItem:e.handleDiscardItem},null,8,['inventory','is-in-combat','player','allies','onUseItem','onEquipItem','onDiscardItem'])]),Rn(' Footer Decoration '),t[5]||(t[5]=Mn('div',{class:'footer-deco-line relative z-10 px-4 pb-3'},[Mn('span',{class:'deco-diamond'},'◇')],-1))])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-3c6d6990']]),oT={class:'sidebar-container custom-scrollbar flex h-full flex-col overflow-y-auto px-4 pt-2 pb-4 text-gray-100'},iT={class:'title-section relative z-10 mb-4 pb-2 text-center'},cT=['title'],dT={class:'mb-4 flex justify-center'},uT={class:'mb-4'},pT={class:'mb-4 grid grid-cols-2 gap-x-2 gap-y-1 text-xs'},mT=['title'],gT={class:'max-w-[70px] truncate font-bold text-white'},hT={class:'info-row flex justify-between border-b border-gray-700/50 pb-1'},fT={class:'max-w-[70px] truncate text-gray-300'},vT={class:'info-row flex justify-between border-b border-gray-700/50 pb-1'},yT={class:'max-w-[70px] truncate text-gray-300'},bT={class:'info-row flex justify-between border-b border-gray-700/50 pb-1'},xT={class:'max-w-[70px] truncate text-gray-300'},wT=['title'],kT={class:'max-w-[70px] truncate text-gray-300'},ST=['title'],_T={class:'max-w-[70px] truncate text-gray-300'},CT={class:'info-row flex justify-between border-b border-gray-700/50 pb-1'},IT={class:'max-w-[70px] truncate font-bold text-amber-400'},TT={class:'info-row flex justify-between border-b border-gray-700/50 pb-1'},AT={class:'max-w-[70px] truncate text-gray-300'},MT=['title'],ET={class:'max-w-[150px] truncate text-gray-300'},$T={class:'mb-6'},DT={class:'min-h-[40px] rounded border border-gray-700 bg-[#202225] p-2 text-xs text-gray-400'},PT={class:'popup-container w-full max-w-sm rounded-lg border border-[#202225] bg-[#36393f] p-4 shadow-xl'},NT={class:'popup-header mb-3 flex items-center justify-between'},RT={class:'popup-content text-sm text-gray-300'},jT={class:'popup-container w-full max-w-sm rounded-lg border border-[#202225] bg-[#36393f] p-4 shadow-xl'},LT={class:'popup-header mb-3 flex items-center justify-between'},BT={class:'popup-content text-sm text-gray-300'},OT={class:'popup-container w-full max-w-sm rounded-lg border border-[#202225] bg-[#36393f] p-4 shadow-xl'},qT={class:'popup-header mb-3 flex items-center justify-between'},UT={class:'popup-content text-sm text-gray-300'},VT={class:'popup-container w-full max-w-sm rounded-lg border border-[#202225] bg-[#36393f] p-4 shadow-xl'},FT={class:'popup-header mb-3 flex items-center justify-between'},HT={class:'popup-content text-sm text-gray-300'},GT={key:0,class:'mb-3 flex items-center justify-center gap-2 rounded-lg bg-red-900/30 px-3 py-2 text-xs text-red-300'},zT={class:'mt-auto grid grid-cols-2 gap-2 pb-4'},WT=['disabled','title'],QT={key:0,class:'ml-1 text-[10px]'},XT=['title'],YT={key:0,class:'ml-1 text-[10px] text-yellow-500'},KT=['disabled','title'],JT=['disabled','title'],ZT={key:0,class:'ml-1 text-[10px]'};const eA={class:'status-panel'},tA={class:'stat-bar',title:'生命值'},aA={class:'label'},sA={class:'stat-bar',title:'魔法值'},nA={class:'label'},rA={class:'stat-bar',title:'体力值'},lA={class:'label'};const oA=Za({name:'StatusPanel',props:{stats:{type:Object,default:()=>({})},equipment:{type:Object,default:void 0}},setup(e){const t=ir(()=>{const t=e.stats||{};return{hp:{current:t.hp?.current||0,max:t.hp?.max||0},mp:{current:t.mp?.current||0,max:t.mp?.max||0},sp:{current:t.sp?.current||0,max:t.sp?.max||0}}}),a=ir(()=>t.value.hp.max?Math.min(t.value.hp.current/t.value.hp.max*100,100):0),s=ir(()=>t.value.mp.max?Math.min(t.value.mp.current/t.value.mp.max*100,100):0),n=ir(()=>t.value.sp.max?Math.min(t.value.sp.current/t.value.sp.max*100,100):0);return{effectiveStats:t,hpPercent:a,mpPercent:s,spPercent:n}}}),iA=Za({name:'PlayerSidebar',components:{AvatarDisplay:Vh,StatusPanel:(0,$u.A)(oA,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',eA,[Mn('div',tA,[Mn('div',{class:'fill hp',style:X({width:e.hpPercent+'%'})},null,4),Mn('span',aA,'HP '+oe(e.effectiveStats.hp.current)+'/'+oe(e.effectiveStats.hp.max),1)]),Mn('div',sA,[Mn('div',{class:'fill mp',style:X({width:e.mpPercent+'%'})},null,4),Mn('span',nA,'MP '+oe(e.effectiveStats.mp.current)+'/'+oe(e.effectiveStats.mp.max),1)]),Mn('div',rA,[Mn('div',{class:'fill sp',style:X({width:e.spPercent+'%'})},null,4),Mn('span',lA,'SP '+oe(e.effectiveStats.sp.current)+'/'+oe(e.effectiveStats.sp.max),1)])])}],['__scopeId','data-v-45853d3b']])},props:{player:{type:Object,required:!0},activeTab:{type:String,default:''},isInCombat:{type:Boolean,default:!1}},emits:['open-avatar','open-attributes','toggle-inventory','toggle-equipment','toggle-private','toggle-skills','toggle-quests','toggle-shop','toggle-notepad','toggle-node-map','click-name'],setup:()=>({showRacePopup:$t(!1),showAlignmentPopup:$t(!1),showClassPopup:$t(!1),showIdentityPopup:$t(!1)})}),cA=(0,$u.A)(iA,[['render',function(e,t,a,s,n,r){const l=fs('AvatarDisplay'),o=fs('StatusPanel');return yn(),Sn('div',oT,[Rn(' 噪点纹理背景 '),t[52]||(t[52]=Mn('div',{class:'noise-overlay'},null,-1)),Rn(' Title: Player Name (点击可打开Debug) '),Mn('div',iT,[t[23]||(t[23]=Mn('div',{class:'title-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('h2',{class:'player-name cursor-pointer text-sm font-bold tracking-wider select-none sm:text-xl',title:e.player.base.name+' (点击打开调试面板)',onClick:t[0]||(t[0]=t=>e.$emit('click-name'))},oe(e.player.base.name),9,cT)]),Rn(' Avatar Area '),Mn('div',dT,[En(l,{avatar:e.player.base.avatar,name:e.player.base.name,size:'2xl',clickable:!0,class:'cursor-pointer border-2 border-gray-600 shadow-lg transition-transform hover:scale-105 hover:border-amber-500',title:'点击查看/更换头像',onClick:t[1]||(t[1]=t=>e.$emit('open-avatar'))},null,8,['avatar','name'])]),Rn(' Stats Bars (🆕 传递装备数据以计算被动加成) '),Mn('div',uT,[En(o,{stats:e.player.stats,equipment:e.player.equipment},null,8,['stats','equipment'])]),Rn(' Basic Info (2 Columns) - 新布局 '),Mn('div',pT,[Rn(' 种族 | 性别 '),Mn('div',{class:'info-row flex cursor-pointer justify-between border-b border-gray-700/50 pb-1 hover:bg-gray-700/30',title:'种族: '+e.player.base.race+' (点击查看详情)',onClick:t[2]||(t[2]=t=>e.showRacePopup=!0)},[t[24]||(t[24]=Mn('span',{class:'text-gray-500'},'种族',-1)),Mn('span',gT,oe(e.player.base.race),1)],8,mT),Mn('div',hT,[t[25]||(t[25]=Mn('span',{class:'text-gray-500'},'性别',-1)),Mn('span',fT,oe(e.player.base.gender||'未知'),1)]),Rn(' 生理 | 心理 '),Mn('div',vT,[t[26]||(t[26]=Mn('span',{class:'text-gray-500'},'生理',-1)),Mn('span',yT,oe(e.player.base.age_bio||'?'),1)]),Mn('div',bT,[t[27]||(t[27]=Mn('span',{class:'text-gray-500'},'心理',-1)),Mn('span',xT,oe(e.player.base.age_psy||'?'),1)]),Rn(' 阵营 | 职业 '),Mn('div',{class:'info-row flex cursor-pointer justify-between border-b border-gray-700/50 pb-1 hover:bg-gray-700/30',title:'阵营: '+(e.player.base.alignment||'中立')+' (点击查看详情)',onClick:t[3]||(t[3]=t=>e.showAlignmentPopup=!0)},[t[28]||(t[28]=Mn('span',{class:'text-gray-500'},'阵营',-1)),Mn('span',kT,oe(e.player.base.alignment||'中立'),1)],8,wT),Mn('div',{class:'info-row flex cursor-pointer justify-between border-b border-gray-700/50 pb-1 hover:bg-gray-700/30',title:'职业: '+e.player.base.class+' (点击查看详情)',onClick:t[4]||(t[4]=t=>e.showClassPopup=!0)},[t[29]||(t[29]=Mn('span',{class:'text-gray-500'},'职业',-1)),Mn('span',_T,oe(e.player.base.class),1)],8,ST),Rn(' 等级 | 经验 '),Mn('div',CT,[t[30]||(t[30]=Mn('span',{class:'text-gray-500'},'等级',-1)),Mn('span',IT,'Lv.'+oe(e.player.base.level),1)]),Mn('div',TT,[t[31]||(t[31]=Mn('span',{class:'text-gray-500'},'经验',-1)),Mn('span',AT,oe(e.player.base.exp.current)+'/'+oe(e.player.base.exp.max),1)]),Rn(' 身份（单独一行） '),Mn('div',{class:'info-row col-span-2 flex cursor-pointer justify-between border-b border-gray-700/50 pb-1 hover:bg-gray-700/30',title:'身份: '+(e.player.base.identity||'流浪者')+' (点击查看详情)',onClick:t[5]||(t[5]=t=>e.showIdentityPopup=!0)},[t[32]||(t[32]=Mn('span',{class:'text-gray-500'},'身份',-1)),Mn('span',ET,oe(e.player.base.identity||'流浪者'),1)],8,MT)]),Rn(' Status Description (单独一行) '),Mn('div',$T,[t[33]||(t[33]=Mn('div',{class:'mb-1 text-xs font-bold text-gray-500'},'当前状态',-1)),Mn('div',DT,oe(e.player.base.status_desc||'一切正常。'),1)]),Rn(' 种族详情弹窗 '),(yn(),_n(Ra,{to:'body'},[e.showRacePopup?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[7]||(t[7]=Cl(t=>e.showRacePopup=!1,['self']))},[Mn('div',PT,[Mn('div',NT,[t[34]||(t[34]=Mn('h3',{class:'popup-title font-bold text-white'},'🧬 种族',-1)),Mn('button',{class:'popup-close text-gray-400 hover:text-white',onClick:t[6]||(t[6]=t=>e.showRacePopup=!1)},'✕')]),Mn('div',RT,oe(e.player.base.race),1)])])):Rn('v-if',!0)])),Rn(' 阵营详情弹窗 '),(yn(),_n(Ra,{to:'body'},[e.showAlignmentPopup?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[9]||(t[9]=Cl(t=>e.showAlignmentPopup=!1,['self']))},[Mn('div',jT,[Mn('div',LT,[t[35]||(t[35]=Mn('h3',{class:'popup-title font-bold text-white'},'⚖️ 阵营',-1)),Mn('button',{class:'popup-close text-gray-400 hover:text-white',onClick:t[8]||(t[8]=t=>e.showAlignmentPopup=!1)},'✕')]),Mn('div',BT,oe(e.player.base.alignment||'中立'),1)])])):Rn('v-if',!0)])),Rn(' 职业详情弹窗 '),(yn(),_n(Ra,{to:'body'},[e.showClassPopup?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[11]||(t[11]=Cl(t=>e.showClassPopup=!1,['self']))},[Mn('div',OT,[Mn('div',qT,[t[36]||(t[36]=Mn('h3',{class:'popup-title font-bold text-white'},'⚔️ 职业',-1)),Mn('button',{class:'popup-close text-gray-400 hover:text-white',onClick:t[10]||(t[10]=t=>e.showClassPopup=!1)},'✕')]),Mn('div',UT,oe(e.player.base.class),1)])])):Rn('v-if',!0)])),Rn(' 身份详情弹窗 '),(yn(),_n(Ra,{to:'body'},[e.showIdentityPopup?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-4',onClick:t[13]||(t[13]=Cl(t=>e.showIdentityPopup=!1,['self']))},[Mn('div',VT,[Mn('div',FT,[t[37]||(t[37]=Mn('h3',{class:'popup-title font-bold text-white'},'🏷️ 身份',-1)),Mn('button',{class:'popup-close text-gray-400 hover:text-white',onClick:t[12]||(t[12]=t=>e.showIdentityPopup=!1)},'✕')]),Mn('div',HT,oe(e.player.base.identity||'流浪者'),1)])])):Rn('v-if',!0)])),Rn(' Combat Lock Indicator '),e.isInCombat?(yn(),Sn('div',GT,[...t[38]||(t[38]=[Mn('span',{class:'animate-pulse'},'⚔️',-1),Mn('span',null,'战斗中 - 部分功能已锁定',-1)])])):Rn('v-if',!0),Rn(' Function Buttons '),Mn('div',zT,[Rn(' 节点地图 (Col Span 2) - DISABLED IN COMBAT '),Mn('button',{class:ee(['col-span-2 flex items-center justify-center rounded border px-2 py-2 text-center text-sm transition-colors',e.isInCombat?'cursor-not-allowed border-gray-700 bg-gray-800/50 text-gray-600 opacity-50':'border-gray-600 bg-[#36393f] text-gray-300 hover:border-amber-500 hover:bg-[#40444b] hover:text-white']),disabled:e.isInCombat,title:e.isInCombat?'战斗中无法使用地图':'打开节点地图 - 查看探索过的地点',onClick:t[14]||(t[14]=t=>!e.isInCombat&&e.$emit('toggle-node-map'))},[(yn(),Sn('svg',{class:ee(['mr-2 h-4 w-4',e.isInCombat?'text-gray-600':'text-amber-500']),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[...t[39]||(t[39]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618'},null,-1)])],2)),t[40]||(t[40]=Pn(' 地图 ',-1)),e.isInCombat?(yn(),Sn('span',QT,'🔒')):Rn('v-if',!0)],10,WT),Rn(' 属性 - READ-ONLY IN COMBAT (still accessible but can\'t modify) '),Mn('button',{class:'flex items-center rounded border border-gray-600 bg-[#36393f] px-2 py-2 text-left text-sm text-gray-300 transition-colors hover:border-gray-500 hover:bg-[#40444b] hover:text-white',title:e.isInCombat?'战斗中只能查看属性':'打开属性面板',onClick:t[15]||(t[15]=t=>e.$emit('open-attributes'))},[t[41]||(t[41]=Mn('svg',{class:'mr-2 h-4 w-4 text-amber-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z'})],-1)),t[42]||(t[42]=Pn(' 属性 ',-1)),e.isInCombat?(yn(),Sn('span',YT,'👁️')):Rn('v-if',!0)],8,XT),Rn(' 背包 - ALWAYS AVAILABLE (for combat items) '),Mn('button',{class:ee(['flex items-center rounded border border-gray-600 bg-[#36393f] px-2 py-2 text-left text-sm text-gray-300 transition-colors hover:border-gray-500 hover:bg-[#40444b] hover:text-white',{'border-amber-600/50 bg-[#40444b] text-white':'inventory'===e.activeTab}]),onClick:t[16]||(t[16]=t=>e.$emit('toggle-inventory'))},[...t[43]||(t[43]=[Mn('svg',{class:'mr-2 h-4 w-4 text-green-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10'})],-1),Pn(' 背包 ',-1)])],2),Rn(' 私密 '),Mn('button',{class:'flex items-center rounded border border-gray-600 bg-[#36393f] px-2 py-2 text-left text-sm text-gray-300 transition-colors hover:border-gray-500 hover:bg-[#40444b] hover:text-white',onClick:t[17]||(t[17]=t=>e.$emit('toggle-private'))},[...t[44]||(t[44]=[Mn('svg',{class:'mr-2 h-4 w-4 text-pink-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z'})],-1),Pn(' 私密 ',-1)])]),Rn(' 装备 - DISABLED IN COMBAT '),Mn('button',{class:ee(['flex items-center rounded border px-2 py-2 text-left text-sm transition-colors',e.isInCombat?'cursor-not-allowed border-gray-700 bg-gray-800/50 text-gray-600 opacity-50':'equipment'===e.activeTab?'border-amber-600/50 bg-[#40444b] text-white':'border-gray-600 bg-[#36393f] text-gray-300 hover:border-gray-500 hover:bg-[#40444b] hover:text-white']),disabled:e.isInCombat,title:e.isInCombat?'战斗中无法更换装备':'打开装备面板',onClick:t[18]||(t[18]=t=>!e.isInCombat&&e.$emit('toggle-equipment'))},[(yn(),Sn('svg',{class:ee(['mr-2 h-4 w-4',e.isInCombat?'text-gray-600':'text-blue-500']),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[...t[45]||(t[45]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z'},null,-1)])],2)),t[46]||(t[46]=Pn(' 装备 ',-1))],10,KT),Rn(' 任务 '),Mn('button',{class:'flex items-center rounded border border-gray-600 bg-[#36393f] px-2 py-2 text-left text-sm text-gray-300 transition-colors hover:border-gray-500 hover:bg-[#40444b] hover:text-white',onClick:t[19]||(t[19]=t=>e.$emit('toggle-quests'))},[...t[47]||(t[47]=[Mn('svg',{class:'mr-2 h-4 w-4 text-yellow-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01'})],-1),Pn(' 任务 ',-1)])]),Rn(' 技能 '),Mn('button',{class:'flex items-center rounded border border-gray-600 bg-[#36393f] px-2 py-2 text-left text-sm text-gray-300 transition-colors hover:border-gray-500 hover:bg-[#40444b] hover:text-white',onClick:t[20]||(t[20]=t=>e.$emit('toggle-skills'))},[...t[48]||(t[48]=[Mn('svg',{class:'mr-2 h-4 w-4 text-red-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M13 10V3L4 14h7v7l9-11h-7z'})],-1),Pn(' 技能 ',-1)])]),Rn(' 商城 - DISABLED IN COMBAT '),Mn('button',{class:ee(['flex items-center rounded border px-2 py-2 text-left text-sm transition-colors',e.isInCombat?'cursor-not-allowed border-gray-700 bg-gray-800/50 text-gray-600 opacity-50':'border-gray-600 bg-[#36393f] text-gray-300 hover:border-gray-500 hover:bg-[#40444b] hover:text-white']),disabled:e.isInCombat,title:e.isInCombat?'战斗中无法访问商城':'打开商城',onClick:t[21]||(t[21]=t=>!e.isInCombat&&e.$emit('toggle-shop'))},[(yn(),Sn('svg',{class:ee(['mr-2 h-4 w-4',e.isInCombat?'text-gray-600':'text-amber-500']),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[...t[49]||(t[49]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z'},null,-1)])],2)),t[50]||(t[50]=Pn(' 商城 ',-1)),e.isInCombat?(yn(),Sn('span',ZT,'🔒')):Rn('v-if',!0)],10,JT),Rn(' 备忘录 '),Mn('button',{class:'flex items-center rounded border border-gray-600 bg-[#36393f] px-2 py-2 text-left text-sm text-gray-300 transition-colors hover:border-gray-500 hover:bg-[#40444b] hover:text-white',onClick:t[22]||(t[22]=t=>e.$emit('toggle-notepad'))},[...t[51]||(t[51]=[Mn('svg',{class:'mr-2 h-4 w-4 text-gray-400',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'})],-1),Pn(' 备忘录 ',-1)])])])])}],['__scopeId','data-v-294af673']]),dA={class:'private-info-modal relative flex w-[95%] max-w-lg flex-col overflow-hidden rounded-lg shadow-2xl md:w-[90%] md:max-w-xl',style:{'max-height':'50vh'}},uA={class:'modal-header relative z-10 px-4 py-3'},pA={class:'flex items-center justify-between'},mA={class:'flex items-center gap-2'},gA={key:0,class:'gender-badge px-2 py-0.5 text-[10px] md:text-xs'},hA={class:'modal-content custom-scrollbar relative z-10 flex-1 overflow-y-auto p-2 md:p-4'},fA={class:'space-y-3 md:space-y-4'},vA={key:0,class:'overflow-hidden rounded-lg border border-blue-700/50 bg-[#36393f]'},yA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},bA={class:'text-[9px] text-gray-500 md:text-[10px]'},xA={key:1,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},wA={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},kA={class:'text-[10px] text-gray-500 md:text-xs'},SA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},_A={class:'text-[9px] text-gray-500 md:text-[10px]'},CA={key:2,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},IA={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},TA={class:'text-[10px] text-gray-500 md:text-xs'},AA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},MA={class:'text-[9px] text-gray-500 md:text-[10px]'},EA={key:3,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},$A={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},DA={class:'text-[10px] text-gray-500 md:text-xs'},PA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},NA={class:'text-[9px] text-gray-500 md:text-[10px]'},RA={key:4,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},jA={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},LA={class:'text-[10px] text-gray-500 md:text-xs'},BA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},OA={class:'text-[9px] text-gray-500 md:text-[10px]'},qA={key:5,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},UA={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},VA={class:'text-[10px] text-gray-500 md:text-xs'},FA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},HA={class:'text-[9px] text-gray-500 md:text-[10px]'},GA={key:6,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},zA={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},WA={class:'text-[10px] text-gray-500 md:text-xs'},QA={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},XA={class:'text-[9px] text-gray-500 md:text-[10px]'},YA={key:0,class:'text-[8px] text-gray-500 md:text-[10px]'},KA={key:7,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},JA={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},ZA={class:'text-[10px] text-gray-500 md:text-xs'},eM={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},tM={class:'text-[9px] text-gray-500 md:text-[10px]'},aM={key:0,class:'text-[8px] text-gray-500 md:text-[10px]'},sM={key:8,class:'overflow-hidden rounded-lg border border-gray-700/50 bg-[#36393f]'},nM={class:'flex items-center gap-1.5 border-b border-gray-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},rM={class:'text-[10px] text-gray-500 md:text-xs'},lM={class:'grid grid-cols-2 gap-px bg-gray-700/30 p-px md:grid-cols-3'},oM={class:'text-[9px] text-gray-500 md:text-[10px]'};const iM={hair_color:'发色',hair_length:'发长',hair_style:'发型',eye_color:'瞳色',height:'身高',body_build:'体型',skin_tone:'肤色',face_features:'五官',special_marks:'特殊标记',racial_traits:'种族特征'},cM=['hair_color','hair_length','hair_style','eye_color','height','body_build','skin_tone','face_features','special_marks','racial_traits'],dM=Za({name:'PrivateInfoModal',props:{visible:{type:Boolean,required:!0},privateInfo:{type:Object,default:()=>({})},gender:{type:String,default:'未知'},appearance:{type:Object,default:()=>null}},emits:['close'],setup(e){const t=ir(()=>function(e){if(!e||'string'!=typeof e)return'unknown';const t=e.toLowerCase();return['扶她','⚥','futanari','futa','双性','雌雄同体','hermaphrodite'].some(e=>t.includes(e.toLowerCase()))?'futanari':['女','♀','female','f'].some(e=>t===e.toLowerCase())?'female':['男','♂','male','m'].some(e=>t===e.toLowerCase())?'male':'unknown'}(e.gender)),a=ir(()=>{const e=t.value;return'female'===e?'♀ 女性':'male'===e?'♂ 男性':'futanari'===e?'⚥ 扶她':'未设定'}),s=ir(()=>{const e=t.value;return'female'===e||'futanari'===e||'unknown'===e}),n=ir(()=>{const e=t.value;return'male'===e||'futanari'===e||'unknown'===e}),r=ir(()=>{const e=['Oral_Sex','Manual_Sex','Footjob','Masturbation','Anal_Intercourse'],a=t.value;return'female'===a?['Vaginal_Intercourse',...e]:'male'===a?['Virginity_Status','Ejaculation_Count','Impregnation_Count',...e]:['Vaginal_Intercourse','Virginity_Status','Ejaculation_Count','Impregnation_Count',...e]}),l=ir(()=>e.appearance||{}),o=ir(()=>{const t=e.appearance;return!!t&&Object.values(t).some(e=>null!=e&&''!==e)}),i=ir(()=>{const t=e.appearance||{};return cM.filter(e=>{const a=t[e];return null!=a&&''!==a})}),c=ir(()=>{const a=t.value,s=function(e){const t={Body_Type:null,Pubic_Hair:null,Body_Hair:null,Skin_Sensitivity:null,Oral_Sex:0,Manual_Sex:0,Footjob:0,Masturbation:0,Anal_Intercourse:0,Sexual_Orientation:null,Kinks:null};return'female'===e?{...t,Breast_Size:null,Breast_Volume:null,Breast_Shape:null,Areola_Color:null,Nipple_Sensitivity:null,Vulva_Appearance:null,Vulva_Color:null,Clitoris_Sensitivity:null,Virginity_Status:null,Hymen_Status:null,Pregnancy_Status:null,Gestation:null,Fertility:null,Vaginal_Intercourse:0,Childbirth:0,Abortion:0,Menstrual_Cycle:null}:'male'===e?{...t,Penis_Length:null,Penis_Girth:null,Penis_Shape:null,Foreskin_Status:null,Testicle_Size:null,Scrotum_Appearance:null,Erectile_Function:null,Ejaculation_Volume:null,Refractory_Period:null,Ejaculation_Count:0,Virginity_Status:null,Impregnation_Count:0}:'futanari'===e?{...t,Breast_Size:null,Breast_Volume:null,Breast_Shape:null,Areola_Color:null,Nipple_Sensitivity:null,Vulva_Appearance:null,Vulva_Color:null,Clitoris_Sensitivity:null,Virginity_Status:null,Hymen_Status:null,Pregnancy_Status:null,Gestation:null,Fertility:null,Vaginal_Intercourse:0,Childbirth:0,Abortion:0,Menstrual_Cycle:null,Penis_Length:null,Penis_Girth:null,Penis_Shape:null,Foreskin_Status:null,Testicle_Size:null,Scrotum_Appearance:null,Erectile_Function:null,Ejaculation_Volume:null,Refractory_Period:null,Ejaculation_Count:0,Impregnation_Count:0,Dominant_Genitalia:'均等'}:t}('unknown'===a?'futanari':a);return{...s,...e.privateInfo||{}}});return{genderCategory:t,genderDisplay:a,showFemaleFields:s,showMaleFields:n,femaleBodyFields:['Body_Type','Breast_Size','Breast_Volume','Breast_Shape','Areola_Color','Nipple_Sensitivity'],femaleGenitaliaFields:['Vulva_Appearance','Vulva_Color','Clitoris_Sensitivity','Pubic_Hair'],maleBodyFields:['Body_Type','Body_Hair','Pubic_Hair'],maleGenitaliaFields:['Penis_Length','Penis_Girth','Penis_Shape','Foreskin_Status','Testicle_Size','Scrotum_Appearance'],maleFunctionFields:['Erectile_Function','Ejaculation_Volume','Refractory_Period'],reproductionFields:['Virginity_Status','Hymen_Status','Pregnancy_Status','Gestation','Fertility','Menstrual_Cycle','Childbirth','Abortion'],activityFields:r,preferenceFields:['Sexual_Orientation','Skin_Sensitivity','Kinks'],safePrivateInfo:c,safeAppearance:l,hasAppearanceData:o,appearanceFieldsFiltered:i,getFieldLabel:e=>Ei[e]||e.replace(/_/g,' '),getAppearanceLabel:e=>iM[e]||e,formatValue:e=>null==e||''===e?'未知':Array.isArray(e)?e.length>0?e.join('、'):'未知':'number'==typeof e?e.toString():e,isUnknown:e=>null==e||''===e||Array.isArray(e)&&0===e.length,isNumericField:e=>['Oral_Sex','Manual_Sex','Footjob','Masturbation','Anal_Intercourse','Vaginal_Intercourse','Childbirth','Abortion','Ejaculation_Count','Impregnation_Count','Gestation'].includes(e)}}}),uM=(0,$u.A)(dM,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'private-info-backdrop fixed inset-0 z-[80] flex items-center justify-center',onClick:t[1]||(t[1]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',dA,[Rn(' 背景层 '),t[24]||(t[24]=Mn('div',{class:'modal-bg-layer'},null,-1)),t[25]||(t[25]=Mn('div',{class:'modal-noise'},null,-1)),Rn(' Header '),Mn('div',uA,[Rn(' 顶部装饰线 '),t[5]||(t[5]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',pA,[Mn('div',mA,[t[2]||(t[2]=Mn('span',{class:'header-icon text-base md:text-lg'},'🔞',-1)),t[3]||(t[3]=Mn('h3',{class:'header-title text-sm font-bold md:text-lg'},'身体档案',-1)),e.genderDisplay?(yn(),Sn('span',gA,oe(e.genderDisplay),1)):Rn('v-if',!0)]),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[4]||(t[4]=[Mn('span',null,'✕',-1)])])]),Rn(' 底部装饰线 '),t[6]||(t[6]=Mn('div',{class:'header-deco-line mt-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1))]),Rn(' Content '),Mn('div',hA,[Rn(' Grouped Content (始终显示) '),Mn('div',fA,[Rn(' Appearance: Fixed Physical Features (放在最顶部) '),e.hasAppearanceData?(yn(),Sn('div',vA,[t[7]||(t[7]=Mn('div',{class:'flex items-center gap-1.5 border-b border-blue-700/30 bg-[#2f3136] px-2 py-1.5 md:px-3 md:py-2'},[Mn('span',{class:'text-sm md:text-base'},'👤'),Mn('h4',{class:'text-[10px] font-bold text-blue-300 md:text-xs'},'外貌特征'),Mn('span',{class:'text-[10px] text-gray-500 md:text-xs'},'(固定)')],-1)),Mn('div',yA,[(yn(!0),Sn(pn,null,xs(e.appearanceFieldsFiltered,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',bA,oe(e.getAppearanceLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safeAppearance[t])?'text-gray-500 italic':'text-blue-200']])},oe(e.formatValue(e.safeAppearance[t])),3)]))),128))])])):Rn('v-if',!0),Rn(' Female/Futanari: Body Features '),e.showFemaleFields&&e.femaleBodyFields.length>0?(yn(),Sn('div',xA,[Mn('div',wA,[t[8]||(t[8]=Mn('span',{class:'text-sm md:text-base'},'💗',-1)),t[9]||(t[9]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'身体特征',-1)),Mn('span',kA,'('+oe(e.femaleBodyFields.length)+')',1)]),Mn('div',SA,[(yn(!0),Sn(pn,null,xs(e.femaleBodyFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',_A,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':'text-gray-200']])},oe(e.formatValue(e.safePrivateInfo[t])),3)]))),128))])])):Rn('v-if',!0),Rn(' Female/Futanari: Genitalia '),e.showFemaleFields&&e.femaleGenitaliaFields.length>0?(yn(),Sn('div',CA,[Mn('div',IA,[t[10]||(t[10]=Mn('span',{class:'text-sm md:text-base'},'🌸',-1)),t[11]||(t[11]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'女性特征',-1)),Mn('span',TA,'('+oe(e.femaleGenitaliaFields.length)+')',1)]),Mn('div',AA,[(yn(!0),Sn(pn,null,xs(e.femaleGenitaliaFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',MA,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':'text-gray-200']])},oe(e.formatValue(e.safePrivateInfo[t])),3)]))),128))])])):Rn('v-if',!0),Rn(' Male only: Body Features '),e.showMaleFields&&!e.showFemaleFields&&e.maleBodyFields.length>0?(yn(),Sn('div',EA,[Mn('div',$A,[t[12]||(t[12]=Mn('span',{class:'text-sm md:text-base'},'💪',-1)),t[13]||(t[13]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'身体特征',-1)),Mn('span',DA,'('+oe(e.maleBodyFields.length)+')',1)]),Mn('div',PA,[(yn(!0),Sn(pn,null,xs(e.maleBodyFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',NA,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':'text-gray-200']])},oe(e.formatValue(e.safePrivateInfo[t])),3)]))),128))])])):Rn('v-if',!0),Rn(' Male/Futanari: Genitalia '),e.showMaleFields&&e.maleGenitaliaFields.length>0?(yn(),Sn('div',RA,[Mn('div',jA,[t[14]||(t[14]=Mn('span',{class:'text-sm md:text-base'},'🍆',-1)),t[15]||(t[15]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'男性特征',-1)),Mn('span',LA,'('+oe(e.maleGenitaliaFields.length)+')',1)]),Mn('div',BA,[(yn(!0),Sn(pn,null,xs(e.maleGenitaliaFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',OA,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':'text-gray-200']])},oe(e.formatValue(e.safePrivateInfo[t])),3)]))),128))])])):Rn('v-if',!0),Rn(' Male: Function '),e.showMaleFields&&e.maleFunctionFields.length>0?(yn(),Sn('div',qA,[Mn('div',UA,[t[16]||(t[16]=Mn('span',{class:'text-sm md:text-base'},'⚡',-1)),t[17]||(t[17]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'功能状态',-1)),Mn('span',VA,'('+oe(e.maleFunctionFields.length)+')',1)]),Mn('div',FA,[(yn(!0),Sn(pn,null,xs(e.maleFunctionFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',HA,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':'text-gray-200']])},oe(e.formatValue(e.safePrivateInfo[t])),3)]))),128))])])):Rn('v-if',!0),Rn(' Female: Reproduction '),e.showFemaleFields&&e.reproductionFields.length>0?(yn(),Sn('div',GA,[Mn('div',zA,[t[18]||(t[18]=Mn('span',{class:'text-sm md:text-base'},'🤰',-1)),t[19]||(t[19]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'生育相关',-1)),Mn('span',WA,'('+oe(e.reproductionFields.length)+')',1)]),Mn('div',QA,[(yn(!0),Sn(pn,null,xs(e.reproductionFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',XA,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':e.isNumericField(t)?'text-pink-400':'text-gray-200']])},[Pn(oe(e.formatValue(e.safePrivateInfo[t]))+' ',1),e.isNumericField(t)&&'number'==typeof e.safePrivateInfo[t]&&!e.isUnknown(e.safePrivateInfo[t])?(yn(),Sn('span',YA,'次')):Rn('v-if',!0)],2)]))),128))])])):Rn('v-if',!0),Rn(' Activity Stats '),e.activityFields.length>0?(yn(),Sn('div',KA,[Mn('div',JA,[t[20]||(t[20]=Mn('span',{class:'text-sm md:text-base'},'📊',-1)),t[21]||(t[21]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'性行为统计',-1)),Mn('span',ZA,'('+oe(e.activityFields.length)+')',1)]),Mn('div',eM,[(yn(!0),Sn(pn,null,xs(e.activityFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',tM,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':e.isNumericField(t)?'text-pink-400':'text-gray-200']])},[Pn(oe(e.formatValue(e.safePrivateInfo[t]))+' ',1),e.isNumericField(t)&&'number'==typeof e.safePrivateInfo[t]&&!e.isUnknown(e.safePrivateInfo[t])?(yn(),Sn('span',aM,'次')):Rn('v-if',!0)],2)]))),128))])])):Rn('v-if',!0),Rn(' Preferences '),e.preferenceFields.length>0?(yn(),Sn('div',sM,[Mn('div',nM,[t[22]||(t[22]=Mn('span',{class:'text-sm md:text-base'},'💭',-1)),t[23]||(t[23]=Mn('h4',{class:'text-[10px] font-bold text-gray-300 md:text-xs'},'偏好设置',-1)),Mn('span',rM,'('+oe(e.preferenceFields.length)+')',1)]),Mn('div',lM,[(yn(!0),Sn(pn,null,xs(e.preferenceFields,t=>(yn(),Sn('div',{key:t,class:'flex flex-col bg-[#36393f] p-1.5 md:p-2'},[Mn('span',oM,oe(e.getFieldLabel(t)),1),Mn('span',{class:ee(['text-[10px] font-medium md:text-xs',[e.isUnknown(e.safePrivateInfo[t])?'text-gray-500 italic':'text-gray-200']])},oe(e.formatValue(e.safePrivateInfo[t])),3)]))),128))])])):Rn('v-if',!0)])])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-540c0d6d']]),pM={class:'quests-modal'},mM={class:'modal-header'},gM={class:'header-content'},hM={class:'detail-section'},fM={class:'flex flex-col'},vM={class:'flex items-center gap-2'},yM={class:'truncate text-sm font-bold text-white sm:text-base'},bM={class:'progress-row border-t border-[rgba(114,137,218,0.15)] pt-1.5'},xM={class:'mb-1 flex items-center justify-between'},wM={class:'h-1.5 w-full overflow-hidden rounded-full bg-[rgba(20,22,28,0.8)] sm:h-2'},kM={class:'desc-row border-t border-[rgba(114,137,218,0.15)] pt-1.5'},SM={class:'text-[10px] leading-relaxed text-gray-300 sm:text-xs'},_M={key:0,class:'reward-row border-t border-[rgba(114,137,218,0.15)] pt-1.5'},CM={class:'flex items-center gap-1'},IM={class:'text-[10px] text-amber-400 sm:text-xs'},TM={key:1,class:'flex h-16 w-full items-center justify-center text-xs text-gray-500 italic sm:h-20 sm:text-sm'},AM={class:'filter-tabs'},MM=['onClick'],EM={class:'custom-scrollbar min-h-0 flex-1 overflow-y-auto p-2 sm:p-3'},$M={key:0,class:'py-6 text-center text-[10px] text-gray-500 sm:py-8 sm:text-xs'},DM={key:1,class:'quest-list space-y-1 sm:space-y-1.5'},PM=['onClick'],NM={class:'quest-list-info'},RM={class:'quest-list-row'},jM={class:'quest-list-name'},LM={class:'quest-list-progress'},BM={class:'quest-progress-bar'},OM={class:'quest-progress-text'},qM={class:'modal-footer'},UM={class:'footer-content'},VM={class:'footer-info'};const FM=Za({name:'QuestsModal',props:{visible:{type:Boolean,default:!1},quests:{type:Object,default:()=>({})}},emits:['close'],setup(e){const t=$t(null),a=$t('all'),s=ir(()=>Object.values(e.quests)),n=ir(()=>t.value&&e.quests[t.value]||null),r=ir(()=>'all'===a.value?s.value:s.value.filter(e=>e.status===a.value)),l=ir(()=>s.value.filter(e=>'active'===e.status).length),o=ir(()=>s.value.filter(e=>'completed'===e.status).length),i=ir(()=>s.value.filter(e=>'failed'===e.status).length);_a(()=>e.visible,e=>{if(e&&s.value.length>0&&!t.value){const e=s.value.find(e=>'active'===e.status);t.value=e?.id||s.value[0].id}},{immediate:!0}),_a(()=>e.quests,()=>{if(t.value&&!e.quests[t.value]){const e=s.value.find(e=>'active'===e.status);t.value=e?.id||(s.value.length>0?s.value[0].id:null)}},{deep:!0});return{selectedQuest:n,activeFilter:a,filterTabs:[{label:'全部',value:'all'},{label:'进行中',value:'active'},{label:'已完成',value:'completed'},{label:'失败',value:'failed'}],filteredQuests:r,activeCount:l,completedCount:o,failedCount:i,getQuestCount:e=>'all'===e?s.value.length:s.value.filter(t=>t.status===e).length,selectQuest:e=>{t.value=e.id},getStatusText:e=>({active:'进行中',completed:'已完成',failed:'已失败'}[e]),getStatusIcon:e=>({active:'⚡',completed:'✓',failed:'✗'}[e]),getStatusClass:e=>({active:'bg-blue-900/50 text-blue-400',completed:'bg-green-900/50 text-green-400',failed:'bg-red-900/50 text-red-400'}[e]),getIconClass:e=>({active:'bg-blue-900/30 text-blue-400 border-blue-700',completed:'bg-green-900/30 text-green-400 border-green-700',failed:'bg-red-900/30 text-red-400 border-red-700'}[e]),getProgressColor:e=>e>=100?'text-green-400':e>=75?'text-yellow-400':e>=50?'text-blue-400':'text-gray-400',getProgressBarClass:(e,t)=>'completed'===e?'bg-green-500':'failed'===e?'bg-red-500':t>=75?'bg-yellow-500':'bg-blue-500',getEmptyMessage:()=>({all:'暂无任务',active:'暂无进行中的任务',completed:'暂无已完成的任务',failed:'暂无失败的任务'}[a.value])}}}),HM=(0,$u.A)(FM,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'modal-backdrop',onClick:t[2]||(t[2]=Cl(t=>e.$emit('close'),['self']))},[Rn(' 背景效果层 '),t[15]||(t[15]=Mn('div',{class:'modal-vignette'},null,-1)),t[16]||(t[16]=Mn('div',{class:'modal-noise'},null,-1)),Mn('div',pM,[Rn(' Header '),Mn('div',mM,[Rn(' 装饰线 '),t[5]||(t[5]=Mn('div',{class:'header-deco-line top'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',gM,[t[4]||(t[4]=Mn('div',{class:'header-title-group'},[Mn('span',{class:'header-icon'},'📜'),Mn('h3',{class:'header-title'},'任务日志')],-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[3]||(t[3]=[Mn('span',{class:'close-icon'},'✕',-1)])])])]),Rn(' Quest Details Section '),Mn('div',hM,[e.selectedQuest?(yn(),Sn(pn,{key:0},[Rn(' Row 1: Name + Status '),Mn('div',fM,[Mn('div',vM,[Mn('h3',yM,oe(e.selectedQuest.name),1),Mn('span',{class:ee(['shrink-0 rounded px-1.5 py-0.5 text-[9px] font-bold sm:text-[10px]',e.getStatusClass(e.selectedQuest.status)])},oe(e.getStatusText(e.selectedQuest.status)),3)])]),Rn(' Row 2: Progress Bar '),Mn('div',bM,[Mn('div',xM,[t[6]||(t[6]=Mn('span',{class:'text-[9px] text-gray-500 sm:text-[10px]'},'任务进度',-1)),Mn('span',{class:ee(['text-[9px] font-bold sm:text-[10px]',e.getProgressColor(e.selectedQuest.progress)])},oe(e.selectedQuest.progress)+'% ',3)]),Mn('div',wM,[Mn('div',{class:ee(['h-full rounded-full transition-all duration-300',e.getProgressBarClass(e.selectedQuest.status,e.selectedQuest.progress)]),style:X({width:`${e.selectedQuest.progress}%`})},null,6)])]),Rn(' Row 3: Description '),Mn('div',kM,[t[7]||(t[7]=Mn('div',{class:'mb-0.5 text-[9px] font-bold text-gray-500 sm:text-[10px]'},'任务描述',-1)),Mn('p',SM,oe(e.selectedQuest.desc||'暂无描述'),1)]),Rn(' Row 4: Reward '),e.selectedQuest.reward?(yn(),Sn('div',_M,[t[9]||(t[9]=Mn('div',{class:'mb-0.5 text-[9px] font-bold text-gray-500 sm:text-[10px]'},'任务奖励',-1)),Mn('div',CM,[t[8]||(t[8]=Mn('span',{class:'text-sm'},'🎁',-1)),Mn('span',IM,oe(e.selectedQuest.reward),1)])])):Rn('v-if',!0)],64)):(yn(),Sn('div',TM,' 选择一个任务查看详情 '))]),Rn(' Filter Tabs '),Mn('div',AM,[(yn(!0),Sn(pn,null,xs(e.filterTabs,t=>(yn(),Sn('button',{key:t.value,class:ee(['filter-tab',[e.activeFilter===t.value?'active':'']]),onClick:a=>e.activeFilter=t.value},oe(t.label)+' ('+oe(e.getQuestCount(t.value))+') ',11,MM))),128))]),Rn(' Quests List '),Mn('div',EM,[0===e.filteredQuests.length?(yn(),Sn('div',$M,oe(e.getEmptyMessage()),1)):(yn(),Sn('div',DM,[(yn(!0),Sn(pn,null,xs(e.filteredQuests,a=>(yn(),Sn('div',{key:a.id,class:ee(['quest-list-item',[{selected:e.selectedQuest?.id===a.id},{completed:'completed'===a.status},{failed:'failed'===a.status}]]),onClick:t=>e.selectQuest(a)},[Rn(' Left: Icon '),Mn('div',{class:ee(['quest-list-icon',e.getIconClass(a.status)])},oe(e.getStatusIcon(a.status)),3),Rn(' Middle: Info '),Mn('div',NM,[Mn('div',RM,[Mn('span',jM,oe(a.name),1),Mn('span',{class:ee(['quest-list-status',e.getStatusClass(a.status)])},oe(e.getStatusText(a.status)),3)]),Mn('div',LM,[Mn('div',BM,[Mn('div',{class:ee(['quest-progress-fill',e.getProgressBarClass(a.status,a.progress)]),style:X({width:`${a.progress}%`})},null,6)]),Mn('span',OM,oe(a.progress)+'%',1)])]),Rn(' Right: Arrow indicator '),t[10]||(t[10]=Mn('div',{class:'quest-list-arrow'},'›',-1))],10,PM))),128))]))]),Rn(' Footer '),Mn('div',qM,[Rn(' 装饰线 '),t[14]||(t[14]=Mn('div',{class:'footer-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',UM,[Mn('span',VM,[t[11]||(t[11]=Mn('span',{class:'info-diamond'},'◆',-1)),Pn(' 进行中: '+oe(e.activeCount)+' | 已完成: '+oe(e.completedCount)+' | 失败: '+oe(e.failedCount)+' ',1),t[12]||(t[12]=Mn('span',{class:'info-diamond'},'◆',-1))]),Mn('button',{class:'footer-btn',onClick:t[1]||(t[1]=t=>e.$emit('close'))},[...t[13]||(t[13]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'关闭',-1)])])])])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-5318725f']]),GM={class:'skills-modal'},zM={class:'modal-header'},WM={class:'header-content'},QM={class:'category-filter'},XM=['onClick'],YM={class:'filter-icon'},KM={class:'filter-label'},JM={class:'filter-count'},ZM={class:'detail-section'},eE={class:'flex flex-col'},tE={class:'truncate text-sm font-bold text-white sm:text-base'},aE={class:'detail-tags mt-1 flex flex-wrap items-center gap-1'},sE={key:0,class:'detail-tag-empty'},nE={class:'cost-row flex flex-wrap items-center gap-2 border-t border-[#40444b] pt-1.5'},rE={key:0,class:'flex items-center gap-0.5 text-[10px] text-blue-400 sm:text-xs'},lE={key:1,class:'flex items-center gap-0.5 text-[10px] text-green-400 sm:text-xs'},oE={key:2,class:'flex items-center gap-0.5 text-[10px] text-gray-400 sm:text-xs'},iE={key:3,class:'rounded bg-yellow-900/50 px-1.5 py-0.5 text-[10px] font-bold text-yellow-400 sm:text-xs'},cE={key:4,class:'text-[10px] text-gray-500 sm:text-xs'},dE={class:'desc-row border-t border-[#40444b] pt-1.5'},uE={class:'text-[10px] leading-relaxed text-gray-300 sm:text-xs'},pE={key:0,class:'effect-row border-t border-[#40444b] pt-1.5'},mE={class:'effect-list custom-scrollbar'},gE={key:1,class:'flex h-16 w-full items-center justify-center text-xs text-gray-500 italic sm:h-20 sm:text-sm'},hE={class:'custom-scrollbar min-h-0 flex-1 overflow-y-auto px-2 py-1 sm:px-3 sm:py-1.5'},fE={key:0,class:'py-6 text-center text-[10px] text-gray-500 sm:py-8 sm:text-xs'},vE={key:1,class:'skill-list space-y-1 sm:space-y-1.5'},yE=['onClick','onContextmenu','onTouchstart'],bE={class:'skill-list-info'},xE={class:'skill-list-row'},wE={class:'skill-list-name'},kE={key:0,class:'cooldown-inline'},SE={class:'skill-list-cost'},_E={key:0,class:'cost-mp'},CE={key:1,class:'cost-sp'},IE={key:2,class:'cost-cd'},TE={class:'skill-list-tags'},AE={key:0,class:'skill-list-tag-empty'},ME={class:'modal-footer'},EE={class:'footer-content'},$E={class:'footer-info'},DE={class:'context-menu-header'},PE={class:'context-menu-icon'},NE={class:'context-menu-title'},RE=['disabled'],jE={class:'confirm-dialog'},LE={class:'confirm-body'},BE={class:'confirm-footer'};const OE=Za({name:'SkillsModal',props:{visible:{type:Boolean,default:!1},skills:{type:Object,default:()=>({})}},emits:['close','skill-forgotten'],setup(e,{emit:t}){const a=$t(null),s=$t('all'),n=e=>!!e.effects?.length&&e.effects.every(e=>'passive'===e.trigger),r=ir(()=>{if('all'===s.value)return e.skills;const t={};for(const[a,r]of Object.entries(e.skills)){const e=n(r);('passive'===s.value&&e||'active'===s.value&&!e)&&(t[a]=r)}return t}),l=ir(()=>a.value&&e.skills[a.value]||null);_a(()=>e.visible,t=>{const s=Object.keys(e.skills);t&&s.length>0&&!a.value&&(a.value=s[0])},{immediate:!0}),_a(()=>e.skills,e=>{const t=Object.keys(e);a.value&&!e[a.value]&&(a.value=t.length>0?t[0]:null)},{deep:!0});const o=xt({visible:!1,x:0,y:0,skill:null,skillId:null});let i=null;const c=()=>{o.visible=!1,o.skill=null,o.skillId=null},d=()=>{i&&(clearTimeout(i),i=null)},u=xt({visible:!1,skill:null,skillId:null}),p=()=>{u.visible=!1,u.skill=null,u.skillId=null};ms(()=>{d()}),_a(()=>e.visible,e=>{e||(c(),p())});return{selectedId:a,selectedSkill:l,selectSkill:e=>{a.value=e},activeCategory:s,categories:[{key:'all',icon:'📋',label:'全部'},{key:'active',icon:'⚡',label:'主动'},{key:'passive',icon:'📖',label:'被动'}],getCategoryCount:t=>{const a=Object.entries(e.skills);return'all'===t?a.length:'passive'===t?a.filter(([,e])=>n(e)).length:a.filter(([,e])=>!n(e)).length},filteredSkills:r,setCategory:e=>{s.value=e},getSkillMpCost:e=>{if(!e.cost)return 0;const t=e.cost;return'mp'===t.type?t.val||0:t.mp||0},getSkillSpCost:e=>{if(!e.cost)return 0;const t=e.cost;return'sp'===t.type?t.val||0:t.sp||0},getTagName:e=>{const t=Xl(e);return`${t.icon}${t.name}`},getTagColor:Zl,getSkillDescription:e=>Ao(e),getEffectPreview:e=>To(e),contextMenu:o,showContextMenu:(e,t,a)=>{const s=document.querySelector('.skills-modal');if(s){const t=s.getBoundingClientRect();o.x=e.clientX-t.left,o.y=e.clientY-t.top}else o.x=e.clientX,o.y=e.clientY;o.skill=t,o.skillId=a,o.visible=!0},hideContextMenu:c,startLongPress:(e,t,a)=>{const s=a.touches[0];i=setTimeout(()=>{((e,t,a)=>{const s=document.querySelector('.skills-modal');if(s){const t=s.getBoundingClientRect();o.x=e.clientX-t.left,o.y=e.clientY-t.top}else o.x=e.clientX,o.y=e.clientY;o.skill=t,o.skillId=a,o.visible=!0})(s,e,t),navigator.vibrate&&navigator.vibrate(50)},500)},cancelLongPress:d,forgetConfirm:u,confirmForgetSkill:()=>{o.skill?.unforgettable||(u.skill=o.skill,u.skillId=o.skillId,u.visible=!0,c())},cancelForget:p,executeForget:()=>{if(!u.skill||!u.skillId)return;const e=Ll.serviceLocator.get('SaveService'),s=e.getGameState();if(!s)return void p();const n=u.skillId,r=u.skill.name;if(s.skills[n]){if(delete s.skills[n],e.saveData(),a.value===n){const e=Object.keys(s.skills);a.value=e.length>0?e[0]:null}t('skill-forgotten',{id:n,name:r})}p()}}}}),qE=(0,$u.A)(OE,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'modal-backdrop',onClick:t[10]||(t[10]=Cl(t=>e.$emit('close'),['self']))},[Rn(' 背景效果层 '),t[26]||(t[26]=Mn('div',{class:'modal-vignette'},null,-1)),t[27]||(t[27]=Mn('div',{class:'modal-noise'},null,-1)),Mn('div',GM,[Rn(' Header '),Mn('div',zM,[Rn(' 装饰线 '),t[13]||(t[13]=Mn('div',{class:'header-deco-line top'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',WM,[t[12]||(t[12]=Mn('div',{class:'header-title-group'},[Mn('span',{class:'header-icon'},'⚡'),Mn('h3',{class:'header-title'},'技能列表')],-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[11]||(t[11]=[Mn('span',{class:'close-icon'},'✕',-1)])])])]),Rn(' Category Filter '),Mn('div',QM,[(yn(!0),Sn(pn,null,xs(e.categories,t=>(yn(),Sn('button',{key:t.key,class:ee(['filter-btn',{active:e.activeCategory===t.key}]),onClick:a=>e.setCategory(t.key)},[Mn('span',YM,oe(t.icon),1),Mn('span',KM,oe(t.label),1),Mn('span',JM,oe(e.getCategoryCount(t.key)),1)],10,XM))),128))]),Rn(' Skill Details Section '),Mn('div',ZM,[e.selectedSkill?(yn(),Sn(pn,{key:0},[Rn(' Row 1: Name + Type '),Mn('div',eE,[Mn('h3',tE,oe(e.selectedSkill.name),1),Mn('div',aE,[(yn(!0),Sn(pn,null,xs((e.selectedSkill.tags||[]).slice(0,4),t=>(yn(),Sn('span',{key:t,class:'detail-tag rounded px-1.5',style:X({backgroundColor:e.getTagColor(t),color:'white',textShadow:'0 1px 2px rgba(0, 0, 0, 0.5)'})},oe(e.getTagName(t)),5))),128)),e.selectedSkill.tags?.length?Rn('v-if',!0):(yn(),Sn('span',sE,' 通用技能 '))])]),Rn(' Row 2: Cost & Cooldown '),Mn('div',nE,[e.getSkillMpCost(e.selectedSkill)>0?(yn(),Sn('span',rE,' 💙 '+oe(e.getSkillMpCost(e.selectedSkill))+' MP ',1)):Rn('v-if',!0),e.getSkillSpCost(e.selectedSkill)>0?(yn(),Sn('span',lE,' 💚 '+oe(e.getSkillSpCost(e.selectedSkill))+' SP ',1)):Rn('v-if',!0),e.selectedSkill.cooldown&&e.selectedSkill.cooldown>0?(yn(),Sn('span',oE,' ⏱️ CD '+oe(e.selectedSkill.cooldown)+' 回合 ',1)):Rn('v-if',!0),e.selectedSkill.currentCooldown&&e.selectedSkill.currentCooldown>0?(yn(),Sn('span',iE,' 冷却中: '+oe(e.selectedSkill.currentCooldown),1)):Rn('v-if',!0),e.getSkillMpCost(e.selectedSkill)||e.getSkillSpCost(e.selectedSkill)||e.selectedSkill.cooldown?Rn('v-if',!0):(yn(),Sn('span',cE,' 无消耗 '))]),Rn(' Row 3: Description '),Mn('div',dE,[Mn('p',uE,oe(e.selectedSkill.description||e.getSkillDescription(e.selectedSkill)),1)]),Rn(' Row 4: Effects Preview '),e.selectedSkill.effects?.length?(yn(),Sn('div',pE,[t[14]||(t[14]=Mn('div',{class:'mb-1 text-[9px] font-bold text-gray-500 sm:text-[10px]'},'技能效果',-1)),Mn('div',mE,[(yn(!0),Sn(pn,null,xs(e.selectedSkill.effects,(t,a)=>(yn(),Sn('span',{key:a,class:'effect-tag'},oe(e.getEffectPreview(t)),1))),128))])])):Rn('v-if',!0)],64)):(yn(),Sn('div',gE,' 选择一个技能查看详情 '))]),Rn(' Skills List '),Mn('div',hE,[0===Object.keys(e.skills).length?(yn(),Sn('div',fE,' 暂无已学习的技能 ')):(yn(),Sn('div',vE,[(yn(!0),Sn(pn,null,xs(e.filteredSkills,(a,s)=>(yn(),Sn('div',{key:s,class:ee(['skill-list-item',[{selected:e.selectedId===String(s)},{disabled:a.currentCooldown&&a.currentCooldown>0}]]),onClick:t=>e.selectSkill(String(s)),onContextmenu:Cl(t=>e.showContextMenu(t,a,String(s)),['prevent']),onTouchstart:t=>e.startLongPress(a,String(s),t),onTouchend:t[1]||(t[1]=(...t)=>e.cancelLongPress&&e.cancelLongPress(...t)),onTouchmove:t[2]||(t[2]=(...t)=>e.cancelLongPress&&e.cancelLongPress(...t))},[Rn(' Name + Cost on same line, Tags below '),Mn('div',bE,[Mn('div',xE,[Mn('span',wE,[Pn(oe(a.name)+' ',1),a.currentCooldown&&a.currentCooldown>0?(yn(),Sn('span',kE,' (冷却: '+oe(a.currentCooldown)+') ',1)):Rn('v-if',!0)]),Mn('span',SE,[e.getSkillMpCost(a)>0?(yn(),Sn('span',_E,'💙'+oe(e.getSkillMpCost(a)),1)):Rn('v-if',!0),e.getSkillSpCost(a)>0?(yn(),Sn('span',CE,'💚'+oe(e.getSkillSpCost(a)),1)):Rn('v-if',!0),a.cooldown&&a.cooldown>0?(yn(),Sn('span',IE,'⏱️'+oe(a.cooldown),1)):Rn('v-if',!0)])]),Mn('div',TE,[(yn(!0),Sn(pn,null,xs((a.tags||[]).slice(0,3),t=>(yn(),Sn('span',{key:t,class:'skill-list-tag',style:X({backgroundColor:e.getTagColor(t),color:'white',textShadow:'0 1px 2px rgba(0, 0, 0, 0.5)'})},oe(e.getTagName(t)),5))),128)),a.tags?.length?Rn('v-if',!0):(yn(),Sn('span',AE,'通用技能'))])]),Rn(' Right: Arrow indicator '),t[15]||(t[15]=Mn('div',{class:'skill-list-arrow'},'›',-1))],42,yE))),128))]))]),Rn(' Footer '),Mn('div',ME,[Rn(' 装饰线 '),t[19]||(t[19]=Mn('div',{class:'footer-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',EE,[Mn('span',$E,[t[16]||(t[16]=Mn('span',{class:'info-diamond'},'◆',-1)),Pn(' 已学习: '+oe(Object.keys(e.skills).length)+' 技能 ',1),t[17]||(t[17]=Mn('span',{class:'info-diamond'},'◆',-1))]),Mn('button',{class:'footer-btn',onClick:t[3]||(t[3]=t=>e.$emit('close'))},[...t[18]||(t[18]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'关闭',-1)])])])])]),Rn(' 右键/长按上下文菜单 '),En(wr,{name:'context-menu-fade'},{default:ba(()=>[e.contextMenu.visible?(yn(),Sn('div',{key:0,class:'context-menu',style:X({top:e.contextMenu.y+'px',left:e.contextMenu.x+'px'}),onClick:t[5]||(t[5]=Cl(()=>{},['stop']))},[Mn('div',DE,[Mn('span',PE,oe(e.contextMenu.skill?.icon||'⚡'),1),Mn('span',NE,oe(e.contextMenu.skill?.name),1)]),t[21]||(t[21]=Mn('div',{class:'context-menu-divider'},null,-1)),Mn('button',{class:'context-menu-item danger',disabled:e.contextMenu.skill?.unforgettable,onClick:t[4]||(t[4]=(...t)=>e.confirmForgetSkill&&e.confirmForgetSkill(...t))},[t[20]||(t[20]=Mn('span',{class:'context-menu-item-icon'},'🗑️',-1)),Mn('span',null,oe(e.contextMenu.skill?.unforgettable?'不可遗忘':'遗忘技能'),1)],8,RE)],4)):Rn('v-if',!0)]),_:1}),Rn(' 遗忘确认对话框 '),En(wr,{name:'confirm-fade'},{default:ba(()=>[e.forgetConfirm.visible?(yn(),Sn('div',{key:0,class:'confirm-overlay',onClick:t[8]||(t[8]=Cl((...t)=>e.cancelForget&&e.cancelForget(...t),['self']))},[Mn('div',jE,[t[25]||(t[25]=Mn('div',{class:'confirm-header'},[Mn('span',{class:'confirm-icon'},'⚠️'),Mn('span',{class:'confirm-title'},'确认遗忘技能')],-1)),Mn('div',LE,[Mn('p',null,[t[22]||(t[22]=Pn(' 确定要遗忘技能 ',-1)),Mn('strong',null,oe(e.forgetConfirm.skill?.name),1),t[23]||(t[23]=Pn(' 吗？ ',-1))]),t[24]||(t[24]=Mn('p',{class:'confirm-warning'},'此操作不可撤销！',-1))]),Mn('div',BE,[Mn('button',{class:'confirm-btn cancel',onClick:t[6]||(t[6]=(...t)=>e.cancelForget&&e.cancelForget(...t))},'取消'),Mn('button',{class:'confirm-btn danger',onClick:t[7]||(t[7]=(...t)=>e.executeForget&&e.executeForget(...t))},'确认遗忘')])])])):Rn('v-if',!0)]),_:1}),Rn(' 点击其他区域关闭上下文菜单 '),e.contextMenu.visible?(yn(),Sn('div',{key:0,class:'context-menu-backdrop',onClick:t[9]||(t[9]=(...t)=>e.hideContextMenu&&e.hideContextMenu(...t))})):Rn('v-if',!0)])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-5306bc95']]),UE=qE,VE={class:'shop-modal'},FE={class:'modal-header'},HE={class:'header-content'},GE={class:'header-title-group'},zE={class:'header-info'},WE={class:'header-title'},QE={key:0,class:'header-rates'},XE={class:'rate-item buy'},YE={class:'rate-item sell'},KE={class:'wallet-section'},JE={class:'wallet-content'},ZE={class:'wallet-amount'},e$={class:'tabs-container'},t$={key:0,class:'detail-section'},a$={class:'detail-content'},s$={class:'item-icon-wrapper'},n$={class:'item-icon'},r$={class:'item-info'},l$={class:'item-name'},o$={class:'item-meta'},i$={class:'item-type'},c$={key:0,class:'item-desc'},d$={class:'detail-actions'},u$={class:'price-info'},p$={class:'price-label'},m$={key:0,class:'action-group'},g$={key:0,class:'stock-info'},h$=['disabled'],f$={key:1,class:'action-group'},v$={class:'stock-info'},y$=['disabled'],b$={class:'items-list custom-scrollbar'},x$={key:0,class:'empty-state'},w$={key:1,class:'items-grid'},k$=['onClick'],S$={class:'item-left'},_$={class:'item-emoji'},C$={class:'item-details'},I$={class:'item-card-name'},T$={class:'item-stock'},A$={key:1,class:'sold-out'},M$={class:'item-right'},E$={class:'item-price amber'},$$={key:0,class:'cannot-afford'},D$={key:0,class:'empty-state'},P$={key:1,class:'items-grid'},N$=['onClick'],R$={class:'item-left'},j$={class:'item-emoji'},L$={class:'item-details'},B$={class:'item-card-name'},O$={class:'item-stock'},q$={class:'item-right'},U$={class:'item-price green'},V$={class:'modal-footer'},F$={class:'footer-content'},H$={class:'footer-info'};const G$=Za({name:'ShopModal',props:{visible:{type:Boolean,default:!1},shop:{type:Object,default:null},wallet:{type:Number,default:0},inventory:{type:Object,default:()=>({})}},emits:['close','buy','sell'],setup(e,{emit:t}){const a=$t('buy'),s=$t(null),n=ir(()=>o(e.wallet)),r=ir(()=>e.shop?.items?Object.entries(e.shop.items).map(([e,t])=>({...t,id:e})):[]),l=ir(()=>e.inventory?Object.entries(e.inventory).filter(([_,e])=>e&&e.count>0&&'quest'!==e.type).map(([e,t])=>({...t,id:e})):[]);function o(e){if(e>=1e4){const t=Math.floor(e/1e4),a=Math.floor(e%1e4/100),s=e%100;return 0===a&&0===s?`${t}金`:0===s?`${t}金${a}银`:`${t}金${a}银${s}铜`}if(e>=100){const t=Math.floor(e/100),a=e%100;return 0===a?`${t}银`:`${t}银${a}铜`}return`${e}铜`}function i(t){const a=t.price,s=e.shop?.buy_rate??1;return Math.ceil(a*s)}function c(t){const a=t.value??0,s=e.shop?.sell_rate??.5;return Math.floor(a*s)}function d(t){return e.wallet>=i(t)}function u(e){return(-1===e.stock||e.stock>0)&&d(e)}function p(e){return e.count>0&&c(e)>0}return _a(()=>e.visible,e=>{e||(s.value=null,a.value='buy')}),_a(a,()=>{s.value=null}),{activeTab:a,selectedItem:s,formattedWallet:n,shopItemsList:r,sellableItems:l,formatPrice:o,getBuyPrice:i,getSellPrice:c,getDisplayPrice:function(e){return'buy'===a.value?i(e):c(e)},canAfford:d,canBuy:u,canSell:p,isShopItem:function(e){return null!==e&&'price'in e&&'stock'in e},isInventoryItem:function(e){return null!==e&&'count'in e&&!('stock'in e)},getItemEmoji:function(e){return e.emoji||'📦'},selectItem:function(e){s.value=e},handleBuy:function(e){u(e)&&t('buy',{itemId:e.id,itemName:e.name,price:i(e),quantity:1})},handleSell:function(e){p(e)&&t('sell',{itemId:e.id,itemName:e.name,price:c(e),quantity:1})},getQualityClass:function(e){const t={Common:'quality-common',Uncommon:'quality-uncommon',Rare:'quality-rare',Epic:'quality-epic',Legendary:'quality-legendary',Mythic:'quality-mythic'};return t[e||'Common']||t.Common},getQualityName:function(e){return{Common:'普通',Uncommon:'优秀',Rare:'稀有',Epic:'史诗',Legendary:'传说',Mythic:'神话'}[e||'Common']||'普通'},getTypeName:function(e){return{weapon:'武器',armor:'防具',accessory:'饰品',consumable:'消耗品',material:'材料',quest:'任务物品',misc:'杂物'}[e||'misc']||'物品'}}}}),z$=(0,$u.A)(G$,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'modal-backdrop',onClick:t[6]||(t[6]=Cl(t=>e.$emit('close'),['self']))},[Rn(' 背景效果层 '),t[25]||(t[25]=Mn('div',{class:'modal-vignette'},null,-1)),t[26]||(t[26]=Mn('div',{class:'modal-noise'},null,-1)),Mn('div',VE,[Rn(' Header '),Mn('div',FE,[t[10]||(t[10]=Mn('div',{class:'header-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',HE,[Mn('div',GE,[t[8]||(t[8]=Mn('span',{class:'header-icon'},'🛒',-1)),Mn('div',zE,[Mn('h3',WE,oe(e.shop?.merchant_name||'商店'),1),e.shop?(yn(),Sn('div',QE,[Mn('span',XE,'买入 '+oe(Math.round(100*e.shop.buy_rate))+'%',1),t[7]||(t[7]=Mn('span',{class:'rate-divider'},'•',-1)),Mn('span',YE,'卖出 '+oe(Math.round(100*e.shop.sell_rate))+'%',1)])):Rn('v-if',!0)])]),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[9]||(t[9]=[Mn('span',{class:'close-icon'},'✕',-1)])])])]),Rn(' Player Wallet '),Mn('div',KE,[Mn('div',JE,[t[11]||(t[11]=Mn('span',{class:'wallet-label'},[Mn('span',{class:'wallet-icon'},'💰'),Pn(' 我的钱包 ')],-1)),Mn('span',ZE,oe(e.formattedWallet),1)])]),Rn(' Tabs '),Mn('div',e$,[Mn('button',{class:ee(['tab-btn',{active:'buy'===e.activeTab,'accent-amber':'buy'===e.activeTab}]),onClick:t[1]||(t[1]=t=>e.activeTab='buy')},[...t[12]||(t[12]=[Mn('span',{class:'tab-icon'},'🛍️',-1),Mn('span',{class:'tab-text'},'购买商品',-1)])],2),Mn('button',{class:ee(['tab-btn',{active:'sell'===e.activeTab,'accent-green':'sell'===e.activeTab}]),onClick:t[2]||(t[2]=t=>e.activeTab='sell')},[...t[13]||(t[13]=[Mn('span',{class:'tab-icon'},'💎',-1),Mn('span',{class:'tab-text'},'出售物品',-1)])],2)]),Rn(' Item Detail Section '),e.selectedItem?(yn(),Sn('div',t$,[Mn('div',a$,[Mn('div',s$,[Mn('span',n$,oe(e.getItemEmoji(e.selectedItem)),1)]),Mn('div',r$,[Mn('h4',l$,oe(e.selectedItem.name),1),Mn('div',o$,[Mn('span',{class:ee(['quality-badge',e.getQualityClass(e.selectedItem.quality)])},oe(e.getQualityName(e.selectedItem.quality)),3),Mn('span',i$,oe(e.getTypeName(e.selectedItem.type)),1)]),e.selectedItem.desc?(yn(),Sn('p',c$,oe(e.selectedItem.desc),1)):Rn('v-if',!0)])]),Mn('div',d$,[Mn('div',u$,[Mn('span',p$,oe('buy'===e.activeTab?'购买价格:':'出售价格:'),1),Mn('span',{class:ee(['price-value','buy'===e.activeTab?'amber':'green'])},oe(e.formatPrice(e.getDisplayPrice(e.selectedItem))),3)]),'buy'===e.activeTab&&e.isShopItem(e.selectedItem)?(yn(),Sn('div',m$,[-1!==e.selectedItem.stock?(yn(),Sn('span',g$,'库存: '+oe(e.selectedItem.stock),1)):Rn('v-if',!0),Mn('button',{class:'action-btn buy',disabled:!e.canBuy(e.selectedItem),onClick:t[3]||(t[3]=t=>e.handleBuy(e.selectedItem))},[...t[14]||(t[14]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'购买',-1)])],8,h$)])):'sell'===e.activeTab&&e.isInventoryItem(e.selectedItem)?(yn(),Sn('div',f$,[Mn('span',v$,'拥有: '+oe(e.selectedItem.count),1),Mn('button',{class:'action-btn sell',disabled:!e.canSell(e.selectedItem),onClick:t[4]||(t[4]=t=>e.handleSell(e.selectedItem))},[...t[15]||(t[15]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'出售',-1)])],8,y$)])):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' Items List '),Mn('div',b$,['buy'===e.activeTab?(yn(),Sn(pn,{key:0},[e.shop?.items&&0!==Object.keys(e.shop.items).length?(yn(),Sn('div',w$,[(yn(!0),Sn(pn,null,xs(e.shopItemsList,a=>(yn(),Sn('div',{key:a.id,class:ee(['shop-item-card',{selected:e.selectedItem?.id===a.id,'out-of-stock':0===a.stock}]),onClick:t=>e.selectItem(a)},[Mn('div',S$,[Mn('span',_$,oe(e.getItemEmoji(a)),1),Mn('div',C$,[Mn('span',I$,oe(a.name),1),Mn('span',T$,[-1===a.stock?(yn(),Sn(pn,{key:0},[Pn('♾️ 无限')],64)):0===a.stock?(yn(),Sn('span',A$,'售罄')):(yn(),Sn(pn,{key:2},[Pn('库存 '+oe(a.stock),1)],64))])])]),Mn('div',M$,[Mn('span',E$,oe(e.formatPrice(e.getBuyPrice(a))),1),e.canAfford(a)?Rn('v-if',!0):(yn(),Sn('span',$$,'余额不足'))]),t[17]||(t[17]=Mn('div',{class:'item-arrow'},'›',-1))],10,k$))),128))])):(yn(),Sn('div',x$,[...t[16]||(t[16]=[Mn('span',{class:'empty-icon'},'🏪',-1),Mn('span',{class:'empty-text'},'商店暂无商品',-1)])]))],64)):(yn(),Sn(pn,{key:1},[0===e.sellableItems.length?(yn(),Sn('div',D$,[...t[18]||(t[18]=[Mn('span',{class:'empty-icon'},'📦',-1),Mn('span',{class:'empty-text'},'没有可出售的物品',-1)])])):(yn(),Sn('div',P$,[(yn(!0),Sn(pn,null,xs(e.sellableItems,a=>(yn(),Sn('div',{key:a.id,class:ee(['shop-item-card',{selected:e.selectedItem?.id===a.id}]),onClick:t=>e.selectItem(a)},[Mn('div',R$,[Mn('span',j$,oe(a.emoji||'📦'),1),Mn('div',L$,[Mn('span',B$,oe(a.name),1),Mn('span',O$,[Pn(' 拥有 '+oe(a.count)+' ',1),Mn('span',{class:ee(['quality-tag',e.getQualityClass(a.quality)])},oe(e.getQualityName(a.quality)),3)])])]),Mn('div',q$,[Mn('span',U$,oe(e.formatPrice(e.getSellPrice(a))),1),t[19]||(t[19]=Mn('span',{class:'price-note'},'单价',-1))]),t[20]||(t[20]=Mn('div',{class:'item-arrow'},'›',-1))],10,N$))),128))]))],64))]),Rn(' Footer '),Mn('div',V$,[t[24]||(t[24]=Mn('div',{class:'footer-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',F$,[Mn('span',H$,[t[21]||(t[21]=Mn('span',{class:'info-diamond'},'◆',-1)),Pn(' '+oe('buy'===e.activeTab?`${e.shop?.items?.length||0} 种商品`:`${e.sellableItems.length} 种可出售`)+' ',1),t[22]||(t[22]=Mn('span',{class:'info-diamond'},'◆',-1))]),Mn('button',{class:'footer-btn',onClick:t[5]||(t[5]=t=>e.$emit('close'))},[...t[23]||(t[23]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'关闭',-1)])])])])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-70a38537']]),W$={class:'adventure-notes-modal flex h-[85vh] w-full max-w-4xl flex-col overflow-hidden rounded-lg shadow-2xl'},Q$={class:'modal-header relative z-10 px-4 py-3'},X$={class:'flex items-center justify-between'},Y$={class:'flex items-center gap-2'},K$={class:'record-badge ml-2 px-2 py-0.5 text-xs'},J$={class:'tab-navigation relative z-10 flex shrink-0'},Z$={key:0,class:'pending-badge ml-1 px-1.5 text-xs'},eD={class:'modal-content relative z-10 flex-1 overflow-hidden'},tD={key:0,class:'custom-scrollbar h-full overflow-y-auto p-4'},aD={class:'content-card mb-4 rounded-lg p-4'},sD={class:'grid gap-4 md:grid-cols-3'},nD={class:'stat-card rounded p-3 text-center'},rD={class:'stat-value amber text-2xl font-bold'},lD={class:'stat-card rounded p-3 text-center'},oD={class:'stat-value green text-2xl font-bold'},iD={class:'stat-card rounded p-3 text-center'},cD={class:'stat-value orange text-2xl font-bold'},dD={class:'mt-4'},uD={class:'progress-header mb-1 flex items-center justify-between text-xs'},pD={class:'progress-bar-bg h-2 overflow-hidden rounded-full'},mD={class:'progress-hint mt-1 text-xs'},gD={class:'mb-4 flex flex-wrap gap-2'},hD=['disabled'],fD={key:0,class:'animate-spin'},vD={key:1},yD={class:'btn-content'},bD={class:'content-card rounded-lg p-4'},xD={class:'flex items-center gap-4'},wD={key:1,class:'custom-scrollbar h-full overflow-y-auto p-4'},kD={key:0,class:'empty-state py-12 text-center'},SD={class:'empty-hint mt-1 text-xs'},_D={key:1,class:'space-y-3'},CD={class:'block-header flex items-center justify-between p-3'},ID={class:'flex items-center gap-2'},TD={class:'block-title text-sm font-medium'},AD={class:'block-meta text-xs'},MD={class:'flex items-center gap-2'},ED=['disabled','onClick'],$D=['onClick'],DD=['onClick'],PD=['onClick'],ND={key:0,class:'block-content p-3'},RD={key:0,class:'space-y-2'},jD={class:'flex gap-2'},LD=['onClick'],BD={class:'summary-text text-sm whitespace-pre-wrap'},OD={key:2,class:'error-text text-sm'},qD={key:3,class:'loading-text flex items-center gap-2 text-sm'},UD={key:4,class:'placeholder-text text-sm italic'},VD={key:5,class:'summary-time mt-2 text-xs'},FD={key:2,class:'flex h-full flex-col p-4'},HD={class:'notes-footer mt-2 flex items-center justify-between text-xs'},GD={key:0,class:'saved-indicator'};const zD=Za({name:'AdventureNotesModal',props:{visible:{type:Boolean,default:!1}},emits:['close'],setup(e){const t=$t('overview'),a=$t(!1),s=$t(new Set),n=$t(''),r=$t(!1),l=$t(50),o=$t(null),i=$t(''),c=$t({totalAIMessages:0,completedBlocks:0,pendingBlocks:0,currentBlockProgress:0,needsSummarization:!1,blocks:[]});let d=null;const u=async()=>{d&&(c.value=await d.checkBlocks(),l.value=d.getAdventureNotes().messagesPerBlock||50)},p=async()=>{d=ji();try{d.init()}catch{}await u(),n.value=d.getUserNotes()};return _a(()=>e.visible,async e=>{e&&await p()}),us(async()=>{e.visible&&await p()}),{activeTab:t,isSummarizing:a,expandedBlocks:s,userNotes:n,notesSaved:r,messagesPerBlock:l,blockStatus:c,editingBlockId:o,editingContent:i,getStatusText:e=>{switch(e){case'completed':return'✅ 已完成';case'pending':return'⏳ 待处理';case'summarizing':return'🔄 处理中';case'error':return'❌ 错误';default:return e}},formatDate:e=>new Date(e).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),toggleBlockExpand:e=>{s.value.has(e)?s.value.delete(e):s.value.add(e)},refreshBlocks:u,summarizeBlock:async e=>{if(d&&!a.value){a.value=!0;try{await d.generateSummary(e),await u()}finally{a.value=!1}}},summarizeAllPending:async()=>{if(d&&!a.value){a.value=!0;try{await d.summarizeAllPending(),await u()}finally{a.value=!1}}},resetBlock:async e=>{d&&(d.resetBlock(e),await u())},saveUserNotes:()=>{d&&(d.updateUserNotes(n.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3))},updateMessagesPerBlock:()=>{d&&d.setMessagesPerBlock(l.value)},editBlock:e=>{if(!d)return;const t=d.getAdventureNotes().blocks.find(t=>t.blockId===e);t&&t.summary&&(o.value=e,i.value=t.summary,s.value.has(e)||s.value.add(e))},saveEdit:e=>{d&&(d.updateBlockSummary(e,i.value),o.value=null,i.value='',u())},cancelEdit:()=>{o.value=null,i.value=''}}}}),WD=(0,$u.A)(zD,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'adventure-notes-backdrop fixed inset-0 z-80 flex items-center justify-center p-4',onClick:t[12]||(t[12]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',W$,[Rn(' 背景层 '),t[39]||(t[39]=Mn('div',{class:'modal-bg-layer'},null,-1)),t[40]||(t[40]=Mn('div',{class:'modal-noise'},null,-1)),Rn(' Header '),Mn('div',Q$,[Rn(' 顶部装饰线 '),t[16]||(t[16]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',X$,[Mn('div',Y$,[t[13]||(t[13]=Mn('span',{class:'header-icon text-xl'},'📖',-1)),t[14]||(t[14]=Mn('h2',{class:'header-title text-lg font-bold tracking-wider'},'冒险笔记',-1)),Mn('span',K$,oe(e.blockStatus.totalAIMessages)+' 条记录 ',1)]),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[15]||(t[15]=[Mn('span',null,'✕',-1)])])]),Rn(' 底部装饰线 '),t[17]||(t[17]=Mn('div',{class:'header-deco-line mt-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1))]),Rn(' Tab Navigation '),Mn('div',J$,[Mn('button',{class:ee(['tab-btn flex items-center gap-1.5 px-4 py-2 text-sm transition-all',{active:'overview'===e.activeTab}]),onClick:t[1]||(t[1]=t=>e.activeTab='overview')},[...t[18]||(t[18]=[Mn('span',null,'📊',-1),Mn('span',null,'总览',-1)])],2),Mn('button',{class:ee(['tab-btn flex items-center gap-1.5 px-4 py-2 text-sm transition-all',{active:'summaries'===e.activeTab}]),onClick:t[2]||(t[2]=t=>e.activeTab='summaries')},[t[19]||(t[19]=Mn('span',null,'📜',-1)),t[20]||(t[20]=Mn('span',null,'章节总结',-1)),e.blockStatus.pendingBlocks>0?(yn(),Sn('span',Z$,oe(e.blockStatus.pendingBlocks),1)):Rn('v-if',!0)],2),Mn('button',{class:ee(['tab-btn flex items-center gap-1.5 px-4 py-2 text-sm transition-all',{active:'notes'===e.activeTab}]),onClick:t[3]||(t[3]=t=>e.activeTab='notes')},[...t[21]||(t[21]=[Mn('span',null,'✏️',-1),Mn('span',null,'个人笔记',-1)])],2)]),Rn(' Content Area '),Mn('div',eD,[Rn(' Overview Tab '),'overview'===e.activeTab?(yn(),Sn('div',tD,[Rn(' Progress Card '),Mn('div',aD,[t[26]||(t[26]=Mn('h3',{class:'section-title mb-3 text-sm font-medium'},'📈 冒险进度',-1)),Mn('div',sD,[Mn('div',nD,[Mn('div',rD,oe(e.blockStatus.totalAIMessages),1),t[22]||(t[22]=Mn('div',{class:'stat-label text-xs'},'AI回复总数',-1))]),Mn('div',lD,[Mn('div',oD,oe(e.blockStatus.completedBlocks),1),t[23]||(t[23]=Mn('div',{class:'stat-label text-xs'},'已总结章节',-1))]),Mn('div',iD,[Mn('div',cD,oe(e.blockStatus.pendingBlocks),1),t[24]||(t[24]=Mn('div',{class:'stat-label text-xs'},'待总结章节',-1))])]),Rn(' Current Block Progress '),Mn('div',dD,[Mn('div',uD,[t[25]||(t[25]=Mn('span',null,'当前章节进度',-1)),Mn('span',null,oe(e.blockStatus.currentBlockProgress)+' / '+oe(e.messagesPerBlock),1)]),Mn('div',pD,[Mn('div',{class:'progress-bar-fill h-full rounded-full transition-all',style:X({width:e.blockStatus.currentBlockProgress/e.messagesPerBlock*100+'%'})},null,4)]),Mn('div',mD,' 还需 '+oe(e.messagesPerBlock-e.blockStatus.currentBlockProgress)+' 条回复形成新章节 ',1)])]),Rn(' Action Buttons '),Mn('div',gD,[Mn('button',{class:'action-btn primary flex items-center gap-1.5 rounded px-4 py-2 text-sm transition-all disabled:cursor-not-allowed disabled:opacity-50',disabled:0===e.blockStatus.pendingBlocks||e.isSummarizing,onClick:t[4]||(t[4]=(...t)=>e.summarizeAllPending&&e.summarizeAllPending(...t))},[t[27]||(t[27]=Mn('span',{class:'btn-glow'},null,-1)),e.isSummarizing?(yn(),Sn('span',fD,'⏳')):(yn(),Sn('span',vD,'✨')),Mn('span',yD,oe(e.isSummarizing?'正在总结...':'总结所有待处理章节'),1)],8,hD),Mn('button',{class:'action-btn secondary flex items-center gap-1.5 rounded px-4 py-2 text-sm transition-all',onClick:t[5]||(t[5]=(...t)=>e.refreshBlocks&&e.refreshBlocks(...t))},[...t[28]||(t[28]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',null,'🔄',-1),Mn('span',{class:'btn-content'},'刷新状态',-1)])])]),Rn(' Settings '),Mn('div',bD,[t[31]||(t[31]=Mn('h3',{class:'section-title mb-3 text-sm font-medium'},'⚙️ 设置',-1)),Mn('div',xD,[t[29]||(t[29]=Mn('label',{class:'settings-label text-xs'},'每章节消息数',-1)),xa(Mn('input',{'onUpdate:modelValue':t[6]||(t[6]=t=>e.messagesPerBlock=t),type:'number',min:'10',max:'100',class:'settings-input w-20 rounded px-2 py-1 text-sm',onChange:t[7]||(t[7]=(...t)=>e.updateMessagesPerBlock&&e.updateMessagesPerBlock(...t))},null,544),[[fl,e.messagesPerBlock,void 0,{number:!0}]]),t[30]||(t[30]=Mn('span',{class:'settings-hint text-xs'},'（建议 30-50）',-1))])])])):Rn('v-if',!0),Rn(' Summaries Tab '),'summaries'===e.activeTab?(yn(),Sn('div',wD,[0===e.blockStatus.blocks.length?(yn(),Sn('div',kD,[t[32]||(t[32]=Mn('div',{class:'mb-2 text-4xl'},'📭',-1)),t[33]||(t[33]=Mn('div',{class:'empty-title'},'还没有可以总结的章节',-1)),Mn('div',SD,' 继续冒险，累积 '+oe(e.messagesPerBlock)+' 条AI回复后会自动生成章节 ',1)])):(yn(),Sn('div',_D,[(yn(!0),Sn(pn,null,xs(e.blockStatus.blocks,a=>(yn(),Sn('div',{key:a.blockId,class:ee(['block-card rounded-lg transition-all','status-'+a.status])},[Rn(' Block Header '),Mn('div',CD,[Mn('div',ID,[Mn('span',{class:ee(['status-badge rounded px-2 py-0.5 text-xs font-medium','status-'+a.status])},oe(e.getStatusText(a.status)),3),Mn('span',TD,'章节 '+oe(a.blockId),1),Mn('span',AD,' ('+oe(a.messageCount)+' 条消息, ID: '+oe(a.startMsgId)+'-'+oe(a.endMsgId)+') ',1)]),Mn('div',MD,['pending'===a.status||'error'===a.status?(yn(),Sn('button',{key:0,class:'block-action-btn primary rounded px-2 py-1 text-xs disabled:opacity-50',disabled:e.isSummarizing,onClick:t=>e.summarizeBlock(a.blockId)},' 生成总结 ',8,ED)):Rn('v-if',!0),'completed'===a.status?(yn(),Sn('button',{key:1,class:'block-action-btn secondary rounded px-2 py-1 text-xs',onClick:t=>e.editBlock(a.blockId)},' 编辑 ',8,$D)):Rn('v-if',!0),'completed'===a.status?(yn(),Sn('button',{key:2,class:'block-action-btn secondary rounded px-2 py-1 text-xs',onClick:t=>e.resetBlock(a.blockId)},' 重新生成 ',8,DD)):Rn('v-if',!0),Mn('button',{class:'expand-btn',onClick:t=>e.toggleBlockExpand(a.blockId)},[(yn(),Sn('svg',{class:ee(['h-4 w-4 transition-transform',{'rotate-180':e.expandedBlocks.has(a.blockId)}]),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[...t[34]||(t[34]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 9l-7 7-7-7'},null,-1)])],2))],8,PD)])]),Rn(' Block Content (Expandable) '),En(wr,{name:'expand'},{default:ba(()=>[e.expandedBlocks.has(a.blockId)?(yn(),Sn('div',ND,[Rn(' 编辑模式 '),e.editingBlockId===a.blockId?(yn(),Sn('div',RD,[xa(Mn('textarea',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.editingContent=t),class:'notes-textarea custom-scrollbar w-full resize-none rounded-lg p-3 text-sm',rows:'10',placeholder:'编辑章节总结...'},null,512),[[fl,e.editingContent]]),Mn('div',jD,[Mn('button',{class:'action-btn primary flex items-center gap-1.5 rounded px-3 py-1.5 text-xs',onClick:t=>e.saveEdit(a.blockId)},[...t[35]||(t[35]=[Mn('span',null,'💾',-1),Mn('span',null,'保存',-1)])],8,LD),Mn('button',{class:'action-btn secondary flex items-center gap-1.5 rounded px-3 py-1.5 text-xs',onClick:t[9]||(t[9]=(...t)=>e.cancelEdit&&e.cancelEdit(...t))},[...t[36]||(t[36]=[Mn('span',null,'✕',-1),Mn('span',null,'取消',-1)])])])])):'completed'===a.status&&a.summary?(yn(),Sn(pn,{key:1},[Rn(' 查看模式 '),Mn('div',BD,oe(a.summary),1)],2112)):'error'===a.status?(yn(),Sn('div',OD,' ❌ 错误: '+oe(a.error),1)):'summarizing'===a.status?(yn(),Sn('div',qD,[...t[37]||(t[37]=[Mn('span',{class:'animate-spin'},'⏳',-1),Mn('span',null,'正在生成总结...',-1)])])):(yn(),Sn('div',UD,'点击"生成总结"按钮开始处理')),a.summarizedAt?(yn(),Sn('div',VD,' 总结时间: '+oe(e.formatDate(a.summarizedAt)),1)):Rn('v-if',!0)])):Rn('v-if',!0)]),_:2},1024)],2))),128))]))])):Rn('v-if',!0),Rn(' Notes Tab '),'notes'===e.activeTab?(yn(),Sn('div',FD,[t[38]||(t[38]=Mn('div',{class:'notes-hint mb-2 text-xs'},'📝 在这里记录你的冒险心得、重要线索或任何想法（不会发送给AI）',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[10]||(t[10]=t=>e.userNotes=t),class:'notes-textarea custom-scrollbar flex-1 resize-none rounded-lg p-3 text-sm',placeholder:'写下你的冒险笔记...',onBlur:t[11]||(t[11]=(...t)=>e.saveUserNotes&&e.saveUserNotes(...t))},null,544),[[fl,e.userNotes]]),Mn('div',HD,[Mn('span',null,oe(e.userNotes.length)+' 字符',1),e.notesSaved?(yn(),Sn('span',GD,'✓ 已保存')):Rn('v-if',!0)])])):Rn('v-if',!0)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-35184c82']]),QD={class:'debug-modal flex h-[90vh] w-[95vw] max-w-4xl flex-col overflow-hidden rounded-lg shadow-2xl md:h-[85vh] md:w-[90vw]'},XD={class:'modal-header relative z-10 px-4 py-3'},YD={class:'flex items-center justify-between'},KD={class:'mobile-tab-bar relative z-10 flex overflow-x-auto md:hidden'},JD=['onClick'],ZD={class:'relative z-10 flex flex-1 overflow-hidden'},eP={class:'sidebar-nav hidden w-24 shrink-0 p-1.5 md:block lg:w-32 lg:p-2'},tP=['onClick'],aP={class:'main-panel custom-scrollbar flex-1 overflow-y-auto p-2 md:p-6'},sP={key:0,class:'space-y-3 md:space-y-6'},nP={class:'grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 md:gap-4'},rP={class:'rounded bg-[#202225] p-2 md:p-4'},lP={class:'flex items-center space-x-1 md:space-x-2'},oP={class:'rounded bg-[#202225] p-2 md:p-4'},iP={class:'flex items-center space-x-1 md:space-x-2'},cP={class:'rounded bg-[#202225] p-2 md:p-4'},dP={class:'flex items-center space-x-1 md:space-x-2'},uP={class:'mt-3 border-t border-gray-600 pt-3 md:mt-4 md:pt-4'},pP={key:1,class:'space-y-3 md:space-y-6'},mP={class:'grid grid-cols-3 gap-1.5 sm:grid-cols-3 md:gap-4'},gP={class:'mb-0.5 block text-[10px] font-bold text-gray-400 uppercase md:mb-1 md:text-xs'},hP={class:'flex space-x-1 md:space-x-2'},fP=['onUpdate:modelValue'],vP={key:2,class:'space-y-3 md:space-y-6'},yP={class:'rounded bg-[#202225] p-2 md:p-4'},bP={class:'flex flex-wrap gap-1.5 md:gap-2'},xP={class:'rounded bg-[#202225] p-2 md:p-4'},wP={class:'flex gap-1.5 md:gap-2'},kP=['value'],SP=['disabled'],_P={class:'rounded bg-[#202225] p-2 md:p-4'},CP={class:'rounded bg-[#202225] p-2 md:p-4'},IP={key:3,class:'space-y-3 md:space-y-6'},TP={class:'rounded bg-[#202225] p-2 md:p-4'},AP={class:'flex gap-1.5 md:gap-2'},MP=['value'],EP=['disabled'],$P={class:'rounded bg-[#202225] p-2 md:p-4'},DP={key:4,class:'space-y-2 overflow-y-auto md:space-y-4'},PP={class:'rounded bg-[#202225] p-2 md:p-4'},NP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},RP={class:'rounded bg-[#202225] p-2 md:p-4'},jP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},LP={class:'rounded bg-[#202225] p-2 md:p-4'},BP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},OP={class:'rounded bg-[#202225] p-2 md:p-4'},qP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},UP={class:'rounded bg-[#202225] p-2 md:p-4'},VP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},FP={class:'rounded bg-[#202225] p-2 md:p-4'},HP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},GP={class:'rounded bg-[#202225] p-2 md:p-4'},zP={class:'grid grid-cols-2 gap-1.5 md:gap-2'},WP={class:'rounded bg-[#202225] p-2 md:p-4'},QP={class:'flex gap-1.5 md:gap-2'},XP={key:5,class:'flex h-full flex-col space-y-3 md:space-y-4'},YP={class:'flex items-center justify-between'},KP={class:'flex items-center gap-2'},JP={class:'flex rounded bg-[#202225] p-0.5'},ZP=['disabled'],eN={class:'text-[10px] text-gray-400 md:text-xs'},tN={class:'flex-1 overflow-hidden rounded bg-[#202225]'},aN={class:'custom-scrollbar h-full overflow-auto p-3 font-mono text-[10px] whitespace-pre-wrap text-green-400 md:p-4 md:text-xs'},sN={class:'rounded border border-yellow-900/50 bg-yellow-900/20 p-2 md:p-3'},nN={class:'list-disc space-y-0.5 pl-3 text-[10px] text-gray-400 md:pl-4 md:text-xs'},rN={key:6,class:'flex h-full flex-col'},lN={class:'mb-2 flex items-center justify-between'};const oN={class:'flex max-h-[90vh] w-full max-w-md flex-col overflow-hidden rounded-lg border border-blue-700 bg-[#202225] shadow-2xl md:max-w-lg'},iN={class:'flex items-center justify-between border-b border-blue-700 bg-[#2f3136] px-3 py-2'},cN={class:'flex-1 space-y-3 overflow-y-auto p-3 md:space-y-4 md:p-4'},dN={class:'space-y-2'},uN={class:'grid grid-cols-2 gap-2'},pN=['value'],mN=['value'],gN={class:'grid grid-cols-3 gap-2'},hN={class:'space-y-2'},fN=['value'],vN={key:0},yN={class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},bN=['value'],xN={key:0,class:'space-y-2'},wN={class:'space-y-2 rounded border border-gray-700 bg-[#36393f] p-2'},kN={key:1,class:'space-y-2'},SN={class:'space-y-2 rounded border border-gray-700 bg-[#36393f] p-2'},_N=['onUpdate:modelValue'],CN=['onUpdate:modelValue'],IN=['onClick'],TN={key:2,class:'space-y-2'},AN={class:'space-y-2 rounded border border-gray-700 bg-[#36393f] p-2'},MN={class:'flex items-center gap-2'},EN={key:0,class:'space-y-2'},$N={key:3,class:'space-y-2'},DN={class:'rounded border border-gray-700 bg-[#36393f] p-2'},PN={class:'flex items-center gap-2'},NN={key:4,class:'space-y-2'},RN={class:'space-y-2 rounded border border-gray-700 bg-[#36393f] p-2'},jN={key:0,class:'grid grid-cols-2 gap-2'},LN={class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},BN=['placeholder'],ON={key:0},qN={class:'space-y-2'},UN={key:0,class:'space-y-2 rounded border border-gray-700 bg-[#36393f] p-2'},VN={class:'grid grid-cols-2 gap-2'},FN={class:'space-y-2'},HN={class:'rounded border border-gray-700 bg-[#2f3136] p-2'},GN={class:'flex items-center gap-3'},zN={class:'relative shrink-0'},WN={class:'flex h-12 w-12 items-center justify-center rounded border border-gray-600 bg-[#202225] text-2xl'},QN={class:'min-w-0 flex-1'},XN={class:'text-[10px] text-gray-500 md:text-xs'},YN={key:0,class:'mt-0.5 truncate text-[10px] text-cyan-400 md:text-xs'},KN={key:0,class:'mt-1.5 text-[10px] text-gray-400 md:text-xs'},JN={class:'flex justify-end gap-2 border-t border-gray-700 bg-[#2f3136] px-3 py-2'},ZN=['disabled'];const eR=[{value:'sword',label:'🗡️ 剑'},{value:'broadsword',label:'⚔️ 大剑/刀'},{value:'dagger',label:'🔪 匕首'},{value:'shield',label:'🛡️ 盾牌'},{value:'staff',label:'🪄 法杖'},{value:'hammer',label:'🔨 锤子'},{value:'bow',label:'🏹 弓'},{value:'gun',label:'🔫 枪械'},{value:'axe',label:'🪓 斧头'},{value:'gauntlet',label:'🥊 拳套'},{value:'dual_blades',label:'⚔️ 双刃'},{value:'whip',label:'🪢 鞭子'},{value:'katana',label:'🗡️ 太刀'},{value:'spear',label:'🔱 长枪'},{value:'grimoire',label:'📖 魔导书'},{value:'horn',label:'📯 号角'}],tR=[{value:'hat',label:'🎩 帽子'},{value:'helmet',label:'⛑️ 头盔'},{value:'cloak',label:'🧥 斗篷'},{value:'glove',label:'🧤 手套'},{value:'top_male',label:'👕 上衣(男)'},{value:'top_female',label:'👚 上衣(女)'},{value:'lingerie_top',label:'👙 内衣'},{value:'underpants_male',label:'🩲 内裤(男)'},{value:'underpants_female',label:'🩱 内裤(女)'},{value:'sock_short',label:'🧦 短袜'},{value:'sock_long',label:'🧦 长袜'},{value:'shoe_light',label:'👟 轻便鞋'},{value:'boot_heavy',label:'🥾 重靴'},{value:'pant_long',label:'👖 长裤'},{value:'pant_short',label:'🩳 短裤'},{value:'coat',label:'🧥 外套'}],aR=[{value:'ring',label:'💍 戒指'},{value:'necklace',label:'📿 项链'},{value:'earring',label:'👂 耳环'},{value:'bracelet',label:'⌚ 手镯'},{value:'headband',label:'🎀 发带'},{value:'belt',label:'🪢 腰带'},{value:'choker',label:'📿 颈圈'},{value:'body_chain',label:'⛓️ 身体链'},{value:'bag',label:'👜 背包'},{value:'collar_slave',label:'⛓️ 奴隶项圈'},{value:'handcuffs',label:'⛓️ 手铐'},{value:'blindfold',label:'🙈 眼罩'},{value:'gag',label:'🤐 口塞'},{value:'shibari',label:'🪢 绳艺'},{value:'whip',label:'🪢 鞭子'},{value:'dildo',label:'🔮 假阳具'},{value:'anal_plug',label:'🔮 肛塞'}],sR=[{value:'ore',label:'🪨 矿石'},{value:'ingot',label:'🪙 金属锭'},{value:'gem',label:'💎 宝石'},{value:'crystal',label:'🔮 水晶'},{value:'herb',label:'🌿 草药'},{value:'mushroom',label:'🍄 蘑菇'},{value:'flower',label:'🌸 花朵'},{value:'potion',label:'🧪 药水'},{value:'monster_bone',label:'🦴 怪物骨'},{value:'monster_organ',label:'🫀 怪物器官'},{value:'leather',label:'🥩 皮革'},{value:'fabric',label:'🧵 布料'},{value:'wood',label:'🪵 木材'},{value:'paper',label:'📜 纸张'},{value:'powder',label:'💨 粉末'},{value:'rune',label:'🔯 符文'}],nR=[{value:'food_meat',label:'🍖 肉类'},{value:'food_fruit',label:'🍎 水果'},{value:'food_bread',label:'🍞 面包'},{value:'food_meal',label:'🍲 料理'},{value:'drink',label:'🍷 饮料'},{value:'key',label:'🔑 钥匙'},{value:'chest',label:'📦 宝箱'},{value:'bag',label:'👜 背包'},{value:'tool',label:'🔧 工具'},{value:'camping',label:'⛺ 露营'},{value:'book',label:'📚 书籍'},{value:'letter',label:'✉️ 信件'},{value:'currency',label:'💰 货币'},{value:'card',label:'🃏 卡牌'},{value:'light',label:'🕯️ 照明'},{value:'artifact_curse',label:'💀 诅咒物'}],rR=[{value:'rusty',label:'🔩 生锈'},{value:'basic',label:'📦 基础'},{value:'steel',label:'🔩 钢铁'},{value:'standard',label:'⭐ 标准'},{value:'fire',label:'🔥 火焰'},{value:'ice',label:'❄️ 冰霜'},{value:'lightning',label:'⚡ 雷电'},{value:'poison',label:'☠️ 毒素'},{value:'void',label:'🌀 虚空'},{value:'dark',label:'🌑 暗影'},{value:'light',label:'✨ 光明'},{value:'twisted',label:'🌀 扭曲'},{value:'divine',label:'👼 神圣'},{value:'earth',label:'🪨 大地'},{value:'wind',label:'💨 风'},{value:'crystal',label:'💎 水晶'}],lR=[{value:'common',label:'📦 普通'},{value:'linen',label:'🧵 亚麻'},{value:'wool',label:'🐑 羊毛'},{value:'tattered',label:'🧹 破旧'},{value:'leather',label:'🥩 皮革'},{value:'adventurer',label:'🎒 冒险者'},{value:'padded',label:'🛋️ 软垫'},{value:'denim',label:'👖 牛仔'},{value:'silk',label:'🪻 丝绸'},{value:'noble',label:'👑 贵族'},{value:'lace',label:'🎀 蕾丝'},{value:'gold_trim',label:'💛 镀金'},{value:'plate',label:'⚙️ 板甲'},{value:'mythical',label:'🌟 神话'},{value:'rune',label:'🔯 符文'},{value:'dragon',label:'🐉 龙鳞'}],oR=Za({name:'ItemCreatorModal',props:{visible:{type:Boolean,default:!1}},emits:['close','created'],setup(e,{emit:t}){const{success:a}=Xp(),s=$t(!1),n=xt({name:'',type:'misc',quality:'Common',emoji:'📦',count:1,value:10,desc:'',subtype:'',attribute:'',level:1,reqLevel:0,equipBonuses:[],enableOnHitEffect:!1,onHitDamageType:'fire',onHitDamageValue:'1d6',onHitChance:100,baseDamage:'',bagSlots:5,consumableEffect:'',consumableValue:'',consumableDuration:3}),r=[{value:'weapon',label:'⚔️ 武器'},{value:'armor',label:'🛡️ 护甲'},{value:'accessory',label:'💍 饰品'},{value:'consumable',label:'🧪 消耗品'},{value:'material',label:'🔩 材料'},{value:'quest',label:'📜 任务物品'},{value:'misc',label:'📦 杂物'}],l=[{value:'Common',label:'普通',color:Ux.Common.color},{value:'Uncommon',label:'优秀',color:Ux.Uncommon.color},{value:'Rare',label:'稀有',color:Ux.Rare.color},{value:'Epic',label:'史诗',color:Ux.Epic.color},{value:'Legendary',label:'传说',color:Ux.Legendary.color},{value:'Mythic',label:'神话',color:Ux.Mythic.color}],o=ir(()=>{switch(n.type){case'weapon':return eR;case'armor':return tR;case'accessory':return aR;case'material':return sR;default:return nR}}),i=ir(()=>{switch(n.type){case'weapon':case'accessory':return rR;case'armor':return lR;default:return[]}}),c=ir(()=>{switch(n.type){case'weapon':case'accessory':return'元素属性';case'armor':return'材质风格';default:return'属性'}});_a(()=>n.type,()=>{n.subtype='',n.attribute='',n.equipBonuses=[],n.enableOnHitEffect=!1,n.consumableEffect=''});const d=ir(()=>!!['weapon','armor','accessory'].includes(n.type)&&('accessory'!==n.type||'bag'!==n.subtype)),u=ir(()=>'accessory'===n.type&&'bag'===n.subtype),p=()=>{try{return Ll.serviceLocator.get('IconService')}catch{return null}},m=ir(()=>{if(!n.subtype)return!1;return!!p()}),g=ir(()=>{const e=p();if(!e||!n.subtype)return{};const t=(()=>{switch(n.type){case'weapon':return'weapon';case'armor':return'armor';case'accessory':return'bag'===n.subtype?'item':'accessory';case'material':return'material';default:return'item'}})();return e.getIconStyle(t,n.subtype,n.attribute,void 0,48)}),h=ir(()=>['heal_hp','heal_mp','heal_sp','heal_all','revive'].includes(n.consumableEffect)),f=ir(()=>['buff_atk','buff_def','buff_spd','buff_crit'].includes(n.consumableEffect)),v=ir(()=>!('weapon'!==n.type||!n.baseDamage)||(!(!d.value||!n.equipBonuses.some(e=>e.stat&&e.value))||(!('weapon'!==n.type||!n.enableOnHitEffect)||(!!(u.value&&n.bagSlots>0)||!('consumable'!==n.type||!n.consumableEffect))))),y=ir(()=>Ux[n.quality]?.color||'#9d9d9d'),b=ir(()=>n.name.trim().length>0),x=()=>{n.name='',n.type='misc',n.quality='Common',n.emoji='📦',n.count=1,n.value=10,n.desc='',n.subtype='',n.attribute='',n.level=1,n.reqLevel=0,n.equipBonuses=[],n.enableOnHitEffect=!1,n.onHitDamageType='fire',n.onHitDamageValue='1d6',n.onHitChance=100,n.baseDamage='',n.bagSlots=5,n.consumableEffect='',n.consumableValue='',n.consumableDuration=3,s.value=!1};return _a(()=>e.visible,e=>{e&&x()}),{form:n,showAdvanced:s,itemTypes:r,qualities:l,availableSubtypes:o,availableAttributes:i,attributeLabel:c,qualityColor:y,isValid:b,getTypeLabel:e=>r.find(t=>t.value===e)?.label.split(' ')[1]||e,getQualityLabel:e=>l.find(t=>t.value===e)?.label||e,createItem:async()=>{if(!b.value)return;const e=(()=>{const e=[];if(d.value){const t=n.equipBonuses.filter(e=>e.stat&&e.value);if(t.length>0){const a={};for(const e of t)a[e.stat]=e.value;e.push({trigger:'passive',action:'buff',target:'self',statusName:'装备加成',duration:-1,modifiers:a})}}if('weapon'===n.type&&n.enableOnHitEffect&&n.onHitDamageValue&&e.push({trigger:'on_hit',action:'damage',target:'target',value:n.onHitDamageValue,tags:[n.onHitDamageType],chance:n.onHitChance||100}),'consumable'===n.type&&n.consumableEffect){const t={trigger:'immediate',target:'self'};switch(n.consumableEffect){case'heal_hp':t.action='heal',t.value=n.consumableValue||'20',t.tags=['hp'];break;case'heal_mp':t.action='heal',t.value=n.consumableValue||'20',t.tags=['mp'];break;case'heal_sp':t.action='heal',t.value=n.consumableValue||'20',t.tags=['sp'];break;case'heal_all':t.action='heal',t.value=n.consumableValue||'20',t.tags=['hp','mp','sp'];break;case'buff_atk':t.action='buff',t.statusName='攻击提升',t.duration=n.consumableDuration||3,t.modifiers={attack:parseInt(n.consumableValue)||30};break;case'buff_def':t.action='buff',t.statusName='防御提升',t.duration=n.consumableDuration||3,t.modifiers={defense:parseInt(n.consumableValue)||30};break;case'buff_spd':t.action='buff',t.statusName='速度提升',t.duration=n.consumableDuration||3,t.modifiers={spd:parseInt(n.consumableValue)||30};break;case'buff_crit':t.action='buff',t.statusName='暴击提升',t.duration=n.consumableDuration||3,t.modifiers={crit_rate:parseInt(n.consumableValue)||20};break;case'cleanse':t.action='cleanse';break;case'revive':t.action='revive',t.reviveHpPercent=parseInt(n.consumableValue)||50}e.push(t)}return e})(),s={name:n.name.trim(),type:n.type,count:Math.max(1,n.count),quality:n.quality,desc:n.desc.trim()||void 0,value:n.value,emoji:n.emoji||'📦',subtype:n.subtype.trim()||void 0,attribute:n.attribute||void 0,level:n.level>0?n.level:void 0,req:n.reqLevel>0?{level:n.reqLevel}:void 0,effects:e.length>0?e:void 0,baseDamage:'weapon'===n.type&&n.baseDamage?n.baseDamage:void 0,capacityBonus:u.value&&n.bagSlots>0?n.bagSlots:void 0};try{Ll.serviceLocator.get('InventoryService').addItem(s),await a('创建成功',`已添加物品: ${s.name} x${s.count}`),t('created',s),x(),t('close')}catch(e){console.error('Failed to create item:',e)}},showEquipmentEffects:d,isAccessoryBag:u,isHealEffect:h,isBuffEffect:f,hasEffects:v,hasValidSubtype:m,previewIconStyle:g,addEquipBonus:()=>{n.equipBonuses.length<4&&n.equipBonuses.push({stat:'',value:0})},removeEquipBonus:e=>{n.equipBonuses.splice(e,1)},getEffectsPreview:()=>{const e=[];if('weapon'===n.type&&n.baseDamage&&e.push(`伤害: ${n.baseDamage}`),d.value){const t=n.equipBonuses.filter(e=>e.stat&&e.value).map(e=>{const t=e.value>=0?'+':'';return`${{attack:'攻击',defense:'防御',spd:'速度',crit_rate:'暴击率',crit_dmg:'暴击伤害',hp_max:'HP上限',mp_max:'MP上限',sp_max:'SP上限',lifesteal:'吸血',reflect:'反伤',damage:'伤害加成'}[e.stat]||e.stat} ${t}${e.value}`});t.length>0&&e.push(`装备: ${t.join(', ')}`)}if('weapon'===n.type&&n.enableOnHitEffect){const t={physical:'物理',slashing:'挥砍',piercing:'穿刺',bludgeoning:'钝击',fire:'火焰',ice:'冰霜',lightning:'雷电',water:'水',earth:'土',wind:'风',poison:'毒',light:'光',dark:'暗',void:'虚空',true:'真实'}[n.onHitDamageType]||n.onHitDamageType;let a=`命中: ${n.onHitDamageValue} ${t}伤害`;n.onHitChance<100&&(a+=` (${n.onHitChance}%概率)`),e.push(a)}if(u.value&&n.bagSlots>0&&e.push(`背包格子 +${n.bagSlots}`),'consumable'===n.type&&n.consumableEffect){let t={heal_hp:'恢复HP',heal_mp:'恢复MP',heal_sp:'恢复SP',heal_all:'恢复全部',buff_atk:'攻击提升',buff_def:'防御提升',buff_spd:'速度提升',buff_crit:'暴击提升',cleanse:'解除负面状态',revive:'复活'}[n.consumableEffect]||n.consumableEffect;n.consumableValue&&!['cleanse'].includes(n.consumableEffect)&&(t+=` ${n.consumableValue}`),f.value&&n.consumableDuration&&(t+=` (${n.consumableDuration}回合)`),e.push(`使用: ${t}`)}return e.join(' | ')}}}}),iR=(0,$u.A)(oR,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-100 flex items-center justify-center bg-black/80 px-2',onClick:t[25]||(t[25]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',oN,[Rn(' Header '),Mn('div',iN,[t[26]||(t[26]=Mn('h2',{class:'text-sm font-bold text-blue-400 md:text-base'},'🎁 创建自定义物品',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),Rn(' Body '),Mn('div',cN,[Rn(' 基础信息 '),Mn('div',dN,[t[34]||(t[34]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'📦 基础信息',-1)),Rn(' 名称 '),Mn('div',null,[t[27]||(t[27]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'物品名称 *',-1)),xa(Mn('input',{'onUpdate:modelValue':t[1]||(t[1]=t=>e.form.name=t),type:'text',placeholder:'输入物品名称...',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.name]])]),Rn(' 类型和稀有度 '),Mn('div',uN,[Mn('div',null,[t[28]||(t[28]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'物品类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.form.type=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none md:text-sm'},[(yn(!0),Sn(pn,null,xs(e.itemTypes,e=>(yn(),Sn('option',{key:e.value,value:e.value},oe(e.label),9,pN))),128))],512),[[bl,e.form.type]])]),Mn('div',null,[t[29]||(t[29]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'稀有度',-1)),xa(Mn('select',{'onUpdate:modelValue':t[3]||(t[3]=t=>e.form.quality=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none md:text-sm',style:X({color:e.qualityColor})},[(yn(!0),Sn(pn,null,xs(e.qualities,e=>(yn(),Sn('option',{key:e.value,value:e.value,style:X({color:e.color})},oe(e.label),13,mN))),128))],4),[[bl,e.form.quality]])])]),Rn(' 图标和数量 '),Mn('div',gN,[Mn('div',null,[t[30]||(t[30]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'图标 Emoji',-1)),xa(Mn('input',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.form.emoji=t),type:'text',placeholder:'⚔️',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-center text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.emoji]])]),Mn('div',null,[t[31]||(t[31]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'数量',-1)),xa(Mn('input',{'onUpdate:modelValue':t[5]||(t[5]=t=>e.form.count=t),type:'number',min:'1',max:'999',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.count,void 0,{number:!0}]])]),Mn('div',null,[t[32]||(t[32]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'价值 (铜)',-1)),xa(Mn('input',{'onUpdate:modelValue':t[6]||(t[6]=t=>e.form.value=t),type:'number',min:'0',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.value,void 0,{number:!0}]])])]),Rn(' 描述 '),Mn('div',null,[t[33]||(t[33]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'物品描述',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.form.desc=t),rows:'2',placeholder:'输入物品描述...',class:'w-full resize-none rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.desc]])])]),Rn(' 图标配置 '),Mn('div',hN,[t[38]||(t[38]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'🖼️ 图标配置',-1)),Rn(' 子类型 (根据物品类型动态变化) '),Mn('div',null,[t[36]||(t[36]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'图标类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.form.subtype=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none md:text-sm'},[t[35]||(t[35]=Mn('option',{value:''},'默认',-1)),(yn(!0),Sn(pn,null,xs(e.availableSubtypes,e=>(yn(),Sn('option',{key:e.value,value:e.value},oe(e.label),9,fN))),128))],512),[[bl,e.form.subtype]])]),Rn(' 材质/元素属性 (根据物品类型动态变化) '),e.availableAttributes.length>0?(yn(),Sn('div',vN,[Mn('label',yN,oe(e.attributeLabel),1),xa(Mn('select',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.form.attribute=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none md:text-sm'},[t[37]||(t[37]=Mn('option',{value:''},'默认',-1)),(yn(!0),Sn(pn,null,xs(e.availableAttributes,e=>(yn(),Sn('option',{key:e.value,value:e.value},oe(e.label),9,bN))),128))],512),[[bl,e.form.attribute]])])):Rn('v-if',!0)]),Rn(' 武器基础伤害 (仅武器) '),'weapon'===e.form.type?(yn(),Sn('div',xN,[t[42]||(t[42]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'⚔️ 武器伤害',-1)),Mn('div',wN,[t[41]||(t[41]=Mn('p',{class:'text-[10px] text-gray-500'},'💡 武器的基础普攻伤害（影响普通攻击）',-1)),Mn('div',null,[t[39]||(t[39]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'基础伤害',-1)),xa(Mn('input',{'onUpdate:modelValue':t[10]||(t[10]=t=>e.form.baseDamage=t),type:'text',placeholder:'1d6+2 或留空使用默认值',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none'},null,512),[[fl,e.form.baseDamage]]),t[40]||(t[40]=Mn('p',{class:'mt-0.5 text-[10px] text-gray-500'},' 支持骰子表达式，如 1d8+3、2d6。留空则使用 1d6+STR调整值 ',-1))])])])):Rn('v-if',!0),Rn(' 装备效果 (武器/防具/饰品，非背包) '),e.showEquipmentEffects?(yn(),Sn('div',kN,[t[45]||(t[45]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'📊 装备属性加成',-1)),Mn('div',SN,[t[44]||(t[44]=Mn('p',{class:'text-[10px] text-gray-500'},'💡 装备后提供的被动属性加成',-1)),Rn(' 属性加成列表 '),(yn(!0),Sn(pn,null,xs(e.form.equipBonuses,(a,s)=>(yn(),Sn('div',{key:s,class:'flex items-center gap-2'},[xa(Mn('select',{'onUpdate:modelValue':e=>a.stat=e,class:'flex-1 rounded border border-gray-600 bg-[#2f3136] px-2 py-1 text-xs text-white focus:border-blue-500 focus:outline-none'},[...t[43]||(t[43]=[Mn('option',{value:''},'选择属性...',-1),Mn('optgroup',{label:'基础属性'},[Mn('option',{value:'attack'},'⚔️ 攻击力'),Mn('option',{value:'defense'},'🛡️ 防御力'),Mn('option',{value:'spd'},'💨 速度')],-1),Mn('optgroup',{label:'暴击'},[Mn('option',{value:'crit_rate'},'💥 暴击率 (%)'),Mn('option',{value:'crit_dmg'},'🎯 暴击伤害 (%)')],-1),Mn('optgroup',{label:'资源上限'},[Mn('option',{value:'hp_max'},'❤️ HP上限'),Mn('option',{value:'mp_max'},'💙 MP上限'),Mn('option',{value:'sp_max'},'💚 SP上限')],-1),Mn('optgroup',{label:'特殊'},[Mn('option',{value:'lifesteal'},'🧛 吸血 (%)'),Mn('option',{value:'reflect'},'↩️ 反伤 (%)'),Mn('option',{value:'damage'},'📈 伤害加成 (%)')],-1)])],8,_N),[[bl,a.stat]]),xa(Mn('input',{'onUpdate:modelValue':e=>a.value=e,type:'number',placeholder:'数值',class:'w-16 rounded border border-gray-600 bg-[#2f3136] px-2 py-1 text-xs text-white focus:border-blue-500 focus:outline-none'},null,8,CN),[[fl,a.value,void 0,{number:!0}]]),Mn('button',{type:'button',class:'text-red-400 hover:text-red-300',onClick:t=>e.removeEquipBonus(s)},' ✕ ',8,IN)]))),128)),Rn(' 添加属性按钮 '),e.form.equipBonuses.length<4?(yn(),Sn('button',{key:0,type:'button',class:'w-full rounded border border-dashed border-gray-600 px-2 py-1 text-xs text-gray-400 hover:border-blue-500 hover:text-blue-400',onClick:t[11]||(t[11]=(...t)=>e.addEquipBonus&&e.addEquipBonus(...t))},' + 添加属性加成 ')):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' 武器命中效果 (仅武器) '),'weapon'===e.form.type?(yn(),Sn('div',TN,[t[53]||(t[53]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'🎯 命中效果',-1)),Mn('div',AN,[t[52]||(t[52]=Mn('p',{class:'text-[10px] text-gray-500'},'💡 武器命中敌人时触发的额外效果',-1)),Rn(' 启用命中效果 '),Mn('div',MN,[xa(Mn('input',{'onUpdate:modelValue':t[12]||(t[12]=t=>e.form.enableOnHitEffect=t),type:'checkbox',class:'h-4 w-4 rounded border-gray-600 bg-[#2f3136] text-blue-500 focus:ring-blue-500'},null,512),[[vl,e.form.enableOnHitEffect]]),t[46]||(t[46]=Mn('label',{class:'text-xs text-gray-300'},'启用命中效果',-1))]),e.form.enableOnHitEffect?(yn(),Sn('div',EN,[Rn(' 伤害类型 '),Mn('div',null,[t[48]||(t[48]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'伤害类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[13]||(t[13]=t=>e.form.onHitDamageType=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1 text-xs text-white focus:border-blue-500 focus:outline-none'},[...t[47]||(t[47]=[Mn('optgroup',{label:'物理'},[Mn('option',{value:'physical'},'🗡️ 物理'),Mn('option',{value:'slashing'},'⚔️ 挥砍'),Mn('option',{value:'piercing'},'🔱 穿刺'),Mn('option',{value:'bludgeoning'},'🔨 钝击')],-1),Mn('optgroup',{label:'元素'},[Mn('option',{value:'fire'},'🔥 火焰'),Mn('option',{value:'ice'},'❄️ 冰霜'),Mn('option',{value:'lightning'},'⚡ 雷电'),Mn('option',{value:'water'},'💧 水'),Mn('option',{value:'earth'},'🪨 土'),Mn('option',{value:'wind'},'💨 风')],-1),Mn('optgroup',{label:'特殊'},[Mn('option',{value:'poison'},'☠️ 毒'),Mn('option',{value:'light'},'✨ 光'),Mn('option',{value:'dark'},'🌑 暗'),Mn('option',{value:'void'},'🌀 虚空'),Mn('option',{value:'true'},'💀 真实')],-1)])],512),[[bl,e.form.onHitDamageType]])]),Rn(' 额外伤害值 '),Mn('div',null,[t[49]||(t[49]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'额外伤害',-1)),xa(Mn('input',{'onUpdate:modelValue':t[14]||(t[14]=t=>e.form.onHitDamageValue=t),type:'text',placeholder:'1d6 或 10',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none'},null,512),[[fl,e.form.onHitDamageValue]]),t[50]||(t[50]=Mn('p',{class:'mt-0.5 text-[10px] text-gray-500'},'支持骰子表达式如 1d6+2',-1))]),Rn(' 触发概率 '),Mn('div',null,[t[51]||(t[51]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'触发概率 (%)',-1)),xa(Mn('input',{'onUpdate:modelValue':t[15]||(t[15]=t=>e.form.onHitChance=t),type:'number',min:'1',max:'100',placeholder:'100',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none'},null,512),[[fl,e.form.onHitChance,void 0,{number:!0}]])])])):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' 背包效果 (饰品背包) '),e.isAccessoryBag?(yn(),Sn('div',$N,[t[57]||(t[57]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'👜 背包效果',-1)),Mn('div',DN,[Mn('div',PN,[t[54]||(t[54]=Mn('label',{class:'text-[10px] text-gray-400 md:text-xs'},'增加背包格子',-1)),xa(Mn('input',{'onUpdate:modelValue':t[16]||(t[16]=t=>e.form.bagSlots=t),type:'number',min:'1',max:'20',placeholder:'5',class:'w-16 rounded border border-gray-600 bg-[#2f3136] px-2 py-1 text-xs text-white focus:border-blue-500 focus:outline-none'},null,512),[[fl,e.form.bagSlots,void 0,{number:!0}]]),t[55]||(t[55]=Mn('span',{class:'text-[10px] text-gray-500'},'格',-1))]),t[56]||(t[56]=Mn('p',{class:'mt-1 text-[10px] text-gray-500'},'💡 背包没有战斗效果，仅增加物品栏容量',-1))])])):Rn('v-if',!0),Rn(' 消耗品效果 '),'consumable'===e.form.type?(yn(),Sn('div',NN,[t[62]||(t[62]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'🧪 使用效果',-1)),Mn('div',RN,[Rn(' 效果类型 '),Mn('div',null,[t[59]||(t[59]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'效果类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[17]||(t[17]=t=>e.form.consumableEffect=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none'},[...t[58]||(t[58]=[Mn('option',{value:''},'无效果',-1),Mn('optgroup',{label:'恢复'},[Mn('option',{value:'heal_hp'},'❤️ 恢复HP'),Mn('option',{value:'heal_mp'},'💙 恢复MP'),Mn('option',{value:'heal_sp'},'💚 恢复SP'),Mn('option',{value:'heal_all'},'✨ 恢复全部')],-1),Mn('optgroup',{label:'增益'},[Mn('option',{value:'buff_atk'},'⚔️ 攻击提升'),Mn('option',{value:'buff_def'},'🛡️ 防御提升'),Mn('option',{value:'buff_spd'},'💨 速度提升'),Mn('option',{value:'buff_crit'},'💥 暴击提升')],-1),Mn('optgroup',{label:'特殊'},[Mn('option',{value:'cleanse'},'🧹 解除负面状态'),Mn('option',{value:'revive'},'💖 复活')],-1)])],512),[[bl,e.form.consumableEffect]])]),Rn(' 效果数值 '),e.form.consumableEffect&&!['cleanse'].includes(e.form.consumableEffect)?(yn(),Sn('div',jN,[Mn('div',null,[Mn('label',LN,oe(e.isHealEffect?'恢复量':e.isBuffEffect?'增益数值 (%)':'效果数值'),1),xa(Mn('input',{'onUpdate:modelValue':t[18]||(t[18]=t=>e.form.consumableValue=t),type:'text',placeholder:e.isHealEffect?'2d8+10':'30',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none'},null,8,BN),[[fl,e.form.consumableValue]])]),e.isBuffEffect?(yn(),Sn('div',ON,[t[60]||(t[60]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'持续回合',-1)),xa(Mn('input',{'onUpdate:modelValue':t[19]||(t[19]=t=>e.form.consumableDuration=t),type:'number',min:'1',max:'20',placeholder:'3',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none'},null,512),[[fl,e.form.consumableDuration,void 0,{number:!0}]])])):Rn('v-if',!0)])):Rn('v-if',!0),t[61]||(t[61]=Mn('p',{class:'text-[10px] text-gray-500'},'💡 消耗品在战斗中使用时触发效果',-1))])])):Rn('v-if',!0),Rn(' 高级选项 '),Mn('div',qN,[Mn('button',{type:'button',class:'flex w-full items-center gap-1 text-xs font-bold text-gray-400 hover:text-white md:text-sm',onClick:t[20]||(t[20]=t=>e.showAdvanced=!e.showAdvanced)},[Mn('span',{class:ee(['transition-transform',{'rotate-90':e.showAdvanced}])},'▶',2),t[63]||(t[63]=Pn(' ⚙️ 高级选项 ',-1))]),e.showAdvanced?(yn(),Sn('div',UN,[Rn(' 等级和装备要求 '),Mn('div',VN,[Mn('div',null,[t[64]||(t[64]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'物品等级',-1)),xa(Mn('input',{'onUpdate:modelValue':t[21]||(t[21]=t=>e.form.level=t),type:'number',min:'1',max:'100',placeholder:'1',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.level,void 0,{number:!0}]])]),Mn('div',null,[t[65]||(t[65]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'装备需求等级',-1)),xa(Mn('input',{'onUpdate:modelValue':t[22]||(t[22]=t=>e.form.reqLevel=t),type:'number',min:'0',max:'100',placeholder:'0',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.reqLevel,void 0,{number:!0}]])])])])):Rn('v-if',!0)]),Rn(' 预览 '),Mn('div',FN,[t[66]||(t[66]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'👁️ 预览',-1)),Mn('div',HN,[Mn('div',GN,[Rn(' 精灵图图标预览 '),Mn('div',zN,[Rn(' 精灵图 (当有有效的subtype时显示) '),e.hasValidSubtype?(yn(),Sn('div',{key:0,class:'rounded border border-gray-600',style:X(e.previewIconStyle)},null,4)):(yn(),Sn(pn,{key:1},[Rn(' Emoji 回退 '),Mn('div',WN,oe(e.form.emoji||'📦'),1)],2112)),Rn(' 品质边框光晕 '),Mn('div',{class:'pointer-events-none absolute inset-0 rounded',style:X({boxShadow:`inset 0 0 0 2px ${e.qualityColor}40, 0 0 8px ${e.qualityColor}30`})},null,4)]),Mn('div',QN,[Mn('div',{class:'truncate text-xs font-bold md:text-sm',style:X({color:e.qualityColor})},oe(e.form.name||'未命名物品'),5),Mn('div',XN,oe(e.getTypeLabel(e.form.type))+' · '+oe(e.getQualityLabel(e.form.quality))+' · x'+oe(e.form.count),1),Rn(' 效果预览 '),e.hasEffects?(yn(),Sn('div',YN,oe(e.getEffectsPreview()),1)):Rn('v-if',!0)])]),e.form.desc?(yn(),Sn('div',KN,oe(e.form.desc),1)):Rn('v-if',!0)])])]),Rn(' Footer '),Mn('div',JN,[Mn('button',{type:'button',class:'rounded border border-gray-600 bg-transparent px-3 py-1.5 text-xs font-medium text-gray-300 transition-colors hover:bg-gray-700 md:text-sm',onClick:t[23]||(t[23]=t=>e.$emit('close'))},' 取消 '),Mn('button',{type:'button',class:'rounded bg-blue-600 px-3 py-1.5 text-xs font-medium text-white transition-colors hover:bg-blue-500 disabled:opacity-50 md:text-sm',disabled:!e.isValid,onClick:t[24]||(t[24]=(...t)=>e.createItem&&e.createItem(...t))},' 创建物品 ',8,ZN)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-85703396']]),cR={class:'flex max-h-[90vh] w-full max-w-md flex-col overflow-hidden rounded-lg border border-purple-700 bg-[#202225] shadow-2xl md:max-w-lg'},dR={class:'flex items-center justify-between border-b border-purple-700 bg-[#2f3136] px-3 py-2'},uR={class:'flex-1 space-y-3 overflow-y-auto p-3 md:space-y-4 md:p-4'},pR={class:'space-y-2'},mR={class:'grid grid-cols-3 gap-2'},gR={class:'grid grid-cols-4 gap-2'},hR={class:'col-span-3'},fR={key:0,class:'space-y-2'},vR={class:'grid grid-cols-2 gap-2'},yR={class:'space-y-2'},bR={class:'grid grid-cols-3 gap-2'},xR={class:'space-y-2'},wR={class:'rounded border border-gray-700 bg-[#36393f] p-2'},kR={class:'mb-2'},SR={key:0,class:'mb-2'},_R={key:1,class:'space-y-2'},CR={class:'grid grid-cols-2 gap-2'},IR={class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},TR=['placeholder'],AR={key:2,class:'space-y-2'},MR={class:'grid grid-cols-2 gap-2'},ER={class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},$R=['placeholder','disabled'],DR={key:3},PR={class:'space-y-2'},NR={key:0,class:'space-y-2 rounded border border-gray-700 bg-[#36393f] p-2'},RR={class:'grid grid-cols-2 gap-2'},jR={class:'space-y-2'},LR={class:'rounded border border-gray-700 bg-[#2f3136] p-2'},BR={class:'flex items-center gap-2'},OR={class:'text-lg'},qR={class:'text-xs font-bold text-purple-400 md:text-sm'},UR={class:'text-[10px] text-gray-500 md:text-xs'},VR={key:0,class:'mt-1 text-[10px] text-gray-400 md:text-xs'},FR={class:'mt-1 text-[10px] text-gray-500 md:text-xs'},HR={key:1,class:'mt-1 text-[10px] text-red-400'},GR={class:'flex justify-end gap-2 border-t border-gray-700 bg-[#2f3136] px-3 py-2'},zR=['disabled'];const WR={atk_up:{name:'攻击提升',tag:'atk_up',modifierKey:'attack'},def_up:{name:'防御提升',tag:'def_up',modifierKey:'defense'},spd_up:{name:'速度提升',tag:'spd_up',modifierKey:'spd'},crit_up:{name:'暴击提升',tag:'crit_up',modifierKey:'crit_rate'},crit_dmg_up:{name:'暴击伤害提升',tag:'crit_dmg_up',modifierKey:'crit_dmg'},dmg_bonus:{name:'伤害加成',tag:'dmg_bonus',modifierKey:'damage'},heal_bonus:{name:'治疗加成',tag:'heal_bonus',modifierKey:'heal_bonus'},lifesteal:{name:'吸血',tag:'lifesteal',modifierKey:'lifesteal'},reflect:{name:'反伤',tag:'reflect',modifierKey:'reflect'},thorns:{name:'荆棘',tag:'thorns',modifierKey:'thorns'},regen:{name:'生命再生',tag:'regen',isHot:!0},hot:{name:'持续治疗',tag:'heal',isHot:!0},invincible:{name:'无敌',tag:'invincible'},stealth:{name:'潜行',tag:'stealth'},counter:{name:'反击',tag:'counter'}},QR={atk_down:{name:'攻击降低',tag:'atk_down',modifierKey:'attack'},def_down:{name:'防御降低',tag:'def_down',modifierKey:'defense'},spd_down:{name:'速度降低',tag:'spd_down',modifierKey:'spd'},crit_down:{name:'暴击降低',tag:'crit_down',modifierKey:'crit_rate'},stun:{name:'眩晕',tag:'stun',isControl:!0},silence:{name:'沉默',tag:'silence',isControl:!0},fear:{name:'恐惧',tag:'fear',isControl:!0},sleep:{name:'睡眠',tag:'sleep',isControl:!0},taunt:{name:'嘲讽',tag:'taunt',isControl:!0},blind:{name:'致盲',tag:'blind',modifierKey:'hitrate'},slow:{name:'减速',tag:'slow',modifierKey:'spd'},poison:{name:'中毒',tag:'poison',isDot:!0,dotTag:'poison'},bleed:{name:'流血',tag:'bleed',isDot:!0,dotTag:'physical'},burn:{name:'燃烧',tag:'burn',isDot:!0,dotTag:'fire'},corrode:{name:'腐蚀',tag:'corrode',isDot:!0,dotTag:'poison'},vulnerable:{name:'易伤',tag:'vulnerable',modifierKey:'damageTaken'},heal_block:{name:'禁疗',tag:'heal_block'},marked:{name:'标记',tag:'marked'},weak:{name:'虚弱',tag:'weak'},curse:{name:'诅咒',tag:'curse'}},XR=Za({name:'SkillCreatorModal',props:{visible:{type:Boolean,default:!1}},emits:['close','created'],setup(e,{emit:t}){const{success:a,warning:s}=Xp(),n=$t(!1),r=xt({name:'',type:'active',tier:1,cooldown:2,icon:'⚔️',description:'',targetType:'single',validTargets:'enemy',costMp:0,costSp:0,costHp:0,effectType:'damage',effectValue:'1d6+3',statusDuration:3,element:'physical',hitCount:1,aiWeight:50,buffType:'',debuffType:'',buffValue:'30',debuffValue:'30'}),l=ir(()=>{const e=WR[r.buffType];return!0===e?.isHot}),o=ir(()=>{const e=QR[r.debuffType];return!0===e?.isDot}),i=ir(()=>{const e=QR[r.debuffType];return!0===e?.isControl}),c=ir(()=>{const e=QR[r.debuffType];return!!e?.modifierKey}),d=ir(()=>!('buff'===r.effectType&&!r.buffType)&&!('debuff'===r.effectType&&!r.debuffType)),u=ir(()=>!!r.name.trim()&&d.value),p=e=>({physical:'物理',fire:'火焰',ice:'冰霜',lightning:'雷电',poison:'毒素',holy:'神圣',dark:'暗影'}[e]||e),m=()=>{r.name='',r.type='active',r.tier=1,r.cooldown=2,r.icon='⚔️',r.description='',r.targetType='single',r.validTargets='enemy',r.costMp=0,r.costSp=0,r.costHp=0,r.effectType='damage',r.effectValue='1d6+3',r.statusDuration=3,r.element='physical',r.hitCount=1,r.aiWeight=50,r.buffType='',r.debuffType='',r.buffValue='30',r.debuffValue='30',n.value=!1},g=()=>{const e={trigger:'immediate',action:r.effectType,target:'self'===r.targetType?'self':'target'};if(['damage','heal'].includes(r.effectType)&&(e.value=r.effectValue||'1d6'),'damage'===r.effectType&&r.element&&(e.tags=[r.element]),'buff'===r.effectType&&r.buffType){const t=WR[r.buffType];if(t)if(e.statusName=t.name,e.duration=r.statusDuration,e.tags=[t.tag],t.isHot){e.action='buff',e.value=r.buffValue||'1d4+3';const t=parseInt(r.buffValue);isNaN(t)||(e.hot=t)}else if(t.modifierKey){const a=parseInt(r.buffValue)||30;e.modifiers={[t.modifierKey]:a}}}if('debuff'===r.effectType&&r.debuffType){const t=QR[r.debuffType];if(t)if(e.statusName=t.name,e.duration=r.statusDuration,e.tags=[t.tag],t.isDot){e.value=r.debuffValue||'1d4+2',t.dotTag&&(e.tags=[t.dotTag]);const a=parseInt(r.debuffValue);isNaN(a)||(e.dot=a)}else if(t.modifierKey){const a=-(parseInt(r.debuffValue)||30);e.modifiers={[t.modifierKey]:a}}}return'shield'===r.effectType&&(e.shieldValue=parseInt(r.effectValue)||20,e.shieldMode='hp'),e};return _a(()=>e.visible,e=>{e&&m()}),{form:r,showAdvanced:n,isValid:u,isEffectValid:d,isHotBuff:l,isDotDebuff:o,isControlDebuff:i,hasModifier:c,getEffectPreview:()=>{switch(r.effectType){case'damage':return`造成 ${r.effectValue||'?'} 点${r.element?` ${p(r.element)}`:''}伤害`;case'heal':return`恢复 ${r.effectValue||'?'} 点生命`;case'buff':{const e=WR[r.buffType];return e?e.isHot?`施加 ${e.name}，每回合恢复 ${r.buffValue||'?'} 点生命，持续 ${r.statusDuration} 回合`:e.modifierKey?`施加 ${e.name} +${r.buffValue||'?'}%，持续 ${r.statusDuration} 回合`:`施加 ${e.name}，持续 ${r.statusDuration} 回合`:'选择增益类型...'}case'debuff':{const e=QR[r.debuffType];return e?e.isDot?`施加 ${e.name}，每回合造成 ${r.debuffValue||'?'} 点伤害，持续 ${r.statusDuration} 回合`:e.isControl?`施加 ${e.name}，持续 ${r.statusDuration} 回合`:e.modifierKey?`施加 ${e.name} -${r.debuffValue||'?'}%，持续 ${r.statusDuration} 回合`:`施加 ${e.name}，持续 ${r.statusDuration} 回合`:'选择减益类型...'}case'shield':return`获得 ${r.effectValue||'?'} 点护盾`;default:return'无效果'}},getEffectError:()=>'buff'!==r.effectType||r.buffType?'debuff'!==r.effectType||r.debuffType?'':'请选择减益类型':'请选择增益类型',createSkill:async()=>{if(!u.value)return;const e=Ll.serviceLocator.get('SaveService'),n=e.getGameState();if(!n)return void await s('无法操作','游戏状态未初始化！');if(Object.values(n.skills).find(e=>e.name===r.name.trim()))return void await s('无法学习','已经学会该技能！');const l=`custom_${Date.now()}`,o={name:r.name.trim(),description:r.description.trim()||void 0,icon:r.icon||'⚔️',type:r.type,tier:r.tier,tags:r.element?[r.element]:[],cooldown:r.cooldown,target:(()=>{if('self'===r.targetType)return'self';const e='all'===r.targetType?'all':'random'===r.targetType?'random':'single';return e+('ally'===r.validTargets?'all'===e?'_allies':'_ally':'all'===e?'_enemies':'_enemy')})(),effects:[g()]};if((r.costMp>0||r.costSp>0||r.costHp>0)&&(o.cost={},r.costMp>0&&(o.cost.mp=r.costMp),r.costSp>0&&(o.cost.sp=r.costSp),r.costHp>0&&(o.cost.hp=r.costHp)),r.hitCount>1){o.hitCount=r.hitCount;const e=1/r.hitCount;o.hitDamageRatio=Array(r.hitCount).fill(e)}50!==r.aiWeight&&(o.aiWeight=r.aiWeight);try{n.skills[l]=o,e.saveData(),await a('学习成功',`已学会技能: ${o.name}`),t('created',o),m(),t('close')}catch(e){console.error('Failed to create skill:',e)}}}}}),YR=Za({name:'DebugModal',components:{ItemCreatorModal:iR,SkillCreatorModal:(0,$u.A)(XR,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-100 flex items-center justify-center bg-black/80 px-2',onClick:t[26]||(t[26]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',cR,[Rn(' Header '),Mn('div',dR,[t[27]||(t[27]=Mn('h2',{class:'text-sm font-bold text-purple-400 md:text-base'},'⚡ 创建自定义技能',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'✕')]),Rn(' Body '),Mn('div',uR,[Rn(' 基础信息 '),Mn('div',pR,[t[36]||(t[36]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'📋 基础信息',-1)),Rn(' 名称 '),Mn('div',null,[t[28]||(t[28]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'技能名称 *',-1)),xa(Mn('input',{'onUpdate:modelValue':t[1]||(t[1]=t=>e.form.name=t),type:'text',placeholder:'输入技能名称...',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.name]])]),Rn(' 类型和等级 '),Mn('div',mR,[Mn('div',null,[t[30]||(t[30]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'技能类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.form.type=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[29]||(t[29]=[Mn('option',{value:'active'},'主动',-1),Mn('option',{value:'passive'},'被动',-1)])],512),[[bl,e.form.type]])]),Mn('div',null,[t[32]||(t[32]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'技能等级',-1)),xa(Mn('select',{'onUpdate:modelValue':t[3]||(t[3]=t=>e.form.tier=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[31]||(t[31]=[Mn('option',{value:1},'T1 杂兵',-1),Mn('option',{value:2},'T2 精英',-1),Mn('option',{value:3},'T3 Boss',-1)])],512),[[bl,e.form.tier,void 0,{number:!0}]])]),Mn('div',null,[t[33]||(t[33]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'冷却回合',-1)),xa(Mn('input',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.form.cooldown=t),type:'number',min:'0',max:'20',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.cooldown,void 0,{number:!0}]])])]),Rn(' 图标和描述 '),Mn('div',gR,[Mn('div',null,[t[34]||(t[34]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'图标',-1)),xa(Mn('input',{'onUpdate:modelValue':t[5]||(t[5]=t=>e.form.icon=t),type:'text',placeholder:'⚔️',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-center text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.icon]])]),Mn('div',hR,[t[35]||(t[35]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'技能描述',-1)),xa(Mn('input',{'onUpdate:modelValue':t[6]||(t[6]=t=>e.form.description=t),type:'text',placeholder:'技能效果说明...',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.description]])])]),Rn(' 技能等级说明 '),t[37]||(t[37]=Mn('p',{class:'text-[10px] text-gray-500'},' 💡 技能等级(Tier): T1=杂兵级, T2=精英级, T3=Boss级。主要用于技能分类和UI显示。 ',-1))]),Rn(' 目标设置 (仅主动技能) '),'active'===e.form.type?(yn(),Sn('div',fR,[t[42]||(t[42]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'🎯 目标设置',-1)),Mn('div',vR,[Mn('div',null,[t[39]||(t[39]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'目标类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.form.targetType=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[38]||(t[38]=[Mn('option',{value:'single'},'单体',-1),Mn('option',{value:'all'},'群体',-1),Mn('option',{value:'self'},'自身',-1),Mn('option',{value:'random'},'随机',-1)])],512),[[bl,e.form.targetType]])]),Mn('div',null,[t[41]||(t[41]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'有效目标',-1)),xa(Mn('select',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.form.validTargets=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[40]||(t[40]=[Mn('option',{value:'enemy'},'敌方',-1),Mn('option',{value:'ally'},'友方',-1),Mn('option',{value:'any'},'任意',-1)])],512),[[bl,e.form.validTargets]])])])])):Rn('v-if',!0),Rn(' 消耗设置 '),Mn('div',yR,[t[46]||(t[46]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'💎 消耗',-1)),Mn('div',bR,[Mn('div',null,[t[43]||(t[43]=Mn('label',{class:'mb-0.5 block text-[10px] text-blue-400 md:text-xs'},'MP 消耗',-1)),xa(Mn('input',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.form.costMp=t),type:'number',min:'0',placeholder:'0',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.costMp,void 0,{number:!0}]])]),Mn('div',null,[t[44]||(t[44]=Mn('label',{class:'mb-0.5 block text-[10px] text-green-400 md:text-xs'},'SP 消耗',-1)),xa(Mn('input',{'onUpdate:modelValue':t[10]||(t[10]=t=>e.form.costSp=t),type:'number',min:'0',placeholder:'0',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.costSp,void 0,{number:!0}]])]),Mn('div',null,[t[45]||(t[45]=Mn('label',{class:'mb-0.5 block text-[10px] text-red-400 md:text-xs'},'HP 消耗',-1)),xa(Mn('input',{'onUpdate:modelValue':t[11]||(t[11]=t=>e.form.costHp=t),type:'number',min:'0',placeholder:'0',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.costHp,void 0,{number:!0}]])])])]),Rn(' 快速效果设置 '),Mn('div',xR,[t[60]||(t[60]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'✨ 技能效果',-1)),Mn('div',wR,[Rn(' 效果类型 '),Mn('div',kR,[t[48]||(t[48]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'效果类型',-1)),xa(Mn('select',{'onUpdate:modelValue':t[12]||(t[12]=t=>e.form.effectType=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[47]||(t[47]=[Mn('option',{value:'damage'},'⚔️ 伤害',-1),Mn('option',{value:'heal'},'❤️ 治疗',-1),Mn('option',{value:'buff'},'⬆️ 增益',-1),Mn('option',{value:'debuff'},'⬇️ 减益',-1),Mn('option',{value:'shield'},'🛡️ 护盾',-1)])],512),[[bl,e.form.effectType]])]),Rn(' 数值 (伤害/治疗/护盾) '),['damage','heal','shield'].includes(e.form.effectType)?(yn(),Sn('div',SR,[t[49]||(t[49]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'数值 (支持骰子: 2d6+5)',-1)),xa(Mn('input',{'onUpdate:modelValue':t[13]||(t[13]=t=>e.form.effectValue=t),type:'text',placeholder:'1d8+5',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.effectValue]])])):Rn('v-if',!0),Rn(' 增益效果配置 '),'buff'===e.form.effectType?(yn(),Sn('div',_R,[Mn('div',null,[t[51]||(t[51]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'增益类型 *',-1)),xa(Mn('select',{'onUpdate:modelValue':t[14]||(t[14]=t=>e.form.buffType=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[50]||(t[50]=[Mn('option',{value:''},'-- 选择增益类型 --',-1),Mn('optgroup',{label:'📊 属性增强'},[Mn('option',{value:'atk_up'},'⚔️ 攻击提升'),Mn('option',{value:'def_up'},'🛡️ 防御提升'),Mn('option',{value:'spd_up'},'💨 速度提升'),Mn('option',{value:'crit_up'},'💥 暴击率提升'),Mn('option',{value:'crit_dmg_up'},'🎯 暴击伤害提升')],-1),Mn('optgroup',{label:'💪 战斗增益'},[Mn('option',{value:'dmg_bonus'},'📈 伤害加成'),Mn('option',{value:'heal_bonus'},'💚 治疗加成'),Mn('option',{value:'lifesteal'},'🧛 吸血'),Mn('option',{value:'reflect'},'↩️ 反伤'),Mn('option',{value:'thorns'},'🌵 荆棘')],-1),Mn('optgroup',{label:'🔮 持续恢复'},[Mn('option',{value:'regen'},'💖 生命再生'),Mn('option',{value:'hot'},'✨ 持续治疗')],-1),Mn('optgroup',{label:'🛡️ 特殊状态'},[Mn('option',{value:'invincible'},'⭐ 无敌'),Mn('option',{value:'stealth'},'👻 潜行'),Mn('option',{value:'counter'},'⚔️ 反击')],-1)])],512),[[bl,e.form.buffType]])]),Mn('div',CR,[Mn('div',null,[Mn('label',IR,oe(e.isHotBuff?'HOT治疗量 (每回合)':'效果数值 (%)'),1),xa(Mn('input',{'onUpdate:modelValue':t[15]||(t[15]=t=>e.form.buffValue=t),type:'text',placeholder:e.isHotBuff?'1d4+3':'30',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,8,TR),[[fl,e.form.buffValue]])]),Mn('div',null,[t[52]||(t[52]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'持续回合',-1)),xa(Mn('input',{'onUpdate:modelValue':t[16]||(t[16]=t=>e.form.statusDuration=t),type:'number',min:'1',max:'20',placeholder:'3',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.statusDuration,void 0,{number:!0}]])])]),t[53]||(t[53]=Mn('p',{class:'text-[10px] text-gray-500'},'💡 选择预设类型可确保效果在战斗中正确生效',-1))])):Rn('v-if',!0),Rn(' 减益效果配置 '),'debuff'===e.form.effectType?(yn(),Sn('div',AR,[Mn('div',null,[t[55]||(t[55]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'减益类型 *',-1)),xa(Mn('select',{'onUpdate:modelValue':t[17]||(t[17]=t=>e.form.debuffType=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[54]||(t[54]=[Mn('option',{value:''},'-- 选择减益类型 --',-1),Mn('optgroup',{label:'📉 属性削弱'},[Mn('option',{value:'atk_down'},'⚔️ 攻击降低'),Mn('option',{value:'def_down'},'🛡️ 防御降低 (破甲)'),Mn('option',{value:'spd_down'},'💨 速度降低'),Mn('option',{value:'crit_down'},'💥 暴击降低')],-1),Mn('optgroup',{label:'⚠️ 控制效果'},[Mn('option',{value:'stun'},'💫 眩晕 (无法行动)'),Mn('option',{value:'silence'},'🔇 沉默 (无法技能)'),Mn('option',{value:'fear'},'😱 恐惧 (无法行动)'),Mn('option',{value:'sleep'},'😴 睡眠 (受伤解除)'),Mn('option',{value:'taunt'},'😤 嘲讽 (强制攻击)'),Mn('option',{value:'blind'},'👁️ 致盲 (降低命中)'),Mn('option',{value:'slow'},'🐌 减速 (行动延迟)')],-1),Mn('optgroup',{label:'🔥 持续伤害 (DOT)'},[Mn('option',{value:'poison'},'☠️ 中毒'),Mn('option',{value:'bleed'},'🩸 流血'),Mn('option',{value:'burn'},'🔥 燃烧'),Mn('option',{value:'corrode'},'💀 腐蚀')],-1),Mn('optgroup',{label:'💔 特殊减益'},[Mn('option',{value:'vulnerable'},'💢 易伤 (受伤增加)'),Mn('option',{value:'heal_block'},'🚫 禁疗'),Mn('option',{value:'marked'},'🎯 标记 (被集火)'),Mn('option',{value:'weak'},'😩 虚弱'),Mn('option',{value:'curse'},'☠️ 诅咒')],-1)])],512),[[bl,e.form.debuffType]])]),Mn('div',MR,[Mn('div',null,[Mn('label',ER,oe(e.isDotDebuff?'DOT伤害 (每回合)':e.isControlDebuff?'无需数值':'效果数值 (%)'),1),xa(Mn('input',{'onUpdate:modelValue':t[18]||(t[18]=t=>e.form.debuffValue=t),type:'text',placeholder:e.isDotDebuff?'1d4+2':e.isControlDebuff?'-':'30',disabled:e.isControlDebuff&&!e.hasModifier,class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none disabled:opacity-50 md:text-sm'},null,8,$R),[[fl,e.form.debuffValue]])]),Mn('div',null,[t[56]||(t[56]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'持续回合',-1)),xa(Mn('input',{'onUpdate:modelValue':t[19]||(t[19]=t=>e.form.statusDuration=t),type:'number',min:'1',max:'20',placeholder:'3',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.statusDuration,void 0,{number:!0}]])])]),t[57]||(t[57]=Mn('p',{class:'text-[10px] text-gray-500'},'💡 控制效果会阻止敌人行动，DOT效果每回合造成伤害',-1))])):Rn('v-if',!0),Rn(' 元素属性 (仅伤害) '),'damage'===e.form.effectType?(yn(),Sn('div',DR,[t[59]||(t[59]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'元素属性',-1)),xa(Mn('select',{'onUpdate:modelValue':t[20]||(t[20]=t=>e.form.element=t),class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white focus:border-purple-500 focus:outline-none md:text-sm'},[...t[58]||(t[58]=[Mn('option',{value:''},'无',-1),Mn('option',{value:'physical'},'🗡️ 物理',-1),Mn('option',{value:'fire'},'🔥 火焰',-1),Mn('option',{value:'ice'},'❄️ 冰霜',-1),Mn('option',{value:'lightning'},'⚡ 雷电',-1),Mn('option',{value:'poison'},'☠️ 毒素',-1),Mn('option',{value:'holy'},'✨ 神圣',-1),Mn('option',{value:'dark'},'🌑 暗影',-1)])],512),[[bl,e.form.element]])])):Rn('v-if',!0)])]),Rn(' 连击设置 (高级) '),Mn('div',PR,[Mn('button',{type:'button',class:'flex w-full items-center gap-1 text-xs font-bold text-gray-400 hover:text-white md:text-sm',onClick:t[21]||(t[21]=t=>e.showAdvanced=!e.showAdvanced)},[Mn('span',{class:ee(['transition-transform',{'rotate-90':e.showAdvanced}])},'▶',2),t[61]||(t[61]=Pn(' ⚙️ 高级选项 ',-1))]),e.showAdvanced?(yn(),Sn('div',NR,[Rn(' 连击 '),Mn('div',RR,[Mn('div',null,[t[62]||(t[62]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'连击次数',-1)),xa(Mn('input',{'onUpdate:modelValue':t[22]||(t[22]=t=>e.form.hitCount=t),type:'number',min:'1',max:'10',placeholder:'1',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.hitCount,void 0,{number:!0}]])]),Mn('div',null,[t[63]||(t[63]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:text-xs'},'AI权重',-1)),xa(Mn('input',{'onUpdate:modelValue':t[23]||(t[23]=t=>e.form.aiWeight=t),type:'number',min:'0',max:'100',placeholder:'50',class:'w-full rounded border border-gray-600 bg-[#2f3136] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-purple-500 focus:outline-none md:text-sm'},null,512),[[fl,e.form.aiWeight,void 0,{number:!0}]])])])])):Rn('v-if',!0)]),Rn(' 预览 '),Mn('div',jR,[t[64]||(t[64]=Mn('h3',{class:'text-xs font-bold text-gray-300 md:text-sm'},'👁️ 预览',-1)),Mn('div',LR,[Mn('div',BR,[Mn('span',OR,oe(e.form.icon||'⚡'),1),Mn('div',null,[Mn('div',qR,oe(e.form.name||'未命名技能'),1),Mn('div',UR,oe('active'===e.form.type?'主动':'被动')+' · T'+oe(e.form.tier)+' · CD:'+oe(e.form.cooldown),1)])]),e.form.description?(yn(),Sn('div',VR,oe(e.form.description),1)):Rn('v-if',!0),Mn('div',FR,'效果: '+oe(e.getEffectPreview()),1),e.isEffectValid?Rn('v-if',!0):(yn(),Sn('div',HR,'⚠️ '+oe(e.getEffectError()),1))])])]),Rn(' Footer '),Mn('div',GR,[Mn('button',{type:'button',class:'rounded border border-gray-600 bg-transparent px-3 py-1.5 text-xs font-medium text-gray-300 transition-colors hover:bg-gray-700 md:text-sm',onClick:t[24]||(t[24]=t=>e.$emit('close'))},' 取消 '),Mn('button',{type:'button',class:'rounded bg-purple-600 px-3 py-1.5 text-xs font-medium text-white transition-colors hover:bg-purple-500 disabled:opacity-50 md:text-sm',disabled:!e.isValid,onClick:t[25]||(t[25]=(...t)=>e.createSkill&&e.createSkill(...t))},' 学习技能 ',8,zR)])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-384b1589']])},props:{visible:{type:Boolean,default:!1},currentUserInput:{type:String,default:''}},emits:['close'],setup(e,{emit:a}){const{alert:s,confirm:n,success:r,warning:l,danger:o}=Xp(),i=$t('status'),c=$t(''),d=$t(!1),u=$t('story'),p=$t({hp:{current:0,max:0},mp:{current:0,max:0},sp:{current:0,max:0}}),m=$t({}),g=$t(''),h=wu.filter(e=>'money'!==e.category&&!e.category.includes('Skill')),f=$t(''),v=wu.filter(e=>e.category.includes('Skill')),y=$t(''),b=$t(!1),x=$t(!1),w=[/<thinking>[\s\S]*?<\/thinking>/gi,/<think>[\s\S]*?<\/think>/gi,/<thought>[\s\S]*?<\/thought>/gi],k={content:/<content>([\s\S]*?)<\/content>/i,summary:/<summary>([\s\S]*?)<\/summary>/i,places:/<places>([\s\S]*?)<\/places>/i,npcs:/<npcs>([\s\S]*?)<\/npcs>/i,objects:/<objects>([\s\S]*?)<\/objects>/i,options:/<options>([\s\S]*?)<\/options>/i},S=(e,t)=>{const a=k[t];if(!a)return null;const s=e.match(a);return s?s[1].trim():null},C=(e,t)=>{const a=(e=>{let t=e;for(const e of w)t=t.replace(e,'');return t.trim()})(e),s=[];if('summary'===t){const e=S(a,'summary');e&&s.push(`[回顾] ${e}`)}else if('story'===t){const e=S(a,'content'),t=S(a,'summary');e&&s.push(e.substring(0,100)+(e.length>100?'...':'')),t&&s.push(`<summary>${t}</summary>`)}else{const e=S(a,'content'),t=S(a,'summary'),n=S(a,'places'),r=S(a,'npcs'),l=S(a,'objects'),o=S(a,'options');e&&s.push(e.substring(0,100)+(e.length>100?'...':'')),t&&s.push(`<summary>${t}</summary>`),n&&s.push(`<places>${n}</places>`),r&&s.push(`<npcs>${r}</npcs>`),l&&s.push(`<objects>${l}</objects>`),o&&s.push(`<options>${o}</options>`)}return 0===s.length?a.substring(0,100)+(a.length>100?'...':''):s.join('\n')},I=async()=>{d.value=!0;try{if('tool'===u.value)return void await T();const t=Ll.serviceLocator.get('PromptInjector'),a=await t.buildInjectionParams(void 0,void 0,e.currentUserInput,!0),s=[];s.push('┌─────────────────────────────────────────────────────────────┐'),s.push('│ L1: 冒险笔记 (depth: 60, role: system)                      │'),s.push('└─────────────────────────────────────────────────────────────┘'),a.adventureNotes?s.push(a.adventureNotes):s.push('(空 - 暂无章节总结。每50条AI回复可生成一个章节总结。)');const n=a.summaries.filter(e=>e.summary);if(s.push('\n┌─────────────────────────────────────────────────────────────┐'),s.push(`│ L2: 历史摘要区 (depth: 50, role: assistant, 共${n.length}条)     │`),s.push('└─────────────────────────────────────────────────────────────┘'),n.length>0?(s.push('=== 历史摘要 ==='),n.forEach((e,t)=>{const a=e.summary||'(无summary)';s.push(`${t+1}. ${a.substring(0,100)}${a.length>100?'...':''}`)})):s.push('(空 - 对话轮数不足5轮，无需摘要)'),a.recentDialogs.length>0){const e=[];let t={};for(const s of a.recentDialogs)'user'===s.role?(t.user&&(e.push(t),t={}),t.user=s):'assistant'===s.role&&(t.assistant=s,e.push(t),t={});(t.user||t.assistant)&&e.push(t);const n=e.length,r=2,l=n>r?e.slice(0,-r):[];l.length>0&&(s.push(`\n=== L3a: 剧情正文区 (depth: 5+, content+summary, 不参与扫描, 共${l.length}轮) ===`),l.forEach(e=>{if(e.user){const t=e.user.content;s.push(`[user] ${t.substring(0,50)}${t.length>50?'...':''}`)}if(e.assistant){const t=C(e.assistant.content,'story');s.push(`[assistant] ${t}`)}}));const o=e.slice(-Math.min(r,n));o.length>0&&(s.push(`\n=== L3b: 最新正文区 (depth: 1-4, 完整标签, 参与世界书扫描, 共${o.length}轮) ===`),o.forEach(e=>{if(e.user){const t=e.user.content;s.push(`[user] ${t.substring(0,50)}${t.length>50?'...':''}`)}if(e.assistant){const t=C(e.assistant.content,'latest');s.push(`[assistant] ${t}`)}}))}s.push('\n=== L4: 状态面板 (depth: 3) ==='),a.offlineActions&&a.offlineActions.length>0&&s.push(`[系统事件/离线行为]\n${a.offlineActions.map(e=>`- ${e}`).join('\n')}`);const r=a.playerPanel;let l=`[玩家状态]\n${r.name} Lv.${r.level}\n`;if(r.appearance){const e=e=>{if(!e)return!1;const t=e.trim();return''!==t&&'无'!==t&&'暂无'!==t&&'N/A'!==t&&'-'!==t},t=(t=>{const a=[],s=[];return e(t.hair_color)&&s.push(t.hair_color),e(t.hair_length)&&s.push(t.hair_length),e(t.hair_style)&&s.push(t.hair_style),s.length>0&&a.push(s.join('')),e(t.eye_color)&&a.push(`${t.eye_color}眼眸`),e(t.height)&&a.push(`身高${t.height}`),e(t.body_build)&&a.push(`${t.body_build}身材`),e(t.skin_tone)&&a.push(`${t.skin_tone}肤色`),e(t.face_features)&&a.push(t.face_features),e(t.special_marks)&&a.push(t.special_marks),e(t.racial_traits)&&a.push(t.racial_traits),a.join(', ')})(r.appearance);t&&(l+=`外貌: ${t}\n`)}r.world&&(l+=`时间: ${r.world.time} | 天气: ${r.world.weather}\n`),l+=`位置: ${r.location}\n`,l+=`HP: ${r.hp.current}/${r.hp.max} | MP: ${r.mp.current}/${r.mp.max}`,r.sp&&(l+=` | SP: ${r.sp.current}/${r.sp.max}`);l+=`\n钱币: ${(e=>{const t=Math.floor(e/1e4),a=Math.floor(e%1e4/100),s=e%100,n=[];return t>0&&n.push(`${t}金`),a>0&&n.push(`${a}银`),(s>0||0===n.length)&&n.push(`${s}铜`),`${e} (${n.join(', ')})`})(r.gold)}`,l+=`\n属性: 力量${r.attributes.strength} 敏捷${r.attributes.agility} 智力${r.attributes.intelligence} 魅力${r.attributes.charisma}`,r.attributes.speed&&(l+=` 速度${r.attributes.speed}`),s.push(l);const o={weapon_main:'主手武器',weapon_off:'副手武器',head:'头部',outer:'外套',upper:'上装',underwear:'内衣',lower:'下装',underpants:'内裤',socks:'袜子',shoes:'鞋子',hands:'手部',accessory:'饰品',accessory_1:'饰品1',accessory_2:'饰品2',accessory_3:'饰品3'},i=[];if(r.equipment)for(const[e,t]of Object.entries(r.equipment)){const a=o[e]||e;if(t){let e=`${t.name}`;t.rarity&&(e+=` [${t.rarity}]`),t.description&&(e+=` - ${t.description}`),i.push(`${a}：${e}`)}else i.push(`${a}：空`)}i.length>0&&s.push(`=== [装备栏] ===\n${i.join('\n')}`);const d=Ll.serviceLocator.get('SaveService'),p=Object.values(d.getGameState()?.skills||{});if(p.length>0){const e=p.map(e=>{let t=e.icon?`${e.icon} ${e.name}`:e.name;return e.type&&(t+='passive'===e.type?' (被动)':' (主动)'),e.description&&(t+=` - ${e.description}`),`- ${t}`});s.push(`=== [技能栏] ===\n${e.join('\n')}`)}else s.push('=== [技能栏] ===\n(空)');if(r.inventory&&r.inventory.length>0){const e=r.inventory.map(e=>{let t=`${e.name} x${e.count}`;return e.rarity&&(t+=` [${e.rarity}]`),e.value&&(t+=` (价值:${e.value})`),e.description&&(t+=` - ${e.description}`),`- ${t}`});s.push(`=== [物品栏] ===\n${e.join('\n')}`)}else s.push('=== [物品栏] ===\n(空)');if(a.teammates&&a.teammates.length>0){const e=a.teammates.map(e=>{let t=`- ${e.name} Lv.${e.level} (${e.class}): HP ${e.hp.current}/${e.hp.max}`;return e.mp&&(t+=` | MP ${e.mp.current}/${e.mp.max}`),t+=` [${e.status}]`,e.appearance&&(t+=` 外观: ${e.appearance}`),t});s.push(`[队伍成员]\n${e.join('\n')}`)}if(s.push('\n=== L4.5: 人际关系角色 (depth: 4) ==='),a.matchedCharacters&&a.matchedCharacters.length>0){const e=e=>{switch(e){case'userInput':return'用户输入';case'dialog':return'近期对话';case'scene':return'场景NPC';default:return e}},t=e=>e>=80?'亲密':e>=50?'友好':e>=20?'好感':e>=0?'中立':e>=-30?'冷淡':e>=-60?'敌意':'仇恨';s.push(`[相关角色档案] (共${a.matchedCharacters.length}人)`),a.matchedCharacters.forEach(a=>{const n=a.character;let r=`\n【${n.name}】 [来源: ${e(a.matchedIn)}, 优先级: ${a.priority}]`;n.occupation&&(r+=`\n  身份: ${n.occupation}`),n.appearance&&(r+=`\n  外貌: ${n.appearance.substring(0,50)}${n.appearance.length>50?'...':''}`),n.personality&&(r+=`\n  性格: ${n.personality.substring(0,50)}${n.personality.length>50?'...':''}`),r+=`\n  好感度: ${n.rel} (${t(n.rel)})`,n.relType&&(r+=` | 关系: ${n.relType}`),n.status&&(r+=`\n  状态: ${n.status}`),s.push(r)})}else s.push('(空 - 当前对话中未检测到已记录的人际关系角色)'),s.push('提示: 在人际关系模态框中星标角色后，当对话中提到该角色名时会自动注入其档案。');a.currentUserInput&&(s.push('\n=== L5: 用户最新输入 (depth: 0) ==='),s.push(`[user] ${a.currentUserInput}`)),s.push('\n=== 说明 ===\n此预览基于 PromptInjector 的真实数据构建。\n实际注入时，这些内容会被插入到聊天历史的不同深度。'),c.value=s.join('\n\n')}catch(e){c.value=`// 加载失败: ${e.message}\n// 请确保 PromptInjector 已初始化`}finally{d.value=!1}},T=async()=>{try{const t=Ll.serviceLocator.get('SaveService').getGameState();if(!t)return void(c.value='// 无法加载：游戏状态未初始化');const a=(Zi||(Zi=new Ji),Zi),s=e.currentUserInput||'（玩家输入示例）';let n=[];try{const e=Ll.serviceLocator.get('OfflineActionService');e&&'function'==typeof e.getPreviewSummary&&(n=e.getPreviewSummary())}catch{}const r=await a.buildPreviewPrompts(t,s,void 0,n);c.value=r}catch(e){c.value=`// 加载失败: ${e.message}`}finally{d.value=!1}},A=()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(e){e.player&&(p.value={hp:{...e.player.stats.hp},mp:{...e.player.stats.mp},sp:{...e.player.stats.sp}},m.value={...e.player.attributes});try{y.value=(e=>{const t=[];t.push('# ════════════════════════════════════════════════════════════════'),t.push('# 📜 游戏存档 - YAML 格式'),t.push('# 修改后点击"应用修改"按钮保存更改'),t.push('# ════════════════════════════════════════════════════════════════'),t.push(''),e.player&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 👤 玩家信息                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({player:e.player},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.world&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 🌍 世界信息                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({world:e.world},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.inventory&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 🎒 背包物品                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({inventory:e.inventory},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.skills&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ ⚡ 技能列表                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({skills:e.skills},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.allies&&e.allies.length>0&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 👥 队友信息                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({allies:e.allies},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.combat&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ ⚔️ 战斗状态                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({combat:e.combat},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.relationships&&e.relationships.length>0&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 💕 人际关系                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({relationships:e.relationships},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.quests&&e.quests.length>0&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 📋 任务列表                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({quests:e.quests},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.notepad&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 📝 记事本                                                     │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({notepad:e.notepad},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))),e.logs&&e.logs.length>0&&(t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 📜 游戏日志                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘'),t.push(jsyaml.dump({logs:e.logs},{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1})));const a=Object.keys(e).filter(e=>!['player','world','inventory','skills','allies','combat','relationships','quests','notepad','logs'].includes(e));if(a.length>0){t.push('# ┌──────────────────────────────────────────────────────────────┐'),t.push('# │ 📦 其他数据                                                   │'),t.push('# └──────────────────────────────────────────────────────────────┘');const s={};a.forEach(t=>{s[t]=e[t]}),t.push(jsyaml.dump(s,{indent:2,lineWidth:-1,quotingType:'"',forceQuotes:!1}))}return t.join('\n')})(e)}catch(t){y.value=`# YAML 转换失败，使用 JSON 格式\n${JSON.stringify(e,null,2)}`}}},M=()=>{const e=Ll.serviceLocator.get('SaveService');return e.getGameState()?.player},E=()=>{Ll.serviceLocator.get('SaveService').saveData()},D=e=>({hp:{current:25+4*e,max:25+4*e},mp:{current:20+2*e,max:20+2*e},sp:{current:25+3*e,max:25+3*e}}),P=e=>{const a=e.level||1;return{id:t(),name:'测试敌人',isPlayer:!1,level:a,stats:D(a),attributes:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10,SPD:8},statModifiers:{},statusEffects:[],shields:[],skills:[],isDead:!1,isStunned:!1,hasActed:!1,...e}};return _a(()=>e.visible,e=>{e&&(A(),'prompts'===i.value&&I())}),_a(i,t=>{'prompts'===t&&e.visible&&I()}),_a(u,()=>{'prompts'===i.value&&e.visible&&I()}),us(()=>{e.visible&&A()}),{activeTab:i,tabs:[{id:'status',label:'❤️ 状态',mobileLabel:'❤️ 状态'},{id:'attributes',label:'💪 属性',mobileLabel:'💪 属性'},{id:'items',label:'🎒 物品',mobileLabel:'🎒 物品'},{id:'skills',label:'⚡ 技能',mobileLabel:'⚡ 技能'},{id:'combat',label:'⚔️ 战斗测试',mobileLabel:'⚔️ 战斗'},{id:'prompts',label:'📝 提示词',mobileLabel:'📝 提示词'},{id:'raw',label:'📄 YAML',mobileLabel:'📄 YAML'}],tempState:p,tempAttributes:m,selectedPresetId:g,presetItems:h,selectedSkillId:f,presetSkills:v,rawYaml:y,refreshYaml:()=>{A()},pendingPrompts:c,promptPreviewLoading:d,promptPreviewMode:u,loadPendingPrompts:I,applyStat:async e=>{const t=M();t&&(t.stats[e].current=p.value[e].current,t.stats[e].max=p.value[e].max,E(),await r('修改成功',`${e.toUpperCase()} 已更新！`))},fullHeal:()=>{const e=M();e&&(e.stats.hp.current=e.stats.hp.max,e.stats.mp.current=e.stats.mp.max,e.stats.sp.current=e.stats.sp.max,p.value.hp.current=e.stats.hp.max,p.value.mp.current=e.stats.mp.max,p.value.sp.current=e.stats.sp.max,E())},applyAttributes:async()=>{const e=M();e&&(e.attributes={...m.value},E(),await r('修改成功','属性已更新！'))},addMoney:async e=>{Ll.serviceLocator.get('InventoryService').addCurrency(e),await r('添加成功',`已添加 ${e} 铜币`)},addPresetItem:async()=>{if(!g.value)return;const e=wu.find(e=>e.id===g.value);if(e){const t=Ll.serviceLocator.get('InventoryService'),a=JSON.parse(JSON.stringify(e.data));delete a.id,t.addItem(a),await r('添加成功',`已添加: ${e.name}`)}},clearInventory:async()=>{if(await o('清空背包','确定要删除所有物品吗？此操作无法撤销！')){const e=Ll.serviceLocator.get('SaveService').getGameState();e&&(e.inventory.items={},E(),await r('操作成功','背包已清空'))}},addPresetSkill:async()=>{if(!f.value)return;const e=wu.find(e=>e.id===f.value);if(e){const t=Ll.serviceLocator.get('SaveService').getGameState();if(t){if(Object.values(t.skills).some(t=>t.name===e.name))return void await l('无法学习','已经学会该技能！');const a=JSON.parse(JSON.stringify(e.data)),s=a.id||`skill_${Date.now()}`;a.id=s,t.skills[s]=a,E(),await r('学习成功',`已学会: ${e.name}`)}}},injectRawYaml:async()=>{try{const e=jsyaml.load(y.value);if(!e||'object'!=typeof e)return void await s('YAML 错误','无效的 YAML 格式或数据为空');const t=Ll.serviceLocator.get('SaveService');if(e.player&&e.world){if(await n('覆盖状态','检测到完整游戏状态。是否覆盖当前状态？\n(不会刷新页面，直接应用修改)',{variant:'warning',confirmText:'确定覆盖',cancelText:'取消'})){const a=t.getGameState();a&&(Object.assign(a.player,e.player),Object.assign(a.inventory,e.inventory),Object.assign(a.world,e.world),e.skills&&(Object.keys(a.skills).forEach(e=>delete a.skills[e]),Array.isArray(e.skills)?e.skills.forEach(e=>{const t=e.id||`skill_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;a.skills[t]={...e,id:t}}):Object.assign(a.skills,e.skills)),void 0!==e.allies&&a.allies&&(Object.keys(a.allies).forEach(e=>delete a.allies[e]),Object.assign(a.allies,e.allies||{})),void 0!==e.combat&&(a.combat=e.combat),void 0!==e.relationships&&(a.relationships=e.relationships),void 0!==e.quests&&(a.quests=e.quests),void 0!==e.notepad&&(a.notepad=e.notepad),void 0!==e.logs&&(a.logs=e.logs),t.saveData(),A(),await r('应用成功','状态已更新！无需刷新页面。'))}}else{Ll.serviceLocator.get('InventoryService').addItem(e),await r('添加成功','物品已添加到背包！')}}catch(e){await s('YAML 错误','无效的 YAML: '+e.message)}},startTestBattle:e=>{const s=Ll.serviceLocator.get('BattleService');let n=[];switch(e){case'slime':n=[P({name:'腐蚀史莱姆',level:2,attributes:{STR:8,DEX:5,CON:12,SPD:8},skills:[{id:'acid_spit',name:'酸液喷射',type:'active',tier:1,tags:['poison','magic'],cooldown:2,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+2',tags:['poison']}]}]})];break;case'skeleton_elite':n=[P({name:'骷髅守卫',level:5,attributes:{STR:15,DEX:10,CON:15,SPD:9},skills:[{id:'heavy_slash',name:'重斩',type:'active',tier:2,tags:['physical','heavy'],cooldown:3,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d8+5',tags:['physical']}]}]})];break;case'dragon_boss':n=[P({name:'幼龙',level:10,attributes:{STR:20,DEX:12,CON:20,INT:15,SPD:10},skills:[{id:'breath',name:'火焰吐息',type:'active',tier:3,tags:['fire','magic','heavy'],cooldown:4,target:'all_enemies',effects:[{trigger:'immediate',action:'damage',target:'all_enemies',value:'3d6+10',tags:['fire']}]},{id:'bite',name:'撕咬',type:'active',tier:3,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+8',tags:['physical']}]}]})];break;case'multi_enemy':n=[P({name:'灰狼 A',level:3,attributes:{STR:12,DEX:14,CON:10,SPD:10},skills:[{id:'bite',name:'撕咬',type:'active',tier:1,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['physical']}]}]}),P({name:'灰狼 B',level:3,attributes:{STR:12,DEX:14,CON:10,SPD:9},skills:[{id:'bite',name:'撕咬',type:'active',tier:1,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['physical']}]}]}),P({name:'灰狼 C',level:3,attributes:{STR:12,DEX:14,CON:10,SPD:8},skills:[{id:'bite',name:'撕咬',type:'active',tier:1,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['physical']}]}]})];break;case'shield_value':n=[P({name:'护盾守卫',level:4,attributes:{STR:12,DEX:8,CON:16,SPD:7},shields:[{id:t(),name:'魔法护盾',value:100,max:100,type:'value',priority:50}],skills:[{id:'slam',name:'重击',type:'active',tier:1,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+4',tags:['physical']}]}]})];break;case'shield_count':n=[P({name:'圣光骑士',level:5,attributes:{STR:14,DEX:10,CON:14,SPD:8},shields:[{id:t(),name:'神圣庇护',value:3,max:3,type:'count',priority:100}],skills:[{id:'smite',name:'神圣打击',type:'active',tier:2,tags:['holy','physical'],cooldown:2,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+5',tags:['holy']}]}]})];break;case'poison_enemy':n=[P({name:'毒蛇',level:3,attributes:{STR:8,DEX:16,CON:10,SPD:11},skills:[{id:'venomous_bite',name:'毒牙',type:'active',tier:1,tags:['poison','physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d4+2',tags:['physical']},{trigger:'immediate',action:'debuff',target:'target',statusName:'中毒',duration:3,dot:5,tags:['poison']}]}]})];break;case'burning_enemy':n=[P({name:'火焰精灵',level:4,attributes:{STR:6,DEX:14,CON:10,INT:16,SPD:10},skills:[{id:'fireball',name:'火球术',type:'active',tier:2,tags:['fire','magic'],cooldown:2,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+4',tags:['fire']},{trigger:'immediate',action:'debuff',target:'target',statusName:'燃烧',duration:2,dot:8,tags:['fire']}]}]})];break;case'multi_hit_enemy':n=[P({name:'剑舞者',level:5,attributes:{STR:14,DEX:18,CON:12,SPD:12},skills:[{id:'blade_dance',name:'剑舞',type:'active',tier:2,tags:['physical'],cooldown:3,target:'single_enemy',hitCount:3,hitDamageRatio:[.4,.3,.3],effects:[{trigger:'immediate',action:'damage',target:'target',value:'3d4+6',tags:['physical']}]}]})];break;case'counter_enemy':n=[P({name:'荆棘骑士',level:5,attributes:{STR:16,DEX:12,CON:18,SPD:7},counterEffects:[{triggerOn:'on_hit',chance:50,skillId:'counter_slash',maxTriggersPerTurn:2}],skills:[{id:'slash',name:'斩击',type:'active',tier:1,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d8+5',tags:['physical']}]},{id:'counter_slash',name:'反击斩',type:'active',tier:1,tags:['physical','counter'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+3',tags:['physical']}]}]})];break;case'speed_enemy':n=[P({name:'疾风刺客',level:6,attributes:{STR:12,DEX:20,CON:8,SPD:15},skills:[{id:'quick_strike',name:'快速打击',type:'active',tier:2,tags:['physical'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+4',tags:['physical']}]}]})];break;case'slow_enemy':n=[P({name:'石巨人',level:6,attributes:{STR:22,DEX:4,CON:24,SPD:3},skills:[{id:'boulder_smash',name:'巨石粉碎',type:'active',tier:3,tags:['physical','heavy'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'3d8+10',tags:['physical']}]}]})];break;case'summoner_enemy':n=[P({name:'亡灵法师',level:7,attributes:{STR:6,DEX:10,CON:12,INT:18,WIS:16,SPD:8},skills:[{id:'shadow_bolt',name:'暗影箭',type:'active',tier:2,tags:['dark','magic'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d6+6',tags:['dark']}]},{id:'summon_skeleton',name:'召唤骷髅',type:'active',tier:3,tags:['summon','dark'],cooldown:4,target:'self',effects:[{trigger:'immediate',action:'summon',target:'self',summonId:'skeleton_warrior'}]}]})]}n.length>0&&(s.startBattle(n,{isDebugBattle:!0}),a('close'))},givePlayerShield:async e=>{const a=Ll.serviceLocator.get('SaveService').getGameState();if(!a)return void await l('无法操作','游戏状态未初始化！');if(!a.combat)return void await l('无法操作','护盾只能在战斗中添加！请先开始战斗。');const s=a.player;s.shields=s.shields||[],'value'===e?(s.shields.push({id:t(),name:'魔法屏障',value:50,max:50,type:'value',priority:50}),E(),await r('添加成功','已添加 50 点数值护盾')):(s.shields.push({id:t(),name:'绝对防御',value:2,max:2,type:'count',priority:100}),E(),await r('添加成功','已添加 2 次无敌护盾'))},applyDotToPlayer:async e=>{const a=Ll.serviceLocator.get('SaveService').getGameState();if(!a?.combat)return void await l('无法操作','请先开始战斗！');const s=a.player;s.statusEffects=s.statusEffects||[],s.statusEffects.push({id:t(),name:'poison'===e?'剧毒':'灼烧',duration:3,sourceId:'debug',sourceName:'调试',stacks:1,isBuff:!1,tags:['poison'===e?'poison':'fire'],damagePerAction:10}),E(),await r('施加成功',`已对玩家施加${'poison'===e?'剧毒':'灼烧'} (每回合10点伤害, 持续3回合)`)},applyHotToPlayer:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e?.combat)return void await l('无法操作','请先开始战斗！');const a=e.player;a.statusEffects=a.statusEffects||[],a.statusEffects.push({id:t(),name:'生命恢复',duration:5,sourceId:'debug',sourceName:'调试',stacks:1,isBuff:!0,tags:['hp'],healPerAction:15}),E(),await r('施加成功','已对玩家施加生命恢复 (每回合15点治疗, 持续5回合)')},learnMultiHitSkill:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e)return;e.skills.flurry_of_blows?await l('无法学习','已经学会该技能！'):(e.skills.flurry_of_blows={name:'连环拳',type:'active',tier:2,tags:['physical','multi_hit'],cooldown:3,target:'single_enemy',hitCount:4,hitDamageRatio:[.3,.25,.25,.2],effects:[{trigger:'immediate',action:'damage',target:'target',value:'2d4+4',tags:['physical']}]},E(),await r('学习成功','已学会技能：连环拳 (4连击)'))},givePlayerCounter:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e?.combat)return void await l('无法操作','请先开始战斗！');const t=e.player;t.counterEffects=t.counterEffects||[],t.counterEffects.push({triggerOn:'on_hit',chance:30,skillId:'counter_attack',maxTriggersPerTurn:1});e.skills.counter_attack||(e.skills.counter_attack={name:'反击',type:'active',tier:1,tags:['physical','counter'],cooldown:0,target:'single_enemy',effects:[{trigger:'immediate',action:'damage',target:'target',value:'1d6+2',tags:['physical']}]}),E(),await r('获得成功','已获得反击能力 (30%几率反击)')},learnAdvanceSkill:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e)return;e.skills.time_acceleration?await l('无法学习','已经学会该技能！'):(e.skills.time_acceleration={name:'时间加速',type:'active',tier:3,tags:['buff','time'],cooldown:5,target:'self',effects:[{trigger:'immediate',action:'advance',target:'self',advancePercent:50}]},E(),await r('学习成功','已学会技能：时间加速 (拉条50%)'))},learnExtraTurnSkill:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e)return;e.skills.second_wind?await l('无法学习','已经学会该技能！'):(e.skills.second_wind={name:'再起之风',type:'active',tier:4,tags:['buff','extra_turn'],cooldown:8,target:'self',effects:[{trigger:'immediate',action:'extra_turn',target:'self'}]},E(),await r('学习成功','已学会技能：再起之风 (获得额外回合)'))},learnSummonSkill:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e)return;e.skills.summon_fire_spirit?await l('无法学习','已经学会该技能！'):(e.skills.summon_fire_spirit={name:'召唤火精灵',type:'active',tier:3,tags:['summon','fire'],cooldown:6,target:'self',effects:[{trigger:'immediate',action:'summon',target:'self',summonId:'fire_totem'}]},E(),await r('学习成功','已学会技能：召唤火精灵'))},learnReviveSkill:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(!e)return;e.skills.resurrection?await l('无法学习','已经学会该技能！'):(e.skills.resurrection={name:'复活术',type:'active',tier:4,tags:['heal','revive'],cooldown:10,target:'single_ally',effects:[{trigger:'immediate',action:'revive',target:'target',reviveHpPercent:50}]},E(),await r('学习成功','已学会技能：复活术 (复活并恢复50% HP)'))},setPlayerLowHp:async()=>{const e=M();e&&(e.stats.hp.current=1,p.value.hp.current=1,E(),await r('设置成功','玩家HP已设置为1'))},clearCombat:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(e){const t=e.player;t.statusEffects&&(t.statusEffects=[]),t.shields&&(t.shields=[]),t.counterEffects&&(t.counterEffects=[]),Object.values(e.skills).forEach(e=>{e.currentCooldown=0}),e.allies&&Object.values(e.allies).forEach(e=>{e.statusEffects&&(e.statusEffects=[]),e.shields&&(e.shields=[]),e.skills&&Object.values(e.skills).forEach(e=>{e.currentCooldown=0})}),e.combat=void 0,E(),await r('操作成功','战斗已强制结束，所有状态效果已清除')}},clearAllEffects:async()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();if(e?.combat){const t=e.player;t.statusEffects=[],t.shields=[],t.counterEffects=[],e.combat.enemies.forEach(e=>{e.statusEffects=[],e.shields=[],e.counterEffects=[]}),E(),await r('操作成功','所有效果已清除')}else await l('无法操作','当前不在战斗中')},showItemCreator:b,showSkillCreator:x}}}),KR=(0,$u.A)(YR,[['render',function(e,t,a,s,n,r){const l=fs('ItemCreatorModal'),o=fs('SkillCreatorModal');return yn(),Sn(pn,null,[(yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'debug-backdrop fixed inset-0 z-70 flex items-center justify-center',onClick:t[54]||(t[54]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',QD,[Rn(' 背景层 '),t[96]||(t[96]=Mn('div',{class:'modal-bg-layer'},null,-1)),t[97]||(t[97]=Mn('div',{class:'modal-noise'},null,-1)),Rn(' Header '),Mn('div',XD,[Rn(' 顶部装饰线 '),t[59]||(t[59]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',YD,[t[58]||(t[58]=Mn('h2',{class:'header-title text-lg font-bold tracking-wider md:text-xl'},'🛠️ 调试控制台',-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[57]||(t[57]=[Mn('span',null,'✕',-1)])])]),Rn(' 底部装饰线 '),t[60]||(t[60]=Mn('div',{class:'header-deco-line mt-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1))]),Rn(' Mobile Tab Bar '),Mn('div',KD,[(yn(!0),Sn(pn,null,xs(e.tabs,t=>(yn(),Sn('button',{key:t.id,class:ee(['mobile-tab shrink-0 px-2 py-1.5 text-[10px] font-medium whitespace-nowrap transition-colors',e.activeTab===t.id?'active':'']),onClick:a=>e.activeTab=t.id},oe(t.mobileLabel),11,JD))),128))]),Rn(' Content Layout '),Mn('div',ZD,[Rn(' Sidebar Navigation (Desktop Only) '),Mn('div',eP,[(yn(!0),Sn(pn,null,xs(e.tabs,t=>(yn(),Sn('button',{key:t.id,class:ee(['sidebar-tab mb-1 w-full rounded px-1.5 py-1.5 text-left text-[10px] font-medium transition-all lg:px-2 lg:py-2 lg:text-sm',e.activeTab===t.id?'active':'']),onClick:a=>e.activeTab=t.id},oe(t.mobileLabel),11,tP))),128))]),Rn(' Main Panel '),Mn('div',aP,[Rn(' TAB: STATUS (HP/MP/SP) '),'status'===e.activeTab?(yn(),Sn('div',sP,[t[67]||(t[67]=Mn('h3',{class:'text-sm font-bold text-white md:text-lg'},'基础状态',-1)),Mn('div',nP,[Rn(' HP '),Mn('div',rP,[t[62]||(t[62]=Mn('label',{class:'mb-1 block text-[10px] font-bold text-red-400 md:mb-2 md:text-sm'},'HP 生命值',-1)),Mn('div',lP,[xa(Mn('input',{'onUpdate:modelValue':t[1]||(t[1]=t=>e.tempState.hp.current=t),type:'number',class:'w-14 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:w-20 md:px-2 md:text-sm'},null,512),[[fl,e.tempState.hp.current,void 0,{number:!0}]]),t[61]||(t[61]=Mn('span',{class:'text-[10px] text-gray-500 md:text-sm'},'/',-1)),xa(Mn('input',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.tempState.hp.max=t),type:'number',class:'w-14 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:w-20 md:px-2 md:text-sm'},null,512),[[fl,e.tempState.hp.max,void 0,{number:!0}]])]),Mn('button',{class:'mt-1.5 w-full rounded bg-red-900/50 px-2 py-1 text-[10px] text-red-200 hover:bg-red-900 md:mt-2 md:text-xs',onClick:t[3]||(t[3]=t=>e.applyStat('hp'))},' 应用修改 ')]),Rn(' MP '),Mn('div',oP,[t[64]||(t[64]=Mn('label',{class:'mb-1 block text-[10px] font-bold text-blue-400 md:mb-2 md:text-sm'},'MP 魔力值',-1)),Mn('div',iP,[xa(Mn('input',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.tempState.mp.current=t),type:'number',class:'w-14 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:w-20 md:px-2 md:text-sm'},null,512),[[fl,e.tempState.mp.current,void 0,{number:!0}]]),t[63]||(t[63]=Mn('span',{class:'text-[10px] text-gray-500 md:text-sm'},'/',-1)),xa(Mn('input',{'onUpdate:modelValue':t[5]||(t[5]=t=>e.tempState.mp.max=t),type:'number',class:'w-14 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:w-20 md:px-2 md:text-sm'},null,512),[[fl,e.tempState.mp.max,void 0,{number:!0}]])]),Mn('button',{class:'mt-1.5 w-full rounded bg-blue-900/50 px-2 py-1 text-[10px] text-blue-200 hover:bg-blue-900 md:mt-2 md:text-xs',onClick:t[6]||(t[6]=t=>e.applyStat('mp'))},' 应用修改 ')]),Rn(' SP '),Mn('div',cP,[t[66]||(t[66]=Mn('label',{class:'mb-1 block text-[10px] font-bold text-green-400 md:mb-2 md:text-sm'},'SP 体力值',-1)),Mn('div',dP,[xa(Mn('input',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.tempState.sp.current=t),type:'number',class:'w-14 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:w-20 md:px-2 md:text-sm'},null,512),[[fl,e.tempState.sp.current,void 0,{number:!0}]]),t[65]||(t[65]=Mn('span',{class:'text-[10px] text-gray-500 md:text-sm'},'/',-1)),xa(Mn('input',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.tempState.sp.max=t),type:'number',class:'w-14 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:w-20 md:px-2 md:text-sm'},null,512),[[fl,e.tempState.sp.max,void 0,{number:!0}]])]),Mn('button',{class:'mt-1.5 w-full rounded bg-green-900/50 px-2 py-1 text-[10px] text-green-200 hover:bg-green-900 md:mt-2 md:text-xs',onClick:t[9]||(t[9]=t=>e.applyStat('sp'))},' 应用修改 ')])]),Mn('div',uP,[Mn('button',{class:'rounded bg-gray-600 px-3 py-1.5 text-[10px] text-white hover:bg-gray-500 md:px-4 md:py-2 md:text-sm',onClick:t[10]||(t[10]=(...t)=>e.fullHeal&&e.fullHeal(...t))},' ✨ 完全恢复 ')])])):Rn('v-if',!0),Rn(' TAB: ATTRIBUTES '),'attributes'===e.activeTab?(yn(),Sn('div',pP,[t[68]||(t[68]=Mn('h3',{class:'text-sm font-bold text-white md:text-lg'},'属性',-1)),Mn('div',mP,[(yn(!0),Sn(pn,null,xs(e.tempAttributes,(t,a)=>(yn(),Sn('div',{key:a,class:'rounded bg-[#202225] p-2 md:p-3'},[Mn('label',gP,oe(a),1),Mn('div',hP,[xa(Mn('input',{'onUpdate:modelValue':t=>e.tempAttributes[a]=t,type:'number',class:'w-full rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:px-2 md:text-sm'},null,8,fP),[[fl,e.tempAttributes[a],void 0,{number:!0}]])])]))),128))]),Mn('button',{class:'mt-3 rounded bg-green-700 px-4 py-1.5 text-[10px] font-bold text-white hover:bg-green-600 md:mt-4 md:px-6 md:py-2 md:text-sm',onClick:t[11]||(t[11]=(...t)=>e.applyAttributes&&e.applyAttributes(...t))},' 保存属性修改 ')])):Rn('v-if',!0),Rn(' TAB: ITEMS '),'items'===e.activeTab?(yn(),Sn('div',vP,[Rn(' Add Money '),Mn('div',yP,[t[69]||(t[69]=Mn('h4',{class:'mb-1.5 text-[10px] font-bold text-yellow-500 md:mb-2 md:text-sm'},'添加货币',-1)),Mn('div',bP,[Mn('button',{class:'rounded bg-yellow-700 px-2 py-1 text-[10px] text-white hover:bg-yellow-600 md:px-3 md:text-xs',onClick:t[12]||(t[12]=t=>e.addMoney(1))},' +1 铜 '),Mn('button',{class:'rounded bg-gray-500 px-2 py-1 text-[10px] text-white hover:bg-gray-400 md:px-3 md:text-xs',onClick:t[13]||(t[13]=t=>e.addMoney(100))},' +1 银 '),Mn('button',{class:'rounded bg-yellow-600 px-2 py-1 text-[10px] text-white hover:bg-yellow-500 md:px-3 md:text-xs',onClick:t[14]||(t[14]=t=>e.addMoney(1e4))},' +1 金 ')])]),Rn(' Add Preset Item '),Mn('div',xP,[t[71]||(t[71]=Mn('h4',{class:'mb-1.5 text-[10px] font-bold text-blue-400 md:mb-2 md:text-sm'},'添加物品',-1)),Mn('div',wP,[xa(Mn('select',{'onUpdate:modelValue':t[15]||(t[15]=t=>e.selectedPresetId=t),class:'flex-1 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:px-2 md:text-sm'},[t[70]||(t[70]=Mn('option',{value:'',disabled:''},'选择物品...',-1)),(yn(!0),Sn(pn,null,xs(e.presetItems,e=>(yn(),Sn('option',{key:e.id,value:e.id},oe(e.data.emoji)+' '+oe(e.name),9,kP))),128))],512),[[bl,e.selectedPresetId]]),Mn('button',{class:'rounded bg-blue-700 px-2.5 py-1 text-[10px] font-bold text-white hover:bg-blue-600 disabled:opacity-50 md:px-4 md:text-sm',disabled:!e.selectedPresetId,onClick:t[16]||(t[16]=(...t)=>e.addPresetItem&&e.addPresetItem(...t))},' 添加 ',8,SP)])]),Rn(' Custom Item Creator '),Mn('div',_P,[t[72]||(t[72]=Mn('h4',{class:'mb-1.5 text-[10px] font-bold text-green-400 md:mb-2 md:text-sm'},'自定义物品',-1)),Mn('button',{class:'w-full rounded bg-green-700 px-3 py-1.5 text-[10px] font-bold text-white hover:bg-green-600 md:px-4 md:py-2 md:text-sm',onClick:t[17]||(t[17]=t=>e.showItemCreator=!0)},' 🎨 创建自定义物品 ')]),Rn(' Clear Inventory '),Mn('div',CP,[t[73]||(t[73]=Mn('h4',{class:'mb-1.5 text-[10px] font-bold text-red-400 md:mb-2 md:text-sm'},'危险操作',-1)),Mn('button',{class:'rounded bg-red-900 px-3 py-1 text-[10px] text-white hover:bg-red-800 md:px-4 md:text-sm',onClick:t[18]||(t[18]=(...t)=>e.clearInventory&&e.clearInventory(...t))},' 清空背包 ')])])):Rn('v-if',!0),Rn(' TAB: SKILLS '),'skills'===e.activeTab?(yn(),Sn('div',IP,[Mn('div',TP,[t[75]||(t[75]=Mn('h4',{class:'mb-1.5 text-[10px] font-bold text-purple-400 md:mb-2 md:text-sm'},'学习技能',-1)),Mn('div',AP,[xa(Mn('select',{'onUpdate:modelValue':t[19]||(t[19]=t=>e.selectedSkillId=t),class:'flex-1 rounded bg-[#2f3136] px-1.5 py-1 text-[10px] text-white md:px-2 md:text-sm'},[t[74]||(t[74]=Mn('option',{value:'',disabled:''},'选择技能...',-1)),(yn(!0),Sn(pn,null,xs(e.presetSkills,e=>(yn(),Sn('option',{key:e.id,value:e.id},oe(e.name),9,MP))),128))],512),[[bl,e.selectedSkillId]]),Mn('button',{class:'rounded bg-purple-700 px-2.5 py-1 text-[10px] font-bold text-white hover:bg-purple-600 disabled:opacity-50 md:px-4 md:text-sm',disabled:!e.selectedSkillId,onClick:t[20]||(t[20]=(...t)=>e.addPresetSkill&&e.addPresetSkill(...t))},' 学习 ',8,EP)])]),Rn(' Custom Skill Creator '),Mn('div',$P,[t[76]||(t[76]=Mn('h4',{class:'mb-1.5 text-[10px] font-bold text-green-400 md:mb-2 md:text-sm'},'自定义技能',-1)),Mn('button',{class:'w-full rounded bg-green-700 px-3 py-1.5 text-[10px] font-bold text-white hover:bg-green-600 md:px-4 md:py-2 md:text-sm',onClick:t[21]||(t[21]=t=>e.showSkillCreator=!0)},' ⚡ 创建自定义技能 ')])])):Rn('v-if',!0),Rn(' TAB: COMBAT '),'combat'===e.activeTab?(yn(),Sn('div',DP,[Rn(' 基础战斗测试 '),Mn('div',PP,[t[77]||(t[77]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-red-400 md:mb-2 md:text-sm'},'🎯 基础战斗',-1)),Mn('div',NP,[Mn('button',{class:'rounded bg-red-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-red-600 md:px-3 md:py-2 md:text-sm',onClick:t[22]||(t[22]=t=>e.startTestBattle('slime'))},' 🟢 史莱姆 '),Mn('button',{class:'rounded bg-red-800 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-red-700 md:px-3 md:py-2 md:text-sm',onClick:t[23]||(t[23]=t=>e.startTestBattle('skeleton_elite'))},' 💀 骷髅队长 '),Mn('button',{class:'rounded bg-purple-800 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-purple-700 md:px-3 md:py-2 md:text-sm',onClick:t[24]||(t[24]=t=>e.startTestBattle('dragon_boss'))},' 🐉 幼龙 '),Mn('button',{class:'rounded bg-orange-800 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-orange-700 md:px-3 md:py-2 md:text-sm',onClick:t[25]||(t[25]=t=>e.startTestBattle('multi_enemy'))},' 👥 3只狼 ')])]),Rn(' 护盾测试 '),Mn('div',RP,[t[78]||(t[78]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-cyan-400 md:mb-2 md:text-sm'},'🛡️ 护盾',-1)),Mn('div',jP,[Mn('button',{class:'rounded bg-cyan-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-cyan-600 md:px-3 md:py-2 md:text-sm',onClick:t[26]||(t[26]=t=>e.startTestBattle('shield_value'))},' 🔵 数值盾敌人 '),Mn('button',{class:'rounded bg-cyan-800 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-cyan-700 md:px-3 md:py-2 md:text-sm',onClick:t[27]||(t[27]=t=>e.startTestBattle('shield_count'))},' ⭐ 次数盾敌人 '),Mn('button',{class:'rounded bg-teal-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-teal-600 md:px-3 md:py-2 md:text-sm',onClick:t[28]||(t[28]=t=>e.givePlayerShield('value'))},' ➕ 数值盾 '),Mn('button',{class:'rounded bg-teal-800 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-teal-700 md:px-3 md:py-2 md:text-sm',onClick:t[29]||(t[29]=t=>e.givePlayerShield('count'))},' ➕ 次数盾 ')])]),Rn(' DOT/HOT测试 '),Mn('div',LP,[t[79]||(t[79]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-green-400 md:mb-2 md:text-sm'},'☠️ DOT/HOT',-1)),Mn('div',BP,[Mn('button',{class:'rounded bg-green-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-green-600 md:px-3 md:py-2 md:text-sm',onClick:t[30]||(t[30]=t=>e.startTestBattle('poison_enemy'))},' 🧪 毒敌人 '),Mn('button',{class:'rounded bg-orange-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-orange-600 md:px-3 md:py-2 md:text-sm',onClick:t[31]||(t[31]=t=>e.startTestBattle('burning_enemy'))},' 🔥 燃烧敌人 '),Mn('button',{class:'rounded bg-red-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-red-600 md:px-3 md:py-2 md:text-sm',onClick:t[32]||(t[32]=t=>e.applyDotToPlayer('poison'))},' ➕ 上毒 '),Mn('button',{class:'rounded bg-pink-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-pink-600 md:px-3 md:py-2 md:text-sm',onClick:t[33]||(t[33]=t=>e.applyHotToPlayer())},' ➕ 上HOT ')])]),Rn(' 连击/反击测试 '),Mn('div',OP,[t[80]||(t[80]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-yellow-400 md:mb-2 md:text-sm'},'⚡ 连击/反击',-1)),Mn('div',qP,[Mn('button',{class:'rounded bg-yellow-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-yellow-600 md:px-3 md:py-2 md:text-sm',onClick:t[34]||(t[34]=t=>e.startTestBattle('multi_hit_enemy'))},' 🌀 连击敌人 '),Mn('button',{class:'rounded bg-amber-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-amber-600 md:px-3 md:py-2 md:text-sm',onClick:t[35]||(t[35]=t=>e.startTestBattle('counter_enemy'))},' ⚔️ 反击敌人 '),Mn('button',{class:'rounded bg-lime-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-lime-600 md:px-3 md:py-2 md:text-sm',onClick:t[36]||(t[36]=t=>e.learnMultiHitSkill())},' ➕ 学连击 '),Mn('button',{class:'rounded bg-emerald-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-emerald-600 md:px-3 md:py-2 md:text-sm',onClick:t[37]||(t[37]=t=>e.givePlayerCounter())},' ➕ 获反击 ')])]),Rn(' 时间轴测试 '),Mn('div',UP,[t[81]||(t[81]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-blue-400 md:mb-2 md:text-sm'},'⏱️ 时间轴',-1)),Mn('div',VP,[Mn('button',{class:'rounded bg-blue-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-blue-600 md:px-3 md:py-2 md:text-sm',onClick:t[38]||(t[38]=t=>e.startTestBattle('speed_enemy'))},' 💨 高速敌人 '),Mn('button',{class:'rounded bg-indigo-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-indigo-600 md:px-3 md:py-2 md:text-sm',onClick:t[39]||(t[39]=t=>e.startTestBattle('slow_enemy'))},' 🐢 慢速敌人 '),Mn('button',{class:'rounded bg-violet-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-violet-600 md:px-3 md:py-2 md:text-sm',onClick:t[40]||(t[40]=t=>e.learnAdvanceSkill())},' ➕ 拉条 '),Mn('button',{class:'rounded bg-purple-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-purple-600 md:px-3 md:py-2 md:text-sm',onClick:t[41]||(t[41]=t=>e.learnExtraTurnSkill())},' ➕ 额外回合 ')])]),Rn(' 召唤测试 '),Mn('div',FP,[t[82]||(t[82]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-purple-400 md:mb-2 md:text-sm'},'🌟 召唤',-1)),Mn('div',HP,[Mn('button',{class:'rounded bg-purple-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-purple-600 md:px-3 md:py-2 md:text-sm',onClick:t[42]||(t[42]=t=>e.startTestBattle('summoner_enemy'))},' 🧙 召唤师 '),Mn('button',{class:'rounded bg-fuchsia-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-fuchsia-600 md:px-3 md:py-2 md:text-sm',onClick:t[43]||(t[43]=t=>e.learnSummonSkill())},' ➕ 学召唤 ')])]),Rn(' 复活测试 '),Mn('div',GP,[t[83]||(t[83]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-pink-400 md:mb-2 md:text-sm'},'💖 复活',-1)),Mn('div',zP,[Mn('button',{class:'rounded bg-pink-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-pink-600 md:px-3 md:py-2 md:text-sm',onClick:t[44]||(t[44]=t=>e.learnReviveSkill())},' ➕ 学复活 '),Mn('button',{class:'rounded bg-rose-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-rose-600 md:px-3 md:py-2 md:text-sm',onClick:t[45]||(t[45]=t=>e.setPlayerLowHp())},' 💔 1 HP ')])]),Rn(' 控制操作 '),Mn('div',WP,[t[84]||(t[84]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-gray-400 md:mb-2 md:text-sm'},'⚙️ 控制',-1)),Mn('div',QP,[Mn('button',{class:'flex-1 rounded bg-gray-600 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-gray-500 md:px-4 md:py-2 md:text-sm',onClick:t[46]||(t[46]=(...t)=>e.clearCombat&&e.clearCombat(...t))},' 🗑️ 结束战斗 '),Mn('button',{class:'flex-1 rounded bg-gray-700 px-2 py-1.5 text-[10px] font-bold text-white hover:bg-gray-600 md:px-4 md:py-2 md:text-sm',onClick:t[47]||(t[47]=(...t)=>e.clearAllEffects&&e.clearAllEffects(...t))},' 🧹 清除效果 ')])])])):Rn('v-if',!0),Rn(' TAB: PROMPT PREVIEW '),'prompts'===e.activeTab?(yn(),Sn('div',XP,[Mn('div',YP,[t[85]||(t[85]=Mn('h3',{class:'text-sm font-bold text-white md:text-lg'},'📝 提示词预览',-1)),Mn('div',KP,[Rn(' 切换按钮：剧情AI / 工具AI '),Mn('div',JP,[Mn('button',{class:ee(['rounded px-2 py-1 text-[10px] font-medium transition-colors md:px-3 md:text-xs','story'===e.promptPreviewMode?'bg-blue-600 text-white':'text-gray-400 hover:text-white']),onClick:t[48]||(t[48]=t=>e.promptPreviewMode='story')},' 📖 剧情AI ',2),Mn('button',{class:ee(['rounded px-2 py-1 text-[10px] font-medium transition-colors md:px-3 md:text-xs','tool'===e.promptPreviewMode?'bg-cyan-600 text-white':'text-gray-400 hover:text-white']),onClick:t[49]||(t[49]=t=>e.promptPreviewMode='tool')},' 🤖 工具AI ',2)]),Mn('button',{class:'rounded bg-blue-700 px-2 py-1 text-[10px] font-bold text-white hover:bg-blue-600 md:px-3 md:text-xs',disabled:e.promptPreviewLoading,onClick:t[50]||(t[50]=(...t)=>e.loadPendingPrompts&&e.loadPendingPrompts(...t))},oe(e.promptPreviewLoading?'加载中...':'🔄 刷新'),9,ZP)])]),Mn('p',eN,['story'===e.promptPreviewMode?(yn(),Sn(pn,{key:0},[Pn(' 以下是下次AI生成时将注入的隐藏提示词预览。这些内容对玩家不可见，但AI可以看到。 ')],64)):(yn(),Sn(pn,{key:1},[Pn(' 以下是工具AI处理时将接收的提示词预览。工具AI负责将剧情AI输出转换为结构化游戏数据。 ')],64))]),Mn('div',tN,[Mn('pre',aN,oe(e.pendingPrompts||'// 点击"刷新"按钮加载提示词预览'),1)]),Mn('div',sN,[t[93]||(t[93]=Mn('h4',{class:'mb-1 text-[10px] font-bold text-yellow-400 md:text-xs'},'⚠️ 注意事项',-1)),Mn('ul',nN,['story'===e.promptPreviewMode?(yn(),Sn(pn,{key:0},[t[86]||(t[86]=Mn('li',null,'实际注入内容可能因配置不同而略有差异',-1)),t[87]||(t[87]=Mn('li',null,'战斗结果、检定结果等将在对应事件触发时动态生成',-1)),t[88]||(t[88]=Mn('li',null,'世界书条目由酒馆原生系统处理，此处不显示',-1))],64)):(yn(),Sn(pn,{key:1},[t[89]||(t[89]=Mn('li',null,'工具AI使用 generateRaw() API，不使用酒馆当前预设',-1)),t[90]||(t[90]=Mn('li',null,'规则来自 PromptService 的变量维护（varMaintenance）配置',-1)),t[91]||(t[91]=Mn('li',null,'如已导入工具AI预设，将使用预设中的系统提示词',-1)),t[92]||(t[92]=Mn('li',null,'世界书条目通过 injects + should_scan 触发',-1))],64))])])])):Rn('v-if',!0),Rn(' TAB: RAW YAML '),'raw'===e.activeTab?(yn(),Sn('div',rN,[Mn('div',lN,[t[94]||(t[94]=Mn('h3',{class:'text-sm font-bold text-white md:text-lg'},'📄 YAML 存档编辑器',-1)),Mn('button',{class:'rounded bg-blue-700 px-2 py-1 text-[10px] font-bold text-white hover:bg-blue-600 md:px-3 md:text-xs',onClick:t[51]||(t[51]=(...t)=>e.refreshYaml&&e.refreshYaml(...t))},' 🔄 刷新 ')]),t[95]||(t[95]=Mn('p',{class:'mb-2 text-[10px] text-gray-400 md:text-xs'},' 展示当前存档的完整状态。可直接编辑后点击"应用修改"来更新游戏数据。 ',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[52]||(t[52]=t=>e.rawYaml=t),class:'custom-scrollbar flex-1 resize-none overflow-auto rounded bg-[#202225] p-2 font-mono text-[10px] text-green-400 focus:outline-none md:p-4 md:text-sm',placeholder:'# YAML 格式存档数据\nplayer:\n  name: 玩家名\n  level: 1\n  ...'},null,512),[[fl,e.rawYaml]]),Mn('button',{class:'mt-2 w-full rounded bg-gray-700 py-1.5 text-[10px] font-bold text-white hover:bg-gray-600 md:mt-4 md:py-2 md:text-sm',onClick:t[53]||(t[53]=(...t)=>e.injectRawYaml&&e.injectRawYaml(...t))},' 应用修改 ')])):Rn('v-if',!0)])])])])):Rn('v-if',!0)]),_:1})])),Rn(' Item Creator Modal '),En(l,{visible:e.showItemCreator,onClose:t[55]||(t[55]=t=>e.showItemCreator=!1)},null,8,['visible']),Rn(' Skill Creator Modal '),En(o,{visible:e.showSkillCreator,onClose:t[56]||(t[56]=t=>e.showSkillCreator=!1)},null,8,['visible'])],64)}],['__scopeId','data-v-efe272e8']]),JR={class:'flex h-full w-full flex-col overflow-hidden bg-[#36393f] shadow-xl md:h-[80vh] md:max-w-3xl md:rounded-lg md:border md:border-[#202225]',style:{'padding-bottom':'env(safe-area-inset-bottom)'}},ZR={class:'flex shrink-0 items-center justify-between border-b border-[#202225] bg-[#2f3136] px-4 py-3'},ej={class:'flex flex-1 overflow-hidden'},tj={class:'space-y-1 p-2'},aj=['onClick'],sj={class:'min-w-0 flex-1'},nj={class:'truncate text-sm font-medium text-white'},rj={class:'text-xs text-gray-400'},lj={class:'text-right text-xs'},oj={key:0,class:'py-8 text-center text-sm text-gray-500'},ij={key:1,class:'space-y-4'},cj={class:'flex items-start'},dj={class:'flex-1'},uj={class:'text-xl font-bold text-white'},pj={class:'mt-1 text-sm text-gray-400'},mj={class:'mt-2'},gj={class:'flex items-center justify-between text-xs'},hj={class:'mt-1 h-2 w-full overflow-hidden rounded-full bg-[#202225]'},fj={key:0,class:'rounded bg-[#2f3136] p-3'},vj={class:'text-sm text-gray-300'},yj={class:'flex flex-wrap gap-2'},bj={key:0,class:'rounded bg-[#40444b] px-2 py-1 text-xs text-gray-300'},xj={key:1,class:'rounded bg-[#2f3136] p-3'},wj={class:'mb-2 text-xs text-gray-500'},kj={class:'flex flex-wrap gap-2'},Sj={class:'text-sm text-gray-300'},_j={key:2,class:'rounded bg-[#2f3136] p-3'},Cj={class:'text-sm text-gray-300'},Ij={class:'flex shrink-0 items-center justify-between border-t border-[#202225] bg-[#2f3136] px-4 py-2'},Tj={class:'text-xs text-gray-500'};const Aj=Za({name:'FactionsModal',props:{visible:{type:Boolean,default:!1},relation:{type:Object,default:void 0}},emits:['close'],setup(e){const t=$t(null),a=ir(()=>e.relation?.factions?Object.values(e.relation.factions).sort((e,t)=>(t.rep??0)-(e.rep??0)):[]),s=ir(()=>t.value&&e.relation?.factions?e.relation.factions[t.value]:null),n=ir(()=>s.value?.members&&e.relation?.characters?s.value.members.map(t=>e.relation.characters[t]).filter(e=>Boolean(e)):[]),r=ir(()=>a.value.length);return{selectedFactionId:t,clearSelection:()=>{t.value=null},factionList:a,selectedFaction:s,factionMembers:n,factionCount:r,selectFaction:e=>{t.value=e.id},getRepColor:e=>{const t=e??0;return t>=30?'text-green-400':t>=10?'text-blue-400':t>=-10?'text-gray-400':t>=-30?'text-orange-400':'text-red-400'},getRepLabel:e=>{const t=e??0;return t>=30?'盟友':t>=10?'友好':t>=-10?'中立':t>=-30?'警惕':'敌对'},getRepBgColor:e=>{const t=e??0;return t>=30?'bg-green-500':t>=10?'bg-blue-500':t>=-10?'bg-gray-500':t>=-30?'bg-orange-500':'bg-red-500'},getFactionBgColor:e=>{const t=e??0;return t>=30?'bg-green-500/20':t>=10?'bg-blue-500/20':t>=-10?'bg-gray-500/20':t>=-30?'bg-orange-500/20':'bg-red-500/20'},getRepTagClass:e=>{const t=e??0;return t>=30?'bg-green-500/20 text-green-400':t>=10?'bg-blue-500/20 text-blue-400':t>=-10?'bg-gray-500/20 text-gray-400':t>=-30?'bg-orange-500/20 text-orange-400':'bg-red-500/20 text-red-400'},getRelColor:e=>{const t=e??0;return t>=80?'text-pink-400':t>=50?'text-green-400':t>=20?'text-blue-400':t>=0?'text-gray-400':t>=-30?'text-orange-400':'text-red-400'}}}}),Mj=(0,$u.A)(Aj,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-70 flex items-center justify-center bg-black/60 p-2 sm:p-4',style:{'padding-top':'max(0.5rem, env(safe-area-inset-top))','padding-bottom':'max(0.5rem, env(safe-area-inset-bottom))'},onClick:t[3]||(t[3]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',JR,[Rn(' Header '),Mn('div',ZR,[t[4]||(t[4]=Mn('div',{class:'flex items-center space-x-2'},[Mn('span',{class:'text-xl'},'🏴'),Mn('h2',{class:'text-lg font-bold text-white'},'势力组织')],-1)),Mn('button',{class:'flex h-8 w-8 items-center justify-center rounded text-gray-400 transition-colors hover:bg-[#40444b] hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},' ✕ ')]),Rn(' Content Area '),Mn('div',ej,[Rn(' Left: Faction List '),Mn('div',{class:ee(['w-full overflow-y-auto border-r border-[#202225] bg-[#2f3136] md:w-1/3',e.selectedFactionId?'hidden md:block':'block'])},[Mn('div',tj,[(yn(!0),Sn(pn,null,xs(e.factionList,t=>(yn(),Sn('div',{key:t.id,class:ee(['flex cursor-pointer items-center rounded p-2 transition-colors',e.selectedFactionId===t.id?'bg-[#40444b]':'hover:bg-[#40444b]/50']),onClick:a=>e.selectFaction(t)},[Mn('div',{class:ee(['mr-2 flex h-10 w-10 items-center justify-center rounded-full text-xl',e.getFactionBgColor(t.rep)])},' 🏴 ',2),Mn('div',sj,[Mn('div',nj,oe(t.name),1),Mn('div',rj,oe(e.getRepLabel(t.rep)),1)]),Mn('div',lj,[Mn('span',{class:ee(e.getRepColor(t.rep))},oe(t.rep??0),3)])],10,aj))),128)),Rn(' 空状态 '),0===e.factionList.length?(yn(),Sn('div',oj,[...t[5]||(t[5]=[Mn('div',{class:'mb-2 text-3xl'},'🏴',-1),Mn('p',null,'暂无势力记录',-1),Mn('p',{class:'mt-1 text-xs'},'与势力互动后将在此显示',-1)])])):Rn('v-if',!0)])],2),Rn(' Right: Detail Panel '),Mn('div',{class:ee(['flex-1 overflow-y-auto p-4',e.selectedFactionId?'block':'hidden md:block'])},[Rn(' Mobile Back Button '),e.selectedFactionId?(yn(),Sn('button',{key:0,class:'mb-4 flex items-center rounded px-2 py-1 text-sm text-gray-400 hover:bg-[#40444b] hover:text-white md:hidden',onClick:t[1]||(t[1]=(...t)=>e.clearSelection&&e.clearSelection(...t))},[...t[6]||(t[6]=[Mn('span',{class:'mr-1'},'⬅',-1),Pn(' 返回列表 ',-1)])])):Rn('v-if',!0),Rn(' 势力详情 '),e.selectedFaction?(yn(),Sn('div',ij,[Rn(' 头部 '),Mn('div',cj,[Mn('div',{class:ee(['mr-4 flex h-16 w-16 items-center justify-center rounded-full text-3xl',e.getFactionBgColor(e.selectedFaction.rep)])},' 🏴 ',2),Mn('div',dj,[Mn('h3',uj,oe(e.selectedFaction.name),1),Mn('div',pj,oe(e.getRepLabel(e.selectedFaction.rep)),1),Rn(' 声望条 '),Mn('div',mj,[Mn('div',gj,[t[7]||(t[7]=Mn('span',{class:'text-gray-400'},'声望',-1)),Mn('span',{class:ee(e.getRepColor(e.selectedFaction.rep))},oe(e.selectedFaction.rep??0),3)]),Mn('div',hj,[Mn('div',{class:ee(['h-full transition-all',e.getRepBgColor(e.selectedFaction.rep)]),style:X({width:Math.min(100,Math.max(0,(e.selectedFaction.rep??0)+50))+'%'})},null,6)]),t[8]||(t[8]=Mn('div',{class:'mt-1 flex justify-between text-[10px] text-gray-500'},[Mn('span',null,'-50 敌对'),Mn('span',null,'0 中立'),Mn('span',null,'+50 盟友')],-1))])])]),Rn(' 描述 '),e.selectedFaction.desc?(yn(),Sn('div',fj,[t[9]||(t[9]=Mn('div',{class:'mb-1 text-xs text-gray-500'},'描述',-1)),Mn('div',vj,oe(e.selectedFaction.desc),1)])):Rn('v-if',!0),Rn(' 状态标签 '),Mn('div',yj,[Mn('span',{class:ee(['rounded px-2 py-1 text-xs',e.getRepTagClass(e.selectedFaction.rep)])},oe(e.getRepLabel(e.selectedFaction.rep)),3),e.selectedFaction.status?(yn(),Sn('span',bj,oe(e.selectedFaction.status),1)):Rn('v-if',!0)]),Rn(' 已知成员 '),e.factionMembers.length>0?(yn(),Sn('div',xj,[Mn('div',wj,'已知成员 ('+oe(e.factionMembers.length)+')',1),Mn('div',kj,[(yn(!0),Sn(pn,null,xs(e.factionMembers,a=>(yn(),Sn('div',{key:a.id,class:'flex items-center rounded bg-[#40444b] px-2 py-1'},[t[10]||(t[10]=Mn('span',{class:'mr-1 text-sm'},'👤',-1)),Mn('span',Sj,oe(a.name),1),void 0!==a.rel?(yn(),Sn('span',{key:0,class:ee(['ml-2 text-xs',e.getRelColor(a.rel)])},oe(a.rel),3)):Rn('v-if',!0)]))),128))])])):Rn('v-if',!0),Rn(' 备注 '),e.selectedFaction.notes?(yn(),Sn('div',_j,[t[11]||(t[11]=Mn('div',{class:'mb-1 text-xs text-gray-500'},'备注',-1)),Mn('div',Cj,oe(e.selectedFaction.notes),1)])):Rn('v-if',!0),Rn(' 声望等级说明 '),t[12]||(t[12]=Mn('div',{class:'rounded border border-dashed border-gray-600 bg-[#2f3136]/50 p-3'},[Mn('div',{class:'mb-2 text-xs text-gray-500'},'声望等级说明'),Mn('div',{class:'grid grid-cols-1 gap-2 text-xs md:grid-cols-2'},[Mn('div',{class:'flex items-center'},[Mn('span',{class:'mr-2 h-2 w-2 rounded-full bg-green-500'}),Mn('span',{class:'text-gray-400'},'+30以上: 盟友')]),Mn('div',{class:'flex items-center'},[Mn('span',{class:'mr-2 h-2 w-2 rounded-full bg-blue-500'}),Mn('span',{class:'text-gray-400'},'+10~+29: 友好')]),Mn('div',{class:'flex items-center'},[Mn('span',{class:'mr-2 h-2 w-2 rounded-full bg-gray-500'}),Mn('span',{class:'text-gray-400'},'-9~+9: 中立')]),Mn('div',{class:'flex items-center'},[Mn('span',{class:'mr-2 h-2 w-2 rounded-full bg-orange-500'}),Mn('span',{class:'text-gray-400'},'-10~-29: 警惕')]),Mn('div',{class:'flex items-center'},[Mn('span',{class:'mr-2 h-2 w-2 rounded-full bg-red-500'}),Mn('span',{class:'text-gray-400'},'-30以下: 敌对')])])],-1))])):(yn(),Sn(pn,{key:2},[Rn(' 默认空状态 '),t[13]||(t[13]=Mn('div',{class:'flex h-full items-center justify-center text-gray-500'},[Mn('div',{class:'text-center'},[Mn('div',{class:'mb-2 text-4xl'},'🏴'),Mn('p',null,'选择一个势力查看详情')])],-1))],64))],2)]),Rn(' Footer '),Mn('div',Ij,[Mn('div',Tj,'已知势力: '+oe(e.factionCount)+' 个',1),Mn('button',{class:'rounded bg-[#40444b] px-4 py-1.5 text-sm text-white hover:bg-[#4a4f57]',onClick:t[2]||(t[2]=t=>e.$emit('close'))},' 关闭 ')])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-9663470a']]),Ej={class:'notepad-modal mx-4 flex max-h-[50dvh] w-full max-w-md flex-col overflow-hidden rounded-lg shadow-2xl'},$j={class:'modal-header relative z-10 shrink-0 px-4 py-3'},Dj={class:'flex items-center justify-between'},Pj={class:'modal-content relative z-10 flex min-h-0 flex-1 flex-col p-3 sm:p-4'},Nj={class:'modal-footer relative z-10 shrink-0 px-4 py-3'},Rj={class:'flex items-center justify-between'},jj={class:'char-count text-[10px] sm:text-xs'},Lj={class:'flex gap-2'};const Bj=Za({name:'NotepadModal',props:{visible:{type:Boolean,default:!1},content:{type:String,default:''}},emits:['close','update:content'],setup(e,{emit:t}){const a=$t(''),s=$t(null),n=ir(()=>a.value.length);_a(()=>e.visible,t=>{t&&(a.value=e.content||'',setTimeout(()=>{s.value?.focus()},100))},{immediate:!0});return{localContent:a,textareaRef:s,charCount:n,handleInput:()=>{t('update:content',a.value)},handleSave:()=>{t('update:content',a.value),t('close')},handleClose:()=>{t('update:content',a.value),t('close')},handleClear:()=>{a.value='',t('update:content','')}}}}),Oj=(0,$u.A)(Bj,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'notepad-backdrop fixed inset-0 z-50 flex items-center justify-center',onClick:t[5]||(t[5]=Cl((...t)=>e.handleClose&&e.handleClose(...t),['self']))},[Mn('div',Ej,[Rn(' 背景层 '),t[14]||(t[14]=Mn('div',{class:'modal-bg-layer'},null,-1)),t[15]||(t[15]=Mn('div',{class:'modal-noise'},null,-1)),Rn(' Header '),Mn('div',$j,[Rn(' 顶部装饰线 '),t[8]||(t[8]=Mn('div',{class:'header-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',Dj,[t[7]||(t[7]=Mn('div',{class:'flex items-center gap-2'},[Mn('span',{class:'header-icon text-lg'},'📝'),Mn('h3',{class:'header-title text-base font-bold tracking-wider'},'备忘录')],-1)),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=(...t)=>e.handleClose&&e.handleClose(...t))},[...t[6]||(t[6]=[Mn('span',null,'✕',-1)])])]),Rn(' 底部装饰线 '),t[9]||(t[9]=Mn('div',{class:'header-deco-line mt-2'},[Mn('span',{class:'deco-diamond'},'◇')],-1))]),Rn(' Content Area '),Mn('div',Pj,[t[10]||(t[10]=Mn('div',{class:'content-hint mb-2 text-[10px] sm:text-xs'},'在这里记录重要信息、线索或备忘...',-1)),xa(Mn('textarea',{ref:'textareaRef','onUpdate:modelValue':t[1]||(t[1]=t=>e.localContent=t),class:'notepad-textarea custom-scrollbar min-h-0 flex-1 resize-none rounded p-2 text-xs sm:p-3 sm:text-sm',placeholder:'在此输入内容...',autocomplete:'off',autocorrect:'off',autocapitalize:'off',spellcheck:'false','data-form-type':'other','data-lpignore':'true',onInput:t[2]||(t[2]=(...t)=>e.handleInput&&e.handleInput(...t))},null,544),[[fl,e.localContent]])]),Rn(' Footer '),Mn('div',Nj,[t[13]||(t[13]=Mn('div',{class:'footer-deco-line mb-2'},[Mn('span',{class:'deco-diamond'},'◆')],-1)),Mn('div',Rj,[Mn('span',jj,oe(e.charCount)+' 字符 ',1),Mn('div',Lj,[Mn('button',{class:'footer-btn secondary',onClick:t[3]||(t[3]=(...t)=>e.handleClear&&e.handleClear(...t))},[...t[11]||(t[11]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'清空',-1)])]),Mn('button',{class:'footer-btn primary',onClick:t[4]||(t[4]=(...t)=>e.handleSave&&e.handleSave(...t))},[...t[12]||(t[12]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'保存',-1)])])])])])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-0f26c597']]),qj={class:'flex h-full w-full flex-col overflow-hidden bg-[#36393f] shadow-xl md:h-[80vh] md:max-w-2xl md:rounded-lg md:border md:border-[#202225]',style:{'padding-bottom':'env(safe-area-inset-bottom)'}},Uj={class:'flex shrink-0 items-center justify-between border-b border-[#202225] bg-[#2f3136] px-3 py-2'},Vj={class:'flex items-center space-x-2'},Fj={class:'text-lg'},Hj={class:'text-base font-bold text-white'},Gj={class:'flex flex-1 overflow-hidden'},zj={class:'sticky top-0 z-10 bg-[#2f3136] p-1.5'},Wj={key:0,value:'scene'},Qj={class:'space-y-0.5 p-1.5'},Xj={key:0,class:'flex items-center px-2 py-1.5 text-xs text-gray-500'},Yj=['onClick'],Kj={class:'min-w-0 flex-1'},Jj={class:'flex items-center'},Zj={class:'truncate text-sm font-medium text-white'},eL=['onClick'],tL={class:'truncate text-xs text-gray-400'},aL={class:'shrink-0 text-right text-xs'},sL={class:'text-gray-400'},nL={key:1,class:'flex items-center px-2 py-1.5 text-xs text-gray-500'},rL=['onClick','onContextmenu','onTouchstart'],lL={class:'min-w-0 flex-1'},oL={class:'flex items-center'},iL={class:'truncate text-sm font-medium text-white'},cL={key:0,class:'ml-1 text-xs text-yellow-400'},dL={key:1,class:'ml-1 text-xs text-blue-400'},uL={class:'flex items-center text-xs text-gray-400'},pL={key:0,class:'ml-1.5 truncate'},mL={class:'shrink-0 text-right text-xs'},gL={key:2,class:'py-6 text-center text-sm text-gray-500'},hL={key:1,class:'flex h-full flex-col'},fL={class:'flex shrink-0 items-start'},vL={class:'min-w-0 flex-1'},yL={class:'flex flex-wrap items-center gap-1'},bL={class:'text-lg font-bold text-white'},xL={key:2,class:'text-sm text-blue-400',title:'队友'},wL={class:'text-sm text-gray-400'},kL={key:0,class:'ml-1.5 text-xs'},SL={class:'mt-1.5'},_L={class:'flex items-center justify-between text-xs'},CL={class:'mt-0.5 h-1.5 w-full overflow-hidden rounded-full bg-[#202225]'},IL={class:'mt-3 shrink-0 rounded bg-[#2f3136] p-2'},TL={class:'grid grid-cols-3 gap-1.5'},AL=['disabled','title'],ML=['disabled'],EL=['disabled'],$L={class:'mt-2 flex shrink-0 border-b border-[#40444b]'},DL=['onClick'],PL={key:0,class:'absolute bottom-0 left-0 h-0.5 w-full bg-[#5865F2]'},NL={class:'scrollbar-stable mt-2 min-h-0 flex-1 overflow-y-auto pr-1'},RL={key:0,class:'space-y-3'},jL={class:'grid grid-cols-1 gap-2 md:grid-cols-2'},LL={class:'rounded bg-[#36393f] p-2'},BL={class:'rounded bg-[#36393f] p-2'},OL={class:'rounded bg-[#36393f] p-2'},qL={class:'rounded bg-[#36393f] p-2'},UL={class:'rounded bg-[#36393f] p-2'},VL={class:'rounded bg-[#36393f] p-2'},FL={class:'rounded bg-[#36393f] p-2 md:col-span-2'},HL={class:'flex flex-wrap gap-x-4 gap-y-1 border-t border-[#40444b] pt-2 text-xs text-gray-500'},GL={key:1,class:'space-y-3'},zL={key:0,class:'rounded border border-blue-900/30 bg-[#36393f] p-2'},WL={class:'mb-2 flex items-center justify-between'},QL={class:'text-sm text-gray-400'},XL={class:'space-y-2'},YL={class:'rounded bg-[#36393f] p-2'},KL={class:'rounded bg-[#36393f] p-2'},JL={key:2,class:'space-y-3'},ZL={class:'space-y-2'},eB={class:'rounded bg-[#36393f] p-2'},tB={class:'grid grid-cols-1 gap-2 md:grid-cols-2'},aB={class:'rounded bg-[#36393f] p-2'},sB={class:'rounded bg-[#36393f] p-2'},nB={class:'space-y-2 border-t border-[#40444b] pt-2'},rB={class:'rounded bg-[#36393f] p-2'},lB={key:0,class:'space-y-1 text-sm text-gray-300'},oB={key:1,class:'text-sm text-gray-600 italic'},iB={key:3,class:'flex h-full flex-col space-y-3'},cB={class:'flex flex-1 flex-col rounded bg-[#36393f] p-2'},dB={class:'space-y-2'},uB={class:'flex items-start'},pB={class:'min-w-0 flex-1'},mB={class:'flex items-center gap-1'},gB={class:'text-lg font-bold text-white'},hB={key:2,class:'ml-2 rounded bg-blue-500/20 px-1.5 py-0.5 text-xs text-blue-400'},fB={class:'text-sm text-gray-400'},vB={class:'mt-1.5'},yB={class:'flex items-center justify-between text-xs'},bB={class:'text-gray-300'},xB={class:'rounded border border-[#40444b] bg-[#2f3136]'},wB={class:'border-t border-[#40444b] p-2'},kB={class:'grid grid-cols-1 gap-1.5 md:grid-cols-2'},SB={class:'rounded bg-[#36393f] p-2'},_B={class:'text-sm text-gray-300'},CB={class:'rounded bg-[#36393f] p-2'},IB={class:'rounded bg-[#2f3136] p-2'},TB={class:'grid grid-cols-3 gap-1.5'},AB=['disabled','title'],MB={class:'flex shrink-0 items-center justify-between border-t border-[#202225] bg-[#2f3136] px-3 py-2'},EB={class:'text-xs text-gray-500'},$B=['disabled'];const DB={key:0,class:'modal-container'},PB={class:'modal-title'},NB={class:'title-icon'},RB={class:'modal-content'},jB={class:'modal-message'},LB={key:0,class:'modal-input-wrapper'},BB=['placeholder'],OB={class:'modal-actions'},qB={class:'btn-content'},UB={class:'btn-content'};const VB=Za({name:'ModalDialog',props:{visible:{type:Boolean,required:!0},type:{type:String,default:'alert'},title:{type:String,default:'提示'},message:{type:String,default:''},placeholder:{type:String,default:''},confirmText:{type:String,default:'确定'},cancelText:{type:String,default:'取消'},initialValue:{type:String,default:''},autoFocus:{type:Boolean,default:!0}},emits:['update:visible','confirm','cancel'],setup(e,{emit:t}){const a=$t(e.initialValue),s=$t(null);_a(()=>e.visible,async t=>{t&&(a.value=e.initialValue,'prompt'===e.type&&e.autoFocus&&(await Zt(),s.value?.focus()))});const n=()=>{t('confirm',a.value),t('update:visible',!1)},r=()=>{t('cancel'),t('update:visible',!1)};return{inputValue:a,inputRef:s,handleConfirm:n,handleCancel:r,handleBackdropClick:()=>{'alert'!==e.type?r():n()},getTitleIcon:()=>{switch(e.type){case'alert':return'📢';case'confirm':return'❓';case'prompt':return'✏️';default:return'💬'}}}}}),FB=(0,$u.A)(VB,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'modal-backdrop',onClick:t[4]||(t[4]=Cl((...t)=>e.handleBackdropClick&&e.handleBackdropClick(...t),['self']))},[Rn(' 背景层效果 '),t[9]||(t[9]=Mn('div',{class:'modal-vignette'},null,-1)),t[10]||(t[10]=Mn('div',{class:'modal-noise'},null,-1)),En(wr,{name:'modal-scale'},{default:ba(()=>[e.visible?(yn(),Sn('div',DB,[Rn(' 装饰线顶部 '),t[7]||(t[7]=Mn('div',{class:'modal-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Rn(' 标题 '),Mn('h3',PB,[Mn('span',NB,oe(e.getTitleIcon()),1),Mn('span',null,oe(e.title),1)]),Rn(' 消息内容 '),Mn('div',RB,[Mn('p',jB,oe(e.message),1)]),Rn(' 输入框 (可选) '),'prompt'===e.type?(yn(),Sn('div',LB,[xa(Mn('input',{ref:'inputRef','onUpdate:modelValue':t[0]||(t[0]=t=>e.inputValue=t),type:'text',class:'modal-input',placeholder:e.placeholder,onKeyup:t[1]||(t[1]=Tl((...t)=>e.handleConfirm&&e.handleConfirm(...t),['enter']))},null,40,BB),[[fl,e.inputValue]])])):Rn('v-if',!0),Rn(' 装饰线底部 '),t[8]||(t[8]=Mn('div',{class:'modal-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Rn(' 按钮区域 '),Mn('div',OB,['alert'!==e.type?(yn(),Sn('button',{key:0,type:'button',class:'modal-btn modal-btn-secondary',onClick:t[2]||(t[2]=(...t)=>e.handleCancel&&e.handleCancel(...t))},[t[5]||(t[5]=Mn('span',{class:'btn-glow'},null,-1)),Mn('span',qB,oe(e.cancelText),1)])):Rn('v-if',!0),Mn('button',{type:'button',class:'modal-btn modal-btn-primary',onClick:t[3]||(t[3]=(...t)=>e.handleConfirm&&e.handleConfirm(...t))},[t[6]||(t[6]=Mn('span',{class:'btn-glow'},null,-1)),Mn('span',UB,oe(e.confirmText),1)])])])):Rn('v-if',!0)]),_:1})])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-5aa003c0']]),HB=Za({name:'RelationshipsModal',components:{AvatarDisplay:Vh,AvatarEditorModal:Ay,ModalDialog:FB},props:{visible:{type:Boolean,default:!1},relation:{type:Object,default:void 0},scene:{type:Object,default:void 0},allies:{type:Array,default:()=>[]},initialNpcName:{type:String,default:''},showSceneNpcs:{type:Boolean,default:!1},simpleMode:{type:Boolean,default:!1}},emits:['close','update-relation','show-private','action'],setup(e,{emit:t}){const a=$t('all'),s=$t(null),n=$t(null),r=$t(null),l=$t(0),o=$t(!1),i=$t({x:0,y:0}),c=$t(null),d=$t(!1);let u=null;const p=$t('basic'),m=$t(''),g=$t(!1),h=ir(()=>null!==s.value||null!==n.value||null!==r.value),f=()=>{s.value=null,n.value=null,r.value=null},v=ir(()=>(l.value,e.relation?.characters?Object.values(e.relation.characters).filter(e=>'object'==typeof e&&null!==e&&'id'in e):[])),y=ir(()=>e.scene?.npcs?Object.values(e.scene.npcs):[]),b=ir(()=>{if(!e.showSceneNpcs)return[];const t=new Set(v.value.map(e=>e.name.toLowerCase()));return y.value.filter(e=>!t.has(e.name.toLowerCase()))}),x=ir(()=>{let e=v.value;switch(a.value){case'starred':e=e.filter(e=>e.isStarred);break;case'friend':e=e.filter(e=>(e.rel??0)>=50);break;case'scene':{const t=y.value.map(e=>e.name.toLowerCase());e=e.filter(e=>t.includes(e.name.toLowerCase()));break}}return e.sort((e,t)=>(t.rel??0)-(e.rel??0))}),w=ir(()=>{if(l.value,!s.value||!e.relation?.characters)return null;const t=e.relation.characters[s.value];return t?{...t}:null}),k=ir(()=>e.simpleMode&&r.value?r.value:null===n.value?null:b.value[n.value]),S=ir(()=>v.value.length),C=ir(()=>{if(!w.value)return!1;if(w.value.linkedAllyId)return!0;const t=w.value.name.toLowerCase();return e.allies.some(e=>e.name.toLowerCase()===t)}),I=ir(()=>{if(!k.value)return!1;const t=k.value.name.toLowerCase();return e.allies.some(e=>e.name.toLowerCase()===t)}),T=t=>{if(!t)return;const a=t.toLowerCase();if(e.relation?.characters)for(const t of Object.values(e.relation.characters))if(t.name.toLowerCase()===a)return s.value=t.id,n.value=null,r.value=null,void(m.value=t.notes||'');if(e.showSceneNpcs&&e.scene?.npcs){const t=Object.values(e.scene.npcs);for(const l of t)if(l.name.toLowerCase()===a){if(e.simpleMode)r.value=l,n.value=null;else{const e=b.value.findIndex(e=>e.name.toLowerCase()===a);-1!==e&&(n.value=e),r.value=null}return void(s.value=null)}}};_a(()=>e.visible,t=>{t?(l.value++,e.initialNpcName&&setTimeout(()=>{T(e.initialNpcName)},50)):f()}),_a(()=>e.initialNpcName,t=>{e.visible&&t&&T(t)}),_a(()=>e.relation,()=>{l.value++},{deep:!0});const A=a=>{const r=Ll.serviceLocator.get('SaveService'),o=r.getGameState();if(!o)return;o.relation||(o.relation={characters:{},factions:{}});const i=a.name.toLowerCase().replace(/\s+/g,'_').replace(/[^a-z0-9_\u4e00-\u9fa5]/g,'')+'_'+Date.now().toString(36);let c=0;const d=(a.attitude||'中立').toLowerCase();d.includes('友好')||d.includes('友善')?c=50:(d.includes('敌对')||d.includes('敌意'))&&(c=-30);const u={id:i,name:a.name,appearance:a.appearance,personality:a.personality,status:a.status,rel:c,metAt:o.world.time,isStarred:!0};o.relation.characters[i]=u,r.saveData(),l.value++,e.simpleMode||(s.value=i,n.value=null,m.value=''),t('update-relation',o.relation),console.log('[RelationshipsModal] 场景NPC已收藏:',u)},M=(e,t)=>{let a=e.clientX||e.clientX,s=e.clientY||e.clientY;a+160>window.innerWidth&&(a=window.innerWidth-160-10);s+100>window.innerHeight&&(s=window.innerHeight-100-10),i.value={x:a,y:s},c.value=t,o.value=!0},E=()=>{o.value=!1,c.value=null},D=$t(!1),P=$t(''),N=$t(null);return ms(()=>{u&&clearTimeout(u)}),{characterFilter:a,selectedCharId:s,selectedSceneNpcIdx:n,characterList:v,sceneNpcs:y,visibleSceneNpcs:b,filteredCharacters:x,selectedChar:w,selectedSceneNpc:k,characterCount:S,hasSelection:h,clearSelection:f,selectCharacter:e=>{s.value=e.id,n.value=null,p.value='basic',m.value=e.notes||''},selectSceneNpc:(e,t)=>{n.value=t,s.value=null},selectByName:T,isNpcStarred:e=>{const t=e.name.toLowerCase();return v.value.some(e=>e.name.toLowerCase()===t)},starSceneNpc:A,toggleSceneNpcStar:e=>{const a=e.name.toLowerCase(),s=v.value.find(e=>e.name.toLowerCase()===a);if(s){const a=Ll.serviceLocator.get('SaveService'),n=a.getGameState();n?.relation?.characters[s.id]&&(n.relation.characters[s.id].isStarred=!s.isStarred,a.saveData(),l.value++,t('update-relation',n.relation),console.log('[RelationshipsModal] 切换星标:',e.name,'新状态:',!s.isStarred))}else A(e)},toggleStar:e=>{const a=Ll.serviceLocator.get('SaveService'),s=a.getGameState();s?.relation?.characters[e.id]&&(s.relation.characters[e.id].isStarred=!e.isStarred,a.saveData(),l.value++,t('update-relation',s.relation))},activeTab:p,tabs:[{id:'basic',label:'基础'},{id:'story',label:'档案'},{id:'dynamics',label:'动态'},{id:'notes',label:'备注'}],editableNotes:m,saveNotes:()=>{if(!s.value)return;const e=Ll.serviceLocator.get('SaveService'),t=e.getGameState();t?.relation?.characters[s.value]&&(t.relation.characters[s.value].notes=m.value,e.saveData(),l.value++)},getCharAvatar:t=>{if(t.avatar)return t.avatar;if(t.linkedAllyId){const a=e.allies.find(e=>e.id===t.linkedAllyId);if(a?.avatar)return a.avatar}return'👤'},getLinkedAlly:t=>{if(t.linkedAllyId)return e.allies.find(e=>e.id===t.linkedAllyId)},getPrivateSummary:e=>{if(!e?.private)return'暂无私密档案记录';const t=e.private,a=[];return t.Body_Type&&a.push(`体型: ${t.Body_Type}`),t.Breast_Size&&a.push(`胸部: ${t.Breast_Size}`),t.Penis_Length&&a.push(`阴茎: ${t.Penis_Length}`),t.Virginity_Status&&a.push(t.Virginity_Status),a.length>0?a.join(' | '):'暂无私密档案记录'},displayValue:(e,t='[未知]')=>e&&e.trim()?e:t,getRelColor:e=>{const t=e??0;return t>=80?'text-pink-400':t>=50?'text-green-400':t>=20?'text-blue-400':t>=0?'text-gray-400':t>=-30?'text-orange-400':'text-red-400'},getRelLabel:e=>{const t=e??0;return t>=80?'亲密':t>=50?'友好':t>=20?'好感':t>=0?'中立':t>=-30?'冷淡':'敌对'},getRelTypeLabel:e=>e||'',getRelBgColor:e=>{const t=e??0;return t>=80?'bg-pink-500':t>=50?'bg-green-500':t>=20?'bg-blue-500':t>=0?'bg-gray-500':'bg-gray-800'},getRelBarWidth:e=>{const t=e??0;return t>=0?Math.min(100,t)+'%':Math.min(100,Math.abs(t))+'%'},formatDate:e=>e||'',handleAction:e=>{const a=w.value||k.value;if(!a)return;const s=w.value?w.value.rel??0:0;t('action',{action:e,targetName:a.name,targetId:w.value?.id,isSceneNpc:!!k.value,rel:s}),console.log('[RelationshipsModal] Action triggered:',e,'target:',a.name)},isCurrentCharAlly:C,isCurrentSceneNpcAlly:I,contextMenuVisible:o,contextMenuPos:i,isAiCompleting:d,showContextMenu:M,hideContextMenu:E,handleTouchStart:(e,t)=>{u=setTimeout(()=>{const a=e.touches[0];M(a,t),e.preventDefault()},500)},handleTouchEnd:()=>{u&&(clearTimeout(u),u=null)},handleAiComplete:async()=>{if(!c.value||d.value)return;const e=c.value;let t,a;console.log('[RelationshipsModal] AI补全请求:',e.name),E();try{t=Ll.serviceLocator.get('BackgroundTaskService');a=t.createTask(Rl.TOOL_AI,`补全 ${e.name} 档案`).taskId,t.startTask(a)}catch(e){console.warn('[RelationshipsModal] BackgroundTaskService not available',e)}try{const s=Ll.serviceLocator.get('ToolAIService'),n=Ll.serviceLocator.get('SaveService').getGameState();if(!n)throw new Error('无法获取游戏状态');const r=[];e.occupation&&r.push(`职业/身份: ${e.occupation}`),e.appearance&&r.push(`外貌: ${e.appearance}`),e.personality&&r.push(`性格: ${e.personality}`),e.likes&&r.push(`喜好: ${e.likes}`),e.dislikes&&r.push(`厌恶: ${e.dislikes}`),e.background&&r.push(`背景: ${e.background}`),e.haunt&&r.push(`常出没地点: ${e.haunt}`),e.status&&r.push(`当前状态: ${e.status}`);const o=r.length>0?`\n\n该角色已知信息：\n${r.join('\n')}`:'\n\n该角色目前几乎没有任何已知信息。',i=`[系统指令] 玩家请求AI补全角色 "${e.name}" (ID: ${e.id}) 的详细档案。请根据已有的剧情和上下文，推断并补充该角色的详细信息。\n${o}\n\n请补充以下缺失的字段（如果对应字段已有内容则跳过）：\n1. occupation (职业/身份) - 必须补充！如"酒馆老板"、"流浪剑客"、"神秘商人"等\n2. appearance (外貌特征) - 外观描述\n3. personality (性格特征) - 性格描述\n4. likes (喜好) - 喜欢的事物\n5. dislikes (厌恶) - 讨厌的事物\n6. haunt (常出没地点) - 通常在哪里可以找到这个人\n7. background (人物背景) - 简要背景故事\n8. biography (生平经历) - 更详细的经历\n9. motivation.current (当前动机) - 目前在做什么\n10. motivation.shortTerm (短期目标)\n11. motivation.longTerm (长期目标)\n\n请输出 <patch> 标签，使用 set 操作更新 relation.characters.${e.id} 下的相应字段。\n重要：只补充缺失的部分，不要修改已有的正确信息。每个需要补充的字段都要生成对应的 patch 操作。`,c=await s.process({storyOutput:`<content>玩家正在查看${e.name}的档案。</content>`,userInput:`[补全档案: ${e.name}]`,recentDialogs:[],offlineActions:[],gameState:n,additionalInstructions:i});if(c.errors&&c.errors.length>0){const e=c.errors.join(', ');console.error('[RelationshipsModal] AI completion failed:',e),t&&a&&t.setTaskError(a,e)}else console.log('[RelationshipsModal] AI completion successful'),l.value++,t&&a&&t.completeTask(a)}catch(e){console.error('[RelationshipsModal] AI completion error:',e);const s=e instanceof Error?e.message:String(e);t&&a&&t.setTaskError(a,s)}},handleDeleteRelation:()=>{if(!c.value)return;const e=c.value;N.value=e,P.value=`确定要删除与「${e.name}」的关系记录吗？此操作不可撤销。`,D.value=!0,E()},deleteConfirmVisible:D,deleteConfirmMessage:P,confirmDeleteRelation:()=>{if(!N.value)return;const e=N.value,a=Ll.serviceLocator.get('SaveService'),n=a.getGameState();n?.relation?.characters[e.id]&&(delete n.relation.characters[e.id],a.saveData(),l.value++,s.value===e.id&&f(),t('update-relation',n.relation),console.log('[RelationshipsModal] 删除关系:',e.name)),N.value=null},cancelDeleteRelation:()=>{N.value=null},showAvatarEditor:g,openAvatarEditor:()=>{w.value&&(g.value=!0)},saveAvatar:e=>{if(!s.value||!e)return;const a=Ll.serviceLocator.get('SaveService'),n=a.getGameState();n?.relation?.characters[s.value]&&(n.relation.characters[s.value].avatar=e,a.saveData(),l.value++,t('update-relation',n.relation),g.value=!1)}}}}),GB=(0,$u.A)(HB,[['render',function(e,t,a,s,n,r){const l=fs('AvatarDisplay'),o=fs('ModalDialog'),i=fs('AvatarEditorModal');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-2 sm:p-4',style:{'padding-top':'max(0.5rem, env(safe-area-inset-top))','padding-bottom':'max(0.5rem, env(safe-area-inset-bottom))'},onClick:t[31]||(t[31]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',qj,[Rn(' Header '),Mn('div',Uj,[Mn('div',Vj,[Mn('span',Fj,oe(e.simpleMode?'👤':'👥'),1),Mn('h2',Hj,oe(e.simpleMode?'周围角色':'人际关系'),1)]),Mn('button',{class:'flex h-7 w-7 items-center justify-center rounded text-gray-400 transition-colors hover:bg-[#40444b] hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},' ✕ ')]),Rn(' Content Area '),Mn('div',Gj,[Rn(' Left: Character List (隐藏在简化模式下) '),e.simpleMode?Rn('v-if',!0):(yn(),Sn('div',{key:0,class:ee(['w-full overflow-y-auto border-r border-[#202225] bg-[#2f3136] md:w-1/3',e.hasSelection?'hidden md:block':'block'])},[Rn(' 筛选栏 '),Mn('div',zj,[xa(Mn('select',{'onUpdate:modelValue':t[1]||(t[1]=t=>e.characterFilter=t),class:'w-full rounded bg-[#40444b] px-2 py-1.5 text-sm text-gray-200 focus:ring-2 focus:ring-[#5865F2] focus:outline-none'},[t[32]||(t[32]=Mn('option',{value:'all'},'全部角色',-1)),t[33]||(t[33]=Mn('option',{value:'starred'},'⭐ 星标角色',-1)),t[34]||(t[34]=Mn('option',{value:'friend'},'💚 好感度≥50',-1)),e.showSceneNpcs?(yn(),Sn('option',Wj,'📍 当前场景')):Rn('v-if',!0)],512),[[bl,e.characterFilter]])]),Rn(' 角色列表 '),Mn('div',Qj,[Rn(' 场景临时角色 (只有在 showSceneNpcs 为 true 时显示，排在最前面) '),!e.showSceneNpcs||'all'!==e.characterFilter&&'scene'!==e.characterFilter?Rn('v-if',!0):(yn(),Sn(pn,{key:0},[e.visibleSceneNpcs.length>0?(yn(),Sn('div',Xj,[...t[35]||(t[35]=[Mn('span',{class:'mr-1.5'},'📍',-1),Mn('span',null,'当前场景',-1),Mn('div',{class:'ml-2 flex-1 border-t border-gray-600'},null,-1)])])):Rn('v-if',!0),(yn(!0),Sn(pn,null,xs(e.visibleSceneNpcs,(a,s)=>(yn(),Sn('div',{key:`scene-${s}`,class:ee(['flex cursor-pointer items-center rounded px-2 py-1.5 transition-colors',e.selectedSceneNpcIdx===s?'bg-[#40444b]':'hover:bg-[#40444b]/50']),onClick:t=>e.selectSceneNpc(a,s)},[t[36]||(t[36]=Mn('div',{class:'mr-2 flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-[#5865F2]/20 text-base'},' 👤 ',-1)),Mn('div',Kj,[Mn('div',Jj,[Mn('span',Zj,oe(a.name),1),Mn('button',{class:'ml-1 text-xs text-gray-400 hover:text-yellow-400',title:'收藏',onClick:Cl(t=>e.starSceneNpc(a),['stop'])},' ☆ ',8,eL)]),Mn('div',tL,oe(a.status),1)]),Mn('div',aL,[Mn('span',sL,oe(a.attitude||'中立'),1)])],10,Yj))),128))],64)),Rn(' 分隔线：已收藏角色 (只有在有场景NPC显示时才需要分隔线) '),e.showSceneNpcs&&e.visibleSceneNpcs.length>0&&e.filteredCharacters.length>0&&('all'===e.characterFilter||'scene'===e.characterFilter)?(yn(),Sn('div',nL,[...t[37]||(t[37]=[Mn('span',{class:'mr-1.5'},'⭐',-1),Mn('span',null,'已收藏',-1),Mn('div',{class:'ml-2 flex-1 border-t border-gray-600'},null,-1)])])):Rn('v-if',!0),Rn(' 星标/持久化角色 '),(yn(!0),Sn(pn,null,xs(e.filteredCharacters,a=>(yn(),Sn('div',{key:a.id,class:ee(['flex cursor-pointer items-center rounded px-2 py-1.5 transition-colors',e.selectedCharId===a.id?'bg-[#40444b]':'hover:bg-[#40444b]/50']),onClick:t=>e.selectCharacter(a),onContextmenu:Cl(t=>e.showContextMenu(t,a),['prevent']),onTouchstart:t=>e.handleTouchStart(t,a),onTouchend:t[2]||(t[2]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t)),onTouchmove:t[3]||(t[3]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[En(l,{avatar:e.getCharAvatar(a),name:a.name,size:'sm',class:'mr-2 shrink-0'},null,8,['avatar','name']),Mn('div',lL,[Mn('div',oL,[Mn('span',iL,oe(a.name),1),a.isStarred?(yn(),Sn('span',cL,'⭐')):Rn('v-if',!0),a.linkedAllyId?(yn(),Sn('span',dL,'👥')):Rn('v-if',!0)]),Mn('div',uL,[Mn('span',{class:ee(e.getRelColor(a.rel))},oe(e.getRelLabel(a.rel)),3),a.occupation?(yn(),Sn('span',pL,oe(a.occupation),1)):Rn('v-if',!0)])]),Mn('div',mL,[Mn('span',{class:ee(e.getRelColor(a.rel))},oe(a.rel??0),3)])],42,rL))),128)),Rn(' 空状态 '),0!==e.filteredCharacters.length||e.showSceneNpcs&&0!==e.visibleSceneNpcs.length?Rn('v-if',!0):(yn(),Sn('div',gL,' 暂无角色记录 '))])],2)),Rn(' Right: Detail Panel '),Mn('div',{class:ee(['flex flex-1 flex-col overflow-hidden p-3',e.hasSelection?'flex':'hidden md:flex'])},[Rn(' Mobile Back Button '),e.hasSelection?(yn(),Sn('button',{key:0,class:'mb-3 flex shrink-0 items-center rounded px-2 py-1 text-sm text-gray-400 hover:bg-[#40444b] hover:text-white md:hidden',onClick:t[4]||(t[4]=(...t)=>e.clearSelection&&e.clearSelection(...t))},[...t[38]||(t[38]=[Mn('span',{class:'mr-1'},'⬅',-1),Pn(' 返回 ',-1)])])):Rn('v-if',!0),Rn(' 角色详情（已收藏角色） '),e.selectedChar?(yn(),Sn('div',hL,[Rn(' 头部信息 - 固定区域 '),Mn('div',fL,[En(l,{avatar:e.getCharAvatar(e.selectedChar),name:e.selectedChar.name,size:'md',clickable:!0,class:'mr-3 shrink-0 cursor-pointer transition-all hover:ring-2 hover:ring-[#5865f2]',title:'点击编辑头像',onClick:e.openAvatarEditor},null,8,['avatar','name','onClick']),Mn('div',vL,[Mn('div',yL,[Mn('h3',bL,oe(e.selectedChar.name),1),e.selectedChar.isStarred?(yn(),Sn('button',{key:1,class:'text-sm text-yellow-400 hover:text-gray-400',title:'取消星标',onClick:t[6]||(t[6]=t=>e.toggleStar(e.selectedChar))},' ⭐ ')):(yn(),Sn('button',{key:0,class:'text-sm text-gray-400 hover:text-yellow-400',title:'添加星标',onClick:t[5]||(t[5]=t=>e.toggleStar(e.selectedChar))},' ☆ ')),e.selectedChar.linkedAllyId?(yn(),Sn('span',xL,'👥')):Rn('v-if',!0)]),Mn('div',wL,[Pn(oe(e.displayValue(e.selectedChar.occupation,'身份不明'))+' ',1),e.selectedChar.relType?(yn(),Sn('span',kL,'• '+oe(e.getRelTypeLabel(e.selectedChar.relType)),1)):Rn('v-if',!0)]),Rn(' 好感度条 '),Mn('div',SL,[Mn('div',_L,[t[39]||(t[39]=Mn('span',{class:'text-gray-400'},'好感度',-1)),Mn('span',{class:ee(e.getRelColor(e.selectedChar.rel))},oe(e.getRelLabel(e.selectedChar.rel))+' ('+oe(e.selectedChar.rel??0)+')',3)]),Mn('div',CL,[Mn('div',{class:ee(['h-full transition-all',e.getRelBgColor(e.selectedChar.rel)]),style:X({width:e.getRelBarWidth(e.selectedChar.rel)})},null,6)])])])]),Rn(' 交互按钮区域 - 2行3列紧凑布局 '),Mn('div',IL,[Mn('div',TL,[Rn(' 第一行 '),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-[#4a4f57]',onClick:t[7]||(t[7]=t=>e.handleAction('chat'))},[...t[40]||(t[40]=[Mn('span',{class:'text-base'},'💬',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'交谈',-1)])]),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-[#4a4f57]',onClick:t[8]||(t[8]=t=>e.handleAction('gift'))},[...t[41]||(t[41]=[Mn('span',{class:'text-base'},'🎁',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'送礼',-1)])]),Mn('button',{class:ee(['flex flex-col items-center justify-center rounded px-2 py-1.5 text-xs transition-colors',e.isCurrentCharAlly?'cursor-not-allowed bg-[#2f3136] opacity-40':'bg-[#40444b] hover:bg-[#4a4f57]']),disabled:e.isCurrentCharAlly,title:e.isCurrentCharAlly?'该角色已是队友':'邀请加入队伍',onClick:t[9]||(t[9]=t=>!e.isCurrentCharAlly&&e.handleAction('invite'))},[t[42]||(t[42]=Mn('span',{class:'text-base'},'🤝',-1)),Mn('span',{class:ee(['mt-0.5',e.isCurrentCharAlly?'text-gray-500':'text-gray-300'])},'邀请',2)],10,AL),Rn(' 第二行 '),Mn('button',{class:ee(['flex flex-col items-center justify-center rounded px-2 py-1.5 text-xs transition-colors',(e.selectedChar?.rel??0)>=0?'bg-[#40444b] hover:bg-[#4a4f57]':'cursor-not-allowed bg-[#2f3136] opacity-40']),disabled:(e.selectedChar?.rel??0)<0,onClick:t[10]||(t[10]=t=>e.handleAction('flirt'))},[t[43]||(t[43]=Mn('span',{class:'text-base'},'💕',-1)),Mn('span',{class:ee(['mt-0.5',(e.selectedChar?.rel??0)>=0?'text-gray-300':'text-gray-500'])},'调情',2)],10,ML),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-red-900/50',onClick:t[11]||(t[11]=t=>e.handleAction('attack'))},[...t[44]||(t[44]=[Mn('span',{class:'text-base'},'⚔️',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'攻击',-1)])]),Mn('button',{class:ee(['flex flex-col items-center justify-center rounded px-2 py-1.5 text-xs transition-colors',(e.selectedChar?.rel??0)>=30?'bg-[#40444b] hover:bg-[#4a4f57]':'cursor-not-allowed bg-[#2f3136] opacity-40']),disabled:(e.selectedChar?.rel??0)<30,onClick:t[12]||(t[12]=t=>e.handleAction('spar'))},[t[45]||(t[45]=Mn('span',{class:'text-base'},'🤺',-1)),Mn('span',{class:ee(['mt-0.5',(e.selectedChar?.rel??0)>=30?'text-gray-300':'text-gray-500'])},'切磋',2)],10,EL)])]),Rn(' 标签页导航 - 固定区域 '),Mn('div',$L,[(yn(!0),Sn(pn,null,xs(e.tabs,t=>(yn(),Sn('button',{key:t.id,class:ee(['relative flex-1 py-2 text-sm font-medium transition-colors hover:text-white',e.activeTab===t.id?'text-white':'text-gray-400']),onClick:a=>e.activeTab=t.id},[Pn(oe(t.label)+' ',1),e.activeTab===t.id?(yn(),Sn('div',PL)):Rn('v-if',!0)],10,DL))),128))]),Rn(' 标签页内容 - 可滚动区域 '),Mn('div',NL,[Rn(' 基础信息 '),'basic'===e.activeTab?(yn(),Sn('div',RL,[Mn('div',jL,[Mn('div',LL,[t[46]||(t[46]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'外貌特征',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.appearance?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.appearance)),3)]),Mn('div',BL,[t[47]||(t[47]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'性格',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.personality?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.personality)),3)]),Mn('div',OL,[t[48]||(t[48]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'喜好',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.likes?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.likes)),3)]),Mn('div',qL,[t[49]||(t[49]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'厌恶',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.dislikes?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.dislikes)),3)]),Mn('div',UL,[t[50]||(t[50]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'常出没地点',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.haunt?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.haunt)),3)]),Mn('div',VL,[t[51]||(t[51]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'当前位置',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.location?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.location)),3)]),Mn('div',FL,[t[52]||(t[52]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'当前状态',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.status?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.status)),3)])]),Rn(' 元数据 '),Mn('div',HL,[Mn('span',null,'首次相遇: '+oe(e.formatDate(e.selectedChar.metAt)||'[未知]'),1),Mn('span',null,'最后见面: '+oe(e.formatDate(e.selectedChar.lastSeen)||'[未知]'),1)])])):Rn('v-if',!0),Rn(' 档案 '),'story'===e.activeTab?(yn(),Sn('div',GL,[Rn(' 私密档案 '),e.getLinkedAlly(e.selectedChar)?(yn(),Sn('div',zL,[Mn('div',WL,[t[53]||(t[53]=Mn('span',{class:'text-xs font-bold text-blue-400'},'🔒 私密档案',-1)),Mn('button',{class:'text-xs text-blue-400 hover:text-blue-300',onClick:t[13]||(t[13]=t=>e.$emit('show-private',e.getLinkedAlly(e.selectedChar)))},' 查看详情 ')]),Mn('div',QL,oe(e.getPrivateSummary(e.getLinkedAlly(e.selectedChar))),1)])):Rn('v-if',!0),Mn('div',XL,[Mn('div',YL,[t[54]||(t[54]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'人物背景',-1)),Mn('div',{class:ee(['text-sm whitespace-pre-wrap',e.selectedChar.background?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.background)),3)]),Mn('div',KL,[t[55]||(t[55]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'生平经历',-1)),Mn('div',{class:ee(['text-sm whitespace-pre-wrap',e.selectedChar.biography?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.biography)),3)])])])):Rn('v-if',!0),Rn(' 动态 '),'dynamics'===e.activeTab?(yn(),Sn('div',JL,[Rn(' 动机 '),Mn('div',ZL,[t[59]||(t[59]=Mn('h4',{class:'text-xs font-bold text-gray-500'},'动机与目标',-1)),Mn('div',eB,[t[56]||(t[56]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'当前动机',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.motivation?.current?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.motivation?.current)),3)]),Mn('div',tB,[Mn('div',aB,[t[57]||(t[57]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'短期目标',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.motivation?.shortTerm?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.motivation?.shortTerm)),3)]),Mn('div',sB,[t[58]||(t[58]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'长期目标',-1)),Mn('div',{class:ee(['text-sm',e.selectedChar.motivation?.longTerm?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedChar.motivation?.longTerm)),3)])])]),Rn(' 事迹 '),Mn('div',nB,[t[61]||(t[61]=Mn('h4',{class:'text-xs font-bold text-gray-500'},'事迹记录',-1)),Mn('div',rB,[e.selectedChar.deeds?.length?(yn(),Sn('ul',lB,[(yn(!0),Sn(pn,null,xs(e.selectedChar.deeds,(e,a)=>(yn(),Sn('li',{key:a,class:'flex items-start'},[t[60]||(t[60]=Mn('span',{class:'mr-2 text-gray-500'},'•',-1)),Mn('span',null,oe(e),1)]))),128))])):(yn(),Sn('div',oB,'[暂无事迹记录]'))])])])):Rn('v-if',!0),Rn(' 备注 '),'notes'===e.activeTab?(yn(),Sn('div',iB,[Mn('div',cB,[t[62]||(t[62]=Mn('div',{class:'mb-2 text-xs text-gray-500'},'私人备注 (仅自己可见)',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[14]||(t[14]=t=>e.editableNotes=t),class:'w-full flex-1 resize-none rounded bg-[#2f3136] p-2 text-sm text-gray-300 placeholder-gray-600 focus:ring-1 focus:ring-[#5865F2] focus:outline-none',placeholder:'关于此角色的备注...',onBlur:t[15]||(t[15]=(...t)=>e.saveNotes&&e.saveNotes(...t))},null,544),[[fl,e.editableNotes]])])])):Rn('v-if',!0)])])):e.selectedSceneNpc?(yn(),Sn(pn,{key:2},[Rn(' 场景NPC详情（未收藏的临时角色） '),Mn('div',dB,[Rn(' 头部信息 '),Mn('div',uB,[t[64]||(t[64]=Mn('div',{class:'mr-3 flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-[#5865F2]/20 text-2xl'},' 👤 ',-1)),Mn('div',pB,[Mn('div',mB,[Mn('h3',gB,oe(e.selectedSceneNpc.name),1),e.isNpcStarred(e.selectedSceneNpc)?(yn(),Sn('button',{key:1,class:'text-sm text-yellow-400 hover:text-gray-400',title:'取消收藏',onClick:t[17]||(t[17]=t=>e.toggleSceneNpcStar(e.selectedSceneNpc))},' ⭐ ')):(yn(),Sn('button',{key:0,class:'text-sm text-gray-400 hover:text-yellow-400',title:'收藏此角色',onClick:t[16]||(t[16]=t=>e.toggleSceneNpcStar(e.selectedSceneNpc))},' ☆ ')),e.isNpcStarred(e.selectedSceneNpc)?Rn('v-if',!0):(yn(),Sn('span',hB,'临时'))]),Mn('div',fB,oe(e.selectedSceneNpc.status),1),Rn(' 态度显示 '),Mn('div',vB,[Mn('div',yB,[t[63]||(t[63]=Mn('span',{class:'text-gray-400'},'态度',-1)),Mn('span',bB,oe(e.selectedSceneNpc.attitude||'中立'),1)])])])]),Rn(' 场景NPC的基础信息（简化版） '),Mn('div',xB,[t[67]||(t[67]=Mn('div',{class:'px-3 py-2 text-sm font-medium text-gray-300'},[Mn('span',null,'📋 已知信息')],-1)),Mn('div',wB,[Mn('div',kB,[Mn('div',SB,[t[65]||(t[65]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'外貌特征',-1)),Mn('div',_B,oe(e.selectedSceneNpc.appearance),1)]),Mn('div',CB,[t[66]||(t[66]=Mn('div',{class:'mb-0.5 text-xs text-gray-500'},'性格',-1)),Mn('div',{class:ee(['text-sm',e.selectedSceneNpc.personality?'text-gray-300':'text-gray-600 italic'])},oe(e.displayValue(e.selectedSceneNpc.personality)),3)])])])]),Rn(' 交互按钮区域 - 2行3列紧凑布局（场景NPC版） '),Mn('div',IB,[Mn('div',TB,[Rn(' 第一行 '),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-[#4a4f57]',onClick:t[18]||(t[18]=t=>e.handleAction('chat'))},[...t[68]||(t[68]=[Mn('span',{class:'text-base'},'💬',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'交谈',-1)])]),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-[#4a4f57]',onClick:t[19]||(t[19]=t=>e.handleAction('gift'))},[...t[69]||(t[69]=[Mn('span',{class:'text-base'},'🎁',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'送礼',-1)])]),Mn('button',{class:ee(['flex flex-col items-center justify-center rounded px-2 py-1.5 text-xs transition-colors',e.isCurrentSceneNpcAlly?'cursor-not-allowed bg-[#2f3136] opacity-40':'bg-[#40444b] hover:bg-[#4a4f57]']),disabled:e.isCurrentSceneNpcAlly,title:e.isCurrentSceneNpcAlly?'该角色已是队友':'邀请加入队伍',onClick:t[20]||(t[20]=t=>!e.isCurrentSceneNpcAlly&&e.handleAction('invite'))},[t[70]||(t[70]=Mn('span',{class:'text-base'},'🤝',-1)),Mn('span',{class:ee(['mt-0.5',e.isCurrentSceneNpcAlly?'text-gray-500':'text-gray-300'])},'邀请',2)],10,AB),Rn(' 第二行 '),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-[#4a4f57]',onClick:t[21]||(t[21]=t=>e.handleAction('flirt'))},[...t[71]||(t[71]=[Mn('span',{class:'text-base'},'💕',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'调情',-1)])]),Mn('button',{class:'flex flex-col items-center justify-center rounded bg-[#40444b] px-2 py-1.5 text-xs transition-colors hover:bg-red-900/50',onClick:t[22]||(t[22]=t=>e.handleAction('attack'))},[...t[72]||(t[72]=[Mn('span',{class:'text-base'},'⚔️',-1),Mn('span',{class:'mt-0.5 text-gray-300'},'攻击',-1)])]),t[73]||(t[73]=Mn('button',{class:'flex cursor-not-allowed flex-col items-center justify-center rounded bg-[#2f3136] px-2 py-1.5 text-xs opacity-40 transition-colors',disabled:'',title:'临时角色无法切磋，收藏后可用'},[Mn('span',{class:'text-base'},'🤺'),Mn('span',{class:'mt-0.5 text-gray-500'},'切磋')],-1))])])])],64)):(yn(),Sn(pn,{key:3},[Rn(' 默认空状态 '),t[74]||(t[74]=Mn('div',{class:'flex h-full items-center justify-center text-gray-500'},[Mn('div',{class:'text-center'},[Mn('div',{class:'mb-2 text-3xl'},'👥'),Mn('p',{class:'text-sm'},'选择角色查看详情')])],-1))],64))],2)]),Rn(' Footer '),Mn('div',MB,[Mn('div',EB,'已认识: '+oe(e.characterCount)+' 人',1),Mn('button',{class:'rounded bg-[#40444b] px-3 py-1 text-sm text-white hover:bg-[#4a4f57]',onClick:t[23]||(t[23]=t=>e.$emit('close'))},' 关闭 ')])]),Rn(' 右键/长按上下文菜单 '),En(wr,{name:'context-menu-fade'},{default:ba(()=>[e.contextMenuVisible?(yn(),Sn('div',{key:0,class:'context-menu fixed z-100 min-w-[140px] rounded-lg border border-[#40444b] bg-[#2f3136] py-1 shadow-xl',style:X({left:e.contextMenuPos.x+'px',top:e.contextMenuPos.y+'px'}),onClick:t[26]||(t[26]=Cl(()=>{},['stop']))},[Mn('button',{class:'flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-gray-300 hover:bg-[#40444b] hover:text-white',disabled:e.isAiCompleting,onClick:t[24]||(t[24]=(...t)=>e.handleAiComplete&&e.handleAiComplete(...t))},[t[75]||(t[75]=Mn('span',null,'🤖',-1)),Mn('span',null,oe(e.isAiCompleting?'信息补全中...':'信息补全'),1)],8,$B),t[77]||(t[77]=Mn('div',{class:'my-1 border-t border-[#40444b]'},null,-1)),Mn('button',{class:'flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-red-400 hover:bg-red-900/30 hover:text-red-300',onClick:t[25]||(t[25]=(...t)=>e.handleDeleteRelation&&e.handleDeleteRelation(...t))},[...t[76]||(t[76]=[Mn('span',null,'🗑️',-1),Mn('span',null,'删除关系',-1)])])],4)):Rn('v-if',!0)]),_:1}),Rn(' 点击遮罩层关闭菜单 (透明遮罩，不阻挡背景可见性) '),e.contextMenuVisible?(yn(),Sn('div',{key:0,class:'context-menu-overlay',onClick:t[27]||(t[27]=(...t)=>e.hideContextMenu&&e.hideContextMenu(...t)),onContextmenu:t[28]||(t[28]=Cl((...t)=>e.hideContextMenu&&e.hideContextMenu(...t),['prevent']))},null,32)):Rn('v-if',!0),Rn(' 删除确认对话框 '),En(o,{visible:e.deleteConfirmVisible,'onUpdate:visible':t[29]||(t[29]=t=>e.deleteConfirmVisible=t),type:'confirm',title:'删除关系',message:e.deleteConfirmMessage,'confirm-text':'删除','cancel-text':'取消',onConfirm:e.confirmDeleteRelation,onCancel:e.cancelDeleteRelation},null,8,['visible','message','onConfirm','onCancel']),Rn(' 头像编辑器 '),En(i,{visible:e.showAvatarEditor,'current-avatar':e.selectedChar?.avatar||'',title:`编辑 ${e.selectedChar?.name||'角色'} 的头像`,onClose:t[30]||(t[30]=t=>e.showAvatarEditor=!1),onUpdateAvatar:e.saveAvatar},null,8,['visible','current-avatar','title','onUpdateAvatar'])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-17547a8d']]),zB={key:0,class:'system-modal-container'},WB={class:'menu-buttons'};const QB={class:'save-load-root'},XB={class:'content-layer'},YB={class:'sl-header'},KB={class:'header-title-section'},JB={class:'header-title'},ZB={class:'header-actions'},eO={class:'action-btn import-btn'},tO={class:'slots-container'},aO={class:'slot-info'},sO={class:'slot-meta'},nO={key:0,class:'slot-time'},rO={key:0,class:'slot-detail'},lO=['onClick'],oO={class:'slot-info'},iO={class:'slot-meta'},cO={class:'slot-badge'},dO={key:0,class:'slot-time'},uO={key:0,class:'slot-detail'},pO=['onClick'],mO=['onClick'],gO=['onClick'],hO=['onClick'],fO=['onClick'],vO=Za({__name:'SaveLoadScreen',props:{mode:{},isMainMenu:{type:Boolean}},emits:['close','loaded','saved'],setup(e,{emit:t}){const a=e,s=t,n=e=>e?.scene?.locationPath?.length>0?e.scene.locationPath.join(' > '):e?.scene?.name?e.scene.name:'未知位置',r=$t({}),l=$t(null),o=Ll.serviceLocator.get('SaveService'),i=xt({visible:!1,type:'alert',title:'',message:'',placeholder:'',confirmText:'确定',cancelText:'取消',initialValue:'',action:null,autoFocus:!0}),c=(e,t,a,s=null,n={})=>{i.type=e,i.title=t,i.message=a,i.action=s,i.placeholder=n.placeholder||'',i.initialValue=n.initialValue||'',i.confirmText=n.confirmText||'确定',i.autoFocus=n.autoFocus??!0,i.visible=!0},d=e=>{i.action&&i.action(e),i.visible=!1},u=()=>{i.visible=!1},p=async()=>{const e=await o.getAllSlots();r.value={},e.forEach(e=>{r.value[e.slotId]=e})},m=e=>new Date(e).toLocaleString(),g=e=>{l.value=e},h=async e=>{const t=`存档 ${e} - ${(new Date).toLocaleTimeString()}`;c('prompt','保存游戏','请输入存档描述：',async a=>{try{await o.saveToSlot(e,a||t),await p(),s('saved')}catch(e){console.error(e),c('alert','错误','保存失败')}},{initialValue:t,autoFocus:!1})},f=async e=>{try{const t=await o.exportSlot(e),a=new Blob([t],{type:'application/json'}),s=URL.createObjectURL(a),n=document.createElement('a');n.href=s,n.download=`tavern_rpg_slot${e}_${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}catch(e){console.error(e),c('alert','错误','导出失败，存档可能为空。')}},v=async e=>{const t=async()=>{try{await o.loadFromSlot(e)?(s('loaded'),s('close')):c('alert','错误','读取失败')}catch(e){console.error(e),c('alert','错误','读取失败')}};a.isMainMenu?await t():c('confirm','读取确认','确定要读取这个存档吗？未保存的进度将会丢失。',async()=>{await t()})},y=async e=>{const t=e.target;if(!t.files||0===t.files.length)return;const a=t.files[0],n=new FileReader;n.onload=async e=>{try{const t=e.target?.result;await o.importSave(t)?c('alert','导入成功','存档已成功导入并覆盖当前进度。',()=>{s('loaded'),s('close')}):c('alert','错误','导入失败：文件格式不正确。')}catch(e){console.error(e),c('alert','错误','导入过程中发生错误。')}},n.readAsText(a),t.value=''},b=e=>{'Escape'===e.key&&s('close')};return us(()=>{p(),window.addEventListener('keydown',b)}),gs(()=>{window.removeEventListener('keydown',b)}),(t,a)=>(yn(),Sn('div',QB,[Rn(' 背景层 '),a[12]||(a[12]=Mn('div',{class:'bg-layer'},null,-1)),a[13]||(a[13]=Mn('div',{class:'vignette'},null,-1)),a[14]||(a[14]=Mn('div',{class:'noise'},null,-1)),Rn(' 内容层 '),Mn('div',XB,[Rn(' Header '),Mn('div',YB,[Mn('div',KB,[a[6]||(a[6]=Mn('span',{class:'header-deco'},'◇',-1)),Mn('h2',JB,oe('save'===e.mode?'保存游戏':'读取游戏'),1),a[7]||(a[7]=Mn('span',{class:'header-deco'},'◇',-1))]),Mn('div',ZB,[Mn('label',eO,[a[8]||(a[8]=Mn('span',{class:'btn-icon'},'📥',-1)),a[9]||(a[9]=Mn('span',{class:'btn-text'},'导入',-1)),Mn('input',{type:'file',class:'hidden',accept:'.json',onChange:y},null,32)]),Mn('button',{class:'action-btn close-btn',onClick:a[0]||(a[0]=e=>t.$emit('close'))},[...a[10]||(a[10]=[Mn('span',{class:'btn-icon'},'✕',-1),Mn('span',{class:'btn-text'},'关闭',-1)])])])]),Rn(' Slots List '),Mn('div',tO,[Rn(' Autosave Slot (Fixed at top) '),Mn('div',{class:ee(['slot-card autosave',{selected:0===l.value}]),onClick:a[4]||(a[4]=e=>g(0))},[Mn('div',aO,[Mn('div',sO,[a[11]||(a[11]=Mn('span',{class:'slot-badge autosave-badge'},'自动存档',-1)),r.value[0]?(yn(),Sn('span',nO,oe(m(r.value[0].timestamp)),1)):Rn('v-if',!0)]),Mn('div',{class:ee(['slot-label',{empty:!r.value[0]}])},oe(r.value[0]?r.value[0].label:'无存档数据'),3),r.value[0]&&r.value[0].gameState?(yn(),Sn('div',rO,' Lv.'+oe(r.value[0].gameState.player.base.level)+' '+oe(r.value[0].gameState.player.base.race)+' '+oe(r.value[0].gameState.player.base.class)+' - '+oe(n(r.value[0].gameState)),1)):Rn('v-if',!0)]),Mn('div',{class:ee(['slot-actions',{visible:0===l.value}])},['save'===e.mode?(yn(),Sn('button',{key:0,class:'slot-btn save',onClick:a[1]||(a[1]=Cl(e=>h(0),['stop']))},'覆盖')):Rn('v-if',!0),'load'===e.mode&&r.value[0]?(yn(),Sn('button',{key:1,class:'slot-btn load',onClick:a[2]||(a[2]=Cl(e=>v(0),['stop']))},'读取')):Rn('v-if',!0),r.value[0]?(yn(),Sn('button',{key:2,class:'slot-btn export',title:'导出存档',onClick:a[3]||(a[3]=Cl(e=>f(0),['stop']))},' 导出 ')):Rn('v-if',!0)],2)],2),Rn(' Manual Slots '),(yn(),Sn(pn,null,xs(20,t=>Mn('div',{key:t,class:ee(['slot-card',{selected:l.value===t}]),onClick:e=>g(t)},[Mn('div',oO,[Mn('div',iO,[Mn('span',cO,'存档 '+oe(t),1),r.value[t]?(yn(),Sn('span',dO,oe(m(r.value[t].timestamp)),1)):Rn('v-if',!0)]),Mn('div',{class:ee(['slot-label',{empty:!r.value[t]}])},oe(r.value[t]?r.value[t].label:'空插槽'),3),r.value[t]&&r.value[t].gameState?(yn(),Sn('div',uO,' Lv.'+oe(r.value[t].gameState.player.base.level)+' '+oe(r.value[t].gameState.player.base.race)+' '+oe(r.value[t].gameState.player.base.class)+' - '+oe(n(r.value[t].gameState)),1)):Rn('v-if',!0)]),Mn('div',{class:ee(['slot-actions',{visible:l.value===t}])},['save'===e.mode?(yn(),Sn('button',{key:0,class:'slot-btn save',onClick:Cl(e=>h(t),['stop'])},oe(r.value[t]?'覆盖':'保存'),9,pO)):Rn('v-if',!0),'load'===e.mode&&r.value[t]?(yn(),Sn('button',{key:1,class:'slot-btn load',onClick:Cl(e=>v(t),['stop'])},'读取',8,mO)):Rn('v-if',!0),r.value[t]?(yn(),Sn('button',{key:2,class:'slot-btn rename',title:'重命名存档',onClick:Cl(e=>(async e=>{const t=r.value[e]?.label||`存档 ${e}`;c('prompt','重命名存档','请输入新的存档名称：',async t=>{if(t&&t.trim())try{await o.renameSlot(e,t.trim()),await p()}catch(e){console.error(e),c('alert','错误','重命名失败')}},{initialValue:t})})(t),['stop'])},' 改名 ',8,gO)):Rn('v-if',!0),r.value[t]?(yn(),Sn('button',{key:3,class:'slot-btn export',title:'导出存档',onClick:Cl(e=>f(t),['stop'])},' 导出 ',8,hO)):Rn('v-if',!0),r.value[t]?(yn(),Sn('button',{key:4,class:'slot-btn delete',title:'删除存档',onClick:Cl(e=>(async e=>{c('confirm','删除确认','确定要删除这个存档吗？此操作不可恢复。',async()=>{await o.deleteSlot(e),await p()},{confirmText:'删除'})})(t),['stop'])},'删除',8,fO)):Rn('v-if',!0)],2)],10,lO)),64))])]),En(FB,{visible:i.visible,'onUpdate:visible':a[5]||(a[5]=e=>i.visible=e),type:i.type,title:i.title,message:i.message,placeholder:i.placeholder,'confirm-text':i.confirmText,'cancel-text':i.cancelText,'initial-value':i.initialValue,'auto-focus':i.autoFocus,onConfirm:d,onCancel:u},null,8,['visible','type','title','message','placeholder','confirm-text','cancel-text','initial-value','auto-focus'])]))}}),yO=(0,$u.A)(vO,[['__scopeId','data-v-57be432c']]),bO=Za({name:'SystemModal',components:{SaveLoadScreen:yO,ModalDialog:FB},props:{visible:{type:Boolean,default:!1},initialView:{type:String,default:'menu'}},emits:['close','save','settings','title','loaded'],setup(e,{emit:t}){const a=$t('save'===e.initialView||'load'===e.initialView),s=$t('load'===e.initialView?'load':'save');_a(()=>e.visible,t=>{t&&(a.value='save'===e.initialView||'load'===e.initialView,s.value='load'===e.initialView?'load':'save')});const n=xt({visible:!1,type:'alert',title:'',message:'',confirmText:'确定',cancelText:'取消',action:null});return{showSaveScreen:a,saveMode:s,modal:n,openSaveScreen:e=>{s.value=e,a.value=!0},handleSaveAndExit:async()=>{const e=Ll.serviceLocator.get('SaveService');try{await e.saveToSlot(0,'快速保存 - 退出'),t('title')}catch(e){console.error(e),sc('保存失败，无法退出','error')}},handleReturnTitle:()=>{n.type='confirm',n.title='返回标题',n.message='确定要返回标题画面吗？未保存的进度将会丢失。',n.confirmText='确定退出',n.action=()=>t('title'),n.visible=!0},onModalConfirm:()=>{n.action&&n.action(),n.visible=!1},onModalCancel:()=>{n.visible=!1},onSaved:()=>{},onLoaded:()=>{a.value=!1,t('loaded'),t('close')},onSaveScreenClose:()=>{'save'===e.initialView||'load'===e.initialView?t('close'):a.value=!1}}}}),xO=(0,$u.A)(bO,[['render',function(e,t,a,s,n,r){const l=fs('SaveLoadScreen'),o=fs('ModalDialog');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'system-modal-backdrop',onClick:t[6]||(t[6]=Cl(t=>e.$emit('close'),['self']))},[Rn(' 背景效果层 '),t[16]||(t[16]=Mn('div',{class:'modal-vignette'},null,-1)),t[17]||(t[17]=Mn('div',{class:'modal-noise'},null,-1)),En(wr,{name:'modal-scale'},{default:ba(()=>[!e.showSaveScreen&&e.visible?(yn(),Sn('div',zB,[Rn(' 顶部装饰线 '),t[13]||(t[13]=Mn('div',{class:'modal-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Rn(' 标题 '),t[14]||(t[14]=Mn('h2',{class:'modal-title'},[Mn('span',{class:'title-icon'},'⚙'),Mn('span',{class:'title-text'},'系统菜单'),Mn('span',{class:'title-icon'},'⚙')],-1)),Rn(' 菜单按钮组 '),Mn('div',WB,[Mn('button',{class:'menu-btn',onClick:t[0]||(t[0]=t=>e.openSaveScreen('save'))},[...t[7]||(t[7]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-icon'},'💾',-1),Mn('span',{class:'btn-content'},'保存游戏',-1)])]),Mn('button',{class:'menu-btn',onClick:t[1]||(t[1]=t=>e.openSaveScreen('load'))},[...t[8]||(t[8]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-icon'},'📂',-1),Mn('span',{class:'btn-content'},'读取游戏',-1)])]),Mn('button',{class:'menu-btn accent-amber',onClick:t[2]||(t[2]=(...t)=>e.handleSaveAndExit&&e.handleSaveAndExit(...t))},[...t[9]||(t[9]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-icon'},'🚪',-1),Mn('span',{class:'btn-content'},'保存并退出',-1)])]),Rn(' 分隔线 '),t[11]||(t[11]=Mn('div',{class:'menu-divider'},[Mn('span',{class:'divider-diamond'},'◆')],-1)),Mn('button',{class:'menu-btn accent-red',onClick:t[3]||(t[3]=(...t)=>e.handleReturnTitle&&e.handleReturnTitle(...t))},[...t[10]||(t[10]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-icon'},'🏠',-1),Mn('span',{class:'btn-content'},'返回主标题',-1)])])]),Rn(' 底部装饰线 '),t[15]||(t[15]=Mn('div',{class:'modal-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Rn(' 关闭按钮 '),Mn('button',{class:'close-btn',onClick:t[4]||(t[4]=t=>e.$emit('close'))},[...t[12]||(t[12]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'关闭',-1)])])])):Rn('v-if',!0)]),_:1}),e.showSaveScreen?(yn(),_n(l,{key:0,mode:e.saveMode,onClose:e.onSaveScreenClose,onSaved:e.onSaved,onLoaded:e.onLoaded},null,8,['mode','onClose','onSaved','onLoaded'])):Rn('v-if',!0),En(o,{visible:e.modal.visible,'onUpdate:visible':t[5]||(t[5]=t=>e.modal.visible=t),type:e.modal.type,title:e.modal.title,message:e.modal.message,'confirm-text':e.modal.confirmText,'cancel-text':e.modal.cancelText,onConfirm:e.onModalConfirm,onCancel:e.onModalCancel},null,8,['visible','type','title','message','confirm-text','cancel-text','onConfirm','onCancel'])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-04d3f420']]),wO={class:'flex h-[85vh] w-[95%] max-w-3xl flex-col rounded-lg border border-[#373a40] bg-[#2f3136] shadow-2xl md:h-[80vh] md:w-[90%]'},kO={class:'flex items-center justify-between border-b border-[#373a40] px-3 py-2 md:px-6 md:py-4'},SO={class:'flex overflow-x-auto border-b border-[#373a40] bg-[#36393f]'},_O=['onClick'],CO={key:0,class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},IO={class:'flex-1 overflow-hidden'},TO={key:2,class:'flex h-full flex-col overflow-hidden p-2 md:p-4'},AO={class:'flex flex-1 flex-col gap-2 overflow-hidden md:flex-row md:gap-4'},MO={class:'flex-1 overflow-y-auto md:max-w-[45%]'},EO={class:'space-y-2 md:space-y-3'},$O={class:'rounded border border-[#373a40] bg-[#36393f] p-2'},DO={class:'flex items-center gap-2'},PO={class:'w-6 text-center text-[10px] text-white md:text-xs'},NO={class:'rounded border border-[#373a40] bg-[#36393f] p-2'},RO={class:'flex items-center gap-2'},jO={class:'w-6 text-center text-[10px] text-white md:text-xs'},LO={class:'rounded border border-[#373a40] bg-[#36393f] p-2'},BO={class:'flex items-center gap-2'},OO={class:'w-6 text-center text-[10px] text-white md:text-xs'},qO={class:'mt-1 text-[8px] text-gray-500 md:text-[10px]'},UO={class:'rounded border border-[#373a40] bg-[#36393f] p-2'},VO={class:'flex items-center gap-2'},FO={class:'w-6 text-center text-[10px] text-white md:text-xs'},HO={class:'flex flex-1 flex-col overflow-hidden rounded border border-[#373a40] bg-[#1e1f22]'},GO={class:'flex items-center justify-between border-b border-[#373a40] bg-[#2f3136] px-2 py-1'},zO={class:'flex-1 overflow-y-auto p-2'},WO={key:0,class:'py-4 text-center text-[10px] text-gray-500 md:text-xs'},QO={key:1,class:'space-y-1.5'},XO={class:'flex items-center gap-1 text-[8px] text-gray-400 md:text-[10px]'},YO={key:0,class:'text-yellow-400'},KO={class:'mt-0.5 line-clamp-2 text-[9px] text-gray-300 md:text-[10px]'},JO={key:4,class:'h-full overflow-y-auto p-3 md:p-6'},ZO={class:'space-y-3 md:space-y-6'},eq={class:'rounded-lg border border-[#373a40] bg-[#36393f] p-2 md:p-4'},tq={class:'space-y-2 md:space-y-4'},aq={class:'flex items-center space-x-2 md:space-x-3'},sq={key:0,class:'space-y-2 md:space-y-4'},nq={class:'flex gap-2'},rq={class:'relative flex-1'},lq=['value'],oq={key:2,class:'pointer-events-none absolute top-1/2 right-2 h-3 w-3 -translate-y-1/2 text-gray-400 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},iq=['disabled'],cq={key:0,class:'flex items-center gap-1'},dq={key:1},uq={class:'rounded-lg border border-[#373a40] bg-[#36393f] p-2 md:p-4'},pq={class:'space-y-2 md:space-y-4'},mq={class:'flex items-center space-x-2 md:space-x-3'},gq={key:0,class:'space-y-2 md:space-y-4'},hq={class:'flex gap-2'},fq={class:'relative flex-1'},vq=['value'],yq={key:2,class:'pointer-events-none absolute top-1/2 right-2 h-3 w-3 -translate-y-1/2 text-gray-400 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},bq=['disabled'],xq={key:0,class:'flex items-center gap-1'},wq={key:1},kq={class:'rounded-lg border border-[#373a40] bg-[#36393f] p-2 md:p-4'},Sq={class:'space-y-2 md:space-y-4'},_q={class:'flex items-center space-x-2 md:space-x-3'},Cq={key:0,class:'space-y-2 md:space-y-4'},Iq={class:'flex gap-2'},Tq={class:'relative flex-1'},Aq=['value'],Mq={key:2,class:'pointer-events-none absolute top-1/2 right-2 h-3 w-3 -translate-y-1/2 text-gray-400 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Eq=['disabled'],$q={key:0,class:'flex items-center gap-1'},Dq={key:1},Pq={class:'rounded-lg border border-[#373a40] bg-[#36393f] p-2 md:p-4'},Nq={class:'space-y-2 md:space-y-4'},Rq={class:'flex items-center space-x-2 md:space-x-3'},jq={key:0,class:'space-y-2 md:space-y-4'},Lq={class:'flex gap-2'},Bq={class:'relative flex-1'},Oq=['value'],qq={key:2,class:'pointer-events-none absolute top-1/2 right-2 h-3 w-3 -translate-y-1/2 text-gray-400 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Uq=['disabled'],Vq={key:0,class:'flex items-center gap-1'},Fq={key:1},Hq={key:5,class:'h-full overflow-y-auto p-3 md:p-6'},Gq={class:'space-y-3 md:space-y-6'},zq={class:'rounded-lg border border-[#373a40] bg-[#36393f] p-2 md:p-4'},Wq={class:'space-y-2 md:space-y-4'},Qq={class:'flex items-center space-x-2 md:space-x-3'},Xq={class:'flex items-center space-x-2 md:space-x-3'},Yq={class:'rounded-lg border border-[#373a40] bg-[#36393f] p-2 md:p-4'},Kq={class:'space-y-2 md:space-y-4'},Jq={class:'flex items-center space-x-2 md:space-x-4'},Zq={class:'w-10 text-center text-[10px] text-white md:w-12 md:text-sm'},eU={class:'flex items-center space-x-2 md:space-x-4'},tU={class:'w-10 text-center text-[10px] text-white md:w-12 md:text-sm'},aU={class:'flex items-center space-x-2 md:space-x-4'},sU={class:'w-10 text-center text-[10px] text-white md:w-12 md:text-sm'},nU={class:'flex items-center space-x-2 md:space-x-3'},rU={class:'flex items-center space-x-2 md:space-x-3'};const lU={class:'shrink-0'},oU={key:0,class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},iU={class:'text-xs font-medium md:text-sm'};const cU=Za({name:'ToastNotification',props:{visible:{type:Boolean,default:!1},message:{type:String,default:''},type:{type:String,default:'info'},duration:{type:Number,default:2500},position:{type:String,default:'top'},closable:{type:Boolean,default:!1}},emits:['close','update:visible'],setup(e,{emit:t}){let a=null;const s=ir(()=>{switch(e.position){case'top':default:return'top-4 left-1/2 -translate-x-1/2 md:top-6';case'top-right':return'top-4 right-4 md:top-6 md:right-6';case'bottom':return'bottom-4 left-1/2 -translate-x-1/2 md:bottom-6';case'bottom-right':return'bottom-4 right-4 md:bottom-6 md:right-6';case'center':return'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2'}}),n=ir(()=>{switch(e.type){case'success':return'bg-green-900/90 border-green-600/50 text-green-300';case'error':return'bg-red-900/90 border-red-600/50 text-red-300';case'warning':return'bg-amber-900/90 border-amber-600/50 text-amber-300';default:return'bg-blue-900/90 border-blue-600/50 text-blue-300'}}),r=()=>{t('update:visible',!1),t('close')},l=()=>{e.duration>0&&(a=setTimeout(()=>{r()},e.duration))},o=()=>{a&&(clearTimeout(a),a=null)};return _a(()=>e.visible,e=>{e?(o(),l()):o()}),us(()=>{e.visible&&l()}),gs(()=>{o()}),{positionClass:s,typeClass:n,close:r}}}),dU=(0,$u.A)(cU,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'toast'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:ee(['fixed z-9999 flex items-center justify-center',e.positionClass])},[Mn('div',{class:ee(['flex items-center gap-2 rounded-lg border px-3 py-2 shadow-xl backdrop-blur-sm md:gap-3 md:px-4 md:py-3',e.typeClass])},[Rn(' 图标 '),Mn('div',lU,[Rn(' 成功图标 '),'success'===e.type?(yn(),Sn('svg',oU,[...t[1]||(t[1]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 13l4 4L19 7'},null,-1)])])):'error'===e.type?(yn(),Sn(pn,{key:1},[Rn(' 错误图标 '),t[2]||(t[2]=Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1))],2112)):'warning'===e.type?(yn(),Sn(pn,{key:2},[Rn(' 警告图标 '),t[3]||(t[3]=Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z'})],-1))],2112)):(yn(),Sn(pn,{key:3},[Rn(' 信息图标 '),t[4]||(t[4]=Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'})],-1))],2112))]),Rn(' 消息内容 '),Mn('span',iU,oe(e.message),1),Rn(' 关闭按钮（可选） '),e.closable?(yn(),Sn('button',{key:0,class:'ml-1 shrink-0 opacity-60 transition-opacity hover:opacity-100',onClick:t[0]||(t[0]=(...t)=>e.close&&e.close(...t))},[...t[5]||(t[5]=[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])):Rn('v-if',!0)],2)],2)):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-7ecd7fa3']]),uU={class:'flex h-full flex-col'},pU={class:'flex items-center justify-between border-b border-[#373a40] bg-[#36393f] px-2 py-1.5 md:px-4 md:py-3'},mU={class:'flex items-center space-x-1 md:space-x-2'},gU={class:'flex items-center space-x-1 md:space-x-2'},hU={class:'flex-1 overflow-y-auto p-2 md:p-4'},fU={key:0,class:'py-6 text-center text-[10px] text-gray-500 md:py-8 md:text-sm'},vU={key:1,class:'space-y-1.5 md:space-y-2'},yU=['onDragstart','onDrop'],bU={class:'flex items-start space-x-2 md:space-x-3'},xU=['checked','onChange'],wU={class:'min-w-0 flex-1'},kU={class:'flex items-center justify-between'},SU={class:'flex items-center space-x-1 md:space-x-2'},_U={class:'text-xs font-medium text-white md:text-sm'},CU={key:0,class:'rounded bg-[#40444b] px-1 py-0.5 text-[8px] text-gray-400 md:px-2 md:text-xs'},IU={class:'flex items-center space-x-0.5 opacity-100 transition-opacity md:space-x-1 md:opacity-0 md:group-hover:opacity-100'},TU=['onClick'],AU=['onClick'],MU={key:0,class:'mt-0.5 text-[8px] text-gray-500 md:mt-1 md:text-xs'},EU={class:'mt-1 line-clamp-2 text-[10px] text-gray-400 md:mt-2 md:text-sm'},$U={class:'mx-2 w-full max-w-xl rounded-lg border border-[#373a40] bg-[#2f3136] shadow-2xl'},DU={class:'flex items-center justify-between border-b border-[#373a40] px-3 py-2 md:px-6 md:py-4'},PU={class:'text-sm font-medium text-white md:text-lg'},NU={class:'space-y-2 p-3 md:space-y-4 md:p-6'},RU={class:'flex justify-end space-x-2 border-t border-[#373a40] px-3 py-2 md:space-x-3 md:px-6 md:py-4'},jU={class:'mx-2 flex h-[80vh] w-full max-w-2xl flex-col rounded-lg border border-[#373a40] bg-[#2f3136] shadow-2xl'},LU={class:'flex items-center justify-between border-b border-[#373a40] px-3 py-2 md:px-6 md:py-4'},BU={class:'flex-1 overflow-y-auto p-3 md:p-6'},OU={class:'rounded bg-[#36393f] p-2 text-[10px] whitespace-pre-wrap text-gray-300 md:p-4 md:text-sm'},qU={class:'flex items-center justify-between border-t border-[#373a40] px-3 py-2 md:px-6 md:py-4'},UU={class:'text-[10px] text-gray-500 md:text-sm'},VU={class:'mx-2 w-full max-w-xl rounded-lg border border-[#373a40] bg-[#2f3136] shadow-2xl'},FU={class:'flex items-center justify-between border-b border-[#373a40] px-3 py-2 md:px-6 md:py-4'},HU={class:'space-y-3 p-3 md:space-y-4 md:p-6'},GU={class:'border-t border-[#373a40] pt-3 md:pt-4'},zU={class:'mt-1.5 flex items-center space-x-2 md:mt-2 md:space-x-3'},WU={class:'flex items-center space-x-1 text-[10px] text-gray-400 md:space-x-2 md:text-sm'},QU={class:'border-t border-[#373a40] pt-3 md:pt-4'},XU={class:'mx-2 w-full max-w-lg rounded-lg border border-[#373a40] bg-[#2f3136] shadow-2xl'},YU={class:'flex items-center justify-between border-b border-[#373a40] px-3 py-2 md:px-6 md:py-4'},KU={class:'flex items-center text-sm font-medium text-white md:text-lg'},JU={class:'mr-2'},ZU={class:'space-y-3 p-3 md:space-y-4 md:p-6'},eV={class:'rounded border border-blue-500/30 bg-blue-500/10 p-2 md:p-3'},tV={class:'text-[9px] text-gray-400 md:text-xs'},aV={class:'rounded border border-[#373a40] bg-[#36393f] p-2 md:p-3'},sV={key:0,class:'flex items-center justify-between'},nV={class:'text-[10px] text-cyan-400 md:text-sm'},rV={key:1,class:'text-[10px] text-gray-500 md:text-sm'},lV={class:'rounded border border-[#373a40] bg-[#36393f] p-2 md:p-3'},oV={class:'text-[8px] text-gray-500 md:text-[10px]'},iV={class:'mt-2 flex gap-2'},cV={class:'mx-2 w-full max-w-lg rounded-lg border border-[#373a40] bg-[#2f3136] shadow-2xl'},dV={class:'flex items-center justify-between border-b border-[#373a40] px-3 py-2 md:px-6 md:py-4'},uV={class:'p-3 md:p-6'},pV={class:'mt-3 flex justify-end gap-2'};function mV(e){if(!e.prompts||!Array.isArray(e.prompts))throw new Error('Invalid preset format: missing prompts array');const t=e.prompts.filter(e=>!1!==e.enabled),a=t.filter(e=>0===e.injection_position),s=t.filter(e=>1===e.injection_position),n=[];for(const e of a)e.marker||e.content&&''!==e.content.trim()&&n.push({role:e.role,content:e.content});const r=s.filter(e=>!e.marker&&e.content&&''!==e.content.trim()).sort((e,t)=>e.injection_depth!==t.injection_depth?e.injection_depth-t.injection_depth:e.injection_order-t.injection_order),l=[...n];for(const e of r){const t=Math.max(0,l.length-e.injection_depth);l.splice(t,0,{role:e.role,content:e.content})}return l}function gV(e){return e.map(e=>e.content).join('\n\n')}function hV(e){if(e.name)return e.name;if(e.preset_name)return e.preset_name;const t=e.prompts?.find(e=>e.name&&''!==e.name.trim());return t?`预设 (${t.name})`:'未命名预设'}const fV=e=>`game_preset_${e}`,vV=Za({name:'PromptManager',props:{type:{type:String,required:!0}},setup(e){const{alert:t,confirm:a,success:s,warning:n}=Xp(),r=Pi(),l=$t([]),o=$t(!1),i=$t(!1),c=$t(!1),d=$t(null),u=$t(''),p=$t(!1),m=$t(null),g=$t(!1),h=$t(!1),f=$t(null),v=$t(''),y=()=>{l.value=r.getPrompts(e.type)},b=ir(()=>l.value.filter(e=>e.enabled).length),x=ir(()=>r.getMergedPromptText(e.type)),w=()=>{r.resetToDefault(e.type),y(),c.value=!1};return us(()=>{y(),(()=>{try{const t=fV(e.type),a=localStorage.getItem(t);if(a){const e=JSON.parse(a);f.value=e.name||'自定义预设'}else f.value=null}catch(e){console.error('Failed to load preset settings',e)}})()}),{prompts:l,showEditModal:o,showPreview:i,showImportExport:c,editingPrompt:d,importText:u,mergeImport:p,enabledCount:b,previewText:x,addNewPrompt:()=>{d.value={name:'',content:'',enabled:!0,category:'',description:''},o.value=!0},editPrompt:e=>{d.value={...e},o.value=!0},savePrompt:async()=>{d.value?.name&&d.value?.content?(d.value.id?r.updatePrompt(e.type,d.value.id,d.value):r.addPrompt(e.type,{name:d.value.name,content:d.value.content,enabled:d.value.enabled??!0,category:d.value.category,description:d.value.description}),y(),o.value=!1):await n('验证失败','请填写名称和内容')},deletePrompt:async t=>{await a('删除确认','确定要删除此提示词吗？',{variant:'danger'})&&(r.deletePrompt(e.type,t),y())},togglePrompt:t=>{r.togglePrompt(e.type,t),y()},handleDragStart:(e,t)=>{m.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed='move')},handleDrop:(t,a)=>{null!==m.value&&m.value!==a&&(r.reorderPrompts(e.type,m.value,a),y()),m.value=null},copyPreview:async()=>{try{await navigator.clipboard.writeText(x.value),await s('复制成功','已复制到剪贴板')}catch{await n('复制失败','无法访问剪贴板')}},exportConfig:()=>{const t=r.exportConfig(e.type),a=new Blob([t],{type:'application/json'}),s=URL.createObjectURL(a),n=document.createElement('a');n.href=s,n.download=`prompts_${e.type}_${Date.now()}.json`,n.click(),URL.revokeObjectURL(s)},importConfig:async()=>{u.value.trim()?r.importConfig(e.type,u.value,p.value)?(y(),u.value='',c.value=!1,await s('导入成功','配置已成功导入')):await n('导入失败','请检查配置格式是否正确'):await n('验证失败','请粘贴配置内容')},resetToDefault:w,confirmResetToDefault:async()=>{await a('恢复默认','确定要恢复为默认提示词吗？这将清除所有自定义的提示词，恢复为系统内置的默认配置。',{variant:'warning'})&&(w(),await s('操作成功','已恢复为默认提示词'))},showPresetSettings:g,showPasteModal:h,presetName:f,pasteJsonText:v,clearPreset:async()=>{const t='varMaintenance'===e.type?'工具AI预设':'酒馆预设';if(await a('清除预设',`确定要清除${t}吗？清除后将使用默认规则。`,{variant:'warning'}))try{const a=fV(e.type);localStorage.removeItem(a),f.value=null,await s('操作成功',`已清除${t}`)}catch(e){console.error('Failed to clear preset',e)}},importPreset:async()=>{const t=document.createElement('input');t.type='file',t.accept='.json',t.onchange=async t=>{const a=t.target.files?.[0];if(a)try{const t=await a.text(),r=JSON.parse(t);if(!r.prompts||!Array.isArray(r.prompts))return void await n('格式错误','无效的预设格式：缺少 prompts 数组');const l=mV(r),o=gV(l),i=hV(r),c={name:i,originalPreset:r,parsedText:o},d=fV(e.type);localStorage.setItem(d,JSON.stringify(c)),f.value=i,await s('导入成功',`已导入预设: ${i}\n解析了 ${l.length} 条提示词`)}catch(e){console.error('Failed to import preset',e),await n('导入失败',e instanceof Error?e.message:'未知错误')}},t.click()},pastePreset:()=>{v.value='',h.value=!0},confirmPastePreset:async()=>{if(v.value.trim())try{const t=JSON.parse(v.value);if(!t.prompts||!Array.isArray(t.prompts))return void await n('格式错误','无效的预设格式：缺少 prompts 数组');const a=mV(t),r=gV(a),l=hV(t),o={name:l,originalPreset:t,parsedText:r},i=fV(e.type);localStorage.setItem(i,JSON.stringify(o)),f.value=l,h.value=!1,v.value='',await s('导入成功',`已导入预设: ${l}\n解析了 ${a.length} 条提示词`)}catch(e){console.error('Failed to parse preset JSON',e),await n('JSON解析失败',e instanceof Error?e.message:'未知错误')}else await n('验证失败','请粘贴预设JSON内容')}}}}),yV=(0,$u.A)(vV,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',uU,[Rn(' Toolbar '),Mn('div',pU,[Mn('div',mU,[Mn('button',{class:'rounded bg-green-600 p-1.5 text-white hover:bg-green-500 md:p-2',title:'添加',onClick:t[0]||(t[0]=(...t)=>e.addNewPrompt&&e.addNewPrompt(...t))},[...t[34]||(t[34]=[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 4v16m8-8H4'})],-1)])]),Mn('button',{class:'rounded bg-blue-600 p-1.5 text-white hover:bg-blue-500 md:p-2',title:'预览',onClick:t[1]||(t[1]=t=>e.showPreview=!0)},[...t[35]||(t[35]=[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 12a3 3 0 11-6 0 3 3 0 016 0z'}),Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z'})],-1)])])]),Mn('div',gU,[Mn('button',{class:'rounded bg-amber-600/20 p-1.5 text-amber-400 hover:bg-amber-600/30 md:p-2',title:'恢复默认',onClick:t[2]||(t[2]=(...t)=>e.confirmResetToDefault&&e.confirmResetToDefault(...t))},[...t[36]||(t[36]=[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15'})],-1)])]),Mn('button',{class:'rounded bg-[#40444b] px-1.5 py-1 text-[10px] text-gray-300 hover:bg-[#4a4e54] md:px-3 md:py-1.5 md:text-sm',onClick:t[3]||(t[3]=t=>e.showImportExport=!0)},' 导入/导出 '),Rn(' 预设按钮：变量维护显示工具AI预设，正文优化显示酒馆预设 '),Mn('button',{class:ee(['rounded px-1.5 py-1 text-[10px] hover:bg-cyan-600/30 md:px-3 md:py-1.5 md:text-sm',e.presetName?'bg-cyan-600/20 text-cyan-400':'bg-[#40444b] text-gray-300 hover:bg-[#4a4e54]']),onClick:t[4]||(t[4]=t=>e.showPresetSettings=!0)},oe('varMaintenance'===e.type?'🤖':'📝')+' '+oe(e.presetName?e.presetName:'预设'),3)])]),Rn(' Prompt List '),Mn('div',hU,[0===e.prompts.length?(yn(),Sn('div',fU,' 暂无提示词条目，点击"添加"创建新条目 ')):(yn(),Sn('div',vU,[(yn(!0),Sn(pn,null,xs(e.prompts,(a,s)=>(yn(),Sn('div',{key:a.id,class:ee(['group rounded-lg border border-[#373a40] bg-[#36393f] p-2 transition-colors hover:border-amber-500/50 md:p-3',{'opacity-50':!a.enabled}]),draggable:'true',onDragstart:t=>e.handleDragStart(t,s),onDragover:t[5]||(t[5]=Cl(()=>{},['prevent'])),onDrop:t=>e.handleDrop(t,s)},[Mn('div',bU,[Rn(' Drag Handle '),t[39]||(t[39]=Mn('div',{class:'cursor-move pt-0.5 text-gray-500 hover:text-gray-300 md:pt-1'},[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 8h16M4 16h16'})])],-1)),Rn(' Checkbox '),Mn('input',{checked:a.enabled,type:'checkbox',class:'mt-0.5 h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 focus:ring-amber-500 md:mt-1 md:h-4 md:w-4',onChange:t=>e.togglePrompt(a.id)},null,40,xU),Rn(' Content '),Mn('div',wU,[Mn('div',kU,[Mn('div',SU,[Mn('span',_U,oe(a.name),1),a.category?(yn(),Sn('span',CU,oe(a.category),1)):Rn('v-if',!0)]),Mn('div',IU,[Mn('button',{class:'rounded p-0.5 text-gray-400 hover:bg-[#40444b] hover:text-white md:p-1',title:'编辑',onClick:t=>e.editPrompt(a)},[...t[37]||(t[37]=[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'})],-1)])],8,TU),Mn('button',{class:'rounded p-0.5 text-gray-400 hover:bg-red-500/20 hover:text-red-400 md:p-1',title:'删除',onClick:t=>e.deletePrompt(a.id)},[...t[38]||(t[38]=[Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1)])],8,AU)])]),a.description?(yn(),Sn('p',MU,oe(a.description),1)):Rn('v-if',!0),Mn('p',EU,oe(a.content),1)])])],42,yU))),128))]))]),Rn(' Edit Modal '),e.showEditModal?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-90 flex items-center justify-center bg-black/80',onClick:t[13]||(t[13]=Cl(t=>e.showEditModal=!1,['self']))},[Mn('div',$U,[Mn('div',DU,[Mn('h3',PU,oe(e.editingPrompt?.id?'编辑':'添加')+'提示词',1),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[6]||(t[6]=t=>e.showEditModal=!1)},[...t[40]||(t[40]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Mn('div',NU,[Mn('div',null,[t[41]||(t[41]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'名称',-1)),xa(Mn('input',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.editingPrompt.name=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'提示词名称'},null,512),[[fl,e.editingPrompt.name]])]),Mn('div',null,[t[42]||(t[42]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'分类',-1)),xa(Mn('input',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.editingPrompt.category=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'可选，用于分组'},null,512),[[fl,e.editingPrompt.category]])]),Mn('div',null,[t[43]||(t[43]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'描述',-1)),xa(Mn('input',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.editingPrompt.description=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'可选，简要说明此提示词的用途'},null,512),[[fl,e.editingPrompt.description]])]),Mn('div',null,[t[44]||(t[44]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'内容',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[10]||(t[10]=t=>e.editingPrompt.content=t),rows:'4',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'提示词内容'},null,512),[[fl,e.editingPrompt.content]])])]),Mn('div',RU,[Mn('button',{class:'rounded bg-[#40444b] px-2 py-1.5 text-xs text-gray-300 hover:bg-[#4a4e54] md:px-4 md:py-2 md:text-sm',onClick:t[11]||(t[11]=t=>e.showEditModal=!1)},' 取消 '),Mn('button',{class:'rounded bg-amber-600 px-2 py-1.5 text-xs text-white hover:bg-amber-500 md:px-4 md:py-2 md:text-sm',onClick:t[12]||(t[12]=(...t)=>e.savePrompt&&e.savePrompt(...t))},' 保存 ')])])])):Rn('v-if',!0),Rn(' Preview Modal '),e.showPreview?(yn(),Sn('div',{key:1,class:'fixed inset-0 z-90 flex items-center justify-center bg-black/80',onClick:t[16]||(t[16]=Cl(t=>e.showPreview=!1,['self']))},[Mn('div',jU,[Mn('div',LU,[t[46]||(t[46]=Mn('h3',{class:'text-sm font-medium text-white md:text-lg'},'预览合并后的提示词',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[14]||(t[14]=t=>e.showPreview=!1)},[...t[45]||(t[45]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Mn('div',BU,[Mn('pre',OU,oe(e.previewText),1)]),Mn('div',qU,[Mn('div',UU,'已启用 '+oe(e.enabledCount)+' / '+oe(e.prompts.length)+' 条',1),Mn('button',{class:'rounded bg-blue-600 px-2 py-1 text-[10px] text-white hover:bg-blue-500 md:px-4 md:py-2 md:text-sm',onClick:t[15]||(t[15]=(...t)=>e.copyPreview&&e.copyPreview(...t))},' 复制到剪贴板 ')])])])):Rn('v-if',!0),Rn(' Import/Export Modal '),e.showImportExport?(yn(),Sn('div',{key:2,class:'fixed inset-0 z-90 flex items-center justify-center bg-black/80',onClick:t[23]||(t[23]=Cl(t=>e.showImportExport=!1,['self']))},[Mn('div',VU,[Mn('div',FU,[t[48]||(t[48]=Mn('h3',{class:'text-sm font-medium text-white md:text-lg'},'导入/导出',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[17]||(t[17]=t=>e.showImportExport=!1)},[...t[47]||(t[47]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Mn('div',HU,[Mn('div',null,[t[49]||(t[49]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:mb-2 md:text-sm'},'导出当前配置',-1)),Mn('button',{class:'w-full rounded bg-blue-600 px-2 py-1.5 text-[10px] text-white hover:bg-blue-500 md:px-4 md:py-2 md:text-sm',onClick:t[18]||(t[18]=(...t)=>e.exportConfig&&e.exportConfig(...t))},' 导出为 JSON ')]),Mn('div',GU,[t[51]||(t[51]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:mb-2 md:text-sm'},'导入配置',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[19]||(t[19]=t=>e.importText=t),rows:'4',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-[10px] text-white focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'粘贴 JSON 配置...'},null,512),[[fl,e.importText]]),Mn('div',zU,[Mn('label',WU,[xa(Mn('input',{'onUpdate:modelValue':t[20]||(t[20]=t=>e.mergeImport=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] md:h-4 md:w-4'},null,512),[[vl,e.mergeImport]]),t[50]||(t[50]=Mn('span',null,'合并而非替换',-1))])]),Mn('button',{class:'mt-2 w-full rounded bg-green-600 px-2 py-1.5 text-[10px] text-white hover:bg-green-500 md:mt-3 md:px-4 md:py-2 md:text-sm',onClick:t[21]||(t[21]=(...t)=>e.importConfig&&e.importConfig(...t))},' 导入 ')]),Mn('div',QU,[Mn('button',{class:'w-full rounded bg-red-600/20 px-2 py-1.5 text-[10px] text-red-400 hover:bg-red-600/30 md:px-4 md:py-2 md:text-sm',onClick:t[22]||(t[22]=(...t)=>e.resetToDefault&&e.resetToDefault(...t))},' 重置为默认 ')])])])])):Rn('v-if',!0),Rn(' Preset Settings Modal '),e.showPresetSettings?(yn(),Sn('div',{key:3,class:'fixed inset-0 z-90 flex items-center justify-center bg-black/80',onClick:t[28]||(t[28]=Cl(t=>e.showPresetSettings=!1,['self']))},[Mn('div',XU,[Mn('div',YU,[Mn('h3',KU,[Mn('span',JU,oe('varMaintenance'===e.type?'🤖':'📝'),1),Pn(' '+oe('varMaintenance'===e.type?'工具AI配置':'正文优化配置'),1)]),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[24]||(t[24]=t=>e.showPresetSettings=!1)},[...t[52]||(t[52]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Mn('div',ZU,[Rn(' Info '),Mn('div',eV,[Mn('p',tV,oe('varMaintenance'===e.type?'工具AI用于解析剧情AI的输出，生成结构化的游戏数据（场景、状态变化、商店、敌人等）。':'正文优化AI用于润色和优化剧情AI生成的文本内容。')+' 你可以导入酒馆格式的预设JSON来自定义系统提示词。 ',1)]),Rn(' Current Preset Status '),Mn('div',aV,[t[53]||(t[53]=Mn('div',{class:'mb-2 text-[10px] font-medium text-white md:text-sm'},'当前预设',-1)),e.presetName?(yn(),Sn('div',sV,[Mn('span',nV,oe(e.presetName),1),Mn('button',{class:'rounded bg-red-600/20 px-2 py-0.5 text-[9px] text-red-400 hover:bg-red-600/30 md:text-[10px]',onClick:t[25]||(t[25]=(...t)=>e.clearPreset&&e.clearPreset(...t))},' 清除 ')])):(yn(),Sn('div',rV,' 未导入预设，将使用上方的规则列表作为系统提示词 '))]),Rn(' Import Preset '),Mn('div',lV,[t[54]||(t[54]=Mn('div',{class:'mb-2 text-[10px] font-medium text-white md:text-sm'},'导入酒馆预设',-1)),Mn('div',oV,' 支持酒馆格式的预设JSON文件，导入后将替换'+oe('varMaintenance'===e.type?'工具AI':'正文优化AI')+'的系统提示词 ',1),Mn('div',iV,[Mn('button',{class:'flex-1 rounded bg-cyan-600 px-2 py-1.5 text-[10px] text-white hover:bg-cyan-500 md:py-2 md:text-sm',onClick:t[26]||(t[26]=(...t)=>e.importPreset&&e.importPreset(...t))},' 选择文件导入 '),Mn('button',{class:'rounded bg-[#40444b] px-2 py-1.5 text-[10px] text-gray-300 hover:bg-[#4a4e54] md:py-2 md:text-sm',onClick:t[27]||(t[27]=(...t)=>e.pastePreset&&e.pastePreset(...t))},' 粘贴JSON ')])])])])])):Rn('v-if',!0),Rn(' Paste JSON Modal '),e.showPasteModal?(yn(),Sn('div',{key:4,class:'fixed inset-0 z-95 flex items-center justify-center bg-black/80',onClick:t[33]||(t[33]=Cl(t=>e.showPasteModal=!1,['self']))},[Mn('div',cV,[Mn('div',dV,[t[56]||(t[56]=Mn('h3',{class:'text-sm font-medium text-white md:text-lg'},'粘贴预设JSON',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[29]||(t[29]=t=>e.showPasteModal=!1)},[...t[55]||(t[55]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Mn('div',uV,[xa(Mn('textarea',{'onUpdate:modelValue':t[30]||(t[30]=t=>e.pasteJsonText=t),rows:'8',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-[10px] text-white placeholder-gray-500 focus:border-cyan-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'粘贴酒馆预设JSON内容...'},null,512),[[fl,e.pasteJsonText]]),Mn('div',pV,[Mn('button',{class:'rounded bg-[#40444b] px-3 py-1.5 text-[10px] text-gray-300 hover:bg-[#4a4e54] md:text-sm',onClick:t[31]||(t[31]=t=>e.showPasteModal=!1)},' 取消 '),Mn('button',{class:'rounded bg-cyan-600 px-3 py-1.5 text-[10px] text-white hover:bg-cyan-500 md:text-sm',onClick:t[32]||(t[32]=(...t)=>e.confirmPastePreset&&e.confirmPastePreset(...t))},' 确认导入 ')])])])])):Rn('v-if',!0)])}]]),bV={class:'flex h-full flex-col'},xV={class:'flex border-b border-[#373a40] bg-[#2f3136]'},wV=['onClick'],kV={key:0,class:'flex-1 overflow-y-auto p-2 md:p-4'},SV={class:'mb-3 rounded border border-[#373a40] bg-[#36393f] p-2 md:mb-4 md:p-3'},_V={class:'mb-1.5 flex items-center justify-between md:mb-2'},CV={class:'flex items-center gap-1'},IV={class:'flex gap-2'},TV={class:'mt-1.5 text-[8px] text-gray-500 md:mt-2 md:text-[10px]'},AV={key:0},MV={key:1},EV={class:'mb-2 md:mb-4'},$V=['placeholder'],DV={key:0,class:'mt-0.5 text-[10px] text-red-400 md:mt-1 md:text-xs'},PV={key:1,class:'mt-0.5 text-[8px] text-green-400/70 md:mt-1 md:text-[10px]'},NV={class:'mb-2 md:mb-4'},RV={class:'mt-0.5 text-[8px] text-gray-500 md:mt-1 md:text-xs'},jV=['textContent'],LV={class:'mb-2 grid grid-cols-2 gap-2 md:mb-4 md:gap-4'},BV={class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},OV={key:0,class:'ml-1 text-[8px] text-amber-400'},qV={class:'flex flex-wrap gap-1 md:space-x-2'},UV=['checked','disabled','onChange'],VV=['title'],FV={class:'flex items-center space-x-1 md:space-x-2'},HV={class:'mb-2 md:mb-4'},GV={key:0,class:'mb-2 md:mb-4'},zV={class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},WV={class:'text-amber-400'},QV={class:'max-h-24 overflow-y-auto rounded border border-[#373a40] bg-[#202225] p-2 text-[10px] text-gray-300 md:max-h-32 md:p-3 md:text-sm'},XV={class:'whitespace-pre-wrap'},YV={class:'flex flex-wrap gap-1 md:space-x-2'},KV={key:1,class:'flex flex-1 flex-col overflow-hidden'},JV={class:'flex-1 overflow-y-auto p-2 md:p-4'},ZV=['onClick'],eF={class:'flex items-center space-x-2 md:space-x-3'},tF=['checked','onClick'],aF={class:'text-xs font-medium text-white md:text-sm'},sF={class:'text-[8px] text-gray-500 md:text-xs'},nF={class:'flex items-center space-x-1 md:space-x-2'},rF=['onClick'],lF=['onClick'],oF={class:'text-[10px] text-gray-400 md:text-sm'},iF={key:0,class:'space-y-1.5 p-2 md:space-y-2 md:p-3'},cF={class:'mb-1 flex items-center justify-between md:mb-2'},dF={class:'flex items-center space-x-1 md:space-x-2'},uF=['checked','onChange'],pF={class:'text-[10px] text-white md:text-sm'},mF={class:'flex items-center space-x-1 md:space-x-2'},gF=['onClick'],hF=['onClick'],fF={class:'text-[8px] text-gray-500 md:text-xs'},vF={class:'font-mono text-amber-400'},yF={class:'font-mono text-green-400'},bF={class:'mt-0.5 flex items-center gap-2 text-[8px] text-gray-600 md:mt-1 md:text-xs'},xF={key:0,class:'py-3 text-center text-[10px] text-gray-500 md:py-4 md:text-sm'},wF={key:2,class:'flex-1 overflow-y-auto p-2 md:p-4'},kF={class:'mb-4 md:mb-6'},SF={class:'mb-4 md:mb-6'},_F={class:'mb-1.5 flex flex-wrap gap-1.5 md:mb-2 md:gap-2'},CF=['checked','onChange'],IF={class:'text-gray-300'},TF={key:0,class:'mb-4 md:mb-6'},AF=['value'],MF={class:'mx-2 w-full max-w-md rounded-lg border border-[#373a40] bg-[#2f3136] p-3 shadow-xl md:p-6'},EF={class:'mb-2 text-sm font-bold text-white md:mb-4 md:text-lg'},$F={class:'space-y-2 md:space-y-4'},DF={key:0,class:'mt-0.5 text-[10px] text-red-400'},PF={key:1,class:'mt-0.5 text-[8px] text-green-400/70'},NF=['placeholder'],RF={class:'mt-0.5 text-[8px] text-gray-500 md:text-xs'},jF=['textContent'],LF={class:'flex gap-2'},BF={class:'mt-0.5 text-[8px] text-gray-500 md:text-xs'},OF={key:0},qF={key:1},UF={key:0,class:'opacity-60'},VF={class:'grid grid-cols-2 gap-2 md:gap-4'},FF={class:'mt-3 flex space-x-2 md:mt-6 md:space-x-3'};const HF=Za({name:'RegexTool',components:{ToastNotification:dU},emits:['apply'],setup(e,{emit:t}){const a=xt({visible:!1,message:'',type:'info'}),s=(e,t='success')=>{a.message=e,a.type=t,a.visible=!0},n=$t(null),r=$t(null),l=$t('quick'),o=$t('permanent'),i=$t(!0),c=$t(''),d=$t(''),u=$t(''),p=$t(0),m=$t(-1),g=$t(''),h=$t(''),f=$t(null),v=$t([]),y=$t([]),b=$t(!1),x=$t(''),w=xt({id:'',name:'',pattern:'',replacement:'',flags:'g',regex:'',minDepth:0,maxDepth:-1,enabled:!0,order:0}),k=$t(''),S=$t(null),C=$t(''),I=$t(''),T=$t(!1),A=$t([]),M=$t(''),E=ir(()=>n.value&&c.value?n.value.parseRegexLiteral(c.value):null),D=ir(()=>null!==E.value),P=ir(()=>E.value?E.value.flags:u.value),N=()=>{if(n.value){v.value=n.value.getRuleSets();const e=n.value.getConfig();o.value=e.applyMode,i.value=e.enabled}},R=()=>{if(!n.value||!c.value)return void(g.value='');const{pattern:e,flags:t}=n.value.getPatternAndFlags(c.value,u.value),a=n.value.validatePattern(e,t);g.value=a.error||''},j=()=>{if(!n.value||!w.regex)return k.value='',void(S.value=null);const e=n.value.parseRegexLiteral(w.regex);if(e){const t=n.value.validatePattern(e.pattern,e.flags);t.valid?(S.value=e,k.value=''):(S.value=null,k.value=t.error||'无效的正则表达式')}else{const e=n.value.validatePattern(w.regex,w.flags||'g');e.valid?(S.value={pattern:w.regex,flags:w.flags||'g'},k.value=''):(S.value=null,k.value=e.error||'无效的正则表达式')}};us(()=>{try{n.value=Ll.serviceLocator.get('RegexService'),r.value=Ll.serviceLocator.get('EventBus'),N(),r.value?.on('regex:rules_updated',N)}catch(e){console.error('RegexTool: Service not available',e)}});return{toast:a,tabs:[{id:'quick',label:'快速应用'},{id:'rules',label:'规则管理'},{id:'import',label:'导入/导出'}],activeTab:l,applyMode:o,regexEnabled:i,quickPattern:c,quickReplacement:d,quickFlags:u,quickMinDepth:p,quickMaxDepth:m,quickPatternError:g,previewText:h,previewResult:f,flagOptions:[{value:'g',label:'g',desc:'全局匹配'},{value:'i',label:'i',desc:'忽略大小写'},{value:'m',label:'m',desc:'多行模式'},{value:'s',label:'s',desc:'点号匹配换行'}],ruleSets:v,expandedSets:y,showEditDialog:b,editingRule:w,editingRegexError:k,editingRegexParsed:S,importJson:C,importMessage:I,importSuccess:T,exportSelection:A,exportJson:M,parsedRegexInfo:E,isFullRegexFormat:D,effectiveFlags:P,validateQuickPattern:R,toggleFlag:e=>{D.value||(u.value.includes(e)?u.value=u.value.replace(e,''):u.value+=e,R())},toggleEnabled:()=>{n.value&&(i.value=!i.value,n.value.setEnabled(i.value))},setApplyMode:e=>{o.value=e,n.value&&n.value.setApplyMode(e)},previewQuick:()=>{if(!n.value||!c.value)return;const{pattern:e,flags:t}=n.value.getPatternAndFlags(c.value,u.value);f.value=n.value.previewRule(h.value,e,d.value,t)},applyToMessages:()=>{const{pattern:e,flags:a}=n.value?.getPatternAndFlags(c.value,u.value)||{pattern:c.value,flags:u.value};t('apply',{pattern:e,replacement:d.value,flags:a,minDepth:p.value,maxDepth:m.value,mode:o.value})},saveAsRule:()=>{if(!n.value||!c.value)return;const e=v.value.find(e=>'default'===e.id)||v.value[0];if(!e)return void s('请先创建规则集','warning');const t=n.value.toRegexLiteral(c.value,D.value?'':u.value);n.value.addRule(e.id,{name:`规则 ${(new Date).toLocaleTimeString()}`,pattern:'',replacement:d.value,flags:'',regex:t,minDepth:p.value,maxDepth:m.value,enabled:!0,mode:o.value}),N(),s('规则已保存','success')},toggleRuleSetExpand:e=>{const t=y.value.indexOf(e);-1===t?y.value.push(e):y.value.splice(t,1)},toggleRuleSetEnabled:e=>{n.value?.toggleRuleSet(e),N()},toggleRuleEnabled:(e,t)=>{n.value?.toggleRule(e,t),N()},addNewRuleSet:()=>{const e=prompt('规则集名称:');e&&n.value&&(n.value.addRuleSet(e),N())},deleteRuleSet:e=>{confirm('确定删除此规则集？')&&(n.value?.removeRuleSet(e),N())},addNewRule:e=>{x.value=e,Object.assign(w,{id:'',name:'',pattern:'',replacement:'',flags:'',regex:'',minDepth:0,maxDepth:-1,enabled:!0,order:0,mode:o.value}),k.value='',S.value=null,b.value=!0},editRule:(e,t)=>{x.value=e;const a=t.regex||n.value?.toRegexLiteral(t.pattern,t.flags)||'';Object.assign(w,{...t,regex:a}),j(),b.value=!0},deleteRule:(e,t)=>{n.value?.removeRule(e,t),N(),s('规则已删除','success')},onEditingRegexChange:j,saveEditingRule:()=>{if(!n.value||!x.value)return;let e=w.regex||'';!e&&w.pattern&&(e=n.value.toRegexLiteral(w.pattern,w.flags||'g')),w.id?n.value.updateRule(x.value,w.id,{...w,regex:e}):n.value.addRule(x.value,{name:w.name||'未命名规则',pattern:w.pattern||'',replacement:w.replacement||'',flags:w.flags||'g',regex:e,minDepth:w.minDepth??0,maxDepth:w.maxDepth??-1,enabled:w.enabled??!0}),N(),b.value=!1},getDisplayRegex:e=>e.regex?e.regex:n.value?.toRegexLiteral(e.pattern,e.flags)||e.pattern,toggleExportSelection:e=>{const t=A.value.indexOf(e);-1===t?A.value.push(e):A.value.splice(t,1)},importRules:()=>{if(!n.value||!C.value)return;const e=n.value.importRules(C.value);I.value=e.message,T.value=e.success,e.success&&(N(),C.value='')},exportRules:()=>{n.value&&(M.value=n.value.exportRules(A.value.length>0?A.value:void 0))},copyExport:async()=>{try{await navigator.clipboard.writeText(M.value),s('已复制到剪贴板','success')}catch(e){console.error('Copy failed',e),s('复制失败','error')}},macroHelpText:'{{random:选项1::选项2}}',macroPlaceholder:'支持宏: {{random:A::B}}'}}}),GF=Za({name:'SystemSettings',components:{RegexTool:(0,$u.A)(HF,[['render',function(e,t,a,s,n,r){const l=fs('ToastNotification');return yn(),Sn('div',bV,[Rn(' Toast通知 '),En(l,{visible:e.toast.visible,'onUpdate:visible':t[0]||(t[0]=t=>e.toast.visible=t),message:e.toast.message,type:e.toast.type,duration:2500,position:'top'},null,8,['visible','message','type']),Rn(' Tab Navigation '),Mn('div',xV,[(yn(!0),Sn(pn,null,xs(e.tabs,t=>(yn(),Sn('button',{key:t.id,class:ee(['flex-1 px-2 py-1.5 text-[10px] transition-colors md:px-4 md:py-2 md:text-sm',e.activeTab===t.id?'bg-[#40444b] text-white':'text-gray-400 hover:text-white']),onClick:a=>e.activeTab=t.id},oe(t.label),11,wV))),128))]),Rn(' Quick Apply Tab '),'quick'===e.activeTab?(yn(),Sn('div',kV,[Rn(' 模式选择 '),Mn('div',SV,[Mn('div',_V,[t[30]||(t[30]=Mn('label',{class:'text-[10px] font-medium text-gray-300 md:text-xs'},'替换模式',-1)),Mn('div',CV,[Mn('span',{class:ee(['text-[8px] md:text-[10px]',e.regexEnabled?'text-green-400':'text-gray-500'])},oe(e.regexEnabled?'已启用':'已禁用'),3),Mn('button',{class:ee(['rounded px-1.5 py-0.5 text-[8px] md:px-2 md:text-[10px]',e.regexEnabled?'bg-green-600 text-white':'bg-gray-600 text-gray-300']),onClick:t[1]||(t[1]=(...t)=>e.toggleEnabled&&e.toggleEnabled(...t))},oe(e.regexEnabled?'ON':'OFF'),3)])]),Mn('div',IV,[Mn('button',{class:ee(['flex-1 rounded px-2 py-1.5 text-[10px] transition-colors md:px-3 md:py-2 md:text-xs','permanent'===e.applyMode?'bg-amber-600 text-white':'bg-[#40444b] text-gray-300 hover:bg-[#4a4e54]']),onClick:t[2]||(t[2]=t=>e.setApplyMode('permanent'))},' 📝 永久替换 ',2),Mn('button',{class:ee(['flex-1 rounded px-2 py-1.5 text-[10px] transition-colors md:px-3 md:py-2 md:text-xs','render'===e.applyMode?'bg-blue-600 text-white':'bg-[#40444b] text-gray-300 hover:bg-[#4a4e54]']),onClick:t[3]||(t[3]=t=>e.setApplyMode('render'))},' 👁️ 渲染替换 ',2)]),Mn('p',TV,['permanent'===e.applyMode?(yn(),Sn('span',AV,[...t[31]||(t[31]=[Pn(' 永久替换：修改原始消息内容并保存，',-1),Mn('span',{class:'text-amber-400'},'不可逆',-1)])])):(yn(),Sn('span',MV,[...t[32]||(t[32]=[Pn(' 渲染替换：仅在显示时替换，原始数据不变，',-1),Mn('span',{class:'text-blue-400'},'可随时开关',-1)])]))])]),Rn(' 正则输入 - 支持完整写法 '),Mn('div',EV,[t[33]||(t[33]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},[Pn(' 查找 (正则表达式) '),Mn('span',{class:'ml-1 text-[8px] text-gray-500 md:text-[10px]'},'支持 /pattern/flags 格式')],-1)),xa(Mn('input',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.quickPattern=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 font-mono text-xs text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:e.isFullRegexFormat?'例如: /\\[.*?\\]/g':'例如: \\[.*?\\]',onInput:t[5]||(t[5]=(...t)=>e.validateQuickPattern&&e.validateQuickPattern(...t))},null,40,$V),[[fl,e.quickPattern]]),e.quickPatternError?(yn(),Sn('p',DV,oe(e.quickPatternError),1)):e.parsedRegexInfo?(yn(),Sn('p',PV,' ✓ 已解析: pattern='+oe(e.parsedRegexInfo.pattern.slice(0,20))+oe(e.parsedRegexInfo.pattern.length>20?'...':'')+', flags='+oe(e.parsedRegexInfo.flags||'(无)'),1)):Rn('v-if',!0)]),Mn('div',NV,[t[36]||(t[36]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'替换为',-1)),xa(Mn('input',{'onUpdate:modelValue':t[6]||(t[6]=t=>e.quickReplacement=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 font-mono text-xs text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'支持 $1, $2 等捕获组和宏'},null,512),[[fl,e.quickReplacement]]),Mn('p',RV,[t[34]||(t[34]=Pn(' 支持宏: ',-1)),Mn('code',{class:'rounded bg-[#202225] px-1 text-amber-400',textContent:oe(e.macroHelpText)},null,8,jV),t[35]||(t[35]=Pn(' 随机选择 ',-1))])]),Mn('div',LV,[Rn(' 标志选择（仅在非完整格式时显示） '),Mn('div',{class:ee({'opacity-50':e.isFullRegexFormat})},[Mn('label',BV,[t[37]||(t[37]=Pn(' 标志 ',-1)),e.isFullRegexFormat?(yn(),Sn('span',OV,'(已从正则中解析)')):Rn('v-if',!0)]),Mn('div',qV,[(yn(!0),Sn(pn,null,xs(e.flagOptions,t=>(yn(),Sn('label',{key:t.value,class:ee(['flex items-center space-x-0.5 text-[10px] md:space-x-1 md:text-sm',{'pointer-events-none':e.isFullRegexFormat}])},[Mn('input',{type:'checkbox',checked:e.effectiveFlags.includes(t.value),disabled:e.isFullRegexFormat,class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 focus:ring-amber-500 disabled:opacity-50 md:h-4 md:w-4',onChange:a=>e.toggleFlag(t.value)},null,40,UV),Mn('span',{class:'text-gray-300',title:t.desc},oe(t.label),9,VV)],2))),128))])],2),Mn('div',null,[t[39]||(t[39]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'深度范围',-1)),Mn('div',FV,[xa(Mn('input',{'onUpdate:modelValue':t[7]||(t[7]=t=>e.quickMinDepth=t),type:'number',min:'0',class:'w-10 rounded border border-[#373a40] bg-[#40444b] px-1 py-0.5 text-center text-[10px] text-white md:w-16 md:px-2 md:py-1 md:text-sm'},null,512),[[fl,e.quickMinDepth,void 0,{number:!0}]]),t[38]||(t[38]=Mn('span',{class:'text-[10px] text-gray-400 md:text-sm'},'-',-1)),xa(Mn('input',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.quickMaxDepth=t),type:'number',min:'-1',class:'w-10 rounded border border-[#373a40] bg-[#40444b] px-1 py-0.5 text-center text-[10px] text-white md:w-16 md:px-2 md:py-1 md:text-sm',title:'-1 表示无限制'},null,512),[[fl,e.quickMaxDepth,void 0,{number:!0}]])]),t[40]||(t[40]=Mn('p',{class:'mt-0.5 text-[8px] text-gray-500 md:mt-1 md:text-xs'},'0=最新, -1=无限制',-1))])]),Rn(' Preview Section '),Mn('div',HV,[t[41]||(t[41]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'预览文本',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.previewText=t),rows:'2',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'输入或粘贴文本来预览效果...'},null,512),[[fl,e.previewText]])]),e.previewResult?(yn(),Sn('div',GV,[Mn('label',zV,[t[42]||(t[42]=Pn(' 预览结果 ',-1)),Mn('span',WV,'(匹配 '+oe(e.previewResult.matchCount)+' 处)',1)]),Mn('div',QV,[Mn('pre',XV,oe(e.previewResult.modifiedText),1)])])):Rn('v-if',!0),Mn('div',YV,[Mn('button',{class:'flex-1 rounded bg-amber-600 px-2 py-1.5 text-[10px] text-white transition-colors hover:bg-amber-500 md:px-4 md:py-2 md:text-sm',onClick:t[10]||(t[10]=(...t)=>e.previewQuick&&e.previewQuick(...t))},' 预览效果 '),Mn('button',{class:'flex-1 rounded bg-green-600 px-2 py-1.5 text-[10px] text-white transition-colors hover:bg-green-500 md:px-4 md:py-2 md:text-sm',onClick:t[11]||(t[11]=(...t)=>e.applyToMessages&&e.applyToMessages(...t))},' 应用到消息 '),Mn('button',{class:'rounded bg-blue-600 px-2 py-1.5 text-[10px] text-white transition-colors hover:bg-blue-500 md:px-4 md:py-2 md:text-sm',onClick:t[12]||(t[12]=(...t)=>e.saveAsRule&&e.saveAsRule(...t))},' 保存为规则 ')])])):Rn('v-if',!0),Rn(' Rules Manager Tab '),'rules'===e.activeTab?(yn(),Sn('div',KV,[Rn(' Rule Sets List '),Mn('div',JV,[(yn(!0),Sn(pn,null,xs(e.ruleSets,a=>(yn(),Sn('div',{key:a.id,class:'mb-2 rounded border border-[#373a40] bg-[#36393f] md:mb-4'},[Rn(' Rule Set Header '),Mn('div',{class:'flex cursor-pointer items-center justify-between border-b border-[#373a40] px-2 py-2 md:px-4 md:py-3',onClick:t=>e.toggleRuleSetExpand(a.id)},[Mn('div',eF,[Mn('input',{type:'checkbox',checked:a.enabled,class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 md:h-4 md:w-4',onClick:Cl(t=>e.toggleRuleSetEnabled(a.id),['stop'])},null,8,tF),Mn('span',aF,oe(a.name),1),Mn('span',sF,'('+oe(a.rules.length)+' 条)',1)]),Mn('div',nF,[Mn('button',{class:'text-gray-400 hover:text-blue-400',title:'添加规则',onClick:Cl(t=>e.addNewRule(a.id),['stop'])},[...t[43]||(t[43]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 4v16m8-8H4'})],-1)])],8,rF),Mn('button',{class:'text-gray-400 hover:text-red-400',title:'删除规则集',onClick:Cl(t=>e.deleteRuleSet(a.id),['stop'])},[...t[44]||(t[44]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1)])],8,lF),Mn('span',oF,oe(e.expandedSets.includes(a.id)?'▼':'▶'),1)])],8,ZV),Rn(' Rules List (Collapsible) '),e.expandedSets.includes(a.id)?(yn(),Sn('div',iF,[(yn(!0),Sn(pn,null,xs(a.rules,s=>(yn(),Sn('div',{key:s.id,class:'rounded border border-[#40444b] bg-[#2f3136] p-2 md:p-3'},[Mn('div',cF,[Mn('div',dF,[Mn('input',{type:'checkbox',checked:s.enabled,class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-green-500 md:h-4 md:w-4',onChange:t=>e.toggleRuleEnabled(a.id,s.id)},null,40,uF),Mn('span',pF,oe(s.name),1)]),Mn('div',mF,[Mn('button',{class:'text-[10px] text-gray-400 hover:text-blue-400 md:text-xs',onClick:t=>e.editRule(a.id,s)},' 编辑 ',8,gF),Mn('button',{class:'text-[10px] text-gray-400 hover:text-red-400 md:text-xs',onClick:t=>e.deleteRule(a.id,s.id)},' 删除 ',8,hF)])]),Mn('div',fF,[Mn('span',vF,oe(e.getDisplayRegex(s)),1),t[45]||(t[45]=Pn(' → ',-1)),Mn('span',yF,oe(s.replacement||'(空)'),1)]),Mn('div',bF,[Mn('span',null,'深度: '+oe(s.minDepth)+' - '+oe(-1===s.maxDepth?'∞':s.maxDepth),1),Mn('span',{class:ee(['rounded px-1 py-0.5 text-[8px]','permanent'===s.mode?'bg-amber-600/30 text-amber-400':'bg-blue-600/30 text-blue-400'])},oe('permanent'===s.mode?'📝永久':'👁️渲染'),3)])]))),128)),0===a.rules.length?(yn(),Sn('div',xF,' 暂无规则，点击 + 添加 ')):Rn('v-if',!0)])):Rn('v-if',!0)]))),128)),Mn('button',{class:'w-full rounded border border-dashed border-[#40444b] py-2 text-[10px] text-gray-400 transition-colors hover:border-amber-500 hover:text-amber-500 md:py-3 md:text-sm',onClick:t[13]||(t[13]=(...t)=>e.addNewRuleSet&&e.addNewRuleSet(...t))},' + 添加规则集 ')])])):Rn('v-if',!0),Rn(' Import/Export Tab '),'import'===e.activeTab?(yn(),Sn('div',wF,[Mn('div',kF,[t[46]||(t[46]=Mn('h3',{class:'mb-2 text-xs font-medium text-white md:mb-3 md:text-sm'},'导入规则',-1)),xa(Mn('textarea',{'onUpdate:modelValue':t[14]||(t[14]=t=>e.importJson=t),rows:'4',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 font-mono text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'粘贴 JSON 格式的规则集...'},null,512),[[fl,e.importJson]]),t[47]||(t[47]=Mn('p',{class:'mt-1 text-[8px] text-gray-500 md:text-[10px]'},' 支持旧格式 (pattern+flags 分离) 和新格式 (/pattern/flags 完整写法) ',-1)),Mn('button',{class:'mt-1.5 w-full rounded bg-blue-600 px-2 py-1.5 text-[10px] text-white transition-colors hover:bg-blue-500 md:mt-2 md:px-4 md:py-2 md:text-sm',onClick:t[15]||(t[15]=(...t)=>e.importRules&&e.importRules(...t))},' 导入 '),e.importMessage?(yn(),Sn('p',{key:0,class:ee(['mt-1 text-[10px] md:mt-2 md:text-sm',e.importSuccess?'text-green-400':'text-red-400'])},oe(e.importMessage),3)):Rn('v-if',!0)]),Mn('div',SF,[t[48]||(t[48]=Mn('h3',{class:'mb-2 text-xs font-medium text-white md:mb-3 md:text-sm'},'导出规则',-1)),Mn('div',_F,[(yn(!0),Sn(pn,null,xs(e.ruleSets,t=>(yn(),Sn('label',{key:t.id,class:'flex items-center space-x-1 text-[10px] md:space-x-2 md:text-sm'},[Mn('input',{type:'checkbox',checked:e.exportSelection.includes(t.id),class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 md:h-4 md:w-4',onChange:a=>e.toggleExportSelection(t.id)},null,40,CF),Mn('span',IF,oe(t.name),1)]))),128))]),Mn('button',{class:'w-full rounded bg-green-600 px-2 py-1.5 text-[10px] text-white transition-colors hover:bg-green-500 md:px-4 md:py-2 md:text-sm',onClick:t[16]||(t[16]=(...t)=>e.exportRules&&e.exportRules(...t))},' 导出选中 (使用完整正则写法) ')]),e.exportJson?(yn(),Sn('div',TF,[t[49]||(t[49]=Mn('h3',{class:'mb-2 text-xs font-medium text-white md:mb-3 md:text-sm'},'导出结果',-1)),Mn('textarea',{value:e.exportJson,rows:'4',readonly:'',class:'w-full rounded border border-[#373a40] bg-[#202225] px-2 py-1.5 font-mono text-[10px] text-gray-300 md:px-3 md:py-2 md:text-sm'},null,8,AF),Mn('button',{class:'mt-1.5 w-full rounded bg-gray-600 px-2 py-1.5 text-[10px] text-white transition-colors hover:bg-gray-500 md:mt-2 md:px-4 md:py-2 md:text-sm',onClick:t[17]||(t[17]=(...t)=>e.copyExport&&e.copyExport(...t))},' 复制到剪贴板 ')])):Rn('v-if',!0)])):Rn('v-if',!0),Rn(' Edit Rule Dialog '),e.showEditDialog?(yn(),Sn('div',{key:3,class:'fixed inset-0 z-90 flex items-center justify-center bg-black/60',onClick:t[29]||(t[29]=Cl(t=>e.showEditDialog=!1,['self']))},[Mn('div',MF,[Mn('h3',EF,oe(e.editingRule?.id?'编辑规则':'添加规则'),1),Mn('div',$F,[Mn('div',null,[t[50]||(t[50]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'规则名称',-1)),xa(Mn('input',{'onUpdate:modelValue':t[18]||(t[18]=t=>e.editingRule.name=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white md:px-3 md:py-2 md:text-sm'},null,512),[[fl,e.editingRule.name]])]),Rn(' 正则输入 - 支持完整写法 '),Mn('div',null,[t[51]||(t[51]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},[Pn(' 正则表达式 '),Mn('span',{class:'ml-1 text-[8px] text-gray-500'},'(支持 /pattern/flags 格式)')],-1)),xa(Mn('input',{'onUpdate:modelValue':t[19]||(t[19]=t=>e.editingRule.regex=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 font-mono text-xs text-white md:px-3 md:py-2 md:text-sm',placeholder:'例如: /\\\\[.*?\\\\]/g 或直接输入 \\\\[.*?\\\\]',onInput:t[20]||(t[20]=(...t)=>e.onEditingRegexChange&&e.onEditingRegexChange(...t))},null,544),[[fl,e.editingRule.regex]]),e.editingRegexError?(yn(),Sn('p',DF,oe(e.editingRegexError),1)):e.editingRegexParsed?(yn(),Sn('p',PF,' ✓ pattern='+oe(e.editingRegexParsed.pattern.slice(0,30))+oe(e.editingRegexParsed.pattern.length>30?'...':'')+', flags='+oe(e.editingRegexParsed.flags||'g'),1)):Rn('v-if',!0)]),Mn('div',null,[t[53]||(t[53]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'替换为',-1)),xa(Mn('input',{'onUpdate:modelValue':t[21]||(t[21]=t=>e.editingRule.replacement=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 font-mono text-xs text-white md:px-3 md:py-2 md:text-sm',placeholder:e.macroPlaceholder},null,8,NF),[[fl,e.editingRule.replacement]]),Mn('p',RF,[t[52]||(t[52]=Pn(' 宏: ',-1)),Mn('code',{class:'text-amber-400',textContent:oe(e.macroHelpText)},null,8,jF)])]),Rn(' 模式选择 '),Mn('div',null,[t[56]||(t[56]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'应用模式',-1)),Mn('div',LF,[Mn('button',{class:ee(['flex-1 rounded px-2 py-1.5 text-[10px] transition-colors md:px-3 md:py-2 md:text-xs','permanent'===e.editingRule.mode?'bg-amber-600 text-white':'bg-[#40444b] text-gray-300 hover:bg-[#4a4e54]']),onClick:t[22]||(t[22]=t=>e.editingRule.mode='permanent')},' 📝 永久替换 ',2),Mn('button',{class:ee(['flex-1 rounded px-2 py-1.5 text-[10px] transition-colors md:px-3 md:py-2 md:text-xs','render'===e.editingRule.mode?'bg-blue-600 text-white':'bg-[#40444b] text-gray-300 hover:bg-[#4a4e54]']),onClick:t[23]||(t[23]=t=>e.editingRule.mode='render')},' 👁️ 渲染替换 ',2)]),Mn('p',BF,['permanent'===e.editingRule.mode?(yn(),Sn('span',OF,[...t[54]||(t[54]=[Pn(' 永久替换：修改原始消息内容并保存，',-1),Mn('span',{class:'text-amber-400'},'不可逆',-1)])])):(yn(),Sn('span',qF,[...t[55]||(t[55]=[Pn(' 渲染替换：仅在显示时替换，原始数据不变，',-1),Mn('span',{class:'text-blue-400'},'可随时开关',-1)])]))])]),Rn(' 隐藏的分离字段，保持兼容性 '),e.editingRegexParsed?Rn('v-if',!0):(yn(),Sn('div',UF,[t[57]||(t[57]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},[Pn(' 标志 (备用) '),Mn('span',{class:'ml-1 text-[8px] text-amber-400'},'建议使用上方完整格式')],-1)),xa(Mn('input',{'onUpdate:modelValue':t[24]||(t[24]=t=>e.editingRule.flags=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white md:px-3 md:py-2 md:text-sm',placeholder:'g, i, m, s'},null,512),[[fl,e.editingRule.flags]])])),Mn('div',VF,[Mn('div',null,[t[58]||(t[58]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'最小深度',-1)),xa(Mn('input',{'onUpdate:modelValue':t[25]||(t[25]=t=>e.editingRule.minDepth=t),type:'number',min:'0',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white md:px-3 md:py-2 md:text-sm'},null,512),[[fl,e.editingRule.minDepth,void 0,{number:!0}]])]),Mn('div',null,[t[59]||(t[59]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-xs'},'最大深度',-1)),xa(Mn('input',{'onUpdate:modelValue':t[26]||(t[26]=t=>e.editingRule.maxDepth=t),type:'number',min:'-1',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1.5 text-xs text-white md:px-3 md:py-2 md:text-sm'},null,512),[[fl,e.editingRule.maxDepth,void 0,{number:!0}]])])])]),Mn('div',FF,[Mn('button',{class:'flex-1 rounded bg-[#40444b] px-2 py-1.5 text-xs text-white hover:bg-[#50555e] md:px-4 md:py-2 md:text-sm',onClick:t[27]||(t[27]=t=>e.showEditDialog=!1)},' 取消 '),Mn('button',{class:'flex-1 rounded bg-amber-600 px-2 py-1.5 text-xs text-white hover:bg-amber-500 md:px-4 md:py-2 md:text-sm',onClick:t[28]||(t[28]=(...t)=>e.saveEditingRule&&e.saveEditingRule(...t))},' 保存 ')])])])):Rn('v-if',!0)])}]]),PromptManager:yV,ToastNotification:dU},props:{visible:{type:Boolean,default:!1}},emits:['close','apply-regex'],setup(e,{emit:t}){const a=$t('display'),s=xt({visible:!1,message:'',type:'info'}),n=(e,t='success')=>{s.message=e,s.type=t,s.visible=!0},r=xt({varMaintenance:{useTavernApi:!0,endpoint:'',apiKey:'',model:''},textOptimization:{useTavernApi:!0,endpoint:'',apiKey:'',model:''},adventureSummary:{useTavernApi:!0,endpoint:'',apiKey:'',model:''},otherModules:{useTavernApi:!0,endpoint:'',apiKey:'',model:''}}),l=xt({fontSize:window.innerWidth<768?10:14,messageSpacing:12,showTimestamp:!1,compactMode:!1,chatMessageLimit:50}),o=xt({summaryCount:10,dialogCount:5,scanThreshold:2,stateDepth:3}),i=$t([]),c=xt({autoImageGen:!0,textOptimization:!1}),d=xt({varMaintenance:[],textOptimization:[],adventureSummary:[],otherModules:[]}),u=xt({varMaintenance:!1,textOptimization:!1,adventureSummary:!1,otherModules:!1});return us(()=>{(()=>{try{const e=localStorage.getItem('game_api_config');e&&Object.assign(r,JSON.parse(e));const t=localStorage.getItem('game_display_config');t&&Object.assign(l,JSON.parse(t));const a=localStorage.getItem('game_memory_config');a&&Object.assign(o,JSON.parse(a));const s=localStorage.getItem('game_background_task_config');s&&Object.assign(c,JSON.parse(s));try{const e=Ll.serviceLocator.get('LLMService');c.autoImageGen=e.getUseAutoImageGen(),c.textOptimization=e.getUseTextOptimization()}catch{}localStorage.removeItem('game_story_ai_preset')}catch(e){console.error('Failed to load config',e)}})()}),{tabs:[{id:'display',label:'显示设置'},{id:'varMaintenance',label:'变量维护'},{id:'textOptimization',label:'正文优化'},{id:'memory',label:'记忆设置'},{id:'regex',label:'正则工具'},{id:'api',label:'API 配置'}],activeTab:a,apiConfig:r,displayConfig:l,memoryConfig:o,memoryPreview:i,toast:s,saveApiConfig:()=>{try{localStorage.setItem('game_api_config',JSON.stringify(r)),n('API 配置已保存','success')}catch(e){console.error('Failed to save API config',e),n('保存失败','error')}},saveDisplayConfig:()=>{try{localStorage.setItem('game_display_config',JSON.stringify(l));const e=Ll.serviceLocator.get('EventBus');e&&e.emit('display:config-updated',{...l}),n('显示设置已保存','success')}catch(e){console.error('Failed to save display config',e),n('保存失败','error')}},saveMemoryConfig:()=>{try{localStorage.setItem('game_memory_config',JSON.stringify(o)),n('记忆设置已保存','success')}catch(e){console.error('Failed to save memory config',e),n('保存失败','error')}},refreshPreview:()=>{const e=[];for(let t=0;t<Math.min(o.summaryCount,3);t++)e.push({type:'summary',label:`摘要#${t+1}`,depth:50-3*t,scan:!1,content:`[回顾] 这是第${t+1}条摘要内容的示例...`});o.summaryCount>3&&e.push({type:'summary',label:`...+${o.summaryCount-3}条`,depth:41,scan:!1,content:'(更多摘要)'});for(let t=0;t<o.dialogCount;t++){const a=o.dialogCount-t<=o.scanThreshold,s=a?2*(o.dialogCount-t):5+2*(o.dialogCount-t-o.scanThreshold);e.push({type:'dialog-user',label:`玩家#${t+1}`,depth:s+1,scan:a,content:`玩家的第${t+1}条输入...`}),e.push({type:'dialog-ai',label:`AI#${t+1}`,depth:s,scan:a,content:`AI的第${t+1}条回复内容...`})}e.push({type:'state',label:'玩家面板',depth:o.stateDepth,scan:!1,content:'[玩家状态] 冒险者 Lv.5 HP:45/60 MP:30/40...'}),i.value=e},handleRegexApply:e=>{t('apply-regex',e)},modelLists:d,loadingModels:u,fetchModels:async e=>{const t=r[e];if(t.endpoint&&t.apiKey){u[e]=!0;try{let a=t.endpoint.trim();a.endsWith('/')&&(a=a.slice(0,-1)),a.endsWith('/v1')||(a+='/v1');const s=await fetch(`${a}/models`,{method:'GET',headers:{Authorization:`Bearer ${t.apiKey}`,'Content-Type':'application/json'}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();if(r.data&&Array.isArray(r.data))d[e]=r.data.map(e=>e.id).sort((e,t)=>e.localeCompare(t)),n(`获取到 ${d[e].length} 个模型`,'success');else{if(!Array.isArray(r))throw new Error('无法解析模型列表响应');d[e]=r.map(e=>'string'==typeof e?e:e.id||e.name||'').filter(e=>e).sort((e,t)=>e.localeCompare(t)),n(`获取到 ${d[e].length} 个模型`,'success')}}catch(t){console.error('Failed to fetch models:',t),n(`获取模型失败: ${t instanceof Error?t.message:'未知错误'}`,'error'),d[e]=[]}finally{u[e]=!1}}else n('请先填写 API 端点和密钥','warning')},backgroundTaskConfig:c,saveBackgroundTaskConfig:()=>{try{localStorage.setItem('game_background_task_config',JSON.stringify(c));try{const e=Ll.serviceLocator.get('LLMService');e.setUseAutoImageGen(c.autoImageGen),e.setUseTextOptimization(c.textOptimization)}catch{}n('后台任务设置已保存','success')}catch(e){console.error('Failed to save background task config',e),n('保存失败','error')}}}}}),zF=(0,$u.A)(GF,[['render',function(e,t,a,s,n,r){const l=fs('PromptManager'),o=fs('RegexTool'),i=fs('ToastNotification');return e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-80 flex items-center justify-center bg-black/80',onClick:t[43]||(t[43]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',wO,[Rn(' Header '),Mn('div',kO,[t[45]||(t[45]=Mn('h2',{class:'text-sm font-bold text-white md:text-xl'},'系统设置',-1)),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[44]||(t[44]=[Mn('svg',{class:'h-4 w-4 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),Rn(' Tab Navigation '),Mn('div',SO,[(yn(!0),Sn(pn,null,xs(e.tabs,a=>(yn(),Sn('button',{key:a.id,class:ee(['flex shrink-0 items-center space-x-1 px-2 py-1.5 text-[10px] transition-colors md:space-x-2 md:px-4 md:py-3 md:text-sm',e.activeTab===a.id?'border-b-2 border-amber-500 bg-[#2f3136] text-white':'text-gray-400 hover:text-white']),onClick:t=>e.activeTab=a.id},[Rn(' Variable Maintenance Icon '),'varMaintenance'===a.id?(yn(),Sn('svg',CO,[...t[46]||(t[46]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'},null,-1),Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 12a3 3 0 11-6 0 3 3 0 016 0z'},null,-1)])])):'textOptimization'===a.id?(yn(),Sn(pn,{key:1},[Rn(' Text Optimization Icon '),t[47]||(t[47]=Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z'})],-1))],2112)):'memory'===a.id?(yn(),Sn(pn,{key:2},[Rn(' Memory Icon '),t[48]||(t[48]=Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z'})],-1))],2112)):'regex'===a.id?(yn(),Sn(pn,{key:3},[Rn(' Search Icon for regex '),t[49]||(t[49]=Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'})],-1))],2112)):'api'===a.id?(yn(),Sn(pn,{key:4},[Rn(' Plug Icon for api '),t[50]||(t[50]=Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1'})],-1))],2112)):'display'===a.id?(yn(),Sn(pn,{key:5},[Rn(' Desktop Icon for display '),t[51]||(t[51]=Mn('svg',{class:'h-3 w-3 md:h-4 md:w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z'})],-1))],2112)):Rn('v-if',!0),Mn('span',null,oe(a.label),1)],10,_O))),128))]),Rn(' Tab Content '),Mn('div',IO,[Rn(' Variable Maintenance Tab '),'varMaintenance'===e.activeTab?(yn(),_n(l,{key:0,type:'varMaintenance'})):Rn('v-if',!0),Rn(' Text Optimization Tab '),'textOptimization'===e.activeTab?(yn(),_n(l,{key:1,type:'textOptimization'})):Rn('v-if',!0),Rn(' Memory Settings Tab '),'memory'===e.activeTab?(yn(),Sn('div',TO,[Mn('div',AO,[Rn(' Left: Settings '),Mn('div',MO,[Mn('div',EO,[Rn(' Info '),t[56]||(t[56]=Mn('div',{class:'rounded border border-blue-500/30 bg-blue-500/10 p-1.5 md:p-2'},[Mn('p',{class:'text-[9px] text-gray-400 md:text-xs'},' 记忆设置控制AI看到的上下文数量。summary是摘要，content是完整对话，用于保持文风。 ')],-1)),Rn(' Summary Count '),Mn('div',$O,[t[52]||(t[52]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:text-xs'},'摘要数量 (summary)',-1)),Mn('div',DO,[xa(Mn('input',{'onUpdate:modelValue':t[1]||(t[1]=t=>e.memoryConfig.summaryCount=t),type:'range',min:'0',max:'20',class:'h-1 flex-1'},null,512),[[fl,e.memoryConfig.summaryCount,void 0,{number:!0}]]),Mn('span',PO,oe(e.memoryConfig.summaryCount),1)])]),Rn(' Dialog Count '),Mn('div',NO,[t[53]||(t[53]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:text-xs'},'完整对话轮数 (content)',-1)),Mn('div',RO,[xa(Mn('input',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.memoryConfig.dialogCount=t),type:'range',min:'1',max:'10',class:'h-1 flex-1'},null,512),[[fl,e.memoryConfig.dialogCount,void 0,{number:!0}]]),Mn('span',jO,oe(e.memoryConfig.dialogCount),1)])]),Rn(' Scan Threshold '),Mn('div',LO,[t[54]||(t[54]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:text-xs'},'世界书扫描范围 (最后N轮)',-1)),Mn('div',BO,[xa(Mn('input',{'onUpdate:modelValue':t[3]||(t[3]=t=>e.memoryConfig.scanThreshold=t),type:'range',min:'1',max:'5',class:'h-1 flex-1'},null,512),[[fl,e.memoryConfig.scanThreshold,void 0,{number:!0}]]),Mn('span',OO,oe(e.memoryConfig.scanThreshold),1)]),Mn('p',qO,' 只有最后 '+oe(e.memoryConfig.scanThreshold)+' 轮对话参与世界书关键词扫描 ',1)]),Rn(' State Depth '),Mn('div',UO,[t[55]||(t[55]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:text-xs'},'玩家面板深度',-1)),Mn('div',VO,[xa(Mn('input',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.memoryConfig.stateDepth=t),type:'range',min:'1',max:'10',class:'h-1 flex-1'},null,512),[[fl,e.memoryConfig.stateDepth,void 0,{number:!0}]]),Mn('span',FO,oe(e.memoryConfig.stateDepth),1)])]),Rn(' Save Button '),Mn('button',{class:'w-full rounded bg-amber-600 px-2 py-1.5 text-[10px] font-medium text-white hover:bg-amber-500 md:py-2 md:text-xs',onClick:t[5]||(t[5]=(...t)=>e.saveMemoryConfig&&e.saveMemoryConfig(...t))},' 保存记忆设置 ')])]),Rn(' Right: Preview '),Mn('div',HO,[Mn('div',GO,[t[57]||(t[57]=Mn('span',{class:'text-[10px] font-medium text-gray-300 md:text-xs'},'上下文预览',-1)),Mn('button',{class:'rounded bg-[#40444b] px-2 py-0.5 text-[9px] text-gray-300 hover:bg-[#4a4e54] md:text-[10px]',onClick:t[6]||(t[6]=(...t)=>e.refreshPreview&&e.refreshPreview(...t))},' 刷新 ')]),Mn('div',zO,[0===e.memoryPreview.length?(yn(),Sn('div',WO,' 点击"刷新"预览当前上下文 ')):(yn(),Sn('div',QO,[(yn(!0),Sn(pn,null,xs(e.memoryPreview,(e,t)=>(yn(),Sn('div',{key:t,class:ee(['rounded border-l-2 p-1.5',{'border-green-500 bg-green-500/10':'summary'===e.type,'border-blue-500 bg-blue-500/10':'dialog-user'===e.type,'border-purple-500 bg-purple-500/10':'dialog-ai'===e.type,'border-amber-500 bg-amber-500/10':'state'===e.type}])},[Mn('div',XO,[Mn('span',{class:ee(['rounded px-1',{'bg-green-500/20 text-green-400':'summary'===e.type,'bg-blue-500/20 text-blue-400':'dialog-user'===e.type,'bg-purple-500/20 text-purple-400':'dialog-ai'===e.type,'bg-amber-500/20 text-amber-400':'state'===e.type}])},oe(e.label),3),Mn('span',null,'depth:'+oe(e.depth),1),e.scan?(yn(),Sn('span',YO,'📡扫描')):Rn('v-if',!0)]),Mn('p',KO,oe(e.content),1)],2))),128))]))])])])])):Rn('v-if',!0),Rn(' Regex Tool Tab '),'regex'===e.activeTab?(yn(),_n(o,{key:3,onApply:e.handleRegexApply},null,8,['onApply'])):Rn('v-if',!0),Rn(' API Config Tab '),'api'===e.activeTab?(yn(),Sn('div',JO,[Mn('div',ZO,[Rn(' Info about main API '),t[90]||(t[90]=Nn('<div class="rounded-lg border border-blue-500/30 bg-blue-500/10 p-2 md:p-4"><div class="flex items-start space-x-2 md:space-x-3"><svg class="h-4 w-4 shrink-0 text-blue-400 md:h-5 md:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><h4 class="text-[10px] font-medium text-blue-400 md:text-sm">主 API 说明</h4><p class="mt-0.5 text-[10px] text-gray-400 md:mt-1 md:text-sm"> 主对话 API 将沿用酒馆（SillyTavern）的配置。以下配置仅用于&quot;变量维护&quot;和&quot;正文优化&quot;功能的独立 API 调用（如果不想使用酒馆的 API）。 </p></div></div></div>',1)),Rn(' Variable Maintenance API '),Mn('div',eq,[t[65]||(t[65]=Mn('h3',{class:'mb-2 flex items-center text-[10px] font-medium text-white md:mb-4 md:text-lg'},[Mn('svg',{class:'mr-1 h-4 w-4 text-green-400 md:mr-2 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'}),Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 12a3 3 0 11-6 0 3 3 0 016 0z'})]),Pn(' 变量维护 API ')],-1)),Mn('div',tq,[Mn('div',aq,[xa(Mn('input',{id:'useTavernApiVar','onUpdate:modelValue':t[7]||(t[7]=t=>e.apiConfig.varMaintenance.useTavernApi=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 focus:ring-amber-500 md:h-4 md:w-4'},null,512),[[vl,e.apiConfig.varMaintenance.useTavernApi]]),t[58]||(t[58]=Mn('label',{for:'useTavernApiVar',class:'text-[10px] text-gray-300 md:text-sm'},'使用酒馆 API',-1))]),e.apiConfig.varMaintenance.useTavernApi?Rn('v-if',!0):(yn(),Sn('div',sq,[Mn('div',null,[t[59]||(t[59]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 端点',-1)),xa(Mn('input',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.apiConfig.varMaintenance.endpoint=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'https://api.openai.com/v1'},null,512),[[fl,e.apiConfig.varMaintenance.endpoint]])]),Mn('div',null,[t[60]||(t[60]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 密钥',-1)),xa(Mn('input',{'onUpdate:modelValue':t[9]||(t[9]=t=>e.apiConfig.varMaintenance.apiKey=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'sk-...'},null,512),[[fl,e.apiConfig.varMaintenance.apiKey]])]),Mn('div',null,[t[64]||(t[64]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'模型',-1)),Mn('div',nq,[Mn('div',rq,[e.modelLists.varMaintenance.length>0?xa((yn(),Sn('select',{key:0,'onUpdate:modelValue':t[10]||(t[10]=t=>e.apiConfig.varMaintenance.model=t),class:'w-full appearance-none rounded border border-[#373a40] bg-[#40444b] px-2 py-1 pr-8 text-[10px] text-white md:px-3 md:py-2 md:text-sm'},[t[61]||(t[61]=Mn('option',{value:''},'选择模型...',-1)),(yn(!0),Sn(pn,null,xs(e.modelLists.varMaintenance,e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,lq))),128))],512)),[[bl,e.apiConfig.varMaintenance.model]]):xa((yn(),Sn('input',{key:1,'onUpdate:modelValue':t[11]||(t[11]=t=>e.apiConfig.varMaintenance.model=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white md:px-3 md:py-2 md:text-sm',placeholder:'gpt-4'},null,512)),[[fl,e.apiConfig.varMaintenance.model]]),e.modelLists.varMaintenance.length>0?(yn(),Sn('svg',oq,[...t[62]||(t[62]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 9l-7 7-7-7'},null,-1)])])):Rn('v-if',!0)]),Mn('button',{class:'shrink-0 rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-gray-300 hover:bg-[#4a4e54] disabled:cursor-not-allowed disabled:opacity-50 md:px-3 md:text-sm',disabled:e.loadingModels.varMaintenance||!e.apiConfig.varMaintenance.endpoint||!e.apiConfig.varMaintenance.apiKey,onClick:t[12]||(t[12]=t=>e.fetchModels('varMaintenance'))},[e.loadingModels.varMaintenance?(yn(),Sn('span',cq,[...t[63]||(t[63]=[Mn('svg',{class:'h-3 w-3 animate-spin',viewBox:'0 0 24 24'},[Mn('circle',{class:'opacity-25',cx:'12',cy:'12',r:'10',stroke:'currentColor','stroke-width':'4',fill:'none'}),Mn('path',{class:'opacity-75',fill:'currentColor',d:'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'})],-1)])])):(yn(),Sn('span',dq,'获取'))],8,iq)])])]))])]),Rn(' Text Optimization API '),Mn('div',uq,[t[73]||(t[73]=Mn('h3',{class:'mb-2 flex items-center text-[10px] font-medium text-white md:mb-4 md:text-lg'},[Mn('svg',{class:'mr-1 h-4 w-4 text-purple-400 md:mr-2 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z'})]),Pn(' 正文优化 API ')],-1)),Mn('div',pq,[Mn('div',mq,[xa(Mn('input',{id:'useTavernApiText','onUpdate:modelValue':t[13]||(t[13]=t=>e.apiConfig.textOptimization.useTavernApi=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 focus:ring-amber-500 md:h-4 md:w-4'},null,512),[[vl,e.apiConfig.textOptimization.useTavernApi]]),t[66]||(t[66]=Mn('label',{for:'useTavernApiText',class:'text-[10px] text-gray-300 md:text-sm'},'使用酒馆 API',-1))]),e.apiConfig.textOptimization.useTavernApi?Rn('v-if',!0):(yn(),Sn('div',gq,[Mn('div',null,[t[67]||(t[67]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 端点',-1)),xa(Mn('input',{'onUpdate:modelValue':t[14]||(t[14]=t=>e.apiConfig.textOptimization.endpoint=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'https://api.openai.com/v1'},null,512),[[fl,e.apiConfig.textOptimization.endpoint]])]),Mn('div',null,[t[68]||(t[68]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 密钥',-1)),xa(Mn('input',{'onUpdate:modelValue':t[15]||(t[15]=t=>e.apiConfig.textOptimization.apiKey=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'sk-...'},null,512),[[fl,e.apiConfig.textOptimization.apiKey]])]),Mn('div',null,[t[72]||(t[72]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'模型',-1)),Mn('div',hq,[Mn('div',fq,[e.modelLists.textOptimization.length>0?xa((yn(),Sn('select',{key:0,'onUpdate:modelValue':t[16]||(t[16]=t=>e.apiConfig.textOptimization.model=t),class:'w-full appearance-none rounded border border-[#373a40] bg-[#40444b] px-2 py-1 pr-8 text-[10px] text-white md:px-3 md:py-2 md:text-sm'},[t[69]||(t[69]=Mn('option',{value:''},'选择模型...',-1)),(yn(!0),Sn(pn,null,xs(e.modelLists.textOptimization,e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,vq))),128))],512)),[[bl,e.apiConfig.textOptimization.model]]):xa((yn(),Sn('input',{key:1,'onUpdate:modelValue':t[17]||(t[17]=t=>e.apiConfig.textOptimization.model=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white md:px-3 md:py-2 md:text-sm',placeholder:'gpt-4'},null,512)),[[fl,e.apiConfig.textOptimization.model]]),e.modelLists.textOptimization.length>0?(yn(),Sn('svg',yq,[...t[70]||(t[70]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 9l-7 7-7-7'},null,-1)])])):Rn('v-if',!0)]),Mn('button',{class:'shrink-0 rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-gray-300 hover:bg-[#4a4e54] disabled:cursor-not-allowed disabled:opacity-50 md:px-3 md:text-sm',disabled:e.loadingModels.textOptimization||!e.apiConfig.textOptimization.endpoint||!e.apiConfig.textOptimization.apiKey,onClick:t[18]||(t[18]=t=>e.fetchModels('textOptimization'))},[e.loadingModels.textOptimization?(yn(),Sn('span',xq,[...t[71]||(t[71]=[Mn('svg',{class:'h-3 w-3 animate-spin',viewBox:'0 0 24 24'},[Mn('circle',{class:'opacity-25',cx:'12',cy:'12',r:'10',stroke:'currentColor','stroke-width':'4',fill:'none'}),Mn('path',{class:'opacity-75',fill:'currentColor',d:'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'})],-1)])])):(yn(),Sn('span',wq,'获取'))],8,bq)])])]))])]),Rn(' Adventure Summary API '),Mn('div',kq,[t[81]||(t[81]=Mn('h3',{class:'mb-2 flex items-center text-[10px] font-medium text-white md:mb-4 md:text-lg'},[Mn('svg',{class:'mr-1 h-4 w-4 text-amber-400 md:mr-2 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'})]),Pn(' 冒险总结 API ')],-1)),Mn('div',Sq,[Mn('div',_q,[xa(Mn('input',{id:'useTavernApiSummary','onUpdate:modelValue':t[19]||(t[19]=t=>e.apiConfig.adventureSummary.useTavernApi=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 focus:ring-amber-500 md:h-4 md:w-4'},null,512),[[vl,e.apiConfig.adventureSummary.useTavernApi]]),t[74]||(t[74]=Mn('label',{for:'useTavernApiSummary',class:'text-[10px] text-gray-300 md:text-sm'},'使用酒馆 API',-1))]),e.apiConfig.adventureSummary.useTavernApi?Rn('v-if',!0):(yn(),Sn('div',Cq,[Mn('div',null,[t[75]||(t[75]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 端点',-1)),xa(Mn('input',{'onUpdate:modelValue':t[20]||(t[20]=t=>e.apiConfig.adventureSummary.endpoint=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'https://api.openai.com/v1'},null,512),[[fl,e.apiConfig.adventureSummary.endpoint]])]),Mn('div',null,[t[76]||(t[76]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 密钥',-1)),xa(Mn('input',{'onUpdate:modelValue':t[21]||(t[21]=t=>e.apiConfig.adventureSummary.apiKey=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'sk-...'},null,512),[[fl,e.apiConfig.adventureSummary.apiKey]])]),Mn('div',null,[t[80]||(t[80]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'模型',-1)),Mn('div',Iq,[Mn('div',Tq,[e.modelLists.adventureSummary.length>0?xa((yn(),Sn('select',{key:0,'onUpdate:modelValue':t[22]||(t[22]=t=>e.apiConfig.adventureSummary.model=t),class:'w-full appearance-none rounded border border-[#373a40] bg-[#40444b] px-2 py-1 pr-8 text-[10px] text-white md:px-3 md:py-2 md:text-sm'},[t[77]||(t[77]=Mn('option',{value:''},'选择模型...',-1)),(yn(!0),Sn(pn,null,xs(e.modelLists.adventureSummary,e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,Aq))),128))],512)),[[bl,e.apiConfig.adventureSummary.model]]):xa((yn(),Sn('input',{key:1,'onUpdate:modelValue':t[23]||(t[23]=t=>e.apiConfig.adventureSummary.model=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white md:px-3 md:py-2 md:text-sm',placeholder:'gpt-4'},null,512)),[[fl,e.apiConfig.adventureSummary.model]]),e.modelLists.adventureSummary.length>0?(yn(),Sn('svg',Mq,[...t[78]||(t[78]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 9l-7 7-7-7'},null,-1)])])):Rn('v-if',!0)]),Mn('button',{class:'shrink-0 rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-gray-300 hover:bg-[#4a4e54] disabled:cursor-not-allowed disabled:opacity-50 md:px-3 md:text-sm',disabled:e.loadingModels.adventureSummary||!e.apiConfig.adventureSummary.endpoint||!e.apiConfig.adventureSummary.apiKey,onClick:t[24]||(t[24]=t=>e.fetchModels('adventureSummary'))},[e.loadingModels.adventureSummary?(yn(),Sn('span',$q,[...t[79]||(t[79]=[Mn('svg',{class:'h-3 w-3 animate-spin',viewBox:'0 0 24 24'},[Mn('circle',{class:'opacity-25',cx:'12',cy:'12',r:'10',stroke:'currentColor','stroke-width':'4',fill:'none'}),Mn('path',{class:'opacity-75',fill:'currentColor',d:'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'})],-1)])])):(yn(),Sn('span',Dq,'获取'))],8,Eq)])])]))])]),Rn(' Other Modules API '),Mn('div',Pq,[t[89]||(t[89]=Mn('h3',{class:'mb-2 flex items-center text-[10px] font-medium text-white md:mb-4 md:text-lg'},[Mn('svg',{class:'mr-1 h-4 w-4 text-cyan-400 md:mr-2 md:h-5 md:w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10'})]),Pn(' 其他模块 API ')],-1)),Mn('div',Nq,[Mn('div',Rq,[xa(Mn('input',{id:'useTavernApiOther','onUpdate:modelValue':t[25]||(t[25]=t=>e.apiConfig.otherModules.useTavernApi=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 focus:ring-amber-500 md:h-4 md:w-4'},null,512),[[vl,e.apiConfig.otherModules.useTavernApi]]),t[82]||(t[82]=Mn('label',{for:'useTavernApiOther',class:'text-[10px] text-gray-300 md:text-sm'},'使用酒馆 API',-1))]),e.apiConfig.otherModules.useTavernApi?Rn('v-if',!0):(yn(),Sn('div',jq,[Mn('div',null,[t[83]||(t[83]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 端点',-1)),xa(Mn('input',{'onUpdate:modelValue':t[26]||(t[26]=t=>e.apiConfig.otherModules.endpoint=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'https://api.openai.com/v1'},null,512),[[fl,e.apiConfig.otherModules.endpoint]])]),Mn('div',null,[t[84]||(t[84]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'API 密钥',-1)),xa(Mn('input',{'onUpdate:modelValue':t[27]||(t[27]=t=>e.apiConfig.otherModules.apiKey=t),type:'text',autocomplete:'off',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none md:px-3 md:py-2 md:text-sm',placeholder:'sk-...'},null,512),[[fl,e.apiConfig.otherModules.apiKey]])]),Mn('div',null,[t[88]||(t[88]=Mn('label',{class:'mb-0.5 block text-[10px] text-gray-400 md:mb-1 md:text-sm'},'模型',-1)),Mn('div',Lq,[Mn('div',Bq,[e.modelLists.otherModules.length>0?xa((yn(),Sn('select',{key:0,'onUpdate:modelValue':t[28]||(t[28]=t=>e.apiConfig.otherModules.model=t),class:'w-full appearance-none rounded border border-[#373a40] bg-[#40444b] px-2 py-1 pr-8 text-[10px] text-white md:px-3 md:py-2 md:text-sm'},[t[85]||(t[85]=Mn('option',{value:''},'选择模型...',-1)),(yn(!0),Sn(pn,null,xs(e.modelLists.otherModules,e=>(yn(),Sn('option',{key:e,value:e},oe(e),9,Oq))),128))],512)),[[bl,e.apiConfig.otherModules.model]]):xa((yn(),Sn('input',{key:1,'onUpdate:modelValue':t[29]||(t[29]=t=>e.apiConfig.otherModules.model=t),type:'text',class:'w-full rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-white md:px-3 md:py-2 md:text-sm',placeholder:'gpt-4'},null,512)),[[fl,e.apiConfig.otherModules.model]]),e.modelLists.otherModules.length>0?(yn(),Sn('svg',qq,[...t[86]||(t[86]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 9l-7 7-7-7'},null,-1)])])):Rn('v-if',!0)]),Mn('button',{class:'shrink-0 rounded border border-[#373a40] bg-[#40444b] px-2 py-1 text-[10px] text-gray-300 hover:bg-[#4a4e54] disabled:cursor-not-allowed disabled:opacity-50 md:px-3 md:text-sm',disabled:e.loadingModels.otherModules||!e.apiConfig.otherModules.endpoint||!e.apiConfig.otherModules.apiKey,onClick:t[30]||(t[30]=t=>e.fetchModels('otherModules'))},[e.loadingModels.otherModules?(yn(),Sn('span',Vq,[...t[87]||(t[87]=[Mn('svg',{class:'h-3 w-3 animate-spin',viewBox:'0 0 24 24'},[Mn('circle',{class:'opacity-25',cx:'12',cy:'12',r:'10',stroke:'currentColor','stroke-width':'4',fill:'none'}),Mn('path',{class:'opacity-75',fill:'currentColor',d:'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'})],-1)])])):(yn(),Sn('span',Fq,'获取'))],8,Uq)])])]))])]),Rn(' Save Button '),Mn('button',{class:'w-full rounded bg-amber-600 px-3 py-2 text-[10px] font-medium text-white transition-colors hover:bg-amber-500 md:px-4 md:py-3 md:text-sm',onClick:t[31]||(t[31]=(...t)=>e.saveApiConfig&&e.saveApiConfig(...t))},' 保存 API 配置 ')])])):Rn('v-if',!0),Rn(' Display Settings Tab '),'display'===e.activeTab?(yn(),Sn('div',Hq,[Mn('div',Gq,[Rn(' 后台任务设置 '),Mn('div',zq,[t[94]||(t[94]=Mn('h3',{class:'mb-2 text-[10px] font-medium text-white md:mb-4 md:text-lg'},'后台任务',-1)),Mn('div',Wq,[Rn(' 自动生成图片 '),Mn('div',Qq,[xa(Mn('input',{id:'useAutoImageGen','onUpdate:modelValue':t[32]||(t[32]=t=>e.backgroundTaskConfig.autoImageGen=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 md:h-4 md:w-4',onChange:t[33]||(t[33]=(...t)=>e.saveBackgroundTaskConfig&&e.saveBackgroundTaskConfig(...t))},null,544),[[vl,e.backgroundTaskConfig.autoImageGen]]),t[91]||(t[91]=Mn('label',{for:'useAutoImageGen',class:'flex-1 text-[10px] text-gray-300 md:text-sm'},[Mn('span',{class:'font-medium'},'自动生成图片'),Mn('span',{class:'ml-1 text-gray-500'},'检测 AI 回复中的 <pic> 标签并自动调用酒馆生图')],-1))]),Rn(' 正文优化 '),Mn('div',Xq,[xa(Mn('input',{id:'useTextOptimization','onUpdate:modelValue':t[34]||(t[34]=t=>e.backgroundTaskConfig.textOptimization=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 md:h-4 md:w-4',onChange:t[35]||(t[35]=(...t)=>e.saveBackgroundTaskConfig&&e.saveBackgroundTaskConfig(...t))},null,544),[[vl,e.backgroundTaskConfig.textOptimization]]),t[92]||(t[92]=Mn('label',{for:'useTextOptimization',class:'flex-1 text-[10px] text-gray-300 md:text-sm'},[Mn('span',{class:'font-medium'},'正文优化'),Mn('span',{class:'ml-1 text-gray-500'},'在每次回复后对正文进行优化处理')],-1))]),Rn(' 说明文字 '),t[93]||(t[93]=Mn('div',{class:'rounded border border-blue-500/30 bg-blue-500/10 p-1.5 md:p-2'},[Mn('p',{class:'text-[9px] text-gray-400 md:text-xs'},' 💡 变量维护（工具AI）是核心功能，始终自动运行，用于更新游戏状态、场景信息等。 ')],-1))])]),Rn(' 显示设置 '),Mn('div',Yq,[t[101]||(t[101]=Mn('h3',{class:'mb-2 text-[10px] font-medium text-white md:mb-4 md:text-lg'},'显示设置',-1)),t[102]||(t[102]=Mn('p',{class:'mb-2 text-[10px] text-gray-500 md:mb-3 md:text-xs'},'以下设置影响中间栏的聊天消息显示区域',-1)),Mn('div',Kq,[Rn(' 聊天显示数量 '),Mn('div',null,[t[95]||(t[95]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:mb-2 md:text-sm'},'聊天显示数量',-1)),Mn('div',Jq,[xa(Mn('input',{'onUpdate:modelValue':t[36]||(t[36]=t=>e.displayConfig.chatMessageLimit=t),type:'range',min:'10',max:'100',step:'5',class:'flex-1'},null,512),[[fl,e.displayConfig.chatMessageLimit,void 0,{number:!0}]]),Mn('span',Zq,oe(e.displayConfig.chatMessageLimit)+'条',1)]),t[96]||(t[96]=Mn('p',{class:'mt-1 text-[8px] text-gray-500 md:text-[10px]'},'限制聊天区域渲染的消息数量，减少可提升性能',-1))]),Mn('div',null,[t[97]||(t[97]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:mb-2 md:text-sm'},'字体大小（聊天消息）',-1)),Mn('div',eU,[xa(Mn('input',{'onUpdate:modelValue':t[37]||(t[37]=t=>e.displayConfig.fontSize=t),type:'range',min:'8',max:'20',class:'flex-1'},null,512),[[fl,e.displayConfig.fontSize,void 0,{number:!0}]]),Mn('span',tU,oe(e.displayConfig.fontSize)+'px',1)])]),Mn('div',null,[t[98]||(t[98]=Mn('label',{class:'mb-1 block text-[10px] text-gray-400 md:mb-2 md:text-sm'},'消息间距',-1)),Mn('div',aU,[xa(Mn('input',{'onUpdate:modelValue':t[38]||(t[38]=t=>e.displayConfig.messageSpacing=t),type:'range',min:'4',max:'24',class:'flex-1'},null,512),[[fl,e.displayConfig.messageSpacing,void 0,{number:!0}]]),Mn('span',sU,oe(e.displayConfig.messageSpacing)+'px',1)])]),Mn('div',nU,[xa(Mn('input',{id:'showTimestamp','onUpdate:modelValue':t[39]||(t[39]=t=>e.displayConfig.showTimestamp=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 md:h-4 md:w-4'},null,512),[[vl,e.displayConfig.showTimestamp]]),t[99]||(t[99]=Mn('label',{for:'showTimestamp',class:'text-[10px] text-gray-300 md:text-sm'},'显示消息时间戳',-1))]),Mn('div',rU,[xa(Mn('input',{id:'compactMode','onUpdate:modelValue':t[40]||(t[40]=t=>e.displayConfig.compactMode=t),type:'checkbox',class:'h-3 w-3 rounded border-gray-600 bg-[#40444b] text-amber-500 md:h-4 md:w-4'},null,512),[[vl,e.displayConfig.compactMode]]),t[100]||(t[100]=Mn('label',{for:'compactMode',class:'text-[10px] text-gray-300 md:text-sm'},'紧凑模式',-1))])])]),Mn('button',{class:'w-full rounded bg-amber-600 px-3 py-2 text-[10px] font-medium text-white transition-colors hover:bg-amber-500 md:px-4 md:py-3 md:text-sm',onClick:t[41]||(t[41]=(...t)=>e.saveDisplayConfig&&e.saveDisplayConfig(...t))},' 保存显示设置 ')])])):Rn('v-if',!0)])]),Rn(' Toast通知 '),En(i,{visible:e.toast.visible,'onUpdate:visible':t[42]||(t[42]=t=>e.toast.visible=t),message:e.toast.message,type:e.toast.type,duration:2500,position:'top'},null,8,['visible','message','type'])])):Rn('v-if',!0)}]]),WF={class:'team-modal'},QF={class:'modal-header'},XF={class:'header-content'},YF={class:'header-title-group'},KF={class:'team-counter'},JF={class:'custom-scrollbar flex-1 overflow-y-auto overscroll-contain'},ZF={key:0,class:'border-b border-[#202225] bg-[#2f3136] p-3 md:p-4'},eH={class:'flex items-start gap-3'},tH={class:'min-w-0 flex-1'},aH={class:'flex items-center gap-2'},sH={class:'truncate text-sm font-bold text-white md:text-base'},nH=['title'],rH={class:'mt-0.5 text-[10px] text-gray-400 md:text-xs'},lH={key:0,class:'mt-0.5 text-[10px] text-gray-500 italic md:text-xs'},oH={class:'mt-3 grid grid-cols-3 gap-3'},iH={class:'mb-0.5 flex items-center justify-between text-[10px] md:text-xs'},cH={class:'text-gray-400'},dH={class:'h-2 overflow-hidden rounded-full bg-[#40444b]'},uH={class:'mb-0.5 flex items-center justify-between text-[10px] md:text-xs'},pH={class:'text-gray-400'},mH={class:'h-2 overflow-hidden rounded-full bg-[#40444b]'},gH={class:'mb-0.5 flex items-center justify-between text-[10px] md:text-xs'},hH={class:'text-gray-400'},fH={class:'h-1.5 overflow-hidden rounded-full bg-[#40444b]'},vH={class:'mt-2'},yH={class:'mb-0.5 flex items-center justify-between text-[10px] md:text-xs'},bH={class:'text-gray-400'},xH={class:'h-2 overflow-hidden rounded-full bg-[#40444b]'},wH={class:'mt-3 grid grid-cols-2 gap-x-4 gap-y-1.5 rounded bg-[#40444b]/50 p-2'},kH={class:'text-[10px] font-medium text-gray-400 md:text-xs'},SH={class:'text-xs font-bold text-gray-200 md:text-sm'},_H={class:'mt-4 grid grid-cols-2 gap-3 md:flex md:flex-wrap'},CH=['disabled','title'],IH={class:'p-2'},TH={key:0,class:'flex h-20 items-center justify-center text-sm text-gray-500 italic'},AH={key:1,class:'space-y-1.5'},MH=['onClick','onContextmenu','onTouchstart'],EH={class:'min-w-0 flex-1'},$H={class:'flex items-center gap-1.5'},DH={class:'truncate text-xs font-medium text-white md:text-sm'},PH={class:'text-[10px] text-gray-400 md:text-xs'},NH={class:'shrink-0 text-right'},RH={class:'text-[10px] text-red-400 md:text-xs'},jH={class:'modal-footer'},LH={class:'footer-content'},BH={class:'footer-info'},OH={class:'dismiss-modal'},qH={class:'dismiss-message'},UH={class:'dismiss-name'},VH={class:'dismiss-actions'},FH=['disabled'];const HH={class:'ally-equipment-modal mx-4 flex max-h-[85vh] w-full max-w-md flex-col rounded-xl border border-gray-600 bg-[#2f3136] shadow-2xl'},GH={class:'flex shrink-0 items-center justify-between rounded-t-xl border-b border-gray-700 bg-[#202225] px-3 py-2 sm:px-4 sm:py-3'},zH={class:'flex items-center gap-1.5'},WH={class:'text-sm font-bold text-white sm:text-base'},QH={class:'detail-section mx-2 mt-2 flex shrink-0 flex-col gap-1.5 rounded-lg border border-[#202225] bg-[#36393f] p-2 shadow-sm sm:mx-3 sm:mt-3 sm:gap-2 sm:p-3'},XH={class:'flex flex-col'},YH={class:'flex items-center gap-2'},KH={class:'text-lg'},JH={class:'mt-1 flex flex-wrap items-center gap-1'},ZH={key:1,class:'rounded bg-gray-700/50 px-1.5 py-0.5 text-[9px] text-gray-400 sm:text-[10px]'},eG={key:2,class:'rounded bg-gray-700/50 px-1.5 py-0.5 text-[9px] text-gray-400 sm:text-[10px]'},tG={key:0,class:'border-t border-[#40444b] pt-1.5'},aG={class:'flex flex-wrap gap-1'},sG={key:1,class:'border-t border-[#40444b] pt-1.5'},nG={class:'text-[10px] leading-relaxed text-gray-300 sm:text-xs'},rG={key:2,class:'border-t border-[#40444b] pt-2'},lG={key:1,class:'flex h-16 w-full items-center justify-center text-xs text-gray-500 italic sm:h-20 sm:text-sm'},oG={class:'custom-scrollbar min-h-0 flex-1 overflow-y-auto p-2 sm:p-3'},iG={class:'equipment-grid'},cG=['title','onClick'],dG={class:'emoji'},uG={key:1,class:'empty-text'},pG={class:'shrink-0 rounded-b-xl border-t border-gray-700 bg-[#202225]/50 px-3 py-2 sm:px-4 sm:py-3'},mG={class:'flex items-center justify-between'},gG={class:'text-[10px] text-gray-500 sm:text-xs'};const hG={weapon_main:'主手',weapon_off:'副手',head:'头部',outer:'外套',upper:'上装',underwear:'内衣',lower:'下装',underpants:'内裤',socks:'袜子',shoes:'鞋子',hands:'手部',accessory_1:'饰品 1',accessory_2:'饰品 2',accessory_3:'饰品 3'},fG={str:'力量',STR:'力量',dex:'敏捷',DEX:'敏捷',con:'体质',CON:'体质',int:'智力',INT:'智力',wis:'感知',WIS:'感知',cha:'魅力',CHA:'魅力',spd:'速度',SPD:'速度',ac:'护甲',AC:'护甲',attack:'攻击',defense:'防御',critRate:'暴击率',critDamage:'暴击伤害',hp:'生命',mp:'魔力',sp:'体力'},vG={weapon:'武器',armor:'防具',accessory:'饰品',consumable:'消耗品',material:'材料',quest:'任务物品'},yG={sword:'剑',staff:'法杖',bow:'弓',axe:'斧',dagger:'匕首',hammer:'锤',spear:'枪',wand:'魔杖',mace:'钉锤',crossbow:'弩',whip:'鞭',fist:'拳套',gun:'火器',hat:'帽子',helmet:'头盔',top_male:'上衣',top_female:'上衣',coat:'外套',cloak:'披风',robe:'长袍',pant_long:'长裤',pant_short:'短裤',skirt:'裙子',boot_heavy:'重靴',boot_light:'轻靴',shoe_light:'便鞋',glove:'手套',gauntlet:'护手',lingerie_top:'内衣',underpants_male:'内裤',underpants_female:'内裤',sock_short:'短袜',sock_long:'长袜',ring:'戒指',necklace:'项链',earring:'耳饰',bracelet:'手镯',belt:'腰带',potion:'药水',scroll:'卷轴',food_bread:'面包',food_meat:'肉类'},bG=Za({name:'AllyEquipmentModal',props:{visible:{type:Boolean,default:!1},ally:{type:Object,default:null},allowUnequip:{type:Boolean,default:!1}},emits:['close','unequip-item'],setup(e,{emit:t}){const a=$t(null),s=ir(()=>e.ally?.name||'队友'),n=hG,r=Object.keys(hG).length,l=t=>e.ally?.equipment&&e.ally.equipment[t]||null,o=ir(()=>a.value?l(a.value):null),i=ir(()=>e.ally?.equipment?Object.values(e.ally.equipment).filter(e=>null!=e).length:0);return _a(()=>e.visible,t=>{if(t&&e.ally?.equipment){const t=Object.keys(hG).find(t=>null!=(e.ally?.equipment)[t]);a.value=t||null}},{immediate:!0}),_a(()=>e.ally?.id,()=>{a.value=null}),{allyName:s,equipmentSlots:n,totalSlots:r,selectedSlot:a,selectedItem:o,equippedCount:i,getEquippedItem:l,selectSlot:e=>{l(e)&&(a.value=e)},getSlotTooltip:(e,t)=>{const a=l(e);if(a){const e=Fx(a.quality).name;return`${a.name} (${e}) - 点击查看详情`}return`${t}：空`},getQualityTextClass:e=>{if(!e)return'text-gray-300';return{Common:'text-gray-300',Uncommon:'text-green-400',Rare:'text-blue-400',Epic:'text-purple-400',Legendary:'text-orange-400',Mythic:'text-red-400'}[e]||'text-gray-300'},getQualityBgClass:e=>{if(!e)return'bg-gray-700/50 text-gray-400';return{Common:'bg-gray-700/50 text-gray-400',Uncommon:'bg-green-900/50 text-green-400',Rare:'bg-blue-900/50 text-blue-400',Epic:'bg-purple-900/50 text-purple-400',Legendary:'bg-orange-900/50 text-orange-400',Mythic:'bg-red-900/50 text-red-400'}[e]||'bg-gray-700/50 text-gray-400'},getQualityBorderClass:e=>{if(!e)return'';return{Common:'border-gray-500',Uncommon:'border-green-500',Rare:'border-blue-500',Epic:'border-purple-500',Legendary:'border-orange-500',Mythic:'border-red-500'}[e]||''},getQualityName:e=>Fx(e).name,getQualityStars:e=>Hx(e),getItemTypeName:e=>vG[e]||e,getItemSubtypeName:e=>yG[e]||e,hasItemStats:e=>!!e.stats&&Object.keys(e.stats).length>0,getItemStats:e=>{if(!e.stats)return{};const t={};for(const[a,s]of Object.entries(e.stats))0!==s&&(t[a]=s);return t},getStatDisplayName:e=>fG[e]||e,handleUnequip:()=>{a.value&&e.ally&&(t('unequip-item',a.value,e.ally),a.value=null)}}}}),xG=(0,$u.A)(bG,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-80 flex items-center justify-center bg-black/70 backdrop-blur-sm',onClick:t[3]||(t[3]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',HH,[Rn(' Header '),Mn('div',GH,[Mn('div',zH,[t[4]||(t[4]=Mn('span',{class:'text-base sm:text-lg'},'🛡️',-1)),Mn('h3',WH,oe(e.allyName)+'的装备',1)]),Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full text-xs text-gray-400 transition-colors hover:bg-gray-700 hover:text-white sm:h-7 sm:w-7 sm:text-sm',onClick:t[0]||(t[0]=t=>e.$emit('close'))},' ✕ ')]),Rn(' Equipment Detail Section '),Mn('div',QH,[e.selectedItem?(yn(),Sn(pn,{key:0},[Rn(' Item Name + Quality '),Mn('div',XH,[Mn('div',YH,[Mn('span',KH,oe(e.selectedItem.emoji||'🛡️'),1),Mn('h3',{class:ee(['truncate text-sm font-bold sm:text-base',e.getQualityTextClass(e.selectedItem.quality)])},oe(e.selectedItem.name),3)]),Mn('div',JH,[Mn('span',{class:ee(['rounded px-1.5 py-0.5 text-[9px] font-medium sm:text-[10px]',e.getQualityBgClass(e.selectedItem.quality)])},oe(e.getQualityName(e.selectedItem.quality)),3),e.getQualityStars(e.selectedItem.quality)?(yn(),Sn('span',{key:0,class:ee(['quality-stars text-[10px] sm:text-xs',e.getQualityTextClass(e.selectedItem.quality)])},oe(e.getQualityStars(e.selectedItem.quality)),3)):Rn('v-if',!0),e.selectedItem.type?(yn(),Sn('span',ZH,oe(e.getItemTypeName(e.selectedItem.type)),1)):Rn('v-if',!0),e.selectedItem.subtype?(yn(),Sn('span',eG,oe(e.getItemSubtypeName(e.selectedItem.subtype)),1)):Rn('v-if',!0)])]),Rn(' Item Stats '),e.hasItemStats(e.selectedItem)?(yn(),Sn('div',tG,[t[5]||(t[5]=Mn('div',{class:'mb-1 text-[9px] font-bold text-gray-500 sm:text-[10px]'},'属性加成',-1)),Mn('div',aG,[(yn(!0),Sn(pn,null,xs(e.getItemStats(e.selectedItem),(t,a)=>(yn(),Sn('span',{key:a,class:ee(['rounded bg-[#202225] px-1.5 py-0.5 text-[9px] sm:text-[10px]',t>0?'text-green-400':'text-red-400'])},oe(e.getStatDisplayName(String(a)))+': '+oe(t>0?'+':'')+oe(t),3))),128))])])):Rn('v-if',!0),Rn(' Item Description '),e.selectedItem.description?(yn(),Sn('div',sG,[Mn('p',nG,oe(e.selectedItem.description),1)])):Rn('v-if',!0),Rn(' Unequip Button (if allowed) '),e.allowUnequip?(yn(),Sn('div',rG,[Mn('button',{class:'w-full rounded bg-[#ed4245] px-3 py-1.5 text-[10px] font-medium text-white transition-colors hover:bg-[#c03537] sm:text-xs',onClick:t[1]||(t[1]=(...t)=>e.handleUnequip&&e.handleUnequip(...t))},' 卸下装备 ')])):Rn('v-if',!0)],64)):(yn(),Sn('div',lG,' 选择一个装备槽位查看详情 '))]),Rn(' Equipment Slots Grid '),Mn('div',oG,[Mn('div',iG,[(yn(!0),Sn(pn,null,xs(e.equipmentSlots,(t,a)=>(yn(),Sn('div',{key:a,class:ee(['equipment-slot',[e.getEquippedItem(a)?e.getQualityBorderClass(e.getEquippedItem(a)?.quality):'',{'has-item':e.getEquippedItem(a),selected:e.selectedSlot===a}]]),title:e.getSlotTooltip(a,t),onClick:t=>e.selectSlot(a)},[e.getEquippedItem(a)?(yn(),Sn(pn,{key:0},[Mn('span',dG,oe(e.getEquippedItem(a)?.emoji||'🛡️'),1),Mn('span',{class:ee(['item-name',e.getQualityTextClass(e.getEquippedItem(a)?.quality)])},oe(e.getEquippedItem(a)?.name),3)],64)):(yn(),Sn('span',uG,'('+oe(t)+'：空)',1))],10,cG))),128))])]),Rn(' Footer '),Mn('div',pG,[Mn('div',mG,[Mn('span',gG,' 已装备: '+oe(e.equippedCount)+'/'+oe(e.totalSlots)+' 件 ',1),Mn('button',{class:'rounded bg-gray-700 px-3 py-1 text-[10px] font-bold text-gray-300 transition-colors hover:bg-gray-600 sm:px-4 sm:py-1.5 sm:text-xs',onClick:t[2]||(t[2]=t=>e.$emit('close'))},' 关闭 ')])])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-1afee900']]),wG={class:'ally-skills-modal mx-4 flex max-h-[85vh] w-full max-w-md flex-col rounded-xl border border-gray-600 bg-[#2f3136] shadow-2xl'},kG={class:'flex shrink-0 items-center justify-between rounded-t-xl border-b border-gray-700 bg-[#202225] px-3 py-2 sm:px-4 sm:py-3'},SG={class:'flex items-center gap-1.5'},_G={class:'text-sm font-bold text-white sm:text-base'},CG={class:'detail-section mx-2 mt-2 flex shrink-0 flex-col gap-1.5 rounded-lg border border-[#202225] bg-[#36393f] p-2 shadow-sm sm:mx-3 sm:mt-3 sm:gap-2 sm:p-3'},IG={class:'flex flex-col'},TG={class:'truncate text-sm font-bold text-white sm:text-base'},AG={class:'detail-tags mt-1 flex flex-wrap items-center gap-1'},MG={key:0,class:'detail-tag-empty'},EG={class:'cost-row flex flex-wrap items-center gap-2 border-t border-[#40444b] pt-1.5'},$G={key:0,class:'flex items-center gap-0.5 text-[10px] text-blue-400 sm:text-xs'},DG={key:1,class:'flex items-center gap-0.5 text-[10px] text-green-400 sm:text-xs'},PG={key:2,class:'flex items-center gap-0.5 text-[10px] text-gray-400 sm:text-xs'},NG={key:3,class:'rounded bg-yellow-900/50 px-1.5 py-0.5 text-[10px] font-bold text-yellow-400 sm:text-xs'},RG={key:4,class:'text-[10px] text-gray-500 sm:text-xs'},jG={class:'desc-row border-t border-[#40444b] pt-1.5'},LG={class:'text-[10px] leading-relaxed text-gray-300 sm:text-xs'},BG={key:0,class:'effect-row border-t border-[#40444b] pt-1.5'},OG={class:'effect-list custom-scrollbar'},qG={key:1,class:'flex h-16 w-full items-center justify-center text-xs text-gray-500 italic sm:h-20 sm:text-sm'},UG={class:'custom-scrollbar min-h-0 flex-1 overflow-y-auto p-2 sm:p-3'},VG={key:0,class:'py-6 text-center text-[10px] text-gray-500 sm:py-8 sm:text-xs'},FG={key:1,class:'skill-list space-y-1 sm:space-y-1.5'},HG=['onClick'],GG={class:'skill-list-info'},zG={class:'skill-list-row'},WG={class:'skill-list-name'},QG={key:0,class:'cooldown-inline'},XG={class:'skill-list-cost'},YG={key:0,class:'cost-mp'},KG={key:1,class:'cost-sp'},JG={key:2,class:'cost-cd'},ZG={class:'skill-list-tags'},ez={key:0,class:'skill-list-tag-empty'},tz={class:'shrink-0 rounded-b-xl border-t border-gray-700 bg-[#202225]/50 px-3 py-2 sm:px-4 sm:py-3'},az={class:'flex items-center justify-between'},sz={class:'text-[10px] text-gray-500 sm:text-xs'};const nz=Za({name:'AllySkillsModal',props:{visible:{type:Boolean,default:!1},skills:{type:Object,default:()=>({})},allyName:{type:String,default:'队友'}},emits:['close'],setup(e){const t=$t(null),a=ir(()=>t.value&&e.skills[t.value]||null);_a(()=>e.visible,a=>{const s=Object.keys(e.skills);a&&s.length>0&&!t.value&&(t.value=s[0])},{immediate:!0}),_a(()=>e.skills,e=>{const a=Object.keys(e);t.value&&!e[t.value]&&(t.value=a.length>0?a[0]:null)},{deep:!0}),_a(()=>e.allyName,()=>{const a=Object.keys(e.skills);t.value=a.length>0?a[0]:null});return{selectedId:t,selectedSkill:a,selectSkill:e=>{t.value=e},getSkillMpCost:e=>{const t=e;return t.cost?'mp'===t.cost.type?t.cost.val||0:t.cost.mp||0:0},getSkillSpCost:e=>{const t=e;return t.cost?'sp'===t.cost.type?t.cost.val||0:t.cost.sp||0:0},getTagColor:Zl,getTagName:e=>{const t=Xl(e);return`${t.icon}${t.name}`},getSkillDescription:e=>Ao(e),getEffectPreview:e=>To(e)}}}),rz=(0,$u.A)(nz,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-80 flex items-center justify-center bg-black/70 backdrop-blur-sm',onClick:t[2]||(t[2]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',wG,[Rn(' Header '),Mn('div',kG,[Mn('div',SG,[t[3]||(t[3]=Mn('span',{class:'text-base sm:text-lg'},'⚔️',-1)),Mn('h3',_G,oe(e.allyName)+'的技能',1)]),Mn('button',{class:'flex h-6 w-6 items-center justify-center rounded-full text-xs text-gray-400 transition-colors hover:bg-gray-700 hover:text-white sm:h-7 sm:w-7 sm:text-sm',onClick:t[0]||(t[0]=t=>e.$emit('close'))},' ✕ ')]),Rn(' Skill Details Section '),Mn('div',CG,[e.selectedSkill?(yn(),Sn(pn,{key:0},[Rn(' Row 1: Name + Type '),Mn('div',IG,[Mn('h3',TG,oe(e.selectedSkill.name),1),Mn('div',AG,[(yn(!0),Sn(pn,null,xs((e.selectedSkill.tags||[]).slice(0,4),t=>(yn(),Sn('span',{key:t,class:'detail-tag rounded px-1.5',style:X({backgroundColor:e.getTagColor(t),color:'white',textShadow:'0 1px 2px rgba(0, 0, 0, 0.5)'})},oe(e.getTagName(t)),5))),128)),e.selectedSkill.tags?.length?Rn('v-if',!0):(yn(),Sn('span',MG,' 通用技能 '))])]),Rn(' Row 2: Cost & Cooldown '),Mn('div',EG,[e.getSkillMpCost(e.selectedSkill)>0?(yn(),Sn('span',$G,' 💙 '+oe(e.getSkillMpCost(e.selectedSkill))+' MP ',1)):Rn('v-if',!0),e.getSkillSpCost(e.selectedSkill)>0?(yn(),Sn('span',DG,' 💚 '+oe(e.getSkillSpCost(e.selectedSkill))+' SP ',1)):Rn('v-if',!0),e.selectedSkill.cooldown&&e.selectedSkill.cooldown>0?(yn(),Sn('span',PG,' ⏱️ CD '+oe(e.selectedSkill.cooldown)+' 回合 ',1)):Rn('v-if',!0),e.selectedSkill.currentCooldown&&e.selectedSkill.currentCooldown>0?(yn(),Sn('span',NG,' 冷却中: '+oe(e.selectedSkill.currentCooldown),1)):Rn('v-if',!0),e.getSkillMpCost(e.selectedSkill)||e.getSkillSpCost(e.selectedSkill)||e.selectedSkill.cooldown?Rn('v-if',!0):(yn(),Sn('span',RG,' 无消耗 '))]),Rn(' Row 3: Description '),Mn('div',jG,[Mn('p',LG,oe(e.selectedSkill.description||e.getSkillDescription(e.selectedSkill)),1)]),Rn(' Row 4: Effects Preview '),e.selectedSkill.effects?.length?(yn(),Sn('div',BG,[t[4]||(t[4]=Mn('div',{class:'mb-1 text-[9px] font-bold text-gray-500 sm:text-[10px]'},'技能效果',-1)),Mn('div',OG,[(yn(!0),Sn(pn,null,xs(e.selectedSkill.effects,(t,a)=>(yn(),Sn('span',{key:a,class:'effect-tag'},oe(e.getEffectPreview(t)),1))),128))])])):Rn('v-if',!0)],64)):(yn(),Sn('div',qG,' 选择一个技能查看详情 '))]),Rn(' Skills List '),Mn('div',UG,[0===Object.keys(e.skills).length?(yn(),Sn('div',VG,' 该队友暂无已学习的技能 ')):(yn(),Sn('div',FG,[(yn(!0),Sn(pn,null,xs(e.skills,(a,s)=>(yn(),Sn('div',{key:s,class:ee(['skill-list-item',[{selected:e.selectedId===s},{disabled:a.currentCooldown&&a.currentCooldown>0}]]),onClick:t=>e.selectSkill(String(s))},[Rn(' Name + Cost on same line, Tags below '),Mn('div',GG,[Mn('div',zG,[Mn('span',WG,[Pn(oe(a.name)+' ',1),a.currentCooldown&&a.currentCooldown>0?(yn(),Sn('span',QG,' (冷却: '+oe(a.currentCooldown)+') ',1)):Rn('v-if',!0)]),Mn('span',XG,[e.getSkillMpCost(a)>0?(yn(),Sn('span',YG,'💙'+oe(e.getSkillMpCost(a)),1)):Rn('v-if',!0),e.getSkillSpCost(a)>0?(yn(),Sn('span',KG,'💚'+oe(e.getSkillSpCost(a)),1)):Rn('v-if',!0),a.cooldown&&a.cooldown>0?(yn(),Sn('span',JG,'⏱️'+oe(a.cooldown),1)):Rn('v-if',!0)])]),Mn('div',ZG,[(yn(!0),Sn(pn,null,xs((a.tags||[]).slice(0,3),t=>(yn(),Sn('span',{key:t,class:'skill-list-tag',style:X({backgroundColor:e.getTagColor(t),color:'white',textShadow:'0 1px 2px rgba(0, 0, 0, 0.5)'})},oe(e.getTagName(t)),5))),128)),a.tags?.length?Rn('v-if',!0):(yn(),Sn('span',ez,'通用技能'))])]),Rn(' Right: Arrow indicator '),t[5]||(t[5]=Mn('div',{class:'skill-list-arrow'},'›',-1))],10,HG))),128))]))]),Rn(' Footer '),Mn('div',tz,[Mn('div',az,[Mn('span',sz,' 已学习: '+oe(Object.keys(e.skills).length)+' 技能 ',1),Mn('button',{class:'rounded bg-gray-700 px-3 py-1 text-[10px] font-bold text-gray-300 transition-colors hover:bg-gray-600 sm:px-4 sm:py-1.5 sm:text-xs',onClick:t[1]||(t[1]=t=>e.$emit('close'))},' 关闭 ')])])])])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-62db310a']]),lz={STR:'力量',DEX:'敏捷',CON:'体质',INT:'智力',WIS:'感知',CHA:'魅力',SPD:'速度',CRIT:'暴击',CRIT_RATE:'暴击',CRIT_DMG:'爆伤',AC:'护甲'},oz=Za({name:'TeamModal',components:{AvatarDisplay:Vh,AvatarEditorModal:Ay,PrivateInfoModal:uM,AllyEquipmentModal:xG,AllySkillsModal:rz},props:{visible:{type:Boolean,required:!0},allies:{type:Array,default:()=>[]},maxTeamSize:{type:Number,default:3}},emits:['close','view-equipment','view-skills','dismiss-ally','update-ally'],setup(e,{emit:t}){const a=$t(null),s=$t(!1),n=$t(!1),r=$t(!1),l=$t(!1),o=$t(!1),i=$t(!1),c=$t({x:0,y:0}),d=$t(null),u=$t(!1);let p=null;const m=ir(()=>e.allies.filter(e=>e.isActive)),g=ir(()=>e.allies.filter(e=>'mercenary'===e.allyType).length),h=ir(()=>a.value&&e.allies.find(e=>e.id===a.value)||null),f=ir(()=>{if(!h.value)return{};const e=h.value,a=function(e){let t=!1;if(!e.attributes)return e.attributes={...fo},!0;'CRIT'in e.attributes&&!('CRIT_RATE'in e.attributes)?(e.attributes.CRIT_RATE=e.attributes.CRIT,delete e.attributes.CRIT,t=!0):'CRIT'in e.attributes&&'CRIT_RATE'in e.attributes&&(delete e.attributes.CRIT,t=!0);for(const a of ho)a in e.attributes||(e.attributes[a]=fo[a]??10,t=!0);return t}(e);a&&t('update-ally',e);const s=e.attributes,n={},r=new Set;for(const e of ho)e in s&&(n[e]=s[e],r.add(e));for(const e of Object.keys(s))r.has(e)||(n[e]=s[e]);return n}),v=e=>'npc'!==e.allyType&&!e.isStarred,y=(e,t)=>{let a=e.clientX||e.clientX,s=e.clientY||e.clientY;a+160>window.innerWidth&&(a=window.innerWidth-160-10);s+100>window.innerHeight&&(s=window.innerHeight-100-10),c.value={x:a,y:s},d.value=t,i.value=!0},b=()=>{i.value=!1,d.value=null};return ms(()=>{p&&clearTimeout(p)}),{selectedAllyId:a,selectedAlly:h,sortedAttributes:f,activeAllies:m,mercenaryCount:g,showPrivateInfo:s,showEquipment:n,showSkills:r,showAvatarEditor:l,showDismissDialog:o,selectAlly:e=>{a.value=e},getAllyTypeName:e=>({companion:'同伴',mercenary:'雇佣兵',npc:'NPC'}[e]||e),getAllyTypeClass:e=>({companion:'bg-green-900/50 text-green-400',mercenary:'bg-yellow-900/50 text-yellow-400',npc:'bg-blue-900/50 text-blue-400'}[e]||'bg-gray-700 text-gray-400'),getStatPercent:e=>e.max<=0?0:Math.min(100,Math.max(0,e.current/e.max*100)),getAffinityColorClass:e=>e>=80?'bg-green-500':e>=50?'bg-yellow-500':e>=25?'bg-orange-500':e>=0?'bg-red-500':'bg-gray-800',getAffinityTextClass:e=>e>=80?'text-green-400':e>=50?'text-yellow-400':e>=25?'text-orange-400':e>=0?'text-red-400':'text-gray-400',getAffinityBarWidth:e=>e>=0?Math.min(100,e)+'%':Math.min(100,Math.abs(e))+'%',showAllyEquipment:()=>{h.value&&(n.value=!0)},showAllySkills:()=>{h.value&&(r.value=!0)},showAllyPrivateInfo:()=>{s.value=!0},handleUnequipItem:(e,a)=>{t('view-equipment',{ally:a,slotKey:e,action:'unequip'}),n.value=!1},canDismiss:v,getDismissTitle:e=>'npc'===e.allyType?'NPC不可解散':e.isStarred?'已收藏，取消收藏后可解散':'解散此队友',showDismissConfirm:()=>{o.value=!0},confirmDismiss:()=>{h.value&&v(h.value)&&(t('dismiss-ally',h.value),o.value=!1)},toggleStar:()=>{h.value&&t('update-ally',{...h.value,isStarred:!h.value.isStarred})},openAvatarEditor:()=>{h.value&&(l.value=!0)},saveAvatar:e=>{h.value&&e&&(t('update-ally',{...h.value,avatar:e}),l.value=!1)},getAttributeDisplayName:e=>lz[e]||e,contextMenuVisible:i,contextMenuPos:c,isAiCompleting:u,showContextMenu:y,hideContextMenu:b,handleTouchStart:(e,t)=>{p=setTimeout(()=>{const a=e.touches[0];y(a,t),e.preventDefault()},500)},handleTouchEnd:()=>{p&&(clearTimeout(p),p=null)},handleAiComplete:async()=>{if(!d.value||u.value)return;const e=d.value;let t,a;console.log('[TeamModal] AI补全请求:',e.name),b();try{t=Ll.serviceLocator.get('BackgroundTaskService');a=t.createTask(Rl.TOOL_AI,`补全 ${e.name} 档案`).taskId,t.startTask(a)}catch(e){console.warn('[TeamModal] BackgroundTaskService not available',e)}try{const s=Ll.serviceLocator.get('ToolAIService'),n=Ll.serviceLocator.get('SaveService').getGameState();if(!n)throw new Error('无法获取游戏状态');let r=e.linkedRelId;r||(r=e.id+'_rel');const l=[];e.class&&l.push(`职业: ${e.class}`),e.race&&l.push(`种族: ${e.race}`),e.appearance&&l.push(`外貌: ${e.appearance}`),e.personality&&l.push(`性格: ${e.personality}`),e.relationship&&l.push(`关系: ${e.relationship}`);const o=l.length>0?`\n\n该队友已知信息：\n${l.join('\n')}`:'\n\n该队友目前几乎没有任何已知信息。',i=`[系统指令] 玩家请求AI补全队友 "${e.name}" (ID: ${e.id}) 的详细档案。请根据已有的剧情和上下文，推断并补充该队友的详细信息。\n${o}\n\n请补充以下缺失的字段（如果对应字段已有内容则跳过）：\n1. appearance (外貌特征) - 外观描述\n2. personality (性格特征) - 性格描述\n3. background (人物背景) - 简要背景故事\n\n请输出 <patch> 标签，使用 set 操作更新 allies.${e.id} 下的相应字段。\n重要：只补充缺失的部分，不要修改已有的正确信息。`,c=await s.process({storyOutput:`<content>玩家正在查看${e.name}的档案。</content>`,userInput:`[补全档案: ${e.name}]`,recentDialogs:[],offlineActions:[],gameState:n,additionalInstructions:i});if(c.errors&&c.errors.length>0){const e=c.errors.join(', ');console.error('[TeamModal] AI completion failed:',e),t&&a&&t.setTaskError(a,e)}else console.log('[TeamModal] AI completion successful'),t&&a&&t.completeTask(a)}catch(e){console.error('[TeamModal] AI completion error:',e);const s=e instanceof Error?e.message:String(e);t&&a&&t.setTaskError(a,s)}}}}}),iz=(0,$u.A)(oz,[['render',function(e,t,a,s,n,r){const l=fs('AvatarDisplay'),o=fs('PrivateInfoModal'),i=fs('AllyEquipmentModal'),c=fs('AllySkillsModal'),d=fs('AvatarEditorModal');return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal'},{default:ba(()=>[e.visible?(yn(),Sn('div',{key:0,class:'modal-backdrop',onClick:t[20]||(t[20]=Cl(t=>e.$emit('close'),['self']))},[Rn(' 背景效果层 '),t[43]||(t[43]=Mn('div',{class:'modal-vignette'},null,-1)),t[44]||(t[44]=Mn('div',{class:'modal-noise'},null,-1)),Mn('div',WF,[Rn(' Header '),Mn('div',QF,[Rn(' 装饰线 '),t[24]||(t[24]=Mn('div',{class:'header-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',XF,[Mn('div',YF,[t[21]||(t[21]=Mn('span',{class:'header-icon'},'👥',-1)),t[22]||(t[22]=Mn('h3',{class:'header-title'},'我的队伍',-1)),Mn('span',KF,oe(e.activeAllies.length)+'/'+oe(e.maxTeamSize),1)]),Mn('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[23]||(t[23]=[Mn('span',{class:'close-icon'},'✕',-1)])])])]),Rn(' Content '),Mn('div',JF,[Rn(' Detail Section '),e.selectedAlly?(yn(),Sn('div',ZF,[Rn(' Row 1: Avatar + Name + Info '),Mn('div',eH,[Rn(' Avatar (Clickable) '),En(l,{avatar:e.selectedAlly.avatar,name:e.selectedAlly.name,size:'lg',clickable:!0,class:'shrink-0 cursor-pointer transition-all hover:ring-2 hover:ring-[#5865f2]',title:'点击编辑头像',onClick:e.openAvatarEditor},null,8,['avatar','name','onClick']),Rn(' Info '),Mn('div',tH,[Mn('div',aH,[Mn('h4',sH,oe(e.selectedAlly.name),1),Rn(' 收藏星标 '),Mn('button',{class:ee(['shrink-0 text-base transition-all duration-200 hover:scale-110',e.selectedAlly.isStarred?'text-yellow-400':'text-gray-500 hover:text-yellow-300']),title:e.selectedAlly.isStarred?'取消收藏（解锁解散）':'收藏（锁定防止误解散）',onClick:t[1]||(t[1]=Cl((...t)=>e.toggleStar&&e.toggleStar(...t),['stop']))},oe(e.selectedAlly.isStarred?'⭐':'☆'),11,nH),Mn('span',{class:ee(['shrink-0 rounded px-1.5 py-0.5 text-[9px] font-medium md:text-[10px]',e.getAllyTypeClass(e.selectedAlly.allyType)])},oe(e.getAllyTypeName(e.selectedAlly.allyType)),3)]),Mn('div',rH,' Lv.'+oe(e.selectedAlly.level)+' '+oe(e.selectedAlly.race)+' · '+oe(e.selectedAlly.class),1),e.selectedAlly.relationship?(yn(),Sn('div',lH,' "'+oe(e.selectedAlly.relationship)+'" ',1)):Rn('v-if',!0)])]),Rn(' Row 2: Stats Bars '),Mn('div',oH,[Mn('div',null,[Mn('div',iH,[t[25]||(t[25]=Mn('span',{class:'text-red-400'},'HP',-1)),Mn('span',cH,oe(e.selectedAlly.stats.hp.current)+'/'+oe(e.selectedAlly.stats.hp.max),1)]),Mn('div',dH,[Mn('div',{class:'h-full bg-red-500 transition-all',style:X({width:e.getStatPercent(e.selectedAlly.stats.hp)+'%'})},null,4)])]),Mn('div',null,[Mn('div',uH,[t[26]||(t[26]=Mn('span',{class:'text-blue-400'},'MP',-1)),Mn('span',pH,oe(e.selectedAlly.stats.mp.current)+'/'+oe(e.selectedAlly.stats.mp.max),1)]),Mn('div',mH,[Mn('div',{class:'h-full bg-blue-500 transition-all',style:X({width:e.getStatPercent(e.selectedAlly.stats.mp)+'%'})},null,4)])]),Mn('div',null,[Mn('div',gH,[t[27]||(t[27]=Mn('span',{class:'text-yellow-400'},'SP',-1)),Mn('span',hH,oe(e.selectedAlly.stats.sp.current)+'/'+oe(e.selectedAlly.stats.sp.max),1)]),Mn('div',fH,[Mn('div',{class:'h-full bg-yellow-500 transition-all',style:X({width:e.getStatPercent(e.selectedAlly.stats.sp)+'%'})},null,4)])])]),Rn(' Row 3: Affinity Bar '),Mn('div',vH,[Mn('div',yH,[t[28]||(t[28]=Mn('span',{class:'text-pink-400'},'💕 好感度',-1)),Mn('span',bH,oe(e.selectedAlly.affinity),1)]),Mn('div',xH,[Mn('div',{class:ee(['h-full transition-all',e.getAffinityColorClass(e.selectedAlly.affinity)]),style:X({width:e.getAffinityBarWidth(e.selectedAlly.affinity)})},null,6)])]),Rn(' Row 4: Attributes Grid (5 rows × 2 columns) '),Mn('div',wH,[(yn(!0),Sn(pn,null,xs(e.sortedAttributes,(t,a)=>(yn(),Sn('div',{key:a,class:'flex items-center justify-between border-b border-[#36393f] py-0.5 last:border-b-0'},[Mn('span',kH,oe(e.getAttributeDisplayName(String(a))),1),Mn('span',SH,oe(t),1)]))),128))]),Rn(' Row 5: Action Buttons (2x2 grid on mobile, row on desktop) '),Mn('div',_H,[Mn('button',{class:'flex items-center justify-center gap-1 rounded bg-[#5865f2] px-3 py-2 text-xs font-medium text-white transition-colors hover:bg-[#4752c4] md:text-sm',onClick:t[2]||(t[2]=(...t)=>e.showAllyEquipment&&e.showAllyEquipment(...t))},' 🛡️ 装备 '),Mn('button',{class:'flex items-center justify-center gap-1 rounded bg-[#3ba55c] px-3 py-2 text-xs font-medium text-white transition-colors hover:bg-[#2d7d46] md:text-sm',onClick:t[3]||(t[3]=(...t)=>e.showAllySkills&&e.showAllySkills(...t))},' ⚔️ 技能 '),Mn('button',{class:'flex items-center justify-center gap-1 rounded bg-pink-600 px-3 py-2 text-xs font-medium text-white transition-colors hover:bg-pink-700 md:text-sm',onClick:t[4]||(t[4]=(...t)=>e.showAllyPrivateInfo&&e.showAllyPrivateInfo(...t))},' 🔞 私密 '),Mn('button',{class:ee(['flex items-center justify-center gap-1 rounded bg-[#ed4245] px-3 py-2 text-xs font-medium text-white transition-colors hover:bg-[#c03537] md:text-sm',{'cursor-not-allowed opacity-50':'npc'===e.selectedAlly.allyType||e.selectedAlly.isStarred}]),disabled:'npc'===e.selectedAlly.allyType||e.selectedAlly.isStarred,title:e.getDismissTitle(e.selectedAlly),onClick:t[5]||(t[5]=t=>e.canDismiss(e.selectedAlly)&&e.showDismissConfirm())},' 👋 解散 ',10,CH)])])):(yn(),Sn(pn,{key:1},[Rn(' Empty State '),t[29]||(t[29]=Mn('div',{class:'border-b border-[#202225] bg-[#2f3136] p-4'},[Mn('div',{class:'flex h-20 items-center justify-center text-sm text-gray-500 italic md:h-24'},' 选择一个队友查看详情 ')],-1))],2112)),Rn(' Ally List '),Mn('div',IH,[0===e.allies.length?(yn(),Sn('div',TH,' 暂无队友 ')):(yn(),Sn('div',AH,[(yn(!0),Sn(pn,null,xs(e.allies,a=>(yn(),Sn('div',{key:a.id,class:ee(['flex cursor-pointer items-center gap-2 rounded-lg border border-transparent p-2.5 transition-all hover:border-[#5865f2]/50 hover:bg-[#40444b] md:gap-3 md:p-3',{'border-[#5865f2] bg-[#5865f2]/10':e.selectedAllyId===a.id}]),onClick:t=>e.selectAlly(a.id),onContextmenu:Cl(t=>e.showContextMenu(t,a),['prevent']),onTouchstart:t=>e.handleTouchStart(t,a),onTouchend:t[6]||(t[6]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t)),onTouchmove:t[7]||(t[7]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Rn(' Avatar '),En(l,{avatar:a.avatar,name:a.name,size:'md',class:'shrink-0'},null,8,['avatar','name']),Rn(' Info '),Mn('div',EH,[Mn('div',$H,[Mn('span',DH,oe(a.name),1),Mn('span',{class:ee(['shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium md:text-xs',e.getAllyTypeClass(a.allyType)])},oe(e.getAllyTypeName(a.allyType)),3)]),Mn('div',PH,'Lv.'+oe(a.level)+' '+oe(a.class),1)]),Rn(' HP + Affinity '),Mn('div',NH,[Mn('div',RH,' ❤️ '+oe(Math.round(a.stats.hp.current/a.stats.hp.max*100))+'% ',1),Mn('div',{class:ee(['text-[10px] md:text-xs',e.getAffinityTextClass(a.affinity)])},' 💕 '+oe(a.affinity),3)]),Rn(' Arrow '),t[30]||(t[30]=Mn('div',{class:'shrink-0 text-gray-500'},[Mn('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})])],-1))],42,MH))),128))]))])]),Rn(' Footer '),Mn('div',jH,[t[34]||(t[34]=Mn('div',{class:'footer-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('div',LH,[Mn('span',BH,[t[31]||(t[31]=Mn('span',{class:'info-diamond'},'◆',-1)),Pn(' 队伍: '+oe(e.activeAllies.length)+'/'+oe(e.maxTeamSize)+' | 雇佣兵: '+oe(e.mercenaryCount)+' ',1),t[32]||(t[32]=Mn('span',{class:'info-diamond'},'◆',-1))]),Mn('button',{class:'footer-btn',onClick:t[8]||(t[8]=t=>e.$emit('close'))},[...t[33]||(t[33]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'关闭',-1)])])])])]),Rn(' Private Info Modal (for selected ally) '),En(o,{visible:e.showPrivateInfo,'private-info':e.selectedAlly?.private,gender:e.selectedAlly?.gender||'未知',appearance:e.selectedAlly?.appearance,onClose:t[9]||(t[9]=t=>e.showPrivateInfo=!1)},null,8,['visible','private-info','gender','appearance']),Rn(' Ally Equipment Modal '),En(i,{visible:e.showEquipment,ally:e.selectedAlly,'allow-unequip':!1,onClose:t[10]||(t[10]=t=>e.showEquipment=!1),onUnequipItem:e.handleUnequipItem},null,8,['visible','ally','onUnequipItem']),Rn(' Ally Skills Modal '),En(c,{visible:e.showSkills,skills:e.selectedAlly?.skills||{},'ally-name':e.selectedAlly?.name||'队友',onClose:t[11]||(t[11]=t=>e.showSkills=!1)},null,8,['visible','skills','ally-name']),Rn(' Avatar Editor Modal (for selected ally) '),En(d,{visible:e.showAvatarEditor,'current-avatar':e.selectedAlly?.avatar||'',title:`编辑 ${e.selectedAlly?.name||'队友'} 的头像`,onClose:t[12]||(t[12]=t=>e.showAvatarEditor=!1),onUpdateAvatar:e.saveAvatar},null,8,['visible','current-avatar','title','onUpdateAvatar']),Rn(' Dismiss Confirm Modal '),En(wr,{name:'modal-scale'},{default:ba(()=>[e.showDismissDialog?(yn(),Sn('div',{key:0,class:'dismiss-modal-backdrop',onClick:t[15]||(t[15]=Cl(t=>e.showDismissDialog=!1,['self']))},[Mn('div',OH,[t[39]||(t[39]=Mn('div',{class:'dismiss-header'},[Mn('span',{class:'dismiss-icon'},'⚠️'),Mn('h4',{class:'dismiss-title'},'确认解散')],-1)),t[40]||(t[40]=Mn('div',{class:'dismiss-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')],-1)),Mn('p',qH,[t[35]||(t[35]=Pn(' 确定要解散 ',-1)),Mn('span',UH,oe(e.selectedAlly?.name),1),t[36]||(t[36]=Pn(' 吗？ ',-1))]),t[41]||(t[41]=Mn('p',{class:'dismiss-warning'},'解散后，该队友将离开队伍。此操作不可撤销。',-1)),Mn('div',VH,[Mn('button',{class:'dismiss-btn cancel',onClick:t[13]||(t[13]=t=>e.showDismissDialog=!1)},[...t[37]||(t[37]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'取消',-1)])]),Mn('button',{class:'dismiss-btn confirm',onClick:t[14]||(t[14]=(...t)=>e.confirmDismiss&&e.confirmDismiss(...t))},[...t[38]||(t[38]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'确认解散',-1)])])])])])):Rn('v-if',!0)]),_:1}),Rn(' 右键/长按上下文菜单 '),En(wr,{name:'context-menu-fade'},{default:ba(()=>[e.contextMenuVisible?(yn(),Sn('div',{key:0,class:'context-menu fixed z-100 min-w-[140px] rounded-lg border border-[#40444b] bg-[#2f3136] py-1 shadow-xl',style:X({left:e.contextMenuPos.x+'px',top:e.contextMenuPos.y+'px'}),onClick:t[17]||(t[17]=Cl(()=>{},['stop']))},[Mn('button',{class:'flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-gray-300 hover:bg-[#40444b] hover:text-white',disabled:e.isAiCompleting,onClick:t[16]||(t[16]=(...t)=>e.handleAiComplete&&e.handleAiComplete(...t))},[t[42]||(t[42]=Mn('span',null,'🤖',-1)),Mn('span',null,oe(e.isAiCompleting?'信息补全中...':'信息补全'),1)],8,FH)],4)):Rn('v-if',!0)]),_:1}),Rn(' 点击遮罩层关闭菜单 '),e.contextMenuVisible?(yn(),Sn('div',{key:0,class:'context-menu-overlay',onClick:t[18]||(t[18]=(...t)=>e.hideContextMenu&&e.hideContextMenu(...t)),onContextmenu:t[19]||(t[19]=Cl((...t)=>e.hideContextMenu&&e.hideContextMenu(...t),['prevent']))},null,32)):Rn('v-if',!0)])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-7de01004']]),cz={class:'relative flex min-w-0 flex-1 flex-col bg-[#36393f]'},dz={class:'z-10 flex h-12 shrink-0 items-center border-b border-[#202225] bg-[#36393f] px-4 shadow-sm'},uz={class:'truncate font-bold text-white'},pz={class:'ml-auto flex items-center space-x-2'},mz={key:0,ref:'subHeaderRef',class:'z-10 shrink-0 border-b border-[#202225] bg-[#36393f] shadow-sm'},gz={class:'scrollbar-thin scrollbar-thumb-[#202225] scrollbar-track-transparent flex-1 overflow-y-auto'},hz={key:1,ref:'inputAreaRef',class:'shrink-0 bg-[#36393f] p-4'};const fz=Za({name:'ThreeColumnLayout',props:{showLeft:{type:Boolean,default:!1},showRight:{type:Boolean,default:!1},showOptions:{type:Boolean,default:!1},showSubHeaderDropdown:{type:Boolean,default:!1},hideInput:{type:Boolean,default:!1},hideSubHeader:{type:Boolean,default:!1},topSidebar:{type:String,default:null}},emits:['toggle-left','toggle-right','close-drawers','hover-left','hover-right','swipe-open-left','swipe-open-right','swipe-close-left','swipe-close-right','swipe-open-options','swipe-close-options','swipe-open-subheader','swipe-close-subheader'],setup(e,{emit:t}){const a=$t(null),s=$t(null),n=$t(null),r=$t(0),l=$t(0),o=$t(0),i=$t(!1),c=$t('center'),d=$t(!1),u=$t(!1);return{layoutRef:a,inputAreaRef:s,subHeaderRef:n,handleTouchStart:e=>{if(1!==e.touches.length)return;const t=e.touches[0],a=window.innerWidth;r.value=t.clientX,l.value=t.clientY,o.value=Date.now(),i.value=!0,d.value=(e=>{if(s.value){const t=s.value.getBoundingClientRect();return e>=t.top&&e<=t.bottom}return e>.85*window.innerHeight})(t.clientY),u.value=(e=>{if(n.value){const t=n.value.getBoundingClientRect();return e>=t.top&&e<=t.bottom+80}const t=window.innerHeight;return e>48&&e<.2*t})(t.clientY),t.clientX<.5*a?c.value='left':c.value='right'},handleTouchMove:t=>{if(!i.value||1!==t.touches.length)return;const a=t.touches[0],s=a.clientX-r.value,n=a.clientY-l.value,o=Math.abs(180*Math.atan2(n,s)/Math.PI),c=o>55&&o<125;(o<35||o>145)&&Math.abs(s)>15&&t.preventDefault(),c&&Math.abs(n)>15&&(d.value||e.showOptions||u.value||e.showSubHeaderDropdown)&&t.preventDefault()},handleTouchEnd:a=>{if(!i.value)return;const s=a.changedTouches[0],n=s.clientX-r.value,p=s.clientY-l.value,m=Date.now()-o.value;if(i.value=!1,m>400)return;const g=Math.abs(180*Math.atan2(p,n)/Math.PI),h=g<35||g>145;if(g>55&&g<125){const a=p<-60,s=p>60;return e.showOptions?void(s&&t('swipe-close-options')):e.showSubHeaderDropdown?void(a&&t('swipe-close-subheader')):a&&d.value?void t('swipe-open-options'):s&&u.value?void t('swipe-open-subheader'):void 0}if(!h)return;const f=n>60,v=n<-60;if(e.showLeft&&e.showRight)'left'===e.topSidebar?v&&t('swipe-close-left'):'right'===e.topSidebar&&f&&t('swipe-close-right');else if(e.showLeft&&!e.showRight&&v)t('swipe-close-left');else if(e.showRight&&!e.showLeft&&f)t('swipe-close-right');else if(!e.showLeft&&!e.showRight){if(f&&'left'===c.value)return void t('swipe-open-left');if(v&&'right'===c.value)return void t('swipe-open-right')}}}}}),vz=Za({name:'GameUI',components:{ThreeColumnLayout:(0,$u.A)(fz,[['render',function(e,t,a,s,n,r){return yn(),Sn('div',{ref:'layoutRef',class:'layout-root safe-area-padding relative flex h-full w-full overflow-hidden bg-[#36393f] font-sans text-gray-100',onTouchstart:t[5]||(t[5]=(...t)=>e.handleTouchStart&&e.handleTouchStart(...t)),onTouchmove:t[6]||(t[6]=(...t)=>e.handleTouchMove&&e.handleTouchMove(...t)),onTouchend:t[7]||(t[7]=(...t)=>e.handleTouchEnd&&e.handleTouchEnd(...t))},[Rn(' Hover Triggers (Desktop Only) '),Mn('div',{class:'fixed top-0 bottom-0 left-0 z-60 hidden w-4 md:block',onMouseenter:t[0]||(t[0]=t=>e.$emit('hover-left'))},null,32),Mn('div',{class:'fixed top-0 right-0 bottom-0 z-60 hidden w-4 md:block',onMouseenter:t[1]||(t[1]=t=>e.$emit('hover-right'))},null,32),Rn(' Mobile Backdrop - covers entire screen, click to close (mobile only) '),e.showLeft||e.showRight?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-40 bg-black/50 md:hidden',onClick:t[2]||(t[2]=t=>e.$emit('close-drawers'))})):Rn('v-if',!0),Rn(' Left Sidebar (Desktop & Mobile Drawer) '),Rn(' Max width limited to 85vw on mobile to leave click space '),Mn('aside',{class:ee(['flex flex-col border-r border-[#202225] bg-[#2f3136] transition-transform duration-300 ease-in-out md:relative md:flex',['fixed inset-y-0 left-0 z-50 w-[260px] max-w-[85vw] shadow-xl md:z-auto md:max-w-none md:shadow-none',e.showLeft?'translate-x-0':'-translate-x-full md:hidden']])},[ws(e.$slots,'left-sidebar',{},()=>[t[8]||(t[8]=Mn('div',{class:'p-4 text-center text-gray-500'},'左侧边栏',-1))],!0)],2),Rn(' Center Column (Main Content & Chat) '),Rn(' Always visible, takes up remaining space '),Mn('main',cz,[Rn(' Top Bar (Mobile Menu Trigger & Title) '),Mn('header',dz,[Mn('button',{class:'mr-4 text-gray-400 hover:text-white',onClick:t[3]||(t[3]=t=>e.$emit('toggle-left'))},[Rn(' Hamburger Icon '),t[9]||(t[9]=Mn('svg',{class:'h-6 w-6',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 6h16M4 12h16M4 18h16'})],-1))]),Mn('h1',uz,[ws(e.$slots,'header-title',{},()=>[t[10]||(t[10]=Pn('冒险日志',-1))],!0)]),Mn('div',pz,[ws(e.$slots,'header-actions',{},void 0,!0),Mn('button',{class:'text-gray-400 hover:text-white',onClick:t[4]||(t[4]=t=>e.$emit('toggle-right'))},[Rn(' Info Icon '),t[11]||(t[11]=Mn('svg',{class:'h-6 w-6',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'})],-1))])])]),Rn(' Sub Header (Fixed Scene Info) '),e.$slots['sub-header']&&!e.hideSubHeader?(yn(),Sn('div',mz,[ws(e.$slots,'sub-header',{},void 0,!0)],512)):Rn('v-if',!0),Rn(' Scrollable Content Area '),Mn('div',gz,[ws(e.$slots,'main-content',{},()=>[t[12]||(t[12]=Mn('div',{class:'mt-10 p-4 text-center text-gray-500'},'主要内容区域',-1))],!0)]),Rn(' Bottom Input Area (Fixed) '),e.hideInput?Rn('v-if',!0):(yn(),Sn('div',hz,[ws(e.$slots,'input-area',{},()=>[Rn(' Placeholder for input '),t[13]||(t[13]=Mn('div',{class:'rounded-lg bg-[#40444b] p-3 text-sm text-gray-400'},'输入区域占位符',-1))],!0)],512))]),Rn(' Right Sidebar (Desktop & Mobile Drawer) '),Rn(' Max width limited to 85vw on mobile to leave click space '),Mn('aside',{class:ee(['flex flex-col border-l border-[#202225] bg-[#2f3136] transition-transform duration-300 ease-in-out md:relative md:flex',['fixed inset-y-0 right-0 z-50 w-[300px] max-w-[85vw] shadow-xl md:z-auto md:max-w-none md:shadow-none',e.showRight?'translate-x-0':'translate-x-full md:hidden']])},[ws(e.$slots,'right-sidebar',{},()=>[t[14]||(t[14]=Mn('div',{class:'p-4 text-center text-gray-500'},'右侧边栏',-1))],!0)],2)],544)}],['__scopeId','data-v-a948f270']]),TaskBubble:Tw,InventoryModal:lT,EquipmentModal:jC,ChatArea:Qy,ChatInputModal:lb,AttackConfirmModal:qv,SceneObjectModal:hw,OptionSelector:sw,InputArea:lx,ActionModal:Dv,ItemDetailModal:Qx,GiftSelectModal:tx,SystemModal:xO,SystemSettings:zF,PlayerSidebar:cA,AttributesModal:kC,AvatarEditorModal:Ay,PrivateInfoModal:uM,DebugModal:KR,MapEditor:yS,MapViewer:qS,NodeMapViewer:z_,BattleView:If,PreBattleModal:bv,QuestsModal:HM,SkillsModal:UE,NotepadModal:Oj,BattleResultModal:iv,TeamModal:iz,RelationshipsModal:GB,FactionsModal:Mj,CommandQueueModal:Sb,ShopModal:z$,AdventureNotesModal:WD},emits:['return-title'],setup(e,{emit:t}){const a=$t(null),s=$t(!1),n=$t('加载中...');let r;const{alert:o,success:i,warning:c,danger:d}=Xp(),{showLeftDrawer:u,showRightDrawer:p,topSidebar:m,showQuickDrawer:g,showContextDetails:h,toggleLeftDrawer:f,openLeftDrawer:v,closeLeftDrawer:y,toggleRightDrawer:b,openRightDrawer:x,closeRightDrawer:w,closeDrawers:k,toggleQuickDrawer:S,openQuickDrawer:C,closeQuickDrawer:I,openSubHeaderDropdown:T,closeSubHeaderDropdown:A,handleDrawerTouchStart:M,handleDrawerTouchMove:E,handleDrawerTouchEnd:D,setupListeners:P,cleanupListeners:N}=function(){const e=$t(!1),t=$t(!1),a=$t(null),s=$t(!1),n=$t(!1);let r='undefined'!=typeof window?window.innerWidth:1024;const l=$t({y:0,time:0,startY:0,isOutsideDrawer:!1}),o=()=>{if('undefined'==typeof window)return;const a=window.innerWidth;r>=768&&a<768&&(e.value=!1,t.value=!1),r<768&&a>=768&&(e.value=!0,t.value=!0),r=a},i=()=>{'undefined'!=typeof document&&document.fullscreenElement&&'undefined'!=typeof window&&window.innerWidth>=768&&(e.value=!0,t.value=!0)};return{showLeftDrawer:e,showRightDrawer:t,topSidebar:a,showQuickDrawer:s,showContextDetails:n,toggleLeftDrawer:()=>{e.value=!e.value,e.value?a.value='left':t.value?a.value='right':a.value=null},openLeftDrawer:()=>{e.value||(e.value=!0,a.value='left')},closeLeftDrawer:()=>{e.value=!1,t.value?a.value='right':a.value=null},toggleRightDrawer:()=>{t.value=!t.value,t.value?a.value='right':e.value?a.value='left':a.value=null},openRightDrawer:()=>{t.value||(t.value=!0,a.value='right')},closeRightDrawer:()=>{t.value=!1,e.value?a.value='left':a.value=null},closeDrawers:()=>{e.value=!1,t.value=!1,a.value=null},toggleQuickDrawer:()=>{s.value=!s.value},openQuickDrawer:()=>{s.value=!0},closeQuickDrawer:()=>{s.value=!1},openSubHeaderDropdown:()=>{n.value=!0},closeSubHeaderDropdown:()=>{n.value=!1},handleDrawerTouchStart:e=>{const t=e.currentTarget,a=e.touches[0].clientY,s=a<t.getBoundingClientRect().top;l.value={y:a,time:Date.now(),startY:a,isOutsideDrawer:s}},handleDrawerTouchMove:e=>{if('undefined'!=typeof window&&window.innerWidth>=768)return;const t=e.touches[0].clientY-l.value.y>50;l.value.isOutsideDrawer&&t&&(s.value=!1)},handleDrawerTouchEnd:()=>{l.value={y:0,time:0,startY:0,isOutsideDrawer:!1}},setupListeners:()=>{'undefined'!=typeof window&&(o(),window.addEventListener('resize',o)),'undefined'!=typeof document&&document.addEventListener('fullscreenchange',i)},cleanupListeners:()=>{'undefined'!=typeof window&&window.removeEventListener('resize',o),'undefined'!=typeof document&&document.removeEventListener('fullscreenchange',i)}}}(),{getRelColor:R,locationDisplay:j,hasContextInfo:L,hasAnySceneInfo:B,displaySceneDesc:O,hasStructuredNpcs:q,displayNpcs:U,hasStructuredExits:V,displayExits:F,hasStructuredObjects:H,displayObjects:G,setupListeners:W,cleanupListeners:Q}=function(e){const t=$t('undefined'!=typeof window&&window.innerWidth<768),a=()=>{'undefined'!=typeof window&&(t.value=window.innerWidth<768)},s=e=>!!e&&(Array.isArray(e)?e.length>0:'object'==typeof e&&Object.keys(e).length>0),n=e=>e?Array.isArray(e)?e:'object'==typeof e?Object.values(e):[]:[],r=e=>e.filter(e=>'string'==typeof e?!e.trim().startsWith('//'):'object'!=typeof e||null===e||!('name'in e)||!String(e.name).trim().startsWith('//')),l=ir(()=>{const a=e.value?.scene?.locationPath;return a&&a.length>0?t.value&&a.length>3?a.slice(-3).join(' > '):a.join(' > '):e.value?.scene?.name?e.value.scene.name:'未知地点'}),o=ir(()=>{const t=e.value?.scene,a=e.value?.world?.environment;return s(t?.npcs)||s(t?.exits)||s(t?.objects)||(a?.exits?.length??0)>0||(a?.nearby_npcs?.length??0)>0||(a?.nearby_objects?.length??0)>0}),i=ir(()=>{const t=e.value?.scene,a=e.value?.world?.environment,s=t?.desc||a?.desc,n=o.value;return s||n}),c=ir(()=>e.value?.scene?.desc||e.value?.world?.environment?.desc||''),d=ir(()=>{const t=e.value?.scene?.npcs;if(!t)return!1;const a=n(t);return a.length>0&&'object'==typeof a[0]&&null!==a[0]&&'name'in a[0]}),u=ir(()=>{const t=e.value?.scene?.npcs;if(s(t))return r(n(t));const a=e.value?.world?.environment?.nearby_npcs||[];return r(a)}),p=ir(()=>{const t=e.value?.scene?.exits;if(!t)return!1;const a=n(t);return a.length>0&&'object'==typeof a[0]&&null!==a[0]&&'name'in a[0]}),m=ir(()=>{const t=e.value?.scene?.exits;if(s(t))return r(n(t));const a=e.value?.world?.environment?.exits||[];return r(a)}),g=ir(()=>{const t=e.value?.scene?.objects;if(!t)return!1;const a=n(t);return a.length>0&&'object'==typeof a[0]&&null!==a[0]&&'name'in a[0]}),h=ir(()=>{const t=e.value?.scene?.objects;if(s(t))return r(n(t));const a=e.value?.world?.environment?.nearby_objects||[];return r(a)});return{isMobile:t,hasContent:s,toArray:n,filterComments:r,getRelColor:e=>{if('string'==typeof e){const t=e.toLowerCase();return t.includes('友好')||t.includes('友善')?'text-green-400':t.includes('敌对')||t.includes('敌意')?'text-red-400':'text-gray-400'}const t=e??0;return t>=80?'text-pink-400':t>=50?'text-green-400':t>=20?'text-blue-400':t>=0?'text-gray-400':t>=-30?'text-orange-400':'text-red-400'},locationDisplay:l,hasContextInfo:o,hasAnySceneInfo:i,displaySceneDesc:c,hasStructuredNpcs:d,displayNpcs:u,hasStructuredExits:p,displayExits:m,hasStructuredObjects:g,displayObjects:h,setupListeners:()=>{'undefined'!=typeof window&&(a(),window.addEventListener('resize',a))},cleanupListeners:()=>{'undefined'!=typeof window&&window.removeEventListener('resize',a)}}}(a),{showChatInputModal:X,chatInputConfig:Y,handleChatInputConfirm:K,showAttackConfirmModal:J,attackConfirmConfig:Z,showGiftSelectModal:ee,giftSelectConfig:te,handleGiftConfirm:ae,showSceneObjectModal:se,selectedSceneObject:ne,handleObjectClick:re,handleSceneObjectInteract:le,handleSceneObjectObserve:oe,initialSelectedNpcName:ie,showSceneNpcsInRelationship:ce,handleNpcClick:de,clearNpcSelection:ue,handleRelationshipAction:pe,handleExitClick:me,handleExitClickSimple:ge}=function(e){const t=$t(!1),a=$t({title:'交谈',action:'chat',targetName:'',targetId:'',isSceneNpc:!1,message:'',quickPhrases:[]}),s=$t(!1),n=$t({targetName:'',targetId:'',isSceneNpc:!1}),r=$t(!1),l=$t({targetName:'',targetId:'',isSceneNpc:!1}),o=$t(!1),i=$t(null),c=$t(null),d=$t(!1),u=()=>{const t=Ll.serviceLocator.get('CommandQueueService'),a=e.value?.player?.base?.name||'玩家';return t.setPlayerName(a),t};return{showChatInputModal:t,chatInputConfig:a,handleChatInputConfirm:e=>!!e.message.trim()&&(u().addCommand({type:'chat'===e.action?Vo.CHAT:Vo.FLIRT,targetName:e.targetName,targetId:e.targetId,isSceneNpc:e.isSceneNpc,message:e.message}),t.value=!1,!0),closeChatInputModal:()=>{t.value=!1},showAttackConfirmModal:s,attackConfirmConfig:n,closeAttackConfirmModal:()=>{s.value=!1},showGiftSelectModal:r,giftSelectConfig:l,handleGiftConfirm:e=>{u().addGiftCommand(e.targetName,e.targetId||void 0,e.isSceneNpc,e.giftInfo),r.value=!1},closeGiftSelectModal:()=>{r.value=!1},showSceneObjectModal:o,selectedSceneObject:i,handleObjectClick:e=>{i.value={name:e.name||e,brief:e.brief,interactable:e.interactable},o.value=!0},handleSceneObjectInteract:e=>{u().addInteractCommand(e),o.value=!1,i.value=null},handleSceneObjectObserve:e=>(o.value=!1,i.value=null,`[观察: ${e.name}]`),closeSceneObjectModal:()=>{o.value=!1,i.value=null},initialSelectedNpcName:c,showSceneNpcsInRelationship:d,handleNpcClick:e=>(c.value=e.name,d.value=!0,{name:e.name,showSceneNpcs:!0,simpleMode:!0}),clearNpcSelection:()=>{c.value=null,d.value=!1},handleRelationshipAction:e=>{const o=u();switch(e.action){case'chat':case'flirt':a.value={title:'chat'===e.action?'交谈':'💕 调情',action:e.action,targetName:e.targetName,targetId:e.targetId||'',isSceneNpc:e.isSceneNpc,message:'',quickPhrases:'chat'===e.action?['你好','再见','请问...','我想要...','能告诉我更多吗？']:['你今天看起来真好看','能和你单独聊聊吗？','我一直在注意你...']},t.value=!0;break;case'gift':l.value={targetName:e.targetName,targetId:e.targetId||'',isSceneNpc:e.isSceneNpc},r.value=!0;break;case'invite':o.addCommand({type:Vo.INVITE,targetName:e.targetName,targetId:e.targetId,isSceneNpc:e.isSceneNpc});break;case'spar':o.addCommand({type:Vo.SPAR,targetName:e.targetName,targetId:e.targetId,isSceneNpc:e.isSceneNpc});break;case'attack':n.value={targetName:e.targetName,targetId:e.targetId||'',isSceneNpc:e.isSceneNpc},s.value=!0}},handleExitClick:e=>{const t=u(),a={name:e.name||e,direction:e.direction,locked:e.locked,condition:e.condition};t.addTravelCommand(a)},handleExitClickSimple:e=>{u().addCommand({type:Vo.MOVE,targetName:e,isSceneNpc:!1})}}}(a),{showPreBattle:he,preBattleEnemies:fe,showBattleResult:ve,battleResultType:ye,battleSettlement:be,isInCombat:xe,handleStartBattle:we,handleFleeBattle:ke,startBattleWithPendingEnemy:Se,findMatchingPendingEnemy:_e,removePendingEnemy:Ce,convertPendingToCombatants:Ie,handleCombatEnd:Te,closeBattleResult:Ae,handleBattleRetry:Me,handleBattleContinue:Ee}=function(e){const t=$t(!1),a=$t([]),s=$t(!1),n=$t('win'),r=$t(null),l=$t([]),o=ir(()=>!!e.value?.combat),i=e=>{const t=Ll.serviceLocator.get('SaveService').getGameState();if(!t)return null;if(t.pendingEnemies)for(const a of Object.keys(t.pendingEnemies)){const s=t.pendingEnemies[a];if(s?.linkedNpcNames?.includes(e)&&!s.defeated)return s}return t.pendingEnemy?.linkedNpcNames?.includes(e)&&!t.pendingEnemy.defeated?t.pendingEnemy:null},c=e=>e.enemies.map(e=>({id:e.id,name:e.name,type:'enemy',isPlayer:!1,level:e.level,base:{name:e.name,level:e.level},stats:e.stats,attributes:e.attributes,skills:e.skills||{},equipment:{},statusEffects:[],shields:[],isDead:!1,statModifiers:{},isStunned:!1,hasActed:!1,loot:e.loot})),d=async(e,t,a)=>{const s=Ll.serviceLocator.get('ToolAIService'),n=Ll.serviceLocator.get('SaveService'),r=Ll.serviceLocator.get('BattleService'),l=n.getGameState();if(!l)throw new Error('无法获取游戏状态');const o=`[系统指令] 玩家在战斗中额外攻击场景NPC "${e}"，请根据 scene.npcs 中该NPC的信息生成敌人战斗数据。设置 immediate: true，输出 <enemy> 标签。`,d=await s.process({storyOutput:`<content>玩家在战斗中向${e}发起了攻击。</content>`,userInput:`[攻击 ${e}]`,recentDialogs:[],offlineActions:[],gameState:l,additionalInstructions:o});if(!d.enemy){const e=d.errors?.join(', ')||'工具AI未返回敌人数据';throw new Error(e)}{const t=i(e);if(t){const e=c(t);r.addEnemies(e)}}};return{showPreBattle:t,preBattleEnemies:a,showBattleResult:s,battleResultType:n,battleSettlement:r,lastBattleEnemies:l,isInCombat:o,handleStartBattle:()=>{t.value=!1,Ll.serviceLocator.get('BattleService').startBattle(a.value)},handleFleeBattle:()=>(t.value=!1,'[避开战斗]'),startBattleWithPendingEnemy:async e=>{const t=Ll.serviceLocator.get('BattleService'),a=c(e);t.startBattle(a)},generateEnemyAndStartBattle:async(e,t,a)=>{let s,n,r;try{s=Ll.serviceLocator.get('BackgroundTaskService');const t=s.createTask(Rl.ENEMY_GENERATE,`生成 ${e} 数据`);n=t.taskId,r=t.abortController,s.startTask(n)}catch{console.log('[useBattleCommands] BackgroundTaskService not available')}try{const t=Ll.serviceLocator.get('ToolAIService'),a=Ll.serviceLocator.get('SaveService').getGameState();if(!a)throw new Error('无法获取游戏状态');const l=`[系统指令] 玩家决定攻击场景NPC "${e}"，请根据 scene.npcs 中该NPC的信息生成敌人战斗数据。设置 immediate: true，输出 <enemy> 标签。`,o=await t.process({storyOutput:`<content>玩家向${e}发起了攻击。</content>`,userInput:`[攻击 ${e}]`,recentDialogs:[],offlineActions:[],gameState:a,additionalInstructions:l},r?.signal);if(!o.enemy){const e=o.errors?.join(', ')||'工具AI未返回敌人数据';throw console.error('[useBattleCommands] Tool AI failed to generate enemy:',e),s&&n&&s.setTaskError(n,e),new Error(e)}console.log('[useBattleCommands] Tool AI generated enemy data:',o.enemy),s&&n&&s.completeTask(n)}catch(e){throw console.error('[useBattleCommands] Failed to generate enemy:',e),e}},addEnemyToCombat:async(e,t,a)=>{try{const s=Ll.serviceLocator.get('BattleService'),n=i(e);if(n){const e=c(n);return s.addEnemies(e)>0}return await d(e,t,a),!0}catch(e){return console.error('[useBattleCommands] Failed to add enemy to combat:',e),!1}},findMatchingPendingEnemy:i,removePendingEnemy:t=>{const a=Ll.serviceLocator.get('SaveService'),s=a.getGameState();s&&(s.pendingEnemies&&s.pendingEnemies[t]&&(delete s.pendingEnemies[t],console.log(`[useBattleCommands] Removed pending enemy: ${t}, remaining: ${Object.keys(s.pendingEnemies).length}`)),s.pendingEnemy?.encounter_id===t&&(s.pendingEnemy=void 0),e.value&&(e.value.pendingEnemies&&delete e.value.pendingEnemies[t],e.value.pendingEnemy?.encounter_id===t&&(e.value.pendingEnemy=void 0)),a.saveData())},convertPendingToCombatants:c,handleCombatEnd:e=>{console.log('[useBattleCommands] Combat ended:',e.result,e.settlement),e.enemies&&(l.value=e.enemies),'debug_exit'!==e.result&&(n.value=e.result,r.value=e.settlement||null,s.value=!0)},closeBattleResult:()=>{s.value=!1,r.value=null},handleBattleRetry:()=>{if(s.value=!1,l.value.length>0){const e=l.value.map(e=>({...e,isDead:!1,stats:{...e.stats,hp:{current:e.stats.hp.max,max:e.stats.hp.max},mp:e.stats.mp?{current:e.stats.mp.max,max:e.stats.mp.max}:void 0,sp:e.stats.sp?{current:e.stats.sp.max,max:e.stats.sp.max}:void 0},statusEffects:[],shields:[]})),t=Ll.serviceLocator.get('SaveService').getGameState();t?.player&&(t.player.stats.hp.current=t.player.stats.hp.max,t.player.stats.mp.current=t.player.stats.mp.max,t.player.stats.sp.current=t.player.stats.sp.max,t.player.statusEffects=[],t.player.shields=[]),Ll.serviceLocator.get('BattleService').startBattle(e)}},handleBattleContinue:()=>{s.value=!1;const e=Ll.serviceLocator.get('SaveService'),t=e.getGameState();t?.player&&(t.player.stats.hp.current=1,t.player.stats.mp.current=1,t.player.stats.sp.current=1,t.player.statusEffects=[],t.player.shields=[],e.saveData())}}}(a),{showEquipmentDetail:$e,selectedEquipmentItem:De,selectedEquipmentSlot:Pe,handleEquipItem:Ne,handleUnequipItem:Re,handleEquipmentUnequip:je,handleUnequipAll:Le,handleShowEquipmentDetailFromPanel:Be,handleEquipmentDiscard:Oe,closeEquipmentDetail:qe,createDiscardItemAction:Ue}=Yp(a),Ve=$t(!1),Fe=$t(!1),He=$t(!1),Ge=$t(!1),ze=$t('menu'),We=$t(!1),Qe=$t(!1),Xe=$t(!1),Ye=$t(!1),Ke=$t(!1),Je=$t(!1),Ze=$t(!1),et=$t(!1),tt=$t(!1),at=$t(!1),st=$t(!1),nt=$t(!1),rt=$t(!1),lt=$t(null),ot=$t(!1),it=$t(!1),ct=$t(!1),dt=$t(null),ut=$t(!1),pt=$t(''),mt=$t(!1),gt=$t(!1),ht=$t(!1),{count:ft}=Xo(),vt=$t(''),yt=$t(null),bt=$t(!1),xt=$t({title:'',message:'',confirmText:'',cancelText:'',item:null,isDestructive:!1,actions:[],onConfirm:()=>{}}),wt=$t(0),kt=$t(null),St=()=>{const e=Ll.serviceLocator.get('SaveService').getGameState();e?(a.value={...e,combat:e.combat?{...e.combat}:void 0,inventory:{...e.inventory,items:{...e.inventory.items}},player:{...e.player,equipment:{...e.player.equipment},stats:{hp:{...e.player.stats.hp},mp:{...e.player.stats.mp},sp:{...e.player.stats.sp}},statModifiers:{...e.player.statModifiers||{}}},skills:{...e.skills||{}},allies:Object.keys(e.allies||{}).reduce((t,a)=>(t[a]={...e.allies[a]},t),{})},console.log('[GameUI] State updated. In combat:',!!a.value.combat,'HP:',a.value.player?.stats?.hp?.current)):a.value=null},_t=()=>Fe.value=!Fe.value,Ct=ir(()=>!1!==a.value?.world?.canUseWorldMap),It=ir(()=>xe.value?'战斗中无法使用地图':Ct.value?'打开世界地图':'当前无法使用世界地图（被限制自由）'),Tt=e=>{if(vt.value!==e){vt.value=e;const t=e.match(/<battle_request>([\s\S]*?)<\/battle_request>/);if(t)try{const e=JSON.parse(t[1]);Array.isArray(e)&&e.length>0&&(fe.value=e,he.value=!0)}catch(e){console.error('Failed to parse battle request',e)}}},At=ir(()=>{if(!a.value?.player)return null;const e=a.value.player;return{name:e.base?.name||'',race:e.base?.race,class:e.base?.class,gender:e.base?.gender,appearance:e.appearance||e.base?.status_desc,private:e.private}}),Mt=ir(()=>{if(!a.value?.player)return null;const e=a.value.player;return{id:'player',name:e.base?.name||'玩家',type:'player',isPlayer:!0,level:e.base?.level||1,base:e.base||{},stats:e.stats||{hp:{current:100,max:100}},attributes:e.attributes||{},equipment:e.equipment||{},skills:{},statusEffects:e.statusEffects||[],shields:e.shields||[],isDead:e.stats?.hp?.current<=0,statModifiers:{},isStunned:!1,hasActed:!1}}),Et=ir(()=>a.value?.allies?Object.values(a.value.allies).filter(e=>e.isActive&&e.isAvailable).map(e=>({id:e.id,name:e.name,type:'ally',isPlayer:!1,isAlly:!0,allyType:e.allyType,level:e.level||1,base:{name:e.name,race:e.race,class:e.class,level:e.level,avatar:e.avatar,gender:e.gender},stats:e.stats||{hp:{current:50,max:50},mp:{current:30,max:30},sp:{current:40,max:40}},attributes:e.attributes||{},equipment:e.equipment||{},skills:e.skills||{},statusEffects:e.statusEffects||[],shields:e.shields||[],isDead:e.stats?.hp?.current<=0,statModifiers:e.statModifiers||{},isStunned:!1,hasActed:!1})):[]),Dt=e=>{a.value.world||(a.value.world={}),a.value.world.playerPos=e},Pt=(e,t)=>{const s=!1!==t.params?.oneTime;if(a.value.world||(a.value.world={}),a.value.world.openedChests||(a.value.world.openedChests=[]),s&&!a.value.world.openedChests.includes(e)){a.value.world.openedChests.push(e);const t=Ll.serviceLocator.get('SaveService'),s=t.getGameState();s?.world&&(s.world.openedChests=a.value.world.openedChests,t.saveData())}t.params?.itemRewards&&t.params.itemRewards.forEach(e=>{console.log(`[GameUI] 获得物品: ${e.itemId} x${e.count||1}`)}),Nt(`[打开宝箱: ${e}]`),Je.value=!1},Nt=e=>{yt.value&&(yt.value.inputText=e)},Rt=async e=>{const t=Ll.serviceLocator.get('SaveService'),s=t.getGameState();if(!s||!s.world)return;const n=s.world.currentMapId;s.world.previousMapId=n,s.world.currentMapId=e;let r=50,l=50;const o=Jp[e];if(o&&o.mapData){const e=o.mapData;let t='默认出生点';if(n){const a=e.events?.find(e=>e.id.includes(`传送至${n}`));a&&(t=a.id)}const a=e.events?.find(e=>e.id===t)||e.events?.find(e=>'默认出生点'===e.id);if(a&&a.at&&a.at.length>0){const e=a.at[0];2===e.length?(r=e[0],l=e[1]):4===e.length&&(r=Math.floor(e[0]+e[2]/2),l=Math.floor(e[1]+e[3]/2))}}s.world.playerPos={x:r,y:l},a.value?.world&&(a.value.world.currentMapId=e,a.value.world.previousMapId=n,a.value.world.playerPos={x:r,y:l}),s.world.pendingContext||(s.world.pendingContext=[]);const i=o?.name||e;s.world.pendingContext.push(`[系统: 玩家移动至 ${i}]`),t.saveData()},jt=e=>{if('win'===e.result&&e.enemies){const t=Ll.serviceLocator.get('SaveService'),a=t.getGameState();a&&a.pendingEnemies&&(e.enemies.forEach(e=>{for(const t of Object.keys(a.pendingEnemies)){const s=a.pendingEnemies[t];s?.linkedNpcNames?.includes(e.name)&&(s.defeated=!0,console.log(`[GameUI] Marked enemy as defeated: ${e.name} (${t})`))}}),t.saveData())}Te(e),St()},Lt=async e=>{if(mt.value)return;const t=e?.messageId;console.log('[GameUI] Starting story reroll...',t?`messageId: ${t}`:'latest'),mt.value=!0,r.emit('chat:sending');try{const e=Ll.serviceLocator.get('LLMService');await e.regenerateStory(t),St(),r.emit('chat:received')}catch(e){const t=e instanceof Error?e.message:String(e);e instanceof Error&&'AbortError'===e.name||t.toLowerCase().includes('abort')||t.toLowerCase().includes('cancel')||t.toLowerCase().includes('stop')||t.toLowerCase().includes('interrupt')||t.includes('已停止')||t.includes('已取消')||t.includes('已中断')?(console.log('[GameUI] Story reroll cancelled by user'),r.emit('chat:received')):(console.error('[GameUI] Story reroll failed:',e),r.emit('chat:error'),await o('重roll失败',t))}finally{mt.value=!1}},Bt=async e=>{if(!mt.value){console.log('[GameUI] Starting user message resend...',`messageId: ${e.messageId}`),mt.value=!0;try{const t=Ll.serviceLocator.get('LLMService');await t.regenerateStory(e.messageId),St(),r.emit('chat:received')}catch(e){const t=e instanceof Error?e.message:String(e);e instanceof Error&&'AbortError'===e.name||t.toLowerCase().includes('abort')||t.toLowerCase().includes('cancel')||t.toLowerCase().includes('stop')||t.toLowerCase().includes('interrupt')||t.includes('已停止')||t.includes('已取消')||t.includes('已中断')?(console.log('[GameUI] User message resend cancelled by user'),r.emit('chat:received')):(console.error('[GameUI] User message resend failed:',e),r.emit('chat:error'),await o('重发失败',t))}finally{mt.value=!1}}},Ot=async(e,t,a)=>{s.value=!0,n.value=`正在将 ${e} 加入战斗...`;try{const s=Ll.serviceLocator.get('BattleService'),n=_e(e);if(n){console.log('[GameUI] Adding pending enemy to combat:',n.encounter_id);const t=n.enemies.map(e=>({id:e.id,name:e.name,type:'enemy',isPlayer:!1,level:e.level,base:{name:e.name,level:e.level},stats:e.stats,attributes:e.attributes,skills:e.skills.map(e=>({id:e.id,name:e.name,type:'active',tier:1,effects:[]})),equipment:{},statusEffects:[],shields:[],isDead:!1,statModifiers:{},isStunned:!1,hasActed:!1,loot:e.loot}));s.addEnemies(t)>0?await i('敌人加入',`${e} 加入了战斗！`):await c('无法添加',`${e} 已经在战斗中了！`)}else await qt(e,t,a)}catch(t){console.error('[GameUI] Failed to add enemy to combat:',t),await o('添加失败',`无法将 "${e}" 加入战斗，请稍后再试。`)}finally{s.value=!1,n.value='加载中...'}},qt=async(e,t,a)=>{try{const t=Ll.serviceLocator.get('ToolAIService'),a=Ll.serviceLocator.get('SaveService'),s=Ll.serviceLocator.get('BattleService');if(!a.getGameState())throw new Error('无法获取游戏状态');const n=`[系统指令] 玩家在战斗中额外攻击场景NPC "${e}"，请根据 scene.npcs 中该NPC的信息生成敌人战斗数据。设置 immediate: true，输出 <enemy> 标签。`,r=await t.processWithContext(`<content>玩家在战斗中向${e}发起了攻击。</content>`,`[攻击 ${e}]`,void 0,n);if(r.enemy){console.log('[GameUI] Tool AI generated enemy data for combat add:',r.enemy);const t=_e(e);if(t){const a=t.enemies.map(e=>({id:e.id,name:e.name,type:'enemy',isPlayer:!1,level:e.level,base:{name:e.name,level:e.level},stats:e.stats,attributes:e.attributes,skills:e.skills.map(e=>({id:e.id,name:e.name,type:'active',tier:1,effects:[]})),equipment:{},statusEffects:[],shields:[],isDead:!1,statModifiers:{},isStunned:!1,hasActed:!1,loot:e.loot}));s.addEnemies(a)>0&&await i('敌人加入',`${e} 加入了战斗！`)}}else{const t=r.errors?.join(', ')||'工具AI未返回敌人数据';console.error('[GameUI] Tool AI failed to generate enemy for combat add:',t),await o('生成失败',`无法为 "${e}" 生成战斗数据：${t}`)}}catch(e){throw console.error('[GameUI] Failed to generate and add enemy:',e),e}},Ut=async(e,t,a)=>{let r,l;try{r=Ll.serviceLocator.get('BackgroundTaskService');l=r.createTask(Rl.ENEMY_GENERATE,`生成 ${e} 数据`).taskId,r.startTask(l)}catch{console.log('[GameUI] BackgroundTaskService not available, using loading overlay'),s.value=!0,n.value=`正在生成 ${e} 的战斗数据...`}try{const t=Ll.serviceLocator.get('ToolAIService'),a=Ll.serviceLocator.get('SaveService');if(!a.getGameState())throw new Error('无法获取游戏状态');const s=`[系统指令] 玩家决定攻击场景NPC "${e}"，请根据 scene.npcs 中生成**所有NPC(不仅限于玩家攻击对象)**的信息 按阵营生成敌人小队战斗数据。将玩家攻击的敌人小队设置 immediate: true，其他敌人小队设置为 immediate: false（以便玩家攻击时可以立即调用）。输出 <enemy> 标签。`,n=await t.processWithContext(`<content>玩家向${e}发起了攻击。</content>`,`[攻击 ${e}]`,void 0,s);if(n.enemy){if(console.log('[GameUI] Tool AI generated enemy data:',n.enemy),!n.enemy.immediate){const t=_e(e);t&&await Se(t)}r&&l&&r.completeTask(l)}else{const t=n.errors?.join(', ')||'工具AI未返回敌人数据';console.error('[GameUI] Tool AI failed to generate enemy:',t),await o('生成失败',`无法为 "${e}" 生成战斗数据：${t}`),r&&l&&r.setTaskError(l,t)}}catch(t){console.error('[GameUI] Failed to generate enemy:',t);const a=t instanceof Error?t.message:String(t);await o('生成失败',`无法为 "${e}" 生成战斗数据，请稍后再试。`),r&&l&&r.setTaskError(l,a)}finally{r||(s.value=!1,n.value='加载中...')}},Vt=e=>{if(!a.value?.pendingEnemies)return!1;for(const t of Object.keys(a.value.pendingEnemies)){const s=a.value.pendingEnemies[t];if(s?.linkedNpcNames?.includes(e)&&s.defeated)return!0}return!1};return us(async()=>{await ec.getInstance().init(),r=Ll.serviceLocator.get('EventBus'),r.on('state:updated',St),r.on('inventory:updated',St),r.on('equipment:updated',St),r.on('chat:latest-message',Tt),r.on('combat:start',St),r.on('combat:turn_start',St),r.on('combat:unit_turn',St),r.on('combat:end',jt),r.on('combat:state_update',St),r.on('combat:unit_turn_start',St),r.on('combat:unit_turn_end',St),r.on('battle:pre_battle_trigger',e=>{const t=Ie(e.pendingEnemy);fe.value=t,he.value=!0}),r.on('battle:pre_battle_trigger',e=>{const t=Ie(e.pendingEnemy);fe.value=t,he.value=!0}),r.on('chat:regenerate',Lt),r.on('chat:resend',Bt),r.on('toolai:completed',St),r.on('imagegen:completed',St),St(),P(),W()}),gs(()=>{r&&(r.off('state:updated',St),r.off('inventory:updated',St),r.off('equipment:updated',St),r.off('chat:latest-message',Tt),r.off('combat:start',St),r.off('combat:turn_start',St),r.off('combat:unit_turn',St),r.off('combat:end',jt),r.off('combat:state_update',St),r.off('combat:unit_turn_start',St),r.off('combat:unit_turn_end',St),r.off('chat:regenerate',Lt),r.off('chat:resend',Bt),r.off('toolai:completed',St),r.off('imagegen:completed',St)),N(),Q()}),{gameState:a,isLoading:s,loadingText:n,locationDisplay:j,showLeftDrawer:u,showRightDrawer:p,topSidebar:m,toggleLeftDrawer:f,toggleRightDrawer:b,openLeftDrawer:v,openRightDrawer:x,closeLeftDrawer:y,closeRightDrawer:w,closeDrawers:k,showInventory:Ve,toggleInventory:()=>Ve.value=!Ve.value,showEquipment:Fe,toggleEquipment:_t,isInCombat:xe,canUseWorldMap:Ct,worldMapTooltip:It,handleToggleEquipment:async()=>{xe.value?await c('无法操作','战斗中无法更换装备'):_t()},handleToggleNodeMap:async()=>{xe.value?await c('无法操作','战斗中无法使用地图'):Ze.value=!0},handleToggleWorldMap:async()=>{xe.value?await c('无法操作','战斗中无法使用地图'):Ct.value?Je.value=!0:await c('无法操作','你目前无法独自离开当前位置。')},handleNodeMapTravel:e=>{console.log('[GameUI] Node map travel:',e),Ze.value=!1,Nt(`[前往: ${e.target}]`)},handleToggleShop:async()=>{if(xe.value)return void await c('无法操作','战斗中无法访问商城');const e=Ll.serviceLocator.get('SaveService').getGameState();e?.currentShop?(lt.value=e.currentShop,rt.value=!0):await o('没有商店','当前没有可用的商店。请在剧情中与商人互动后再试。')},showShopModal:rt,currentShop:lt,handleShopBuy:async e=>{const t=Ll.serviceLocator.get('InventoryService'),s=Ll.serviceLocator.get('SaveService'),n=a.value?.inventory?.wallet;if(!n||n.ledger<e.price)return void await c('余额不足','你的金币不够购买这件物品。');n.ledger-=e.price;const r=lt.value?.items?.[e.itemId];if(r){-1!==r.stock&&r.stock>0&&(r.stock-=e.quantity);const{price:a,stock:s,...n}=r;t.addItem({...n,count:e.quantity,value:a}),await i('购买成功',`成功购买了 ${e.itemName} x${e.quantity}`)}s.saveData(),St()},handleShopSell:async e=>{const t=Ll.serviceLocator.get('InventoryService'),s=Ll.serviceLocator.get('SaveService');t.removeItem(e.itemId,e.quantity);const n=a.value?.inventory?.wallet;n&&(n.ledger+=e.price),await i('出售成功',`成功出售了 ${e.itemName} x${e.quantity}，获得 ${e.price} 铜币`),s.saveData(),St()},playerCharacterInfo:At,playerAsCombatant:Mt,alliesAsCombatants:Et,showQuickDrawer:g,toggleQuickDrawer:S,openQuickDrawer:C,closeQuickDrawer:I,openSubHeaderDropdown:()=>{L.value&&T()},closeSubHeaderDropdown:A,toggleFullscreen:()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()},handleUseItem:async(e,t,a)=>{if(!e)return;if(xe.value&&'consumable'===e.type){const a=Ll.serviceLocator.get('BattleService');if(await a.useItemFromInventory(e,t||'player'))return Ve.value=!1,u.value=!1,void(m.value=p.value?'right':null)}const s=Ll.serviceLocator.get('InventoryService');await s.useItem(e.id,t||'player',a||1)},handleEquipItem:Ne,handleUnequipItem:Re,handleUnequipAll:Le,handleShowEquipmentDetailFromPanel:Be,handleDiscardItem:e=>{const t=Ue(e);xt.value=t,bt.value=!0},handleNameClick:()=>{wt.value++,kt.value&&clearTimeout(kt.value),kt.value=setTimeout(()=>{wt.value=0},2e3),wt.value>=5&&(yt.value&&(pt.value=yt.value.inputText||''),He.value=!0,wt.value=0,kt.value&&(clearTimeout(kt.value),kt.value=null))},showDebug:He,showSystemModal:Ge,showAttributesModal:We,showActionModal:bt,actionConfig:xt,handleModalConfirm:()=>{xt.value.onConfirm&&xt.value.onConfirm()},handleEnhanceAttribute:e=>{a.value?.player?.base?.points&&a.value.player.base.points>0&&(a.value.player.base.points--,void 0!==a.value.player.attributes[e]&&a.value.player.attributes[e]++)},handleBatchEnhanceAttributes:e=>{if(!a.value?.player)return;const t=Object.values(e).reduce((e,t)=>e+t,0);if(t>(a.value.player.base.points||0))return void console.warn('[GameUI] Not enough points for batch enhance');for(const[t,s]of Object.entries(e))void 0!==a.value.player.attributes[t]&&(a.value.player.attributes[t]+=s);a.value.player.base.points-=t;Ll.serviceLocator.get('SaveService').saveData(),St()},showAvatarModal:Qe,showPrivateInfoModal:Xe,showMapEditor:Ye,showMapViewer:Je,showNodeMap:Ze,showSkillsModal:et,showQuestsModal:tt,showNotepadModal:at,showAdventureNotesModal:st,showTeamModal:nt,showRelationshipsModal:ot,showFactionsModal:it,showSystemSettings:Ke,showContextDetails:h,hasContextInfo:L,hasAnySceneInfo:B,displaySceneDesc:O,hasStructuredNpcs:q,displayNpcs:U,hasStructuredExits:V,displayExits:F,hasStructuredObjects:H,displayObjects:G,getRelColor:R,handleNpcClick:e=>{de(e),ot.value=!0},handleExitClick:e=>{me(e),h.value=!1},handleExitClickSimple:e=>{ge(e),h.value=!1},handleObjectClick:e=>{re(e),h.value=!1},initialSelectedNpcName:ie,showSceneNpcsInRelationship:ce,handleCloseRelationshipsModal:()=>{ot.value=!1,ue()},handleRelationUpdate:e=>{if(e?.characters){const t=Ll.serviceLocator.get('SaveService'),a=t.getGameState();if(a?.allies){for(const t in e.characters){const s=e.characters[t];if(s.linkedAllyId&&a.allies[s.linkedAllyId]){const e=a.allies[s.linkedAllyId];s.avatar&&e.avatar!==s.avatar&&(a.allies[s.linkedAllyId].avatar=s.avatar,console.log('[GameUI] 人际关系头像已同步到队友:',s.name,s.avatar))}}t.saveData()}}St()},showRelationshipPrivateModal:ct,relationshipPrivateAlly:dt,handleShowRelationshipPrivate:e=>{e&&e.private?(dt.value=e,ct.value=!0):console.log('[GameUI] 该角色没有私密档案数据')},handleUpdateAvatar:e=>{a.value?.player?.base&&(a.value.player.base.avatar=e)},handleMapEvent:async e=>{Dt({x:e.x,y:e.y});const t=e.type,a=e.event;switch(t){case Zp.TELEPORT:{const e=a?.params?.targetMap;e&&await Rt(e);break}case Zp.ENCOUNTER:{const t=a?.params?.encounterRate||30;100*Math.random()<t&&(Nt(`[遭遇战斗: ${e.id}]`),Je.value=!1);break}}},updatePlayerPos:Dt,handleMapInteraction:e=>{const{type:t,id:a,event:s}=e;switch(t){case Zp.NPC:Nt(`[与 ${s.name||a} 对话]`),Je.value=!1;break;case Zp.GATE:Nt(`[尝试进入城门: ${s.name||a}]`),Je.value=!1;break;case Zp.ENTER:case Zp.TRANSITION:Nt(`[进入: ${s.name||a}]`),Je.value=!1;break;case Zp.TRIGGER:Nt(`[触发: ${s.name||a}]`),Je.value=!1;break;case Zp.CHEST:Pt(a,s)}},latestAiMessage:vt,handleOptionSelect:e=>{const t=e.match(/<hidden>([\s\S]*?)<\/hidden>/),a=t?t[1].trim():'',s=e.replace(/<hidden>[\s\S]*?<\/hidden>/g,'').trim();yt.value&&(yt.value.inputText=s,yt.value.hiddenInstructions=a)},inputAreaRef:yt,handleDrawerTouchStart:M,handleDrawerTouchMove:E,handleDrawerTouchEnd:D,showPreBattle:he,preBattleEnemies:fe,handleStartBattle:we,handleFleeBattle:async()=>{he.value=!1;const e=a.value?.player;if(!e||0===fe.value.length)return;const t=Math.floor((e.attributes.DEX-10)/2),{DiceRoller:s}=await Promise.resolve().then(l.bind(l,188)),n=s.roll('1d20')+t,r=Math.max(...fe.value.map(e=>e.level||1)),o=10+fe.value.length+Math.floor(r/2);if(console.log(`[PreBattle] 逃跑检定: 1d20+${t} = ${n} vs DC ${o}`),n>=o){const e=Ll.serviceLocator.get('SaveService'),t=e.getGameState();if(t?.pendingEnemies){const a=fe.value.map(e=>e.name);for(const e of Object.keys(t.pendingEnemies)){const s=t.pendingEnemies[e];s?.immediate&&s.linkedNpcNames?.some(e=>a.includes(e))&&(s.immediate=!1,console.log(`[GameUI] Set immediate=false after flee: ${e}`))}e.saveData()}await i('逃跑成功',`成功避开了战斗！(${n} vs DC ${o})`)}else await c('逃跑失败',`无法逃离，被迫战斗！(${n} vs DC ${o})`),we()},handleQuickSave:async()=>{const e=Ll.serviceLocator.get('SaveService');try{await e.saveToSlot(0,'快速保存'),await i('保存成功','游戏已快速保存')}catch(e){console.error(e),await o('保存失败','保存游戏时发生错误，请重试')}},handleSave:()=>{ze.value='save',Ge.value=!0},handleQuickLoad:()=>{ze.value='load',Ge.value=!0},handleReturnTitle:()=>{xt.value={title:'返回主菜单',message:'确定要返回主菜单吗？未保存的进度将会丢失。',confirmText:'确定退出',cancelText:'取消',item:null,isDestructive:!0,actions:[],onConfirm:()=>{bt.value=!1,t('return-title')}},bt.value=!0},handleApplyRegex:async e=>{if(console.log('[GameUI] Apply regex:',e),'render'!==e.mode)try{s.value=!0,n.value='正在应用正则替换...';const{storyDB:t}=await Promise.resolve().then(l.bind(l,725)),a=await t.applyRegexPermanent(e.pattern,e.replacement,e.flags,e.minDepth,e.maxDepth);await i('永久替换完成',`已替换 ${a.modifiedCount} 条消息中的 ${a.totalMatches} 处匹配，并同步更新所有快照。`)}catch(e){console.error('[GameUI] Regex apply error:',e),await o('替换失败',e instanceof Error?e.message:'未知错误')}finally{s.value=!1,n.value='加载中...'}else await i('已启用渲染替换','正则规则将在消息显示时自动应用，原始数据不变。')},handleGameLoaded:()=>{St()},systemModalView:ze,showBattleResult:ve,battleResultType:ye,battleSettlement:be,closeBattleResult:Ae,handleLootAction:async e=>{console.log('[GameUI] Loot action triggered:',e);try{const t=Ll.serviceLocator.get('InventoryService'),a=Ll.serviceLocator.get('OfflineActionService'),s=Ll.serviceLocator.get('SaveService'),n=e.deadEnemies||[];if(0===n.length)return await c('没有战利品','没有可搜刮的敌人。'),void Ae();const r=[];for(const e of n){const a=e.loot||[];for(const e of a){const a=e.id;let s=1;if(e.count)if('string'==typeof e.count&&e.count.includes('d')){s=Ll.serviceLocator.get('RNGService').rollDice(e.count)}else s=parseInt(String(e.count))||1;t.addItem({id:a,name:e.name||a,type:e.type||'material',count:s,quality:e.quality,desc:e.desc,value:e.value}),r.push({name:e.name||a,count:s,quality:e.quality,desc:e.desc})}}if(r.length>0){const e=n.map(e=>e.name).join('、'),t=r.map(e=>{let t=`${e.name}×${e.count}`;return e.quality&&(t+=` [${e.quality}]`),e.desc&&(t+=` - ${e.desc}`),t}).join(', '),s=`玩家搜刮${e}获得了${t}`;a.recordAction('custom',{message:s}),await i('搜刮完成',`已获得战利品:${t}`)}else await o('搜刮完成','没有找到任何战利品。');s.saveData(),St()}catch(e){console.error('[GameUI] Loot failed:',e),await o('搜刮失败','搜刮战利品时发生错误，请重试。')}finally{Ae()}},handleBattleRetry:Me,handleBattleLoad:()=>{ve.value=!1,ze.value='load',Ge.value=!0},handleBattleContinue:()=>{Ee(),St()},handleNotepadUpdate:e=>{if(a.value){a.value.notepad=e;const t=Ll.serviceLocator.get('SaveService'),s=t.getGameState();s&&(s.notepad=e,t.saveData())}},handleDismissAlly:async e=>{if(await d('解散队友',`确定要让 ${e.name} 离开队伍吗？此操作无法撤销。`)){const t=Ll.serviceLocator.get('SaveService'),a=Ll.serviceLocator.get('OfflineActionService'),s=t.getGameState();s?.allies&&(a.recordAction('custom',{message:`玩家解散了队友 ${e.name}`}),delete s.allies[e.id],t.saveData(),St())}},handleUpdateAlly:e=>{const t=Ll.serviceLocator.get('SaveService'),a=t.getGameState();if(a?.allies){const s=a.allies[e.id];if(s){const n=s,r=n.isStarred,l=e.isStarred,o=n.avatar!==e.avatar;if(a.allies[e.id]=e,o&&e.linkedRelId&&a.relation?.characters[e.linkedRelId]&&(a.relation.characters[e.linkedRelId].avatar=e.avatar,console.log('[GameUI] 队友头像已同步到人际关系:',e.name,e.avatar)),r!==l){a.relation||(a.relation={characters:{},factions:{}});let t=e.linkedRelId;if(t||(t=e.name.toLowerCase().replace(/\s+/g,'_').replace(/[^a-z0-9_\u4e00-\u9fa5]/g,'')+'_'+Date.now().toString(36)),l){const s=a.relation.characters[t]||{},n={...s,id:t,name:e.name,appearance:e.appearance||s.appearance||'',personality:e.personality||s.personality||'',occupation:e.class||s.occupation||'',rel:s.rel??e.affinity??50,linkedAllyId:e.id,isStarred:!0,metAt:s.metAt||(new Date).toISOString()};a.relation.characters[t]=n,a.allies[e.id].linkedRelId=t,console.log('[GameUI] 队友已收藏到人际关系:',n.name,t)}else t&&a.relation.characters[t]&&(a.relation.characters[t].isStarred=!1,console.log('[GameUI] 队友取消收藏:',e.name))}t.saveData(),St()}}},handleRelationshipAction:e=>{console.log('[GameUI] Relationship action:',e),pe(e),'invite'!==e.action&&'spar'!==e.action&&'attack'!==e.action||(ot.value=!1)},showChatInputModal:X,chatInputConfig:Y,handleChatInputConfirm:e=>{K(e)&&(ot.value=!1)},showAttackConfirmModal:J,attackConfirmConfig:Z,handleAttackConfirm:async e=>{J.value=!1,ot.value=!1;const t=e.targetName,a=e.targetId,s=e.isSceneNpc,n=Ll.serviceLocator.get('BattleService');if(xe.value)return n.isEnemyInCombat(a,t)?void await c('无法攻击',`${t} 已经在战斗中了！`):(console.log('[GameUI] Already in combat, adding enemy:',t),void await Ot(t,a,s));const r=_e(t);if(r){if(r.teams){let e=null;for(const[a,s]of Object.entries(r.teams))if(Array.isArray(s)&&s.some(e=>e.name===t)){e=a;break}if(e&&r.teams[e]){const a=r.teams[e];console.log(`[GameUI] Team battle: ${t} is in ${e}, adding ${a.length} enemies`);const s={...r,enemies:a};return void await Se(s)}}console.log('[GameUI] Using pending enemy data for battle:',r.encounter_id),await Se(r)}else console.log('[GameUI] No pending enemy data for:',t,'- generating dynamically'),await Ut(t,a,s)},showGiftSelectModal:ee,giftSelectConfig:te,confirmGiftSelect:e=>{ae(e),ot.value=!1,console.log('[GameUI] Gift command added:',e)},showCommandQueueModal:ut,commandQueueCount:ft,currentUserInput:pt,handleSkillForgotten:e=>{console.log('[GameUI] Skill forgotten:',e.name),St()},isRerolling:mt,handleStoryReroll:Lt,isVariableRerolling:gt,handleVariableReroll:async()=>{if(gt.value)return;let e,t;console.log('[GameUI] Starting variable reroll (变量思考重roll)...'),gt.value=!0;try{e=Ll.serviceLocator.get('BackgroundTaskService');t=e.createTask(Rl.TOOL_AI,'变量思考重roll中').taskId,e.setOnCancel(t,()=>{gt.value=!1,console.log('[GameUI] Variable reroll cancelled by user')}),e.startTask(t)}catch{console.log('[GameUI] BackgroundTaskService not available for variable reroll')}try{const a=Ll.serviceLocator.get('LLMService');await a.reprocessToolAI(),St(),e&&t&&e.completeTask(t),await i('变量思考重roll成功','工具AI已重新处理，游戏状态已更新')}catch(a){console.error('[GameUI] Variable reroll failed:',a);const s=a instanceof Error?a.message:'未知错误';e&&t&&e.setTaskError(t,s),await o('变量思考重roll失败',s)}finally{gt.value=!1}},isTextOptimizationRerolling:ht,handleTextOptimizationReroll:async()=>{if(ht.value)return;let e,t;console.log('[GameUI] Starting text optimization reroll...'),ht.value=!0;try{e=Ll.serviceLocator.get('BackgroundTaskService');t=e.createTask(Rl.STORY_POLISH,'正文优化重roll中').taskId,e.startTask(t)}catch{console.log('[GameUI] BackgroundTaskService not available for text optimization reroll')}try{const a=Ll.serviceLocator.get('LLMService');await a.reprocessTextOptimization(),e&&t&&e.completeTask(t),await i('正文优化重roll成功','消息内容已更新'),r.emit('chat:refresh')}catch(a){console.error('[GameUI] Text optimization reroll failed:',a);const s=a instanceof Error?a.message:'未知错误';e&&t&&e.setTaskError(t,s),await o('正文优化重roll失败',s)}finally{ht.value=!1}},showEquipmentDetail:$e,selectedEquipmentItem:De,selectedEquipmentSlot:Pe,handleEquipmentUnequip:je,handleEquipmentDiscard:Oe,closeEquipmentDetail:qe,showSceneObjectModal:se,selectedSceneObject:ne,handleSceneObjectInteract:e=>{le(e)},handleSceneObjectObserve:e=>{const t=oe(e);Nt(t)},isEnemyDefeated:Vt,isNpcDefeated:e=>!!Vt(e)||(a.value?.world?.defeatedNpcs?.includes(e)||!1)}}}),yz=(0,$u.A)(vz,[['render',function(e,t,a,s,n,r){const l=fs('PlayerSidebar'),o=fs('BattleView'),i=fs('ChatArea'),c=fs('OptionSelector'),d=fs('InputArea'),u=fs('ThreeColumnLayout'),p=fs('InventoryModal'),m=fs('EquipmentModal'),g=fs('ActionModal'),h=fs('SystemModal'),f=fs('SystemSettings'),v=fs('AttributesModal'),y=fs('AvatarEditorModal'),b=fs('PrivateInfoModal'),x=fs('MapEditor'),w=fs('PreBattleModal'),k=fs('MapViewer'),S=fs('NodeMapViewer'),C=fs('SkillsModal'),I=fs('QuestsModal'),T=fs('NotepadModal'),A=fs('AdventureNotesModal'),M=fs('DebugModal'),E=fs('TeamModal'),D=fs('RelationshipsModal'),P=fs('ChatInputModal'),N=fs('AttackConfirmModal'),R=fs('FactionsModal'),j=fs('CommandQueueModal'),L=fs('GiftSelectModal'),B=fs('BattleResultModal'),O=fs('ItemDetailModal'),q=fs('ShopModal'),U=fs('SceneObjectModal'),V=fs('TaskBubble');return yn(),Sn('div',Pu,[En(u,{'show-left':e.showLeftDrawer,'show-right':e.showRightDrawer,'show-options':e.showQuickDrawer,'show-sub-header-dropdown':e.showContextDetails,'top-sidebar':e.topSidebar,'hide-input':!!e.gameState?.combat,'hide-sub-header':!!e.gameState?.combat,onToggleLeft:e.toggleLeftDrawer,onToggleRight:e.toggleRightDrawer,onCloseDrawers:e.closeDrawers,onHoverLeft:e.openLeftDrawer,onHoverRight:e.openRightDrawer,onSwipeOpenLeft:e.openLeftDrawer,onSwipeOpenRight:e.openRightDrawer,onSwipeCloseLeft:e.closeLeftDrawer,onSwipeCloseRight:e.closeRightDrawer,onSwipeOpenOptions:e.openQuickDrawer,onSwipeCloseOptions:e.closeQuickDrawer,onSwipeOpenSubheader:e.openSubHeaderDropdown,onSwipeCloseSubheader:e.closeSubHeaderDropdown},{'header-title':ba(()=>[Mn('div',Nu,[Mn('span',Ru,oe(e.locationDisplay),1),Mn('span',ju,oe(e.gameState?.world?.time)+' '+oe(e.gameState?.world?.weather),1)])]),'header-actions':ba(()=>[...t[50]||(t[50]=[])]),'sub-header':ba(()=>[e.hasAnySceneInfo?(yn(),Sn('div',Lu,[Rn(' Fixed Header Row '),Mn('div',Bu,[Rn(' Main Description Row '),Mn('div',Ou,[Rn(' Description '),e.displaySceneDesc?(yn(),Sn('div',qu,' "'+oe(e.displaySceneDesc)+'" ',1)):(yn(),Sn('div',Uu,'暂无场景描述')),Rn(' Context Toggle Button (Desktop: Right aligned) '),e.hasContextInfo?(yn(),Sn('button',{key:2,class:'mt-1 flex items-center space-x-1 self-end rounded px-1.5 py-0.5 text-xs text-gray-400 hover:bg-[#40444b] hover:text-white sm:mt-2 sm:px-2 sm:py-1 sm:text-sm md:mt-0',onClick:t[0]||(t[0]=t=>e.showContextDetails=!e.showContextDetails)},[Mn('span',null,oe(e.showContextDetails?'隐藏详情':'查看详情'),1),e.showContextDetails?(yn(),Sn('span',Vu,'▲')):(yn(),Sn('span',Fu,'▼'))])):Rn('v-if',!0)])]),Rn(' Collapsible Details Panel (Absolute positioned overlay) '),En(wr,{name:'dropdown-fade'},{default:ba(()=>[e.showContextDetails&&e.hasContextInfo?(yn(),Sn('div',Hu,[Mn('div',Gu,[Rn(' NPCs Section '),e.displayNpcs.length>0?(yn(),Sn('div',zu,[t[52]||(t[52]=Mn('h4',{class:'flex items-center text-xs font-bold text-green-400 sm:text-sm'},[Mn('span',{class:'mr-1'},'👤'),Pn(' 周围角色 ')],-1)),Rn(' 结构化NPC（来自scene.npcs） '),e.hasStructuredNpcs?(yn(),Sn('div',Wu,[(yn(!0),Sn(pn,null,xs(e.displayNpcs,(a,s)=>(yn(),Sn('div',{key:s,class:ee(['group flex cursor-pointer items-center rounded px-1 py-0.5 text-xs text-gray-300 transition-colors hover:bg-[#40444b] sm:text-sm',{'cursor-not-allowed opacity-40':e.isNpcDefeated(a.name),'hover:bg-transparent':e.isNpcDefeated(a.name)}]),onClick:t=>!e.isNpcDefeated(a.name)&&e.handleNpcClick(a)},[t[51]||(t[51]=Mn('span',{class:'mr-1.5 text-green-500/70'},'•',-1)),Mn('span',{class:ee(['flex-1 truncate',{'line-through':e.isNpcDefeated(a.name)}])},[Pn(oe(a.name)+' ',1),a.appearance&&a.appearance.includes('Lv.')?(yn(),Sn('span',Xu,' ('+oe(a.appearance.split(' - ')[0])+') ',1)):Rn('v-if',!0)],2),a.attitude?(yn(),Sn('span',Yu,oe(a.attitude),1)):Rn('v-if',!0),e.isNpcDefeated(a.name)?(yn(),Sn('span',Ku,'已击败')):Rn('v-if',!0)],10,Qu))),128))])):(yn(),Sn(pn,{key:1},[Rn(' 简略版NPC（来自剧情AI标签，字符串） '),Mn('ul',Ju,[(yn(!0),Sn(pn,null,xs(e.displayNpcs,(e,t)=>(yn(),Sn('li',{key:t,class:'text-gray-400 italic'},oe(e),1))),128))])],2112))])):Rn('v-if',!0),Rn(' Exits Section '),e.displayExits.length>0?(yn(),Sn('div',Zu,[t[54]||(t[54]=Mn('h4',{class:'flex items-center text-xs font-bold text-blue-400 sm:text-sm'},[Mn('span',{class:'mr-1'},'🚪'),Pn(' 地点 / 出口 ')],-1)),Rn(' 结构化出口（来自scene.exits） '),e.hasStructuredExits?(yn(),Sn('div',ep,[(yn(!0),Sn(pn,null,xs(e.displayExits,(a,s)=>(yn(),Sn('div',{key:s,class:'group flex cursor-pointer items-center rounded px-1 py-0.5 text-xs text-gray-300 transition-colors hover:bg-[#40444b] sm:text-sm',onClick:t=>e.handleExitClick(a)},[t[53]||(t[53]=Mn('span',{class:'mr-1.5 text-blue-500/70'},'→',-1)),Mn('span',ap,oe(a.name),1),a.direction?(yn(),Sn('span',sp,'('+oe(a.direction)+')',1)):Rn('v-if',!0),a.locked?(yn(),Sn('span',np,'🔒')):Rn('v-if',!0)],8,tp))),128))])):(yn(),Sn(pn,{key:1},[Rn(' 简略版出口（来自剧情AI标签，字符串） '),Mn('ul',rp,[(yn(!0),Sn(pn,null,xs(e.displayExits,(t,a)=>(yn(),Sn('li',{key:a,class:'cursor-pointer text-gray-400 italic hover:text-blue-300',onClick:a=>e.handleExitClickSimple(t)},oe(t),9,lp))),128))])],2112))])):Rn('v-if',!0),Rn(' Objects Section '),e.displayObjects.length>0?(yn(),Sn('div',op,[t[56]||(t[56]=Mn('h4',{class:'flex items-center text-xs font-bold text-orange-400 sm:text-sm'},[Mn('span',{class:'mr-1'},'📦'),Pn(' 周围物件 ')],-1)),Rn(' 结构化物品（来自scene.objects） '),e.hasStructuredObjects?(yn(),Sn('div',ip,[(yn(!0),Sn(pn,null,xs(e.displayObjects,(a,s)=>(yn(),Sn('div',{key:s,class:'group flex cursor-pointer items-center rounded px-1 py-0.5 text-xs text-gray-300 transition-colors hover:bg-[#40444b] sm:text-sm',onClick:t=>e.handleObjectClick(a)},[t[55]||(t[55]=Mn('span',{class:'mr-1.5 text-orange-500/70'},'•',-1)),Mn('span',dp,oe(a.name),1),a.brief?(yn(),Sn('span',up,oe(a.brief),1)):Rn('v-if',!0)],8,cp))),128))])):(yn(),Sn(pn,{key:1},[Rn(' 简略版物品（来自剧情AI标签，字符串） '),Mn('ul',pp,[(yn(!0),Sn(pn,null,xs(e.displayObjects,(e,t)=>(yn(),Sn('li',{key:t,class:'text-gray-400 italic'},oe(e),1))),128))])],2112))])):Rn('v-if',!0)])])):Rn('v-if',!0)]),_:1})])):Rn('v-if',!0)]),'left-sidebar':ba(()=>[e.gameState?.player?(yn(),_n(l,{key:0,player:e.gameState.player,'active-tab':e.showInventory?'inventory':e.showEquipment?'equipment':'','is-in-combat':!!e.gameState?.combat,onToggleInventory:e.toggleInventory,onToggleEquipment:e.handleToggleEquipment,onOpenAttributes:t[1]||(t[1]=t=>e.showAttributesModal=!0),onOpenAvatar:t[2]||(t[2]=t=>e.showAvatarModal=!0),onTogglePrivate:t[3]||(t[3]=t=>e.showPrivateInfoModal=!0),onToggleNodeMap:e.handleToggleNodeMap,onToggleSkills:t[4]||(t[4]=t=>e.showSkillsModal=!0),onToggleQuests:t[5]||(t[5]=t=>e.showQuestsModal=!0),onToggleShop:e.handleToggleShop,onToggleNotepad:t[6]||(t[6]=t=>e.showNotepadModal=!0),onClickName:e.handleNameClick},null,8,['player','active-tab','is-in-combat','onToggleInventory','onToggleEquipment','onToggleNodeMap','onToggleShop','onClickName'])):Rn('v-if',!0)]),'main-content':ba(()=>[e.gameState?.combat?(yn(),_n(o,{key:0})):(yn(),_n(i,{key:1}))]),'input-area':ba(()=>[Rn(' Pull-up Drawer Handle with Command Queue Indicator '),Rn(' 使用 pointer-events-none 让外层容器透传点击，只有按钮可点击 '),Mn('div',mp,[Rn(' Command Queue Badge '),e.commandQueueCount>0?(yn(),Sn('button',{key:0,class:'pointer-events-auto relative flex items-center gap-1 rounded-t-lg border border-b-0 border-[#202225] bg-[#2f3136]/90 px-3 py-0.5 text-xs text-gray-400 shadow-md backdrop-blur-sm transition-colors hover:bg-[#40444b] hover:text-white sm:px-4 sm:py-1',title:'查看待执行指令',onClick:t[7]||(t[7]=t=>e.showCommandQueueModal=!0)},[t[57]||(t[57]=Mn('span',null,'📋',-1)),Mn('span',gp,oe(e.commandQueueCount),1)])):Rn('v-if',!0),Rn(' Quick Drawer Toggle '),Mn('button',{class:'pointer-events-auto rounded-t-lg border border-b-0 border-[#202225] bg-[#2f3136]/90 px-4 py-0.5 text-xs text-gray-400 shadow-md backdrop-blur-sm transition-colors hover:bg-[#40444b] hover:text-white sm:px-6 sm:py-1 sm:text-base',onClick:t[8]||(t[8]=(...t)=>e.toggleQuickDrawer&&e.toggleQuickDrawer(...t))},[e.showQuickDrawer?(yn(),Sn('span',hp,'▼')):(yn(),Sn('span',fp,'▲'))])]),Rn(' Quick Drawer Content '),e.showQuickDrawer?(yn(),Sn('div',{key:0,class:'mb-2 max-h-[30vh] overflow-y-auto rounded-t-lg border-t border-[#202225] bg-[#2f3136] p-1 shadow-inner sm:p-2',onTouchstart:t[9]||(t[9]=(...t)=>e.handleDrawerTouchStart&&e.handleDrawerTouchStart(...t)),onTouchmove:t[10]||(t[10]=(...t)=>e.handleDrawerTouchMove&&e.handleDrawerTouchMove(...t)),onTouchend:t[11]||(t[11]=(...t)=>e.handleDrawerTouchEnd&&e.handleDrawerTouchEnd(...t))},[En(c,{content:e.latestAiMessage,onSelect:e.handleOptionSelect},null,8,['content','onSelect'])],32)):Rn('v-if',!0),En(d,{ref:'inputAreaRef'},null,512)]),'right-sidebar':ba(()=>[Mn('div',vp,[Rn(' 噪点纹理背景 '),t[80]||(t[80]=Mn('div',{class:'noise-overlay'},null,-1)),Rn(' Top Icon Bar '),Mn('div',yp,[Mn('button',{class:'sidebar-icon-btn save',title:'保存游戏',onClick:t[12]||(t[12]=(...t)=>e.handleSave&&e.handleSave(...t))},[...t[58]||(t[58]=[Mn('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4'})],-1)])]),Mn('button',{class:'sidebar-icon-btn load',title:'读取存档',onClick:t[13]||(t[13]=(...t)=>e.handleQuickLoad&&e.handleQuickLoad(...t))},[...t[59]||(t[59]=[Mn('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z'})],-1)])]),Mn('button',{class:'sidebar-icon-btn fullscreen',title:'全屏切换',onClick:t[14]||(t[14]=(...t)=>e.toggleFullscreen&&e.toggleFullscreen(...t))},[...t[60]||(t[60]=[Mn('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'})],-1)])]),Mn('button',{class:'sidebar-icon-btn exit',title:'返回主菜单',onClick:t[15]||(t[15]=(...t)=>e.handleReturnTitle&&e.handleReturnTitle(...t))},[...t[61]||(t[61]=[Mn('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1'})],-1)])])]),Rn(' Main Content '),Mn('div',bp,[Rn(' World Overview Group '),Mn('div',xp,[t[68]||(t[68]=Mn('h3',{class:'sidebar-group-title'},[Mn('span',{class:'group-icon'},'🌍'),Pn(' 世界纵览 ')],-1)),Mn('div',wp,[t[67]||(t[67]=Mn('button',{class:'sidebar-btn disabled',disabled:'',title:'功能开发中'},[Mn('span',{class:'btn-icon'},'🌐'),Mn('span',{class:'btn-text'},'世界局势'),Mn('span',{class:'lock-icon'},'🔒')],-1)),Mn('button',{class:'sidebar-btn',onClick:t[16]||(t[16]=t=>e.showAdventureNotesModal=!0)},[...t[62]||(t[62]=[Mn('span',{class:'btn-icon'},'📖',-1),Mn('span',{class:'btn-text'},'冒险笔记',-1)])]),Mn('button',{class:'sidebar-btn',onClick:t[17]||(t[17]=t=>e.showRelationshipsModal=!0)},[...t[63]||(t[63]=[Mn('span',{class:'btn-icon'},'💕',-1),Mn('span',{class:'btn-text'},'人际关系',-1)])]),Mn('button',{class:'sidebar-btn',onClick:t[18]||(t[18]=t=>e.showFactionsModal=!0)},[...t[64]||(t[64]=[Mn('span',{class:'btn-icon'},'🏴',-1),Mn('span',{class:'btn-text'},'势力组织',-1)])]),Mn('button',{class:ee(['sidebar-btn',{disabled:e.isInCombat||!e.canUseWorldMap}]),disabled:e.isInCombat||!e.canUseWorldMap,title:e.worldMapTooltip,onClick:t[19]||(t[19]=t=>e.handleToggleWorldMap())},[t[65]||(t[65]=Mn('span',{class:'btn-icon'},'🗺️',-1)),t[66]||(t[66]=Mn('span',{class:'btn-text'},'世界地图',-1)),e.isInCombat||!e.canUseWorldMap?(yn(),Sn('span',Sp,'🔒')):Rn('v-if',!0)],10,kp)])]),Rn(' Team & Codex Group '),Mn('div',_p,[t[71]||(t[71]=Mn('h3',{class:'sidebar-group-title'},[Mn('span',{class:'group-icon'},'👥'),Pn(' 队伍与图鉴 ')],-1)),Mn('div',Cp,[Mn('button',{class:'sidebar-btn',onClick:t[20]||(t[20]=t=>e.showTeamModal=!0)},[...t[69]||(t[69]=[Mn('span',{class:'btn-icon'},'🤝',-1),Mn('span',{class:'btn-text'},'我的队伍',-1)])]),t[70]||(t[70]=Mn('button',{class:'sidebar-btn disabled',disabled:'',title:'功能开发中'},[Mn('span',{class:'btn-icon'},'📚'),Mn('span',{class:'btn-text'},'图鉴'),Mn('span',{class:'lock-icon'},'🔒')],-1))])]),Rn(' Reroll / Actions '),Mn('div',Ip,[t[75]||(t[75]=Mn('h3',{class:'sidebar-group-title'},[Mn('span',{class:'group-icon'},'🎲'),Pn(' 重新生成 ')],-1)),Mn('div',Tp,[Mn('button',{class:ee(['sidebar-btn',{disabled:e.isVariableRerolling}]),disabled:e.isVariableRerolling,onClick:t[21]||(t[21]=(...t)=>e.handleVariableReroll&&e.handleVariableReroll(...t))},[t[72]||(t[72]=Mn('span',{class:'btn-icon'},'🧠',-1)),Mn('span',Mp,oe(e.isVariableRerolling?'重roll中...':'变量思考重roll'),1)],10,Ap),Mn('button',{class:ee(['sidebar-btn',{disabled:e.isRerolling}]),disabled:e.isRerolling,onClick:t[22]||(t[22]=()=>e.handleStoryReroll())},[t[73]||(t[73]=Mn('span',{class:'btn-icon'},'📝',-1)),Mn('span',$p,oe(e.isRerolling?'重roll中...':'剧情正文重roll'),1)],10,Ep),Mn('button',{class:ee(['sidebar-btn',{disabled:e.isTextOptimizationRerolling}]),disabled:e.isTextOptimizationRerolling,onClick:t[23]||(t[23]=(...t)=>e.handleTextOptimizationReroll&&e.handleTextOptimizationReroll(...t))},[t[74]||(t[74]=Mn('span',{class:'btn-icon'},'✨',-1)),Mn('span',Pp,oe(e.isTextOptimizationRerolling?'优化中...':'正文优化重roll'),1)],10,Dp)])]),Rn(' System Group '),Mn('div',Np,[t[79]||(t[79]=Mn('h3',{class:'sidebar-group-title'},[Mn('span',{class:'group-icon'},'⚙️'),Pn(' 系统 ')],-1)),Mn('div',Rp,[t[78]||(t[78]=Mn('button',{class:'sidebar-btn disabled',disabled:'',title:'功能开发中'},[Mn('span',{class:'btn-icon'},'🏆'),Mn('span',{class:'btn-text'},'成就墙'),Mn('span',{class:'lock-icon'},'🔒')],-1)),Mn('button',{class:'sidebar-btn',onClick:t[24]||(t[24]=t=>e.showSystemSettings=!0)},[...t[76]||(t[76]=[Mn('span',{class:'btn-icon'},'🔧',-1),Mn('span',{class:'btn-text'},'系统设置',-1)])]),Mn('button',{class:'sidebar-btn',onClick:t[25]||(t[25]=t=>e.showMapEditor=!0)},[...t[77]||(t[77]=[Mn('span',{class:'btn-icon'},'✏️',-1),Mn('span',{class:'btn-text'},'地图编辑器',-1)])])])])]),Rn(' 底部装饰线 '),t[81]||(t[81]=Mn('div',{class:'sidebar-footer-deco relative z-10 px-4 pb-3'},[Mn('div',{class:'footer-deco-line'},[Mn('span',{class:'deco-diamond'},'◇')])],-1))])]),_:1},8,['show-left','show-right','show-options','show-sub-header-dropdown','top-sidebar','hide-input','hide-sub-header','onToggleLeft','onToggleRight','onCloseDrawers','onHoverLeft','onHoverRight','onSwipeOpenLeft','onSwipeOpenRight','onSwipeCloseLeft','onSwipeCloseRight','onSwipeOpenOptions','onSwipeCloseOptions','onSwipeOpenSubheader','onSwipeCloseSubheader']),Rn(' Global Loading Overlay '),e.isLoading?(yn(),Sn('div',jp,[Mn('div',Lp,oe(e.loadingText),1)])):Rn('v-if',!0),Rn(' Inventory Modal '),En(p,{visible:e.showInventory,inventory:e.gameState?.inventory,'is-in-combat':e.isInCombat,player:e.playerAsCombatant,allies:e.alliesAsCombatants,onClose:e.toggleInventory,onUseItem:e.handleUseItem,onEquipItem:e.handleEquipItem,onDiscardItem:e.handleDiscardItem},null,8,['visible','inventory','is-in-combat','player','allies','onClose','onUseItem','onEquipItem','onDiscardItem']),Rn(' Equipment Modal '),En(m,{visible:e.showEquipment,equipment:e.gameState?.player?.equipment,onClose:e.toggleEquipment,onUnequipItem:e.handleUnequipItem,onUnequipAll:e.handleUnequipAll,onShowItemDetail:e.handleShowEquipmentDetailFromPanel},null,8,['visible','equipment','onClose','onUnequipItem','onUnequipAll','onShowItemDetail']),Rn(' Action Modal '),En(g,{visible:e.showActionModal,title:e.actionConfig.title,message:e.actionConfig.message,'confirm-text':e.actionConfig.confirmText,'cancel-text':e.actionConfig.cancelText,item:e.actionConfig.item,'is-destructive':e.actionConfig.isDestructive,actions:e.actionConfig.actions,onConfirm:e.handleModalConfirm,onCancel:t[26]||(t[26]=t=>e.showActionModal=!1)},null,8,['visible','title','message','confirm-text','cancel-text','item','is-destructive','actions','onConfirm']),Rn(' System Modal (Legacy - for save/load screen) '),En(h,{visible:e.showSystemModal,'initial-view':e.systemModalView,onClose:t[27]||(t[27]=t=>e.showSystemModal=!1),onSave:()=>{},onTitle:t[28]||(t[28]=t=>e.$emit('return-title')),onLoaded:e.handleGameLoaded},null,8,['visible','initial-view','onLoaded']),Rn(' New System Settings (Regex Tool, API Config) '),En(f,{visible:e.showSystemSettings,onClose:t[29]||(t[29]=t=>e.showSystemSettings=!1),onApplyRegex:e.handleApplyRegex},null,8,['visible','onApplyRegex']),Rn(' Attributes Modal '),e.gameState?.player?(yn(),_n(v,{key:1,visible:e.showAttributesModal,attributes:e.gameState.player.attributes,equipment:e.gameState.player.equipment,'stat-modifiers':e.gameState.player.statModifiers,'available-points':e.gameState.player.base.points||0,onClose:t[30]||(t[30]=t=>e.showAttributesModal=!1),onEnhance:e.handleEnhanceAttribute,onBatchEnhance:e.handleBatchEnhanceAttributes},null,8,['visible','attributes','equipment','stat-modifiers','available-points','onEnhance','onBatchEnhance'])):Rn('v-if',!0),Rn(' Avatar Editor Modal '),e.gameState?.player?(yn(),_n(y,{key:2,visible:e.showAvatarModal,'current-avatar':e.gameState.player.base.avatar||'','character-info':e.playerCharacterInfo,title:'编辑玩家头像',onClose:t[31]||(t[31]=t=>e.showAvatarModal=!1),onUpdateAvatar:e.handleUpdateAvatar},null,8,['visible','current-avatar','character-info','onUpdateAvatar'])):Rn('v-if',!0),Rn(' Private Info Modal '),e.gameState?.player?(yn(),_n(b,{key:3,visible:e.showPrivateInfoModal,'private-info':e.gameState.player.private,gender:e.gameState.player.base?.gender||'未知',appearance:e.gameState.player.appearance,onClose:t[32]||(t[32]=t=>e.showPrivateInfoModal=!1)},null,8,['visible','private-info','gender','appearance'])):Rn('v-if',!0),Rn(' Map Editor '),En(x,{visible:e.showMapEditor,onClose:t[33]||(t[33]=t=>e.showMapEditor=!1)},null,8,['visible']),Rn(' Pre-Battle Modal '),En(w,{visible:e.showPreBattle,enemies:e.preBattleEnemies,onBattle:e.handleStartBattle,onFlee:e.handleFleeBattle},null,8,['visible','enemies','onBattle','onFlee']),Rn(' Map Viewer '),e.gameState?(yn(),_n(k,{key:4,visible:e.showMapViewer,'map-id':e.gameState.world?.currentMapId||'map-5','previous-map-id':e.gameState.world?.previousMapId||'','player-pos':e.gameState.world?.playerPos,'player-spd':e.gameState.player?.attributes?.SPD||10,'player-name':e.gameState.player?.base?.name||'You',onClose:t[34]||(t[34]=t=>e.showMapViewer=!1),'onUpdate:playerPos':e.updatePlayerPos,onTriggerEvent:e.handleMapEvent,onHandleInteraction:e.handleMapInteraction},null,8,['visible','map-id','previous-map-id','player-pos','player-spd','player-name','onUpdate:playerPos','onTriggerEvent','onHandleInteraction'])):Rn('v-if',!0),Rn(' Node Map Viewer '),e.gameState?(yn(),_n(S,{key:5,visible:e.showNodeMap,graph:e.gameState.nodeMap,'location-path':e.gameState.scene?.locationPath||[],onClose:t[35]||(t[35]=t=>e.showNodeMap=!1),onTravel:e.handleNodeMapTravel},null,8,['visible','graph','location-path','onTravel'])):Rn('v-if',!0),Rn(' Skills Modal '),En(C,{visible:e.showSkillsModal,skills:e.gameState?.skills||{},onClose:t[36]||(t[36]=t=>e.showSkillsModal=!1),onSkillForgotten:e.handleSkillForgotten},null,8,['visible','skills','onSkillForgotten']),Rn(' Quests Modal '),En(I,{visible:e.showQuestsModal,quests:e.gameState?.world?.quests||{},onClose:t[37]||(t[37]=t=>e.showQuestsModal=!1)},null,8,['visible','quests']),Rn(' Notepad Modal (简易笔记本) '),En(T,{visible:e.showNotepadModal,content:e.gameState?.notepad||'',onClose:t[38]||(t[38]=t=>e.showNotepadModal=!1),'onUpdate:content':e.handleNotepadUpdate},null,8,['visible','content','onUpdate:content']),Rn(' Adventure Notes Modal (冒险笔记 - 大总结系统) '),En(A,{visible:e.showAdventureNotesModal,onClose:t[39]||(t[39]=t=>e.showAdventureNotesModal=!1)},null,8,['visible']),Rn(' Debug Modal '),En(M,{visible:e.showDebug,'current-user-input':e.currentUserInput,onClose:t[40]||(t[40]=t=>e.showDebug=!1)},null,8,['visible','current-user-input']),Rn(' Team Modal '),En(E,{visible:e.showTeamModal,allies:Object.values(e.gameState?.allies||{}),onClose:t[41]||(t[41]=t=>e.showTeamModal=!1),onDismissAlly:e.handleDismissAlly,onUpdateAlly:e.handleUpdateAlly},null,8,['visible','allies','onDismissAlly','onUpdateAlly']),Rn(' Relationships Modal '),En(D,{visible:e.showRelationshipsModal,relation:e.gameState?.relation,scene:e.gameState?.scene,allies:Object.values(e.gameState?.allies||{}),'initial-npc-name':e.initialSelectedNpcName??void 0,'show-scene-npcs':e.showSceneNpcsInRelationship,'simple-mode':e.showSceneNpcsInRelationship,onClose:e.handleCloseRelationshipsModal,onUpdateRelation:e.handleRelationUpdate,onShowPrivate:e.handleShowRelationshipPrivate,onAction:e.handleRelationshipAction},null,8,['visible','relation','scene','allies','initial-npc-name','show-scene-npcs','simple-mode','onClose','onUpdateRelation','onShowPrivate','onAction']),Rn(' NPC Action Modals '),Rn(' 交谈/调情输入弹窗 '),En(P,{visible:e.showChatInputModal,title:e.chatInputConfig.title,'target-name':e.chatInputConfig.targetName,'target-id':e.chatInputConfig.targetId,'is-scene-npc':e.chatInputConfig.isSceneNpc,action:e.chatInputConfig.action,'quick-phrases':e.chatInputConfig.quickPhrases,onClose:t[42]||(t[42]=t=>e.showChatInputModal=!1),onConfirm:e.handleChatInputConfirm},null,8,['visible','title','target-name','target-id','is-scene-npc','action','quick-phrases','onConfirm']),Rn(' 攻击确认弹窗 '),En(N,{visible:e.showAttackConfirmModal,'target-name':e.attackConfirmConfig.targetName,'target-id':e.attackConfirmConfig.targetId,'is-scene-npc':e.attackConfirmConfig.isSceneNpc,onClose:t[43]||(t[43]=t=>e.showAttackConfirmModal=!1),onConfirm:e.handleAttackConfirm},null,8,['visible','target-name','target-id','is-scene-npc','onConfirm']),Rn(' Relationship Private Info Modal (for ally private info from relationships modal) '),e.relationshipPrivateAlly?(yn(),_n(b,{key:6,visible:e.showRelationshipPrivateModal,'private-info':e.relationshipPrivateAlly.private,gender:e.relationshipPrivateAlly.gender||'未知',appearance:e.relationshipPrivateAlly.appearance,onClose:t[44]||(t[44]=t=>e.showRelationshipPrivateModal=!1)},null,8,['visible','private-info','gender','appearance'])):Rn('v-if',!0),Rn(' Factions Modal '),En(R,{visible:e.showFactionsModal,relation:e.gameState?.relation,onClose:t[45]||(t[45]=t=>e.showFactionsModal=!1)},null,8,['visible','relation']),Rn(' Command Queue Modal '),En(j,{visible:e.showCommandQueueModal,onClose:t[46]||(t[46]=t=>e.showCommandQueueModal=!1)},null,8,['visible']),Rn(' Gift Select Modal '),En(L,{visible:e.showGiftSelectModal,'target-name':e.giftSelectConfig.targetName,'target-id':e.giftSelectConfig.targetId,'is-scene-npc':e.giftSelectConfig.isSceneNpc,inventory:e.gameState?.inventory?.items,onCancel:t[47]||(t[47]=t=>e.showGiftSelectModal=!1),onConfirm:e.confirmGiftSelect},null,8,['visible','target-name','target-id','is-scene-npc','inventory','onConfirm']),Rn(' Battle Result Modal '),En(B,{visible:e.showBattleResult,result:e.battleResultType,settlement:e.battleSettlement,onClose:e.closeBattleResult,onLoot:e.handleLootAction,onRetry:e.handleBattleRetry,onLoad:e.handleBattleLoad,onContinue:e.handleBattleContinue},null,8,['visible','result','settlement','onClose','onLoot','onRetry','onLoad','onContinue']),Rn(' Equipment Detail Modal (using ItemDetailModal) '),En(O,{visible:e.showEquipmentDetail,item:e.selectedEquipmentItem,'is-in-combat':e.isInCombat,mode:'equipment','equipment-slot':e.selectedEquipmentSlot,onClose:e.closeEquipmentDetail,onUnequipItem:e.handleEquipmentUnequip,onDiscardItem:e.handleEquipmentDiscard},null,8,['visible','item','is-in-combat','equipment-slot','onClose','onUnequipItem','onDiscardItem']),Rn(' Shop Modal '),En(q,{visible:e.showShopModal,shop:e.currentShop,wallet:e.gameState?.inventory?.wallet?.ledger||0,inventory:e.gameState?.inventory?.items||{},onClose:t[48]||(t[48]=t=>e.showShopModal=!1),onBuy:e.handleShopBuy,onSell:e.handleShopSell},null,8,['visible','shop','wallet','inventory','onBuy','onSell']),Rn(' Scene Object Detail Modal (场景物品详情弹窗) '),En(U,{visible:e.showSceneObjectModal,'scene-object':e.selectedSceneObject,onClose:t[49]||(t[49]=t=>e.showSceneObjectModal=!1),onObserve:e.handleSceneObjectObserve,onInteract:e.handleSceneObjectInteract},null,8,['visible','scene-object','onObserve','onInteract']),Rn(' Task Bubble (Background Tasks) '),En(V)])}],['__scopeId','data-v-edda78f0']]),bz=['title'],xz={key:0,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},wz={key:1,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},kz={class:'content-layer'},Sz={class:'menu-buttons'},_z=['disabled'];const Cz={class:'changelog-modal-content'},Iz={class:'mb-6 flex items-center justify-between border-b border-gray-700 pb-4'},Tz=['innerHTML'];const Az=Za({name:'ChangelogModal',props:{visible:{type:Boolean,required:!0}},emits:['close'],setup(e){const t=$t(''),a=e=>e.replace(/^### (.*$)/gim,'<h3>$1</h3>').replace(/^## (.*$)/gim,'<h2>$1</h2>').replace(/^# (.*$)/gim,'<h1>$1</h1>').replace(/^> (.*$)/gim,'<blockquote>$1</blockquote>').replace(/\*\*(.*)\*\*/gim,'<strong>$1</strong>').replace(/\*(.*)\*/gim,'<em>$1</em>').replace(/!\[(.*?)\]\((.*?)\)/gim,'<img alt=\'$1\' src=\'$2\' />').replace(/\[(.*?)\]\((.*?)\)/gim,'<a href=\'$2\'>$1</a>').replace(/\n$/gim,'<br />').replace(/^---$/gim,'<hr />').replace(/^- (.*$)/gim,'<li>$1</li>').replace(/(<li>.*<\/li>)/s,'<ul>$1</ul>');return _a(()=>e.visible,e=>{e&&(()=>{try{t.value=a('\n### 2026-1-21\n【BUG修复】\n> 迭代了存档和快照系统，完全隔离每个存档。可能与旧存档不兼容，需要创建新存档。\n> 修复了左边栏提升资源上限但显示不正确的问题。\n> 修复部分效果名没有被翻译的问题。\n> 修复了正则永久替换模式。修复random宏。\n')}catch(e){console.error('Failed to load changelog:',e),t.value='<p class="text-red-400">加载更新日志失败</p>'}})()},{immediate:!0}),{renderedContent:t}}}),Mz=(0,$u.A)(Az,[['render',function(e,t,a,s,n,r){return e.visible?(yn(),Sn('div',{key:0,class:'changelog-modal-backdrop',onClick:t[1]||(t[1]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',Cz,[Rn(' Header '),Mn('div',Iz,[t[3]||(t[3]=Mn('h2',{class:'text-xl font-bold text-white'},[Mn('i',{class:'fas fa-history mr-2 text-amber-500'}),Pn('更新日志 ')],-1)),Mn('button',{class:'text-gray-400 transition-colors hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[2]||(t[2]=[Mn('i',{class:'fas fa-times text-lg'},null,-1)])])]),Rn(' Changelog Content '),Mn('div',{class:'changelog-content',innerHTML:e.renderedContent},null,8,Tz)])])):Rn('v-if',!0)}],['__scopeId','data-v-30fad8f0']]),Ez={class:'settings-modal-content'},$z={class:'mb-6 flex items-center justify-between border-b border-gray-700 pb-4'},Dz={class:'space-y-4'},Pz={class:'space-y-3'},Nz={class:'rounded-lg border border-gray-600 bg-gray-800/50 p-4'},Rz={class:'mb-2 flex items-center justify-between'},jz={class:'rounded-lg border border-gray-600 bg-gray-800/50 p-4'},Lz={class:'mb-2 flex items-center justify-between'},Bz={class:'rounded-lg border border-gray-600 bg-gray-800/50 p-4'},Oz={class:'mb-2 flex items-center justify-between'},qz={class:'rounded-lg border border-red-800/50 bg-red-900/20 p-4'},Uz={class:'mb-2 flex items-center justify-between'},Vz={class:'mt-6 space-y-4'},Fz={class:'rounded-lg border border-gray-600 bg-gray-800/50 p-4'},Hz={class:'grid grid-cols-2 gap-3 text-sm'},Gz={class:'text-white'},zz={class:'text-white'},Wz={class:'text-white'};const Qz=Za({name:'MainMenuSettingsModal',components:{ModalDialog:FB},props:{visible:{type:Boolean,required:!0}},emits:['close'],setup(){const e=$t(''),t=$t('info'),a=$t(!1),s=$t(''),n=$t(''),r=$t(null),l=xt({storyCount:0,snapshotCount:0,slotCount:0}),o=$t('bg-gray-800 text-gray-300'),i=$t('fas fa-info-circle'),c=(a,s='info')=>{e.value=a,t.value=s,'success'===t.value?(o.value='bg-green-900/50 text-green-400',i.value='fas fa-check-circle'):'error'===t.value?(o.value='bg-red-900/50 text-red-400',i.value='fas fa-times-circle'):(o.value='bg-gray-800 text-gray-300',i.value='fas fa-info-circle'),setTimeout(()=>{e.value=''},3e3)},d=(e,t,l)=>{s.value=e,n.value=t,r.value=l,a.value=!0},u=async()=>{try{const e=await mi.storyDB.story.count(),t=await mi.storyDB.snapshots.count(),a=await mi.storyDB.save_slots.count();l.storyCount=e,l.snapshotCount=t,l.slotCount=a}catch(e){console.error('Failed to get DB info:',e)}};return us(()=>{u()}),{statusMessage:e,statusClass:o,statusIcon:i,showConfirmDialog:a,confirmTitle:s,confirmMessage:n,dbInfo:l,clearActiveSession:()=>{d('清空故事记录','确定要删除所有对话记录和游戏快照吗？此操作不可恢复，但会保留存档槽。',async()=>{try{await mi.storyDB.clearActiveSession(),c('故事记录已清空','success'),await u()}catch(e){console.error('Failed to clear active session:',e),c('清空失败: '+String(e),'error')}})},clearSaveSlots:()=>{d('清空存档槽','确定要删除所有存档槽吗？此操作不可恢复。',async()=>{try{await mi.storyDB.save_slots.clear(),c('存档槽已清空','success'),await u()}catch(e){console.error('Failed to clear save slots:',e),c('清空失败: '+String(e),'error')}})},clearLocalStorage:()=>{d('清空本地缓存','确定要清除浏览器本地缓存吗？这将重置所有临时设置。',async()=>{try{localStorage.clear(),c('本地缓存已清空','success')}catch(e){console.error('Failed to clear localStorage:',e),c('清空失败: '+String(e),'error')}})},clearAllData:()=>{d('⚠️ 完全清空数据库','警告：这将删除所有游戏数据，包括故事记录、快照和所有存档！此操作完全不可恢复！',async()=>{try{await mi.storyDB.clearAll(),await mi.storyDB.save_slots.clear(),localStorage.clear(),c('所有数据已清空','success'),await u()}catch(e){console.error('Failed to clear all data:',e),c('清空失败: '+String(e),'error')}})},refreshDbInfo:u,executeConfirmedAction:async()=>{r.value&&(await r.value(),r.value=null)}}}}),Xz=Za({name:'MainMenu',components:{SaveLoadScreen:yO,ChangelogModal:Mz,MainMenuSettingsModal:(0,$u.A)(Qz,[['render',function(e,t,a,s,n,r){const l=fs('ModalDialog');return yn(),Sn(pn,null,[e.visible?(yn(),Sn('div',{key:0,class:'settings-modal-backdrop',onClick:t[6]||(t[6]=Cl(t=>e.$emit('close'),['self']))},[Mn('div',Ez,[Rn(' Header '),Mn('div',$z,[t[9]||(t[9]=Mn('h2',{class:'text-xl font-bold text-white'},[Mn('i',{class:'fas fa-cog mr-2 text-amber-500'}),Pn('设置')],-1)),Mn('button',{class:'text-gray-400 transition-colors hover:text-white',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[8]||(t[8]=[Mn('i',{class:'fas fa-times text-lg'},null,-1)])])]),Rn(' Data Management Section '),Mn('div',Dz,[t[18]||(t[18]=Mn('h3',{class:'mb-3 flex items-center text-base font-semibold text-amber-400'},[Mn('i',{class:'fas fa-database mr-2'}),Pn('数据管理 ')],-1)),Mn('div',Pz,[Rn(' Clear Story & Snapshots '),Mn('div',Nz,[Mn('div',Rz,[t[11]||(t[11]=Mn('div',null,[Mn('div',{class:'font-medium text-white'},'清空故事记录'),Mn('div',{class:'text-xs text-gray-400'},'删除所有对话记录和游戏快照，保留存档槽')],-1)),Mn('button',{class:'rounded bg-orange-700 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-orange-600',onClick:t[1]||(t[1]=(...t)=>e.clearActiveSession&&e.clearActiveSession(...t))},[...t[10]||(t[10]=[Mn('i',{class:'fas fa-eraser mr-1'},null,-1),Pn('清空 ',-1)])])])]),Rn(' Clear Save Slots '),Mn('div',jz,[Mn('div',Lz,[t[13]||(t[13]=Mn('div',null,[Mn('div',{class:'font-medium text-white'},'清空存档槽'),Mn('div',{class:'text-xs text-gray-400'},'删除所有手动存档和自动存档')],-1)),Mn('button',{class:'rounded bg-orange-700 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-orange-600',onClick:t[2]||(t[2]=(...t)=>e.clearSaveSlots&&e.clearSaveSlots(...t))},[...t[12]||(t[12]=[Mn('i',{class:'fas fa-trash-alt mr-1'},null,-1),Pn('清空 ',-1)])])])]),Rn(' Clear LocalStorage '),Mn('div',Bz,[Mn('div',Oz,[t[15]||(t[15]=Mn('div',null,[Mn('div',{class:'font-medium text-white'},'清空本地缓存'),Mn('div',{class:'text-xs text-gray-400'},'清除浏览器缓存的设置和临时数据')],-1)),Mn('button',{class:'rounded bg-orange-700 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-orange-600',onClick:t[3]||(t[3]=(...t)=>e.clearLocalStorage&&e.clearLocalStorage(...t))},[...t[14]||(t[14]=[Mn('i',{class:'fas fa-broom mr-1'},null,-1),Pn('清空 ',-1)])])])]),Rn(' Clear All Data '),Mn('div',qz,[Mn('div',Uz,[t[17]||(t[17]=Mn('div',null,[Mn('div',{class:'font-medium text-red-400'},[Mn('i',{class:'fas fa-exclamation-triangle mr-1'}),Pn('完全清空数据库 ')]),Mn('div',{class:'text-xs text-gray-400'},'删除所有游戏数据，包括故事、快照和存档（不可恢复）')],-1)),Mn('button',{class:'rounded bg-red-700 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-red-600',onClick:t[4]||(t[4]=(...t)=>e.clearAllData&&e.clearAllData(...t))},[...t[16]||(t[16]=[Mn('i',{class:'fas fa-nuclear mr-1'},null,-1),Pn('全部清空 ',-1)])])])])])]),Rn(' Database Info Section '),Mn('div',Vz,[t[23]||(t[23]=Mn('h3',{class:'mb-3 flex items-center text-base font-semibold text-amber-400'},[Mn('i',{class:'fas fa-info-circle mr-2'}),Pn('数据库信息 ')],-1)),Mn('div',Fz,[Mn('div',Hz,[t[19]||(t[19]=Mn('div',{class:'text-gray-400'},'故事记录数:',-1)),Mn('div',Gz,oe(e.dbInfo.storyCount),1),t[20]||(t[20]=Mn('div',{class:'text-gray-400'},'快照数:',-1)),Mn('div',zz,oe(e.dbInfo.snapshotCount),1),t[21]||(t[21]=Mn('div',{class:'text-gray-400'},'存档槽数:',-1)),Mn('div',Wz,oe(e.dbInfo.slotCount),1)]),Mn('button',{class:'mt-3 w-full rounded border border-gray-600 px-3 py-1.5 text-sm text-gray-300 transition-colors hover:bg-gray-700',onClick:t[5]||(t[5]=(...t)=>e.refreshDbInfo&&e.refreshDbInfo(...t))},[...t[22]||(t[22]=[Mn('i',{class:'fas fa-sync-alt mr-1'},null,-1),Pn('刷新 ',-1)])])])]),Rn(' Status Message '),e.statusMessage?(yn(),Sn('div',{key:0,class:ee(['mt-4 rounded-lg p-3 text-sm',e.statusClass])},[Mn('i',{class:ee([e.statusIcon,'mr-2'])},null,2),Pn(oe(e.statusMessage),1)],2)):Rn('v-if',!0)])])):Rn('v-if',!0),Rn(' Confirmation Dialog '),En(l,{visible:e.showConfirmDialog,'onUpdate:visible':t[7]||(t[7]=t=>e.showConfirmDialog=t),type:'confirm',title:e.confirmTitle,message:e.confirmMessage,'confirm-text':'确认删除','cancel-text':'取消',onConfirm:e.executeConfirmedAction},null,8,['visible','title','message','onConfirm'])],64)}],['__scopeId','data-v-7f3f849a']])},props:{hasSave:{type:Boolean,default:!1},useVhHeight:{type:Boolean,default:!1}},emits:['new-game','continue','game-loaded','request-fullscreen'],setup(e,{emit:t}){const a=$t(!1),s=$t(!1),n=$t(!1),r=$t(!!document.fullscreenElement),l=()=>{r.value=!!document.fullscreenElement};return us(()=>{document.addEventListener('fullscreenchange',l)}),gs(()=>{document.removeEventListener('fullscreenchange',l)}),{showLoadScreen:a,showChangelog:s,showSettings:n,onLoaded:()=>{a.value=!1,t('game-loaded')},isFullscreen:r,toggleFullscreen:()=>{r.value?document.exitFullscreen().catch(e=>{console.warn('[MainMenu] Exit fullscreen failed:',e)}):t('request-fullscreen')}}}}),Yz=(0,$u.A)(Xz,[['render',function(e,t,a,s,n,r){const l=fs('SaveLoadScreen'),o=fs('ChangelogModal'),i=fs('MainMenuSettingsModal');return yn(),Sn('div',{class:ee(['main-menu-root',{'use-vh':e.useVhHeight}])},[Rn(' 背景层：渐变 + 纹理 '),t[18]||(t[18]=Mn('div',{class:'bg-layer'},null,-1)),t[19]||(t[19]=Mn('div',{class:'vignette'},null,-1)),t[20]||(t[20]=Mn('div',{class:'noise'},null,-1)),Rn(' 全屏按钮 '),Mn('button',{class:'fullscreen-btn',title:e.isFullscreen?'退出全屏':'进入全屏',onClick:t[0]||(t[0]=(...t)=>e.toggleFullscreen&&e.toggleFullscreen(...t))},[e.isFullscreen?(yn(),Sn('svg',wz,[...t[10]||(t[10]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'},null,-1)])])):(yn(),Sn('svg',xz,[...t[9]||(t[9]=[Mn('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'},null,-1)])]))],8,bz),Rn(' 内容层 '),Mn('div',kz,[Rn(' 标题区域 '),t[16]||(t[16]=Nn('<div class="title-section" data-v-8da20610>\x3c!-- 装饰线 --\x3e<div class="title-deco-line" data-v-8da20610><span class="deco-diamond" data-v-8da20610>◇</span></div>\x3c!-- 主标题 --\x3e<h1 class="main-title" data-v-8da20610><span class="title-icon" data-v-8da20610>⚔</span><span class="title-text" data-v-8da20610>艾瑟洛斯</span><span class="title-icon" data-v-8da20610>⚔</span></h1>\x3c!-- 副标题 --\x3e<h2 class="sub-title" data-v-8da20610>命运织机</h2>\x3c!-- 英文名 --\x3e<p class="english-title" data-v-8da20610>Aethelos: Fate Weaver</p>\x3c!-- 装饰线 --\x3e<div class="title-deco-line" data-v-8da20610><span class="deco-diamond" data-v-8da20610>◇</span></div></div>',1)),Rn(' 菜单按钮 '),Mn('div',Sz,[Mn('button',{class:'menu-btn',onClick:t[1]||(t[1]=t=>e.$emit('new-game'))},[...t[11]||(t[11]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'开始新游戏',-1)])]),Mn('button',{class:'menu-btn',disabled:!e.hasSave,onClick:t[2]||(t[2]=t=>e.$emit('continue'))},[...t[12]||(t[12]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'继续游戏',-1)])],8,_z),Mn('button',{class:'menu-btn',onClick:t[3]||(t[3]=t=>e.showLoadScreen=!0)},[...t[13]||(t[13]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},'读取游戏',-1)])]),Mn('button',{class:'menu-btn',onClick:t[4]||(t[4]=t=>e.showChangelog=!0)},[...t[14]||(t[14]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},[Mn('i',{class:'fas fa-history mr-2'}),Pn('更新日志 ')],-1)])]),Mn('button',{class:'menu-btn',onClick:t[5]||(t[5]=t=>e.showSettings=!0)},[...t[15]||(t[15]=[Mn('span',{class:'btn-glow'},null,-1),Mn('span',{class:'btn-content'},[Mn('i',{class:'fas fa-cog mr-2'}),Pn('设置 ')],-1)])])]),Rn(' 版本信息 '),t[17]||(t[17]=Mn('div',{class:'version-info'},[Mn('div',null,[Mn('span',{class:'version-deco'},'◆'),Mn('span',null,'Alpha版本'),Mn('span',{class:'version-deco'},'◆')]),Mn('div',{class:'update-date'},'更新时间：1月21日')],-1))]),e.showLoadScreen?(yn(),_n(l,{key:0,mode:'load','is-main-menu':!0,onClose:t[6]||(t[6]=t=>e.showLoadScreen=!1),onLoaded:e.onLoaded},null,8,['onLoaded'])):Rn('v-if',!0),En(o,{visible:e.showChangelog,onClose:t[7]||(t[7]=t=>e.showChangelog=!1)},null,8,['visible']),En(i,{visible:e.showSettings,onClose:t[8]||(t[8]=t=>e.showSettings=!1)},null,8,['visible'])],2)}],['__scopeId','data-v-8da20610']]),Kz={class:'text-base'},Jz={class:'text-sm font-bold text-white md:text-base'},Zz={class:'bg-[#2f3136] px-3 py-2.5'},eW={class:'text-xs leading-relaxed text-gray-300 md:text-sm'},tW={key:0,class:'mt-2.5'},aW=['placeholder'],sW={class:'flex justify-end gap-1.5 border-t border-gray-700 bg-[#2f3136] px-3 py-2'};const nW=Za({name:'DebugConfirmDialog',setup(){const{state:e,handleConfirm:t,handleCancel:a,updateInputValue:s}=Xp(),n=$t(null),r=$t('');_a(()=>e.visible,async t=>{t&&(r.value=e.initialValue,'prompt'===e.type&&(await Zt(),n.value?.focus()))}),_a(r,e=>{s(e)});const l=ir(()=>{switch(e.variant){case'success':return'✅';case'warning':return'⚠️';case'danger':return'🚨';default:return'ℹ️'}}),o=ir(()=>{switch(e.variant){case'success':return'border-green-700';case'warning':return'border-yellow-700';case'danger':return'border-red-700';default:return'border-blue-700'}}),i=ir(()=>{switch(e.variant){case'success':return'bg-green-900/80';case'warning':return'bg-yellow-900/80';case'danger':return'bg-red-900/80';default:return'bg-blue-900/80'}}),c=ir(()=>{switch(e.variant){case'success':return'bg-green-700 hover:bg-green-600';case'warning':return'bg-yellow-700 hover:bg-yellow-600';case'danger':return'bg-red-700 hover:bg-red-600';default:return'bg-blue-700 hover:bg-blue-600'}});return{state:e,inputRef:n,inputValue:r,icon:l,borderClass:o,headerClass:i,confirmButtonClass:c,handleConfirm:t,handleCancel:a,handleBackdropClick:()=>{'alert'===e.type?t():a()}}}}),rW=Za({name:'App',components:{MainMenu:Yz,CharacterCreation:Du,GameUI:yz,DebugConfirmDialog:(0,$u.A)(nW,[['render',function(e,t,a,s,n,r){return yn(),_n(Ra,{to:'body'},[En(wr,{name:'modal-fade'},{default:ba(()=>[e.state.visible?(yn(),Sn('div',{key:0,class:'fixed inset-0 z-[200] flex items-center justify-center bg-black/70 px-3',onClick:t[4]||(t[4]=Cl((...t)=>e.handleBackdropClick&&e.handleBackdropClick(...t),['self']))},[Mn('div',{class:ee(['w-full max-w-xs transform overflow-hidden rounded-lg border shadow-xl transition-all md:max-w-sm',e.borderClass])},[Rn(' Header '),Mn('div',{class:ee(['flex items-center gap-1.5 px-3 py-2',e.headerClass])},[Mn('span',Kz,oe(e.icon),1),Mn('h3',Jz,oe(e.state.title),1)],2),Rn(' Body '),Mn('div',Zz,[Mn('p',eW,oe(e.state.message),1),Rn(' Input Field (Prompt) '),'prompt'===e.state.type?(yn(),Sn('div',tW,[xa(Mn('input',{ref:'inputRef','onUpdate:modelValue':t[0]||(t[0]=t=>e.inputValue=t),type:'text',class:'w-full rounded border border-gray-600 bg-gray-800 px-2.5 py-1.5 text-sm text-white placeholder-gray-500 focus:border-amber-500 focus:ring-1 focus:ring-amber-500 focus:outline-none',placeholder:e.state.placeholder,onKeyup:t[1]||(t[1]=Tl((...t)=>e.handleConfirm&&e.handleConfirm(...t),['enter']))},null,40,aW),[[fl,e.inputValue]])])):Rn('v-if',!0)]),Rn(' Footer '),Mn('div',sW,['alert'!==e.state.type?(yn(),Sn('button',{key:0,type:'button',class:'rounded border border-gray-600 bg-transparent px-3 py-1.5 text-xs font-medium text-gray-300 transition-colors hover:bg-gray-700 focus:outline-none md:text-sm',onClick:t[2]||(t[2]=(...t)=>e.handleCancel&&e.handleCancel(...t))},oe(e.state.cancelText),1)):Rn('v-if',!0),Mn('button',{type:'button',class:ee(['rounded border border-transparent px-3 py-1.5 text-xs font-medium text-white transition-colors focus:outline-none md:text-sm',e.confirmButtonClass]),onClick:t[3]||(t[3]=(...t)=>e.handleConfirm&&e.handleConfirm(...t))},oe(e.state.confirmText),3)])],2)])):Rn('v-if',!0)]),_:1})])}],['__scopeId','data-v-cc03ce84']]),ToastNotification:dU},setup(){const e=$t('MainMenu'),t=$t(!1),a=$t(null),{state:s}=rc(!0),n=$t(!1),r=$t(!!document.fullscreenElement),l=ir(()=>n.value||r.value),o=ir(()=>{switch(e.value){case'MainMenu':default:return Yz;case'CharacterCreation':return Du;case'GameUI':return yz}}),i=()=>{r.value=!!document.fullscreenElement,document.fullscreenElement&&(n.value=!0)};us(async()=>{await ec.getInstance().init();const e=Ll.serviceLocator.get('SaveService');a.value=e,t.value=await e.hasSaveData(),r.value=!!document.fullscreenElement,document.addEventListener('fullscreenchange',i)}),gs(()=>{document.removeEventListener('fullscreenchange',i)});return{currentViewComponent:o,hasSave:t,useVhHeight:l,toastState:s,startNewGame:()=>{e.value='CharacterCreation'},continueGame:async()=>{if(a.value){await a.value.loadFromSlot(0)&&(e.value='GameUI')}},onGameLoaded:()=>{e.value='GameUI'},finalizeCreation:async(s,n)=>{if(a.value){if(await a.value.createNewGame(s),n&&n.length>0){const e=Date.now();for(let t=0;t<n.length;t++){const a=n[t];await mi.storyDB.addRecord({timestamp:e+t,role:a.role,content:a.content})}}t.value=!0,e.value='GameUI'}},returnToTitle:()=>{e.value='MainMenu',a.value&&a.value.hasSaveData().then(e=>t.value=e)},handleRequestFullscreen:()=>{document.fullscreenElement||document.documentElement.requestFullscreen().catch(e=>{console.warn('[App] Fullscreen request failed:',e)})}}}});$l((0,$u.A)(rW,[['render',function(e,t,a,s,n,r){const l=fs('DebugConfirmDialog'),o=fs('ToastNotification');return yn(),Sn('div',{class:ee(['app-root relative w-full bg-[#36393f] font-sans text-white',{'use-vh':e.useVhHeight}])},[En(wr,{name:'fade',mode:'out-in'},{default:ba(()=>{return[(yn(),_n((t=e.currentViewComponent,S(t)?ys(hs,t,!1)||t:t||vs),{'has-save':e.hasSave,'use-vh-height':e.useVhHeight,onNewGame:e.startNewGame,onContinue:e.continueGame,onGameLoaded:e.onGameLoaded,onFinish:e.finalizeCreation,onBack:e.returnToTitle,onReturnTitle:e.returnToTitle,onRequestFullscreen:e.handleRequestFullscreen},null,40,['has-save','use-vh-height','onNewGame','onContinue','onGameLoaded','onFinish','onBack','onReturnTitle','onRequestFullscreen']))];var t}),_:1}),Rn(' 全局调试弹窗 '),En(l),Rn(' 全局 Toast 通知 '),En(o,{visible:e.toastState.visible,'onUpdate:visible':t[0]||(t[0]=t=>e.toastState.visible=t),message:e.toastState.message,type:e.toastState.type,duration:e.toastState.duration},null,8,['visible','message','type','duration'])],2)}]])).mount('#app'),console.log('RPG Game App mounted.');
//# sourceMappingURL=index.js.map</script><style>.creation-root[data-v-768e54ca]{position:relative;width:100%;height:100%;min-height:600px;overflow:hidden;font-family:'Noto Sans SC','Microsoft YaHei',sans-serif;padding-top:env(safe-area-inset-top,0);padding-bottom:env(safe-area-inset-bottom,0);padding-left:env(safe-area-inset-left,0);padding-right:env(safe-area-inset-right,0)}.creation-root.use-vh[data-v-768e54ca]{height:100vh;min-height:100vh}.bg-layer[data-v-768e54ca]{position:absolute;inset:0;background:linear-gradient(135deg,#0a0a0f 0%,#12141a 25%,#1a1c25 50%,#151720 75%,#0d0e14 100%)}.vignette[data-v-768e54ca]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 50%,rgba(0,0,0,0.5) 100%);pointer-events:none}.noise[data-v-768e54ca]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.03;pointer-events:none}.content-layer[data-v-768e54ca]{position:absolute;inset:0;z-index:10;display:flex;flex-direction:column;color:#e0e0e0;box-sizing:border-box}.creation-header[data-v-768e54ca]{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.5rem;padding-top:calc(1rem + env(safe-area-inset-top,0));border-bottom:1px solid rgba(114,137,218,0.2);background:linear-gradient(180deg,rgba(20,22,28,0.95) 0%,rgba(15,17,22,0.9) 100%)}.back-btn[data-v-768e54ca]{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 1rem;border:1px solid rgba(114,137,218,0.2);border-radius:4px;background:transparent;color:rgba(180,190,210,0.8);font-size:0.875rem;cursor:pointer;transition:all 0.2s ease}.back-btn[data-v-768e54ca]:hover{border-color:rgba(114,137,218,0.5);color:#fff;background:rgba(114,137,218,0.1)}.back-icon[data-v-768e54ca]{font-size:1rem}.header-center[data-v-768e54ca]{text-align:center}.header-title[data-v-768e54ca]{display:flex;align-items:center;justify-content:center;gap:0.75rem;font-size:1.25rem;font-weight:600;color:#fff;letter-spacing:0.1em}.title-deco[data-v-768e54ca]{color:rgba(114,137,218,0.6);font-size:0.75rem}.step-label[data-v-768e54ca]{margin-top:0.25rem;font-size:0.875rem;color:rgba(114,137,218,0.9);letter-spacing:0.15em}.step-indicators[data-v-768e54ca]{display:flex;gap:0.5rem}.step-dot[data-v-768e54ca]{width:2rem;height:0.375rem;border-radius:2px;background:rgba(55,58,64,0.8);transition:all 0.3s ease}.step-dot.active[data-v-768e54ca]{background:rgba(114,137,218,0.6)}.step-dot.current[data-v-768e54ca]{background:rgba(114,137,218,1);box-shadow:0 0 8px rgba(114,137,218,0.5)}.creation-content[data-v-768e54ca]{flex:1;min-height:0;overflow-y:auto;padding:2rem;display:flex;flex-direction:column;align-items:center}.mode-selection[data-v-768e54ca]{display:grid;grid-template-columns:repeat(2,1fr);gap:2rem;max-width:56rem;width:100%}@media (max-width:768px){.mode-selection[data-v-768e54ca]{grid-template-columns:1fr;gap:1.5rem}}.mode-card[data-v-768e54ca]{position:relative;padding:2rem;border:1px solid rgba(114,137,218,0.2);border-radius:8px;background:linear-gradient(180deg,rgba(30,33,42,0.9) 0%,rgba(25,27,35,0.95) 100%);text-align:center;cursor:pointer;overflow:hidden;transition:all 0.3s ease}.mode-card[data-v-768e54ca]:hover{border-color:rgba(114,137,218,0.5);transform:translateY(-4px);box-shadow:0 8px 32px rgba(114,137,218,0.15)}.mode-card:hover .mode-glow[data-v-768e54ca]{opacity:1}.mode-glow[data-v-768e54ca]{position:absolute;inset:0;background:radial-gradient(circle at 50% 30%,rgba(114,137,218,0.1) 0%,transparent 60%);opacity:0;transition:opacity 0.3s ease;pointer-events:none}.mode-icon[data-v-768e54ca]{font-size:3rem;margin-bottom:1rem}.mode-title[data-v-768e54ca]{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:0.25rem;letter-spacing:0.1em}.mode-subtitle[data-v-768e54ca]{font-size:0.875rem;color:rgba(114,137,218,0.8);margin-bottom:1rem;letter-spacing:0.05em}.mode-desc[data-v-768e54ca]{font-size:0.875rem;color:rgba(160,170,190,0.8);line-height:1.6}.creation-footer[data-v-768e54ca]{display:flex;justify-content:space-between;padding:1rem 1.5rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom,0));border-top:1px solid rgba(114,137,218,0.2);background:linear-gradient(180deg,rgba(15,17,22,0.9) 0%,rgba(20,22,28,0.95) 100%)}.footer-btn[data-v-768e54ca]{padding:0.75rem 1.5rem;border-radius:4px;font-size:1rem;font-weight:500;letter-spacing:0.1em;cursor:pointer;transition:all 0.2s ease}.footer-btn.secondary[data-v-768e54ca]{border:1px solid rgba(114,137,218,0.3);background:transparent;color:rgba(180,190,210,0.8)}.footer-btn.secondary[data-v-768e54ca]:hover{border-color:rgba(114,137,218,0.5);background:rgba(114,137,218,0.1);color:#fff}.footer-btn.primary[data-v-768e54ca]{border:1px solid rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(114,137,218,0.2) 0%,rgba(90,110,180,0.15) 100%);color:#fff}.footer-btn.primary[data-v-768e54ca]:hover{border-color:rgba(114,137,218,0.7);background:linear-gradient(180deg,rgba(114,137,218,0.3) 0%,rgba(90,110,180,0.25) 100%);box-shadow:0 4px 20px rgba(114,137,218,0.2)}.footer-btn.finish[data-v-768e54ca]{border:1px solid rgba(76,175,80,0.4);background:linear-gradient(180deg,rgba(76,175,80,0.2) 0%,rgba(60,140,64,0.15) 100%);color:#fff}.footer-btn.finish[data-v-768e54ca]:hover{border-color:rgba(76,175,80,0.7);background:linear-gradient(180deg,rgba(76,175,80,0.3) 0%,rgba(60,140,64,0.25) 100%);box-shadow:0 4px 20px rgba(76,175,80,0.2)}.footer-btn.disabled[data-v-768e54ca]{border:1px solid rgba(100,100,100,0.3);background:rgba(50,50,50,0.5);color:rgba(120,120,120,0.6);cursor:not-allowed}.shop-item-icon[data-v-768e54ca]{background-repeat:no-repeat;flex-shrink:0}.quality-border-common[data-v-768e54ca]{border:2px solid #4a4a4a}.quality-border-uncommon[data-v-768e54ca]{border:2px solid #1eff00;box-shadow:0 0 8px rgba(30,255,0,0.3)}.quality-border-rare[data-v-768e54ca]{border:2px solid #0070dd;box-shadow:0 0 8px rgba(0,112,221,0.3)}.quality-border-epic[data-v-768e54ca]{border:2px solid #a335ee;box-shadow:0 0 8px rgba(163,53,238,0.3)}.quality-border-legendary[data-v-768e54ca]{border:2px solid #ff8000;box-shadow:0 0 8px rgba(255,128,0,0.3)}.quality-border-mythic[data-v-768e54ca]{border:2px solid #e6cc80;box-shadow:0 0 8px rgba(230,204,128,0.3)}.quality-common[data-v-768e54ca]{color:#9d9d9d}.quality-uncommon[data-v-768e54ca]{color:#1eff00}.quality-rare[data-v-768e54ca]{color:#0070dd}.quality-epic[data-v-768e54ca]{color:#a335ee}.quality-legendary[data-v-768e54ca]{color:#ff8000}.quality-mythic[data-v-768e54ca]{color:#e6cc80}.creation-content[data-v-768e54ca]::-webkit-scrollbar{width:8px}.creation-content[data-v-768e54ca]::-webkit-scrollbar-track{background:rgba(10,10,15,0.5)}.creation-content[data-v-768e54ca]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:4px}.creation-content[data-v-768e54ca]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}@media (max-width:640px){.creation-header[data-v-768e54ca]{flex-direction:column;gap:0.75rem;padding:0.75rem 1rem}.back-btn[data-v-768e54ca]{position:absolute;left:1rem;top:0.75rem;padding:0.375rem 0.75rem}.back-text[data-v-768e54ca]{display:none}.header-title[data-v-768e54ca]{font-size:1rem}.step-indicators[data-v-768e54ca]{margin-top:0.5rem}.step-dot[data-v-768e54ca]{width:1.5rem}.creation-content[data-v-768e54ca]{padding:1rem}.footer-btn[data-v-768e54ca]{padding:0.625rem 1rem;font-size:0.875rem}}

.battle-log-drawer[data-v-92dc781c]{position:relative;z-index:20}.handle-bar[data-v-92dc781c]{height:24px}.handle-icon[data-v-92dc781c]{transition:transform 0.3s ease}.custom-scrollbar[data-v-92dc781c]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-92dc781c]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[data-v-92dc781c]::-webkit-scrollbar-thumb{background:#40444b;border-radius:2px}.log-entry[data-v-92dc781c]{transition:background-color 0.2s ease}.log-entry[data-v-92dc781c]:hover{background-color:rgba(255,255,255,0.05)}.log-entry-content[data-v-92dc781c]{overflow:hidden}.log-text[data-v-92dc781c]{word-break:break-word}.log-details[data-v-92dc781c]{opacity:0.7;font-style:italic}.border-orange-500\/50 .log-icon[data-v-92dc781c]{animation:pulse-92dc781c 1s ease-in-out}@keyframes pulse-92dc781c{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}

.top-bar-btn[data-v-732e41ce]{border:1px solid #374151;background-color:#36393f}.top-bar-btn.inactive[data-v-732e41ce]{color:#6b7280}.top-bar-btn.inactive[data-v-732e41ce]:hover{border-color:#6b7280;color:#d1d5db}.top-bar-btn.active[data-v-732e41ce]{border-color:rgba(234,179,8,0.5);color:#facc15;box-shadow:0 0 8px rgba(255,200,0,0.4),0 0 16px rgba(255,200,0,0.2),inset 0 0 4px rgba(255,200,0,0.1);animation:glow-pulse-732e41ce 2s ease-in-out infinite}@keyframes glow-pulse-732e41ce{0%,100%{box-shadow:0 0 8px rgba(255,200,0,0.4),0 0 16px rgba(255,200,0,0.2),inset 0 0 4px rgba(255,200,0,0.1)}50%{box-shadow:0 0 12px rgba(255,200,0,0.6),0 0 24px rgba(255,200,0,0.3),inset 0 0 6px rgba(255,200,0,0.15)}}

.avatar-image[data-v-1c57ac4f]{image-rendering:-webkit-optimize-contrast;image-rendering:smooth;backface-visibility:hidden;transform:translateZ(0)}.avatar-display[data-v-1c57ac4f]{transform:translateZ(0);-webkit-font-smoothing:antialiased}

.combatant-detail-overlay[data-v-46d08669]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:flex-end;justify-content:center;z-index:1000;padding:0}@media (min-width:640px){.combatant-detail-overlay[data-v-46d08669]{align-items:center;padding:16px}}.combatant-detail-modal[data-v-46d08669]{background:#2f3136;border-radius:16px 16px 0 0;width:100%;max-width:100%;max-height:85vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 -4px 32px rgba(0,0,0,0.5);will-change:transform}.swipe-handle[data-v-46d08669]{display:flex;justify-content:center;padding:8px 0 4px;cursor:grab}.handle-bar[data-v-46d08669]{width:40px;height:4px;background:#72767d;border-radius:2px}@media (min-width:640px){.combatant-detail-modal[data-v-46d08669]{border-radius:12px;max-width:480px;max-height:90vh;box-shadow:0 8px 32px rgba(0,0,0,0.5)}}.modal-header[data-v-46d08669]{padding:16px;border-bottom:1px solid #202225}.header-player[data-v-46d08669]{background:linear-gradient(135deg,#2a3a5a 0%,#1a2840 100%)}.header-ally[data-v-46d08669]{background:linear-gradient(135deg,#2d4a3a 0%,#1e3528 100%)}.header-enemy[data-v-46d08669]{background:linear-gradient(135deg,#5a2a2a 0%,#401818 100%)}.modal-content[data-v-46d08669]{flex:1;overflow-y:auto;padding:16px}.content-section[data-v-46d08669]{margin-bottom:20px}.content-section[data-v-46d08669]:last-child{margin-bottom:0}.section-title[data-v-46d08669]{font-size:14px;font-weight:600;color:#7289da;margin-bottom:12px;display:flex;align-items:center;gap:6px}.modal-footer[data-v-46d08669]{padding:12px 16px;background:#202225;display:flex;gap:8px}.action-btn[data-v-46d08669]{flex:1;padding:10px 16px;border-radius:6px;font-size:13px;font-weight:600;border:none;cursor:pointer;transition:all 0.2s}.close-btn[data-v-46d08669]{background:#40444b;color:#dcddde}.close-btn[data-v-46d08669]:hover{background:#4f545c}.modal-enter-active[data-v-46d08669]{transition:opacity 0.15s ease-out}.modal-leave-active[data-v-46d08669]{transition:opacity 0.1s ease-in}.modal-enter-from[data-v-46d08669],.modal-leave-to[data-v-46d08669]{opacity:0}@media (max-width:639px){.modal-enter-active[data-v-46d08669]{transition:opacity 0.15s ease-out}.modal-enter-active .combatant-detail-modal[data-v-46d08669]{transition:transform 0.2s ease-out}.modal-leave-active .combatant-detail-modal[data-v-46d08669]{transition:transform 0.15s ease-in}.modal-enter-from .combatant-detail-modal[data-v-46d08669]{transform:translateY(100%)}.modal-leave-to .combatant-detail-modal[data-v-46d08669]{transform:translateY(100%)}}@supports (padding-bottom:env(safe-area-inset-bottom)){.modal-footer[data-v-46d08669]{padding-bottom:calc(12px + env(safe-area-inset-bottom))}}.custom-scrollbar[data-v-46d08669]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-46d08669]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[data-v-46d08669]::-webkit-scrollbar-thumb{background:#40444b;border-radius:3px}.custom-scrollbar[data-v-46d08669]::-webkit-scrollbar-thumb:hover{background:#4f545c}

.dice-overlay[data-v-4d58fc00]{position:absolute;top:0;left:0;width:100%;height:100%;display:none;z-index:200}.dice-overlay.show[data-v-4d58fc00]{display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7)}.dice-roller-container[data-v-4d58fc00]{width:80px;height:80px;position:relative;perspective:1200px}.dice-icosahedron[data-v-4d58fc00]{width:100%;height:100%;position:absolute;transform-style:preserve-3d}.dice-icosahedron .face[data-v-4d58fc00]{position:absolute;width:calc(80px * 1.01);height:calc(80px * 1.01 * 0.866);background:linear-gradient(135deg,#a8a8a8,#4a4a4a);left:50%;top:50%;margin-left:calc(80px * 1.01 / -2);margin-top:calc(80px * 1.01 * 0.866 / -2);display:flex;align-items:center;justify-content:center;color:white;font-size:28px;font-weight:bold;text-shadow:1px 1px 1px #2a2a2a,-1px -1px 1px #d8d8d8}.dice-icosahedron .face.up[data-v-4d58fc00]{clip-path:polygon(50% 0%,0% 100%,100% 100%);transform-origin:50% 66.666%}.dice-icosahedron .face.down[data-v-4d58fc00]{clip-path:polygon(0% 0%,100% 0%,50% 100%);transform-origin:50% 33.333%}.dice-icosahedron .face[data-v-4d58fc00]::before{content:attr(data-value);transform:scale(0.9);width:100%;text-align:center}.dice-icosahedron .face.up[data-v-4d58fc00]::before{transform:translateY(15%) scale(0.9)}.dice-icosahedron .face.down[data-v-4d58fc00]::before{transform:translateY(-15%) scale(0.9)}.face-1[data-v-4d58fc00]{transform:rotateY(0deg) rotateX(52.6deg) translateY(calc(13.6 / 152 * 80px * -1)) translateZ(calc(132.5 / 152 * 80px))}.face-2[data-v-4d58fc00]{transform:rotateY(72deg) rotateX(52.6deg) translateY(calc(13.6 / 152 * 80px * -1)) translateZ(calc(132.5 / 152 * 80px))}.face-3[data-v-4d58fc00]{transform:rotateY(144deg) rotateX(52.6deg) translateY(calc(13.6 / 152 * 80px * -1)) translateZ(calc(132.5 / 152 * 80px))}.face-4[data-v-4d58fc00]{transform:rotateY(216deg) rotateX(52.6deg) translateY(calc(13.6 / 152 * 80px * -1)) translateZ(calc(132.5 / 152 * 80px))}.face-5[data-v-4d58fc00]{transform:rotateY(288deg) rotateX(52.6deg) translateY(calc(13.6 / 152 * 80px * -1)) translateZ(calc(132.5 / 152 * 80px))}.face-6[data-v-4d58fc00]{transform:rotateY(36deg) rotateX(-10.9deg) translateY(calc(22.2 / 152 * 80px * -1)) translateZ(calc(111.1 / 152 * 80px))}.face-7[data-v-4d58fc00]{transform:rotateY(108deg) rotateX(-10.9deg) translateY(calc(22.2 / 152 * 80px * -1)) translateZ(calc(111.1 / 152 * 80px))}.face-8[data-v-4d58fc00]{transform:rotateY(180deg) rotateX(-10.9deg) translateY(calc(22.2 / 152 * 80px * -1)) translateZ(calc(111.1 / 152 * 80px))}.face-9[data-v-4d58fc00]{transform:rotateY(252deg) rotateX(-10.9deg) translateY(calc(22.2 / 152 * 80px * -1)) translateZ(calc(111.1 / 152 * 80px))}.face-10[data-v-4d58fc00]{transform:rotateY(324deg) rotateX(-10.9deg) translateY(calc(22.2 / 152 * 80px * -1)) translateZ(calc(111.1 / 152 * 80px))}.face-11[data-v-4d58fc00]{transform:rotateY(0deg) rotateX(10.9deg) translateY(calc(22.2 / 152 * 80px)) translateZ(calc(111.1 / 152 * 80px))}.face-12[data-v-4d58fc00]{transform:rotateY(72deg) rotateX(10.9deg) translateY(calc(22.2 / 152 * 80px)) translateZ(calc(111.1 / 152 * 80px))}.face-13[data-v-4d58fc00]{transform:rotateY(144deg) rotateX(10.9deg) translateY(calc(22.2 / 152 * 80px)) translateZ(calc(111.1 / 152 * 80px))}.face-14[data-v-4d58fc00]{transform:rotateY(216deg) rotateX(10.9deg) translateY(calc(22.2 / 152 * 80px)) translateZ(calc(111.1 / 152 * 80px))}.face-15[data-v-4d58fc00]{transform:rotateY(288deg) rotateX(10.9deg) translateY(calc(22.2 / 152 * 80px)) translateZ(calc(111.1 / 152 * 80px))}.face-16[data-v-4d58fc00]{transform:rotateY(36deg) rotateX(-52.6deg) translateY(calc(13.6 / 152 * 80px)) translateZ(calc(132.5 / 152 * 80px))}.face-17[data-v-4d58fc00]{transform:rotateY(108deg) rotateX(-52.6deg) translateY(calc(13.6 / 152 * 80px)) translateZ(calc(132.5 / 152 * 80px))}.face-18[data-v-4d58fc00]{transform:rotateY(180deg) rotateX(-52.6deg) translateY(calc(13.6 / 152 * 80px)) translateZ(calc(132.5 / 152 * 80px))}.face-19[data-v-4d58fc00]{transform:rotateY(252deg) rotateX(-52.6deg) translateY(calc(13.6 / 152 * 80px)) translateZ(calc(132.5 / 152 * 80px))}.face-20[data-v-4d58fc00]{transform:rotateY(324deg) rotateX(-52.6deg) translateY(calc(13.6 / 152 * 80px)) translateZ(calc(132.5 / 152 * 80px))}.dice-result-text[data-v-4d58fc00]{position:absolute;font-size:24px;color:white;font-weight:bold;text-shadow:2px 2px 3px black;opacity:0;pointer-events:none;transition:color 0.3s ease}.dice-result-text.show[data-v-4d58fc00]{animation:reveal-result-4d58fc00 1.2s ease-out forwards}.dice-result-text.crit[data-v-4d58fc00]{color:#ffd700;animation:reveal-result-4d58fc00 1.2s ease-out forwards,result-glow-crit-4d58fc00 1.2s ease-in-out}.dice-result-text.fumble[data-v-4d58fc00]{color:#f44336;animation:reveal-result-4d58fc00 1.2s ease-out forwards,result-glow-fumble-4d58fc00 1.2s ease-in-out}@keyframes reveal-result-4d58fc00{0%{transform:scale(0.5);opacity:0}50%{transform:scale(1.5);opacity:1}100%{transform:scale(1.5);opacity:0}}@keyframes result-glow-crit-4d58fc00{0%,100%{text-shadow:2px 2px 3px black,0 0 0px #ffd700}50%{text-shadow:2px 2px 3px black,0 0 20px #ffd700,0 0 10px white}}@keyframes result-glow-fumble-4d58fc00{0%,100%{text-shadow:2px 2px 3px black,0 0 0px #f44336}50%{text-shadow:2px 2px 3px black,0 0 20px #f44336,0 0 10px white}}

.fade-enter-active[data-v-331054ae],.fade-leave-active[data-v-331054ae]{transition:opacity 0.5s,transform 0.5s}.fade-enter-from[data-v-331054ae]{opacity:0;transform:scale(0.5)}.fade-leave-to[data-v-331054ae]{opacity:0;transform:translateY(-20px)}.effect-sprite[data-v-331054ae]{width:64px;height:64px;background-size:contain;background-repeat:no-repeat;animation:effect-pulse-331054ae 0.5s ease-out}@keyframes effect-pulse-331054ae{0%{transform:scale(0.5);opacity:1}50%{transform:scale(1.2);opacity:0.8}100%{transform:scale(1);opacity:0.6}}.floating-text[data-v-331054ae]{position:absolute;top:-20px;left:50%;transform:translateX(-50%);font-weight:bold;font-size:20px;text-shadow:1px 1px 2px black;pointer-events:none;animation:float-up-331054ae 1s ease-out forwards}@keyframes float-up-331054ae{0%{opacity:1;transform:translateX(-50%) translateY(0)}100%{opacity:0;transform:translateX(-50%) translateY(-30px)}}.floating-text.crit[data-v-331054ae]{font-size:28px;animation:crit-float-331054ae 1s ease-out forwards}@keyframes crit-float-331054ae{0%{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}30%{transform:translateX(-50%) translateY(-10px) scale(1.3)}100%{opacity:0;transform:translateX(-50%) translateY(-40px) scale(1)}}

.modal-enter-active[data-v-d870dc00]{transition:opacity 0.15s ease-out}.modal-enter-active .skill-modal[data-v-d870dc00]{transition:transform 0.2s ease-out}.modal-leave-active[data-v-d870dc00]{transition:opacity 0.1s ease-in}.modal-leave-active .skill-modal[data-v-d870dc00]{transition:transform 0.1s ease-in}.modal-enter-from[data-v-d870dc00],.modal-leave-to[data-v-d870dc00]{opacity:0}.modal-enter-from .skill-modal[data-v-d870dc00]{transform:translateY(100%)}.modal-leave-to .skill-modal[data-v-d870dc00]{transform:translateY(20px)}.modal-enter-to .skill-modal[data-v-d870dc00],.modal-leave-from .skill-modal[data-v-d870dc00]{transform:translateY(0)}@media (min-width:768px){.modal-enter-from .skill-modal[data-v-d870dc00]{transform:scale(0.95) translateY(10px)}.modal-leave-to .skill-modal[data-v-d870dc00]{transform:scale(0.95) translateY(10px)}}.custom-scrollbar[data-v-d870dc00]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-d870dc00]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[data-v-d870dc00]::-webkit-scrollbar-thumb{background:#40444b;border-radius:3px}.custom-scrollbar[data-v-d870dc00]::-webkit-scrollbar-thumb:hover{background:#5a5f69}.skill-card[data-v-d870dc00]{transition:all 0.2s ease}.skill-card[data-v-d870dc00]:not(:disabled):hover{transform:translateX(4px)}

.action-btn[data-v-594fc2cc]{transition:all 0.2s ease}.action-btn[data-v-594fc2cc]:hover{transform:translateY(-2px)}.action-btn[data-v-594fc2cc]:active{transform:translateY(0)}.slide-down-enter-active[data-v-594fc2cc],.slide-down-leave-active[data-v-594fc2cc]{transition:all 0.3s ease}.slide-down-enter-from[data-v-594fc2cc],.slide-down-leave-to[data-v-594fc2cc]{opacity:0;transform:translateX(-50%) translateY(-10px)}@keyframes shake-594fc2cc{0%,100%{transform:translateX(0)}25%,75%{transform:translateX(-2px)}50%{transform:translateX(2px)}}.animate-shake[data-v-594fc2cc]{animation:shake-594fc2cc 0.3s ease-in-out}

.modal-enter-active[data-v-d471d57a],.modal-leave-active[data-v-d471d57a]{transition:all 0.3s ease}.modal-enter-from[data-v-d471d57a],.modal-leave-to[data-v-d471d57a]{opacity:0}.modal-enter-from>div[data-v-d471d57a],.modal-leave-to>div[data-v-d471d57a]{transform:scale(0.9)}.custom-scrollbar[data-v-d471d57a]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-d471d57a]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[data-v-d471d57a]::-webkit-scrollbar-thumb{background:#40444b;border-radius:2px}

.modal-fade-enter-active[data-v-15909d2c],.modal-fade-leave-active[data-v-15909d2c]{transition:all 0.3s ease}.modal-fade-enter-from[data-v-15909d2c],.modal-fade-leave-to[data-v-15909d2c]{opacity:0}.modal-fade-enter-from>div[data-v-15909d2c],.modal-fade-leave-to>div[data-v-15909d2c]{transform:scale(0.95) translateY(-10px)}

.animate-fade-in[data-v-3c06f73b]{animation:fadeIn-3c06f73b 0.2s ease-out}@keyframes fadeIn-3c06f73b{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}.item-sprite[data-v-3c06f73b]{background-repeat:no-repeat;image-rendering:pixelated}

.modal-fade-enter-active[data-v-078f7cf0],.modal-fade-leave-active[data-v-078f7cf0]{transition:all 0.3s ease}.modal-fade-enter-from[data-v-078f7cf0],.modal-fade-leave-to[data-v-078f7cf0]{opacity:0}.modal-fade-enter-from>div[data-v-078f7cf0],.modal-fade-leave-to>div[data-v-078f7cf0]{transform:scale(0.95) translateY(-10px)}

.custom-scrollbar[data-v-53479805]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-53479805]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[data-v-53479805]::-webkit-scrollbar-thumb{background:#4a4d52;border-radius:2px}.custom-scrollbar[data-v-53479805]::-webkit-scrollbar-thumb:hover{background:#5c5f66}.avatar-image[data-v-53479805]{image-rendering:-webkit-optimize-contrast;image-rendering:smooth;backface-visibility:hidden}.avatar-preview-container[data-v-53479805]{transform:translateZ(0);will-change:transform}.lightbox-fade-enter-active[data-v-53479805]{transition:opacity 0.2s ease-out}.lightbox-fade-enter-active .lightbox-content[data-v-53479805]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.lightbox-fade-leave-active[data-v-53479805]{transition:opacity 0.15s ease-in}.lightbox-fade-leave-active .lightbox-content[data-v-53479805]{transition:transform 0.15s ease-in}.lightbox-fade-enter-from[data-v-53479805],.lightbox-fade-leave-to[data-v-53479805]{opacity:0}.lightbox-fade-enter-from .lightbox-content[data-v-53479805]{transform:scale(0.9)}.lightbox-fade-leave-to .lightbox-content[data-v-53479805]{transform:scale(0.95)}.lightbox-image[data-v-53479805]{image-rendering:auto;image-rendering:high-quality;backface-visibility:hidden}.lightbox-overlay[data-v-53479805]{backdrop-filter:blur(4px)}

.message-bubble{padding:0.875rem 1rem;border-radius:0.5rem;transition:all 0.2s ease}.message-bubble.no-select{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-touch-callout:none}.message-bubble.select-text{user-select:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}.message-bubble.compact{padding:0.5rem 0.75rem}.message-bubble.ai-message{width:100%;max-width:100%;background:linear-gradient(180deg,rgba(40,43,52,0.95) 0%,rgba(35,38,47,0.98) 100%);border:1px solid rgba(75,85,99,0.3);border-left:3px solid rgba(114,137,218,0.5);color:rgba(210,215,230,0.95);box-shadow:0 2px 8px rgba(0,0,0,0.15)}.message-bubble.user-message{margin-left:auto;max-width:90%;background:linear-gradient(180deg,rgba(55,65,90,0.9) 0%,rgba(45,55,80,0.95) 100%);border:1px solid rgba(114,137,218,0.3);border-right:3px solid rgba(114,137,218,0.6);border-top-right-radius:0;color:rgba(180,200,255,0.95);box-shadow:0 2px 8px rgba(114,137,218,0.1)}.message-bubble:hover{border-color:rgba(114,137,218,0.4)}.loading-indicator-wrapper{position:fixed;bottom:5rem;left:50%;transform:translateX(-50%);z-index:30}.loading-indicator{display:flex;align-items:center;gap:0.625rem;padding:0.625rem 1rem;background:linear-gradient(180deg,rgba(35,38,48,0.98) 0%,rgba(30,33,42,0.99) 100%);border:1px solid rgba(114,137,218,0.3);border-radius:2rem;box-shadow:0 4px 16px rgba(0,0,0,0.3),0 0 0 1px rgba(255,255,255,0.05) inset;backdrop-filter:blur(8px)}.loading-dots{display:flex;gap:0.25rem}.loading-dot{width:0.375rem;height:0.375rem;border-radius:50%;background:rgba(114,137,218,0.8);animation:bounce 1s ease-in-out infinite}@keyframes bounce{0%,100%{transform:translateY(0);opacity:0.6}50%{transform:translateY(-4px);opacity:1}}.loading-text{font-size:0.75rem;font-weight:500;color:rgba(200,210,230,0.9);letter-spacing:0.025em;white-space:nowrap}.context-menu{position:fixed;z-index:9999;min-width:160px;overflow:hidden;border-radius:0.5rem;border:1px solid rgba(114,137,218,0.2);background:linear-gradient(180deg,rgba(35,38,48,0.98) 0%,rgba(28,31,40,0.99) 100%);box-shadow:0 8px 32px rgba(0,0,0,0.4),0 0 0 1px rgba(255,255,255,0.05) inset;backdrop-filter:blur(12px)}.context-menu-inner{padding:0.375rem 0}.context-menu-item{display:flex;align-items:center;gap:0.75rem;width:100%;padding:0.625rem 1rem;font-size:0.875rem;color:rgba(200,210,230,0.9);background:transparent;border:none;cursor:pointer;transition:all 0.15s ease;text-align:left}.context-menu-item:hover{background:rgba(114,137,218,0.15);color:#fff}.context-menu-item:hover .menu-icon{color:rgba(114,137,218,0.9)}.context-menu-item.danger{color:rgba(248,113,113,0.9)}.context-menu-item.danger:hover{background:rgba(239,68,68,0.15);color:rgba(252,165,165,1)}.context-menu-item.danger:hover .menu-icon{color:rgba(248,113,113,1)}.menu-icon{width:1rem;height:1rem;color:rgba(140,150,170,0.7);transition:color 0.15s ease}.context-menu-divider{height:1px;margin:0.375rem 0.75rem;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 50%,transparent 100%)}.markdown-content p{margin-bottom:0.5em}.markdown-content p:last-child{margin-bottom:0}.markdown-content em{font-style:italic;color:rgba(160,174,192,0.9)}.markdown-content strong{font-weight:bold;color:#e2e8f0}.markdown-content .chat-image{display:block;max-width:100%;max-height:80vh;width:auto;height:auto;border-radius:0.5rem;margin:0.5rem 0;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(0,0,0,0.3);image-rendering:-webkit-optimize-contrast;image-rendering:smooth;backface-visibility:hidden;transform:translateZ(0);object-fit:contain}.markdown-content .chat-image:hover{opacity:0.9;transform:scale(1.02);box-shadow:0 4px 12px rgba(0,0,0,0.4)}.markdown-content .chat-image[loading]{background:linear-gradient(90deg,#374151 25%,#4b5563 50%,#374151 75%);background-size:200% 100%;animation:image-loading 1.5s infinite}@keyframes image-loading{0%{background-position:200% 0}100%{background-position:-200% 0}}.markdown-content .text-danger{color:#ef4444}.markdown-content .text-warning{color:#f59e0b}.markdown-content .text-success{color:#10b981}.markdown-content .text-info{color:#3b82f6}.markdown-content .text-magic{color:#a855f7}.markdown-content .text-gold{color:#fbbf24}.markdown-content .text-silver{color:#9ca3af}.markdown-content blockquote{position:relative;margin:0.5rem 0;padding:0.625rem 1rem;border-left:3px solid rgba(114,137,218,0.5);background:linear-gradient(90deg,rgba(114,137,218,0.08) 0%,transparent 100%);border-radius:0 0.25rem 0.25rem 0;font-style:italic;color:rgba(180,190,220,0.85)}.markdown-content pre{position:relative;margin:0.75rem 0;padding:1rem;background:linear-gradient(180deg,rgba(20,22,28,0.95) 0%,rgba(15,17,22,0.98) 100%);border:1px solid rgba(75,85,99,0.4);border-left:3px solid rgba(114,137,218,0.4);border-radius:0.375rem;overflow-x:auto;font-size:0.875rem;line-height:1.6}.markdown-content pre code{background:transparent;padding:0;border:none;color:rgba(229,231,235,0.95)}.markdown-content code{background:rgba(114,137,218,0.1);padding:0.125rem 0.5rem;border-radius:0.25rem;font-size:0.875em;font-family:'Fira Code','Monaco','Consolas',monospace;color:rgba(167,139,250,0.95);border:1px solid rgba(114,137,218,0.2)}.markdown-content del{text-decoration:line-through;color:#6b7280;opacity:0.7}.markdown-content u{text-decoration:underline;text-decoration-color:#6b7280}.markdown-content hr{border:none;border-top:1px solid rgba(75,85,99,0.5);margin:1rem 0}.modal-fade-enter-active,.modal-fade-leave-active{transition:opacity 0.2s ease}.modal-fade-enter-active .max-w-md,.modal-fade-leave-active .max-w-md{transition:transform 0.2s ease,opacity 0.2s ease}.modal-fade-enter-from,.modal-fade-leave-to{opacity:0}.modal-fade-enter-from .max-w-md{transform:scale(0.95) translateY(-10px);opacity:0}.modal-fade-leave-to .max-w-md{transform:scale(0.95) translateY(10px);opacity:0}.fade-slide-enter-active,.fade-slide-leave-active{transition:all 0.3s ease}.fade-slide-enter-from,.fade-slide-leave-to{opacity:0;transform:translateY(20px)}.loading-slide-enter-active,.loading-slide-leave-active{transition:all 0.3s ease}.loading-slide-enter-from{opacity:0;transform:translateX(-50%) translateY(20px)}.loading-slide-leave-to{opacity:0;transform:translateX(-50%) translateY(-10px)}.markdown-content .chat-image{will-change:transform,opacity;transform:translateZ(0)}.image-preview-container{position:relative;display:flex;align-items:center;justify-content:center}.image-preview-container img{animation:image-zoom-in 0.2s ease-out}@keyframes image-zoom-in{from{transform:scale(0.9);opacity:0}to{transform:scale(1);opacity:1}}

.modal-fade-enter-active[data-v-5e9fbc0e],.modal-fade-leave-active[data-v-5e9fbc0e]{transition:all 0.3s ease}.modal-fade-enter-from[data-v-5e9fbc0e],.modal-fade-leave-to[data-v-5e9fbc0e]{opacity:0}.modal-fade-enter-from>div[data-v-5e9fbc0e],.modal-fade-leave-to>div[data-v-5e9fbc0e]{transform:scale(0.95) translateY(-10px)}

.fixed[data-v-051eebbe]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%) !important;backdrop-filter:blur(6px)}.fixed>div[data-v-051eebbe]{background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%) !important;border:1px solid rgba(114,137,218,0.25) !important;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset !important}.fixed>div>div[data-v-051eebbe]:first-child{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%) !important;border-bottom:1px solid rgba(114,137,218,0.2) !important;position:relative}.fixed>div>div[data-v-051eebbe]:first-child::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(114,137,218,0.08) 0%,transparent 100%);pointer-events:none;border-radius:inherit}.fixed .rounded-full.bg-red-500[data-v-051eebbe]{background:linear-gradient(180deg,rgba(239,68,68,0.9) 0%,rgba(220,50,50,0.8) 100%) !important;box-shadow:0 0 10px rgba(239,68,68,0.3)}.fixed>div>div[data-v-051eebbe]:nth-child(2){background:rgba(25,27,35,0.5)}.fixed .text-gray-500[data-v-051eebbe]{color:rgba(150,160,180,0.6) !important}.fixed .text-gray-600[data-v-051eebbe]{color:rgba(120,130,150,0.5) !important}.fixed .bg-\[\#2f3136\][data-v-051eebbe]{background:rgba(30,33,40,0.8) !important;border:1px solid rgba(114,137,218,0.1);transition:all 0.2s ease}.fixed .bg-\[\#2f3136\][data-v-051eebbe]:hover{background:rgba(40,45,55,0.9) !important;border-color:rgba(114,137,218,0.25)}.fixed button[title='撤销此指令'][data-v-051eebbe]{transition:all 0.2s ease}.fixed button[title='撤销此指令'][data-v-051eebbe]:hover{background:rgba(239,68,68,0.15) !important;color:rgba(239,68,68,0.9) !important}.fixed>div>div[data-v-051eebbe]:last-child{background:rgba(15,17,22,0.95) !important;border-top:1px solid rgba(114,137,218,0.15) !important}.fixed button[class*='bg-red-500/20'][data-v-051eebbe]{background:linear-gradient(180deg,rgba(239,68,68,0.15) 0%,rgba(220,50,50,0.1) 100%) !important;border:1px solid rgba(239,68,68,0.3);transition:all 0.2s ease}.fixed button[class*='bg-red-500/20'][data-v-051eebbe]:hover{background:linear-gradient(180deg,rgba(239,68,68,0.25) 0%,rgba(220,50,50,0.2) 100%) !important;border-color:rgba(239,68,68,0.5)}.fixed button[class*='bg-[#5865F2]'][data-v-051eebbe]{background:linear-gradient(180deg,rgba(114,137,218,0.35) 0%,rgba(90,110,180,0.3) 100%) !important;border:1px solid rgba(114,137,218,0.5);transition:all 0.2s ease}.fixed button[class*='bg-[#5865F2]'][data-v-051eebbe]:hover{background:linear-gradient(180deg,rgba(114,137,218,0.45) 0%,rgba(90,110,180,0.4) 100%) !important;border-color:rgba(114,137,218,0.7);transform:translateY(-1px);box-shadow:0 4px 15px rgba(114,137,218,0.25)}.modal-fade-enter-active[data-v-051eebbe],.modal-fade-leave-active[data-v-051eebbe]{transition:opacity 0.25s ease}.modal-fade-enter-active>div[data-v-051eebbe],.modal-fade-leave-active>div[data-v-051eebbe]{transition:transform 0.25s ease,opacity 0.25s ease}.modal-fade-enter-from[data-v-051eebbe],.modal-fade-leave-to[data-v-051eebbe]{opacity:0}.modal-fade-enter-from>div[data-v-051eebbe]{transform:scale(0.95) translateY(10px);opacity:0}.modal-fade-leave-to>div[data-v-051eebbe]{transform:scale(0.98) translateY(5px);opacity:0}

.fixed[data-v-0064dcb2]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%) !important;backdrop-filter:blur(6px)}.gift-select-modal[data-v-0064dcb2]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%) !important;border:1px solid rgba(114,137,218,0.25) !important;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset !important}.gift-select-modal>div[data-v-0064dcb2]:first-child{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%) !important;border-bottom:1px solid rgba(114,137,218,0.2) !important}.overflow-y-auto[data-v-0064dcb2]::-webkit-scrollbar{width:6px}.overflow-y-auto[data-v-0064dcb2]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5);border-radius:3px}.overflow-y-auto[data-v-0064dcb2]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:3px}.overflow-y-auto[data-v-0064dcb2]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.modal-enter-active[data-v-0064dcb2]{transition:opacity 0.2s ease-out}.modal-enter-active .gift-select-modal[data-v-0064dcb2]{transition:transform 0.25s ease-out,opacity 0.25s ease-out}.modal-leave-active[data-v-0064dcb2]{transition:opacity 0.15s ease-in}.modal-leave-active .gift-select-modal[data-v-0064dcb2]{transition:transform 0.15s ease-in,opacity 0.15s ease-in}.modal-enter-from[data-v-0064dcb2],.modal-leave-to[data-v-0064dcb2]{opacity:0}.modal-enter-from .gift-select-modal[data-v-0064dcb2]{transform:scale(0.95) translateY(10px);opacity:0}.modal-leave-to .gift-select-modal[data-v-0064dcb2]{transform:scale(0.98) translateY(5px);opacity:0}

.item-detail-overlay[data-v-46a14417]{position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px);display:flex;align-items:flex-end;justify-content:center;z-index:1000;padding:0}@media (min-width:640px){.item-detail-overlay[data-v-46a14417]{align-items:center;padding:16px}}.item-detail-modal[data-v-46a14417]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);border:1px solid rgba(114,137,218,0.25);border-radius:16px 16px 0 0;width:100%;max-width:100%;max-height:70vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 -4px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset;will-change:transform}@media (min-width:640px){.item-detail-modal[data-v-46a14417]{border-radius:12px;max-width:480px;max-height:90vh;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset}}.swipe-handle[data-v-46a14417]{display:flex;justify-content:center;padding:6px 0 2px;cursor:grab}.handle-bar[data-v-46a14417]{width:36px;height:4px;background:rgba(114,137,218,0.4);border-radius:2px}.modal-header[data-v-46a14417]{padding:12px;border-bottom:1px solid rgba(114,137,218,0.15);position:relative}.modal-header[data-v-46a14417]::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(114,137,218,0.08) 0%,transparent 100%);pointer-events:none}@media (min-width:640px){.modal-header[data-v-46a14417]{padding:16px}}.quality-bg-common[data-v-46a14417]{background:linear-gradient(135deg,rgba(40,43,50,0.9) 0%,rgba(30,33,40,0.95) 100%)}.quality-bg-uncommon[data-v-46a14417]{background:linear-gradient(135deg,rgba(45,74,58,0.9) 0%,rgba(30,53,40,0.95) 100%)}.quality-bg-rare[data-v-46a14417]{background:linear-gradient(135deg,rgba(42,58,90,0.9) 0%,rgba(26,40,64,0.95) 100%)}.quality-bg-epic[data-v-46a14417]{background:linear-gradient(135deg,rgba(58,42,90,0.9) 0%,rgba(40,26,64,0.95) 100%)}.quality-bg-legendary[data-v-46a14417]{background:linear-gradient(135deg,rgba(90,74,42,0.9) 0%,rgba(64,50,24,0.95) 100%)}.quality-bg-mythic[data-v-46a14417]{background:linear-gradient(135deg,rgba(90,42,58,0.9) 0%,rgba(64,24,40,0.95) 100%)}.quality-border-common[data-v-46a14417]{border:2px solid rgba(150,160,180,0.4)}.quality-border-uncommon[data-v-46a14417]{border:2px solid rgba(74,222,128,0.5)}.quality-border-rare[data-v-46a14417]{border:2px solid rgba(96,165,250,0.5)}.quality-border-epic[data-v-46a14417]{border:2px solid rgba(167,139,250,0.5)}.quality-border-legendary[data-v-46a14417]{border:2px solid rgba(251,191,36,0.5)}.quality-border-mythic[data-v-46a14417]{border:2px solid rgba(244,114,182,0.5)}.item-icon[data-v-46a14417]{background-repeat:no-repeat;image-rendering:pixelated;background-color:rgba(20,22,28,0.8)}.quality-badge[data-v-46a14417]{padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600}.quality-stars[data-v-46a14417]{letter-spacing:1px}.modal-content[data-v-46a14417]{flex:1;overflow-y:auto;padding:12px;background:rgba(20,22,28,0.5)}@media (min-width:640px){.modal-content[data-v-46a14417]{padding:16px}}.content-section[data-v-46a14417]{margin-bottom:14px}@media (min-width:640px){.content-section[data-v-46a14417]{margin-bottom:20px}}.content-section[data-v-46a14417]:last-child{margin-bottom:0}.section-title[data-v-46a14417]{font-size:13px;font-weight:600;color:rgba(114,137,218,0.9);margin-bottom:8px;display:flex;align-items:center;gap:6px}@media (min-width:640px){.section-title[data-v-46a14417]{font-size:14px;margin-bottom:12px}}.effects-list[data-v-46a14417]{display:flex;flex-direction:column;gap:8px}@media (min-width:640px){.effects-list[data-v-46a14417]{gap:12px}}.effect-item[data-v-46a14417]{display:flex;gap:10px;padding:10px;background:rgba(30,33,40,0.8);border-radius:8px;border-left:3px solid rgba(114,137,218,0.6);border:1px solid rgba(114,137,218,0.15);border-left-width:3px;border-left-color:rgba(114,137,218,0.6)}@media (min-width:640px){.effect-item[data-v-46a14417]{gap:12px;padding:12px}}.effect-icons[data-v-46a14417]{display:flex;flex-direction:column;align-items:center;gap:4px;min-width:32px}.effect-info[data-v-46a14417]{flex:1}.effect-text[data-v-46a14417]{font-size:13px;color:rgba(200,210,230,0.9);line-height:1.5}.effect-meta[data-v-46a14417]{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}.meta-tag[data-v-46a14417]{font-size:10px;padding:2px 6px;border-radius:4px;font-weight:500}.meta-tag.trigger[data-v-46a14417]{background:rgba(114,137,218,0.3);color:rgba(114,137,218,0.95);border:1px solid rgba(114,137,218,0.4)}.meta-tag.chance[data-v-46a14417]{background:rgba(251,191,36,0.2);color:rgba(251,191,36,0.95);border:1px solid rgba(251,191,36,0.3)}.meta-tag.duration[data-v-46a14417]{background:rgba(74,222,128,0.2);color:rgba(74,222,128,0.95);border:1px solid rgba(74,222,128,0.3)}.properties-grid[data-v-46a14417]{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}@media (min-width:640px){.properties-grid[data-v-46a14417]{gap:8px}}.property-item[data-v-46a14417]{display:flex;justify-content:space-between;align-items:center;padding:6px 10px;background:rgba(30,33,40,0.8);border:1px solid rgba(114,137,218,0.1);border-radius:6px}@media (min-width:640px){.property-item[data-v-46a14417]{padding:8px 12px}}.property-label[data-v-46a14417]{font-size:11px;color:rgba(150,160,180,0.6)}@media (min-width:640px){.property-label[data-v-46a14417]{font-size:12px}}.property-value[data-v-46a14417]{font-size:11px;font-weight:600;color:rgba(200,210,230,0.9)}@media (min-width:640px){.property-value[data-v-46a14417]{font-size:12px}}.modal-footer[data-v-46a14417]{padding:10px 12px;background:rgba(15,17,22,0.95);border-top:1px solid rgba(114,137,218,0.15);display:flex;gap:6px;flex-wrap:wrap}@media (min-width:640px){.modal-footer[data-v-46a14417]{padding:12px 16px;gap:8px}}.action-btn[data-v-46a14417]{flex:1;min-width:50px;padding:8px 12px;border-radius:6px;font-size:12px;font-weight:600;border:1px solid transparent;cursor:pointer;transition:all 0.2s ease;position:relative;overflow:hidden}@media (min-width:640px){.action-btn[data-v-46a14417]{min-width:60px;padding:10px 16px;font-size:13px}}.use-btn[data-v-46a14417]{background:linear-gradient(180deg,rgba(74,222,128,0.25) 0%,rgba(34,197,94,0.2) 100%);border-color:rgba(74,222,128,0.4);color:rgba(74,222,128,0.95)}.use-btn[data-v-46a14417]:hover{background:linear-gradient(180deg,rgba(74,222,128,0.35) 0%,rgba(34,197,94,0.3) 100%);border-color:rgba(74,222,128,0.6);transform:translateY(-1px);box-shadow:0 4px 15px rgba(74,222,128,0.2)}.equip-btn[data-v-46a14417]{background:linear-gradient(180deg,rgba(114,137,218,0.25) 0%,rgba(90,110,180,0.2) 100%);border-color:rgba(114,137,218,0.4);color:rgba(114,137,218,0.95)}.equip-btn[data-v-46a14417]:hover:not(.disabled){background:linear-gradient(180deg,rgba(114,137,218,0.35) 0%,rgba(90,110,180,0.3) 100%);border-color:rgba(114,137,218,0.6);transform:translateY(-1px);box-shadow:0 4px 15px rgba(114,137,218,0.2)}.equip-btn.disabled[data-v-46a14417]{background:rgba(60,65,75,0.5);border-color:rgba(100,110,130,0.3);color:rgba(150,160,180,0.5);cursor:not-allowed}.discard-btn[data-v-46a14417]{background:linear-gradient(180deg,rgba(239,68,68,0.2) 0%,rgba(220,50,50,0.15) 100%);border-color:rgba(239,68,68,0.35);color:rgba(239,68,68,0.9)}.discard-btn[data-v-46a14417]:hover{background:linear-gradient(180deg,rgba(239,68,68,0.3) 0%,rgba(220,50,50,0.25) 100%);border-color:rgba(239,68,68,0.5);transform:translateY(-1px);box-shadow:0 4px 15px rgba(239,68,68,0.15)}.unequip-btn[data-v-46a14417]{background:linear-gradient(180deg,rgba(251,191,36,0.25) 0%,rgba(234,179,8,0.2) 100%);border-color:rgba(251,191,36,0.4);color:rgba(251,191,36,0.95)}.unequip-btn[data-v-46a14417]:hover:not(.disabled){background:linear-gradient(180deg,rgba(251,191,36,0.35) 0%,rgba(234,179,8,0.3) 100%);border-color:rgba(251,191,36,0.6);transform:translateY(-1px);box-shadow:0 4px 15px rgba(251,191,36,0.2)}.unequip-btn.disabled[data-v-46a14417]{background:rgba(60,65,75,0.5);border-color:rgba(100,110,130,0.3);color:rgba(150,160,180,0.5);cursor:not-allowed}.close-btn[data-v-46a14417]{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(40,43,52,0.9) 100%);border-color:rgba(114,137,218,0.2);color:rgba(180,190,210,0.8)}.close-btn[data-v-46a14417]:hover{background:linear-gradient(180deg,rgba(60,65,75,0.9) 0%,rgba(50,55,65,0.95) 100%);border-color:rgba(114,137,218,0.4);color:rgba(200,210,230,0.95)}.custom-scrollbar[data-v-46a14417]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-46a14417]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5)}.custom-scrollbar[data-v-46a14417]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:3px}.custom-scrollbar[data-v-46a14417]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.modal-enter-active[data-v-46a14417]{transition:opacity 0.2s ease-out}.modal-leave-active[data-v-46a14417]{transition:opacity 0.15s ease-in}.modal-enter-from[data-v-46a14417],.modal-leave-to[data-v-46a14417]{opacity:0}@media (max-width:639px){.modal-enter-active[data-v-46a14417]{transition:opacity 0.2s ease-out}.modal-enter-active .item-detail-modal[data-v-46a14417]{transition:transform 0.25s ease-out}.modal-leave-active .item-detail-modal[data-v-46a14417]{transition:transform 0.2s ease-in}.modal-enter-from .item-detail-modal[data-v-46a14417]{transform:translateY(100%)}.modal-leave-to .item-detail-modal[data-v-46a14417]{transform:translateY(100%)}}@supports (padding-bottom:env(safe-area-inset-bottom)){.modal-footer[data-v-46a14417]{padding-bottom:calc(12px + env(safe-area-inset-bottom))}}

.modal-fade-enter-active[data-v-f03fe5be]{transition:opacity 0.2s cubic-bezier(0.4,0,0.2,1)}.modal-fade-leave-active[data-v-f03fe5be]{transition:opacity 0.15s cubic-bezier(0.4,0,1,1)}.modal-fade-enter-from[data-v-f03fe5be],.modal-fade-leave-to[data-v-f03fe5be]{opacity:0}

.task-bubble-container[data-v-6e278c1c]{position:fixed;top:80px;left:16px;z-index:100;pointer-events:none}.task-bubble-list[data-v-6e278c1c]{display:flex;flex-direction:column;gap:8px}.task-bubble[data-v-6e278c1c]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(135deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%);border:1px solid rgba(114,137,218,0.3);border-radius:20px;box-shadow:0 4px 12px rgba(0,0,0,0.3),0 0 20px rgba(114,137,218,0.15) inset;backdrop-filter:blur(8px);font-size:0.8rem;color:rgba(180,190,210,0.9);pointer-events:auto;cursor:default;transition:all 0.2s ease;min-width:140px}.task-bubble.cancellable[data-v-6e278c1c]{cursor:pointer}.task-bubble.cancellable[data-v-6e278c1c]:hover{border-color:rgba(248,113,113,0.5);background:linear-gradient(135deg,rgba(40,35,38,0.95) 0%,rgba(35,30,35,0.98) 100%)}.task-bubble.status-running[data-v-6e278c1c]{border-color:rgba(114,137,218,0.5)}.task-bubble.status-completed[data-v-6e278c1c]{border-color:rgba(74,222,128,0.5);color:rgba(74,222,128,0.9)}.task-bubble.status-error[data-v-6e278c1c]{border-color:rgba(248,113,113,0.5);color:rgba(248,113,113,0.9)}.task-bubble.status-cancelled[data-v-6e278c1c]{border-color:rgba(150,150,150,0.5);color:rgba(150,150,150,0.9)}.bubble-icon[data-v-6e278c1c]{display:flex;align-items:center;justify-content:center;width:18px;height:18px;flex-shrink:0}.spinner[data-v-6e278c1c]{width:14px;height:14px;border:2px solid rgba(114,137,218,0.3);border-top-color:rgba(114,137,218,0.9);border-radius:50%;animation:spin-6e278c1c 0.8s linear infinite}@keyframes spin-6e278c1c{to{transform:rotate(360deg)}}.icon-done[data-v-6e278c1c]{color:#4ade80;font-size:1rem;font-weight:bold}.icon-error[data-v-6e278c1c]{color:#f87171;font-size:1rem;font-weight:bold}.icon-cancelled[data-v-6e278c1c]{color:#9ca3af;font-size:1rem}.icon-pending[data-v-6e278c1c]{color:rgba(114,137,218,0.6);font-size:0.9rem}.bubble-label[data-v-6e278c1c]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.bubble-cancel-btn[data-v-6e278c1c]{display:flex;align-items:center;justify-content:center;width:18px;height:18px;padding:0;margin-left:4px;background:rgba(248,113,113,0.2);border:none;border-radius:50%;color:rgba(248,113,113,0.8);font-size:0.7rem;cursor:pointer;transition:all 0.15s ease;opacity:0}.task-bubble:hover .bubble-cancel-btn[data-v-6e278c1c]{opacity:1}.bubble-cancel-btn[data-v-6e278c1c]:hover{background:rgba(248,113,113,0.4);color:#f87171;transform:scale(1.1)}.bubble-slide-enter-active[data-v-6e278c1c],.bubble-slide-leave-active[data-v-6e278c1c]{transition:all 0.3s ease}.bubble-slide-enter-from[data-v-6e278c1c],.bubble-slide-leave-to[data-v-6e278c1c]{opacity:0;transform:translateX(-20px)}.bubble-list-enter-active[data-v-6e278c1c],.bubble-list-leave-active[data-v-6e278c1c]{transition:all 0.25s ease}.bubble-list-enter-from[data-v-6e278c1c]{opacity:0;transform:translateX(-30px) scale(0.9)}.bubble-list-leave-to[data-v-6e278c1c]{opacity:0;transform:translateX(-20px) scale(0.95)}.bubble-list-move[data-v-6e278c1c]{transition:transform 0.25s ease}@media (max-width:768px){.task-bubble-container[data-v-6e278c1c]{top:60px;left:8px}.task-bubble[data-v-6e278c1c]{padding:6px 10px;font-size:0.75rem;min-width:120px}.bubble-icon[data-v-6e278c1c]{width:16px;height:16px}.spinner[data-v-6e278c1c]{width:12px;height:12px}}

.fade-enter-active[data-v-57b6116a],.fade-leave-active[data-v-57b6116a]{transition:opacity 0.5s ease}.fade-enter-from[data-v-57b6116a],.fade-leave-to[data-v-57b6116a]{opacity:0}

.node-group:hover circle[data-v-6d45e7d0]{filter:brightness(1.2)}.line-clamp-2[data-v-6d45e7d0]{display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

.modal-backdrop[data-v-a45dd3f8]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.modal-container[data-v-a45dd3f8]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);border:1px solid rgba(114,137,218,0.25);border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset;overflow:hidden}.noise-overlay[data-v-a45dd3f8]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;z-index:0}.modal-header[data-v-a45dd3f8]{position:relative;z-index:1;border-bottom:1px solid rgba(114,137,218,0.15)}.header-deco-line[data-v-a45dd3f8]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-a45dd3f8]::before,.header-deco-line[data-v-a45dd3f8]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-a45dd3f8]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-a45dd3f8]{color:rgba(114,137,218,0.5);font-size:0.5rem;animation:diamond-pulse-a45dd3f8 3s ease-in-out infinite}@keyframes diamond-pulse-a45dd3f8{0%,100%{opacity:0.5}50%{opacity:1}}.header-title[data-v-a45dd3f8]{display:flex;align-items:center;gap:0.5rem;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.title-icon[data-v-a45dd3f8]{font-size:1rem}.close-btn[data-v-a45dd3f8]{color:rgba(150,160,180,0.6);font-size:1rem;padding:0.25rem;transition:all 0.2s ease}.close-btn[data-v-a45dd3f8]:hover{color:rgba(200,210,230,0.9);text-shadow:0 0 8px rgba(114,137,218,0.5)}.modal-body[data-v-a45dd3f8]{position:relative;z-index:1}.attr-section[data-v-a45dd3f8]{background:rgba(20,22,28,0.5);border:1px solid rgba(114,137,218,0.1);border-radius:6px;padding:0.75rem}.section-title[data-v-a45dd3f8]{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem;padding-bottom:0.5rem;border-bottom:1px solid rgba(114,137,218,0.15);font-size:0.7rem;font-weight:700;letter-spacing:0.1em;color:rgba(114,137,218,0.8);text-transform:uppercase}.section-icon[data-v-a45dd3f8]{font-size:0.8rem}.attr-item[data-v-a45dd3f8]{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,rgba(40,43,52,0.8) 0%,rgba(35,38,46,0.9) 100%);border:1px solid rgba(114,137,218,0.1);border-radius:4px;padding:0.375rem 0.5rem;transition:all 0.2s ease;min-height:32px}@media (min-width:640px){.attr-item[data-v-a45dd3f8]{padding:0.5rem 0.75rem;min-height:36px}}.attr-item[data-v-a45dd3f8]:hover{border-color:rgba(114,137,218,0.3);background:linear-gradient(180deg,rgba(50,55,65,0.9) 0%,rgba(40,43,52,0.95) 100%)}.attr-name[data-v-a45dd3f8]{font-size:0.75rem;font-weight:600;color:rgba(180,190,210,0.9);flex-shrink:0}@media (min-width:640px){.attr-name[data-v-a45dd3f8]{font-size:0.875rem}}.attr-value[data-v-a45dd3f8]{width:1.5rem;text-align:center;font-family:monospace;font-size:0.75rem;font-weight:700;color:#ffffff;flex-shrink:0}@media (min-width:640px){.attr-value[data-v-a45dd3f8]{width:1.75rem;font-size:0.875rem}}.attr-btn[data-v-a45dd3f8]{display:flex;align-items:center;justify-content:center;width:1rem;height:1rem;border-radius:2px;font-size:0.625rem;font-weight:700;color:#ffffff;transition:all 0.2s ease;flex-shrink:0}@media (min-width:640px){.attr-btn[data-v-a45dd3f8]{width:1.25rem;height:1.25rem;border-radius:3px;font-size:0.75rem}}.attr-btn.decrease[data-v-a45dd3f8]{background:linear-gradient(180deg,rgba(220,80,80,0.8) 0%,rgba(180,60,60,0.9) 100%);border:1px solid rgba(220,80,80,0.5)}.attr-btn.decrease[data-v-a45dd3f8]:hover{background:linear-gradient(180deg,rgba(240,100,100,0.9) 0%,rgba(200,70,70,1) 100%);transform:translateY(-1px)}.attr-btn.increase[data-v-a45dd3f8]{background:linear-gradient(180deg,rgba(59,165,92,0.8) 0%,rgba(45,125,70,0.9) 100%);border:1px solid rgba(59,165,92,0.5)}.attr-btn.increase[data-v-a45dd3f8]:hover{background:linear-gradient(180deg,rgba(70,185,105,0.9) 0%,rgba(55,145,80,1) 100%);transform:translateY(-1px)}.combat-stat-row[data-v-a45dd3f8]{display:flex;align-items:center;justify-content:space-between;font-size:0.75rem;padding:0.25rem 0}.stat-label[data-v-a45dd3f8]{color:rgba(150,160,180,0.8)}.stat-value[data-v-a45dd3f8]{font-family:monospace;font-weight:600;color:#ffffff}.points-indicator[data-v-a45dd3f8]{display:flex;align-items:center;justify-content:space-between;margin-top:0.75rem;padding:0.5rem 0.75rem;background:linear-gradient(180deg,rgba(217,166,97,0.15) 0%,rgba(180,130,70,0.1) 100%);border:1px solid rgba(217,166,97,0.3);border-radius:4px;font-size:0.75rem}.points-label[data-v-a45dd3f8]{font-weight:700;color:rgba(217,166,97,0.9)}.points-value[data-v-a45dd3f8]{font-family:monospace;font-weight:700;color:#ffffff}.pending-indicator[data-v-a45dd3f8]{margin-top:0.5rem;text-align:center;font-size:0.65rem;color:rgba(217,166,97,0.8);animation:pulse-a45dd3f8 2s ease-in-out infinite}@keyframes pulse-a45dd3f8{0%,100%{opacity:0.7}50%{opacity:1}}.overweight-warning[data-v-a45dd3f8]{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem;padding:0.5rem 0.75rem;background:linear-gradient(180deg,rgba(220,80,80,0.15) 0%,rgba(180,60,60,0.1) 100%);border:1px solid rgba(220,80,80,0.4);border-radius:4px;animation:warning-pulse-a45dd3f8 2s ease-in-out infinite}@keyframes warning-pulse-a45dd3f8{0%,100%{border-color:rgba(220,80,80,0.4);box-shadow:0 0 5px rgba(220,80,80,0.1)}50%{border-color:rgba(220,80,80,0.7);box-shadow:0 0 10px rgba(220,80,80,0.2)}}.warning-icon[data-v-a45dd3f8]{font-size:0.875rem}.warning-text[data-v-a45dd3f8]{font-size:0.7rem;font-weight:600;color:rgba(220,80,80,0.9)}.attr-item.has-debuff[data-v-a45dd3f8]{border-color:rgba(220,80,80,0.3);background:linear-gradient(180deg,rgba(60,40,40,0.8) 0%,rgba(50,35,35,0.9) 100%)}.debuff-indicator[data-v-a45dd3f8]{color:rgba(220,80,80,0.9);font-size:0.7rem;margin-left:2px}.debuff-row[data-v-a45dd3f8]{background:rgba(220,80,80,0.1);padding:0.25rem 0.5rem;border-radius:3px;margin:0.25rem 0}.modal-footer[data-v-a45dd3f8]{position:relative;z-index:1;border-top:1px solid rgba(114,137,218,0.15)}.action-btn[data-v-a45dd3f8]{padding:0.5rem 1rem;border-radius:4px;font-size:0.75rem;font-weight:600;letter-spacing:0.05em;transition:all 0.2s ease}.action-btn.secondary[data-v-a45dd3f8]{background:linear-gradient(180deg,rgba(60,65,75,0.9) 0%,rgba(50,55,65,0.95) 100%);border:1px solid rgba(100,110,130,0.3);color:rgba(180,190,210,0.9)}.action-btn.secondary[data-v-a45dd3f8]:hover{background:linear-gradient(180deg,rgba(70,75,85,0.95) 0%,rgba(60,65,75,1) 100%);border-color:rgba(114,137,218,0.4);transform:translateY(-1px)}.action-btn.primary[data-v-a45dd3f8]{background:linear-gradient(180deg,rgba(59,165,92,0.8) 0%,rgba(45,125,70,0.9) 100%);border:1px solid rgba(59,165,92,0.5);color:#ffffff}.action-btn.primary[data-v-a45dd3f8]:hover{background:linear-gradient(180deg,rgba(70,185,105,0.9) 0%,rgba(55,145,80,1) 100%);box-shadow:0 4px 15px rgba(59,165,92,0.25);transform:translateY(-1px)}.footer-deco-line[data-v-a45dd3f8]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.footer-deco-line[data-v-a45dd3f8]::before,.footer-deco-line[data-v-a45dd3f8]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 100%)}.footer-deco-line[data-v-a45dd3f8]::after{background:linear-gradient(90deg,rgba(114,137,218,0.2) 0%,transparent 100%)}.custom-scrollbar[data-v-a45dd3f8]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-a45dd3f8]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5);border-radius:2px}.custom-scrollbar[data-v-a45dd3f8]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:2px}.custom-scrollbar[data-v-a45dd3f8]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.modal-fade-enter-active[data-v-a45dd3f8]{transition:opacity 0.2s ease-out}.modal-fade-enter-active .modal-container[data-v-a45dd3f8]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-fade-leave-active[data-v-a45dd3f8]{transition:opacity 0.15s ease-in}.modal-fade-leave-active .modal-container[data-v-a45dd3f8]{transition:transform 0.15s ease-in}.modal-fade-enter-from[data-v-a45dd3f8],.modal-fade-leave-to[data-v-a45dd3f8]{opacity:0}.modal-fade-enter-from .modal-container[data-v-a45dd3f8]{transform:scale(0.9) translateY(15px)}.modal-fade-leave-to .modal-container[data-v-a45dd3f8]{transform:scale(0.95) translateY(8px)}

.equipment-panel[data-v-51ec3a13]{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%);padding:0.75rem;border-radius:8px;border:1px solid rgba(114,137,218,0.15)}.equipment-grid[data-v-51ec3a13]{display:grid;grid-template-columns:repeat(2,1fr);gap:4px}@media (min-width:640px){.equipment-grid[data-v-51ec3a13]{gap:6px}}.equipment-slot[data-v-51ec3a13]{background:linear-gradient(180deg,rgba(40,43,52,0.9) 0%,rgba(35,38,46,0.95) 100%);border:1px solid rgba(114,137,218,0.15);border-radius:4px;padding:4px 6px;height:28px;display:flex;align-items:center;justify-content:center;gap:4px;transition:all 0.2s ease}.equipment-slot.has-item[data-v-51ec3a13]{justify-content:flex-start;background:linear-gradient(180deg,rgba(59,165,92,0.15) 0%,rgba(45,125,70,0.1) 100%);border-color:rgba(59,165,92,0.4)}@media (min-width:640px){.equipment-slot[data-v-51ec3a13]{height:32px;padding:4px 8px}}.equipment-slot.clickable[data-v-51ec3a13]{cursor:pointer}.equipment-slot.clickable[data-v-51ec3a13]:hover{background:linear-gradient(180deg,rgba(114,137,218,0.2) 0%,rgba(90,110,180,0.15) 100%) !important;border-color:rgba(114,137,218,0.5) !important;transform:translateY(-1px);box-shadow:0 2px 8px rgba(114,137,218,0.15)}.empty-text[data-v-51ec3a13]{font-size:10px;color:rgba(100,110,130,0.5);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-name[data-v-51ec3a13]{font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}@media (min-width:640px){.item-name[data-v-51ec3a13]{font-size:11px}}.emoji[data-v-51ec3a13]{font-size:12px;flex-shrink:0}.item-sprite[data-v-51ec3a13]{display:inline-block;background-repeat:no-repeat;vertical-align:middle;flex-shrink:0}.equipment-panel h3[data-v-51ec3a13]{color:rgba(114,137,218,0.8) !important;letter-spacing:0.1em}.context-menu[data-v-51ec3a13]{position:fixed;z-index:9999;min-width:140px;background:linear-gradient(180deg,rgba(35,38,48,0.98) 0%,rgba(28,30,38,0.99) 100%);border:1px solid rgba(114,137,218,0.35);border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.5),0 0 40px rgba(114,137,218,0.1) inset;overflow:hidden;backdrop-filter:blur(8px)}.context-menu-header[data-v-51ec3a13]{padding:8px 12px;background:linear-gradient(180deg,rgba(114,137,218,0.15) 0%,rgba(114,137,218,0.05) 100%);border-bottom:1px solid rgba(114,137,218,0.2)}.context-menu-title[data-v-51ec3a13]{font-size:11px;font-weight:600;color:rgba(200,210,230,0.9);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.context-menu-items[data-v-51ec3a13]{padding:4px 0}.context-menu-item[data-v-51ec3a13]{display:flex;align-items:center;gap:8px;width:100%;padding:8px 12px;background:transparent;border:none;color:rgba(180,190,210,0.9);font-size:12px;cursor:pointer;transition:all 0.15s ease;text-align:left}.context-menu-item[data-v-51ec3a13]:hover{background:rgba(114,137,218,0.2);color:rgba(220,230,250,1)}.context-menu-item.unequip-all[data-v-51ec3a13]{color:rgba(251,191,36,0.9)}.context-menu-item.unequip-all[data-v-51ec3a13]:hover{background:rgba(251,191,36,0.15);color:rgba(251,191,36,1)}.menu-icon[data-v-51ec3a13]{font-size:14px;width:18px;text-align:center;flex-shrink:0}.context-menu-divider[data-v-51ec3a13]{height:1px;margin:4px 8px;background:rgba(114,137,218,0.2)}.context-menu-enter-active[data-v-51ec3a13]{transition:all 0.15s ease-out}.context-menu-leave-active[data-v-51ec3a13]{transition:all 0.1s ease-in}.context-menu-enter-from[data-v-51ec3a13]{opacity:0;transform:scale(0.9) translateY(-5px)}.context-menu-leave-to[data-v-51ec3a13]{opacity:0;transform:scale(0.95)}

.equipment-modal-backdrop[data-v-3805d5d3]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.equipment-modal-container[data-v-3805d5d3]{background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);border:1px solid rgba(114,137,218,0.25);box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset;overflow:hidden}.noise-overlay[data-v-3805d5d3]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;z-index:0}.modal-header[data-v-3805d5d3]{border-bottom:1px solid rgba(114,137,218,0.15)}.header-deco-line[data-v-3805d5d3]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-3805d5d3]::before,.header-deco-line[data-v-3805d5d3]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-3805d5d3]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-3805d5d3]{color:rgba(114,137,218,0.5);font-size:0.5rem;animation:diamond-pulse-3805d5d3 3s ease-in-out infinite}@keyframes diamond-pulse-3805d5d3{0%,100%{opacity:0.5}50%{opacity:1}}.header-title[data-v-3805d5d3]{display:flex;align-items:center;gap:0.5rem;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.title-icon[data-v-3805d5d3]{font-size:1rem}.close-btn[data-v-3805d5d3]{color:rgba(150,160,180,0.6);font-size:1rem;padding:0.25rem;transition:all 0.2s ease}.close-btn[data-v-3805d5d3]:hover{color:rgba(200,210,230,0.9);text-shadow:0 0 8px rgba(114,137,218,0.5)}.footer-deco-line[data-v-3805d5d3]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.footer-deco-line[data-v-3805d5d3]::before,.footer-deco-line[data-v-3805d5d3]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 100%)}.footer-deco-line[data-v-3805d5d3]::after{background:linear-gradient(90deg,rgba(114,137,218,0.2) 0%,transparent 100%)}.modal-fade-enter-active[data-v-3805d5d3]{transition:opacity 0.2s ease-out}.modal-fade-enter-active .equipment-modal-container[data-v-3805d5d3]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-fade-leave-active[data-v-3805d5d3]{transition:opacity 0.15s ease-in}.modal-fade-leave-active .equipment-modal-container[data-v-3805d5d3]{transition:transform 0.15s ease-in}.modal-fade-enter-from[data-v-3805d5d3],.modal-fade-leave-to[data-v-3805d5d3]{opacity:0}.modal-fade-enter-from .equipment-modal-container[data-v-3805d5d3]{transform:scale(0.9) translateY(15px)}.modal-fade-leave-to .equipment-modal-container[data-v-3805d5d3]{transform:scale(0.95) translateY(8px)}

.effect-tags[data-v-0bc3401a]{display:flex;flex-wrap:wrap;gap:4px;align-items:center}.effect-tags.single-line[data-v-0bc3401a]{flex-wrap:nowrap;overflow:hidden}.effect-tags.compact[data-v-0bc3401a]{gap:2px}.effect-tag[data-v-0bc3401a]{display:inline-flex;align-items:center;gap:2px;padding:2px 6px;border-radius:4px;font-size:11px;font-weight:500;background:#36393f;border:1px solid #40444b;color:#dcddde;white-space:nowrap}.compact .effect-tag[data-v-0bc3401a]{padding:1px 4px;font-size:10px;border-radius:3px}.tag-icon[data-v-0bc3401a]{font-size:12px;line-height:1}.compact .tag-icon[data-v-0bc3401a]{font-size:10px}.tag-text[data-v-0bc3401a]{line-height:1.2}.tag-damage[data-v-0bc3401a]{background:linear-gradient(135deg,#4a1c1c 0%,#2d1515 100%);border-color:#8b3535;color:#ff9999}.tag-heal[data-v-0bc3401a]{background:linear-gradient(135deg,#1c4a1c 0%,#152d15 100%);border-color:#358b35;color:#99ff99}.tag-buff[data-v-0bc3401a]{background:linear-gradient(135deg,#1c3a4a 0%,#152530 100%);border-color:#3585a5;color:#99ddff}.tag-debuff[data-v-0bc3401a]{background:linear-gradient(135deg,#3a1c4a 0%,#251530 100%);border-color:#8535a5;color:#dd99ff}.tag-shield[data-v-0bc3401a]{background:linear-gradient(135deg,#4a3a1c 0%,#302515 100%);border-color:#a58535;color:#ffdd99}.tag-cost[data-v-0bc3401a]{background:#2f3136;border-color:#5865f2;color:#a0a8ff}.tag-special[data-v-0bc3401a]{background:linear-gradient(135deg,#2f3136 0%,#202225 100%);border-color:#7289da;color:#99aab5}.more-tag[data-v-0bc3401a]{background:#202225;border-color:#40444b;color:#72767d;font-size:10px;padding:2px 4px}

.team-status-bar[data-v-454e33b2]{display:flex;flex-direction:column;gap:4px;padding:6px;background:#202225;border-radius:6px;border:1px solid #40444b}.member-status[data-v-454e33b2]{display:flex;align-items:center;gap:8px;padding:4px 6px;background:#2f3136;border-radius:4px;border:1px solid transparent;transition:background 0.15s,border-color 0.15s}.member-status.clickable[data-v-454e33b2]{cursor:pointer}.member-status.clickable[data-v-454e33b2]:hover{background:#36393f;border-color:#5865f2}.member-status.selected[data-v-454e33b2]{background:#36393f;border-color:#5865f2;box-shadow:0 0 0 1px rgba(88,101,242,0.3)}.member-info[data-v-454e33b2]{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}.member-name-row[data-v-454e33b2]{display:flex;align-items:center;gap:4px}.member-name[data-v-454e33b2]{font-size:11px;font-weight:600;color:#ffffff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (min-width:640px){.member-name[data-v-454e33b2]{font-size:12px}}.player-tag[data-v-454e33b2]{font-size:9px;padding:1px 4px;background:#5865f2;color:white;border-radius:3px;flex-shrink:0}.stat-bar-mini[data-v-454e33b2]{position:relative;height:10px;background:#40444b;border-radius:5px;overflow:hidden}@media (min-width:640px){.stat-bar-mini[data-v-454e33b2]{height:12px;border-radius:6px}}.stat-bar-mini .stat-bar-fill[data-v-454e33b2]{height:100%;border-radius:inherit;transition:width 0.3s ease}.stat-bar-mini.hp .stat-bar-fill[data-v-454e33b2]{background:linear-gradient(90deg,#e53935,#f44336)}.stat-bar-mini.mp .stat-bar-fill[data-v-454e33b2]{background:linear-gradient(90deg,#1565c0,#1e88e5)}.stat-bar-mini.sp .stat-bar-fill[data-v-454e33b2]{background:linear-gradient(90deg,#2e7d32,#43a047)}.stat-bar-mini .stat-bar-text[data-v-454e33b2]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:8px;font-weight:bold;color:white;text-shadow:0 1px 2px rgba(0,0,0,0.8);white-space:nowrap}@media (min-width:640px){.stat-bar-mini .stat-bar-text[data-v-454e33b2]{font-size:9px}}.preview-delta[data-v-454e33b2]{color:#4ade80;font-weight:bold;margin-left:2px}.warning-icon[data-v-454e33b2]{font-size:12px;flex-shrink:0;animation:pulse-454e33b2 1s infinite}@keyframes pulse-454e33b2{0%,100%{opacity:1}50%{opacity:0.5}}.no-members[data-v-454e33b2]{text-align:center;font-size:11px;color:#72767d;padding:8px}

.fixed[data-v-ed1a6954]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%) !important;backdrop-filter:blur(6px)}.item-use-modal[data-v-ed1a6954]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%) !important;border:1px solid rgba(114,137,218,0.25) !important;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset !important}.item-use-modal>div[data-v-ed1a6954]:first-child{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%) !important;border-bottom:1px solid rgba(114,137,218,0.2) !important}.item-use-modal>div[data-v-ed1a6954]:first-child::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(114,137,218,0.08) 0%,transparent 100%);pointer-events:none;border-radius:inherit}.item-use-modal>div[data-v-ed1a6954]:nth-child(2){background:rgba(25,27,35,0.5)}.item-use-modal .text-xs.font-bold.text-gray-500[data-v-ed1a6954]{color:rgba(114,137,218,0.8) !important}.item-use-modal button[class*='bg-[#40444b]'][data-v-ed1a6954]{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(40,43,52,0.9) 100%) !important;border:1px solid rgba(114,137,218,0.25);transition:all 0.2s ease}.item-use-modal button[class*='bg-[#40444b]'][data-v-ed1a6954]:hover:not(:disabled){background:linear-gradient(180deg,rgba(114,137,218,0.3) 0%,rgba(90,110,180,0.25) 100%) !important;border-color:rgba(114,137,218,0.5)}.item-use-modal .bg-\[\#202225\][data-v-ed1a6954]{background:rgba(20,22,28,0.8) !important;border:1px solid rgba(114,137,218,0.15)}.item-use-modal>div[data-v-ed1a6954]:last-child{background:rgba(15,17,22,0.95) !important;border-top:1px solid rgba(114,137,218,0.15) !important}.item-use-modal button.bg-gray-700[data-v-ed1a6954]{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(40,43,52,0.9) 100%) !important;border:1px solid rgba(114,137,218,0.2);color:rgba(180,190,210,0.8);transition:all 0.2s ease}.item-use-modal button.bg-gray-700[data-v-ed1a6954]:hover{background:linear-gradient(180deg,rgba(60,65,75,0.9) 0%,rgba(50,55,65,0.95) 100%) !important;border-color:rgba(114,137,218,0.4);color:rgba(200,210,230,0.95)}.item-use-modal button[class*='bg-[#3ba55c]'][data-v-ed1a6954]{background:linear-gradient(180deg,rgba(74,222,128,0.3) 0%,rgba(34,197,94,0.25) 100%) !important;border:1px solid rgba(74,222,128,0.4);color:rgba(74,222,128,0.95);transition:all 0.2s ease}.item-use-modal button[class*='bg-[#3ba55c]'][data-v-ed1a6954]:hover:not(:disabled){background:linear-gradient(180deg,rgba(74,222,128,0.4) 0%,rgba(34,197,94,0.35) 100%) !important;border-color:rgba(74,222,128,0.6);transform:translateY(-1px);box-shadow:0 4px 15px rgba(74,222,128,0.2)}.modal-enter-active[data-v-ed1a6954]{transition:opacity 0.2s ease-out}.modal-enter-active .item-use-modal[data-v-ed1a6954]{transition:transform 0.25s ease-out,opacity 0.25s ease-out}.modal-leave-active[data-v-ed1a6954]{transition:opacity 0.15s ease-in}.modal-leave-active .item-use-modal[data-v-ed1a6954]{transition:transform 0.15s ease-in,opacity 0.15s ease-in}.modal-enter-from[data-v-ed1a6954],.modal-leave-to[data-v-ed1a6954]{opacity:0}.modal-enter-from .item-use-modal[data-v-ed1a6954]{transform:scale(0.95) translateY(10px);opacity:0}.modal-leave-to .item-use-modal[data-v-ed1a6954]{transform:scale(0.98) translateY(5px);opacity:0}

.inventory-panel[data-v-5c3d5c4a]{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%)}.detail-section[data-v-5c3d5c4a]{min-height:80px;max-height:200px;background:linear-gradient(180deg,rgba(35,38,48,0.9) 0%,rgba(28,31,40,0.95) 100%) !important;border:1px solid rgba(114,137,218,0.15) !important;box-shadow:0 2px 10px rgba(0,0,0,0.3),0 0 20px rgba(114,137,218,0.05) inset}@media (min-width:640px){.detail-section[data-v-5c3d5c4a]{min-height:100px;max-height:none;overflow:visible}}.desc-row[data-v-5c3d5c4a]{padding:4px 0;border-top:1px solid rgba(114,137,218,0.15)}.effect-row[data-v-5c3d5c4a]{padding-top:4px;border-top:1px solid rgba(114,137,218,0.15)}.line-clamp-2[data-v-5c3d5c4a]{display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.line-clamp-3[data-v-5c3d5c4a]{display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.action-row[data-v-5c3d5c4a]{padding-top:6px;border-top:1px solid rgba(114,137,218,0.15)}.action-row button[data-v-5c3d5c4a]{position:relative;overflow:hidden;transition:all 0.2s ease}.action-row button[data-v-5c3d5c4a]:hover{transform:translateY(-1px)}.item-grid[data-v-5c3d5c4a]{display:grid;grid-template-columns:repeat(auto-fill,36px);justify-content:center;gap:2px;padding:2px;min-height:100px;background:linear-gradient(180deg,rgba(20,22,28,0.5) 0%,rgba(15,17,22,0.6) 100%);border-radius:6px}@media (min-width:400px){.item-grid[data-v-5c3d5c4a]{grid-template-columns:repeat(auto-fill,40px);gap:3px}}@media (min-width:640px){.item-grid[data-v-5c3d5c4a]{grid-template-columns:repeat(auto-fill,48px);gap:6px;min-height:160px}}.item-grid-cell[data-v-5c3d5c4a]{width:36px;height:36px;min-width:36px;min-height:36px;background:linear-gradient(180deg,rgba(40,43,52,0.9) 0%,rgba(35,38,46,0.95) 100%);border:1px solid rgba(114,137,218,0.15);border-radius:6px;display:flex;align-items:center;justify-content:center;position:relative;cursor:pointer;transition:all 0.2s ease}@media (min-width:400px){.item-grid-cell[data-v-5c3d5c4a]{width:40px;height:40px;min-width:40px;min-height:40px}}@media (min-width:640px){.item-grid-cell[data-v-5c3d5c4a]{width:48px;height:48px;min-width:48px;min-height:48px;border-radius:8px}}.item-grid-cell.empty[data-v-5c3d5c4a]{background:rgba(20,22,28,0.6);border:1px dashed rgba(114,137,218,0.1);cursor:default}.item-grid-cell[data-v-5c3d5c4a]:hover:not(.empty){border-color:rgba(114,137,218,0.5);background:linear-gradient(180deg,rgba(50,55,68,0.95) 0%,rgba(45,48,58,0.98) 100%);transform:translateY(-2px);box-shadow:0 4px 12px rgba(114,137,218,0.15)}.item-grid-cell.selected[data-v-5c3d5c4a]{border-color:rgba(114,137,218,0.6);background:linear-gradient(180deg,rgba(114,137,218,0.2) 0%,rgba(90,110,180,0.15) 100%);box-shadow:0 0 0 2px rgba(114,137,218,0.2),0 0 15px rgba(114,137,218,0.1) inset}.item-quantity[data-v-5c3d5c4a]{position:absolute;bottom:0;right:1px;font-size:9px;color:white;font-weight:bold;text-shadow:0 1px 3px rgba(0,0,0,0.8)}@media (min-width:640px){.item-quantity[data-v-5c3d5c4a]{bottom:1px;right:2px;font-size:10px}}.item-emoji[data-v-5c3d5c4a]{font-size:16px}@media (min-width:640px){.item-emoji[data-v-5c3d5c4a]{font-size:20px}}.item-sprite[data-v-5c3d5c4a]{width:28px;height:28px;background-repeat:no-repeat;flex-shrink:0}.item-sprite-icon[data-v-5c3d5c4a]{background-repeat:no-repeat;flex-shrink:0}@media (min-width:640px){.item-sprite[data-v-5c3d5c4a]{width:36px;height:36px}}.toast-fade-enter-active[data-v-5c3d5c4a],.toast-fade-leave-active[data-v-5c3d5c4a]{transition:all 0.3s ease}.toast-fade-enter-from[data-v-5c3d5c4a]{opacity:0;transform:translateX(-50%) translateY(20px)}.toast-fade-leave-to[data-v-5c3d5c4a]{opacity:0;transform:translateX(-50%) translateY(-10px)}.item-grid[data-v-5c3d5c4a]::-webkit-scrollbar{width:4px}.item-grid[data-v-5c3d5c4a]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5);border-radius:2px}.item-grid[data-v-5c3d5c4a]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:2px}.item-grid[data-v-5c3d5c4a]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.overweight-badge[data-v-5c3d5c4a]{background:linear-gradient(180deg,rgba(220,80,80,0.2) 0%,rgba(180,60,60,0.15) 100%);border:1px solid rgba(220,80,80,0.4);box-shadow:0 0 8px rgba(220,80,80,0.2)}

.inventory-modal-backdrop[data-v-3c6d6990]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.inventory-modal-container[data-v-3c6d6990]{background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);border:1px solid rgba(114,137,218,0.25);box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset;overflow:hidden}.noise-overlay[data-v-3c6d6990]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;z-index:0}.modal-header[data-v-3c6d6990]{border-bottom:1px solid rgba(114,137,218,0.15)}.header-deco-line[data-v-3c6d6990]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-3c6d6990]::before,.header-deco-line[data-v-3c6d6990]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-3c6d6990]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-3c6d6990]{color:rgba(114,137,218,0.5);font-size:0.5rem;animation:diamond-pulse-3c6d6990 3s ease-in-out infinite}@keyframes diamond-pulse-3c6d6990{0%,100%{opacity:0.5}50%{opacity:1}}.header-title[data-v-3c6d6990]{display:flex;align-items:center;gap:0.5rem;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.title-icon[data-v-3c6d6990]{font-size:1rem}.close-btn[data-v-3c6d6990]{color:rgba(150,160,180,0.6);font-size:1rem;padding:0.25rem;transition:all 0.2s ease}.close-btn[data-v-3c6d6990]:hover{color:rgba(200,210,230,0.9);text-shadow:0 0 8px rgba(114,137,218,0.5)}.footer-deco-line[data-v-3c6d6990]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.footer-deco-line[data-v-3c6d6990]::before,.footer-deco-line[data-v-3c6d6990]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 100%)}.footer-deco-line[data-v-3c6d6990]::after{background:linear-gradient(90deg,rgba(114,137,218,0.2) 0%,transparent 100%)}.modal-fade-enter-active[data-v-3c6d6990]{transition:opacity 0.2s ease-out}.modal-fade-enter-active .inventory-modal-container[data-v-3c6d6990]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-fade-leave-active[data-v-3c6d6990]{transition:opacity 0.15s ease-in}.modal-fade-leave-active .inventory-modal-container[data-v-3c6d6990]{transition:transform 0.15s ease-in}.modal-fade-enter-from[data-v-3c6d6990],.modal-fade-leave-to[data-v-3c6d6990]{opacity:0}.modal-fade-enter-from .inventory-modal-container[data-v-3c6d6990]{transform:scale(0.9) translateY(15px)}.modal-fade-leave-to .inventory-modal-container[data-v-3c6d6990]{transform:scale(0.95) translateY(8px)}

.status-panel[data-v-45853d3b]{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}.stat-bar[data-v-45853d3b]{height:22px;background:#40444b;border-radius:11px;position:relative;overflow:hidden}.stat-bar .fill[data-v-45853d3b]{height:100%;transition:width 0.5s ease;border-radius:11px}.stat-bar .fill.hp[data-v-45853d3b]{background:#e53935}.stat-bar .fill.mp[data-v-45853d3b]{background:#1e88e5}.stat-bar .fill.sp[data-v-45853d3b]{background:#43a047}.stat-bar .label[data-v-45853d3b]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:12px;color:white;text-shadow:1px 1px 2px black;z-index:10;font-weight:bold}

.sidebar-container[data-v-294af673]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%)}.noise-overlay[data-v-294af673]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;z-index:0}.title-section[data-v-294af673]{border-bottom:1px solid rgba(114,137,218,0.15)}.title-deco-line[data-v-294af673]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.title-deco-line[data-v-294af673]::before,.title-deco-line[data-v-294af673]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.title-deco-line[data-v-294af673]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-294af673]{color:rgba(114,137,218,0.5);font-size:0.5rem;animation:diamond-pulse-294af673 3s ease-in-out infinite}@keyframes diamond-pulse-294af673{0%,100%{opacity:0.5}50%{opacity:1}}.player-name[data-v-294af673]{background:linear-gradient(180deg,#fbbf24 0%,#d97706 50%,#b45309 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:none;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.3));transition:all 0.2s ease}.player-name[data-v-294af673]:hover{filter:drop-shadow(0 0 8px rgba(251,191,36,0.4))}.custom-scrollbar[data-v-294af673]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-294af673]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5);border-radius:2px}.custom-scrollbar[data-v-294af673]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:2px}.custom-scrollbar[data-v-294af673]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.popup-backdrop[data-v-294af673]{background:linear-gradient(135deg,rgba(10,10,15,0.9) 0%,rgba(18,20,26,0.9) 50%,rgba(13,14,20,0.9) 100%);backdrop-filter:blur(4px)}.popup-container[data-v-294af673]{background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 100%);border:1px solid rgba(114,137,218,0.25);box-shadow:0 8px 32px rgba(0,0,0,0.4)}.popup-header[data-v-294af673]{border-bottom:1px solid rgba(114,137,218,0.15);padding-bottom:0.75rem}.popup-title[data-v-294af673]{background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.popup-close[data-v-294af673]{color:rgba(150,160,180,0.6);transition:all 0.2s ease}.popup-close[data-v-294af673]:hover{color:rgba(200,210,230,0.9)}.popup-content[data-v-294af673]{color:rgba(180,190,210,0.9)}.popup-fade-enter-active[data-v-294af673],.popup-fade-leave-active[data-v-294af673]{transition:all 0.2s ease}.popup-fade-enter-from[data-v-294af673],.popup-fade-leave-to[data-v-294af673]{opacity:0}.popup-fade-enter-from .popup-container[data-v-294af673],.popup-fade-leave-to .popup-container[data-v-294af673]{transform:scale(0.95)}.sidebar-btn[data-v-294af673]{position:relative;display:flex;align-items:center;padding:0.5rem 0.75rem;border:1px solid rgba(114,137,218,0.15);border-radius:4px;background:linear-gradient(180deg,rgba(40,43,52,0.9) 0%,rgba(35,38,46,0.95) 100%);color:rgba(180,190,210,0.9);font-size:0.875rem;text-align:left;cursor:pointer;overflow:hidden;transition:all 0.2s ease}.sidebar-btn[data-v-294af673]:hover{border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(40,43,52,0.98) 100%);color:#ffffff;transform:translateY(-1px);box-shadow:0 2px 8px rgba(114,137,218,0.15)}.sidebar-btn.active[data-v-294af673]{border-color:rgba(114,137,218,0.5);background:linear-gradient(180deg,rgba(114,137,218,0.2) 0%,rgba(90,110,180,0.15) 100%);color:#ffffff}.sidebar-btn.disabled[data-v-294af673]{cursor:not-allowed;opacity:0.5;border-color:rgba(60,65,75,0.3);background:rgba(30,33,40,0.5);color:rgba(100,110,130,0.5)}.sidebar-btn.disabled[data-v-294af673]:hover{transform:none;box-shadow:none}.sidebar-btn.primary[data-v-294af673]{justify-content:center;border-color:rgba(217,166,97,0.3);background:linear-gradient(180deg,rgba(217,166,97,0.15) 0%,rgba(180,130,70,0.1) 100%)}.sidebar-btn.primary[data-v-294af673]:hover:not(.disabled){border-color:rgba(217,166,97,0.5);background:linear-gradient(180deg,rgba(217,166,97,0.25) 0%,rgba(180,130,70,0.2) 100%);box-shadow:0 2px 12px rgba(217,166,97,0.2)}.btn-glow[data-v-294af673]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 50%,rgba(114,137,218,0.1) 0%,transparent 60%);transition:opacity 0.3s ease}.sidebar-btn:hover .btn-glow[data-v-294af673]{opacity:1}.btn-text[data-v-294af673]{position:relative;z-index:1}.lock-icon[data-v-294af673]{margin-left:0.25rem;font-size:0.625rem}.view-icon[data-v-294af673]{margin-left:0.25rem;font-size:0.625rem;color:rgba(217,166,97,0.8)}

.private-info-backdrop[data-v-540c0d6d]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(20,15,18,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.private-info-modal[data-v-540c0d6d]{border:1px solid rgba(219,112,147,0.3);background:transparent}.modal-bg-layer[data-v-540c0d6d]{position:absolute;inset:0;background:linear-gradient(180deg,rgba(35,28,32,0.98) 0%,rgba(28,24,28,0.99) 50%,rgba(22,20,24,1) 100%);border-radius:inherit}.modal-noise[data-v-540c0d6d]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;border-radius:inherit}.modal-header[data-v-540c0d6d]{border-bottom:1px solid rgba(219,112,147,0.2);background:linear-gradient(180deg,rgba(40,32,36,0.8) 0%,rgba(35,28,32,0.6) 100%)}.header-deco-line[data-v-540c0d6d]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-540c0d6d]::before,.header-deco-line[data-v-540c0d6d]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(219,112,147,0.3) 100%)}.header-deco-line[data-v-540c0d6d]::after{background:linear-gradient(90deg,rgba(219,112,147,0.3) 0%,transparent 100%)}.deco-diamond[data-v-540c0d6d]{color:rgba(219,112,147,0.5);font-size:0.5rem;animation:diamond-pulse-540c0d6d 3s ease-in-out infinite}@keyframes diamond-pulse-540c0d6d{0%,100%{opacity:0.5}50%{opacity:1}}.header-icon[data-v-540c0d6d]{filter:drop-shadow(0 0 8px rgba(219,112,147,0.3))}.header-title[data-v-540c0d6d]{background:linear-gradient(180deg,#ffc0cb 0%,#db7093 50%,#c06080 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.1em}.gender-badge[data-v-540c0d6d]{border-radius:4px;border:1px solid rgba(219,112,147,0.3);background:rgba(219,112,147,0.15);color:rgba(255,180,200,0.9)}.close-btn[data-v-540c0d6d]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border-radius:4px;border:1px solid rgba(219,112,147,0.2);background:rgba(30,28,32,0.8);color:rgba(180,160,170,0.8);font-size:0.75rem;cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-540c0d6d]:hover{border-color:rgba(219,112,147,0.5);background:rgba(219,112,147,0.15);color:#ffffff}.modal-content[data-v-540c0d6d]{background:transparent}.modal-content[data-v-540c0d6d] .rounded-lg{border-color:rgba(219,112,147,0.2) !important;background:linear-gradient(180deg,rgba(35,30,34,0.9) 0%,rgba(30,26,30,0.95) 100%) !important}.modal-content[data-v-540c0d6d] .bg-\[36393f\]{background:rgba(35,30,34,0.9) !important}.modal-content[data-v-540c0d6d] .bg-\[2f3136\]{background:linear-gradient(180deg,rgba(40,34,38,0.8) 0%,rgba(35,30,34,0.6) 100%) !important}.modal-content[data-v-540c0d6d] .border-blue-700\/50{border-color:rgba(114,137,218,0.3) !important}.modal-content[data-v-540c0d6d] .border-blue-700\/30{border-color:rgba(114,137,218,0.2) !important}.modal-enter-active[data-v-540c0d6d]{transition:opacity 0.2s ease-out}.modal-enter-active .private-info-modal[data-v-540c0d6d]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-leave-active[data-v-540c0d6d]{transition:opacity 0.15s ease-in}.modal-leave-active .private-info-modal[data-v-540c0d6d]{transition:transform 0.15s ease-in}.modal-enter-from[data-v-540c0d6d],.modal-leave-to[data-v-540c0d6d]{opacity:0}.modal-enter-from .private-info-modal[data-v-540c0d6d]{transform:scale(0.9) translateY(15px)}.modal-leave-to .private-info-modal[data-v-540c0d6d]{transform:scale(0.95) translateY(8px)}.custom-scrollbar[data-v-540c0d6d]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-540c0d6d]::-webkit-scrollbar-track{background:rgba(30,26,30,0.5);border-radius:2px}.custom-scrollbar[data-v-540c0d6d]::-webkit-scrollbar-thumb{background:rgba(219,112,147,0.3);border-radius:2px}.custom-scrollbar[data-v-540c0d6d]::-webkit-scrollbar-thumb:hover{background:rgba(219,112,147,0.5)}

.modal-backdrop[data-v-5318725f]{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.modal-vignette[data-v-5318725f]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 30%,rgba(0,0,0,0.3) 100%);pointer-events:none}.modal-noise[data-v-5318725f]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none}.quests-modal[data-v-5318725f]{position:relative;z-index:10;display:flex;flex-direction:column;width:100%;max-width:28rem;max-height:70dvh;margin:1rem;background:linear-gradient(180deg,rgba(25,27,35,0.98) 0%,rgba(20,22,28,0.99) 100%);border:1px solid rgba(114,137,218,0.25);border-radius:12px;box-shadow:0 0 50px rgba(114,137,218,0.08),0 0 0 1px rgba(114,137,218,0.08) inset,0 25px 80px rgba(0,0,0,0.5);overflow:hidden}.modal-header[data-v-5318725f]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.9) 100%);border-bottom:1px solid rgba(114,137,218,0.15)}.header-deco-line[data-v-5318725f]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.5rem}.header-deco-line[data-v-5318725f]::before,.header-deco-line[data-v-5318725f]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-5318725f]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-5318725f]{color:rgba(114,137,218,0.5);font-size:0.4rem;line-height:1;animation:diamond-pulse-5318725f 3s ease-in-out infinite}@keyframes diamond-pulse-5318725f{0%,100%{opacity:0.5}50%{opacity:1;text-shadow:0 0 6px rgba(114,137,218,0.4)}}.header-content[data-v-5318725f]{display:flex;align-items:center;justify-content:space-between}.header-title-group[data-v-5318725f]{display:flex;align-items:center;gap:0.5rem}.header-icon[data-v-5318725f]{font-size:1rem;animation:glow-pulse-5318725f 3s ease-in-out infinite}@keyframes glow-pulse-5318725f{0%,100%{opacity:0.7;text-shadow:0 0 8px rgba(255,200,100,0.3)}50%{opacity:1;text-shadow:0 0 15px rgba(255,200,100,0.5)}}.header-title[data-v-5318725f]{font-size:0.95rem;font-weight:600;letter-spacing:0.1em;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.close-btn[data-v-5318725f]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border:1px solid rgba(100,110,130,0.2);border-radius:50%;background:rgba(40,43,50,0.5);color:rgba(150,160,180,0.7);cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-5318725f]:hover{border-color:rgba(220,100,100,0.4);background:rgba(180,60,60,0.15);color:rgba(255,180,180,0.9)}.close-icon[data-v-5318725f]{font-size:0.7rem}.detail-section[data-v-5318725f]{flex-shrink:0;margin:0.75rem;padding:0.75rem;min-height:100px;max-height:200px;display:flex;flex-direction:column;gap:0.375rem;background:linear-gradient(180deg,rgba(35,38,45,0.6) 0%,rgba(30,33,40,0.7) 100%);border:1px solid rgba(114,137,218,0.12);border-radius:8px}@media (min-width:640px){.detail-section[data-v-5318725f]{margin:1rem;padding:1rem;min-height:120px;max-height:none;gap:0.5rem}}.filter-tabs[data-v-5318725f]{display:flex;gap:0.5rem;margin:0.5rem 0.75rem}@media (min-width:640px){.filter-tabs[data-v-5318725f]{gap:0.75rem;margin:0.75rem 1rem}}.filter-tab[data-v-5318725f]{padding:0.375rem 0.625rem;border-radius:4px;font-size:10px;font-weight:500;transition:all 0.2s ease;background:linear-gradient(180deg,rgba(35,38,45,0.6) 0%,rgba(30,33,40,0.7) 100%);border:1px solid rgba(114,137,218,0.1);color:rgba(150,160,180,0.8)}@media (min-width:640px){.filter-tab[data-v-5318725f]{padding:0.5rem 0.875rem;font-size:11px}}.filter-tab[data-v-5318725f]:hover{background:linear-gradient(180deg,rgba(45,50,60,0.7) 0%,rgba(40,43,52,0.8) 100%);border-color:rgba(114,137,218,0.25);color:rgba(200,210,230,0.9)}.filter-tab.active[data-v-5318725f]{background:linear-gradient(180deg,rgba(114,137,218,0.25) 0%,rgba(90,110,180,0.2) 100%);border-color:rgba(114,137,218,0.5);color:#ffffff}.modal-footer[data-v-5318725f]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(25,27,35,0.9) 0%,rgba(30,33,40,0.95) 100%);border-top:1px solid rgba(114,137,218,0.15)}.footer-deco-line[data-v-5318725f]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.5rem}.footer-deco-line[data-v-5318725f]::before,.footer-deco-line[data-v-5318725f]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 50%,transparent 100%)}.footer-content[data-v-5318725f]{display:flex;align-items:center;justify-content:space-between}.footer-info[data-v-5318725f]{display:flex;align-items:center;gap:0.5rem;font-size:0.65rem;color:rgba(120,130,150,0.7);letter-spacing:0.05em}@media (min-width:640px){.footer-info[data-v-5318725f]{font-size:0.7rem}}.info-diamond[data-v-5318725f]{font-size:0.3rem;color:rgba(114,137,218,0.4)}.footer-btn[data-v-5318725f]{position:relative;padding:0.4rem 1rem;font-size:0.7rem;font-weight:500;letter-spacing:0.08em;color:rgba(180,190,210,0.9);background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,37,45,0.95) 100%);border:1px solid rgba(100,110,130,0.25);border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.2s ease}@media (min-width:640px){.footer-btn[data-v-5318725f]{font-size:0.75rem}}.footer-btn[data-v-5318725f]:hover{color:#ffffff;border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(45,48,58,0.98) 100%);transform:translateY(-1px)}.btn-glow[data-v-5318725f]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 50%,rgba(114,137,218,0.15) 0%,transparent 60%);transition:opacity 0.2s ease}.footer-btn:hover .btn-glow[data-v-5318725f]{opacity:1}.btn-content[data-v-5318725f]{position:relative;z-index:1}.modal-enter-active[data-v-5318725f]{transition:opacity 0.2s ease-out}.modal-enter-active .quests-modal[data-v-5318725f]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-leave-active[data-v-5318725f]{transition:opacity 0.15s ease-in}.modal-leave-active .quests-modal[data-v-5318725f]{transition:transform 0.15s ease-in}.modal-enter-from[data-v-5318725f],.modal-leave-to[data-v-5318725f]{opacity:0}.modal-enter-from .quests-modal[data-v-5318725f]{transform:scale(0.9) translateY(15px)}.modal-leave-to .quests-modal[data-v-5318725f]{transform:scale(0.95) translateY(8px)}.quest-list-item[data-v-5318725f]{display:flex;align-items:center;gap:10px;padding:10px 14px;background:linear-gradient(180deg,rgba(35,38,45,0.5) 0%,rgba(30,33,40,0.6) 100%);border:1px solid rgba(114,137,218,0.08);border-left:3px solid transparent;border-radius:6px;cursor:pointer;transition:all 0.2s ease}.quest-list-item[data-v-5318725f]:hover{background:linear-gradient(180deg,rgba(45,50,60,0.6) 0%,rgba(40,43,52,0.7) 100%);border-color:rgba(114,137,218,0.15);border-left-color:rgba(114,137,218,0.6);transform:translateX(2px)}.quest-list-item.selected[data-v-5318725f]{background:linear-gradient(180deg,rgba(114,137,218,0.12) 0%,rgba(90,110,180,0.08) 100%);border-color:rgba(114,137,218,0.25);border-left-color:rgba(114,137,218,0.8)}.quest-list-item.completed[data-v-5318725f]{opacity:0.7}.quest-list-item.failed[data-v-5318725f]{opacity:0.6}.quest-list-icon[data-v-5318725f]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;border:2px solid;font-size:12px;flex-shrink:0}@media (min-width:640px){.quest-list-icon[data-v-5318725f]{width:32px;height:32px;font-size:14px}}.quest-list-info[data-v-5318725f]{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}.quest-list-row[data-v-5318725f]{display:flex;align-items:center;justify-content:space-between;gap:8px}.quest-list-name[data-v-5318725f]{font-size:13px;font-weight:600;color:#ffffff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}@media (min-width:640px){.quest-list-name[data-v-5318725f]{font-size:14px}}.quest-list-status[data-v-5318725f]{font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;flex-shrink:0}@media (min-width:640px){.quest-list-status[data-v-5318725f]{font-size:10px}}.quest-list-progress[data-v-5318725f]{display:flex;align-items:center;gap:8px}.quest-progress-bar[data-v-5318725f]{flex:1;height:4px;background:rgba(20,22,28,0.8);border-radius:2px;overflow:hidden}.quest-progress-fill[data-v-5318725f]{height:100%;border-radius:2px;transition:width 0.3s ease}.quest-progress-text[data-v-5318725f]{font-size:10px;color:rgba(150,160,180,0.7);width:32px;text-align:right}@media (min-width:640px){.quest-progress-text[data-v-5318725f]{font-size:11px}}.quest-list-arrow[data-v-5318725f]{flex-shrink:0;font-size:18px;color:rgba(100,110,130,0.4);transition:all 0.2s ease}.quest-list-item:hover .quest-list-arrow[data-v-5318725f],.quest-list-item.selected .quest-list-arrow[data-v-5318725f]{color:rgba(114,137,218,0.8);transform:translateX(2px)}.custom-scrollbar[data-v-5318725f]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-5318725f]::-webkit-scrollbar-track{background:rgba(30,33,40,0.5);border-radius:3px}.custom-scrollbar[data-v-5318725f]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.2);border-radius:3px;-webkit-transition:background 0.2s ease;transition:background 0.2s ease}.custom-scrollbar[data-v-5318725f]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.35)}

.category-filter[data-v-5306bc95]{display:flex;gap:6px;padding:0.5rem 0.75rem 0.25rem}@media (min-width:640px){.category-filter[data-v-5306bc95]{padding:0.5rem 1rem 0.25rem;gap:8px}}.filter-btn[data-v-5306bc95]{display:flex;align-items:center;gap:4px;padding:4px 10px;font-size:11px;color:rgba(150,160,180,0.8);background:rgba(35,38,45,0.6);border:1px solid rgba(100,110,130,0.15);border-radius:4px;cursor:pointer;transition:all 0.15s ease}.filter-btn[data-v-5306bc95]:hover{color:rgba(180,190,210,0.95);background:rgba(45,50,60,0.7);border-color:rgba(114,137,218,0.25)}.filter-btn.active[data-v-5306bc95]{color:#ffffff;background:rgba(114,137,218,0.2);border-color:rgba(114,137,218,0.4)}.filter-icon[data-v-5306bc95]{font-size:12px}.filter-label[data-v-5306bc95]{font-weight:500}.filter-count[data-v-5306bc95]{padding:1px 5px;font-size:10px;background:rgba(0,0,0,0.2);border-radius:8px}.filter-btn.active .filter-count[data-v-5306bc95]{background:rgba(114,137,218,0.3)}.modal-backdrop[data-v-5306bc95]{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.modal-vignette[data-v-5306bc95]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 30%,rgba(0,0,0,0.3) 100%);pointer-events:none}.modal-noise[data-v-5306bc95]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none}.skills-modal[data-v-5306bc95]{position:relative;z-index:10;display:flex;flex-direction:column;width:100%;max-width:28rem;max-height:85vh;margin:1rem;background:linear-gradient(180deg,rgba(25,27,35,0.98) 0%,rgba(20,22,28,0.99) 100%);border:1px solid rgba(114,137,218,0.25);border-radius:12px;box-shadow:0 0 50px rgba(114,137,218,0.08),0 0 0 1px rgba(114,137,218,0.08) inset,0 25px 80px rgba(0,0,0,0.5);overflow:hidden}.modal-header[data-v-5306bc95]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.9) 100%);border-bottom:1px solid rgba(114,137,218,0.15)}.header-deco-line[data-v-5306bc95]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.5rem}.header-deco-line[data-v-5306bc95]::before,.header-deco-line[data-v-5306bc95]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-5306bc95]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-5306bc95]{color:rgba(114,137,218,0.5);font-size:0.4rem;line-height:1;animation:diamond-pulse-5306bc95 3s ease-in-out infinite}@keyframes diamond-pulse-5306bc95{0%,100%{opacity:0.5}50%{opacity:1;text-shadow:0 0 6px rgba(114,137,218,0.4)}}.header-content[data-v-5306bc95]{display:flex;align-items:center;justify-content:space-between}.header-title-group[data-v-5306bc95]{display:flex;align-items:center;gap:0.5rem}.header-icon[data-v-5306bc95]{font-size:1rem;animation:glow-pulse-5306bc95 3s ease-in-out infinite}@keyframes glow-pulse-5306bc95{0%,100%{opacity:0.7;text-shadow:0 0 8px rgba(255,200,100,0.3)}50%{opacity:1;text-shadow:0 0 15px rgba(255,200,100,0.5)}}.header-title[data-v-5306bc95]{font-size:0.95rem;font-weight:600;letter-spacing:0.1em;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.close-btn[data-v-5306bc95]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border:1px solid rgba(100,110,130,0.2);border-radius:50%;background:rgba(40,43,50,0.5);color:rgba(150,160,180,0.7);cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-5306bc95]:hover{border-color:rgba(220,100,100,0.4);background:rgba(180,60,60,0.15);color:rgba(255,180,180,0.9)}.close-icon[data-v-5306bc95]{font-size:0.7rem}.detail-section[data-v-5306bc95]{flex-shrink:0;margin:0.25rem 0.75rem;padding:0.5rem;min-height:80px;max-height:200px;overflow-y:auto;background:linear-gradient(180deg,rgba(35,38,45,0.6) 0%,rgba(30,33,40,0.7) 100%);border:1px solid rgba(114,137,218,0.12);border-radius:8px}@media (min-width:640px){.detail-section[data-v-5306bc95]{margin:0.25rem 1rem;padding:0.75rem;min-height:100px;max-height:260px}}.effect-list[data-v-5306bc95]{display:flex;flex-wrap:wrap;gap:4px;max-height:60px;overflow-y:auto;padding-right:4px}@media (min-width:640px){.effect-list[data-v-5306bc95]{gap:6px;max-height:80px}}.effect-tag[data-v-5306bc95]{display:inline-block;padding:2px 6px;background:rgba(32,34,37,0.8);border-radius:3px;font-size:9px;line-height:14px;color:rgba(156,163,175,0.95);white-space:nowrap;border:1px solid rgba(114,137,218,0.08);transition:all 0.15s ease}@media (min-width:640px){.effect-tag[data-v-5306bc95]{font-size:10px;padding:3px 8px}}.effect-tag[data-v-5306bc95]:hover{background:rgba(42,44,47,0.9);border-color:rgba(114,137,218,0.15);color:rgba(180,190,210,0.95)}.detail-tags[data-v-5306bc95]{min-height:18px}@media (min-width:640px){.detail-tags[data-v-5306bc95]{min-height:20px}}.detail-tag[data-v-5306bc95]{font-size:9px;line-height:14px;height:16px;display:inline-flex;align-items:center}@media (min-width:640px){.detail-tag[data-v-5306bc95]{font-size:10px;line-height:16px;height:18px}}.detail-tag-empty[data-v-5306bc95]{font-size:9px;line-height:14px;height:16px;display:inline-flex;align-items:center;color:#6b7280}@media (min-width:640px){.detail-tag-empty[data-v-5306bc95]{font-size:10px;line-height:16px;height:18px}}.modal-footer[data-v-5306bc95]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(25,27,35,0.9) 0%,rgba(30,33,40,0.95) 100%);border-top:1px solid rgba(114,137,218,0.15)}.footer-deco-line[data-v-5306bc95]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.5rem}.footer-deco-line[data-v-5306bc95]::before,.footer-deco-line[data-v-5306bc95]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 50%,transparent 100%)}.footer-content[data-v-5306bc95]{display:flex;align-items:center;justify-content:space-between}.footer-info[data-v-5306bc95]{display:flex;align-items:center;gap:0.5rem;font-size:0.7rem;color:rgba(120,130,150,0.7);letter-spacing:0.05em}.info-diamond[data-v-5306bc95]{font-size:0.35rem;color:rgba(114,137,218,0.4)}.footer-btn[data-v-5306bc95]{position:relative;padding:0.4rem 1rem;font-size:0.75rem;font-weight:500;letter-spacing:0.08em;color:rgba(180,190,210,0.9);background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,37,45,0.95) 100%);border:1px solid rgba(100,110,130,0.25);border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.2s ease}.footer-btn[data-v-5306bc95]:hover{color:#ffffff;border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(45,48,58,0.98) 100%);transform:translateY(-1px)}.btn-glow[data-v-5306bc95]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 50%,rgba(114,137,218,0.15) 0%,transparent 60%);transition:opacity 0.2s ease}.footer-btn:hover .btn-glow[data-v-5306bc95]{opacity:1}.btn-content[data-v-5306bc95]{position:relative;z-index:1}.modal-enter-active[data-v-5306bc95]{transition:opacity 0.2s ease-out}.modal-enter-active .skills-modal[data-v-5306bc95]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-leave-active[data-v-5306bc95]{transition:opacity 0.15s ease-in}.modal-leave-active .skills-modal[data-v-5306bc95]{transition:transform 0.15s ease-in}.modal-enter-from[data-v-5306bc95],.modal-leave-to[data-v-5306bc95]{opacity:0}.modal-enter-from .skills-modal[data-v-5306bc95]{transform:scale(0.9) translateY(15px)}.modal-leave-to .skills-modal[data-v-5306bc95]{transform:scale(0.95) translateY(8px)}.skill-list-item[data-v-5306bc95]{display:flex;align-items:center;gap:10px;padding:10px 14px;background:linear-gradient(180deg,rgba(35,38,45,0.5) 0%,rgba(30,33,40,0.6) 100%);border:1px solid rgba(114,137,218,0.08);border-left:3px solid transparent;border-radius:6px;cursor:pointer;transition:all 0.2s ease}.skill-list-item[data-v-5306bc95]:hover{background:linear-gradient(180deg,rgba(45,50,60,0.6) 0%,rgba(40,43,52,0.7) 100%);border-color:rgba(114,137,218,0.15);border-left-color:rgba(114,137,218,0.6);transform:translateX(2px)}.skill-list-item.selected[data-v-5306bc95]{background:linear-gradient(180deg,rgba(114,137,218,0.12) 0%,rgba(90,110,180,0.08) 100%);border-color:rgba(114,137,218,0.25);border-left-color:rgba(114,137,218,0.8)}.skill-list-item.disabled[data-v-5306bc95]{opacity:0.5}.skill-list-info[data-v-5306bc95]{flex:1;min-width:0;display:flex;flex-direction:column;gap:3px}.skill-list-row[data-v-5306bc95]{display:flex;align-items:center;justify-content:space-between;gap:8px}.skill-list-name[data-v-5306bc95]{font-size:13px;font-weight:600;color:#ffffff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}@media (min-width:640px){.skill-list-name[data-v-5306bc95]{font-size:14px}}.cooldown-inline[data-v-5306bc95]{font-size:11px;font-weight:normal;color:#f59e0b;margin-left:6px}.skill-list-cost[data-v-5306bc95]{display:flex;align-items:center;gap:6px;flex-shrink:0;font-size:10px}@media (min-width:640px){.skill-list-cost[data-v-5306bc95]{font-size:11px;gap:8px}}.cost-mp[data-v-5306bc95]{color:#60a5fa;font-weight:500}.cost-sp[data-v-5306bc95]{color:#4ade80;font-weight:500}.cost-cd[data-v-5306bc95]{color:#9ca3af}.skill-list-tags[data-v-5306bc95]{display:flex;flex-wrap:wrap;align-items:center;gap:4px;min-height:18px}@media (min-width:640px){.skill-list-tags[data-v-5306bc95]{gap:6px;min-height:20px}}.skill-list-tag[data-v-5306bc95]{padding:1px 6px;border-radius:3px;font-size:10px;line-height:14px;height:16px;display:inline-flex;align-items:center}@media (min-width:640px){.skill-list-tag[data-v-5306bc95]{font-size:11px;line-height:16px;height:18px}}.skill-list-tag-empty[data-v-5306bc95]{font-size:10px;line-height:14px;height:16px;display:inline-flex;align-items:center;color:#6b7280}@media (min-width:640px){.skill-list-tag-empty[data-v-5306bc95]{font-size:11px;line-height:16px;height:18px}}.skill-list-arrow[data-v-5306bc95]{flex-shrink:0;font-size:18px;color:rgba(100,110,130,0.4);transition:all 0.2s ease}.skill-list-item:hover .skill-list-arrow[data-v-5306bc95],.skill-list-item.selected .skill-list-arrow[data-v-5306bc95]{color:rgba(114,137,218,0.8);transform:translateX(2px)}.custom-scrollbar[data-v-5306bc95]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-5306bc95]::-webkit-scrollbar-track{background:rgba(30,33,40,0.5);border-radius:3px}.custom-scrollbar[data-v-5306bc95]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.2);border-radius:3px;-webkit-transition:background 0.2s ease;transition:background 0.2s ease}.custom-scrollbar[data-v-5306bc95]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.35)}@media (max-width:480px){.skills-modal[data-v-5306bc95]{margin:0.5rem;max-height:90vh}.header-title[data-v-5306bc95]{font-size:0.875rem}.detail-section[data-v-5306bc95]{margin:0.5rem;padding:0.5rem}}.context-menu-backdrop[data-v-5306bc95]{position:fixed;inset:0;z-index:98;background:transparent}.context-menu[data-v-5306bc95]{position:fixed;z-index:99;min-width:140px;background:linear-gradient(180deg,rgba(45,48,55,0.98) 0%,rgba(35,38,45,0.99) 100%);border:1px solid rgba(114,137,218,0.3);border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.4),0 0 0 1px rgba(114,137,218,0.1) inset;overflow:hidden}.context-menu-header[data-v-5306bc95]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(114,137,218,0.08)}.context-menu-icon[data-v-5306bc95]{font-size:14px}.context-menu-title[data-v-5306bc95]{font-size:12px;font-weight:600;color:#ffffff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.context-menu-divider[data-v-5306bc95]{height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 50%,transparent 100%)}.context-menu-item[data-v-5306bc95]{display:flex;align-items:center;gap:8px;width:100%;padding:10px 12px;font-size:12px;color:rgba(180,190,210,0.9);background:transparent;border:none;cursor:pointer;transition:all 0.15s ease}.context-menu-item[data-v-5306bc95]:hover:not(:disabled){background:rgba(114,137,218,0.1)}.context-menu-item.danger[data-v-5306bc95]{color:rgba(255,100,100,0.9)}.context-menu-item.danger[data-v-5306bc95]:hover:not(:disabled){background:rgba(255,100,100,0.15);color:#ff6b6b}.context-menu-item[data-v-5306bc95]:disabled{opacity:0.5;cursor:not-allowed;color:rgba(120,130,150,0.6)}.context-menu-item-icon[data-v-5306bc95]{font-size:14px}.context-menu-fade-enter-active[data-v-5306bc95]{transition:all 0.15s ease-out}.context-menu-fade-leave-active[data-v-5306bc95]{transition:all 0.1s ease-in}.context-menu-fade-enter-from[data-v-5306bc95],.context-menu-fade-leave-to[data-v-5306bc95]{opacity:0;transform:scale(0.9)}.confirm-overlay[data-v-5306bc95]{position:fixed;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);backdrop-filter:blur(3px)}.confirm-dialog[data-v-5306bc95]{width:90%;max-width:300px;background:linear-gradient(180deg,rgba(40,43,50,0.98) 0%,rgba(30,33,40,0.99) 100%);border:1px solid rgba(255,100,100,0.3);border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.5),0 0 0 1px rgba(255,100,100,0.1) inset;overflow:hidden}.confirm-header[data-v-5306bc95]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:rgba(255,100,100,0.1);border-bottom:1px solid rgba(255,100,100,0.15)}.confirm-icon[data-v-5306bc95]{font-size:18px}.confirm-title[data-v-5306bc95]{font-size:14px;font-weight:600;color:rgba(255,180,180,0.95)}.confirm-body[data-v-5306bc95]{padding:16px;text-align:center}.confirm-body p[data-v-5306bc95]{font-size:13px;color:rgba(200,210,220,0.9);margin:0;line-height:1.5}.confirm-body strong[data-v-5306bc95]{color:#ffffff}.confirm-warning[data-v-5306bc95]{margin-top:8px !important;font-size:11px !important;color:rgba(255,150,150,0.8) !important}.confirm-footer[data-v-5306bc95]{display:flex;gap:10px;padding:12px 16px;border-top:1px solid rgba(100,110,130,0.15)}.confirm-btn[data-v-5306bc95]{flex:1;padding:8px 12px;font-size:12px;font-weight:500;border-radius:5px;cursor:pointer;transition:all 0.15s ease}.confirm-btn.cancel[data-v-5306bc95]{color:rgba(180,190,210,0.9);background:rgba(60,65,75,0.8);border:1px solid rgba(100,110,130,0.3)}.confirm-btn.cancel[data-v-5306bc95]:hover{background:rgba(70,75,85,0.9);border-color:rgba(120,130,150,0.4)}.confirm-btn.danger[data-v-5306bc95]{color:#ffffff;background:linear-gradient(180deg,rgba(180,60,60,0.9) 0%,rgba(150,50,50,0.95) 100%);border:1px solid rgba(255,100,100,0.4)}.confirm-btn.danger[data-v-5306bc95]:hover{background:linear-gradient(180deg,rgba(200,70,70,0.95) 0%,rgba(170,60,60,0.98) 100%);box-shadow:0 0 12px rgba(255,100,100,0.3)}.confirm-fade-enter-active[data-v-5306bc95]{transition:all 0.2s ease-out}.confirm-fade-leave-active[data-v-5306bc95]{transition:all 0.15s ease-in}.confirm-fade-enter-from[data-v-5306bc95],.confirm-fade-leave-to[data-v-5306bc95]{opacity:0}.confirm-fade-enter-from .confirm-dialog[data-v-5306bc95],.confirm-fade-leave-to .confirm-dialog[data-v-5306bc95]{transform:scale(0.9) translateY(-10px)}

.modal-backdrop[data-v-70a38537]{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.modal-vignette[data-v-70a38537]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 30%,rgba(0,0,0,0.3) 100%);pointer-events:none}.modal-noise[data-v-70a38537]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none}.shop-modal[data-v-70a38537]{position:relative;z-index:10;display:flex;flex-direction:column;width:100%;max-width:32rem;max-height:85vh;margin:1rem;background:linear-gradient(180deg,rgba(25,27,35,0.98) 0%,rgba(20,22,28,0.99) 100%);border:1px solid rgba(217,166,97,0.2);border-radius:12px;box-shadow:0 0 50px rgba(217,166,97,0.06),0 0 0 1px rgba(217,166,97,0.06) inset,0 25px 80px rgba(0,0,0,0.5);overflow:hidden}.modal-header[data-v-70a38537]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.9) 100%);border-bottom:1px solid rgba(217,166,97,0.12)}.header-deco-line[data-v-70a38537],.footer-deco-line[data-v-70a38537]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.5rem}.header-deco-line[data-v-70a38537]::before,.header-deco-line[data-v-70a38537]::after,.footer-deco-line[data-v-70a38537]::before,.footer-deco-line[data-v-70a38537]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(217,166,97,0.3) 100%)}.header-deco-line[data-v-70a38537]::after,.footer-deco-line[data-v-70a38537]::after{background:linear-gradient(90deg,rgba(217,166,97,0.3) 0%,transparent 100%)}.deco-diamond[data-v-70a38537]{color:rgba(217,166,97,0.5);font-size:0.4rem;animation:diamond-pulse-70a38537 3s ease-in-out infinite}@keyframes diamond-pulse-70a38537{0%,100%{opacity:0.5}50%{opacity:1;text-shadow:0 0 6px rgba(217,166,97,0.4)}}.header-content[data-v-70a38537]{display:flex;align-items:center;justify-content:space-between}.header-title-group[data-v-70a38537]{display:flex;align-items:center;gap:0.625rem}.header-icon[data-v-70a38537]{font-size:1.25rem}.header-info[data-v-70a38537]{display:flex;flex-direction:column;gap:0.125rem}.header-title[data-v-70a38537]{font-size:0.95rem;font-weight:600;letter-spacing:0.08em;background:linear-gradient(180deg,#ffffff 0%,#e8d5b5 50%,#c8b090 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.header-rates[data-v-70a38537]{display:flex;align-items:center;gap:0.375rem;font-size:0.65rem}.rate-item[data-v-70a38537]{padding:0.125rem 0.375rem;border-radius:3px;font-weight:500}.rate-item.buy[data-v-70a38537]{background:rgba(217,166,97,0.15);color:rgba(235,200,140,0.9)}.rate-item.sell[data-v-70a38537]{background:rgba(100,200,120,0.15);color:rgba(150,230,160,0.9)}.rate-divider[data-v-70a38537]{color:rgba(100,110,130,0.4);font-size:0.5rem}.close-btn[data-v-70a38537]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border:1px solid rgba(100,110,130,0.2);border-radius:50%;background:rgba(40,43,50,0.5);color:rgba(150,160,180,0.7);cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-70a38537]:hover{border-color:rgba(220,100,100,0.4);background:rgba(180,60,60,0.15);color:rgba(255,180,180,0.9)}.close-icon[data-v-70a38537]{font-size:0.7rem}.wallet-section[data-v-70a38537]{flex-shrink:0;padding:0.5rem 1rem;background:linear-gradient(180deg,rgba(35,38,45,0.6) 0%,rgba(30,33,40,0.7) 100%);border-bottom:1px solid rgba(217,166,97,0.08)}.wallet-content[data-v-70a38537]{display:flex;align-items:center;justify-content:space-between}.wallet-label[data-v-70a38537]{display:flex;align-items:center;gap:0.375rem;font-size:0.75rem;color:rgba(150,160,180,0.7)}.wallet-icon[data-v-70a38537]{font-size:0.875rem}.wallet-amount[data-v-70a38537]{font-family:monospace;font-size:0.9rem;font-weight:600;color:rgba(235,200,140,0.95);letter-spacing:0.05em}.tabs-container[data-v-70a38537]{display:flex;flex-shrink:0;border-bottom:1px solid rgba(100,110,130,0.15)}.tab-btn[data-v-70a38537]{flex:1;display:flex;align-items:center;justify-content:center;gap:0.375rem;padding:0.625rem 1rem;font-size:0.8rem;font-weight:500;color:rgba(150,160,180,0.7);background:transparent;border:none;border-bottom:2px solid transparent;cursor:pointer;transition:all 0.2s ease}.tab-btn[data-v-70a38537]:hover{color:rgba(200,210,230,0.9);background:rgba(114,137,218,0.05)}.tab-btn.active.accent-amber[data-v-70a38537]{color:rgba(235,200,140,0.95);border-bottom-color:rgba(217,166,97,0.7);background:rgba(217,166,97,0.08)}.tab-btn.active.accent-green[data-v-70a38537]{color:rgba(150,230,160,0.95);border-bottom-color:rgba(100,200,120,0.7);background:rgba(100,200,120,0.08)}.tab-icon[data-v-70a38537]{font-size:0.9rem}.tab-text[data-v-70a38537]{letter-spacing:0.05em}.detail-section[data-v-70a38537]{flex-shrink:0;margin:0.75rem;padding:0.75rem;background:linear-gradient(180deg,rgba(35,38,45,0.6) 0%,rgba(30,33,40,0.7) 100%);border:1px solid rgba(217,166,97,0.12);border-radius:8px}.detail-content[data-v-70a38537]{display:flex;gap:0.75rem}.item-icon-wrapper[data-v-70a38537]{display:flex;align-items:center;justify-content:center;width:3rem;height:3rem;background:linear-gradient(180deg,rgba(25,27,35,0.8) 0%,rgba(20,22,28,0.9) 100%);border:1px solid rgba(217,166,97,0.2);border-radius:8px}.item-icon[data-v-70a38537]{font-size:1.5rem}.item-info[data-v-70a38537]{flex:1;min-width:0}.item-name[data-v-70a38537]{font-size:0.9rem;font-weight:600;color:rgba(240,240,245,0.95);margin-bottom:0.25rem}.item-meta[data-v-70a38537]{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.25rem}.item-type[data-v-70a38537]{font-size:0.7rem;color:rgba(150,160,180,0.7)}.item-desc[data-v-70a38537]{font-size:0.7rem;color:rgba(140,150,170,0.8);line-height:1.4}.quality-badge[data-v-70a38537],.quality-tag[data-v-70a38537]{padding:0.125rem 0.375rem;font-size:0.65rem;font-weight:500;border-radius:3px}.quality-common[data-v-70a38537]{background:rgba(100,110,130,0.2);color:rgba(180,190,210,0.9)}.quality-uncommon[data-v-70a38537]{background:rgba(100,200,120,0.2);color:rgba(150,230,160,0.9)}.quality-rare[data-v-70a38537]{background:rgba(100,150,230,0.2);color:rgba(140,180,255,0.9)}.quality-epic[data-v-70a38537]{background:rgba(180,100,230,0.2);color:rgba(210,150,255,0.9)}.quality-legendary[data-v-70a38537]{background:rgba(217,166,97,0.2);color:rgba(235,200,140,0.9)}.quality-mythic[data-v-70a38537]{background:rgba(230,100,100,0.2);color:rgba(255,150,150,0.9)}.detail-actions[data-v-70a38537]{display:flex;align-items:center;justify-content:space-between;margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid rgba(100,110,130,0.15)}.price-info[data-v-70a38537]{display:flex;align-items:center;gap:0.375rem}.price-label[data-v-70a38537]{font-size:0.7rem;color:rgba(150,160,180,0.7)}.price-value[data-v-70a38537]{font-family:monospace;font-size:0.85rem;font-weight:600}.price-value.amber[data-v-70a38537]{color:rgba(235,200,140,0.95)}.price-value.green[data-v-70a38537]{color:rgba(150,230,160,0.95)}.action-group[data-v-70a38537]{display:flex;align-items:center;gap:0.5rem}.stock-info[data-v-70a38537]{font-size:0.65rem;color:rgba(140,150,170,0.7)}.action-btn[data-v-70a38537]{position:relative;padding:0.375rem 0.875rem;font-size:0.75rem;font-weight:600;border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.2s ease}.action-btn.buy[data-v-70a38537]{background:linear-gradient(180deg,rgba(217,166,97,0.25) 0%,rgba(180,130,70,0.2) 100%);border:1px solid rgba(217,166,97,0.4);color:rgba(235,200,140,0.95)}.action-btn.buy[data-v-70a38537]:hover:not(:disabled){background:linear-gradient(180deg,rgba(217,166,97,0.35) 0%,rgba(180,130,70,0.3) 100%);border-color:rgba(217,166,97,0.6);transform:translateY(-1px)}.action-btn.sell[data-v-70a38537]{background:linear-gradient(180deg,rgba(100,200,120,0.25) 0%,rgba(70,160,90,0.2) 100%);border:1px solid rgba(100,200,120,0.4);color:rgba(150,230,160,0.95)}.action-btn.sell[data-v-70a38537]:hover:not(:disabled){background:linear-gradient(180deg,rgba(100,200,120,0.35) 0%,rgba(70,160,90,0.3) 100%);border-color:rgba(100,200,120,0.6);transform:translateY(-1px)}.action-btn[data-v-70a38537]:disabled{opacity:0.5;cursor:not-allowed}.btn-glow[data-v-70a38537]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 50%,rgba(255,255,255,0.15) 0%,transparent 60%);transition:opacity 0.2s ease}.action-btn:hover:not(:disabled) .btn-glow[data-v-70a38537]{opacity:1}.btn-content[data-v-70a38537]{position:relative;z-index:1}.items-list[data-v-70a38537]{flex:1;min-height:0;overflow-y:auto;padding:0.75rem}.empty-state[data-v-70a38537]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.5rem;padding:2rem;color:rgba(140,150,170,0.7)}.empty-icon[data-v-70a38537]{font-size:2rem;opacity:0.6}.empty-text[data-v-70a38537]{font-size:0.8rem;letter-spacing:0.05em}.items-grid[data-v-70a38537]{display:flex;flex-direction:column;gap:0.5rem}.shop-item-card[data-v-70a38537]{display:flex;align-items:center;gap:0.75rem;padding:0.625rem 0.75rem;background:linear-gradient(180deg,rgba(35,38,45,0.5) 0%,rgba(30,33,40,0.6) 100%);border:1px solid rgba(217,166,97,0.08);border-left:3px solid transparent;border-radius:6px;cursor:pointer;transition:all 0.2s ease}.shop-item-card[data-v-70a38537]:hover{background:linear-gradient(180deg,rgba(45,50,60,0.6) 0%,rgba(40,43,52,0.7) 100%);border-color:rgba(217,166,97,0.15);border-left-color:rgba(217,166,97,0.6);transform:translateX(2px)}.shop-item-card.selected[data-v-70a38537]{background:linear-gradient(180deg,rgba(217,166,97,0.12) 0%,rgba(180,130,70,0.08) 100%);border-color:rgba(217,166,97,0.25);border-left-color:rgba(217,166,97,0.8)}.shop-item-card.out-of-stock[data-v-70a38537]{opacity:0.5;cursor:not-allowed}.shop-item-card.out-of-stock[data-v-70a38537]:hover{transform:none;border-left-color:transparent}.item-left[data-v-70a38537]{display:flex;align-items:center;gap:0.625rem;flex:1;min-width:0}.item-emoji[data-v-70a38537]{font-size:1.25rem}.item-details[data-v-70a38537]{display:flex;flex-direction:column;gap:0.125rem;min-width:0}.item-card-name[data-v-70a38537]{font-size:0.85rem;font-weight:500;color:rgba(240,240,245,0.95);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-stock[data-v-70a38537]{font-size:0.65rem;color:rgba(140,150,170,0.7);display:flex;align-items:center;gap:0.375rem}.sold-out[data-v-70a38537]{color:rgba(230,100,100,0.9);font-weight:500}.item-right[data-v-70a38537]{display:flex;flex-direction:column;align-items:flex-end;gap:0.125rem;flex-shrink:0}.item-price[data-v-70a38537]{font-family:monospace;font-size:0.8rem;font-weight:600}.item-price.amber[data-v-70a38537]{color:rgba(235,200,140,0.95)}.item-price.green[data-v-70a38537]{color:rgba(150,230,160,0.95)}.cannot-afford[data-v-70a38537]{font-size:0.6rem;color:rgba(230,100,100,0.8)}.price-note[data-v-70a38537]{font-size:0.6rem;color:rgba(140,150,170,0.6)}.item-arrow[data-v-70a38537]{flex-shrink:0;font-size:1.125rem;color:rgba(100,110,130,0.4);transition:all 0.2s ease}.shop-item-card:hover .item-arrow[data-v-70a38537],.shop-item-card.selected .item-arrow[data-v-70a38537]{color:rgba(217,166,97,0.8);transform:translateX(2px)}.modal-footer[data-v-70a38537]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(25,27,35,0.9) 0%,rgba(30,33,40,0.95) 100%);border-top:1px solid rgba(217,166,97,0.12)}.footer-content[data-v-70a38537]{display:flex;align-items:center;justify-content:space-between}.footer-info[data-v-70a38537]{display:flex;align-items:center;gap:0.5rem;font-size:0.7rem;color:rgba(120,130,150,0.7);letter-spacing:0.05em}.info-diamond[data-v-70a38537]{font-size:0.35rem;color:rgba(217,166,97,0.4)}.footer-btn[data-v-70a38537]{position:relative;padding:0.4rem 1rem;font-size:0.75rem;font-weight:500;letter-spacing:0.08em;color:rgba(180,190,210,0.9);background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,37,45,0.95) 100%);border:1px solid rgba(100,110,130,0.25);border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.2s ease}.footer-btn[data-v-70a38537]:hover{color:#ffffff;border-color:rgba(217,166,97,0.4);background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(45,48,58,0.98) 100%);transform:translateY(-1px)}.custom-scrollbar[data-v-70a38537]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-70a38537]::-webkit-scrollbar-track{background:rgba(30,33,40,0.5);border-radius:3px}.custom-scrollbar[data-v-70a38537]::-webkit-scrollbar-thumb{background:rgba(217,166,97,0.2);border-radius:3px}.custom-scrollbar[data-v-70a38537]::-webkit-scrollbar-thumb:hover{background:rgba(217,166,97,0.35)}.modal-enter-active[data-v-70a38537]{transition:opacity 0.2s ease-out}.modal-enter-active .shop-modal[data-v-70a38537]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-leave-active[data-v-70a38537]{transition:opacity 0.15s ease-in}.modal-leave-active .shop-modal[data-v-70a38537]{transition:transform 0.15s ease-in}.modal-enter-from[data-v-70a38537],.modal-leave-to[data-v-70a38537]{opacity:0}.modal-enter-from .shop-modal[data-v-70a38537]{transform:scale(0.9) translateY(15px)}.modal-leave-to .shop-modal[data-v-70a38537]{transform:scale(0.95) translateY(8px)}@media (max-width:480px){.shop-modal[data-v-70a38537]{margin:0.5rem;max-height:90vh}.header-title[data-v-70a38537]{font-size:0.875rem}.detail-section[data-v-70a38537]{margin:0.5rem;padding:0.5rem}}

.adventure-notes-backdrop[data-v-35184c82]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,16,12,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.adventure-notes-modal[data-v-35184c82]{position:relative;border:1px solid rgba(217,166,97,0.3);background:transparent}.modal-bg-layer[data-v-35184c82]{position:absolute;inset:0;background:linear-gradient(180deg,rgba(35,32,28,0.98) 0%,rgba(28,26,24,0.99) 50%,rgba(22,21,20,1) 100%);border-radius:inherit}.modal-noise[data-v-35184c82]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;border-radius:inherit}.modal-header[data-v-35184c82]{border-bottom:1px solid rgba(217,166,97,0.15);background:linear-gradient(180deg,rgba(217,166,97,0.08) 0%,transparent 100%)}.header-deco-line[data-v-35184c82]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-35184c82]::before,.header-deco-line[data-v-35184c82]::after{content:'';flex:1;height:1px;max-width:120px;background:linear-gradient(90deg,transparent 0%,rgba(217,166,97,0.3) 100%)}.header-deco-line[data-v-35184c82]::after{background:linear-gradient(90deg,rgba(217,166,97,0.3) 0%,transparent 100%)}.deco-diamond[data-v-35184c82]{color:rgba(217,166,97,0.5);font-size:0.5rem;animation:diamond-pulse-35184c82 3s ease-in-out infinite}@keyframes diamond-pulse-35184c82{0%,100%{opacity:0.5;text-shadow:0 0 4px rgba(217,166,97,0.3)}50%{opacity:1;text-shadow:0 0 8px rgba(217,166,97,0.6)}}.header-icon[data-v-35184c82]{filter:drop-shadow(0 0 6px rgba(217,166,97,0.4))}.header-title[data-v-35184c82]{background:linear-gradient(180deg,#ffffff 0%,#d9a661 50%,#b8864a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.3))}.record-badge[data-v-35184c82]{background:rgba(217,166,97,0.15);border:1px solid rgba(217,166,97,0.25);border-radius:4px;color:rgba(217,166,97,0.8)}.close-btn[data-v-35184c82]{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:4px;color:rgba(180,160,140,0.6);transition:all 0.2s ease;background:transparent;border:none;cursor:pointer}.close-btn[data-v-35184c82]:hover{color:rgba(217,166,97,0.9);background:rgba(217,166,97,0.1)}.tab-navigation[data-v-35184c82]{background:rgba(28,26,24,0.8);border-bottom:1px solid rgba(217,166,97,0.15)}.tab-btn[data-v-35184c82]{color:rgba(180,160,140,0.6);border:none;background:transparent;cursor:pointer;position:relative}.tab-btn[data-v-35184c82]:hover{color:rgba(217,166,97,0.8);background:rgba(217,166,97,0.05)}.tab-btn.active[data-v-35184c82]{color:rgba(217,166,97,0.95);background:rgba(35,32,28,0.9)}.tab-btn.active[data-v-35184c82]::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(217,166,97,0.8),transparent)}.pending-badge[data-v-35184c82]{background:rgba(239,68,68,0.8);color:white;border-radius:9999px}.modal-content[data-v-35184c82]{background:rgba(28,26,24,0.5)}.content-card[data-v-35184c82]{background:rgba(35,32,28,0.6);border:1px solid rgba(217,166,97,0.15)}.section-title[data-v-35184c82]{color:rgba(217,166,97,0.9)}.stat-card[data-v-35184c82]{background:rgba(22,21,20,0.8);border:1px solid rgba(217,166,97,0.1)}.stat-value.amber[data-v-35184c82]{color:rgba(217,166,97,0.95);text-shadow:0 0 10px rgba(217,166,97,0.3)}.stat-value.green[data-v-35184c82]{color:rgba(74,222,128,0.9);text-shadow:0 0 10px rgba(74,222,128,0.3)}.stat-value.orange[data-v-35184c82]{color:rgba(251,146,60,0.9);text-shadow:0 0 10px rgba(251,146,60,0.3)}.stat-label[data-v-35184c82]{color:rgba(180,160,140,0.5)}.progress-header[data-v-35184c82]{color:rgba(180,160,140,0.6)}.progress-bar-bg[data-v-35184c82]{background:rgba(22,21,20,0.8)}.progress-bar-fill[data-v-35184c82]{background:linear-gradient(90deg,rgba(217,166,97,0.8),rgba(251,146,60,0.8))}.progress-hint[data-v-35184c82]{color:rgba(180,160,140,0.4)}.action-btn[data-v-35184c82]{position:relative;overflow:hidden;border:1px solid rgba(217,166,97,0.3);color:rgba(220,200,180,0.9);cursor:pointer}.action-btn.primary[data-v-35184c82]{background:linear-gradient(180deg,rgba(217,166,97,0.25) 0%,rgba(180,130,70,0.2) 100%)}.action-btn.primary[data-v-35184c82]:hover:not(:disabled){border-color:rgba(217,166,97,0.5);background:linear-gradient(180deg,rgba(217,166,97,0.35) 0%,rgba(180,130,70,0.3) 100%);transform:translateY(-1px);box-shadow:0 4px 15px rgba(217,166,97,0.2)}.action-btn.secondary[data-v-35184c82]{background:linear-gradient(180deg,rgba(50,45,40,0.8) 0%,rgba(40,36,32,0.9) 100%)}.action-btn.secondary[data-v-35184c82]:hover{border-color:rgba(217,166,97,0.4);background:linear-gradient(180deg,rgba(60,55,50,0.9) 0%,rgba(50,45,40,0.95) 100%)}.btn-glow[data-v-35184c82]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at var(--x,50%) var(--y,50%),rgba(217,166,97,0.15) 0%,transparent 50%);transition:opacity 0.3s ease}.action-btn:hover .btn-glow[data-v-35184c82]{opacity:1}.btn-content[data-v-35184c82]{position:relative;z-index:1}.settings-label[data-v-35184c82]{color:rgba(180,160,140,0.6)}.settings-input[data-v-35184c82]{background:rgba(22,21,20,0.8);border:1px solid rgba(217,166,97,0.2);color:rgba(220,200,180,0.9)}.settings-input[data-v-35184c82]:focus{outline:none;border-color:rgba(217,166,97,0.5)}.settings-hint[data-v-35184c82]{color:rgba(180,160,140,0.4)}.empty-state[data-v-35184c82]{color:rgba(180,160,140,0.5)}.empty-title[data-v-35184c82]{color:rgba(180,160,140,0.7)}.empty-hint[data-v-35184c82]{color:rgba(180,160,140,0.4)}.block-card[data-v-35184c82]{background:rgba(35,32,28,0.6);border:1px solid rgba(217,166,97,0.15)}.block-card.status-completed[data-v-35184c82]{border-color:rgba(74,222,128,0.3);background:rgba(74,222,128,0.05)}.block-card.status-pending[data-v-35184c82]{border-color:rgba(251,146,60,0.3);background:rgba(251,146,60,0.05)}.block-card.status-error[data-v-35184c82]{border-color:rgba(239,68,68,0.3);background:rgba(239,68,68,0.05)}.block-card.status-summarizing[data-v-35184c82]{border-color:rgba(96,165,250,0.3);background:rgba(96,165,250,0.05)}.status-badge.status-completed[data-v-35184c82]{background:rgba(74,222,128,0.2);color:rgba(74,222,128,0.9)}.status-badge.status-pending[data-v-35184c82]{background:rgba(251,146,60,0.2);color:rgba(251,146,60,0.9)}.status-badge.status-error[data-v-35184c82]{background:rgba(239,68,68,0.2);color:rgba(239,68,68,0.9)}.status-badge.status-summarizing[data-v-35184c82]{background:rgba(96,165,250,0.2);color:rgba(96,165,250,0.9)}.block-title[data-v-35184c82]{color:rgba(220,200,180,0.9)}.block-meta[data-v-35184c82]{color:rgba(180,160,140,0.5)}.block-action-btn[data-v-35184c82]{cursor:pointer;transition:all 0.2s ease}.block-action-btn.primary[data-v-35184c82]{background:rgba(217,166,97,0.8);color:rgba(30,28,26,0.95);border:none}.block-action-btn.primary[data-v-35184c82]:hover:not(:disabled){background:rgba(217,166,97,0.95)}.block-action-btn.secondary[data-v-35184c82]{background:rgba(80,75,70,0.6);color:rgba(180,160,140,0.8);border:none}.block-action-btn.secondary[data-v-35184c82]:hover{background:rgba(100,95,90,0.7)}.expand-btn[data-v-35184c82]{color:rgba(180,160,140,0.5);background:transparent;border:none;cursor:pointer;padding:4px;transition:color 0.2s ease}.expand-btn[data-v-35184c82]:hover{color:rgba(217,166,97,0.8)}.block-content[data-v-35184c82]{border-top:1px solid rgba(217,166,97,0.1)}.summary-text[data-v-35184c82]{color:rgba(200,180,160,0.85)}.error-text[data-v-35184c82]{color:rgba(239,68,68,0.9)}.loading-text[data-v-35184c82]{color:rgba(96,165,250,0.9)}.placeholder-text[data-v-35184c82]{color:rgba(180,160,140,0.5)}.summary-time[data-v-35184c82]{color:rgba(180,160,140,0.4)}.notes-hint[data-v-35184c82]{color:rgba(180,160,140,0.6)}.notes-textarea[data-v-35184c82]{background:rgba(35,32,28,0.8);border:1px solid rgba(217,166,97,0.2);color:rgba(220,200,180,0.9)}.notes-textarea[data-v-35184c82]::placeholder{color:rgba(180,160,140,0.4)}.notes-textarea[data-v-35184c82]:focus{outline:none;border-color:rgba(217,166,97,0.5)}.notes-footer[data-v-35184c82]{color:rgba(180,160,140,0.5)}.saved-indicator[data-v-35184c82]{color:rgba(74,222,128,0.9)}.custom-scrollbar[data-v-35184c82]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-35184c82]::-webkit-scrollbar-track{background:rgba(22,21,20,0.5)}.custom-scrollbar[data-v-35184c82]::-webkit-scrollbar-thumb{background:rgba(217,166,97,0.3);border-radius:3px}.custom-scrollbar[data-v-35184c82]::-webkit-scrollbar-thumb:hover{background:rgba(217,166,97,0.5)}.modal-fade-enter-active[data-v-35184c82],.modal-fade-leave-active[data-v-35184c82]{transition:opacity 0.25s ease}.modal-fade-enter-active .adventure-notes-modal[data-v-35184c82]{transition:transform 0.25s ease,opacity 0.25s ease}.modal-fade-leave-active .adventure-notes-modal[data-v-35184c82]{transition:transform 0.2s ease,opacity 0.2s ease}.modal-fade-enter-from[data-v-35184c82],.modal-fade-leave-to[data-v-35184c82]{opacity:0}.modal-fade-enter-from .adventure-notes-modal[data-v-35184c82]{transform:scale(0.95) translateY(10px);opacity:0}.modal-fade-leave-to .adventure-notes-modal[data-v-35184c82]{transform:scale(0.98) translateY(5px);opacity:0}.expand-enter-active[data-v-35184c82],.expand-leave-active[data-v-35184c82]{transition:all 0.2s ease;overflow:hidden}.expand-enter-from[data-v-35184c82],.expand-leave-to[data-v-35184c82]{opacity:0;max-height:0}.expand-enter-to[data-v-35184c82],.expand-leave-from[data-v-35184c82]{opacity:1;max-height:500px}

.modal-fade-enter-active[data-v-85703396],.modal-fade-leave-active[data-v-85703396]{transition:opacity 0.2s ease}.modal-fade-enter-from[data-v-85703396],.modal-fade-leave-to[data-v-85703396]{opacity:0}

.modal-fade-enter-active[data-v-384b1589],.modal-fade-leave-active[data-v-384b1589]{transition:opacity 0.2s ease}.modal-fade-enter-from[data-v-384b1589],.modal-fade-leave-to[data-v-384b1589]{opacity:0}

.debug-backdrop[data-v-efe272e8]{background:linear-gradient(135deg,rgba(10,10,15,0.94) 0%,rgba(18,15,15,0.94) 50%,rgba(13,14,20,0.94) 100%);backdrop-filter:blur(6px)}.debug-modal[data-v-efe272e8]{position:relative;border:1px solid rgba(220,80,80,0.4);background:transparent}.modal-bg-layer[data-v-efe272e8]{position:absolute;inset:0;background:linear-gradient(180deg,rgba(32,28,28,0.98) 0%,rgba(28,25,25,0.99) 50%,rgba(22,20,20,1) 100%);border-radius:inherit}.modal-noise[data-v-efe272e8]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;border-radius:inherit}.modal-header[data-v-efe272e8]{border-bottom:1px solid rgba(220,80,80,0.25);background:linear-gradient(180deg,rgba(40,32,32,0.8) 0%,rgba(35,28,28,0.6) 100%)}.header-deco-line[data-v-efe272e8]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-efe272e8]::before,.header-deco-line[data-v-efe272e8]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(220,80,80,0.4) 100%)}.header-deco-line[data-v-efe272e8]::after{background:linear-gradient(90deg,rgba(220,80,80,0.4) 0%,transparent 100%)}.deco-diamond[data-v-efe272e8]{color:rgba(220,80,80,0.6);font-size:0.5rem;animation:diamond-pulse-efe272e8 3s ease-in-out infinite}@keyframes diamond-pulse-efe272e8{0%,100%{opacity:0.5}50%{opacity:1}}.header-title[data-v-efe272e8]{background:linear-gradient(180deg,#ff8080 0%,#dc5050 50%,#c04040 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 10px rgba(220,80,80,0.3))}.close-btn[data-v-efe272e8]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border-radius:4px;border:1px solid rgba(220,80,80,0.3);background:rgba(30,28,28,0.8);color:rgba(180,160,160,0.8);font-size:0.75rem;cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-efe272e8]:hover{border-color:rgba(220,80,80,0.6);background:rgba(220,80,80,0.15);color:#ffffff}.mobile-tab-bar[data-v-efe272e8]{border-bottom:1px solid rgba(100,100,100,0.2);background:linear-gradient(180deg,rgba(35,30,30,0.8) 0%,rgba(30,26,26,0.6) 100%)}.mobile-tab[data-v-efe272e8]{color:rgba(150,140,140,0.7);border-bottom:2px solid transparent}.mobile-tab.active[data-v-efe272e8]{color:rgba(255,130,130,0.95);border-bottom-color:rgba(220,80,80,0.8)}.sidebar-nav[data-v-efe272e8]{border-right:1px solid rgba(100,100,100,0.15);background:linear-gradient(180deg,rgba(35,30,30,0.8) 0%,rgba(30,26,26,0.6) 100%)}.sidebar-tab[data-v-efe272e8]{color:rgba(150,140,140,0.7);border:1px solid transparent}.sidebar-tab[data-v-efe272e8]:hover{background:rgba(60,50,50,0.5);color:rgba(200,190,190,0.9)}.sidebar-tab.active[data-v-efe272e8]{border-color:rgba(220,80,80,0.4);background:linear-gradient(180deg,rgba(220,80,80,0.25) 0%,rgba(180,60,60,0.2) 100%);color:rgba(255,200,200,0.95);box-shadow:0 0 10px rgba(220,80,80,0.15)}.main-panel[data-v-efe272e8]{background:linear-gradient(180deg,rgba(40,35,35,0.6) 0%,rgba(35,30,30,0.4) 100%)}.main-panel[data-v-efe272e8] .bg-\[202225\]{background:linear-gradient(180deg,rgba(30,26,26,0.9) 0%,rgba(25,22,22,0.95) 100%) !important;border:1px solid rgba(100,80,80,0.2);border-radius:6px}.main-panel[data-v-efe272e8] .bg-\[2f3136\]{background:rgba(40,35,35,0.8) !important}.modal-enter-active[data-v-efe272e8]{transition:opacity 0.2s ease-out}.modal-enter-active .debug-modal[data-v-efe272e8]{transition:transform 0.25s ease-out,opacity 0.25s ease-out}.modal-leave-active[data-v-efe272e8]{transition:opacity 0.15s ease-in}.modal-leave-active .debug-modal[data-v-efe272e8]{transition:transform 0.15s ease-in,opacity 0.15s ease-in}.modal-enter-from[data-v-efe272e8],.modal-leave-to[data-v-efe272e8]{opacity:0}.modal-enter-from .debug-modal[data-v-efe272e8]{transform:scale(0.95) translateY(10px);opacity:0}.modal-leave-to .debug-modal[data-v-efe272e8]{transform:scale(0.95) translateY(10px);opacity:0}.custom-scrollbar[data-v-efe272e8]::-webkit-scrollbar{width:8px;height:8px}.custom-scrollbar[data-v-efe272e8]::-webkit-scrollbar-track{background:rgba(25,22,22,0.5);border-radius:4px}.custom-scrollbar[data-v-efe272e8]::-webkit-scrollbar-thumb{background:rgba(220,80,80,0.3);border-radius:4px}.custom-scrollbar[data-v-efe272e8]::-webkit-scrollbar-thumb:hover{background:rgba(220,80,80,0.5)}textarea.custom-scrollbar[data-v-efe272e8]{scrollbar-width:thin;scrollbar-color:rgba(220,80,80,0.3) rgba(25,22,22,0.5)}

.modal-fade-enter-active[data-v-9663470a],.modal-fade-leave-active[data-v-9663470a]{transition:opacity 0.2s ease}.modal-fade-enter-active .flex[data-v-9663470a],.modal-fade-leave-active .flex[data-v-9663470a]{transition:transform 0.2s ease}.modal-fade-enter-from[data-v-9663470a],.modal-fade-leave-to[data-v-9663470a]{opacity:0}.modal-fade-enter-from .flex[data-v-9663470a],.modal-fade-leave-to .flex[data-v-9663470a]{transform:scale(0.95)}

.notepad-backdrop[data-v-0f26c597]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.notepad-modal[data-v-0f26c597]{position:relative;border:1px solid rgba(114,137,218,0.3);background:transparent}.modal-bg-layer[data-v-0f26c597]{position:absolute;inset:0;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);border-radius:inherit}.modal-noise[data-v-0f26c597]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;border-radius:inherit}.modal-header[data-v-0f26c597]{border-bottom:1px solid rgba(114,137,218,0.15);background:linear-gradient(180deg,rgba(35,38,48,0.8) 0%,rgba(30,33,40,0.6) 100%)}.header-deco-line[data-v-0f26c597]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-0f26c597]::before,.header-deco-line[data-v-0f26c597]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-0f26c597]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-0f26c597]{color:rgba(114,137,218,0.5);font-size:0.5rem;animation:diamond-pulse-0f26c597 3s ease-in-out infinite}@keyframes diamond-pulse-0f26c597{0%,100%{opacity:0.5}50%{opacity:1}}.header-icon[data-v-0f26c597]{filter:drop-shadow(0 0 8px rgba(114,137,218,0.3))}.header-title[data-v-0f26c597]{background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.1em}.close-btn[data-v-0f26c597]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border-radius:4px;border:1px solid rgba(114,137,218,0.2);background:rgba(30,33,40,0.8);color:rgba(150,160,180,0.8);font-size:0.75rem;cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-0f26c597]:hover{border-color:rgba(114,137,218,0.5);background:rgba(114,137,218,0.15);color:#ffffff}.modal-content[data-v-0f26c597]{background:transparent}.content-hint[data-v-0f26c597]{color:rgba(130,140,160,0.7);letter-spacing:0.05em}.notepad-textarea[data-v-0f26c597]{border:1px solid rgba(114,137,218,0.2);background:linear-gradient(180deg,rgba(20,22,28,0.9) 0%,rgba(25,27,35,0.95) 100%);color:rgba(200,210,230,0.9);transition:all 0.3s ease}.notepad-textarea[data-v-0f26c597]::placeholder{color:rgba(100,110,130,0.5)}.notepad-textarea[data-v-0f26c597]:focus{outline:none;border-color:rgba(114,137,218,0.4);box-shadow:0 0 0 2px rgba(114,137,218,0.1)}.modal-footer[data-v-0f26c597]{border-top:1px solid rgba(114,137,218,0.15);background:linear-gradient(180deg,rgba(30,33,40,0.6) 0%,rgba(25,27,35,0.8) 100%)}.footer-deco-line[data-v-0f26c597]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.footer-deco-line[data-v-0f26c597]::before,.footer-deco-line[data-v-0f26c597]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 100%)}.footer-deco-line[data-v-0f26c597]::after{background:linear-gradient(90deg,rgba(114,137,218,0.2) 0%,transparent 100%)}.char-count[data-v-0f26c597]{color:rgba(100,110,130,0.6);letter-spacing:0.05em}.footer-btn[data-v-0f26c597]{position:relative;padding:0.375rem 0.875rem;border-radius:4px;font-size:0.7rem;font-weight:500;letter-spacing:0.1em;cursor:pointer;overflow:hidden;transition:all 0.3s ease}@media (min-width:640px){.footer-btn[data-v-0f26c597]{padding:0.5rem 1rem;font-size:0.75rem}}.footer-btn.secondary[data-v-0f26c597]{border:1px solid rgba(100,110,130,0.3);background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,38,45,0.95) 100%);color:rgba(180,190,210,0.9)}.footer-btn.secondary[data-v-0f26c597]:hover{border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(50,53,60,0.95) 0%,rgba(40,43,50,0.98) 100%);color:#ffffff;transform:translateY(-1px)}.footer-btn.primary[data-v-0f26c597]{border:1px solid rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(114,137,218,0.25) 0%,rgba(90,110,180,0.2) 100%);color:rgba(200,210,230,0.95)}.footer-btn.primary[data-v-0f26c597]:hover{border-color:rgba(114,137,218,0.7);background:linear-gradient(180deg,rgba(114,137,218,0.35) 0%,rgba(90,110,180,0.3) 100%);color:#ffffff;transform:translateY(-1px);box-shadow:0 4px 20px rgba(114,137,218,0.2)}.btn-glow[data-v-0f26c597]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 50%,rgba(114,137,218,0.2) 0%,transparent 70%);transition:opacity 0.3s ease}.footer-btn:hover .btn-glow[data-v-0f26c597]{opacity:1}.btn-content[data-v-0f26c597]{position:relative;z-index:1}.modal-enter-active[data-v-0f26c597]{transition:opacity 0.2s ease-out}.modal-enter-active .notepad-modal[data-v-0f26c597]{transition:transform 0.25s ease-out,opacity 0.25s ease-out}.modal-leave-active[data-v-0f26c597]{transition:opacity 0.15s ease-in}.modal-leave-active .notepad-modal[data-v-0f26c597]{transition:transform 0.15s ease-in,opacity 0.15s ease-in}.modal-enter-from[data-v-0f26c597],.modal-leave-to[data-v-0f26c597]{opacity:0}.modal-enter-from .notepad-modal[data-v-0f26c597]{transform:scale(0.95) translateY(10px);opacity:0}.modal-leave-to .notepad-modal[data-v-0f26c597]{transform:scale(0.95) translateY(10px);opacity:0}textarea[data-v-0f26c597]{-webkit-appearance:none;appearance:none}textarea[data-v-0f26c597]:-webkit-autofill,textarea[data-v-0f26c597]:-webkit-autofill:hover,textarea[data-v-0f26c597]:-webkit-autofill:focus{-webkit-box-shadow:0 0 0 1000px rgba(20,22,28,1) inset !important;-webkit-text-fill-color:rgba(200,210,230,0.9) !important}.custom-scrollbar[data-v-0f26c597]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-0f26c597]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5);border-radius:3px}.custom-scrollbar[data-v-0f26c597]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:3px}.custom-scrollbar[data-v-0f26c597]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}

.modal-backdrop[data-v-5aa003c0]{position:fixed;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,10,15,0.95) 0%,rgba(18,20,26,0.95) 50%,rgba(13,14,20,0.95) 100%);backdrop-filter:blur(8px)}.modal-vignette[data-v-5aa003c0]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 30%,rgba(0,0,0,0.4) 100%);pointer-events:none}.modal-noise[data-v-5aa003c0]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none}.modal-container[data-v-5aa003c0]{position:relative;z-index:10;width:100%;max-width:400px;margin:1rem;padding:1.5rem;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 100%);border:1px solid rgba(114,137,218,0.3);border-radius:8px;box-shadow:0 0 40px rgba(114,137,218,0.1),0 0 0 1px rgba(114,137,218,0.1) inset,0 20px 60px rgba(0,0,0,0.5)}.modal-deco-line[data-v-5aa003c0]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin:0.75rem 0}.modal-deco-line[data-v-5aa003c0]::before,.modal-deco-line[data-v-5aa003c0]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.4) 100%)}.modal-deco-line[data-v-5aa003c0]::after{background:linear-gradient(90deg,rgba(114,137,218,0.4) 0%,transparent 100%)}.deco-diamond[data-v-5aa003c0]{color:rgba(114,137,218,0.6);font-size:0.5rem;line-height:1;animation:diamond-pulse-5aa003c0 3s ease-in-out infinite}@keyframes diamond-pulse-5aa003c0{0%,100%{opacity:0.6}50%{opacity:1;text-shadow:0 0 8px rgba(114,137,218,0.5)}}.modal-title[data-v-5aa003c0]{display:flex;align-items:center;justify-content:center;gap:0.5rem;font-size:1.125rem;font-weight:600;letter-spacing:0.1em;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center}.title-icon[data-v-5aa003c0]{font-size:1rem;-webkit-text-fill-color:initial}.modal-content[data-v-5aa003c0]{margin:1rem 0}.modal-message[data-v-5aa003c0]{font-size:0.875rem;line-height:1.6;color:rgba(180,190,210,0.9);text-align:center;letter-spacing:0.02em}.modal-input-wrapper[data-v-5aa003c0]{margin:1rem 0}.modal-input[data-v-5aa003c0]{width:100%;padding:0.75rem 1rem;font-size:0.875rem;color:rgba(220,225,235,0.95);background:linear-gradient(180deg,rgba(20,22,28,0.9) 0%,rgba(25,27,35,0.95) 100%);border:1px solid rgba(114,137,218,0.3);border-radius:6px;outline:none;transition:all 0.2s ease}.modal-input[data-v-5aa003c0]::placeholder{color:rgba(120,130,150,0.6)}.modal-input[data-v-5aa003c0]:focus{border-color:rgba(114,137,218,0.6);box-shadow:0 0 0 2px rgba(114,137,218,0.1),0 0 20px rgba(114,137,218,0.1)}.modal-actions[data-v-5aa003c0]{display:flex;justify-content:center;gap:0.75rem;margin-top:1rem}.modal-btn[data-v-5aa003c0]{position:relative;padding:0.625rem 1.5rem;font-size:0.875rem;font-weight:500;letter-spacing:0.1em;border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.3s ease}.modal-btn-secondary[data-v-5aa003c0]{background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,37,45,0.95) 100%);border:1px solid rgba(100,110,130,0.3);color:rgba(180,190,210,0.9)}.modal-btn-secondary[data-v-5aa003c0]:hover{background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(45,48,58,0.98) 100%);border-color:rgba(114,137,218,0.4);color:#ffffff;transform:translateY(-1px);box-shadow:0 4px 15px rgba(0,0,0,0.3)}.modal-btn-primary[data-v-5aa003c0]{background:linear-gradient(180deg,rgba(114,137,218,0.25) 0%,rgba(90,110,180,0.2) 100%);border:1px solid rgba(114,137,218,0.5);color:rgba(200,210,230,0.95)}.modal-btn-primary[data-v-5aa003c0]:hover{background:linear-gradient(180deg,rgba(114,137,218,0.35) 0%,rgba(90,110,180,0.3) 100%);border-color:rgba(114,137,218,0.7);color:#ffffff;transform:translateY(-1px);box-shadow:0 4px 20px rgba(114,137,218,0.2),0 0 0 1px rgba(114,137,218,0.1) inset}.modal-btn[data-v-5aa003c0]:active{transform:translateY(0)}.btn-glow[data-v-5aa003c0]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at var(--x,50%) var(--y,50%),rgba(114,137,218,0.2) 0%,transparent 50%);transition:opacity 0.3s ease}.modal-btn:hover .btn-glow[data-v-5aa003c0]{opacity:1}.btn-content[data-v-5aa003c0]{position:relative;z-index:1}.modal-fade-enter-active[data-v-5aa003c0]{transition:opacity 0.2s ease-out}.modal-fade-leave-active[data-v-5aa003c0]{transition:opacity 0.15s ease-in}.modal-fade-enter-from[data-v-5aa003c0],.modal-fade-leave-to[data-v-5aa003c0]{opacity:0}.modal-scale-enter-active[data-v-5aa003c0]{transition:all 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-scale-leave-active[data-v-5aa003c0]{transition:all 0.15s ease-in}.modal-scale-enter-from[data-v-5aa003c0]{opacity:0;transform:scale(0.9) translateY(10px)}.modal-scale-leave-to[data-v-5aa003c0]{opacity:0;transform:scale(0.95) translateY(5px)}@media (max-width:480px){.modal-container[data-v-5aa003c0]{margin:0.75rem;padding:1.25rem}.modal-title[data-v-5aa003c0]{font-size:1rem}.modal-message[data-v-5aa003c0]{font-size:0.8125rem}.modal-btn[data-v-5aa003c0]{padding:0.5rem 1.25rem;font-size:0.8125rem}}

.fixed[data-v-17547a8d]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%) !important;backdrop-filter:blur(6px)}.fixed>div[data-v-17547a8d]{background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%) !important;border:1px solid rgba(114,137,218,0.25) !important;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset !important}.border-b.border-\[\#202225\].bg-\[\#2f3136\][data-v-17547a8d]{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%) !important;border-bottom:1px solid rgba(114,137,218,0.2) !important;position:relative}.border-r.border-\[\#202225\].bg-\[\#2f3136\][data-v-17547a8d]{background:rgba(25,27,35,0.8) !important;border-right:1px solid rgba(114,137,218,0.15) !important}.bg-\[\#40444b\][data-v-17547a8d]{background:rgba(40,45,55,0.9) !important;border:1px solid rgba(114,137,218,0.2);color:rgba(200,210,230,0.9)}.bg-\[\#40444b\][data-v-17547a8d]:focus{border-color:rgba(114,137,218,0.5);box-shadow:0 0 0 2px rgba(114,137,218,0.2)}.rounded.px-2.py-1\.5[data-v-17547a8d]:hover{background:rgba(114,137,218,0.1) !important}.rounded.px-2.py-1\.5.bg-\[\#40444b\][data-v-17547a8d]{background:rgba(114,137,218,0.2) !important;border:1px solid rgba(114,137,218,0.3)}.rounded.bg-\[\#2f3136\].p-2[data-v-17547a8d]{background:rgba(25,27,35,0.8) !important;border:1px solid rgba(114,137,218,0.1)}.rounded.bg-\[\#40444b\].px-2.py-1\.5[data-v-17547a8d]{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(40,43,52,0.9) 100%) !important;border:1px solid rgba(114,137,218,0.15);transition:all 0.2s ease}.rounded.bg-\[\#40444b\].px-2.py-1\.5[data-v-17547a8d]:hover{background:linear-gradient(180deg,rgba(114,137,218,0.25) 0%,rgba(90,110,180,0.2) 100%) !important;border-color:rgba(114,137,218,0.4);transform:translateY(-1px)}.border-b.border-\[\#40444b\] button[data-v-17547a8d]{color:rgba(150,160,180,0.6);transition:all 0.2s ease}.border-b.border-\[\#40444b\] button[data-v-17547a8d]:hover{color:rgba(200,210,230,0.9)}.border-b.border-\[\#40444b\] button.text-white[data-v-17547a8d]{color:rgba(220,230,250,0.95) !important}.border-b.border-\[\#40444b\] button .bg-\[\#5865F2\][data-v-17547a8d]{background:linear-gradient(90deg,rgba(114,137,218,0.8),rgba(90,110,180,0.6)) !important}.rounded.bg-\[\#36393f\].p-2[data-v-17547a8d]{background:rgba(30,33,40,0.8) !important;border:1px solid rgba(114,137,218,0.1)}.h-1\.5.overflow-hidden.rounded-full.bg-\[\#202225\][data-v-17547a8d]{background:rgba(20,22,28,0.8) !important}.border-t.border-\[\#202225\].bg-\[\#2f3136\][data-v-17547a8d]{background:rgba(15,17,22,0.95) !important;border-top:1px solid rgba(114,137,218,0.15) !important}.rounded.bg-\[\#40444b\].px-3.py-1[data-v-17547a8d]{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(40,43,52,0.9) 100%) !important;border:1px solid rgba(114,137,218,0.2);transition:all 0.2s ease}.rounded.bg-\[\#40444b\].px-3.py-1[data-v-17547a8d]:hover{background:linear-gradient(180deg,rgba(60,65,75,0.9) 0%,rgba(50,55,65,0.95) 100%) !important;border-color:rgba(114,137,218,0.4)}.rounded.bg-blue-500\/10[data-v-17547a8d]{background:rgba(114,137,218,0.1) !important;border:1px solid rgba(114,137,218,0.2)}.modal-fade-enter-active[data-v-17547a8d],.modal-fade-leave-active[data-v-17547a8d]{transition:opacity 0.25s ease}.modal-fade-enter-active>div[data-v-17547a8d],.modal-fade-leave-active>div[data-v-17547a8d]{transition:transform 0.25s ease,opacity 0.25s ease}.modal-fade-enter-from[data-v-17547a8d],.modal-fade-leave-to[data-v-17547a8d]{opacity:0}.modal-fade-enter-from>div[data-v-17547a8d]{transform:scale(0.95) translateY(10px);opacity:0}.modal-fade-leave-to>div[data-v-17547a8d]{transform:scale(0.98) translateY(5px);opacity:0}.scrollbar-stable[data-v-17547a8d]{scrollbar-gutter:stable}.scrollbar-stable[data-v-17547a8d]::-webkit-scrollbar{width:6px}.scrollbar-stable[data-v-17547a8d]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5)}.scrollbar-stable[data-v-17547a8d]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:3px}.scrollbar-stable[data-v-17547a8d]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.overflow-y-auto[data-v-17547a8d]::-webkit-scrollbar{width:6px}.overflow-y-auto[data-v-17547a8d]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5)}.overflow-y-auto[data-v-17547a8d]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:3px}.overflow-y-auto[data-v-17547a8d]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.context-menu[data-v-17547a8d]{animation:context-menu-in-17547a8d 0.15s ease-out}@keyframes context-menu-in-17547a8d{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}.context-menu-fade-enter-active[data-v-17547a8d],.context-menu-fade-leave-active[data-v-17547a8d]{transition:opacity 0.15s ease}.context-menu-fade-enter-from[data-v-17547a8d],.context-menu-fade-leave-to[data-v-17547a8d]{opacity:0}.context-menu-overlay[data-v-17547a8d]{position:fixed !important;inset:0 !important;z-index:99 !important;background:transparent !important;backdrop-filter:none !important}

.save-load-root[data-v-57be432c]{position:absolute;inset:0;z-index:50;font-family:'Noto Sans SC','Microsoft YaHei',sans-serif;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right)}.bg-layer[data-v-57be432c]{position:absolute;inset:0;background:linear-gradient(135deg,#0a0a0f 0%,#12141a 25%,#1a1c25 50%,#151720 75%,#0d0e14 100%)}.vignette[data-v-57be432c]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 40%,rgba(0,0,0,0.6) 100%);pointer-events:none}.noise[data-v-57be432c]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.03;pointer-events:none}.content-layer[data-v-57be432c]{position:relative;z-index:10;display:flex;flex-direction:column;height:100%;max-width:64rem;margin:0 auto;padding:1rem;color:#e0e0e0}@media (min-width:640px){.content-layer[data-v-57be432c]{padding:1.5rem}}@media (min-width:768px){.content-layer[data-v-57be432c]{padding:2rem}}.sl-header[data-v-57be432c]{display:flex;align-items:center;justify-content:space-between;padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid rgba(114,137,218,0.2)}.header-title-section[data-v-57be432c]{display:flex;align-items:center;gap:0.75rem}.header-deco[data-v-57be432c]{color:rgba(114,137,218,0.6);font-size:0.75rem}.header-title[data-v-57be432c]{font-size:1.5rem;font-weight:600;color:rgba(114,137,218,0.9);letter-spacing:0.15em}@media (max-width:640px){.header-title[data-v-57be432c]{font-size:1.125rem}}.header-actions[data-v-57be432c]{display:flex;gap:0.5rem}.action-btn[data-v-57be432c]{display:flex;align-items:center;gap:0.375rem;padding:0.5rem 0.75rem;border:1px solid rgba(114,137,218,0.2);border-radius:4px;background:transparent;color:rgba(180,190,210,0.8);font-size:0.75rem;cursor:pointer;transition:all 0.2s ease}@media (min-width:640px){.action-btn[data-v-57be432c]{padding:0.5rem 1rem;font-size:0.875rem}}.action-btn[data-v-57be432c]:hover{border-color:rgba(114,137,218,0.5);background:rgba(114,137,218,0.1);color:#fff}.import-btn[data-v-57be432c]{border-color:rgba(59,130,246,0.3);color:rgba(96,165,250,0.9)}.import-btn[data-v-57be432c]:hover{border-color:rgba(59,130,246,0.6);background:rgba(59,130,246,0.1)}.close-btn[data-v-57be432c]:hover{border-color:rgba(239,68,68,0.4);background:rgba(239,68,68,0.1);color:rgba(248,113,113,1)}.btn-text[data-v-57be432c]{display:none}@media (min-width:640px){.btn-text[data-v-57be432c]{display:inline}}.slots-container[data-v-57be432c]{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:0.75rem;padding-right:0.5rem}@media (min-width:640px){.slots-container[data-v-57be432c]{gap:1rem}}.slot-card[data-v-57be432c]{display:flex;align-items:center;justify-content:space-between;padding:0.75rem 1rem;border:1px solid rgba(55,58,64,0.6);border-radius:6px;background:linear-gradient(180deg,rgba(30,33,42,0.8) 0%,rgba(25,27,35,0.9) 100%);cursor:pointer;transition:all 0.2s ease}@media (min-width:640px){.slot-card[data-v-57be432c]{padding:1rem 1.25rem}}.slot-card[data-v-57be432c]:hover{border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(35,38,48,0.9) 0%,rgba(28,31,40,0.95) 100%)}.slot-card.selected[data-v-57be432c]{border-color:rgba(114,137,218,0.6);box-shadow:0 0 0 1px rgba(114,137,218,0.3) inset,0 4px 16px rgba(114,137,218,0.1)}.slot-card.autosave[data-v-57be432c]{border-color:rgba(59,130,246,0.3)}.slot-card.autosave[data-v-57be432c]:hover{border-color:rgba(59,130,246,0.5)}.slot-card.autosave.selected[data-v-57be432c]{border-color:rgba(59,130,246,0.6);box-shadow:0 0 0 1px rgba(59,130,246,0.3) inset,0 4px 16px rgba(59,130,246,0.1)}.slot-info[data-v-57be432c]{flex:1;min-width:0}.slot-meta[data-v-57be432c]{display:flex;flex-wrap:wrap;align-items:center;gap:0.5rem;margin-bottom:0.25rem}.slot-badge[data-v-57be432c]{padding:0.125rem 0.5rem;border-radius:3px;background:rgba(55,58,64,0.8);color:rgba(160,170,190,0.8);font-size:0.7rem;font-weight:600;letter-spacing:0.05em;white-space:nowrap}.slot-badge.autosave-badge[data-v-57be432c]{background:rgba(59,130,246,0.2);color:rgba(147,197,253,0.9)}.slot-time[data-v-57be432c]{font-size:0.7rem;color:rgba(120,130,150,0.7)}.slot-label[data-v-57be432c]{font-size:0.9rem;font-weight:500;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (min-width:640px){.slot-label[data-v-57be432c]{font-size:1rem}}.slot-label.empty[data-v-57be432c]{color:rgba(100,110,130,0.6);font-style:italic}.slot-detail[data-v-57be432c]{margin-top:0.25rem;font-size:0.75rem;color:rgba(140,150,170,0.7);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-actions[data-v-57be432c]{display:flex;gap:0.375rem;margin-left:0.75rem;flex-shrink:0;opacity:1;transition:opacity 0.2s ease}@media (min-width:640px){.slot-actions[data-v-57be432c]{opacity:0;gap:0.5rem}.slot-card:hover .slot-actions[data-v-57be432c],.slot-actions.visible[data-v-57be432c]{opacity:1}}.slot-btn[data-v-57be432c]{padding:0.375rem 0.625rem;border:1px solid transparent;border-radius:3px;font-size:0.7rem;font-weight:500;cursor:pointer;transition:all 0.2s ease;white-space:nowrap}@media (min-width:640px){.slot-btn[data-v-57be432c]{padding:0.5rem 0.875rem;font-size:0.75rem}}.slot-btn.save[data-v-57be432c]{background:linear-gradient(180deg,rgba(217,119,6,0.3) 0%,rgba(180,83,9,0.25) 100%);border-color:rgba(217,119,6,0.4);color:rgba(251,191,36,0.9)}.slot-btn.save[data-v-57be432c]:hover{background:linear-gradient(180deg,rgba(217,119,6,0.4) 0%,rgba(180,83,9,0.35) 100%);border-color:rgba(217,119,6,0.6)}.slot-btn.load[data-v-57be432c]{background:linear-gradient(180deg,rgba(34,197,94,0.3) 0%,rgba(22,163,74,0.25) 100%);border-color:rgba(34,197,94,0.4);color:rgba(134,239,172,0.9)}.slot-btn.load[data-v-57be432c]:hover{background:linear-gradient(180deg,rgba(34,197,94,0.4) 0%,rgba(22,163,74,0.35) 100%);border-color:rgba(34,197,94,0.6)}.slot-btn.rename[data-v-57be432c],.slot-btn.export[data-v-57be432c]{background:rgba(55,65,81,0.5);border-color:rgba(75,85,99,0.4);color:rgba(180,190,210,0.8)}.slot-btn.rename[data-v-57be432c]:hover,.slot-btn.export[data-v-57be432c]:hover{background:rgba(75,85,99,0.6);border-color:rgba(107,114,128,0.5);color:#fff}.slot-btn.delete[data-v-57be432c]{background:rgba(127,29,29,0.4);border-color:rgba(185,28,28,0.3);color:rgba(252,165,165,0.8)}.slot-btn.delete[data-v-57be432c]:hover{background:rgba(185,28,28,0.5);border-color:rgba(220,38,38,0.5);color:rgba(254,202,202,1)}.slots-container[data-v-57be432c]::-webkit-scrollbar{width:8px}.slots-container[data-v-57be432c]::-webkit-scrollbar-track{background:rgba(10,10,15,0.5)}.slots-container[data-v-57be432c]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:4px}.slots-container[data-v-57be432c]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}

.system-modal-backdrop[data-v-04d3f420]{position:fixed;inset:0;z-index:80;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,10,15,0.95) 0%,rgba(18,20,26,0.95) 50%,rgba(13,14,20,0.95) 100%);backdrop-filter:blur(8px)}.modal-vignette[data-v-04d3f420]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 30%,rgba(0,0,0,0.4) 100%);pointer-events:none}.modal-noise[data-v-04d3f420]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none}.system-modal-container[data-v-04d3f420]{position:relative;z-index:10;width:100%;max-width:320px;margin:1rem;padding:1.5rem;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 100%);border:1px solid rgba(114,137,218,0.3);border-radius:8px;box-shadow:0 0 40px rgba(114,137,218,0.1),0 0 0 1px rgba(114,137,218,0.1) inset,0 20px 60px rgba(0,0,0,0.5)}.modal-deco-line[data-v-04d3f420]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin:0.75rem 0}.modal-deco-line[data-v-04d3f420]::before,.modal-deco-line[data-v-04d3f420]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.4) 100%)}.modal-deco-line[data-v-04d3f420]::after{background:linear-gradient(90deg,rgba(114,137,218,0.4) 0%,transparent 100%)}.deco-diamond[data-v-04d3f420]{color:rgba(114,137,218,0.6);font-size:0.5rem;line-height:1;animation:diamond-pulse-04d3f420 3s ease-in-out infinite}@keyframes diamond-pulse-04d3f420{0%,100%{opacity:0.6}50%{opacity:1;text-shadow:0 0 8px rgba(114,137,218,0.5)}}.modal-title[data-v-04d3f420]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:1rem}.title-icon[data-v-04d3f420]{color:rgba(114,137,218,0.6);font-size:1rem;animation:glow-pulse-04d3f420 3s ease-in-out infinite}@keyframes glow-pulse-04d3f420{0%,100%{opacity:0.6;text-shadow:0 0 10px rgba(114,137,218,0.3)}50%{opacity:1;text-shadow:0 0 20px rgba(114,137,218,0.6)}}.title-text[data-v-04d3f420]{font-size:1.25rem;font-weight:600;letter-spacing:0.15em;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.menu-buttons[data-v-04d3f420]{display:flex;flex-direction:column;gap:0.625rem}.menu-btn[data-v-04d3f420]{position:relative;display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.75rem 1rem;border:1px solid rgba(114,137,218,0.2);border-radius:4px;background:linear-gradient(180deg,rgba(30,33,40,0.9) 0%,rgba(25,27,35,0.95) 100%);color:rgba(200,210,230,0.9);font-size:0.9rem;font-weight:500;letter-spacing:0.1em;cursor:pointer;overflow:hidden;transition:all 0.3s ease}.menu-btn[data-v-04d3f420]:hover{border-color:rgba(114,137,218,0.5);background:linear-gradient(180deg,rgba(40,45,55,0.95) 0%,rgba(30,33,42,0.98) 100%);color:#ffffff;transform:translateY(-2px);box-shadow:0 4px 20px rgba(114,137,218,0.15),0 0 0 1px rgba(114,137,218,0.1) inset}.menu-btn[data-v-04d3f420]:active{transform:translateY(0)}.menu-btn.accent-amber[data-v-04d3f420]{border-color:rgba(217,166,97,0.3);background:linear-gradient(180deg,rgba(217,166,97,0.15) 0%,rgba(180,130,70,0.1) 100%);color:rgba(235,200,140,0.95)}.menu-btn.accent-amber[data-v-04d3f420]:hover{border-color:rgba(217,166,97,0.6);background:linear-gradient(180deg,rgba(217,166,97,0.25) 0%,rgba(180,130,70,0.2) 100%);color:#fff1d6;box-shadow:0 4px 25px rgba(217,166,97,0.2),0 0 0 1px rgba(217,166,97,0.15) inset}.menu-btn.accent-red[data-v-04d3f420]{border-color:rgba(220,100,100,0.3);background:linear-gradient(180deg,rgba(180,60,60,0.15) 0%,rgba(140,40,40,0.1) 100%);color:rgba(255,180,180,0.95)}.menu-btn.accent-red[data-v-04d3f420]:hover{border-color:rgba(220,100,100,0.6);background:linear-gradient(180deg,rgba(180,60,60,0.25) 0%,rgba(140,40,40,0.2) 100%);color:#ffd0d0;box-shadow:0 4px 25px rgba(220,100,100,0.2),0 0 0 1px rgba(220,100,100,0.15) inset}.btn-icon[data-v-04d3f420]{font-size:1rem;opacity:0.8}.menu-btn:hover .btn-icon[data-v-04d3f420]{opacity:1}.btn-glow[data-v-04d3f420]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at var(--x,50%) var(--y,50%),rgba(114,137,218,0.15) 0%,transparent 50%);transition:opacity 0.3s ease}.menu-btn:hover .btn-glow[data-v-04d3f420]{opacity:1}.btn-content[data-v-04d3f420]{position:relative;z-index:1}.menu-divider[data-v-04d3f420]{display:flex;align-items:center;justify-content:center;gap:0.75rem;margin:0.5rem 0}.menu-divider[data-v-04d3f420]::before,.menu-divider[data-v-04d3f420]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(100,110,130,0.3) 50%,transparent 100%)}.divider-diamond[data-v-04d3f420]{color:rgba(100,110,130,0.4);font-size:0.4rem;line-height:1}.close-btn[data-v-04d3f420]{position:relative;width:100%;margin-top:0.75rem;padding:0.5rem 1rem;border:1px solid rgba(100,110,130,0.25);border-radius:4px;background:transparent;color:rgba(150,160,180,0.7);font-size:0.8rem;letter-spacing:0.1em;cursor:pointer;overflow:hidden;transition:all 0.3s ease}.close-btn[data-v-04d3f420]:hover{border-color:rgba(114,137,218,0.4);color:rgba(200,210,230,0.9);background:rgba(114,137,218,0.05)}.modal-fade-enter-active[data-v-04d3f420]{transition:opacity 0.2s ease-out}.modal-fade-leave-active[data-v-04d3f420]{transition:opacity 0.15s ease-in}.modal-fade-enter-from[data-v-04d3f420],.modal-fade-leave-to[data-v-04d3f420]{opacity:0}.modal-scale-enter-active[data-v-04d3f420]{transition:all 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-scale-leave-active[data-v-04d3f420]{transition:all 0.15s ease-in}.modal-scale-enter-from[data-v-04d3f420]{opacity:0;transform:scale(0.9) translateY(10px)}.modal-scale-leave-to[data-v-04d3f420]{opacity:0;transform:scale(0.95) translateY(5px)}@media (max-width:400px){.system-modal-container[data-v-04d3f420]{margin:0.75rem;padding:1.25rem}.title-text[data-v-04d3f420]{font-size:1.125rem}.menu-btn[data-v-04d3f420]{padding:0.625rem 0.875rem;font-size:0.85rem}}

.toast-enter-active[data-v-7ecd7fa3],.toast-leave-active[data-v-7ecd7fa3]{transition:all 0.3s ease}.toast-enter-from[data-v-7ecd7fa3],.toast-leave-to[data-v-7ecd7fa3]{opacity:0;transform:translateX(-50%) translateY(-20px)}.top .toast-enter-from[data-v-7ecd7fa3],.top .toast-leave-to[data-v-7ecd7fa3]{transform:translateX(-50%) translateY(-20px)}.bottom .toast-enter-from[data-v-7ecd7fa3],.bottom .toast-leave-to[data-v-7ecd7fa3]{transform:translateX(-50%) translateY(20px)}

.fixed[data-v-1afee900]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%) !important;backdrop-filter:blur(6px)}.ally-equipment-modal[data-v-1afee900]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%) !important;border:1px solid rgba(114,137,218,0.25) !important;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset !important}.ally-equipment-modal>div[data-v-1afee900]:first-child{background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.98) 100%) !important;border-bottom:1px solid rgba(114,137,218,0.2) !important}.ally-equipment-modal>div[data-v-1afee900]:first-child::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(114,137,218,0.08) 0%,transparent 100%);pointer-events:none;border-radius:inherit}.detail-section[data-v-1afee900]{min-height:80px;max-height:200px;background:rgba(25,27,35,0.8) !important;border:1px solid rgba(114,137,218,0.15) !important}@media (min-width:640px){.detail-section[data-v-1afee900]{min-height:100px;max-height:none}}.equipment-grid[data-v-1afee900]{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}@media (min-width:640px){.equipment-grid[data-v-1afee900]{gap:8px}}.equipment-slot[data-v-1afee900]{background:rgba(30,33,40,0.8);border:1px solid rgba(114,137,218,0.15);border-radius:6px;padding:8px 10px;min-height:40px;display:flex;align-items:center;justify-content:center;gap:6px;cursor:pointer;transition:all 0.2s ease}.equipment-slot[data-v-1afee900]:hover{background:rgba(40,45,55,0.9);border-color:rgba(114,137,218,0.3)}.equipment-slot.has-item[data-v-1afee900]{background:rgba(114,137,218,0.1);border-color:rgba(114,137,218,0.3);justify-content:flex-start}.equipment-slot.has-item[data-v-1afee900]:hover{background:rgba(114,137,218,0.15);border-color:rgba(114,137,218,0.4)}.equipment-slot.selected[data-v-1afee900]{box-shadow:0 0 0 2px rgba(114,137,218,0.6);border-color:rgba(114,137,218,0.7);background:rgba(114,137,218,0.15)}.equipment-slot.border-gray-500[data-v-1afee900]{border-color:rgba(150,160,180,0.4)}.equipment-slot.border-green-500[data-v-1afee900]{border-color:rgba(74,222,128,0.5)}.equipment-slot.border-blue-500[data-v-1afee900]{border-color:rgba(96,165,250,0.5)}.equipment-slot.border-purple-500[data-v-1afee900]{border-color:rgba(167,139,250,0.5)}.equipment-slot.border-orange-500[data-v-1afee900]{border-color:rgba(251,191,36,0.5)}.equipment-slot.border-red-500[data-v-1afee900]{border-color:rgba(244,114,182,0.5)}.empty-text[data-v-1afee900]{font-size:11px;color:rgba(150,160,180,0.4);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-name[data-v-1afee900]{font-size:11px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}@media (min-width:640px){.item-name[data-v-1afee900]{font-size:12px}}.emoji[data-v-1afee900]{font-size:14px;flex-shrink:0}.ally-equipment-modal>div[data-v-1afee900]:last-child{background:rgba(15,17,22,0.95) !important;border-top:1px solid rgba(114,137,218,0.15) !important}.ally-equipment-modal button[class*='bg-[#ed4245]'][data-v-1afee900]{background:linear-gradient(180deg,rgba(239,68,68,0.25) 0%,rgba(220,50,50,0.2) 100%) !important;border:1px solid rgba(239,68,68,0.4);color:rgba(239,68,68,0.95);transition:all 0.2s ease}.ally-equipment-modal button[class*='bg-[#ed4245]'][data-v-1afee900]:hover{background:linear-gradient(180deg,rgba(239,68,68,0.35) 0%,rgba(220,50,50,0.3) 100%) !important;border-color:rgba(239,68,68,0.6);box-shadow:0 4px 15px rgba(239,68,68,0.2)}.ally-equipment-modal button[class*='bg-gray-700'][data-v-1afee900]{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(40,43,52,0.9) 100%) !important;border:1px solid rgba(114,137,218,0.2);color:rgba(180,190,210,0.8);transition:all 0.2s ease}.ally-equipment-modal button[class*='bg-gray-700'][data-v-1afee900]:hover{background:linear-gradient(180deg,rgba(60,65,75,0.9) 0%,rgba(50,55,65,0.95) 100%) !important;border-color:rgba(114,137,218,0.4);color:rgba(200,210,230,0.95)}.custom-scrollbar[data-v-1afee900]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-1afee900]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5)}.custom-scrollbar[data-v-1afee900]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:3px}.custom-scrollbar[data-v-1afee900]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}.modal-enter-active[data-v-1afee900]{transition:opacity 0.2s ease-out}.modal-enter-active .ally-equipment-modal[data-v-1afee900]{transition:transform 0.25s ease-out,opacity 0.25s ease-out}.modal-leave-active[data-v-1afee900]{transition:opacity 0.15s ease-in}.modal-leave-active .ally-equipment-modal[data-v-1afee900]{transition:transform 0.15s ease-in,opacity 0.15s ease-in}.modal-enter-from[data-v-1afee900],.modal-leave-to[data-v-1afee900]{opacity:0}.modal-enter-from .ally-equipment-modal[data-v-1afee900]{transform:scale(0.95) translateY(10px);opacity:0}.modal-leave-to .ally-equipment-modal[data-v-1afee900]{transform:scale(0.98) translateY(5px);opacity:0}.quality-stars[data-v-1afee900]{letter-spacing:1px}

.modal-enter-active[data-v-62db310a]{transition:opacity 0.15s ease-out}.modal-enter-active .ally-skills-modal[data-v-62db310a]{transition:transform 0.2s ease-out}.modal-leave-active[data-v-62db310a]{transition:opacity 0.1s ease-in}.modal-leave-active .ally-skills-modal[data-v-62db310a]{transition:transform 0.1s ease-in}.modal-enter-from[data-v-62db310a],.modal-leave-to[data-v-62db310a]{opacity:0}.modal-enter-from .ally-skills-modal[data-v-62db310a]{transform:scale(0.95) translateY(10px)}.modal-leave-to .ally-skills-modal[data-v-62db310a]{transform:scale(0.95) translateY(10px)}.detail-section[data-v-62db310a]{min-height:80px;max-height:220px;overflow-y:auto}@media (min-width:640px){.detail-section[data-v-62db310a]{min-height:100px;max-height:280px}}.effect-list[data-v-62db310a]{display:flex;flex-wrap:wrap;gap:4px;max-height:60px;overflow-y:auto;padding-right:4px}@media (min-width:640px){.effect-list[data-v-62db310a]{gap:6px;max-height:80px}}.effect-tag[data-v-62db310a]{display:inline-block;padding:2px 6px;background:rgba(32,34,37,0.8);border-radius:3px;font-size:9px;line-height:14px;color:rgba(156,163,175,0.95);white-space:nowrap;border:1px solid rgba(114,137,218,0.08);transition:all 0.15s ease}@media (min-width:640px){.effect-tag[data-v-62db310a]{font-size:10px;padding:3px 8px}}.effect-tag[data-v-62db310a]:hover{background:rgba(42,44,47,0.9);border-color:rgba(114,137,218,0.15);color:rgba(180,190,210,0.95)}.detail-tags[data-v-62db310a]{min-height:18px}@media (min-width:640px){.detail-tags[data-v-62db310a]{min-height:20px}}.detail-tag[data-v-62db310a]{font-size:9px;line-height:14px;height:16px;display:inline-flex;align-items:center}@media (min-width:640px){.detail-tag[data-v-62db310a]{font-size:10px;line-height:16px;height:18px}}.detail-tag-empty[data-v-62db310a]{font-size:9px;line-height:14px;height:16px;display:inline-flex;align-items:center;color:#6b7280}@media (min-width:640px){.detail-tag-empty[data-v-62db310a]{font-size:10px;line-height:16px;height:18px}}.skill-list-item[data-v-62db310a]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#2f3136;border:1px solid transparent;border-left:3px solid transparent;border-radius:4px;cursor:pointer;transition:background 0.15s,border-color 0.15s}.skill-list-item[data-v-62db310a]:hover{background:#36393f;border-left-color:#7289da}.skill-list-item.selected[data-v-62db310a]{background:#40444b;border-left-color:#7289da}.skill-list-item.disabled[data-v-62db310a]{opacity:0.5}.skill-list-info[data-v-62db310a]{flex:1;min-width:0;display:flex;flex-direction:column;gap:3px}.skill-list-row[data-v-62db310a]{display:flex;align-items:center;justify-content:space-between;gap:8px}.skill-list-name[data-v-62db310a]{font-size:13px;font-weight:600;color:#ffffff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}@media (min-width:640px){.skill-list-name[data-v-62db310a]{font-size:14px}}.cooldown-inline[data-v-62db310a]{font-size:11px;font-weight:normal;color:#f59e0b;margin-left:6px}.skill-list-cost[data-v-62db310a]{display:flex;align-items:center;gap:6px;flex-shrink:0;font-size:10px}@media (min-width:640px){.skill-list-cost[data-v-62db310a]{font-size:11px;gap:8px}}.cost-mp[data-v-62db310a]{color:#60a5fa;font-weight:500}.cost-sp[data-v-62db310a]{color:#4ade80;font-weight:500}.cost-cd[data-v-62db310a]{color:#9ca3af}.skill-list-tags[data-v-62db310a]{display:flex;flex-wrap:wrap;align-items:center;gap:4px;min-height:18px}@media (min-width:640px){.skill-list-tags[data-v-62db310a]{gap:6px;min-height:20px}}.skill-list-tag[data-v-62db310a]{padding:1px 6px;border-radius:3px;font-size:10px;line-height:14px;height:16px;display:inline-flex;align-items:center}@media (min-width:640px){.skill-list-tag[data-v-62db310a]{font-size:11px;line-height:16px;height:18px}}.skill-list-tag-empty[data-v-62db310a]{font-size:10px;line-height:14px;height:16px;display:inline-flex;align-items:center;color:#6b7280}@media (min-width:640px){.skill-list-tag-empty[data-v-62db310a]{font-size:11px;line-height:16px;height:18px}}.skill-list-arrow[data-v-62db310a]{flex-shrink:0;font-size:18px;color:#5c5f66;transition:color 0.15s}.skill-list-item:hover .skill-list-arrow[data-v-62db310a],.skill-list-item.selected .skill-list-arrow[data-v-62db310a]{color:#7289da}.custom-scrollbar[data-v-62db310a]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-62db310a]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[data-v-62db310a]::-webkit-scrollbar-thumb{background:#40444b;border-radius:3px}.custom-scrollbar[data-v-62db310a]::-webkit-scrollbar-thumb:hover{background:#5a5f69}

.modal-backdrop[data-v-7de01004]{position:fixed;inset:0;z-index:70;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.modal-vignette[data-v-7de01004]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 30%,rgba(0,0,0,0.3) 100%);pointer-events:none}.modal-noise[data-v-7de01004]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none}.team-modal[data-v-7de01004]{position:relative;z-index:10;display:flex;flex-direction:column;width:95%;max-width:32rem;height:85vh;background:linear-gradient(180deg,rgba(25,27,35,0.98) 0%,rgba(20,22,28,0.99) 100%);border:1px solid rgba(114,137,218,0.2);border-radius:12px;box-shadow:0 0 50px rgba(114,137,218,0.06),0 0 0 1px rgba(114,137,218,0.06) inset,0 25px 80px rgba(0,0,0,0.5);overflow:hidden}@media (min-width:768px){.team-modal[data-v-7de01004]{height:auto;max-height:80vh;max-width:36rem}}.modal-header[data-v-7de01004]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(30,33,40,0.95) 0%,rgba(25,27,35,0.9) 100%);border-bottom:1px solid rgba(114,137,218,0.12)}.header-deco-line[data-v-7de01004],.footer-deco-line[data-v-7de01004],.dismiss-deco-line[data-v-7de01004]{display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.5rem}.header-deco-line[data-v-7de01004]::before,.header-deco-line[data-v-7de01004]::after,.footer-deco-line[data-v-7de01004]::before,.footer-deco-line[data-v-7de01004]::after,.dismiss-deco-line[data-v-7de01004]::before,.dismiss-deco-line[data-v-7de01004]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-7de01004]::after,.footer-deco-line[data-v-7de01004]::after,.dismiss-deco-line[data-v-7de01004]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-7de01004]{color:rgba(114,137,218,0.5);font-size:0.4rem;animation:diamond-pulse-7de01004 3s ease-in-out infinite}@keyframes diamond-pulse-7de01004{0%,100%{opacity:0.5}50%{opacity:1;text-shadow:0 0 6px rgba(114,137,218,0.4)}}.header-content[data-v-7de01004]{display:flex;align-items:center;justify-content:space-between}.header-title-group[data-v-7de01004]{display:flex;align-items:center;gap:0.5rem}.header-icon[data-v-7de01004]{font-size:1.125rem}.header-title[data-v-7de01004]{font-size:0.95rem;font-weight:600;letter-spacing:0.08em;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.team-counter[data-v-7de01004]{padding:0.125rem 0.5rem;font-size:0.65rem;font-weight:500;letter-spacing:0.05em;background:rgba(114,137,218,0.15);border:1px solid rgba(114,137,218,0.25);border-radius:4px;color:rgba(140,180,255,0.9)}.close-btn[data-v-7de01004]{display:flex;align-items:center;justify-content:center;width:1.75rem;height:1.75rem;border:1px solid rgba(100,110,130,0.2);border-radius:50%;background:rgba(40,43,50,0.5);color:rgba(150,160,180,0.7);cursor:pointer;transition:all 0.2s ease}.close-btn[data-v-7de01004]:hover{border-color:rgba(220,100,100,0.4);background:rgba(180,60,60,0.15);color:rgba(255,180,180,0.9)}.close-icon[data-v-7de01004]{font-size:0.7rem}.modal-footer[data-v-7de01004]{flex-shrink:0;padding:0.75rem 1rem;background:linear-gradient(180deg,rgba(25,27,35,0.9) 0%,rgba(30,33,40,0.95) 100%);border-top:1px solid rgba(114,137,218,0.12)}.footer-content[data-v-7de01004]{display:flex;align-items:center;justify-content:space-between}.footer-info[data-v-7de01004]{display:flex;align-items:center;gap:0.5rem;font-size:0.7rem;color:rgba(120,130,150,0.7);letter-spacing:0.05em}.info-diamond[data-v-7de01004]{font-size:0.35rem;color:rgba(114,137,218,0.4)}.footer-btn[data-v-7de01004]{position:relative;padding:0.4rem 1rem;font-size:0.75rem;font-weight:500;letter-spacing:0.08em;color:rgba(180,190,210,0.9);background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,37,45,0.95) 100%);border:1px solid rgba(100,110,130,0.25);border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.2s ease}.footer-btn[data-v-7de01004]:hover{color:#ffffff;border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(45,48,58,0.98) 100%);transform:translateY(-1px)}.btn-glow[data-v-7de01004]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 50%,rgba(114,137,218,0.15) 0%,transparent 60%);transition:opacity 0.2s ease}.footer-btn:hover .btn-glow[data-v-7de01004]{opacity:1}.btn-content[data-v-7de01004]{position:relative;z-index:1}.dismiss-modal-backdrop[data-v-7de01004]{position:fixed;inset:0;z-index:80;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px)}.dismiss-modal[data-v-7de01004]{width:90%;max-width:360px;padding:1.25rem;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 100%);border:1px solid rgba(220,100,100,0.3);border-radius:10px;box-shadow:0 0 40px rgba(220,100,100,0.1),0 20px 60px rgba(0,0,0,0.5)}.dismiss-header[data-v-7de01004]{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem}.dismiss-icon[data-v-7de01004]{font-size:1.25rem}.dismiss-title[data-v-7de01004]{font-size:0.9rem;font-weight:600;letter-spacing:0.08em;background:linear-gradient(180deg,#ffffff 0%,#ffcccc 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.dismiss-message[data-v-7de01004]{font-size:0.8rem;color:rgba(200,210,230,0.9);margin-bottom:0.5rem;text-align:center}.dismiss-name[data-v-7de01004]{font-weight:600;color:#ffffff}.dismiss-warning[data-v-7de01004]{font-size:0.65rem;color:rgba(140,150,170,0.7);text-align:center;margin-bottom:1rem}.dismiss-actions[data-v-7de01004]{display:flex;justify-content:flex-end;gap:0.5rem}.dismiss-btn[data-v-7de01004]{position:relative;padding:0.4rem 1rem;font-size:0.75rem;font-weight:500;border-radius:4px;cursor:pointer;overflow:hidden;transition:all 0.2s ease}.dismiss-btn.cancel[data-v-7de01004]{background:linear-gradient(180deg,rgba(40,43,50,0.9) 0%,rgba(35,37,45,0.95) 100%);border:1px solid rgba(100,110,130,0.25);color:rgba(180,190,210,0.9)}.dismiss-btn.cancel[data-v-7de01004]:hover{border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(50,55,65,0.95) 0%,rgba(45,48,58,0.98) 100%)}.dismiss-btn.confirm[data-v-7de01004]{background:linear-gradient(180deg,rgba(180,60,60,0.25) 0%,rgba(140,40,40,0.2) 100%);border:1px solid rgba(220,100,100,0.4);color:rgba(255,180,180,0.95)}.dismiss-btn.confirm[data-v-7de01004]:hover{background:linear-gradient(180deg,rgba(180,60,60,0.35) 0%,rgba(140,40,40,0.3) 100%);border-color:rgba(220,100,100,0.6);transform:translateY(-1px)}.dismiss-btn:hover .btn-glow[data-v-7de01004]{opacity:1}.custom-scrollbar[data-v-7de01004]::-webkit-scrollbar{width:6px}.custom-scrollbar[data-v-7de01004]::-webkit-scrollbar-track{background:rgba(30,33,40,0.5);border-radius:3px}.custom-scrollbar[data-v-7de01004]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.2);border-radius:3px}.custom-scrollbar[data-v-7de01004]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.35)}.modal-enter-active[data-v-7de01004]{transition:opacity 0.2s ease-out}.modal-enter-active .team-modal[data-v-7de01004]{transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}.modal-leave-active[data-v-7de01004]{transition:opacity 0.15s ease-in}.modal-leave-active .team-modal[data-v-7de01004]{transition:transform 0.15s ease-in}.modal-enter-from[data-v-7de01004],.modal-leave-to[data-v-7de01004]{opacity:0}.modal-enter-from .team-modal[data-v-7de01004]{transform:scale(0.9) translateY(15px)}.modal-leave-to .team-modal[data-v-7de01004]{transform:scale(0.95) translateY(8px)}.modal-scale-enter-active[data-v-7de01004]{transition:all 0.2s ease-out}.modal-scale-leave-active[data-v-7de01004]{transition:all 0.15s ease-in}.modal-scale-enter-from[data-v-7de01004],.modal-scale-leave-to[data-v-7de01004]{opacity:0}.modal-scale-enter-from .dismiss-modal[data-v-7de01004]{transform:scale(0.9)}.modal-scale-leave-to .dismiss-modal[data-v-7de01004]{transform:scale(0.95)}.context-menu[data-v-7de01004]{animation:context-menu-in-7de01004 0.15s ease-out}@keyframes context-menu-in-7de01004{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}.context-menu-fade-enter-active[data-v-7de01004],.context-menu-fade-leave-active[data-v-7de01004]{transition:opacity 0.15s ease}.context-menu-fade-enter-from[data-v-7de01004],.context-menu-fade-leave-to[data-v-7de01004]{opacity:0}.context-menu-overlay[data-v-7de01004]{position:fixed !important;inset:0 !important;z-index:99 !important;background:transparent !important;backdrop-filter:none !important}

.scrollbar-thin[data-v-a948f270]::-webkit-scrollbar{width:8px}.scrollbar-thin[data-v-a948f270]::-webkit-scrollbar-track{background:transparent}.scrollbar-thin[data-v-a948f270]::-webkit-scrollbar-thumb{background-color:#202225;border-radius:4px}.layout-root[data-v-a948f270]{height:100vh;height:100dvh}.safe-area-padding[data-v-a948f270]{padding-top:env(safe-area-inset-top,0px);padding-bottom:env(safe-area-inset-bottom,0px);padding-left:env(safe-area-inset-left,0px);padding-right:env(safe-area-inset-right,0px);background-color:#000000}.safe-area-padding[data-v-a948f270]::before{content:'';position:fixed;top:0;left:0;right:0;height:env(safe-area-inset-top,0px);background-color:#000000;z-index:9999;pointer-events:none}.safe-area-padding[data-v-a948f270]::after{content:'';position:fixed;bottom:0;left:0;right:0;height:env(safe-area-inset-bottom,0px);background-color:#000000;z-index:9999;pointer-events:none}:fullscreen .layout-root aside[data-v-a948f270],:-webkit-full-screen .layout-root aside[data-v-a948f270]{padding-top:env(safe-area-inset-top,0px)}aside[data-v-a948f270]{padding-top:env(safe-area-inset-top,0px);padding-bottom:env(safe-area-inset-bottom,0px)}

.game-ui-root[data-v-edda78f0]{width:100%;height:100vh;overflow:hidden;background-color:#36393f}.dropdown-fade-enter-active[data-v-edda78f0],.dropdown-fade-leave-active[data-v-edda78f0]{transition:opacity 0.2s ease,transform 0.2s ease}.dropdown-fade-enter-from[data-v-edda78f0],.dropdown-fade-leave-to[data-v-edda78f0]{opacity:0;transform:translateY(-8px)}.inventory-modal-backdrop[data-v-edda78f0],.equipment-modal-backdrop[data-v-edda78f0]{background:linear-gradient(135deg,rgba(10,10,15,0.92) 0%,rgba(18,20,26,0.92) 50%,rgba(13,14,20,0.92) 100%);backdrop-filter:blur(6px)}.inventory-modal-container[data-v-edda78f0],.equipment-modal-container[data-v-edda78f0]{background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);border:1px solid rgba(114,137,218,0.25);box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 60px rgba(114,137,218,0.1) inset;overflow:hidden}.noise-overlay[data-v-edda78f0]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.02;pointer-events:none;z-index:0}.modal-header[data-v-edda78f0]{border-bottom:1px solid rgba(114,137,218,0.15)}.header-deco-line[data-v-edda78f0]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.header-deco-line[data-v-edda78f0]::before,.header-deco-line[data-v-edda78f0]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.header-deco-line[data-v-edda78f0]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.deco-diamond[data-v-edda78f0]{color:rgba(114,137,218,0.5);font-size:0.5rem;animation:diamond-pulse-edda78f0 3s ease-in-out infinite}@keyframes diamond-pulse-edda78f0{0%,100%{opacity:0.5}50%{opacity:1}}.header-title[data-v-edda78f0]{display:flex;align-items:center;gap:0.5rem;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.title-icon[data-v-edda78f0]{font-size:1rem}.close-btn[data-v-edda78f0]{color:rgba(150,160,180,0.6);font-size:1rem;padding:0.25rem;transition:all 0.2s ease}.close-btn[data-v-edda78f0]:hover{color:rgba(200,210,230,0.9);text-shadow:0 0 8px rgba(114,137,218,0.5)}.footer-deco-line[data-v-edda78f0]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.footer-deco-line[data-v-edda78f0]::before,.footer-deco-line[data-v-edda78f0]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 100%)}.footer-deco-line[data-v-edda78f0]::after{background:linear-gradient(90deg,rgba(114,137,218,0.2) 0%,transparent 100%)}.modal-fade-enter-active[data-v-edda78f0],.modal-fade-leave-active[data-v-edda78f0]{transition:all 0.3s ease}.modal-fade-enter-active .inventory-modal-container[data-v-edda78f0],.modal-fade-enter-active .equipment-modal-container[data-v-edda78f0],.modal-fade-leave-active .inventory-modal-container[data-v-edda78f0],.modal-fade-leave-active .equipment-modal-container[data-v-edda78f0]{transition:all 0.3s ease}.modal-fade-enter-from[data-v-edda78f0],.modal-fade-leave-to[data-v-edda78f0]{opacity:0}.modal-fade-enter-from .inventory-modal-container[data-v-edda78f0],.modal-fade-enter-from .equipment-modal-container[data-v-edda78f0],.modal-fade-leave-to .inventory-modal-container[data-v-edda78f0],.modal-fade-leave-to .equipment-modal-container[data-v-edda78f0]{transform:scale(0.95) translateY(-10px);opacity:0}.right-sidebar-container[data-v-edda78f0]{position:relative;background:linear-gradient(180deg,rgba(30,33,40,0.98) 0%,rgba(25,27,35,0.99) 50%,rgba(20,22,28,1) 100%);padding:0.75rem}.sidebar-title-section[data-v-edda78f0]{border-bottom:1px solid rgba(114,137,218,0.15)}.title-deco-line[data-v-edda78f0]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.title-deco-line[data-v-edda78f0]::before,.title-deco-line[data-v-edda78f0]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.3) 100%)}.title-deco-line[data-v-edda78f0]::after{background:linear-gradient(90deg,rgba(114,137,218,0.3) 0%,transparent 100%)}.sidebar-title[data-v-edda78f0]{background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#a0a8c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.sidebar-icon-bar[data-v-edda78f0]{background:linear-gradient(180deg,rgba(35,38,48,0.6) 0%,rgba(28,31,40,0.7) 100%);border:1px solid rgba(114,137,218,0.12);border-radius:8px}.sidebar-icon-btn[data-v-edda78f0]{display:flex;align-items:center;justify-content:center;width:2.5rem;height:2.5rem;border-radius:6px;border:1px solid transparent;background:transparent;color:rgba(150,160,180,0.8);cursor:pointer;transition:all 0.2s ease}.sidebar-icon-btn[data-v-edda78f0]:hover{background:rgba(114,137,218,0.15);border-color:rgba(114,137,218,0.3);color:#ffffff;transform:translateY(-1px)}.sidebar-icon-btn.save[data-v-edda78f0]:hover{color:#4ade80;border-color:rgba(74,222,128,0.3);background:rgba(74,222,128,0.1)}.sidebar-icon-btn.load[data-v-edda78f0]:hover{color:#60a5fa;border-color:rgba(96,165,250,0.3);background:rgba(96,165,250,0.1)}.sidebar-icon-btn.fullscreen[data-v-edda78f0]:hover{color:#c084fc;border-color:rgba(192,132,252,0.3);background:rgba(192,132,252,0.1)}.sidebar-icon-btn.exit[data-v-edda78f0]:hover{color:#f87171;border-color:rgba(248,113,113,0.3);background:rgba(248,113,113,0.1)}.sidebar-group[data-v-edda78f0]{background:linear-gradient(180deg,rgba(35,38,48,0.4) 0%,rgba(28,31,40,0.5) 100%);border:1px solid rgba(114,137,218,0.08);border-radius:8px;padding:0.75rem}.sidebar-group-title[data-v-edda78f0]{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem;padding-bottom:0.5rem;border-bottom:1px solid rgba(114,137,218,0.12);font-size:0.7rem;font-weight:700;letter-spacing:0.1em;color:rgba(114,137,218,0.8);text-transform:uppercase}.group-icon[data-v-edda78f0]{font-size:0.85rem}.sidebar-group-content[data-v-edda78f0]{display:flex;flex-direction:column;gap:0.375rem}.sidebar-btn[data-v-edda78f0]{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0.75rem;border-radius:4px;border:1px solid transparent;background:linear-gradient(180deg,rgba(40,43,52,0.6) 0%,rgba(35,38,46,0.7) 100%);color:rgba(180,190,210,0.9);font-size:0.8rem;cursor:pointer;transition:all 0.2s ease}.sidebar-btn[data-v-edda78f0]:hover{background:linear-gradient(180deg,rgba(50,55,65,0.8) 0%,rgba(45,48,58,0.85) 100%);border-color:rgba(114,137,218,0.25);color:#ffffff;transform:translateX(2px)}.sidebar-btn.disabled[data-v-edda78f0]{opacity:0.4;cursor:not-allowed;color:rgba(100,110,130,0.5)}.sidebar-btn.disabled[data-v-edda78f0]:hover{background:linear-gradient(180deg,rgba(40,43,52,0.6) 0%,rgba(35,38,46,0.7) 100%);border-color:transparent;transform:none}.btn-icon[data-v-edda78f0]{font-size:0.9rem;flex-shrink:0}.btn-text[data-v-edda78f0]{flex:1;text-align:left}.lock-icon[data-v-edda78f0]{font-size:0.65rem;color:rgba(248,113,113,0.7)}.sidebar-footer-deco .footer-deco-line[data-v-edda78f0]{display:flex;align-items:center;justify-content:center;gap:0.5rem}.sidebar-footer-deco .footer-deco-line[data-v-edda78f0]::before,.sidebar-footer-deco .footer-deco-line[data-v-edda78f0]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.2) 100%)}.sidebar-footer-deco .footer-deco-line[data-v-edda78f0]::after{background:linear-gradient(90deg,rgba(114,137,218,0.2) 0%,transparent 100%)}.custom-scrollbar[data-v-edda78f0]::-webkit-scrollbar{width:4px}.custom-scrollbar[data-v-edda78f0]::-webkit-scrollbar-track{background:rgba(20,22,28,0.5);border-radius:2px}.custom-scrollbar[data-v-edda78f0]::-webkit-scrollbar-thumb{background:rgba(114,137,218,0.3);border-radius:2px}.custom-scrollbar[data-v-edda78f0]::-webkit-scrollbar-thumb:hover{background:rgba(114,137,218,0.5)}

.changelog-modal-backdrop[data-v-30fad8f0]{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);backdrop-filter:blur(4px);padding-top:env(safe-area-inset-top,0);padding-bottom:env(safe-area-inset-bottom,0);padding-left:env(safe-area-inset-left,0);padding-right:env(safe-area-inset-right,0)}.changelog-modal-content[data-v-30fad8f0]{max-height:85vh;width:100%;max-width:48rem;overflow-y:auto;border-radius:0.5rem;border:1px solid #374151;background-color:#2f3136;padding:1.5rem;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);margin:1rem}.changelog-content[data-v-30fad8f0]{color:#e5e7eb;line-height:1.75}.changelog-content[data-v-30fad8f0] h1{font-size:1.875rem;font-weight:700;color:#f3f4f6;margin-bottom:1.5rem;padding-bottom:0.75rem;border-bottom:2px solid #4b5563}.changelog-content[data-v-30fad8f0] h2{font-size:1.5rem;font-weight:600;color:#fbbf24;margin-top:2rem;margin-bottom:1rem}.changelog-content[data-v-30fad8f0] h3{font-size:1.125rem;font-weight:600;color:#60a5fa;margin-top:1.5rem;margin-bottom:0.75rem}.changelog-content[data-v-30fad8f0] p{margin-bottom:1rem;color:#d1d5db}.changelog-content[data-v-30fad8f0] ul{list-style-type:none;margin-bottom:1rem;padding-left:0}.changelog-content[data-v-30fad8f0] li{padding-left:1.5rem;margin-bottom:0.5rem;position:relative;color:#d1d5db}.changelog-content[data-v-30fad8f0] li::before{content:'•';position:absolute;left:0.5rem;color:#60a5fa}.changelog-content[data-v-30fad8f0] hr{border:none;border-top:1px solid #4b5563;margin:2rem 0}.changelog-content[data-v-30fad8f0] strong{font-weight:600;color:#f3f4f6}.changelog-content[data-v-30fad8f0] em{font-style:italic;color:#9ca3af}.changelog-content[data-v-30fad8f0] a{color:#60a5fa;text-decoration:underline}.changelog-content[data-v-30fad8f0] a:hover{color:#93c5fd}.changelog-content[data-v-30fad8f0] blockquote{border-left:4px solid #4b5563;padding-left:1rem;margin:1rem 0;color:#9ca3af;font-style:italic}@media (max-width:640px){.changelog-modal-content[data-v-30fad8f0]{max-height:calc(85vh - env(safe-area-inset-top,0) - env(safe-area-inset-bottom,0));margin-top:calc(0.5rem + env(safe-area-inset-top,0));margin-bottom:calc(0.5rem + env(safe-area-inset-bottom,0))}}

.settings-modal-backdrop[data-v-7f3f849a]{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);backdrop-filter:blur(4px);padding-top:env(safe-area-inset-top,0);padding-bottom:env(safe-area-inset-bottom,0);padding-left:env(safe-area-inset-left,0);padding-right:env(safe-area-inset-right,0)}.settings-modal-content[data-v-7f3f849a]{max-height:85vh;width:100%;max-width:32rem;overflow-y:auto;border-radius:0.5rem;border:1px solid #374151;background-color:#2f3136;padding:1.5rem;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);margin:1rem}@media (max-width:640px){.settings-modal-content[data-v-7f3f849a]{max-height:calc(85vh - env(safe-area-inset-top,0) - env(safe-area-inset-bottom,0));margin-top:calc(0.5rem + env(safe-area-inset-top,0));margin-bottom:calc(0.5rem + env(safe-area-inset-bottom,0))}}

.main-menu-root[data-v-8da20610]{position:relative;width:100%;height:100%;min-height:600px;overflow:hidden;font-family:'Noto Sans SC','Microsoft YaHei',sans-serif;padding-top:env(safe-area-inset-top,0);padding-bottom:env(safe-area-inset-bottom,0);padding-left:env(safe-area-inset-left,0);padding-right:env(safe-area-inset-right,0);box-sizing:border-box}.main-menu-root.use-vh[data-v-8da20610]{height:100vh;min-height:100vh}.fullscreen-btn[data-v-8da20610]{position:absolute;top:1rem;right:1rem;z-index:20;display:flex;align-items:center;justify-content:center;width:2.5rem;height:2.5rem;border-radius:6px;border:1px solid rgba(114,137,218,0.3);background:rgba(30,33,40,0.8);color:rgba(150,160,180,0.8);cursor:pointer;transition:all 0.2s ease;backdrop-filter:blur(4px)}.fullscreen-btn[data-v-8da20610]:hover{background:rgba(114,137,218,0.2);border-color:rgba(114,137,218,0.5);color:#ffffff;transform:scale(1.05)}.bg-layer[data-v-8da20610]{position:absolute;inset:0;background:linear-gradient(135deg,#0a0a0f 0%,#12141a 25%,#1a1c25 50%,#151720 75%,#0d0e14 100%)}.vignette[data-v-8da20610]{position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 0%,transparent 40%,rgba(0,0,0,0.6) 100%);pointer-events:none}.noise[data-v-8da20610]{position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");opacity:0.03;pointer-events:none}.content-layer[data-v-8da20610]{position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;min-height:600px;padding:2rem;box-sizing:border-box}.title-section[data-v-8da20610]{text-align:center;margin-bottom:3rem}.title-deco-line[data-v-8da20610]{display:flex;align-items:center;justify-content:center;gap:0.75rem;margin:1rem auto;width:200px}.title-deco-line[data-v-8da20610]::before,.title-deco-line[data-v-8da20610]::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(114,137,218,0.6) 100%)}.title-deco-line[data-v-8da20610]::after{background:linear-gradient(90deg,rgba(114,137,218,0.6) 0%,transparent 100%)}.deco-diamond[data-v-8da20610]{color:rgba(114,137,218,0.7);font-size:0.6rem;line-height:1}.main-title[data-v-8da20610]{display:flex;align-items:center;justify-content:center;gap:0.75rem;margin-bottom:0.5rem}.title-icon[data-v-8da20610]{color:rgba(114,137,218,0.6);font-size:1.5rem;animation:glow-pulse-8da20610 3s ease-in-out infinite}@keyframes glow-pulse-8da20610{0%,100%{opacity:0.6;text-shadow:0 0 10px rgba(114,137,218,0.3)}50%{opacity:1;text-shadow:0 0 20px rgba(114,137,218,0.6)}}.title-text[data-v-8da20610]{font-size:2.5rem;font-weight:700;letter-spacing:0.3em;background:linear-gradient(180deg,#ffffff 0%,#c0c8e0 50%,#8090b0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:none;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3))}.sub-title[data-v-8da20610]{font-size:1.25rem;font-weight:400;letter-spacing:0.5em;color:rgba(114,137,218,0.9);text-shadow:0 0 20px rgba(114,137,218,0.4),0 0 40px rgba(114,137,218,0.2);margin-bottom:0.5rem}.english-title[data-v-8da20610]{font-size:0.875rem;letter-spacing:0.2em;color:rgba(150,160,180,0.6);font-weight:300}.menu-buttons[data-v-8da20610]{display:flex;flex-direction:column;gap:0.875rem;width:280px}.menu-btn[data-v-8da20610]{position:relative;padding:0.875rem 1.5rem;border:1px solid rgba(114,137,218,0.2);border-radius:4px;background:linear-gradient(180deg,rgba(30,33,40,0.9) 0%,rgba(25,27,35,0.95) 100%);color:rgba(200,210,230,0.9);font-size:1rem;font-weight:500;letter-spacing:0.15em;cursor:pointer;overflow:hidden;transition:all 0.3s ease}.menu-btn[data-v-8da20610]:hover{border-color:rgba(114,137,218,0.5);background:linear-gradient(180deg,rgba(40,45,55,0.95) 0%,rgba(30,33,42,0.98) 100%);color:#ffffff;transform:translateY(-2px);box-shadow:0 4px 20px rgba(114,137,218,0.15),0 0 0 1px rgba(114,137,218,0.1) inset}.menu-btn[data-v-8da20610]:active{transform:translateY(0)}.menu-btn.primary[data-v-8da20610]{border-color:rgba(114,137,218,0.4);background:linear-gradient(180deg,rgba(114,137,218,0.2) 0%,rgba(90,110,180,0.15) 100%)}.menu-btn.primary[data-v-8da20610]:hover{border-color:rgba(114,137,218,0.7);background:linear-gradient(180deg,rgba(114,137,218,0.3) 0%,rgba(90,110,180,0.25) 100%);box-shadow:0 4px 30px rgba(114,137,218,0.25),0 0 0 1px rgba(114,137,218,0.2) inset}.menu-btn[data-v-8da20610]:disabled{cursor:not-allowed}.menu-btn[data-v-8da20610]:disabled:hover{transform:none;box-shadow:none}.btn-glow[data-v-8da20610]{position:absolute;inset:0;opacity:0;background:radial-gradient(circle at var(--x,50%) var(--y,50%),rgba(114,137,218,0.15) 0%,transparent 50%);transition:opacity 0.3s ease}.menu-btn:hover .btn-glow[data-v-8da20610]{opacity:1}.btn-content[data-v-8da20610]{position:relative;z-index:1}.version-info[data-v-8da20610]{position:relative;margin-top:auto;padding-top:2rem;display:flex;flex-direction:column;align-items:center;gap:0.5rem;font-size:0.75rem;color:rgba(100,110,130,0.6);letter-spacing:0.1em}.version-info>div[data-v-8da20610]:first-child{display:flex;align-items:center;gap:0.75rem}.version-deco[data-v-8da20610]{font-size:0.5rem;opacity:0.5}.update-date[data-v-8da20610]{font-size:0.7rem;color:rgba(100,110,130,0.5);letter-spacing:0.05em}@media (max-width:640px){.title-text[data-v-8da20610]{font-size:1.75rem;letter-spacing:0.2em}.title-icon[data-v-8da20610]{font-size:1.2rem}.sub-title[data-v-8da20610]{font-size:1rem;letter-spacing:0.3em}.english-title[data-v-8da20610]{font-size:0.75rem}.title-deco-line[data-v-8da20610]{width:150px}.menu-buttons[data-v-8da20610]{width:240px}.menu-btn[data-v-8da20610]{padding:0.75rem 1.25rem;font-size:0.875rem}}

.modal-fade-enter-active[data-v-cc03ce84],.modal-fade-leave-active[data-v-cc03ce84]{transition:opacity 0.2s ease}.modal-fade-enter-from[data-v-cc03ce84],.modal-fade-leave-to[data-v-cc03ce84]{opacity:0}.modal-fade-enter-active>div[data-v-cc03ce84],.modal-fade-leave-active>div[data-v-cc03ce84]{transition:transform 0.2s ease}.modal-fade-enter-from>div[data-v-cc03ce84]{transform:scale(0.95)}.modal-fade-leave-to>div[data-v-cc03ce84]{transform:scale(0.95)}

.app-root{width:100%;height:100%;min-height:600px;overflow:hidden}.app-root.use-vh{height:100vh;min-height:100vh}.fade-enter-active,.fade-leave-active{transition:opacity 0.3s ease}.fade-enter-from,.fade-leave-to{opacity:0}

/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@layer properties;@layer theme,base,components,utilities;@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-serif:ui-serif,Georgia,Cambria,"Times New Roman",Times,serif;--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-50:oklch(97.1% 0.013 17.38);--color-red-100:oklch(93.6% 0.032 17.717);--color-red-200:oklch(88.5% 0.062 18.334);--color-red-300:oklch(80.8% 0.114 19.571);--color-red-400:oklch(70.4% 0.191 22.216);--color-red-500:oklch(63.7% 0.237 25.331);--color-red-600:oklch(57.7% 0.245 27.325);--color-red-700:oklch(50.5% 0.213 27.518);--color-red-800:oklch(44.4% 0.177 26.899);--color-red-900:oklch(39.6% 0.141 25.723);--color-red-950:oklch(25.8% 0.092 26.042);--color-orange-50:oklch(98% 0.016 73.684);--color-orange-100:oklch(95.4% 0.038 75.164);--color-orange-200:oklch(90.1% 0.076 70.697);--color-orange-300:oklch(83.7% 0.128 66.29);--color-orange-400:oklch(75% 0.183 55.934);--color-orange-500:oklch(70.5% 0.213 47.604);--color-orange-600:oklch(64.6% 0.222 41.116);--color-orange-700:oklch(55.3% 0.195 38.402);--color-orange-800:oklch(47% 0.157 37.304);--color-orange-900:oklch(40.8% 0.123 38.172);--color-orange-950:oklch(26.6% 0.079 36.259);--color-amber-50:oklch(98.7% 0.022 95.277);--color-amber-100:oklch(96.2% 0.059 95.617);--color-amber-200:oklch(92.4% 0.12 95.746);--color-amber-300:oklch(87.9% 0.169 91.605);--color-amber-400:oklch(82.8% 0.189 84.429);--color-amber-500:oklch(76.9% 0.188 70.08);--color-amber-600:oklch(66.6% 0.179 58.318);--color-amber-700:oklch(55.5% 0.163 48.998);--color-amber-800:oklch(47.3% 0.137 46.201);--color-amber-900:oklch(41.4% 0.112 45.904);--color-amber-950:oklch(27.9% 0.077 45.635);--color-yellow-50:oklch(98.7% 0.026 102.212);--color-yellow-100:oklch(97.3% 0.071 103.193);--color-yellow-200:oklch(94.5% 0.129 101.54);--color-yellow-300:oklch(90.5% 0.182 98.111);--color-yellow-400:oklch(85.2% 0.199 91.936);--color-yellow-500:oklch(79.5% 0.184 86.047);--color-yellow-600:oklch(68.1% 0.162 75.834);--color-yellow-700:oklch(55.4% 0.135 66.442);--color-yellow-800:oklch(47.6% 0.114 61.907);--color-yellow-900:oklch(42.1% 0.095 57.708);--color-yellow-950:oklch(28.6% 0.066 53.813);--color-lime-50:oklch(98.6% 0.031 120.757);--color-lime-100:oklch(96.7% 0.067 122.328);--color-lime-200:oklch(93.8% 0.127 124.321);--color-lime-300:oklch(89.7% 0.196 126.665);--color-lime-400:oklch(84.1% 0.238 128.85);--color-lime-500:oklch(76.8% 0.233 130.85);--color-lime-600:oklch(64.8% 0.2 131.684);--color-lime-700:oklch(53.2% 0.157 131.589);--color-lime-800:oklch(45.3% 0.124 130.933);--color-lime-900:oklch(40.5% 0.101 131.063);--color-lime-950:oklch(27.4% 0.072 132.109);--color-green-50:oklch(98.2% 0.018 155.826);--color-green-100:oklch(96.2% 0.044 156.743);--color-green-200:oklch(92.5% 0.084 155.995);--color-green-300:oklch(87.1% 0.15 154.449);--color-green-400:oklch(79.2% 0.209 151.711);--color-green-500:oklch(72.3% 0.219 149.579);--color-green-600:oklch(62.7% 0.194 149.214);--color-green-700:oklch(52.7% 0.154 150.069);--color-green-800:oklch(44.8% 0.119 151.328);--color-green-900:oklch(39.3% 0.095 152.535);--color-green-950:oklch(26.6% 0.065 152.934);--color-emerald-50:oklch(97.9% 0.021 166.113);--color-emerald-100:oklch(95% 0.052 163.051);--color-emerald-200:oklch(90.5% 0.093 164.15);--color-emerald-300:oklch(84.5% 0.143 164.978);--color-emerald-400:oklch(76.5% 0.177 163.223);--color-emerald-500:oklch(69.6% 0.17 162.48);--color-emerald-600:oklch(59.6% 0.145 163.225);--color-emerald-700:oklch(50.8% 0.118 165.612);--color-emerald-800:oklch(43.2% 0.095 166.913);--color-emerald-900:oklch(37.8% 0.077 168.94);--color-emerald-950:oklch(26.2% 0.051 172.552);--color-teal-50:oklch(98.4% 0.014 180.72);--color-teal-100:oklch(95.3% 0.051 180.801);--color-teal-200:oklch(91% 0.096 180.426);--color-teal-300:oklch(85.5% 0.138 181.071);--color-teal-400:oklch(77.7% 0.152 181.912);--color-teal-500:oklch(70.4% 0.14 182.503);--color-teal-600:oklch(60% 0.118 184.704);--color-teal-700:oklch(51.1% 0.096 186.391);--color-teal-800:oklch(43.7% 0.078 188.216);--color-teal-900:oklch(38.6% 0.063 188.416);--color-teal-950:oklch(27.7% 0.046 192.524);--color-cyan-50:oklch(98.4% 0.019 200.873);--color-cyan-100:oklch(95.6% 0.045 203.388);--color-cyan-200:oklch(91.7% 0.08 205.041);--color-cyan-300:oklch(86.5% 0.127 207.078);--color-cyan-400:oklch(78.9% 0.154 211.53);--color-cyan-500:oklch(71.5% 0.143 215.221);--color-cyan-600:oklch(60.9% 0.126 221.723);--color-cyan-700:oklch(52% 0.105 223.128);--color-cyan-800:oklch(45% 0.085 224.283);--color-cyan-900:oklch(39.8% 0.07 227.392);--color-cyan-950:oklch(30.2% 0.056 229.695);--color-sky-50:oklch(97.7% 0.013 236.62);--color-sky-100:oklch(95.1% 0.026 236.824);--color-sky-200:oklch(90.1% 0.058 230.902);--color-sky-300:oklch(82.8% 0.111 230.318);--color-sky-400:oklch(74.6% 0.16 232.661);--color-sky-500:oklch(68.5% 0.169 237.323);--color-sky-600:oklch(58.8% 0.158 241.966);--color-sky-700:oklch(50% 0.134 242.749);--color-sky-800:oklch(44.3% 0.11 240.79);--color-sky-900:oklch(39.1% 0.09 240.876);--color-sky-950:oklch(29.3% 0.066 243.157);--color-blue-50:oklch(97% 0.014 254.604);--color-blue-100:oklch(93.2% 0.032 255.585);--color-blue-200:oklch(88.2% 0.059 254.128);--color-blue-300:oklch(80.9% 0.105 251.813);--color-blue-400:oklch(70.7% 0.165 254.624);--color-blue-500:oklch(62.3% 0.214 259.815);--color-blue-600:oklch(54.6% 0.245 262.881);--color-blue-700:oklch(48.8% 0.243 264.376);--color-blue-800:oklch(42.4% 0.199 265.638);--color-blue-900:oklch(37.9% 0.146 265.522);--color-blue-950:oklch(28.2% 0.091 267.935);--color-indigo-50:oklch(96.2% 0.018 272.314);--color-indigo-100:oklch(93% 0.034 272.788);--color-indigo-200:oklch(87% 0.065 274.039);--color-indigo-300:oklch(78.5% 0.115 274.713);--color-indigo-400:oklch(67.3% 0.182 276.935);--color-indigo-500:oklch(58.5% 0.233 277.117);--color-indigo-600:oklch(51.1% 0.262 276.966);--color-indigo-700:oklch(45.7% 0.24 277.023);--color-indigo-800:oklch(39.8% 0.195 277.366);--color-indigo-900:oklch(35.9% 0.144 278.697);--color-indigo-950:oklch(25.7% 0.09 281.288);--color-violet-50:oklch(96.9% 0.016 293.756);--color-violet-100:oklch(94.3% 0.029 294.588);--color-violet-200:oklch(89.4% 0.057 293.283);--color-violet-300:oklch(81.1% 0.111 293.571);--color-violet-400:oklch(70.2% 0.183 293.541);--color-violet-500:oklch(60.6% 0.25 292.717);--color-violet-600:oklch(54.1% 0.281 293.009);--color-violet-700:oklch(49.1% 0.27 292.581);--color-violet-800:oklch(43.2% 0.232 292.759);--color-violet-900:oklch(38% 0.189 293.745);--color-violet-950:oklch(28.3% 0.141 291.089);--color-purple-50:oklch(97.7% 0.014 308.299);--color-purple-100:oklch(94.6% 0.033 307.174);--color-purple-200:oklch(90.2% 0.063 306.703);--color-purple-300:oklch(82.7% 0.119 306.383);--color-purple-400:oklch(71.4% 0.203 305.504);--color-purple-500:oklch(62.7% 0.265 303.9);--color-purple-600:oklch(55.8% 0.288 302.321);--color-purple-700:oklch(49.6% 0.265 301.924);--color-purple-800:oklch(43.8% 0.218 303.724);--color-purple-900:oklch(38.1% 0.176 304.987);--color-purple-950:oklch(29.1% 0.149 302.717);--color-fuchsia-50:oklch(97.7% 0.017 320.058);--color-fuchsia-100:oklch(95.2% 0.037 318.852);--color-fuchsia-200:oklch(90.3% 0.076 319.62);--color-fuchsia-300:oklch(83.3% 0.145 321.434);--color-fuchsia-400:oklch(74% 0.238 322.16);--color-fuchsia-500:oklch(66.7% 0.295 322.15);--color-fuchsia-600:oklch(59.1% 0.293 322.896);--color-fuchsia-700:oklch(51.8% 0.253 323.949);--color-fuchsia-800:oklch(45.2% 0.211 324.591);--color-fuchsia-900:oklch(40.1% 0.17 325.612);--color-fuchsia-950:oklch(29.3% 0.136 325.661);--color-pink-50:oklch(97.1% 0.014 343.198);--color-pink-100:oklch(94.8% 0.028 342.258);--color-pink-200:oklch(89.9% 0.061 343.231);--color-pink-300:oklch(82.3% 0.12 346.018);--color-pink-400:oklch(71.8% 0.202 349.761);--color-pink-500:oklch(65.6% 0.241 354.308);--color-pink-600:oklch(59.2% 0.249 0.584);--color-pink-700:oklch(52.5% 0.223 3.958);--color-pink-800:oklch(45.9% 0.187 3.815);--color-pink-900:oklch(40.8% 0.153 2.432);--color-pink-950:oklch(28.4% 0.109 3.907);--color-rose-50:oklch(96.9% 0.015 12.422);--color-rose-100:oklch(94.1% 0.03 12.58);--color-rose-200:oklch(89.2% 0.058 10.001);--color-rose-300:oklch(81% 0.117 11.638);--color-rose-400:oklch(71.2% 0.194 13.428);--color-rose-500:oklch(64.5% 0.246 16.439);--color-rose-600:oklch(58.6% 0.253 17.585);--color-rose-700:oklch(51.4% 0.222 16.935);--color-rose-800:oklch(45.5% 0.188 13.697);--color-rose-900:oklch(41% 0.159 10.272);--color-rose-950:oklch(27.1% 0.105 12.094);--color-slate-50:oklch(98.4% 0.003 247.858);--color-slate-100:oklch(96.8% 0.007 247.896);--color-slate-200:oklch(92.9% 0.013 255.508);--color-slate-300:oklch(86.9% 0.022 252.894);--color-slate-400:oklch(70.4% 0.04 256.788);--color-slate-500:oklch(55.4% 0.046 257.417);--color-slate-600:oklch(44.6% 0.043 257.281);--color-slate-700:oklch(37.2% 0.044 257.287);--color-slate-800:oklch(27.9% 0.041 260.031);--color-slate-900:oklch(20.8% 0.042 265.755);--color-slate-950:oklch(12.9% 0.042 264.695);--color-gray-50:oklch(98.5% 0.002 247.839);--color-gray-100:oklch(96.7% 0.003 264.542);--color-gray-200:oklch(92.8% 0.006 264.531);--color-gray-300:oklch(87.2% 0.01 258.338);--color-gray-400:oklch(70.7% 0.022 261.325);--color-gray-500:oklch(55.1% 0.027 264.364);--color-gray-600:oklch(44.6% 0.03 256.802);--color-gray-700:oklch(37.3% 0.034 259.733);--color-gray-800:oklch(27.8% 0.033 256.848);--color-gray-900:oklch(21% 0.034 264.665);--color-gray-950:oklch(13% 0.028 261.692);--color-zinc-50:oklch(98.5% 0 0);--color-zinc-100:oklch(96.7% 0.001 286.375);--color-zinc-200:oklch(92% 0.004 286.32);--color-zinc-300:oklch(87.1% 0.006 286.286);--color-zinc-400:oklch(70.5% 0.015 286.067);--color-zinc-500:oklch(55.2% 0.016 285.938);--color-zinc-600:oklch(44.2% 0.017 285.786);--color-zinc-700:oklch(37% 0.013 285.805);--color-zinc-800:oklch(27.4% 0.006 286.033);--color-zinc-900:oklch(21% 0.006 285.885);--color-zinc-950:oklch(14.1% 0.005 285.823);--color-neutral-50:oklch(98.5% 0 0);--color-neutral-100:oklch(97% 0 0);--color-neutral-200:oklch(92.2% 0 0);--color-neutral-300:oklch(87% 0 0);--color-neutral-400:oklch(70.8% 0 0);--color-neutral-500:oklch(55.6% 0 0);--color-neutral-600:oklch(43.9% 0 0);--color-neutral-700:oklch(37.1% 0 0);--color-neutral-800:oklch(26.9% 0 0);--color-neutral-900:oklch(20.5% 0 0);--color-neutral-950:oklch(14.5% 0 0);--color-stone-50:oklch(98.5% 0.001 106.423);--color-stone-100:oklch(97% 0.001 106.424);--color-stone-200:oklch(92.3% 0.003 48.717);--color-stone-300:oklch(86.9% 0.005 56.366);--color-stone-400:oklch(70.9% 0.01 56.259);--color-stone-500:oklch(55.3% 0.013 58.071);--color-stone-600:oklch(44.4% 0.011 73.639);--color-stone-700:oklch(37.4% 0.01 67.558);--color-stone-800:oklch(26.8% 0.007 34.298);--color-stone-900:oklch(21.6% 0.006 56.043);--color-stone-950:oklch(14.7% 0.004 49.25);--color-black:#000;--color-white:#fff;--spacing:0.25rem;--breakpoint-sm:40rem;--breakpoint-md:48rem;--breakpoint-lg:64rem;--breakpoint-xl:80rem;--breakpoint-2xl:96rem;--container-3xs:16rem;--container-2xs:18rem;--container-xs:20rem;--container-sm:24rem;--container-md:28rem;--container-lg:32rem;--container-xl:36rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--container-5xl:64rem;--container-6xl:72rem;--container-7xl:80rem;--text-xs:0.75rem;--text-xs--line-height:calc(1 / 0.75);--text-sm:0.875rem;--text-sm--line-height:calc(1.25 / 0.875);--text-base:1rem;--text-base--line-height:calc(1.5 / 1);--text-lg:1.125rem;--text-lg--line-height:calc(1.75 / 1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75 / 1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2 / 1.5);--text-3xl:1.875rem;--text-3xl--line-height:calc(2.25 / 1.875);--text-4xl:2.25rem;--text-4xl--line-height:calc(2.5 / 2.25);--text-5xl:3rem;--text-5xl--line-height:1;--text-6xl:3.75rem;--text-6xl--line-height:1;--text-7xl:4.5rem;--text-7xl--line-height:1;--text-8xl:6rem;--text-8xl--line-height:1;--text-9xl:8rem;--text-9xl--line-height:1;--font-weight-thin:100;--font-weight-extralight:200;--font-weight-light:300;--font-weight-normal:400;--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--font-weight-extrabold:800;--font-weight-black:900;--tracking-tighter:-0.05em;--tracking-tight:-0.025em;--tracking-normal:0em;--tracking-wide:0.025em;--tracking-wider:0.05em;--tracking-widest:0.1em;--leading-tight:1.25;--leading-snug:1.375;--leading-normal:1.5;--leading-relaxed:1.625;--leading-loose:2;--radius-xs:0.125rem;--radius-sm:0.25rem;--radius-md:0.375rem;--radius-lg:0.5rem;--radius-xl:0.75rem;--radius-2xl:1rem;--radius-3xl:1.5rem;--radius-4xl:2rem;--shadow-2xs:0 1px rgb(0 0 0/0.05);--shadow-xs:0 1px 2px 0 rgb(0 0 0/0.05);--shadow-sm:0 1px 3px 0 rgb(0 0 0/0.1),0 1px 2px -1px rgb(0 0 0/0.1);--shadow-md:0 4px 6px -1px rgb(0 0 0/0.1),0 2px 4px -2px rgb(0 0 0/0.1);--shadow-lg:0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1);--shadow-xl:0 20px 25px -5px rgb(0 0 0/0.1),0 8px 10px -6px rgb(0 0 0/0.1);--shadow-2xl:0 25px 50px -12px rgb(0 0 0/0.25);--inset-shadow-2xs:inset 0 1px rgb(0 0 0/0.05);--inset-shadow-xs:inset 0 1px 1px rgb(0 0 0/0.05);--inset-shadow-sm:inset 0 2px 4px rgb(0 0 0/0.05);--drop-shadow-xs:0 1px 1px rgb(0 0 0/0.05);--drop-shadow-sm:0 1px 2px rgb(0 0 0/0.15);--drop-shadow-md:0 3px 3px rgb(0 0 0/0.12);--drop-shadow-lg:0 4px 4px rgb(0 0 0/0.15);--drop-shadow-xl:0 9px 7px rgb(0 0 0/0.1);--drop-shadow-2xl:0 25px 25px rgb(0 0 0/0.15);--text-shadow-2xs:0px 1px 0px rgb(0 0 0/0.15);--text-shadow-xs:0px 1px 1px rgb(0 0 0/0.2);--text-shadow-sm:0px 1px 0px rgb(0 0 0/0.075),0px 1px 1px rgb(0 0 0/0.075),0px 2px 2px rgb(0 0 0/0.075);--text-shadow-md:0px 1px 1px rgb(0 0 0/0.1),0px 1px 2px rgb(0 0 0/0.1),0px 2px 4px rgb(0 0 0/0.1);--text-shadow-lg:0px 1px 2px rgb(0 0 0/0.1),0px 3px 2px rgb(0 0 0/0.1),0px 4px 8px rgb(0 0 0/0.1);--ease-in:cubic-bezier(0.4,0,1,1);--ease-out:cubic-bezier(0,0,0.2,1);--ease-in-out:cubic-bezier(0.4,0,0.2,1);--animate-spin:spin 1s linear infinite;--animate-ping:ping 1s cubic-bezier(0,0,0.2,1) infinite;--animate-pulse:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite;--animate-bounce:bounce 1s infinite;--blur-xs:4px;--blur-sm:8px;--blur-md:12px;--blur-lg:16px;--blur-xl:24px;--blur-2xl:40px;--blur-3xl:64px;--perspective-dramatic:100px;--perspective-near:300px;--perspective-normal:500px;--perspective-midrange:800px;--perspective-distant:1200px;--aspect-video:16/9;--default-transition-duration:150ms;--default-transition-timing-function:cubic-bezier(0.4,0,0.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono)}}@layer base{*,::after,::before,::backdrop,::file-selector-button{box-sizing:border-box;margin:0;padding:0;border:0 solid}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea,::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;border-radius:0;background-color:transparent;opacity:1}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not (-webkit-appearance:-apple-pay-button)) or (contain-intrinsic-size:1px){::placeholder{color:currentcolor;@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit,::-webkit-datetime-edit-year-field,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute-field,::-webkit-datetime-edit-second-field,::-webkit-datetime-edit-millisecond-field,::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type="button"],[type="reset"],[type="submit"]),::file-selector-button{-webkit-appearance:button;appearance:button}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden="until-found"])){display:none !important}}@layer utilities{.pointer-events-auto{pointer-events:auto}.pointer-events-none{pointer-events:none}.visible{visibility:visible}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.static{position:static}.sticky{position:sticky}.inset-0{inset:calc(var(--spacing) * 0)}.inset-y-0{inset-block:calc(var(--spacing) * 0)}.-top-1{top:calc(var(--spacing) * -1)}.-top-1\.5{top:calc(var(--spacing) * -1.5)}.-top-2{top:calc(var(--spacing) * -2)}.-top-3{top:calc(var(--spacing) * -3)}.-top-6{top:calc(var(--spacing) * -6)}.top-0{top:calc(var(--spacing) * 0)}.top-1{top:calc(var(--spacing) * 1)}.top-1\/2{top:calc(1/2 * 100%)}.top-4{top:calc(var(--spacing) * 4)}.top-6{top:calc(var(--spacing) * 6)}.top-12{top:calc(var(--spacing) * 12)}.top-14{top:calc(var(--spacing) * 14)}.top-full{top:100%}.-right-1{right:calc(var(--spacing) * -1)}.-right-1\.5{right:calc(var(--spacing) * -1.5)}.-right-2{right:calc(var(--spacing) * -2)}.-right-3{right:calc(var(--spacing) * -3)}.right-0{right:calc(var(--spacing) * 0)}.right-1{right:calc(var(--spacing) * 1)}.right-2{right:calc(var(--spacing) * 2)}.right-3{right:calc(var(--spacing) * 3)}.right-4{right:calc(var(--spacing) * 4)}.right-6{right:calc(var(--spacing) * 6)}.bottom-0{bottom:calc(var(--spacing) * 0)}.bottom-1{bottom:calc(var(--spacing) * 1)}.bottom-2{bottom:calc(var(--spacing) * 2)}.bottom-3{bottom:calc(var(--spacing) * 3)}.bottom-4{bottom:calc(var(--spacing) * 4)}.bottom-20{bottom:calc(var(--spacing) * 20)}.bottom-\[calc\(env\(safe-area-inset-bottom\)\+70px\)\]{bottom:calc(env(safe-area-inset-bottom) + 70px)}.-left-1{left:calc(var(--spacing) * -1)}.left-0{left:calc(var(--spacing) * 0)}.left-1{left:calc(var(--spacing) * 1)}.left-1\/2{left:calc(1/2 * 100%)}.left-2{left:calc(var(--spacing) * 2)}.left-6{left:calc(var(--spacing) * 6)}.z-0{z-index:0}.z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.z-60{z-index:60}.z-70{z-index:70}.z-80{z-index:80}.z-90{z-index:90}.z-95{z-index:95}.z-100{z-index:100}.z-110{z-index:110}.z-200{z-index:200}.z-9998{z-index:9998}.z-9999{z-index:9999}.z-10000{z-index:10000}.z-\[70\]{z-index:70}.z-\[80\]{z-index:80}.z-\[100\]{z-index:100}.z-\[110\]{z-index:110}.z-\[120\]{z-index:120}.z-\[200\]{z-index:200}.z-\[9999\]{z-index:9999}.col-span-2{grid-column:span 2/span 2}.col-span-3{grid-column:span 3/span 3}.container{width:100%;@media (width >= 40rem){max-width:40rem}@media (width >= 48rem){max-width:48rem}@media (width >= 64rem){max-width:64rem}@media (width >= 80rem){max-width:80rem}@media (width >= 96rem){max-width:96rem}}.mx-2{margin-inline:calc(var(--spacing) * 2)}.mx-4{margin-inline:calc(var(--spacing) * 4)}.my-1{margin-block:calc(var(--spacing) * 1)}.my-2{margin-block:calc(var(--spacing) * 2)}.my-4{margin-block:calc(var(--spacing) * 4)}.-mt-3{margin-top:calc(var(--spacing) * -3)}.mt-0{margin-top:calc(var(--spacing) * 0)}.mt-0\.5{margin-top:calc(var(--spacing) * 0.5)}.mt-1{margin-top:calc(var(--spacing) * 1)}.mt-1\.5{margin-top:calc(var(--spacing) * 1.5)}.mt-2{margin-top:calc(var(--spacing) * 2)}.mt-2\.5{margin-top:calc(var(--spacing) * 2.5)}.mt-3{margin-top:calc(var(--spacing) * 3)}.mt-4{margin-top:calc(var(--spacing) * 4)}.mt-6{margin-top:calc(var(--spacing) * 6)}.mt-10{margin-top:calc(var(--spacing) * 10)}.mt-auto{margin-top:auto}.mr-1{margin-right:calc(var(--spacing) * 1)}.mr-1\.5{margin-right:calc(var(--spacing) * 1.5)}.mr-2{margin-right:calc(var(--spacing) * 2)}.mr-3{margin-right:calc(var(--spacing) * 3)}.mr-4{margin-right:calc(var(--spacing) * 4)}.mb-0{margin-bottom:calc(var(--spacing) * 0)}.mb-0\.5{margin-bottom:calc(var(--spacing) * 0.5)}.mb-1{margin-bottom:calc(var(--spacing) * 1)}.mb-1\.5{margin-bottom:calc(var(--spacing) * 1.5)}.mb-2{margin-bottom:calc(var(--spacing) * 2)}.mb-3{margin-bottom:calc(var(--spacing) * 3)}.mb-4{margin-bottom:calc(var(--spacing) * 4)}.mb-6{margin-bottom:calc(var(--spacing) * 6)}.ml-1{margin-left:calc(var(--spacing) * 1)}.ml-1\.5{margin-left:calc(var(--spacing) * 1.5)}.ml-2{margin-left:calc(var(--spacing) * 2)}.ml-3{margin-left:calc(var(--spacing) * 3)}.ml-auto{margin-left:auto}.box-border{box-sizing:border-box}.line-clamp-1{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.line-clamp-3{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3}.block{display:block}.contents{display:contents}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.table{display:table}.aspect-square{aspect-ratio:1/1}.h-0{height:calc(var(--spacing) * 0)}.h-0\.5{height:calc(var(--spacing) * 0.5)}.h-1{height:calc(var(--spacing) * 1)}.h-1\.5{height:calc(var(--spacing) * 1.5)}.h-2{height:calc(var(--spacing) * 2)}.h-3{height:calc(var(--spacing) * 3)}.h-3\.5{height:calc(var(--spacing) * 3.5)}.h-4{height:calc(var(--spacing) * 4)}.h-5{height:calc(var(--spacing) * 5)}.h-6{height:calc(var(--spacing) * 6)}.h-7{height:calc(var(--spacing) * 7)}.h-8{height:calc(var(--spacing) * 8)}.h-9{height:calc(var(--spacing) * 9)}.h-10{height:calc(var(--spacing) * 10)}.h-11{height:calc(var(--spacing) * 11)}.h-12{height:calc(var(--spacing) * 12)}.h-16{height:calc(var(--spacing) * 16)}.h-20{height:calc(var(--spacing) * 20)}.h-24{height:calc(var(--spacing) * 24)}.h-32{height:calc(var(--spacing) * 32)}.h-64{height:calc(var(--spacing) * 64)}.h-\[34px\]{height:34px}.h-\[50vh\]{height:50vh}.h-\[52px\]{height:52px}.h-\[65vh\]{height:65vh}.h-\[80vh\]{height:80vh}.h-\[85vh\]{height:85vh}.h-\[90vh\]{height:90vh}.h-\[95vh\]{height:95vh}.h-\[200px\]{height:200px}.h-full{height:100%}.max-h-24{max-height:calc(var(--spacing) * 24)}.max-h-80{max-height:calc(var(--spacing) * 80)}.max-h-\[30vh\]{max-height:30vh}.max-h-\[50dvh\]{max-height:50dvh}.max-h-\[50vh\]{max-height:50vh}.max-h-\[60vh\]{max-height:60vh}.max-h-\[70vh\]{max-height:70vh}.max-h-\[80vh\]{max-height:80vh}.max-h-\[85vh\]{max-height:85vh}.max-h-\[90vh\]{max-height:90vh}.max-h-\[120px\]{max-height:120px}.min-h-0{min-height:calc(var(--spacing) * 0)}.min-h-\[1\.5em\]{min-height:1.5em}.min-h-\[40px\]{min-height:40px}.min-h-\[150px\]{min-height:150px}.w-2{width:calc(var(--spacing) * 2)}.w-3{width:calc(var(--spacing) * 3)}.w-4{width:calc(var(--spacing) * 4)}.w-5{width:calc(var(--spacing) * 5)}.w-6{width:calc(var(--spacing) * 6)}.w-7{width:calc(var(--spacing) * 7)}.w-8{width:calc(var(--spacing) * 8)}.w-9{width:calc(var(--spacing) * 9)}.w-10{width:calc(var(--spacing) * 10)}.w-11{width:calc(var(--spacing) * 11)}.w-12{width:calc(var(--spacing) * 12)}.w-14{width:calc(var(--spacing) * 14)}.w-16{width:calc(var(--spacing) * 16)}.w-20{width:calc(var(--spacing) * 20)}.w-24{width:calc(var(--spacing) * 24)}.w-32{width:calc(var(--spacing) * 32)}.w-64{width:calc(var(--spacing) * 64)}.w-72{width:calc(var(--spacing) * 72)}.w-\[22\%\]{width:22%}.w-\[28\%\]{width:28%}.w-\[45\%\]{width:45%}.w-\[90\%\]{width:90%}.w-\[95\%\]{width:95%}.w-\[95vw\]{width:95vw}.w-\[98vw\]{width:98vw}.w-\[260px\]{width:260px}.w-\[300px\]{width:300px}.w-\[500px\]{width:500px}.w-\[600px\]{width:600px}.w-full{width:100%}.w-px{width:1px}.max-w-2xl{max-width:var(--container-2xl)}.max-w-3xl{max-width:var(--container-3xl)}.max-w-4xl{max-width:var(--container-4xl)}.max-w-5xl{max-width:var(--container-5xl)}.max-w-6xl{max-width:var(--container-6xl)}.max-w-20{max-width:calc(var(--spacing) * 20)}.max-w-28{max-width:calc(var(--spacing) * 28)}.max-w-40{max-width:calc(var(--spacing) * 40)}.max-w-\[70px\]{max-width:70px}.max-w-\[85vw\]{max-width:85vw}.max-w-\[90vw\]{max-width:90vw}.max-w-\[150px\]{max-width:150px}.max-w-\[280px\]{max-width:280px}.max-w-full{max-width:100%}.max-w-lg{max-width:var(--container-lg)}.max-w-md{max-width:var(--container-md)}.max-w-sm{max-width:var(--container-sm)}.max-w-xl{max-width:var(--container-xl)}.max-w-xs{max-width:var(--container-xs)}.min-w-0{min-width:calc(var(--spacing) * 0)}.min-w-\[120px\]{min-width:120px}.min-w-\[140px\]{min-width:140px}.flex-1{flex:1}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.shrink-0{flex-shrink:0}.border-collapse{border-collapse:collapse}.origin-center{transform-origin:center}.-translate-x-1{--tw-translate-x:calc(var(--spacing) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.-translate-x-1\/2{--tw-translate-x:calc(calc(1/2 * 100%) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.-translate-x-full{--tw-translate-x:-100%;translate:var(--tw-translate-x) var(--tw-translate-y)}.translate-x-0{--tw-translate-x:calc(var(--spacing) * 0);translate:var(--tw-translate-x) var(--tw-translate-y)}.translate-x-full{--tw-translate-x:100%;translate:var(--tw-translate-x) var(--tw-translate-y)}.-translate-y-1{--tw-translate-y:calc(var(--spacing) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.-translate-y-1\/2{--tw-translate-y:calc(calc(1/2 * 100%) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.rotate-90{rotate:90deg}.rotate-180{rotate:180deg}.transform{transform:var(--tw-rotate-x,) var(--tw-rotate-y,) var(--tw-rotate-z,) var(--tw-skew-x,) var(--tw-skew-y,)}.animate-ping{animation:var(--animate-ping)}.animate-pulse{animation:var(--animate-pulse)}.animate-spin{animation:var(--animate-spin)}.cursor-crosshair{cursor:crosshair}.cursor-default{cursor:default}.cursor-grab{cursor:grab}.cursor-move{cursor:move}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-wait{cursor:wait}.touch-none{touch-action:none}.resize{resize:both}.resize-none{resize:none}.resize-y{resize:vertical}.list-disc{list-style-type:disc}.appearance-none{-webkit-appearance:none;appearance:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.grid-cols-\[1fr_100px\]{grid-template-columns:1fr 100px}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.content-start{align-content:flex-start}.items-center{align-items:center}.items-end{align-items:flex-end}.items-start{align-items:flex-start}.justify-around{justify-content:space-around}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.gap-0{gap:calc(var(--spacing) * 0)}.gap-0\.5{gap:calc(var(--spacing) * 0.5)}.gap-1{gap:calc(var(--spacing) * 1)}.gap-1\.5{gap:calc(var(--spacing) * 1.5)}.gap-2{gap:calc(var(--spacing) * 2)}.gap-3{gap:calc(var(--spacing) * 3)}.gap-4{gap:calc(var(--spacing) * 4)}.gap-8{gap:calc(var(--spacing) * 8)}.gap-px{gap:1px}.space-y-0{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 0) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 0) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-0\.5{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 0.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 0.5) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-1{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-1\.5{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1.5) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-2{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-3{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-4{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 4) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-6{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 6) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 6) * calc(1 - var(--tw-space-y-reverse)))}}.gap-x-1{-moz-column-gap:calc(var(--spacing) * 1);column-gap:calc(var(--spacing) * 1)}.gap-x-2{-moz-column-gap:calc(var(--spacing) * 2);column-gap:calc(var(--spacing) * 2)}.gap-x-4{-moz-column-gap:calc(var(--spacing) * 4);column-gap:calc(var(--spacing) * 4)}.space-x-0{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 0) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 0) * calc(1 - var(--tw-space-x-reverse)))}}.space-x-0\.5{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 0.5) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 0.5) * calc(1 - var(--tw-space-x-reverse)))}}.space-x-1{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 1) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 1) * calc(1 - var(--tw-space-x-reverse)))}}.space-x-2{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 2) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-x-reverse)))}}.space-x-3{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 3) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-x-reverse)))}}.space-x-4{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 4) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-x-reverse)))}}.gap-y-1{row-gap:calc(var(--spacing) * 1)}.gap-y-1\.5{row-gap:calc(var(--spacing) * 1.5)}.self-end{align-self:flex-end}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overscroll-contain{overscroll-behavior:contain}.rounded{border-radius:0.25rem}.rounded-full{border-radius:calc(infinity * 1px)}.rounded-lg{border-radius:var(--radius-lg)}.rounded-md{border-radius:var(--radius-md)}.rounded-xl{border-radius:var(--radius-xl)}.rounded-t-lg{border-top-left-radius:var(--radius-lg);border-top-right-radius:var(--radius-lg)}.rounded-t-xl{border-top-left-radius:var(--radius-xl);border-top-right-radius:var(--radius-xl)}.rounded-r{border-top-right-radius:0.25rem;border-bottom-right-radius:0.25rem}.rounded-b-lg{border-bottom-right-radius:var(--radius-lg);border-bottom-left-radius:var(--radius-lg)}.rounded-b-xl{border-bottom-right-radius:var(--radius-xl);border-bottom-left-radius:var(--radius-xl)}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-x{border-inline-style:var(--tw-border-style);border-inline-width:1px}.border-t{border-top-style:var(--tw-border-style);border-top-width:1px}.border-r{border-right-style:var(--tw-border-style);border-right-width:1px}.border-b{border-bottom-style:var(--tw-border-style);border-bottom-width:1px}.border-b-0{border-bottom-style:var(--tw-border-style);border-bottom-width:0px}.border-b-2{border-bottom-style:var(--tw-border-style);border-bottom-width:2px}.border-l{border-left-style:var(--tw-border-style);border-left-width:1px}.border-l-2{border-left-style:var(--tw-border-style);border-left-width:2px}.border-l-4{border-left-style:var(--tw-border-style);border-left-width:4px}.border-dashed{--tw-border-style:dashed;border-style:dashed}.border-\[\#373a40\]{border-color:#373a40}.border-\[\#5865f2\]{border-color:#5865f2}.border-\[\#7289da\]{border-color:#7289da}.border-\[\#18191c\]{border-color:#18191c}.border-\[\#36393f\]{border-color:#36393f}.border-\[\#40444b\]{border-color:#40444b}.border-\[\#202225\]{border-color:#202225}.border-\[\#ffd700\]{border-color:#ffd700}.border-\[rgba\(114\,137\,218\,0\.15\)\]{border-color:rgba(114,137,218,0.15)}.border-amber-300{border-color:var(--color-amber-300)}.border-amber-500{border-color:var(--color-amber-500)}.border-amber-500\/30{border-color:color-mix(in srgb,oklch(76.9% 0.188 70.08) 30%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-amber-500) 30%,transparent)}}.border-amber-500\/50{border-color:color-mix(in srgb,oklch(76.9% 0.188 70.08) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-amber-500) 50%,transparent)}}.border-amber-600{border-color:var(--color-amber-600)}.border-amber-600\/50{border-color:color-mix(in srgb,oklch(66.6% 0.179 58.318) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-amber-600) 50%,transparent)}}.border-amber-700{border-color:var(--color-amber-700)}.border-blue-500{border-color:var(--color-blue-500)}.border-blue-500\/30{border-color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 30%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-500) 30%,transparent)}}.border-blue-500\/50{border-color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-500) 50%,transparent)}}.border-blue-600{border-color:var(--color-blue-600)}.border-blue-600\/50{border-color:color-mix(in srgb,oklch(54.6% 0.245 262.881) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-600) 50%,transparent)}}.border-blue-700{border-color:var(--color-blue-700)}.border-blue-700\/30{border-color:color-mix(in srgb,oklch(48.8% 0.243 264.376) 30%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-700) 30%,transparent)}}.border-blue-700\/50{border-color:color-mix(in srgb,oklch(48.8% 0.243 264.376) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-700) 50%,transparent)}}.border-blue-900{border-color:var(--color-blue-900)}.border-blue-900\/30{border-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 30%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-900) 30%,transparent)}}.border-blue-900\/50{border-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-blue-900) 50%,transparent)}}.border-cyan-700{border-color:var(--color-cyan-700)}.border-gray-400{border-color:var(--color-gray-400)}.border-gray-400\/50{border-color:color-mix(in srgb,oklch(70.7% 0.022 261.325) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-gray-400) 50%,transparent)}}.border-gray-500{border-color:var(--color-gray-500)}.border-gray-500\/50{border-color:color-mix(in srgb,oklch(55.1% 0.027 264.364) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-gray-500) 50%,transparent)}}.border-gray-600{border-color:var(--color-gray-600)}.border-gray-600\/50{border-color:color-mix(in srgb,oklch(44.6% 0.03 256.802) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-gray-600) 50%,transparent)}}.border-gray-700{border-color:var(--color-gray-700)}.border-gray-700\/30{border-color:color-mix(in srgb,oklch(37.3% 0.034 259.733) 30%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-gray-700) 30%,transparent)}}.border-gray-700\/50{border-color:color-mix(in srgb,oklch(37.3% 0.034 259.733) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-gray-700) 50%,transparent)}}.border-green-500{border-color:var(--color-green-500)}.border-green-500\/50{border-color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}.border-green-600{border-color:var(--color-green-600)}.border-green-600\/50{border-color:color-mix(in srgb,oklch(62.7% 0.194 149.214) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-green-600) 50%,transparent)}}.border-green-700{border-color:var(--color-green-700)}.border-green-900{border-color:var(--color-green-900)}.border-green-900\/50{border-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-green-900) 50%,transparent)}}.border-indigo-700{border-color:var(--color-indigo-700)}.border-lime-700{border-color:var(--color-lime-700)}.border-orange-500{border-color:var(--color-orange-500)}.border-orange-500\/50{border-color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-orange-500) 50%,transparent)}}.border-orange-700{border-color:var(--color-orange-700)}.border-pink-700{border-color:var(--color-pink-700)}.border-purple-500{border-color:var(--color-purple-500)}.border-purple-500\/50{border-color:color-mix(in srgb,oklch(62.7% 0.265 303.9) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-purple-500) 50%,transparent)}}.border-purple-600{border-color:var(--color-purple-600)}.border-purple-600\/50{border-color:color-mix(in srgb,oklch(55.8% 0.288 302.321) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-purple-600) 50%,transparent)}}.border-purple-700{border-color:var(--color-purple-700)}.border-red-500{border-color:var(--color-red-500)}.border-red-500\/50{border-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-red-500) 50%,transparent)}}.border-red-600{border-color:var(--color-red-600)}.border-red-600\/50{border-color:color-mix(in srgb,oklch(57.7% 0.245 27.325) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-red-600) 50%,transparent)}}.border-red-600\/60{border-color:color-mix(in srgb,oklch(57.7% 0.245 27.325) 60%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-red-600) 60%,transparent)}}.border-red-700{border-color:var(--color-red-700)}.border-red-800{border-color:var(--color-red-800)}.border-red-800\/50{border-color:color-mix(in srgb,oklch(44.4% 0.177 26.899) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-red-800) 50%,transparent)}}.border-sky-700{border-color:var(--color-sky-700)}.border-teal-700{border-color:var(--color-teal-700)}.border-transparent{border-color:transparent}.border-violet-700{border-color:var(--color-violet-700)}.border-white{border-color:var(--color-white)}.border-yellow-500{border-color:var(--color-yellow-500)}.border-yellow-500\/30{border-color:color-mix(in srgb,oklch(79.5% 0.184 86.047) 30%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-yellow-500) 30%,transparent)}}.border-yellow-500\/50{border-color:color-mix(in srgb,oklch(79.5% 0.184 86.047) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-yellow-500) 50%,transparent)}}.border-yellow-700{border-color:var(--color-yellow-700)}.border-yellow-900{border-color:var(--color-yellow-900)}.border-yellow-900\/50{border-color:color-mix(in srgb,oklch(42.1% 0.095 57.708) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-yellow-900) 50%,transparent)}}.bg-\[\#1a1b1e\]{background-color:#1a1b1e}.bg-\[\#1a1b1e\]\/95{background-color:color-mix(in oklab,#1a1b1e 95%,transparent)}.bg-\[\#1e1f22\]{background-color:#1e1f22}.bg-\[\#2c2e33\]{background-color:#2c2e33}.bg-\[\#2f3136\]{background-color:#2f3136}.bg-\[\#2f3136\]\/50{background-color:color-mix(in oklab,#2f3136 50%,transparent)}.bg-\[\#2f3136\]\/90{background-color:color-mix(in oklab,#2f3136 90%,transparent)}.bg-\[\#2f3136\]\/95{background-color:color-mix(in oklab,#2f3136 95%,transparent)}.bg-\[\#3ba55c\]{background-color:#3ba55c}.bg-\[\#4caf50\]{background-color:#4caf50}.bg-\[\#4f545c\]{background-color:#4f545c}.bg-\[\#373a40\]{background-color:#373a40}.bg-\[\#5865F2\]{background-color:#5865F2}.bg-\[\#5865F2\]\/20{background-color:color-mix(in oklab,#5865F2 20%,transparent)}.bg-\[\#5865f2\]{background-color:#5865f2}.bg-\[\#5865f2\]\/10{background-color:color-mix(in oklab,#5865f2 10%,transparent)}.bg-\[\#5865f2\]\/20{background-color:color-mix(in oklab,#5865f2 20%,transparent)}.bg-\[\#7289da\]{background-color:#7289da}.bg-\[\#25262b\]{background-color:#25262b}.bg-\[\#36393f\]{background-color:#36393f}.bg-\[\#40444b\]{background-color:#40444b}.bg-\[\#40444b\]\/50{background-color:color-mix(in oklab,#40444b 50%,transparent)}.bg-\[\#202225\]{background-color:#202225}.bg-\[\#202225\]\/50{background-color:color-mix(in oklab,#202225 50%,transparent)}.bg-\[\#202225\]\/60{background-color:color-mix(in oklab,#202225 60%,transparent)}.bg-\[\#202225\]\/80{background-color:color-mix(in oklab,#202225 80%,transparent)}.bg-\[\#202225\]\/95{background-color:color-mix(in oklab,#202225 95%,transparent)}.bg-\[\#ed4245\]{background-color:#ed4245}.bg-\[rgba\(20\,22\,28\,0\.8\)\]{background-color:rgba(20,22,28,0.8)}.bg-amber-200{background-color:var(--color-amber-200)}.bg-amber-400{background-color:var(--color-amber-400)}.bg-amber-400\/20{background-color:color-mix(in srgb,oklch(82.8% 0.189 84.429) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-400) 20%,transparent)}}.bg-amber-500{background-color:var(--color-amber-500)}.bg-amber-500\/10{background-color:color-mix(in srgb,oklch(76.9% 0.188 70.08) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-500) 10%,transparent)}}.bg-amber-500\/20{background-color:color-mix(in srgb,oklch(76.9% 0.188 70.08) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-500) 20%,transparent)}}.bg-amber-600{background-color:var(--color-amber-600)}.bg-amber-600\/20{background-color:color-mix(in srgb,oklch(66.6% 0.179 58.318) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-600) 20%,transparent)}}.bg-amber-600\/30{background-color:color-mix(in srgb,oklch(66.6% 0.179 58.318) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-600) 30%,transparent)}}.bg-amber-700{background-color:var(--color-amber-700)}.bg-amber-900{background-color:var(--color-amber-900)}.bg-amber-900\/10{background-color:color-mix(in srgb,oklch(41.4% 0.112 45.904) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-900) 10%,transparent)}}.bg-amber-900\/90{background-color:color-mix(in srgb,oklch(41.4% 0.112 45.904) 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-900) 90%,transparent)}}.bg-black{background-color:var(--color-black)}.bg-black\/30{background-color:color-mix(in srgb,#000 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 30%,transparent)}}.bg-black\/40{background-color:color-mix(in srgb,#000 40%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 40%,transparent)}}.bg-black\/50{background-color:color-mix(in srgb,#000 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 50%,transparent)}}.bg-black\/60{background-color:color-mix(in srgb,#000 60%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 60%,transparent)}}.bg-black\/70{background-color:color-mix(in srgb,#000 70%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 70%,transparent)}}.bg-black\/80{background-color:color-mix(in srgb,#000 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 80%,transparent)}}.bg-black\/90{background-color:color-mix(in srgb,#000 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 90%,transparent)}}.bg-black\/95{background-color:color-mix(in srgb,#000 95%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 95%,transparent)}}.bg-blue-500{background-color:var(--color-blue-500)}.bg-blue-500\/10{background-color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-500) 10%,transparent)}}.bg-blue-500\/20{background-color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-500) 20%,transparent)}}.bg-blue-600{background-color:var(--color-blue-600)}.bg-blue-600\/30{background-color:color-mix(in srgb,oklch(54.6% 0.245 262.881) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-600) 30%,transparent)}}.bg-blue-600\/50{background-color:color-mix(in srgb,oklch(54.6% 0.245 262.881) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-600) 50%,transparent)}}.bg-blue-600\/80{background-color:color-mix(in srgb,oklch(54.6% 0.245 262.881) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-600) 80%,transparent)}}.bg-blue-700{background-color:var(--color-blue-700)}.bg-blue-900{background-color:var(--color-blue-900)}.bg-blue-900\/10{background-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-900) 10%,transparent)}}.bg-blue-900\/20{background-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-900) 20%,transparent)}}.bg-blue-900\/30{background-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-900) 30%,transparent)}}.bg-blue-900\/50{background-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-900) 50%,transparent)}}.bg-blue-900\/80{background-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-900) 80%,transparent)}}.bg-blue-900\/90{background-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-900) 90%,transparent)}}.bg-cyan-400{background-color:var(--color-cyan-400)}.bg-cyan-600{background-color:var(--color-cyan-600)}.bg-cyan-600\/20{background-color:color-mix(in srgb,oklch(60.9% 0.126 221.723) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-cyan-600) 20%,transparent)}}.bg-cyan-700{background-color:var(--color-cyan-700)}.bg-cyan-800{background-color:var(--color-cyan-800)}.bg-cyan-900{background-color:var(--color-cyan-900)}.bg-emerald-700{background-color:var(--color-emerald-700)}.bg-emerald-900{background-color:var(--color-emerald-900)}.bg-fuchsia-700{background-color:var(--color-fuchsia-700)}.bg-gray-500{background-color:var(--color-gray-500)}.bg-gray-500\/20{background-color:color-mix(in srgb,oklch(55.1% 0.027 264.364) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-500) 20%,transparent)}}.bg-gray-600{background-color:var(--color-gray-600)}.bg-gray-600\/30{background-color:color-mix(in srgb,oklch(44.6% 0.03 256.802) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-600) 30%,transparent)}}.bg-gray-700{background-color:var(--color-gray-700)}.bg-gray-700\/30{background-color:color-mix(in srgb,oklch(37.3% 0.034 259.733) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-700) 30%,transparent)}}.bg-gray-700\/50{background-color:color-mix(in srgb,oklch(37.3% 0.034 259.733) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-700) 50%,transparent)}}.bg-gray-800{background-color:var(--color-gray-800)}.bg-gray-800\/10{background-color:color-mix(in srgb,oklch(27.8% 0.033 256.848) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-800) 10%,transparent)}}.bg-gray-800\/30{background-color:color-mix(in srgb,oklch(27.8% 0.033 256.848) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-800) 30%,transparent)}}.bg-gray-800\/50{background-color:color-mix(in srgb,oklch(27.8% 0.033 256.848) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-800) 50%,transparent)}}.bg-gray-800\/90{background-color:color-mix(in srgb,oklch(27.8% 0.033 256.848) 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-800) 90%,transparent)}}.bg-gray-900{background-color:var(--color-gray-900)}.bg-gray-900\/10{background-color:color-mix(in srgb,oklch(21% 0.034 264.665) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-900) 10%,transparent)}}.bg-green-500{background-color:var(--color-green-500)}.bg-green-500\/10{background-color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-500) 10%,transparent)}}.bg-green-500\/20{background-color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-500) 20%,transparent)}}.bg-green-500\/50{background-color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}.bg-green-600{background-color:var(--color-green-600)}.bg-green-600\/30{background-color:color-mix(in srgb,oklch(62.7% 0.194 149.214) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-600) 30%,transparent)}}.bg-green-700{background-color:var(--color-green-700)}.bg-green-700\/80{background-color:color-mix(in srgb,oklch(52.7% 0.154 150.069) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-700) 80%,transparent)}}.bg-green-900{background-color:var(--color-green-900)}.bg-green-900\/10{background-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-900) 10%,transparent)}}.bg-green-900\/30{background-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-900) 30%,transparent)}}.bg-green-900\/40{background-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 40%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-900) 40%,transparent)}}.bg-green-900\/50{background-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-900) 50%,transparent)}}.bg-green-900\/80{background-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-900) 80%,transparent)}}.bg-green-900\/90{background-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-green-900) 90%,transparent)}}.bg-indigo-600{background-color:var(--color-indigo-600)}.bg-indigo-700{background-color:var(--color-indigo-700)}.bg-indigo-900{background-color:var(--color-indigo-900)}.bg-lime-700{background-color:var(--color-lime-700)}.bg-lime-900{background-color:var(--color-lime-900)}.bg-orange-500{background-color:var(--color-orange-500)}.bg-orange-500\/20{background-color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-orange-500) 20%,transparent)}}.bg-orange-700{background-color:var(--color-orange-700)}.bg-orange-800{background-color:var(--color-orange-800)}.bg-orange-900{background-color:var(--color-orange-900)}.bg-orange-900\/15{background-color:color-mix(in srgb,oklch(40.8% 0.123 38.172) 15%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-orange-900) 15%,transparent)}}.bg-orange-900\/50{background-color:color-mix(in srgb,oklch(40.8% 0.123 38.172) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-orange-900) 50%,transparent)}}.bg-pink-500{background-color:var(--color-pink-500)}.bg-pink-600{background-color:var(--color-pink-600)}.bg-pink-700{background-color:var(--color-pink-700)}.bg-pink-900{background-color:var(--color-pink-900)}.bg-purple-500{background-color:var(--color-purple-500)}.bg-purple-500\/10{background-color:color-mix(in srgb,oklch(62.7% 0.265 303.9) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-500) 10%,transparent)}}.bg-purple-500\/20{background-color:color-mix(in srgb,oklch(62.7% 0.265 303.9) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-500) 20%,transparent)}}.bg-purple-600{background-color:var(--color-purple-600)}.bg-purple-700{background-color:var(--color-purple-700)}.bg-purple-800{background-color:var(--color-purple-800)}.bg-purple-900{background-color:var(--color-purple-900)}.bg-purple-900\/10{background-color:color-mix(in srgb,oklch(38.1% 0.176 304.987) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-900) 10%,transparent)}}.bg-purple-900\/20{background-color:color-mix(in srgb,oklch(38.1% 0.176 304.987) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-900) 20%,transparent)}}.bg-purple-900\/30{background-color:color-mix(in srgb,oklch(38.1% 0.176 304.987) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-900) 30%,transparent)}}.bg-purple-900\/50{background-color:color-mix(in srgb,oklch(38.1% 0.176 304.987) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-900) 50%,transparent)}}.bg-red-500{background-color:var(--color-red-500)}.bg-red-500\/20{background-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-500) 20%,transparent)}}.bg-red-600{background-color:var(--color-red-600)}.bg-red-600\/20{background-color:color-mix(in srgb,oklch(57.7% 0.245 27.325) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-600) 20%,transparent)}}.bg-red-700{background-color:var(--color-red-700)}.bg-red-800{background-color:var(--color-red-800)}.bg-red-800\/80{background-color:color-mix(in srgb,oklch(44.4% 0.177 26.899) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-800) 80%,transparent)}}.bg-red-900{background-color:var(--color-red-900)}.bg-red-900\/10{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 10%,transparent)}}.bg-red-900\/20{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 20%,transparent)}}.bg-red-900\/30{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 30%,transparent)}}.bg-red-900\/40{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 40%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 40%,transparent)}}.bg-red-900\/50{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 50%,transparent)}}.bg-red-900\/80{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 80%,transparent)}}.bg-red-900\/90{background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 90%,transparent)}}.bg-red-950{background-color:var(--color-red-950)}.bg-red-950\/20{background-color:color-mix(in srgb,oklch(25.8% 0.092 26.042) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-950) 20%,transparent)}}.bg-rose-600{background-color:var(--color-rose-600)}.bg-rose-700{background-color:var(--color-rose-700)}.bg-rose-900{background-color:var(--color-rose-900)}.bg-sky-900{background-color:var(--color-sky-900)}.bg-slate-900{background-color:var(--color-slate-900)}.bg-stone-900{background-color:var(--color-stone-900)}.bg-teal-700{background-color:var(--color-teal-700)}.bg-teal-800{background-color:var(--color-teal-800)}.bg-teal-900{background-color:var(--color-teal-900)}.bg-transparent{background-color:transparent}.bg-violet-700{background-color:var(--color-violet-700)}.bg-violet-900{background-color:var(--color-violet-900)}.bg-white{background-color:var(--color-white)}.bg-white\/10{background-color:color-mix(in srgb,#fff 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-white) 10%,transparent)}}.bg-yellow-500{background-color:var(--color-yellow-500)}.bg-yellow-600{background-color:var(--color-yellow-600)}.bg-yellow-700{background-color:var(--color-yellow-700)}.bg-yellow-900{background-color:var(--color-yellow-900)}.bg-yellow-900\/10{background-color:color-mix(in srgb,oklch(42.1% 0.095 57.708) 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-yellow-900) 10%,transparent)}}.bg-yellow-900\/20{background-color:color-mix(in srgb,oklch(42.1% 0.095 57.708) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-yellow-900) 20%,transparent)}}.bg-yellow-900\/50{background-color:color-mix(in srgb,oklch(42.1% 0.095 57.708) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-yellow-900) 50%,transparent)}}.bg-yellow-900\/80{background-color:color-mix(in srgb,oklch(42.1% 0.095 57.708) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-yellow-900) 80%,transparent)}}.bg-yellow-900\/90{background-color:color-mix(in srgb,oklch(42.1% 0.095 57.708) 90%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-yellow-900) 90%,transparent)}}.bg-linear-to-b{--tw-gradient-position:to bottom;@supports (background-image:linear-gradient(in lab,red,red)){--tw-gradient-position:to bottom in oklab}background-image:linear-gradient(var(--tw-gradient-stops))}.bg-linear-to-r{--tw-gradient-position:to right;@supports (background-image:linear-gradient(in lab,red,red)){--tw-gradient-position:to right in oklab}background-image:linear-gradient(var(--tw-gradient-stops))}.bg-gradient-to-r{--tw-gradient-position:to right in oklab;background-image:linear-gradient(var(--tw-gradient-stops))}.from-\[\#202225\]{--tw-gradient-from:#202225;--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-amber-600{--tw-gradient-from:var(--color-amber-600);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-blue-600{--tw-gradient-from:var(--color-blue-600);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-blue-900{--tw-gradient-from:var(--color-blue-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-blue-900\/40{--tw-gradient-from:color-mix(in srgb,oklch(37.9% 0.146 265.522) 40%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-from:color-mix(in oklab,var(--color-blue-900) 40%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-gray-800{--tw-gradient-from:var(--color-gray-800);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-green-600{--tw-gradient-from:var(--color-green-600);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-green-900{--tw-gradient-from:var(--color-green-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-green-900\/40{--tw-gradient-from:color-mix(in srgb,oklch(39.3% 0.095 152.535) 40%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-from:color-mix(in oklab,var(--color-green-900) 40%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-purple-900{--tw-gradient-from:var(--color-purple-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-purple-900\/30{--tw-gradient-from:color-mix(in srgb,oklch(38.1% 0.176 304.987) 30%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-from:color-mix(in oklab,var(--color-purple-900) 30%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-red-600{--tw-gradient-from:var(--color-red-600);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-red-700{--tw-gradient-from:var(--color-red-700);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-red-800{--tw-gradient-from:var(--color-red-800);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-red-900{--tw-gradient-from:var(--color-red-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-red-900\/60{--tw-gradient-from:color-mix(in srgb,oklch(39.6% 0.141 25.723) 60%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-from:color-mix(in oklab,var(--color-red-900) 60%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-yellow-900{--tw-gradient-from:var(--color-yellow-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.from-yellow-900\/50{--tw-gradient-from:color-mix(in srgb,oklch(42.1% 0.095 57.708) 50%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-from:color-mix(in oklab,var(--color-yellow-900) 50%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-\[\#2f3136\]{--tw-gradient-to:#2f3136;--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-amber-800{--tw-gradient-to:var(--color-amber-800);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-amber-800\/30{--tw-gradient-to:color-mix(in srgb,oklch(47.3% 0.137 46.201) 30%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-to:color-mix(in oklab,var(--color-amber-800) 30%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-cyan-500{--tw-gradient-to:var(--color-cyan-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-emerald-500{--tw-gradient-to:var(--color-emerald-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-gray-700{--tw-gradient-to:var(--color-gray-700);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-orange-500{--tw-gradient-to:var(--color-orange-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-pink-900{--tw-gradient-to:var(--color-pink-900);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-pink-900\/30{--tw-gradient-to:color-mix(in srgb,oklch(40.8% 0.153 2.432) 30%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-gradient-to:color-mix(in oklab,var(--color-pink-900) 30%,transparent)}--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-red-500{--tw-gradient-to:var(--color-red-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-red-600{--tw-gradient-to:var(--color-red-600);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-transparent{--tw-gradient-to:transparent;--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.to-yellow-500{--tw-gradient-to:var(--color-yellow-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}.object-contain{object-fit:contain}.object-cover{object-fit:cover}.object-fill{object-fit:fill}.p-0{padding:calc(var(--spacing) * 0)}.p-0\.5{padding:calc(var(--spacing) * 0.5)}.p-1{padding:calc(var(--spacing) * 1)}.p-1\.5{padding:calc(var(--spacing) * 1.5)}.p-2{padding:calc(var(--spacing) * 2)}.p-2\.5{padding:calc(var(--spacing) * 2.5)}.p-3{padding:calc(var(--spacing) * 3)}.p-4{padding:calc(var(--spacing) * 4)}.p-6{padding:calc(var(--spacing) * 6)}.p-8{padding:calc(var(--spacing) * 8)}.p-px{padding:1px}.px-1{padding-inline:calc(var(--spacing) * 1)}.px-1\.5{padding-inline:calc(var(--spacing) * 1.5)}.px-2{padding-inline:calc(var(--spacing) * 2)}.px-2\.5{padding-inline:calc(var(--spacing) * 2.5)}.px-3{padding-inline:calc(var(--spacing) * 3)}.px-4{padding-inline:calc(var(--spacing) * 4)}.px-6{padding-inline:calc(var(--spacing) * 6)}.py-0{padding-block:calc(var(--spacing) * 0)}.py-0\.5{padding-block:calc(var(--spacing) * 0.5)}.py-1{padding-block:calc(var(--spacing) * 1)}.py-1\.5{padding-block:calc(var(--spacing) * 1.5)}.py-2{padding-block:calc(var(--spacing) * 2)}.py-2\.5{padding-block:calc(var(--spacing) * 2.5)}.py-3{padding-block:calc(var(--spacing) * 3)}.py-4{padding-block:calc(var(--spacing) * 4)}.py-6{padding-block:calc(var(--spacing) * 6)}.py-8{padding-block:calc(var(--spacing) * 8)}.py-12{padding-block:calc(var(--spacing) * 12)}.pt-0{padding-top:calc(var(--spacing) * 0)}.pt-0\.5{padding-top:calc(var(--spacing) * 0.5)}.pt-1{padding-top:calc(var(--spacing) * 1)}.pt-1\.5{padding-top:calc(var(--spacing) * 1.5)}.pt-2{padding-top:calc(var(--spacing) * 2)}.pt-3{padding-top:calc(var(--spacing) * 3)}.pt-4{padding-top:calc(var(--spacing) * 4)}.pt-\[max\(1\.5rem\,env\(safe-area-inset-top\)\)\]{padding-top:max(1.5rem,env(safe-area-inset-top))}.pr-1{padding-right:calc(var(--spacing) * 1)}.pr-2{padding-right:calc(var(--spacing) * 2)}.pr-4{padding-right:calc(var(--spacing) * 4)}.pr-8{padding-right:calc(var(--spacing) * 8)}.pr-12{padding-right:calc(var(--spacing) * 12)}.pb-0{padding-bottom:calc(var(--spacing) * 0)}.pb-1{padding-bottom:calc(var(--spacing) * 1)}.pb-2{padding-bottom:calc(var(--spacing) * 2)}.pb-3{padding-bottom:calc(var(--spacing) * 3)}.pb-4{padding-bottom:calc(var(--spacing) * 4)}.pl-3{padding-left:calc(var(--spacing) * 3)}.text-center{text-align:center}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:var(--font-mono)}.font-sans{font-family:var(--font-sans)}.text-2xl{font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}.text-3xl{font-size:var(--text-3xl);line-height:var(--tw-leading,var(--text-3xl--line-height))}.text-4xl{font-size:var(--text-4xl);line-height:var(--tw-leading,var(--text-4xl--line-height))}.text-5xl{font-size:var(--text-5xl);line-height:var(--tw-leading,var(--text-5xl--line-height))}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.text-\[8px\]{font-size:8px}.text-\[9px\]{font-size:9px}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.leading-none{--tw-leading:1;line-height:1}.leading-relaxed{--tw-leading:var(--leading-relaxed);line-height:var(--leading-relaxed)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.tracking-wider{--tw-tracking:var(--tracking-wider);letter-spacing:var(--tracking-wider)}.tracking-widest{--tw-tracking:var(--tracking-widest);letter-spacing:var(--tracking-widest)}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.text-\[\#4caf50\]{color:#4caf50}.text-\[\#5865f2\]{color:#5865f2}.text-\[\#7289da\]{color:#7289da}.text-\[\#f44336\]{color:#f44336}.text-\[\#ffd700\]{color:#ffd700}.text-amber-100{color:var(--color-amber-100)}.text-amber-200{color:var(--color-amber-200)}.text-amber-200\/80{color:color-mix(in srgb,oklch(92.4% 0.12 95.746) 80%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-amber-200) 80%,transparent)}}.text-amber-300{color:var(--color-amber-300)}.text-amber-400{color:var(--color-amber-400)}.text-amber-500{color:var(--color-amber-500)}.text-blue-100{color:var(--color-blue-100)}.text-blue-200{color:var(--color-blue-200)}.text-blue-300{color:var(--color-blue-300)}.text-blue-400{color:var(--color-blue-400)}.text-blue-500{color:var(--color-blue-500)}.text-blue-500\/70{color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 70%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-blue-500) 70%,transparent)}}.text-cyan-400{color:var(--color-cyan-400)}.text-emerald-400{color:var(--color-emerald-400)}.text-gray-100{color:var(--color-gray-100)}.text-gray-200{color:var(--color-gray-200)}.text-gray-300{color:var(--color-gray-300)}.text-gray-400{color:var(--color-gray-400)}.text-gray-500{color:var(--color-gray-500)}.text-gray-600{color:var(--color-gray-600)}.text-green-100{color:var(--color-green-100)}.text-green-200{color:var(--color-green-200)}.text-green-300{color:var(--color-green-300)}.text-green-400{color:var(--color-green-400)}.text-green-400\/70{color:color-mix(in srgb,oklch(79.2% 0.209 151.711) 70%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-green-400) 70%,transparent)}}.text-green-500{color:var(--color-green-500)}.text-green-500\/70{color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 70%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-green-500) 70%,transparent)}}.text-indigo-400{color:var(--color-indigo-400)}.text-lime-400{color:var(--color-lime-400)}.text-orange-400{color:var(--color-orange-400)}.text-orange-500{color:var(--color-orange-500)}.text-orange-500\/70{color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 70%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-orange-500) 70%,transparent)}}.text-pink-300{color:var(--color-pink-300)}.text-pink-400{color:var(--color-pink-400)}.text-pink-500{color:var(--color-pink-500)}.text-purple-300{color:var(--color-purple-300)}.text-purple-400{color:var(--color-purple-400)}.text-red-200{color:var(--color-red-200)}.text-red-300{color:var(--color-red-300)}.text-red-400{color:var(--color-red-400)}.text-red-500{color:var(--color-red-500)}.text-rose-400{color:var(--color-rose-400)}.text-sky-400{color:var(--color-sky-400)}.text-slate-400{color:var(--color-slate-400)}.text-stone-400{color:var(--color-stone-400)}.text-teal-400{color:var(--color-teal-400)}.text-violet-400{color:var(--color-violet-400)}.text-white{color:var(--color-white)}.text-white\/60{color:color-mix(in srgb,#fff 60%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 60%,transparent)}}.text-white\/80{color:color-mix(in srgb,#fff 80%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 80%,transparent)}}.text-yellow-200{color:var(--color-yellow-200)}.text-yellow-300{color:var(--color-yellow-300)}.text-yellow-400{color:var(--color-yellow-400)}.text-yellow-500{color:var(--color-yellow-500)}.text-yellow-600{color:var(--color-yellow-600)}.capitalize{text-transform:capitalize}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.italic{font-style:italic}.line-through{text-decoration-line:line-through}.underline{text-decoration-line:underline}.decoration-gray-500{text-decoration-color:var(--color-gray-500)}.placeholder-gray-400{&::placeholder{color:var(--color-gray-400)}}.placeholder-gray-500{&::placeholder{color:var(--color-gray-500)}}.placeholder-gray-600{&::placeholder{color:var(--color-gray-600)}}.accent-blue-500{accent-color:var(--color-blue-500)}.accent-green-500{accent-color:var(--color-green-500)}.opacity-0{opacity:0%}.opacity-25{opacity:25%}.opacity-40{opacity:40%}.opacity-50{opacity:50%}.opacity-60{opacity:60%}.opacity-70{opacity:70%}.opacity-75{opacity:75%}.opacity-100{opacity:100%}.shadow{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px var(--tw-shadow-color,rgb(0 0 0/0.25));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\[0_-4px_6px_-1px_rgba\(0\,0\,0\,0\.3\)\]{--tw-shadow:0 -4px 6px -1px var(--tw-shadow-color,rgba(0,0,0,0.3));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\[0_0_10px_rgba\(255\,255\,255\,0\.8\)\]{--tw-shadow:0 0 10px var(--tw-shadow-color,rgba(255,255,255,0.8));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\[0_0_15px_rgba\(251\,191\,36\,0\.3\)\]{--tw-shadow:0 0 15px var(--tw-shadow-color,rgba(251,191,36,0.3));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\[0_0_20px_rgba\(251\,191\,36\,0\.6\)\]{--tw-shadow:0 0 20px var(--tw-shadow-color,rgba(251,191,36,0.6));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 var(--tw-shadow-color,rgb(0 0 0/0.05));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 4px 6px -4px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 2px 4px -2px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 8px 10px -6px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-1{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-2{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-\[\#5865f2\]{--tw-ring-color:#5865f2}.ring-blue-500{--tw-ring-color:var(--color-blue-500)}.ring-blue-500\/50{--tw-ring-color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 50%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-ring-color:color-mix(in oklab,var(--color-blue-500) 50%,transparent)}}.ring-blue-900{--tw-ring-color:var(--color-blue-900)}.ring-blue-900\/30{--tw-ring-color:color-mix(in srgb,oklch(37.9% 0.146 265.522) 30%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-ring-color:color-mix(in oklab,var(--color-blue-900) 30%,transparent)}}.ring-green-500{--tw-ring-color:var(--color-green-500)}.ring-green-500\/50{--tw-ring-color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-ring-color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}.ring-green-900{--tw-ring-color:var(--color-green-900)}.ring-green-900\/30{--tw-ring-color:color-mix(in srgb,oklch(39.3% 0.095 152.535) 30%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-ring-color:color-mix(in oklab,var(--color-green-900) 30%,transparent)}}.ring-red-500{--tw-ring-color:var(--color-red-500)}.ring-red-500\/50{--tw-ring-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 50%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-ring-color:color-mix(in oklab,var(--color-red-500) 50%,transparent)}}.ring-yellow-400{--tw-ring-color:var(--color-yellow-400)}.ring-yellow-400\/50{--tw-ring-color:color-mix(in srgb,oklch(85.2% 0.199 91.936) 50%,transparent);@supports (color:color-mix(in lab,red,red)){--tw-ring-color:color-mix(in oklab,var(--color-yellow-400) 50%,transparent)}}.outline{outline-style:var(--tw-outline-style);outline-width:1px}.blur{--tw-blur:blur(8px);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.drop-shadow-lg{--tw-drop-shadow-size:drop-shadow(0 4px 4px var(--tw-drop-shadow-color,rgb(0 0 0/0.15)));--tw-drop-shadow:drop-shadow(var(--drop-shadow-lg));filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.grayscale{--tw-grayscale:grayscale(100%);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.invert{--tw-invert:invert(100%);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.backdrop-blur-sm{--tw-backdrop-blur:blur(var(--blur-sm));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-filter{backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-transform{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-75{--tw-duration:75ms;transition-duration:75ms}.duration-200{--tw-duration:200ms;transition-duration:200ms}.duration-300{--tw-duration:300ms;transition-duration:300ms}.ease-in-out{--tw-ease:var(--ease-in-out);transition-timing-function:var(--ease-in-out)}.ease-out{--tw-ease:var(--ease-out);transition-timing-function:var(--ease-out)}.outline-none{--tw-outline-style:none;outline-style:none}.select-none{-webkit-user-select:none;user-select:none}.select-text{-webkit-user-select:text;user-select:text}.group-hover\:translate-x-1{&:is(:where(.group):hover *){@media (hover:hover){--tw-translate-x:calc(var(--spacing) * 1);translate:var(--tw-translate-x) var(--tw-translate-y)}}}.group-hover\:border-gray-500{&:is(:where(.group):hover *){@media (hover:hover){border-color:var(--color-gray-500)}}}.group-hover\:text-gray-400{&:is(:where(.group):hover *){@media (hover:hover){color:var(--color-gray-400)}}}.group-hover\:text-white{&:is(:where(.group):hover *){@media (hover:hover){color:var(--color-white)}}}.group-hover\:opacity-100{&:is(:where(.group):hover *){@media (hover:hover){opacity:100%}}}.marker\:text-blue-500\/50{& *::marker{color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-blue-500) 50%,transparent)}}&::marker{color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-blue-500) 50%,transparent)}}& *::-webkit-details-marker{color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-blue-500) 50%,transparent)}}&::-webkit-details-marker{color:color-mix(in srgb,oklch(62.3% 0.214 259.815) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-blue-500) 50%,transparent)}}}.marker\:text-green-500\/50{& *::marker{color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}&::marker{color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}& *::-webkit-details-marker{color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}&::-webkit-details-marker{color:color-mix(in srgb,oklch(72.3% 0.219 149.579) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-green-500) 50%,transparent)}}}.marker\:text-orange-500\/50{& *::marker{color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-orange-500) 50%,transparent)}}&::marker{color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-orange-500) 50%,transparent)}}& *::-webkit-details-marker{color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-orange-500) 50%,transparent)}}&::-webkit-details-marker{color:color-mix(in srgb,oklch(70.5% 0.213 47.604) 50%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-orange-500) 50%,transparent)}}}.first\:rounded-l{&:first-child{border-top-left-radius:0.25rem;border-bottom-left-radius:0.25rem}}.last\:rounded-r{&:last-child{border-top-right-radius:0.25rem;border-bottom-right-radius:0.25rem}}.last\:border-b-0{&:last-child{border-bottom-style:var(--tw-border-style);border-bottom-width:0px}}.hover\:-translate-y-1{&:hover{@media (hover:hover){--tw-translate-y:calc(var(--spacing) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}}}.hover\:scale-105{&:hover{@media (hover:hover){--tw-scale-x:105%;--tw-scale-y:105%;--tw-scale-z:105%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-110{&:hover{@media (hover:hover){--tw-scale-x:110%;--tw-scale-y:110%;--tw-scale-z:110%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:border-\[\#5865f2\]\/50{&:hover{@media (hover:hover){border-color:color-mix(in oklab,#5865f2 50%,transparent)}}}.hover\:border-\[\#7289da\]{&:hover{@media (hover:hover){border-color:#7289da}}}.hover\:border-amber-500{&:hover{@media (hover:hover){border-color:var(--color-amber-500)}}}.hover\:border-amber-500\/50{&:hover{@media (hover:hover){border-color:color-mix(in srgb,oklch(76.9% 0.188 70.08) 50%,transparent);@supports (color:color-mix(in lab,red,red)){border-color:color-mix(in oklab,var(--color-amber-500) 50%,transparent)}}}}.hover\:border-blue-500{&:hover{@media (hover:hover){border-color:var(--color-blue-500)}}}.hover\:border-gray-500{&:hover{@media (hover:hover){border-color:var(--color-gray-500)}}}.hover\:border-green-500{&:hover{@media (hover:hover){border-color:var(--color-green-500)}}}.hover\:border-purple-400{&:hover{@media (hover:hover){border-color:var(--color-purple-400)}}}.hover\:border-red-500{&:hover{@media (hover:hover){border-color:var(--color-red-500)}}}.hover\:border-yellow-500{&:hover{@media (hover:hover){border-color:var(--color-yellow-500)}}}.hover\:bg-\[\#2d7d46\]{&:hover{@media (hover:hover){background-color:#2d7d46}}}.hover\:bg-\[\#4a4e54\]{&:hover{@media (hover:hover){background-color:#4a4e54}}}.hover\:bg-\[\#4a4f57\]{&:hover{@media (hover:hover){background-color:#4a4f57}}}.hover\:bg-\[\#4f545c\]{&:hover{@media (hover:hover){background-color:#4f545c}}}.hover\:bg-\[\#5b6eae\]{&:hover{@media (hover:hover){background-color:#5b6eae}}}.hover\:bg-\[\#5d6269\]{&:hover{@media (hover:hover){background-color:#5d6269}}}.hover\:bg-\[\#4752C4\]{&:hover{@media (hover:hover){background-color:#4752C4}}}.hover\:bg-\[\#4752c4\]{&:hover{@media (hover:hover){background-color:#4752c4}}}.hover\:bg-\[\#5865f2\]{&:hover{@media (hover:hover){background-color:#5865f2}}}.hover\:bg-\[\#7289da\]{&:hover{@media (hover:hover){background-color:#7289da}}}.hover\:bg-\[\#36393f\]{&:hover{@media (hover:hover){background-color:#36393f}}}.hover\:bg-\[\#40444b\]{&:hover{@media (hover:hover){background-color:#40444b}}}.hover\:bg-\[\#40444b\]\/50{&:hover{@media (hover:hover){background-color:color-mix(in oklab,#40444b 50%,transparent)}}}.hover\:bg-\[\#50555e\]{&:hover{@media (hover:hover){background-color:#50555e}}}.hover\:bg-\[\#404449\]{&:hover{@media (hover:hover){background-color:#404449}}}.hover\:bg-\[\#c03537\]{&:hover{@media (hover:hover){background-color:#c03537}}}.hover\:bg-amber-500{&:hover{@media (hover:hover){background-color:var(--color-amber-500)}}}.hover\:bg-amber-600{&:hover{@media (hover:hover){background-color:var(--color-amber-600)}}}.hover\:bg-amber-600\/30{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(66.6% 0.179 58.318) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-amber-600) 30%,transparent)}}}}.hover\:bg-amber-700{&:hover{@media (hover:hover){background-color:var(--color-amber-700)}}}.hover\:bg-black\/50{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 50%,transparent)}}}}.hover\:bg-blue-500{&:hover{@media (hover:hover){background-color:var(--color-blue-500)}}}.hover\:bg-blue-600{&:hover{@media (hover:hover){background-color:var(--color-blue-600)}}}.hover\:bg-blue-600\/80{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(54.6% 0.245 262.881) 80%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-blue-600) 80%,transparent)}}}}.hover\:bg-blue-900{&:hover{@media (hover:hover){background-color:var(--color-blue-900)}}}.hover\:bg-cyan-500{&:hover{@media (hover:hover){background-color:var(--color-cyan-500)}}}.hover\:bg-cyan-600{&:hover{@media (hover:hover){background-color:var(--color-cyan-600)}}}.hover\:bg-cyan-600\/30{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(60.9% 0.126 221.723) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-cyan-600) 30%,transparent)}}}}.hover\:bg-cyan-700{&:hover{@media (hover:hover){background-color:var(--color-cyan-700)}}}.hover\:bg-emerald-600{&:hover{@media (hover:hover){background-color:var(--color-emerald-600)}}}.hover\:bg-fuchsia-600{&:hover{@media (hover:hover){background-color:var(--color-fuchsia-600)}}}.hover\:bg-gray-400{&:hover{@media (hover:hover){background-color:var(--color-gray-400)}}}.hover\:bg-gray-500{&:hover{@media (hover:hover){background-color:var(--color-gray-500)}}}.hover\:bg-gray-600{&:hover{@media (hover:hover){background-color:var(--color-gray-600)}}}.hover\:bg-gray-700{&:hover{@media (hover:hover){background-color:var(--color-gray-700)}}}.hover\:bg-gray-700\/30{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(37.3% 0.034 259.733) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-gray-700) 30%,transparent)}}}}.hover\:bg-green-500{&:hover{@media (hover:hover){background-color:var(--color-green-500)}}}.hover\:bg-green-600{&:hover{@media (hover:hover){background-color:var(--color-green-600)}}}.hover\:bg-green-900{&:hover{@media (hover:hover){background-color:var(--color-green-900)}}}.hover\:bg-indigo-600{&:hover{@media (hover:hover){background-color:var(--color-indigo-600)}}}.hover\:bg-lime-600{&:hover{@media (hover:hover){background-color:var(--color-lime-600)}}}.hover\:bg-orange-600{&:hover{@media (hover:hover){background-color:var(--color-orange-600)}}}.hover\:bg-orange-700{&:hover{@media (hover:hover){background-color:var(--color-orange-700)}}}.hover\:bg-pink-600{&:hover{@media (hover:hover){background-color:var(--color-pink-600)}}}.hover\:bg-pink-700{&:hover{@media (hover:hover){background-color:var(--color-pink-700)}}}.hover\:bg-purple-500{&:hover{@media (hover:hover){background-color:var(--color-purple-500)}}}.hover\:bg-purple-600{&:hover{@media (hover:hover){background-color:var(--color-purple-600)}}}.hover\:bg-purple-700{&:hover{@media (hover:hover){background-color:var(--color-purple-700)}}}.hover\:bg-purple-900\/50{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(38.1% 0.176 304.987) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-purple-900) 50%,transparent)}}}}.hover\:bg-red-500{&:hover{@media (hover:hover){background-color:var(--color-red-500)}}}.hover\:bg-red-500\/20{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-500) 20%,transparent)}}}}.hover\:bg-red-500\/30{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-500) 30%,transparent)}}}}.hover\:bg-red-600{&:hover{@media (hover:hover){background-color:var(--color-red-600)}}}.hover\:bg-red-600\/30{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(57.7% 0.245 27.325) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-600) 30%,transparent)}}}}.hover\:bg-red-700{&:hover{@media (hover:hover){background-color:var(--color-red-700)}}}.hover\:bg-red-800{&:hover{@media (hover:hover){background-color:var(--color-red-800)}}}.hover\:bg-red-900{&:hover{@media (hover:hover){background-color:var(--color-red-900)}}}.hover\:bg-red-900\/30{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 30%,transparent)}}}}.hover\:bg-red-900\/50{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(39.6% 0.141 25.723) 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-900) 50%,transparent)}}}}.hover\:bg-rose-600{&:hover{@media (hover:hover){background-color:var(--color-rose-600)}}}.hover\:bg-teal-600{&:hover{@media (hover:hover){background-color:var(--color-teal-600)}}}.hover\:bg-teal-700{&:hover{@media (hover:hover){background-color:var(--color-teal-700)}}}.hover\:bg-transparent{&:hover{@media (hover:hover){background-color:transparent}}}.hover\:bg-violet-600{&:hover{@media (hover:hover){background-color:var(--color-violet-600)}}}.hover\:bg-white\/20{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#fff 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-white) 20%,transparent)}}}}.hover\:bg-yellow-500{&:hover{@media (hover:hover){background-color:var(--color-yellow-500)}}}.hover\:bg-yellow-600{&:hover{@media (hover:hover){background-color:var(--color-yellow-600)}}}.hover\:from-amber-500{&:hover{@media (hover:hover){--tw-gradient-from:var(--color-amber-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:from-blue-500{&:hover{@media (hover:hover){--tw-gradient-from:var(--color-blue-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:from-green-500{&:hover{@media (hover:hover){--tw-gradient-from:var(--color-green-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:from-red-500{&:hover{@media (hover:hover){--tw-gradient-from:var(--color-red-500);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:to-cyan-400{&:hover{@media (hover:hover){--tw-gradient-to:var(--color-cyan-400);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:to-emerald-400{&:hover{@media (hover:hover){--tw-gradient-to:var(--color-emerald-400);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:to-orange-400{&:hover{@media (hover:hover){--tw-gradient-to:var(--color-orange-400);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:to-yellow-400{&:hover{@media (hover:hover){--tw-gradient-to:var(--color-yellow-400);--tw-gradient-stops:var(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from) var(--tw-gradient-from-position),var(--tw-gradient-to) var(--tw-gradient-to-position))}}}.hover\:text-amber-500{&:hover{@media (hover:hover){color:var(--color-amber-500)}}}.hover\:text-blue-300{&:hover{@media (hover:hover){color:var(--color-blue-300)}}}.hover\:text-blue-400{&:hover{@media (hover:hover){color:var(--color-blue-400)}}}.hover\:text-gray-300{&:hover{@media (hover:hover){color:var(--color-gray-300)}}}.hover\:text-gray-400{&:hover{@media (hover:hover){color:var(--color-gray-400)}}}.hover\:text-purple-300{&:hover{@media (hover:hover){color:var(--color-purple-300)}}}.hover\:text-red-300{&:hover{@media (hover:hover){color:var(--color-red-300)}}}.hover\:text-red-400{&:hover{@media (hover:hover){color:var(--color-red-400)}}}.hover\:text-white{&:hover{@media (hover:hover){color:var(--color-white)}}}.hover\:text-yellow-300{&:hover{@media (hover:hover){color:var(--color-yellow-300)}}}.hover\:text-yellow-400{&:hover{@media (hover:hover){color:var(--color-yellow-400)}}}.hover\:opacity-100{&:hover{@media (hover:hover){opacity:100%}}}.hover\:shadow-xl{&:hover{@media (hover:hover){--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 8px 10px -6px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}}.hover\:ring-2{&:hover{@media (hover:hover){--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}}.hover\:ring-\[\#5865f2\]{&:hover{@media (hover:hover){--tw-ring-color:#5865f2}}}.focus\:border-\[\#5865f2\]{&:focus{border-color:#5865f2}}.focus\:border-\[\#7289da\]{&:focus{border-color:#7289da}}.focus\:border-amber-500{&:focus{border-color:var(--color-amber-500)}}.focus\:border-blue-500{&:focus{border-color:var(--color-blue-500)}}.focus\:border-cyan-500{&:focus{border-color:var(--color-cyan-500)}}.focus\:border-purple-500{&:focus{border-color:var(--color-purple-500)}}.focus\:ring-0{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-1{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-2{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-\[\#5865F2\]{&:focus{--tw-ring-color:#5865F2}}.focus\:ring-amber-500{&:focus{--tw-ring-color:var(--color-amber-500)}}.focus\:ring-blue-500{&:focus{--tw-ring-color:var(--color-blue-500)}}.focus\:ring-green-500{&:focus{--tw-ring-color:var(--color-green-500)}}.focus\:ring-yellow-500{&:focus{--tw-ring-color:var(--color-yellow-500)}}.focus\:outline-none{&:focus{--tw-outline-style:none;outline-style:none}}.active\:scale-95{&:active{--tw-scale-x:95%;--tw-scale-y:95%;--tw-scale-z:95%;scale:var(--tw-scale-x) var(--tw-scale-y)}}.active\:scale-\[0\.98\]{&:active{scale:0.98}}.disabled\:cursor-not-allowed{&:disabled{cursor:not-allowed}}.disabled\:opacity-50{&:disabled{opacity:50%}}.sm\:col-span-2{@media (width >= 40rem){grid-column:span 2/span 2}}.sm\:mx-3{@media (width >= 40rem){margin-inline:calc(var(--spacing) * 3)}}.sm\:mx-4{@media (width >= 40rem){margin-inline:calc(var(--spacing) * 4)}}.sm\:-mt-6{@media (width >= 40rem){margin-top:calc(var(--spacing) * -6)}}.sm\:mt-1{@media (width >= 40rem){margin-top:calc(var(--spacing) * 1)}}.sm\:mt-2{@media (width >= 40rem){margin-top:calc(var(--spacing) * 2)}}.sm\:mt-3{@media (width >= 40rem){margin-top:calc(var(--spacing) * 3)}}.sm\:mb-2{@media (width >= 40rem){margin-bottom:calc(var(--spacing) * 2)}}.sm\:mb-3{@media (width >= 40rem){margin-bottom:calc(var(--spacing) * 3)}}.sm\:mb-4{@media (width >= 40rem){margin-bottom:calc(var(--spacing) * 4)}}.sm\:line-clamp-3{@media (width >= 40rem){overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3}}.sm\:grid{@media (width >= 40rem){display:grid}}.sm\:hidden{@media (width >= 40rem){display:none}}.sm\:inline{@media (width >= 40rem){display:inline}}.sm\:h-2{@media (width >= 40rem){height:calc(var(--spacing) * 2)}}.sm\:h-5{@media (width >= 40rem){height:calc(var(--spacing) * 5)}}.sm\:h-7{@media (width >= 40rem){height:calc(var(--spacing) * 7)}}.sm\:h-8{@media (width >= 40rem){height:calc(var(--spacing) * 8)}}.sm\:h-10{@media (width >= 40rem){height:calc(var(--spacing) * 10)}}.sm\:h-12{@media (width >= 40rem){height:calc(var(--spacing) * 12)}}.sm\:h-16{@media (width >= 40rem){height:calc(var(--spacing) * 16)}}.sm\:h-20{@media (width >= 40rem){height:calc(var(--spacing) * 20)}}.sm\:h-\[70vh\]{@media (width >= 40rem){height:70vh}}.sm\:h-auto{@media (width >= 40rem){height:auto}}.sm\:max-h-\[60vh\]{@media (width >= 40rem){max-height:60vh}}.sm\:max-h-\[70vh\]{@media (width >= 40rem){max-height:70vh}}.sm\:max-h-\[80vh\]{@media (width >= 40rem){max-height:80vh}}.sm\:min-h-\[200px\]{@media (width >= 40rem){min-height:200px}}.sm\:w-5{@media (width >= 40rem){width:calc(var(--spacing) * 5)}}.sm\:w-7{@media (width >= 40rem){width:calc(var(--spacing) * 7)}}.sm\:w-8{@media (width >= 40rem){width:calc(var(--spacing) * 8)}}.sm\:w-10{@media (width >= 40rem){width:calc(var(--spacing) * 10)}}.sm\:w-12{@media (width >= 40rem){width:calc(var(--spacing) * 12)}}.sm\:w-16{@media (width >= 40rem){width:calc(var(--spacing) * 16)}}.sm\:w-20{@media (width >= 40rem){width:calc(var(--spacing) * 20)}}.sm\:max-w-md{@media (width >= 40rem){max-width:var(--container-md)}}.sm\:max-w-sm{@media (width >= 40rem){max-width:var(--container-sm)}}.sm\:grid-cols-2{@media (width >= 40rem){grid-template-columns:repeat(2,minmax(0,1fr))}}.sm\:grid-cols-3{@media (width >= 40rem){grid-template-columns:repeat(3,minmax(0,1fr))}}.sm\:grid-cols-\[1fr_120px\]{@media (width >= 40rem){grid-template-columns:1fr 120px}}.sm\:items-center{@media (width >= 40rem){align-items:center}}.sm\:gap-2{@media (width >= 40rem){gap:calc(var(--spacing) * 2)}}.sm\:gap-3{@media (width >= 40rem){gap:calc(var(--spacing) * 3)}}.sm\:gap-4{@media (width >= 40rem){gap:calc(var(--spacing) * 4)}}.sm\:space-y-1\.5{@media (width >= 40rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1.5) * calc(1 - var(--tw-space-y-reverse)))}}}.sm\:space-y-3{@media (width >= 40rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)))}}}.sm\:space-y-5{@media (width >= 40rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 5) * calc(1 - var(--tw-space-y-reverse)))}}}.sm\:space-x-3{@media (width >= 40rem){:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 3) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-x-reverse)))}}}.sm\:overflow-visible{@media (width >= 40rem){overflow:visible}}.sm\:rounded-2xl{@media (width >= 40rem){border-radius:var(--radius-2xl)}}.sm\:rounded-lg{@media (width >= 40rem){border-radius:var(--radius-lg)}}.sm\:rounded-t-lg{@media (width >= 40rem){border-top-left-radius:var(--radius-lg);border-top-right-radius:var(--radius-lg)}}.sm\:p-1\.5{@media (width >= 40rem){padding:calc(var(--spacing) * 1.5)}}.sm\:p-2{@media (width >= 40rem){padding:calc(var(--spacing) * 2)}}.sm\:p-3{@media (width >= 40rem){padding:calc(var(--spacing) * 3)}}.sm\:p-4{@media (width >= 40rem){padding:calc(var(--spacing) * 4)}}.sm\:p-5{@media (width >= 40rem){padding:calc(var(--spacing) * 5)}}.sm\:p-6{@media (width >= 40rem){padding:calc(var(--spacing) * 6)}}.sm\:px-2{@media (width >= 40rem){padding-inline:calc(var(--spacing) * 2)}}.sm\:px-3{@media (width >= 40rem){padding-inline:calc(var(--spacing) * 3)}}.sm\:px-4{@media (width >= 40rem){padding-inline:calc(var(--spacing) * 4)}}.sm\:px-5{@media (width >= 40rem){padding-inline:calc(var(--spacing) * 5)}}.sm\:px-6{@media (width >= 40rem){padding-inline:calc(var(--spacing) * 6)}}.sm\:py-1{@media (width >= 40rem){padding-block:calc(var(--spacing) * 1)}}.sm\:py-1\.5{@media (width >= 40rem){padding-block:calc(var(--spacing) * 1.5)}}.sm\:py-2{@media (width >= 40rem){padding-block:calc(var(--spacing) * 2)}}.sm\:py-2\.5{@media (width >= 40rem){padding-block:calc(var(--spacing) * 2.5)}}.sm\:py-3{@media (width >= 40rem){padding-block:calc(var(--spacing) * 3)}}.sm\:py-4{@media (width >= 40rem){padding-block:calc(var(--spacing) * 4)}}.sm\:py-8{@media (width >= 40rem){padding-block:calc(var(--spacing) * 8)}}.sm\:pb-2{@media (width >= 40rem){padding-bottom:calc(var(--spacing) * 2)}}.sm\:pb-4{@media (width >= 40rem){padding-bottom:calc(var(--spacing) * 4)}}.sm\:pl-4{@media (width >= 40rem){padding-left:calc(var(--spacing) * 4)}}.sm\:text-2xl{@media (width >= 40rem){font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}}.sm\:text-3xl{@media (width >= 40rem){font-size:var(--text-3xl);line-height:var(--tw-leading,var(--text-3xl--line-height))}}.sm\:text-4xl{@media (width >= 40rem){font-size:var(--text-4xl);line-height:var(--tw-leading,var(--text-4xl--line-height))}}.sm\:text-base{@media (width >= 40rem){font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}}.sm\:text-lg{@media (width >= 40rem){font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}}.sm\:text-sm{@media (width >= 40rem){font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}}.sm\:text-xl{@media (width >= 40rem){font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}}.sm\:text-xs{@media (width >= 40rem){font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}}.sm\:text-\[10px\]{@media (width >= 40rem){font-size:10px}}.sm\:opacity-0{@media (width >= 40rem){opacity:0%}}.sm\:group-hover\:opacity-100{@media (width >= 40rem){&:is(:where(.group):hover *){@media (hover:hover){opacity:100%}}}}.md\:relative{@media (width >= 48rem){position:relative}}.md\:-top-3{@media (width >= 48rem){top:calc(var(--spacing) * -3)}}.md\:top-6{@media (width >= 48rem){top:calc(var(--spacing) * 6)}}.md\:top-12{@media (width >= 48rem){top:calc(var(--spacing) * 12)}}.md\:top-16{@media (width >= 48rem){top:calc(var(--spacing) * 16)}}.md\:-right-2{@media (width >= 48rem){right:calc(var(--spacing) * -2)}}.md\:right-6{@media (width >= 48rem){right:calc(var(--spacing) * 6)}}.md\:bottom-4{@media (width >= 48rem){bottom:calc(var(--spacing) * 4)}}.md\:bottom-6{@media (width >= 48rem){bottom:calc(var(--spacing) * 6)}}.md\:left-4{@media (width >= 48rem){left:calc(var(--spacing) * 4)}}.md\:z-auto{@media (width >= 48rem){z-index:auto}}.md\:col-span-2{@media (width >= 48rem){grid-column:span 2/span 2}}.md\:mx-4{@media (width >= 48rem){margin-inline:calc(var(--spacing) * 4)}}.md\:mt-0{@media (width >= 48rem){margin-top:calc(var(--spacing) * 0)}}.md\:mt-1{@media (width >= 48rem){margin-top:calc(var(--spacing) * 1)}}.md\:mt-2{@media (width >= 48rem){margin-top:calc(var(--spacing) * 2)}}.md\:mt-3{@media (width >= 48rem){margin-top:calc(var(--spacing) * 3)}}.md\:mt-4{@media (width >= 48rem){margin-top:calc(var(--spacing) * 4)}}.md\:mt-6{@media (width >= 48rem){margin-top:calc(var(--spacing) * 6)}}.md\:mt-8{@media (width >= 48rem){margin-top:calc(var(--spacing) * 8)}}.md\:mr-2{@media (width >= 48rem){margin-right:calc(var(--spacing) * 2)}}.md\:mb-1{@media (width >= 48rem){margin-bottom:calc(var(--spacing) * 1)}}.md\:mb-2{@media (width >= 48rem){margin-bottom:calc(var(--spacing) * 2)}}.md\:mb-3{@media (width >= 48rem){margin-bottom:calc(var(--spacing) * 3)}}.md\:mb-4{@media (width >= 48rem){margin-bottom:calc(var(--spacing) * 4)}}.md\:mb-6{@media (width >= 48rem){margin-bottom:calc(var(--spacing) * 6)}}.md\:ml-2{@media (width >= 48rem){margin-left:calc(var(--spacing) * 2)}}.md\:line-clamp-2{@media (width >= 48rem){overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}}.md\:block{@media (width >= 48rem){display:block}}.md\:flex{@media (width >= 48rem){display:flex}}.md\:hidden{@media (width >= 48rem){display:none}}.md\:inline{@media (width >= 48rem){display:inline}}.md\:h-1\.5{@media (width >= 48rem){height:calc(var(--spacing) * 1.5)}}.md\:h-2{@media (width >= 48rem){height:calc(var(--spacing) * 2)}}.md\:h-2\.5{@media (width >= 48rem){height:calc(var(--spacing) * 2.5)}}.md\:h-4{@media (width >= 48rem){height:calc(var(--spacing) * 4)}}.md\:h-5{@media (width >= 48rem){height:calc(var(--spacing) * 5)}}.md\:h-6{@media (width >= 48rem){height:calc(var(--spacing) * 6)}}.md\:h-7{@media (width >= 48rem){height:calc(var(--spacing) * 7)}}.md\:h-9{@media (width >= 48rem){height:calc(var(--spacing) * 9)}}.md\:h-12{@media (width >= 48rem){height:calc(var(--spacing) * 12)}}.md\:h-24{@media (width >= 48rem){height:calc(var(--spacing) * 24)}}.md\:h-32{@media (width >= 48rem){height:calc(var(--spacing) * 32)}}.md\:h-\[60px\]{@media (width >= 48rem){height:60px}}.md\:h-\[80vh\]{@media (width >= 48rem){height:80vh}}.md\:h-\[85vh\]{@media (width >= 48rem){height:85vh}}.md\:h-\[90vh\]{@media (width >= 48rem){height:90vh}}.md\:h-\[220px\]{@media (width >= 48rem){height:220px}}.md\:max-h-32{@media (width >= 48rem){max-height:calc(var(--spacing) * 32)}}.md\:max-h-96{@media (width >= 48rem){max-height:calc(var(--spacing) * 96)}}.md\:w-1\/3{@media (width >= 48rem){width:calc(1/3 * 100%)}}.md\:w-4{@media (width >= 48rem){width:calc(var(--spacing) * 4)}}.md\:w-5{@media (width >= 48rem){width:calc(var(--spacing) * 5)}}.md\:w-6{@media (width >= 48rem){width:calc(var(--spacing) * 6)}}.md\:w-7{@media (width >= 48rem){width:calc(var(--spacing) * 7)}}.md\:w-9{@media (width >= 48rem){width:calc(var(--spacing) * 9)}}.md\:w-12{@media (width >= 48rem){width:calc(var(--spacing) * 12)}}.md\:w-16{@media (width >= 48rem){width:calc(var(--spacing) * 16)}}.md\:w-20{@media (width >= 48rem){width:calc(var(--spacing) * 20)}}.md\:w-24{@media (width >= 48rem){width:calc(var(--spacing) * 24)}}.md\:w-28{@media (width >= 48rem){width:calc(var(--spacing) * 28)}}.md\:w-32{@media (width >= 48rem){width:calc(var(--spacing) * 32)}}.md\:w-40{@media (width >= 48rem){width:calc(var(--spacing) * 40)}}.md\:w-44{@media (width >= 48rem){width:calc(var(--spacing) * 44)}}.md\:w-\[90\%\]{@media (width >= 48rem){width:90%}}.md\:w-\[90vw\]{@media (width >= 48rem){width:90vw}}.md\:w-\[95vw\]{@media (width >= 48rem){width:95vw}}.md\:max-w-2xl{@media (width >= 48rem){max-width:var(--container-2xl)}}.md\:max-w-3xl{@media (width >= 48rem){max-width:var(--container-3xl)}}.md\:max-w-\[45\%\]{@media (width >= 48rem){max-width:45%}}.md\:max-w-lg{@media (width >= 48rem){max-width:var(--container-lg)}}.md\:max-w-md{@media (width >= 48rem){max-width:var(--container-md)}}.md\:max-w-none{@media (width >= 48rem){max-width:none}}.md\:max-w-sm{@media (width >= 48rem){max-width:var(--container-sm)}}.md\:max-w-xl{@media (width >= 48rem){max-width:var(--container-xl)}}.md\:min-w-\[140px\]{@media (width >= 48rem){min-width:140px}}.md\:grid-cols-2{@media (width >= 48rem){grid-template-columns:repeat(2,minmax(0,1fr))}}.md\:grid-cols-3{@media (width >= 48rem){grid-template-columns:repeat(3,minmax(0,1fr))}}.md\:grid-cols-4{@media (width >= 48rem){grid-template-columns:repeat(4,minmax(0,1fr))}}.md\:grid-cols-8{@media (width >= 48rem){grid-template-columns:repeat(8,minmax(0,1fr))}}.md\:flex-row{@media (width >= 48rem){flex-direction:row}}.md\:flex-wrap{@media (width >= 48rem){flex-wrap:wrap}}.md\:items-center{@media (width >= 48rem){align-items:center}}.md\:items-start{@media (width >= 48rem){align-items:flex-start}}.md\:gap-1{@media (width >= 48rem){gap:calc(var(--spacing) * 1)}}.md\:gap-2{@media (width >= 48rem){gap:calc(var(--spacing) * 2)}}.md\:gap-3{@media (width >= 48rem){gap:calc(var(--spacing) * 3)}}.md\:gap-4{@media (width >= 48rem){gap:calc(var(--spacing) * 4)}}.md\:space-y-1{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1) * calc(1 - var(--tw-space-y-reverse)))}}}.md\:space-y-1\.5{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1.5) * calc(1 - var(--tw-space-y-reverse)))}}}.md\:space-y-2{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)))}}}.md\:space-y-3{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)))}}}.md\:space-y-4{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 4) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-y-reverse)))}}}.md\:space-y-6{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 6) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 6) * calc(1 - var(--tw-space-y-reverse)))}}}.md\:space-x-1{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 1) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 1) * calc(1 - var(--tw-space-x-reverse)))}}}.md\:space-x-2{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 2) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-x-reverse)))}}}.md\:space-x-3{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 3) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-x-reverse)))}}}.md\:space-x-4{@media (width >= 48rem){:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing) * 4) * var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-x-reverse)))}}}.md\:rounded-lg{@media (width >= 48rem){border-radius:var(--radius-lg)}}.md\:rounded-xl{@media (width >= 48rem){border-radius:var(--radius-xl)}}.md\:border{@media (width >= 48rem){border-style:var(--tw-border-style);border-width:1px}}.md\:border-\[\#202225\]{@media (width >= 48rem){border-color:#202225}}.md\:p-1{@media (width >= 48rem){padding:calc(var(--spacing) * 1)}}.md\:p-2{@media (width >= 48rem){padding:calc(var(--spacing) * 2)}}.md\:p-3{@media (width >= 48rem){padding:calc(var(--spacing) * 3)}}.md\:p-4{@media (width >= 48rem){padding:calc(var(--spacing) * 4)}}.md\:p-6{@media (width >= 48rem){padding:calc(var(--spacing) * 6)}}.md\:px-1\.5{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 1.5)}}.md\:px-2{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 2)}}.md\:px-3{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 3)}}.md\:px-4{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 4)}}.md\:px-6{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 6)}}.md\:py-1{@media (width >= 48rem){padding-block:calc(var(--spacing) * 1)}}.md\:py-1\.5{@media (width >= 48rem){padding-block:calc(var(--spacing) * 1.5)}}.md\:py-2{@media (width >= 48rem){padding-block:calc(var(--spacing) * 2)}}.md\:py-2\.5{@media (width >= 48rem){padding-block:calc(var(--spacing) * 2.5)}}.md\:py-3{@media (width >= 48rem){padding-block:calc(var(--spacing) * 3)}}.md\:py-4{@media (width >= 48rem){padding-block:calc(var(--spacing) * 4)}}.md\:py-8{@media (width >= 48rem){padding-block:calc(var(--spacing) * 8)}}.md\:pt-1{@media (width >= 48rem){padding-top:calc(var(--spacing) * 1)}}.md\:pt-4{@media (width >= 48rem){padding-top:calc(var(--spacing) * 4)}}.md\:pl-4{@media (width >= 48rem){padding-left:calc(var(--spacing) * 4)}}.md\:text-2xl{@media (width >= 48rem){font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}}.md\:text-5xl{@media (width >= 48rem){font-size:var(--text-5xl);line-height:var(--tw-leading,var(--text-5xl--line-height))}}.md\:text-base{@media (width >= 48rem){font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}}.md\:text-lg{@media (width >= 48rem){font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}}.md\:text-sm{@media (width >= 48rem){font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}}.md\:text-xl{@media (width >= 48rem){font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}}.md\:text-xs{@media (width >= 48rem){font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}}.md\:text-\[10px\]{@media (width >= 48rem){font-size:10px}}.md\:opacity-0{@media (width >= 48rem){opacity:0%}}.md\:shadow-none{@media (width >= 48rem){--tw-shadow:0 0 #0000;box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.md\:group-hover\:opacity-100{@media (width >= 48rem){&:is(:where(.group):hover *){@media (hover:hover){opacity:100%}}}}.lg\:w-32{@media (width >= 64rem){width:calc(var(--spacing) * 32)}}.lg\:w-44{@media (width >= 64rem){width:calc(var(--spacing) * 44)}}.lg\:w-48{@media (width >= 64rem){width:calc(var(--spacing) * 48)}}.lg\:grid-cols-3{@media (width >= 64rem){grid-template-columns:repeat(3,minmax(0,1fr))}}.lg\:grid-cols-5{@media (width >= 64rem){grid-template-columns:repeat(5,minmax(0,1fr))}}.lg\:p-2{@media (width >= 64rem){padding:calc(var(--spacing) * 2)}}.lg\:px-2{@media (width >= 64rem){padding-inline:calc(var(--spacing) * 2)}}.lg\:py-2{@media (width >= 64rem){padding-block:calc(var(--spacing) * 2)}}.lg\:text-sm{@media (width >= 64rem){font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}}}body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background-color:transparent !important}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top,0px);--safe-area-inset-bottom:env(safe-area-inset-bottom,0px);--safe-area-inset-left:env(safe-area-inset-left,0px);--safe-area-inset-right:env(safe-area-inset-right,0px)}}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#202225;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#40444b}.item-sprite,.item-sprite-icon{image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated;filter:none !important;mix-blend-mode:normal !important;-webkit-color-correction:default;color-rendering:auto;background-clip:border-box;background-origin:border-box}@media (pointer:coarse),(hover:none){.item-sprite,.item-sprite-icon{image-rendering:crisp-edges;backface-visibility:hidden;transform:translateZ(0)}}.quality-common{color:#9d9d9d}.quality-uncommon{color:#1eff00}.quality-rare{color:#0070dd}.quality-epic{color:#a335ee}.quality-legendary{color:#ff8000;text-shadow:0 0 4px rgba(255,128,0,0.4)}.quality-mythic{color:#e6cc80;text-shadow:0 0 6px rgba(230,204,128,0.5);animation:mythic-text-glow 2s ease-in-out infinite}@keyframes mythic-text-glow{0%,100%{text-shadow:0 0 4px rgba(230,204,128,0.3)}50%{text-shadow:0 0 10px rgba(230,204,128,0.6),0 0 16px rgba(230,204,128,0.3)}}.quality-border-common{border-color:#4a4a4a}.quality-border-uncommon{border-color:#1eff00}.quality-border-rare{border-color:#0070dd}.quality-border-epic{border-color:#a335ee}.quality-border-legendary{border-color:#ff8000;box-shadow:inset 0 0 6px rgba(255,128,0,0.25)}.quality-border-mythic{border-color:#e6cc80;box-shadow:inset 0 0 8px rgba(230,204,128,0.35);animation:mythic-border-glow 3s ease-in-out infinite}@keyframes mythic-border-glow{0%,100%{border-color:#e6cc80;box-shadow:inset 0 0 6px rgba(230,204,128,0.25)}50%{border-color:#f5e6c3;box-shadow:inset 0 0 12px rgba(230,204,128,0.5),0 0 4px rgba(230,204,128,0.3)}}.item-grid-cell.quality-common{border-color:#4a4a4a}.item-grid-cell.quality-uncommon{border-color:#1eff00;border-width:2px}.item-grid-cell.quality-rare{border-color:#0070dd;border-width:2px}.item-grid-cell.quality-epic{border-color:#a335ee;border-width:2px}.item-grid-cell.quality-legendary{border-color:#ff8000;border-width:2px;box-shadow:inset 0 0 8px rgba(255,128,0,0.3)}.item-grid-cell.quality-mythic{border-color:#e6cc80;border-width:2px;box-shadow:inset 0 0 10px rgba(230,204,128,0.4);animation:mythic-border-glow 3s ease-in-out infinite}.equipment-slot.quality-uncommon .slot-content{border-color:#1eff00 !important;background:rgba(30,255,0,0.08) !important}.equipment-slot.quality-rare .slot-content{border-color:#0070dd !important;background:rgba(0,112,221,0.08) !important}.equipment-slot.quality-epic .slot-content{border-color:#a335ee !important;background:rgba(163,53,238,0.08) !important}.equipment-slot.quality-legendary .slot-content{border-color:#ff8000 !important;background:rgba(255,128,0,0.1) !important;box-shadow:inset 0 0 6px rgba(255,128,0,0.2)}.equipment-slot.quality-mythic .slot-content{border-color:#e6cc80 !important;background:rgba(230,204,128,0.12) !important;box-shadow:inset 0 0 8px rgba(230,204,128,0.3);animation:mythic-slot-glow 3s ease-in-out infinite}@keyframes mythic-slot-glow{0%,100%{background:rgba(230,204,128,0.1);box-shadow:inset 0 0 6px rgba(230,204,128,0.25)}50%{background:rgba(230,204,128,0.18);box-shadow:inset 0 0 12px rgba(230,204,128,0.4)}}.quality-badge{display:inline-block;padding:0 6px;border-radius:3px;font-size:10px;font-weight:bold}.quality-badge.quality-common{background:#4a4a4a;color:#9d9d9d}.quality-badge.quality-uncommon{background:rgba(30,255,0,0.2);color:#1eff00}.quality-badge.quality-rare{background:rgba(0,112,221,0.2);color:#0070dd}.quality-badge.quality-epic{background:rgba(163,53,238,0.2);color:#a335ee}.quality-badge.quality-legendary{background:rgba(255,128,0,0.2);color:#ff8000}.quality-badge.quality-mythic{background:rgba(230,204,128,0.2);color:#e6cc80}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-space-x-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-gradient-position{syntax:"*";inherits:false}@property --tw-gradient-from{syntax:"<color>";inherits:false;initial-value:#0000}@property --tw-gradient-via{syntax:"<color>";inherits:false;initial-value:#0000}@property --tw-gradient-to{syntax:"<color>";inherits:false;initial-value:#0000}@property --tw-gradient-stops{syntax:"*";inherits:false}@property --tw-gradient-via-stops{syntax:"*";inherits:false}@property --tw-gradient-from-position{syntax:"<length-percentage>";inherits:false;initial-value:0%}@property --tw-gradient-via-position{syntax:"<length-percentage>";inherits:false;initial-value:50%}@property --tw-gradient-to-position{syntax:"<length-percentage>";inherits:false;initial-value:100%}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-tracking{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0px}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-outline-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-backdrop-blur{syntax:"*";inherits:false}@property --tw-backdrop-brightness{syntax:"*";inherits:false}@property --tw-backdrop-contrast{syntax:"*";inherits:false}@property --tw-backdrop-grayscale{syntax:"*";inherits:false}@property --tw-backdrop-hue-rotate{syntax:"*";inherits:false}@property --tw-backdrop-invert{syntax:"*";inherits:false}@property --tw-backdrop-opacity{syntax:"*";inherits:false}@property --tw-backdrop-saturate{syntax:"*";inherits:false}@property --tw-backdrop-sepia{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}@property --tw-scale-x{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-y{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-z{syntax:"*";inherits:false;initial-value:1}@keyframes spin{to{transform:rotate(360deg)}}@keyframes ping{75%,100%{transform:scale(2);opacity:0}}@keyframes pulse{50%{opacity:0.5}}@keyframes bounce{0%,100%{transform:translateY(-25%);animation-timing-function:cubic-bezier(0.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,0.2,1)}}@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,::before,::after,::backdrop{--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0;--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-space-x-reverse:0;--tw-border-style:solid;--tw-gradient-position:initial;--tw-gradient-from:#0000;--tw-gradient-via:#0000;--tw-gradient-to:#0000;--tw-gradient-stops:initial;--tw-gradient-via-stops:initial;--tw-gradient-from-position:0%;--tw-gradient-via-position:50%;--tw-gradient-to-position:100%;--tw-leading:initial;--tw-font-weight:initial;--tw-tracking:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-outline-style:solid;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-backdrop-blur:initial;--tw-backdrop-brightness:initial;--tw-backdrop-contrast:initial;--tw-backdrop-grayscale:initial;--tw-backdrop-hue-rotate:initial;--tw-backdrop-invert:initial;--tw-backdrop-opacity:initial;--tw-backdrop-saturate:initial;--tw-backdrop-sepia:initial;--tw-duration:initial;--tw-ease:initial;--tw-scale-x:1;--tw-scale-y:1;--tw-scale-z:1}}}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body></html>